/*! For license information please see web3d.min.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(self,(()=>(()=>{var e={5857:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Easing:()=>i,Group:()=>o,Interpolation:()=>s,Sequence:()=>l,Tween:()=>c,VERSION:()=>h,add:()=>v,default:()=>x,getAll:()=>f,nextId:()=>d,now:()=>a,remove:()=>g,removeAll:()=>m,update:()=>y});var r,i={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-i.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*i.Bounce.In(2*e):.5*i.Bounce.Out(2*e-1)+.5}}},a="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},o=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map((function(t){return e._tweens[t]}))},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},e.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},e.prototype.update=function(e,t){void 0===e&&(e=a()),void 0===t&&(t=!1);var n=Object.keys(this._tweens);if(0===n.length)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var i=this._tweens[n[r]],o=!t;i&&!1===i.update(e,o)&&!t&&delete this._tweens[n[r]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),s={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=s.Utils.Linear;return t<0?a(e[0],e[1],r):t>1?a(e[n],e[n-1],n-r):a(e[i],e[i+1>n?n:i+1],r-i)},Bezier:function(e,t){for(var n=0,r=e.length-1,i=Math.pow,a=s.Utils.Bernstein,o=0;o<=r;o++)n+=i(1-t,r-o)*i(t,o)*e[o]*a(r,o);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=s.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(i=Math.floor(r=n*(1+t))),a(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(a(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):a(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=s.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:(r=[1],function(e){var t=1;if(r[e])return r[e];for(var n=e;n>1;n--)t*=n;return r[e]=t,t}),CatmullRom:function(e,t,n,r,i){var a=.5*(n-e),o=.5*(r-t),s=i*i;return(2*t-2*n+a+o)*(i*s)+(-3*t+3*n-2*a-o)*s+a*i+t}}},l=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),u=new o,c=function(){function e(e,t){void 0===t&&(t=u),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=i.Linear.None,this._interpolationFunction=s.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=l.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.to=function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},e.prototype.duration=function(e){return this._duration=e,this},e.prototype.start=function(e){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var t in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==e?"string"==typeof e?a()+parseFloat(e):e:a(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},e.prototype._setupProperties=function(e,t,n,r){for(var i in n){var a=e[i],o=Array.isArray(a),s=o?"array":typeof a,l=!o&&Array.isArray(n[i]);if("undefined"!==s&&"function"!==s){if(l){var u=n[i];if(0===u.length)continue;u=u.map(this._handleRelativeValue.bind(this,a)),n[i]=[a].concat(u)}if("object"!==s&&!o||!a||l)void 0===t[i]&&(t[i]=a),o||(t[i]*=1),r[i]=l?n[i].slice().reverse():t[i]||0;else{for(var c in t[i]=o?[]:{},a)t[i][c]=a[c];r[i]=o?[]:{},this._setupProperties(a,t[i],n[i],r[i])}}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(e){return void 0===e&&(e=a()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this)),this},e.prototype.resume=function(e){return void 0===e&&(e=a()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return this._group=e,this},e.prototype.delay=function(e){return this._delayTime=e,this},e.prototype.repeat=function(e){return this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return this._yoyo=e,this},e.prototype.easing=function(e){return this._easingFunction=e,this},e.prototype.interpolation=function(e){return this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(e,t){if(void 0===e&&(e=a()),void 0===t&&(t=!0),this._isPaused)return!0;var n,r,i=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>i)return!1;t&&this.start(e)}if(this._goToEnd=!1,e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||r>1?1:r;var o=this._easingFunction(r);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,r),1===r){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var s=0,l=this._chainedTweens.length;s<l;s++)this._chainedTweens[s].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(e,t,n,r){for(var i in n)if(void 0!==t[i]){var a=t[i]||0,o=n[i],s=Array.isArray(e[i]),l=Array.isArray(o);!s&&l?e[i]=this._interpolationFunction(o,r):"object"==typeof o&&o?this._updateProperties(e[i],a,o,r):"number"==typeof(o=this._handleRelativeValue(a,o))&&(e[i]=a+(o-a)*r)}},e.prototype._handleRelativeValue=function(e,t){return"string"!=typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],n=this._valuesEnd[e];this._valuesStartRepeat[e]="string"==typeof n?this._valuesStartRepeat[e]+parseFloat(n):this._valuesEnd[e],this._valuesEnd[e]=t},e}(),h="18.6.4",d=l.nextId,p=u,f=p.getAll.bind(p),m=p.removeAll.bind(p),v=p.add.bind(p),g=p.remove.bind(p),y=p.update.bind(p);const x={Easing:i,Group:o,Interpolation:s,now:a,Sequence:l,nextId:d,Tween:c,VERSION:h,getAll:f,removeAll:m,add:v,remove:g,update:y}},8552:function(e,t,n){var r,i,a,o=n(831);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(791),n(4563),n(6940),n(2026),n(4012),n(5220),n(4700),n(5857),n(3063),n(5336),n(4341),n(787),n(4321),n(2405),n(3954),n(4051),n(1212),n(6885),n(8853),n(1828),n(1205),n(216),n(3977),n(6389),n(7891),n(5925),n(7805),n(666),n(5416),n(3286),n(8828),n(8828),n(3580),n(7154)],r=function(e,t,r,i,a,s,l,u,c,h,d,p,f,m,v,g,y,x,b,M,w,_,A,C,T,S,E,L,P,B,D,k,R,O,I){"use strict";var F=n(9173);function N(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(N=function(e){return e?n:t})(e)}function z(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=o(e)&&"function"!=typeof e)return{default:e};var n=N(t);if(n&&n.has(e))return n.get(e);var r={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){(0,l.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function j(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=G(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function G(e,t){if(e){if("string"==typeof e)return V(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?V(e,t):void 0}}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(e,"__esModule",{value:!0}),e.ThreeBase=void 0,t=F(t),r=F(r),i=F(i),a=F(a),s=F(s),l=F(l),c=F(c),h=F(h),k=z(k),e.ThreeBase=function(){function e(t,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,a.default)(this,e),(0,l.default)(this,"elementEventAbortController",new AbortController),(0,l.default)(this,"MCTools",k),(0,l.default)(this,"bustard",void 0),(0,l.default)(this,"wireframeMatreialMap",{"建筑-玻璃":{metalness:.4,roughness:1,color:"rgb(0,81,97)",opacity:.8},"建筑-窗框法线":{metalness:.5,roughness:.7,color:"rgb(107,193,255)",opacity:0},"建筑-窗框":{metalness:.5,roughness:.7,color:"rgb(107,193,255)",opacity:.8},"建筑-窗下沿外墙":{metalness:.4,roughness:1,color:"rgb(0,71,102)",opacity:.9},"建筑-外墙":{metalness:.4,roughness:1,color:"rgb(0,148,240)",opacity:.6},"建筑-屋顶":{metalness:.4,roughness:1,color:"rgb(0,111,158)",opacity:.6},"建筑-文字":{metalness:.6,roughness:1,color:"rgb(0,118,168)",opacity:.8},"建筑-门玻璃":{metalness:.4,roughness:.7,color:"rgb(74,136,168)",opacity:.2},"建筑-门框":{metalness:.4,roughness:.7,color:"rgb(0,149,254)",opacity:.8},"建筑-门":{metalness:.5,roughness:.7,color:"rgb(0,148,240)",opacity:1},"建筑-不锈钢":{metalness:.4,roughness:1,color:"rgb(0,168,240)",opacity:.6},"建筑-台阶":{metalness:.4,roughness:1,color:"rgb(0,125,179)",opacity:.6},"建筑-地面":{metalness:.4,roughness:1,color:"rgb(0,125,179)",opacity:.6}}),(0,l.default)(this,"measureTool",null),(0,l.default)(this,"clipTool",null),(0,l.default)(this,"targetIconTool",null),(0,l.default)(this,"selectOnTopTool",null),(0,l.default)(this,"firstPersonRoam",null),(0,l.default)(this,"nodeSizeTool",null),(0,l.default)(this,"selectBorderTool",null),(0,l.default)(this,"MultipleSelectTool",null),(0,l.default)(this,"occlusionHideTool",null),(0,l.default)(this,"_spriteLabelManager",null),(0,l.default)(this,"_drawTool",null),(0,l.default)(this,"_transformControlManager",null),(0,l.default)(this,"_oldMeasurementTool",null),(0,l.default)(this,"_pipeLineTool",null),(0,l.default)(this,"animationTool",null),(0,l.default)(this,"statusManager",null),(0,l.default)(this,"renderTool",void 0),(0,l.default)(this,"weatherTool",void 0),(0,l.default)(this,"meshInfoTool",void 0),(0,l.default)(this,"content",void 0),(0,l.default)(this,"isOpenFirst",!1),(0,l.default)(this,"modelNameMap",new Map),(0,l.default)(this,"cameraController",void 0),(0,l.default)(this,"scene",void 0),(0,l.default)(this,"loader",void 0),(0,l.default)(this,"sprite",void 0),(0,l.default)(this,"color",void 0),(0,l.default)(this,"texture",void 0),(0,l.default)(this,"modelHide",void 0),(0,l.default)(this,"pick",void 0),(0,l.default)(this,"roam",void 0),(0,l.default)(this,"light",void 0),(0,l.default)(this,"transparent",void 0),(0,l.default)(this,"fontLoader",void 0),(0,l.default)(this,"clip",void 0),(0,l.default)(this,"mark",void 0),(0,l.default)(this,"particle",void 0),(0,l.default)(this,"lod",void 0),(0,l.default)(this,"autoRoam",void 0),(0,l.default)(this,"outLine",void 0),(0,l.default)(this,"label",void 0),(0,l.default)(this,"lineEffect",void 0),(0,l.default)(this,"ballEffect",void 0),(0,l.default)(this,"isLineEffect",!1),(0,l.default)(this,"isLineEffect2",!1),(0,l.default)(this,"isBallEffect",!1),(0,l.default)(this,"ringEffect",void 0),(0,l.default)(this,"isRingEffect",!1),(0,l.default)(this,"railEffect",void 0),(0,l.default)(this,"isRailEffect",!1),(0,l.default)(this,"waterEffect",void 0),(0,l.default)(this,"isWaterEffect",!1),(0,l.default)(this,"isRunLightning",!1),(0,l.default)(this,"fogDay",void 0),(0,l.default)(this,"isFogDay",!1),(0,l.default)(this,"isArrow",!1),(0,l.default)(this,"isUpdateTexture",!1),(0,l.default)(this,"isRoutRun",!1),(0,l.default)(this,"arrowTexture",!1),(0,l.default)(this,"isCustomerDirectionalLight",!1),(0,l.default)(this,"isRoutTest",!1),(0,l.default)(this,"glow",void 0),(0,l.default)(this,"glowObjects",[]),(0,l.default)(this,"isGlowRing",!1),(0,l.default)(this,"isCSS2DRender",!1),(0,l.default)(this,"onlyLoadModels",[]),(0,l.default)(this,"separateModelList",[]),(0,l.default)(this,"runTextureMeshList",[]),(0,l.default)(this,"selectEffectModels",new Map),(0,l.default)(this,"pickEditAction",null),(0,l.default)(this,"adjustCameraState",!1),(0,l.default)(this,"shadowAutoUpdate",!1),(0,l.default)(this,"rightDoubleClickAction",void 0),(0,l.default)(this,"rightClickAction",void 0),(0,l.default)(this,"openProgressBar",!0),(0,l.default)(this,"modelTemplateUrls",{}),(0,l.default)(this,"effectAnimationId",null),(0,l.default)(this,"haveProgressBar",!1),(0,l.default)(this,"scenesMap",new Map),(0,l.default)(this,"scenesState",new Map),(0,l.default)(this,"roadNetNode",[]),(0,l.default)(this,"routNodeCount",0),(0,l.default)(this,"routNet",new Array),(0,l.default)(this,"fireNodes",[]),(0,l.default)(this,"isFirstHomeView",!0),(0,l.default)(this,"isAddSkyBox",!1),(0,l.default)(this,"riseInterval",null),(0,l.default)(this,"downInterval",null),(0,l.default)(this,"isCameraFollow",!1),(0,l.default)(this,"isNight",!1),(0,l.default)(this,"isFloorClip",!1),(0,l.default)(this,"clipCallback",null),(0,l.default)(this,"alphaCallback",null),(0,l.default)(this,"outClipCars",new Map),(0,l.default)(this,"publicModelClip",new Map),(0,l.default)(this,"selectOutClipCars",[]),(0,l.default)(this,"selectInClipCars",[]),(0,l.default)(this,"selectDownClipCars",[]),(0,l.default)(this,"enableAdsorptionModel",!0),(0,l.default)(this,"adsorptionDistance",{distanceLeft:0,distanceRight:0,distanceTop:0,distanceBottom:0,distanceForward:0,distanceBack:0}),(0,l.default)(this,"loadedLevel",[]),(0,l.default)(this,"animationStatus",!1),(0,l.default)(this,"lightState",!1),(0,l.default)(this,"currentTouch",null),(0,l.default)(this,"proTouch",null),(0,l.default)(this,"isRotate",!1),(0,l.default)(this,"cameraRotateStartView",void 0),(0,l.default)(this,"recoveryRotateInterval",15e3),(0,l.default)(this,"stopRotateTime",(new Date).getTime()),(0,l.default)(this,"alpha",0),(0,l.default)(this,"tweenAlphaMap",new Map),(0,l.default)(this,"havingTweenDownArray",[]),(0,l.default)(this,"castShadow",!0),(0,l.default)(this,"materialMap",new Map),(0,l.default)(this,"bufferMap",new Map),(0,l.default)(this,"ambientLightTween",null),(0,l.default)(this,"directionalLightTween",null),(0,l.default)(this,"isFloorLight",!1),(0,l.default)(this,"isAddCars",!1),(0,l.default)(this,"autoRotateObjects",[]),(0,l.default)(this,"interval",{}),(0,l.default)(this,"hideModels",[]),(0,l.default)(this,"hideObjects",new Map),(0,l.default)(this,"AirConditionerWind",new Map),(0,l.default)(this,"stopRotate",(function(){r.cameraRotateAnimation&&(r.isRotate=!1,r.stopCameraRotateAnimation(!0),r.stopRotateTime=(new Date).getTime())})),(0,l.default)(this,"effectAnimation",(function(e){r.animations(e),r.effectAnimationId=window.requestAnimationFrame(r.effectAnimation)}));var o=n.isLogarithmicDepthBuffer,s=n.enablekey,c=i.inCesium,M=i.initModule,w=i.pickAction,_=i.dragAction,A=i.doubleClickModelAction,T=i.touchAction,E=i.loadingAction,L=i.loadedAction,P=i.showLoading;this.inCesium=c,this.DB=new u.SimpleDB(!1,M.cacheDBName),this.content=document.getElementById(t),this.content.style.userSelect="none",this.bustard=new h.default(this.content,o,s),this.renderTool=new C.RenderTool(this.bustard),this.weatherTool=new S.WeatherTool(this.bustard),this.measureTool=new d.MeasurementTool(this),this.targetIconTool=new f.TargetIconTool(this.content,this.bustard.core.cameraControls),this.firstPersonRoam=new v.FirstPersonRoam(this),this.clipTool=new p.ThreeClipTool(this),this.selectOnTopTool=new m.SelectOnTopTool(this),this.nodeSizeTool=new g.ThreeNodeSizeTool(this),this.selectBorderTool=new y.SelectBorderTool(this),this.multipleSelectTool=new b.MultipleSelectTool(this),this.occlusionHideTool=new x.OcclusionHideTool(this),this.meshInfoTool=new I.MeshInfoTool(this),this.pickAction=w,this.dragAction=_,this.doubleClickModelAction=A,this.touchAction=T,this.loadingAction=E,this.loadedAction=L,this.showLoading=P,this.initSystemConfig(n),this.init()}return(0,s.default)(e,[{key:"spriteLabelManager",get:function(){return this._spriteLabelManager||(this._spriteLabelManager=new M.SpriteLabelManager(this)),this._spriteLabelManager}},{key:"drawTool",get:function(){return this._drawTool||(this._drawTool=new w.DrawTool(this)),this._drawTool}},{key:"transformControlManager",get:function(){return this._transformControlManager||(this._transformControlManager=new _.TransformControlManager(this.bustard.core)),this._transformControlManager}},{key:"oldMeasurementTool",get:function(){return this._oldMeasurementTool||(this._oldMeasurementTool=new A.OldMeasurementTool(this)),this._oldMeasurementTool}},{key:"pipeLineTool",get:function(){return this._pipeLineTool||(this._pipeLineTool=new T.PipeLineTool({bustard:this.bustard,transformControl:this.transformControlManager,mark:this.mark})),this._pipeLineTool}},{key:"initSystemConfig",value:function(e){this.version=e.version,this.workerjsUrl=e.workerjsUrl,this.openProgressBar=e.openProgressBar,this.dracoLibUrl=e.dracoLibUrl,this.selectEffect=e.selectEffect,this.smokeImg=e.smokeImg,this.waterImg=e.waterImg,this.baseUrl=e.baseUrl,this.moveUrl=e.moveUrl,this.adsorptionModelUrl=e.adsorptionModelUrl,this.isGlow=e.isGlow,this.glowParams=e.glowParams,this.moveValue=e.moveValue,this.noReuseModelNames=e.noReuseModelNames?e.noReuseModelNames:[],this.inSignageUrl=e.inSignageUrl,this.outSignageUrl=e.outSignageUrl,this.energyConfig=e.energyConfig,this.cameraConfig=e.cameraConfig,this.cursorValue=e.cursorValue,this.focusColors=e.focusColors,this.clipConfig=e.clipConfig,this.directionLightShadowProperty=e.directionLightShadowProperty,this.pointLightProperty=e.pointLightProperty,this.templatePointLightType=e.templatePointLightType,this.autoRoamConfig=e.autoRoamConfig,this.spriteConfig=e.spriteConfig,this.outLineConfig=e.outLineConfig,this.elevatorSpeed=e.elevatorSpeed,this.arrowSpeed=e.arrowSpeed,this.autoRotateSpeed=e.autoRotateSpeed,this.showPercentageToFocusObject=e.showPercentageToFocusObject,this.pickEnableLayers=e.pickEnableLayers,this.surfaceTextureUrl=e.mapConfig?e.mapConfig.surfaceTextureUrl:null,this.lineTopUrl=e.mapConfig?e.mapConfig.lineTopUrl:null,this.lineMidUrl=e.mapConfig?e.mapConfig.lineMidUrl:null}},{key:"initProjectConfig",value:function(e){this.floorTopHeight=e.floorTopHeight,this.inspectionRoute=e.inspectionRoute,this.roadLinePositions=e.roadLinePositions,this.pointLights=e.pointLights,this.areaLightConfig=e.areaLightConfig,this.areaLights=e.areaLights,this.energyLabelPosition=e.energyLabelPosition,this.floorFocusPosition=e.floorFocusPosition,this.floorDeviceFocusPosition=e.floorDeviceFocusPosition,this.elevatorInfo=e.elevatorInfo,this.elevatorMap=e.elevatorMap,this.wireframeModelFloorInfo=e.wireframeModelFloorInfo,this.templateModel=e.templateModel,this.energyFloorInfo=e.energyFloorInfo,this.roadLineParams=e.roadLineParams,this.defaultRingParams=e.defaultRingParams,this.upLinePositions=e.upLinePositions,this.upLineParams=e.upLineParams,this.floorGlassName=e.floorGlassName}},{key:"initModelNameMap",value:function(e){this.modelNameMap.clear(),e.forEach((function(e){}))}},{key:"init",value:function(){var e=this;this.bustard.core.renderer.shadowMap.autoUpdate=this.shadowAutoUpdate,this.bustard.core.renderer.localClippingEnabled=!0,this.setRendererOutputEncoding(0),window.addEventListener("resize",(function(){e.bustard.core.camera.aspect=e.content.clientWidth/e.content.clientHeight,e.bustard.core.camera.updateProjectionMatrix(),e.bustard.core.renderer.setSize(e.content.clientWidth,e.content.clientHeight),e.bustard.core.CSS2DRenderer.setSize(e.content.clientWidth,e.content.clientHeight),e.setNeedUpdate()}),{signal:this.elementEventAbortController.signal,capture:!1}),this.cameraController=this.bustard.core.cameraControls,this.setCameraControllerDistanceAndPolarAngle(this.cameraConfig.minDistance,this.cameraConfig.maxDistance,this.cameraConfig.maxPolarAngle),this.cameraConfig.fov&&this.setCameraFov(this.cameraConfig.fov),this.loader=this.bustard.use(new h.default.Loader({cacheDBName:this.DB.DB_NAME,version:this.version})),this.animationTool=new E.WebAnimationTool(this.loader,this.renderTool),this.statusManager=new O.Web3DStatusManager(this.animationTool),this.loader.setDraco(this.dracoLibUrl),this.loader.isCameraFix=!this.adjustCameraState,this.color=this.bustard.use(new h.default.Color({isMutex:!0})),this.color.activeClick=!1,this.setColorMap("customer",this.energyConfig.colorMap,this.energyConfig.min,this.energyConfig.max,this.energyConfig.segment),this.roam=this.bustard.roam,this.modelHide=this.bustard.hide,this.modelHide.activeClick=!1,this.light=this.bustard.light,this.light.directionLightShadowProperty=this.directionLightShadowProperty,this.light.activeClick=!1,this.addLightTemp(this.templatePointLightType,this.pointLightProperty),this.transparent=this.bustard.transparent,this.transparent.activeClick=!1,this.lod=this.bustard.lod,this.sprite=this.bustard.use(new h.default.Sprite(this.spriteConfig)),this.sprite.setClipTool(this.clipTool.clip3),this.label=this.bustard.label,this.clip=this.bustard.clip,this.mark=this.bustard.use(new h.default.Mark),this.mark.multiple=!0,this.mark.activeClick=!1,this.particle=this.bustard.particle,this.autoRoam=this.bustard.use(new h.default.AutoRoam(this.mark,this.roam)),this.autoRoam.setSpeed(this.autoRoamConfig.speed),this.autoRoam.setEyeHeight(this.autoRoamConfig.eyeHeight),this.autoRoam.reduceVisualHeight(this.autoRoamConfig.reduceVisualHeight),this.autoRoam.hideTable(),this.outLine=this.bustard.use(new h.default.OutLine2(this.outLineConfig)),this.lineEffect=this.bustard.lineEffect,this.lineEffect2=this.bustard.lineEffect2,this.railEffect=this.bustard.railEffect,this.fogDay=this.bustard.fogDay,this.ringEffect=this.bustard.use(new h.default.RingEffect),this.waterEffect=this.bustard.waterEffect,this.glow=this.bustard.glow,this.isGlow&&this.glow.init(this.glowParams),this.ballEffect=this.bustard.use(new h.default.BallEffect),this.texture=this.bustard.texture,this.bustard.touchAction=!0,this.pick=this.bustard.use(new h.default.Pick),this.bustard.core.pickEnableLayers=this.pickEnableLayers,this.bustard.core.touchEnableLayers=this.pickEnableLayers,this.pick.activeClick=!0,this.adjustCameraState||(this.bustard.core.adjustCameraState=this.adjustCameraState);var t=this;this.content.addEventListener("mousedown",this.stopRotate,{signal:this.elementEventAbortController.signal}),this.content.addEventListener("mousewheel",this.stopRotate,{signal:this.elementEventAbortController.signal}),this.content.addEventListener("DOMMousewheel",this.stopRotate,{signal:this.elementEventAbortController.signal});var n=0,r=300;this.content.addEventListener("contextmenu",(function(e){e.preventDefault();var i=(new Date).getTime();i-n<=r?(t.rightDoubleClickAction&&t.rightDoubleClickAction(),n=0):(t.rightClickAction&&t.rightClickAction(),n=i)}),{signal:this.elementEventAbortController.signal}),this.editLineAutoChange=function(e){if(!e.value){var n,r=t.bustard.core.transformControls.object;t.bustard.core.transformControls.object.userData.transformObject&&(r=t.bustard.core.transformControls.object.userData.transformObject),"editPoint"==r.userData.type&&t.createEditLine(),null!==(n=t._pipeLineTool)&&void 0!==n&&n.addPipeLineState&&t._pipeLineTool.handleEditLineDrag({mesh:r}),t.render(),t.dragAction&&t.dragAction({id:r.name,position:{x:r.position.x,y:r.position.y,z:r.position.z},rotation:{x:r.rotation.x,y:r.rotation.y,z:r.rotation.z},scale:{x:r.scale.x,y:r.scale.y,z:r.scale.z}}),r&&t.enableAdsorptionModel&&t.adsorptionModel()}},this.dragChange=function(e){t.bustard.core.transformControls.object&&t.bustard.core.transformControls.object.userData.transformObject&&t.bustard.core.transformControls.object.userData.transformObject.position.copy(t.bustard.core.transformControls.object.position.clone().add(t.bustard.core.transformControls.object.userData.transformPosition)),t.setNeedUpdate()},this.bustard.core.addAfterInitTransformControlsCallback((function(t){t.addEventListener("change",e.dragChange),t.addEventListener("dragging-changed",e.editLineAutoChange)})),this.pick.pick=function(e,n,r){var i,a,o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=s.face,u=s.isTouch;if(t.measureTool.shouldBlockAction)t.measureTool.handleClick({object:e,face:l,point:n,instancedID:r});else if(t.firstPersonRoam.isOpenFirst)t.firstPersonRoam.pickAction({point:n});else if(null!==(i=t._drawTool)&&void 0!==i&&i.isDrawModeOpen)t.drawTool.handleClick({object:e,face:l,point:n,instancedID:r});else if(!u)if(null!==(a=t._oldMeasurementTool)&&void 0!==a&&a.measurementStatus)t.oldMeasurementTool.handleClick({point:n});else{if(null!==(o=t._pipeLineTool)&&void 0!==o&&o.addPipeLineState&&t._pipeLineTool.handlePickAction({name:e.name}),t.pickAction){var c=(0,P.generateModelDataEventInformation)({mesh:e,point:n,instancedID:r});t.pickAction(c)}e&&t.enableAdsorptionModel&&t.updateAdsorptionModel(e.name)}},this.pick.doublePick=function(e,n,r){if(t.doubleClickModelAction){var i=(0,P.generateModelDataEventInformation)({mesh:e,point:n,instancedID:r});t.doubleClickModelAction(i)}},this.pick._isTouch=!1,this.pick.touch=function(e,n,r){var i,a,o=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).face;if(t.measureTool.shouldBlockAction)t.measureTool.handleTouch({object:e,face:o,point:n,instancedID:r});else if(!t.isOpenFirst&&(null!==(i=t._drawTool)&&void 0!==i&&i.isDrawModeOpen&&t.drawTool.handleTouch({object:e,face:o,point:n,instancedID:r}),null!==(a=t.spriteLabelManager)&&void 0!==a&&a.handleTouch&&t.spriteLabelManager.handleTouch({object:e}),t.touchAction)){var s=null;e?(t.content.style.cursor=t.cursorValue.meshTouch,s=(0,P.generateModelDataEventInformation)({mesh:e,point:n,instancedID:r})):t.content.style.cursor=t.cursorValue.default,t.touchAction(s)}},this.bustard.touchAction=!1,this.bustard.clickAction=!0,this.setCameraMoveValues(this.moveValue)}},{key:"initScene",value:function(e,t){var n=this;this.module=e,this.loadAndParseModels=e.modelUrls,this.hdrUrl=this.module.hdr,this.defaultLightProperty=this.module.lightProperty,this.defaultView=this.module.cameraPosition,this.loader.position=this.defaultView.position,this.loader.target=this.defaultView.target,this.inCesium||(this.addAnimation(),this.startEffectAnimation()),this.addScenes=[],this.initLoad((function(){n.initPublicModel(n.module.publicModels,(function(){n.render(),t&&t(),n.loadedAction&&n.loadedAction()}))}))}},{key:"resize",value:function(){this.content=document.getElementById(this.content.id),this.bustard.core.camera.aspect=this.content.clientWidth/this.content.clientHeight,this.bustard.core.camera.updateProjectionMatrix(),this.bustard.core.renderer.setSize(this.content.clientWidth,this.content.clientHeight),this.bustard.core.CSS2DRenderer.setSize(this.content.clientWidth,this.content.clientHeight),this.renderTool.setNeedUpdate()}},{key:"setEnableAdsorptionModel",value:function(e){this.enableAdsorptionModel=e}},{key:"initLoad",value:function(e){var t=this;if(this.setDefaultCameraPosition(),this.addSkyBox(this.module.skybox),this.addHdr(this.hdrUrl,!1,!0),this.addSceneLight(),0!=this.loadAndParseModels.length){var n=[],r=[];this.loadAndParseModels.forEach((function(e){"opacity"in e&&0==e.opacity?r.push(e):n.push(e)})),this.initLoadModels(n,(function(){t.showLoadModels(),e&&e()})),this.initLoadOpacityModels(r)}else e&&e()}},{key:"initLoadModels",value:function(e,t){var n=this,r=e.length;if(0!=r){for(var i=0;i<r;i++)this.loadedLevel.push(e[i].fileName);this.openProgressBar&&(this.creatProgressBar(),document.getElementById("loading").style.display="block"),document.body.style.pointerEvents="none";for(var a=0,o=function(i){var o=new Worker(n.workerjsUrl);o.onerror=function(e){},o.postMessage({url:e[i].url+e[i].fileName+".glb",version:n.version}),o.onmessage=function(s){s.data.isNone&&s.data.data.byteLength>0&&(n.DB.put(s.data.url,s.data.data,s.data.version),e[i].setBufferMap&&n.bufferMap.set(s.data.url,s.data.data)),s.data.data.byteLength>0?n.loader.loadGlbByData(s.data.url,s.data.data,e[i].sceneName,!1,!0,e[i].pickEnable,i).then((function(o){if("房间"!=e[i].sceneName&&"透明外壳"!=e[i].sceneName&&"电梯"!=e[i].sceneName&&-1==n.noReuseModelNames.indexOf(o.name)){var s=n.bustard.core.doInstance(o);o.add(s)}e[i].position&&o.position.set(e[i].position.x,e[i].position.y,e[i].position.z),e[i].scale&&o.scale.set(e[i].scale.x,e[i].scale.y,e[i].scale.z),e[i].rotation&&o.rotation.set(e[i].rotation.x,e[i].rotation.y,e[i].rotation.z),o.userData.pickEnable&&o.traverse((function(t){"Mesh"===t.type&&(t.layers.enable(n.pickEnableLayers[0]),e[i].touchEnable&&(n.bustard.core.touchTargetObjs.push(t),n.bustard.core.touchTargetIDs.push(t.uuid)))})),"外立面"!=o.parent.name&&"地形"!=o.parent.name?o.traverse((function(t){"Mesh"===t.type&&(t.castShadow=!1,t.receiveShadow=!1,"植物"==o.parent.name?t.renderOrder=32:(e[i].renderOrder&&(t.renderOrder=e[i].renderOrder),t.userData.renderOrder&&(t.renderOrder=Number(t.userData.renderOrder))))})):o.traverse((function(t){"Mesh"===t.type&&(t.material.emissiveIntensity=0,t.material.envMapIntensity=1,"外立面"==o.parent.name&&(t.receiveShadow=!1),e[i].renderOrder&&(t.renderOrder=e[i].renderOrder),t.userData.renderOrder&&(t.renderOrder=Number(t.userData.renderOrder)))})),n.initModelClip(o),n.scenesMap.set(o.name,o),n.scenesState.set(o.name,!0),"opacity"in e[i]&&n.removeSceneByName([o.name],{value:e[i].opacity,time:0}),a++,n.loadingAction&&n.loadingAction(a/r),n.openProgressBar&&(document.getElementById("fill").style.width=a/r*100+"%"),a==r&&(n.openProgressBar&&$(".loading").fadeOut(0),document.body.style.pointerEvents="auto",t&&t())}),(function(e){n.loadedLevel.splice(n.loadedLevel.indexOf(i),1),a++,n.loadingAction&&n.loadingAction(a/r),n.openProgressBar&&(document.getElementById("fill").style.width=a/r*100+"%"),a==r&&(n.openProgressBar&&$(".loading").fadeOut(0),document.body.style.pointerEvents="auto",t&&t())})):(a++,n.loadingAction&&n.loadingAction(a/r),n.openProgressBar&&(document.getElementById("fill").style.width=a/r*100+"%"),a==r&&(n.openProgressBar&&$(".loading").fadeOut(0),document.body.style.pointerEvents="auto",t&&t())),o.terminate(),o=null}},s=0;s<r;s++)o(s)}}},{key:"showLoadModels",value:function(){var e=this;this.loadedLevel.forEach((function(t){e.loader.modelMap.get(t)&&(e.loader.modelMap.get(t).visible=!0)})),this.bustard.core.renderer.shadowMap.needsUpdate=!0,this.loadedLevel=[]}},{key:"initModelClip",value:function(e){var t=this.bustard.use(new h.default.Clip2(e));t.setClipped(this.clipConfig.needHideMesh,!1),t.clippedVisible=!0,t.clippedDistance=.15;var n=this.bustard.core.getCenterAndSize(e),r=n.center,i=n.size;t.maxClipY=r.y+i.y/2,t.minClipY=r.y-i.y/2,t.center=r,t.boxSize=i,this.outClipCars.set(e.name,t)}},{key:"initPublicModelClip",value:function(e){var t=this.bustard.use(new h.default.Clip2(e,this.inCesium?e.matrixWorld:null));t.setClipped(this.clipConfig.needHideMesh,!1),t.clippedVisible=!0,t.clippedDistance=.15;var n=this.bustard.core.getCenterAndSize(e),r=n.center,i=n.size;t.maxClipY=r.y+i.y/2,t.minClipY=r.y-i.y/2,t.center=r,t.boxSize=i,this.publicModelClip.set(e.name,t)}},{key:"initLoadOpacityModels",value:function(e){var t=this,n=e.length;if(0!=n)for(var r=function(n){var r=new Worker(t.workerjsUrl);r.onerror=function(e){},r.postMessage({url:e[n].url+e[n].fileName+".glb",version:t.version}),r.onmessage=function(i){i.data.isNone&&i.data.data.byteLength>0&&(t.DB.put(i.data.url,i.data.data,i.data.version),e[n].setBufferMap&&t.bufferMap.set(i.data.url,i.data.data)),i.data.data.byteLength>0&&t.loader.loadGlbByData(i.data.url,i.data.data,e[n].sceneName,!1,!0,e[n].pickEnable,null).then((function(r){if("房间"!=e[n].sceneName&&"透明外壳"!=e[n].sceneName&&"电梯"!=e[n].sceneName&&-1==t.noReuseModelNames.indexOf(r.name)){var i=t.bustard.core.doInstance(r);r.add(i)}e[n].position&&r.position.set(e[n].position.x,e[n].position.y,e[n].position.z),e[n].scale&&r.scale.set(e[n].scale.x,e[n].scale.y,e[n].scale.z),e[n].rotation&&r.rotation.set(e[n].rotation.x,e[n].rotation.y,e[n].rotation.z),r.userData.pickEnable&&r.traverse((function(r){"Mesh"===r.type&&(r.layers.enable(t.pickEnableLayers[0]),e[n].touchEnable&&(t.bustard.core.touchTargetObjs.push(r),t.bustard.core.touchTargetIDs.push(r.uuid)))})),"外立面"!=r.parent.name&&"地形"!=r.parent.name?r.traverse((function(t){"Mesh"===t.type&&(t.castShadow=!1,t.receiveShadow=!1,"植物"==r.parent.name?t.renderOrder=32:(e[n].renderOrder&&(t.renderOrder=e[n].renderOrder),t.userData.renderOrder&&(t.renderOrder=Number(t.userData.renderOrder))))})):r.traverse((function(t){"Mesh"===t.type&&(t.material.emissiveIntensity=0,t.material.envMapIntensity=1,"外立面"==r.parent.name&&(t.receiveShadow=!1)),e[n].renderOrder&&(t.renderOrder=e[n].renderOrder),t.userData.renderOrder&&(t.renderOrder=Number(t.userData.renderOrder))})),t.initModelClip(r),t.scenesMap.set(r.name,r),t.scenesState.set(r.name,!0),t.removeSceneByName([r.name],{value:e[n].opacity,time:0})})),r.terminate(),r=null}},i=0;i<n;i++)r(i)}},{key:"loadModelsData",value:function(){var e=this,t=this.onlyLoadModels;if(!(!t.length>=1))for(var n=function(){var n=new Worker(e.workerjsUrl);n.onerror=function(e){},n.postMessage({url:t[r].url+t[r].fileName+".glb",version:e.version}),n.onmessage=function(t){t.data.isNone&&t.data.data.byteLength>0&&e.DB.put(t.data.url,t.data.data,t.data.version),e.bufferMap.set(t.data.url,t.data.data),n.terminate(),n=null}},r=0,i=t.length;r<i;r++)n()}},{key:"addModelsFromModelsDataByScenes",value:function(e,t){var n=this;if(e&&0!=e.length){var r=[];if(e.forEach((function(e){n.scenesMap.get(e.fileName)||r.push(e)})),!(!r.length>=1)){this.openProgressBar&&(this.creatProgressBar(),document.getElementById("loading").style.display="block"),document.body.style.pointerEvents="none";var i=this,a=0;r.forEach((function(e){a++}));for(var o=0,s=function(e){var n=i.bufferMap.get(r[e].url+r[e].fileName+".glb");null!=n?i.loader.loadGlbByData(r[e].url+r[e].fileName+".glb",n,r[e].sceneName,!1,!0,r[e].pickEnable,e).then((function(n){if("房间"!=r[e].sceneName&&"透明外壳"!=r[e].sceneName&&"电梯"!=r[e].sceneName&&-1==i.noReuseModelNames.indexOf(n.name)){var s=i.bustard.core.doInstance(n);n.add(s)}n.userData.pickEnable&&n.traverse((function(e){"Mesh"===e.type&&e.layers.enable(i.pickEnableLayers[0])})),"外立面"!=n.parent.name&&"地形"!=n.parent.name?n.traverse((function(t){"Mesh"===t.type&&(t.castShadow=!1,t.receiveShadow=!1,"植物"==n.parent.name?t.renderOrder=32:(r[e].renderOrder&&(t.renderOrder=r[e].renderOrder),t.userData.renderOrder&&(t.renderOrder=Number(t.userData.renderOrder))))})):n.traverse((function(t){"Mesh"===t.type&&(t.material.emissiveIntensity=0,t.material.envMapIntensity=1,"外立面"==n.parent.name&&(t.receiveShadow=!1)),r[e].renderOrder&&(t.renderOrder=r[e].renderOrder),t.userData.renderOrder&&(t.renderOrder=Number(t.userData.renderOrder))})),i.initModelClip(n),"配电柜"===n.parent.name&&n.traverse((function(e){"Mesh"===e.type&&(i.bustard.core.touchTargetObjs.push(e),i.bustard.core.touchTargetIDs.push(e.uuid))})),"设备"===n.parent.name&&r[e].pickEnable&&n.traverse((function(e){"Mesh"===e.type&&(i.bustard.core.touchTargetObjs.push(e),i.bustard.core.touchTargetIDs.push(e.uuid))})),i.scenesMap.set(n.name,n),i.scenesState.set(n.name,!0),"能耗"!=n.parent.name&&"房间"!=n.parent.name?("透明外壳"==n.parent.name&&i.bustard.core.traverseNodes(n,(function(e){"Mesh"==e.type&&(e.renderOrder=19)})),"电梯"==n.parent.name&&i.bustard.core.traverseNodes(n,(function(e){"Mesh"==e.type&&(e.renderOrder=20)})),i.removeSceneByName([n.name],{value:0,time:0},(function(){i.restroeSceneByName([n.name],{value:0,time:1e3},(function(){o++,i.loadingAction&&i.loadingAction(o/a),i.openProgressBar&&(document.getElementById("fill").style.width=o/a*100+"%"),o==a&&(i.openProgressBar&&$(".loading").fadeOut(0),document.body.style.pointerEvents="auto",t&&t())}))}))):(o++,i.loadingAction&&i.loadingAction(o/a),i.openProgressBar&&(document.getElementById("fill").style.width=o/a*100+"%"),o==a&&(i.openProgressBar&&$(".loading").fadeOut(0),document.body.style.pointerEvents="auto",t&&t()),"能耗"==n.parent.name?i.bustard.core.traverseNodes(n,(function(e){"Mesh"==e.type&&(e.material=e.material.clone(),e.material.depthWrite=!0)})):(i.bustard.core.traverseNodes(n,(function(e){"Mesh"==e.type&&(e.visible=!1)})),n.visible=!0))})):(o++,i.loadingAction&&i.loadingAction(o/a),i.openProgressBar&&(document.getElementById("fill").style.width=o/a*100+"%"),o==a&&(i.openProgressBar&&$(".loading").fadeOut(0),document.body.style.pointerEvents="auto",t&&t()))},l=0,u=r.length;l<u;l++)s(l)}}}},{key:"addModel2Scenes",value:function(e,t){for(var n=this,r=function(r){var i=new Worker(n.workerjsUrl);i.onerror=function(e){},i.postMessage({url:e[r].url+e[r].fileName+".glb",version:n.version}),i.onmessage=function(a){a.data.isNone&&a.data.data.byteLength>0&&(n.DB.put(a.data.url,a.data.data,a.data.version),e[r].setBufferMap&&n.bufferMap.set(a.data.url,a.data.data)),a.data.data.byteLength>0&&n.loader.loadGlbByData(a.data.url,a.data.data,e[r].sceneName,!1,!0,e[r].pickEnable,r).then((function(i){if(i.visible=!0,"房间"!=e[r].sceneName&&"透明外壳"!=e[r].sceneName&&"电梯"!=e[r].sceneName&&-1==n.noReuseModelNames.indexOf(i.name)){var a=n.bustard.core.doInstance(i);i.add(a)}i.userData.pickEnable&&i.traverse((function(e){"Mesh"===e.type&&e.layers.enable(n.pickEnableLayers[0])})),"外立面"!=i.parent.name&&"地形"!=i.parent.name?i.traverse((function(t){"Mesh"===t.type&&(t.castShadow=!1,t.receiveShadow=!1,"植物"==i.parent.name?t.renderOrder=32:(e[r].renderOrder&&(t.renderOrder=e[r].renderOrder),t.userData.renderOrder&&(t.renderOrder=Number(t.userData.renderOrder))))})):i.traverse((function(t){"Mesh"===t.type&&(t.material.emissiveIntensity=0,t.material.envMapIntensity=1,"外立面"==i.parent.name&&(t.receiveShadow=!1)),e[r].renderOrder&&(t.renderOrder=e[r].renderOrder),t.userData.renderOrder&&(t.renderOrder=Number(t.userData.renderOrder))})),n.initModelClip(i),"配电柜"===i.parent.name&&i.traverse((function(e){"Mesh"===e.type&&(n.bustard.core.touchTargetObjs.push(e),n.bustard.core.touchTargetIDs.push(e.uuid))})),"设备"===i.parent.name&&e[r].pickEnable&&i.traverse((function(e){"Mesh"===e.type&&(n.bustard.core.touchTargetObjs.push(e),n.bustard.core.touchTargetIDs.push(e.uuid))})),n.scenesMap.set(i.name,i),n.scenesState.set(i.name,!0),n.bustard.core.renderer.shadowMap.needsUpdate=!0,t&&t(i)})),i.terminate(),i=null}},i=0,a=e.length;i<a;i++)r(i)}},{key:"addModelToScenes",value:function(e,t){var n=this;this.loader.loadGlbByData(e.url,e.arrayBuffer,e.sceneName,!1,!0).then((function(r){var i;if(r.visible=!0,r.userData.pickEnable&&r.traverse((function(e){"Mesh"===e.type&&e.layers.enable(n.pickEnableLayers[0])})),"实体大楼"!=r.parent.name&&"场景"!=r.parent.name?r.traverse((function(e){"Mesh"===e.type&&("土建"==r.parent.name?e.castShadow=!1:("家具"==r.parent.name||(e.castShadow=!1),e.receiveShadow=!1),e.userData.renderOrder?e.renderOrder=Number(e.userData.renderOrder):"植物"==r.parent.name&&(e.renderOrder=32))})):r.traverse((function(e){"Mesh"===e.type&&(e.material.emissiveIntensity=0,e.material.envMapIntensity=1,e.geometry.getAttribute("uv")&&e.geometry.getAttribute("uv2")&&!e.geometry.getAttribute("uv3")&&e.geometry.setAttribute("uv3",e.geometry.attributes.uv.clone()),"实体大楼"==r.parent.name&&(e.receiveShadow=!1,e.userData.modelName=r.name),e.userData.renderOrder&&(e.renderOrder=Number(e.userData.renderOrder)))})),null===(i=r.animations)||void 0===i||!i.length){var a=n.bustard.use(new h.default.Clip2(r));a.setClipped(n.clipConfig.needHideMesh,!1),a.clippedVisible=!0,a.clippedDistance=.15;var o=n.bustard.core.getCenterAndSize(r),s=o.center,l=o.size;a.maxClipY=s.y+l.y/2,a.minClipY=s.y-l.y/2,n.outClipCars.set(r.name,a)}"配电柜"===r.parent.name&&r.traverse((function(e){"Mesh"===e.type&&(n.bustard.core.touchTargetObjs.push(e),n.bustard.core.touchTargetIDs.push(e.uuid))})),"设备"===r.parent.name&&e.pickEnable&&r.traverse((function(e){"Mesh"===e.type&&(n.bustard.core.touchTargetObjs.push(e),n.bustard.core.touchTargetIDs.push(e.uuid),e.parent.parent.name)})),n.scenesMap.set(r.name,r),n.scenesState.set(r.name,!0),n.bustard.core.renderer.shadowMap.needsUpdate=!0,n.bustard.core.setCameraStandByObjects("floor",[r]),t&&t(r)}))}},{key:"removeModelsByScenes",value:function(e,t){var n=this,r=this;if(e&&0!=e.length){var i=0,a=e.length;e.forEach((function(e){n.removeSceneByName([e.fileName],{value:0,time:1e3},(function(){var n=r.scenesMap.get(e.fileName);null!=n&&(r.scenesMap.delete(e.fileName),r.scenesState.delete(e.fileName),r.loader.modelMap.delete(e.fileName),r.loader.treeMap.delete(e.fileName),r.bustard.core.dispose(n)),++i==a&&t&&t()}))}))}}},{key:"initLoaded",value:function(){var e=this,t=this.getSceneByName("外立面");null!=t&&this.bustard.core.traverseNodes(t,(function(e){"Mesh"==e.type&&(e.renderOrder=29)}));var n=this.getSceneByName("土建");null!=n&&this.bustard.core.traverseNodes(n,(function(e){"Mesh"==e.type&&(e.renderOrder=30)})),this.glbLoaded(),this.module.showRoadLine&&setTimeout((function(){e.removeMovingLines(),e.addLineEffect(),e.addSceneRingEffect(),e.addUpLineEffect()}),1e3)}},{key:"glbLoaded",value:function(){var e=this,t=this.getSceneByName("房间");null!=t&&(this.bustard.core.traverseNodes(t,(function(e){"Mesh"==e.type&&(e.visible=!1)})),r.children.forEach((function(e){e.visible=!0})));var n=this.getSceneByName("透明外壳");null!=n&&this.bustard.core.traverseNodes(n,(function(e){"Mesh"==e.type&&(e.renderOrder=19)}));var r=this.getSceneByName("电梯");null!=r&&this.bustard.core.traverseNodes(r,(function(e){"Mesh"==e.type&&(e.renderOrder=20)}));var i=this.getSceneByName("能耗");null!=i&&i.children.forEach((function(t){e.bustard.core.traverseNodes(t,(function(e){"Mesh"==e.type&&(e.material=e.material.clone(),e.material.depthWrite=!0)}))}))}},{key:"addGLTFModelByUrl",value:function(e,t,n,r,i,a){var o=this;this.loader.addGLTFModelByUrl(t,e,n).then((function(e){e.rotation.set(r.x,r.y,r.z),e.scale.set(i.x,i.y,i.z),o.autoRoam.focusingToObjects([e],!0,.5,2e3,a)}))}},{key:"removeGLTFModelByName",value:function(e){this.loader.removeGLTFModelByName(e)}},{key:"removeAllGLTFModel",value:function(){this.loader.removeAllGLTFModel()}},{key:"initPublicModel",value:function(e,t){var n=this,r=new Map,i=function(e){return new THREE.Vector3(e.x,e.y,e.z)};e.forEach((function(e){n.loader.loadMap.set(e.id,{status:"start",isDelete:!1});var t,a=e.position;n.inCesium&&(a=i(Cesium.Cartesian3.fromDegrees(e.position.x,e.position.y,e.position.z)),t=i(Cesium.Cartesian3.fromDegrees(e.position.x,e.position.y,e.position.z+1)));var o={name:e.id,position:a,centerHigh:t,rotation:e.rotation,scale:e.scale,touchEnable:e.touchEnable,type:e.type,show:e.show,transparency:e.transparency,isTemplate:e.isTemplate};r.has(e.url)?r.get(e.url).push(o):r.set(e.url,[o])}));var a=0,o=r.size;0==o&&t&&t(),r.forEach((function(e,r){n.inCesium?n.addTemplateModelsByCesium(r,e,(function(){++a==o&&(n.showLoading||n.addScenes.forEach((function(e){e.visible=!0})),n.renderTool.setNeedUpdate(),t&&t())})):n.addTemplateModelByMatrix(r,e,(function(){++a==o&&(n.showLoading||n.addScenes.forEach((function(e){e.visible=!0})),n.renderTool.setNeedUpdate(),t&&t())}))}))}},{key:"startAnimation",value:function(e,t){this.loader.startAnimation(e,t)}},{key:"stopAnimation",value:function(e){this.loader.stopAnimation(e)}},{key:"setAction",value:function(e,t,n,r,i,a){this.loader.setAction(e,t,n,r,i,a)}},{key:"setAction2",value:function(e,t,n,r,i,a,o){this.loader.setAction2(e,t,n,r,i,a,o)}},{key:"getAction",value:function(){return this.loader.getAction()}},{key:"setLineAction",value:function(e){this.loader.setLineAction(e.reverse())}},{key:"setDefaultCameraPosition",value:function(e){this.defaultView&&(this.isFirstHomeView?(this.lerpLookAt(this.defaultView.position,this.defaultView.target,1e3,!1,e),this.isFirstHomeView=!1):this.lerpLookAt(this.defaultView.position,this.defaultView.target,1e3,!0,e))}},{key:"setDefaultView",value:function(){var e=this.roam.curPosition(),t=this.roam.curTarget();return this.defaultView.position={x:e.x,y:e.y,z:e.z},this.defaultView.target={x:t.x,y:t.y,z:t.z},this.defaultView}},{key:"getCameraPosition",value:function(){var e=this.roam.curPosition(),t=this.roam.curTarget();return{position:{x:e.x,y:e.y,z:e.z},target:{x:t.x,y:t.y,z:t.z}}}},{key:"getCameraAngle",value:function(){return{azimuthAngle:(0,R.toDegrees)(this.cameraController.azimuthAngle),polarAngle:(0,R.toDegrees)(this.cameraController.polarAngle)}}},{key:"setCameraAngle",value:function(e,t){this.cameraController.azimuthAngle=(0,R.toRadians)(e),this.cameraController.polarAngle=(0,R.toRadians)(t)}},{key:"lerpLookAt",value:function(e,t,n,r,i){this.autoRoam.lerpLookAt(e,t,n,r,i)}},{key:"switchCameraOrientation",value:function(e,t){var n=this;this.bustard.core.switchCameraOrientation(e,(function(){requestAnimationFrame((function(){n.renderTool.setNeedUpdate(),t&&t()}))}))}},{key:"setCameraStandByObjects",value:function(e,t){var n=[];this.bustard.core.scene.children.forEach((function(e){e.name===t&&n.push(e)})),this.bustard.core.setCameraStandByObjects(e,n)}},{key:"focusingByNodeName",value:function(e){if(e){var t=this.getNodeByName(e,!1);t||(t=this.bustard.core.getMeshByName(e)),t&&this.roam.focusingToObject(t,!0,this.showPercentageToFocusObject)}}},{key:"focusMap",value:function(e,t){if(e){var n=this.bustard.core.getMeshByName(e+"面");n&&this.roam.focusingToObjectByRotation(n,n.userData.p,Math.PI/3.5,n.userData.rotation,1.2,t)}}},{key:"addSplotLight",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16777215,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0,u=arguments.length>9?arguments[9]:void 0,c=arguments.length>10?arguments[10]:void 0;this.light.addSplotLight(e,t,n,r,i,a,o,s,l,u,c)}},{key:"updateSpotLight",value:function(e,t){var n=this.light.sceneLights.get(e);n&&(t.color&&n.color.setStyle(t.color),t.position&&n.position.set(t.position.x,t.position.y,t.position.z),t.target&&n.target.position.set(t.target.x,t.target.y,t.target.z),"intensity"in t&&(n.intensity=t.intensity),"distance"in t&&(n.distance=t.distance),"decay"in t&&(n.decay=t.decay),"angle"in t&&(n.angle=t.angle),"penumbra"in t&&(n.penumbra=t.penumbra),this.renderTool.setNeedUpdate())}},{key:"removeLight",value:function(e){this.light.removeLightForScene(e)}},{key:"focusModel",value:function(e){var t=this,n=[];e.forEach((function(e){var r=t.loader.modelMap.get(e);r&&n.push(r)})),n.length>0&&this.roam.focusingToObjects(n,!0,this.showPercentageToFocusObject)}},{key:"setModelColor",value:function(e,t){var n=this,r=this;e.forEach((function(e){var i=n.loader.modelMap.get(e);if(i)if("color"==t)n.color.setObject3DColor(i,16776960);else if("colorBox"==t)n.color.setObjectBoxColor(i,16776960);else if("modelBox"==t){var a=n.bustard.core.getCenterAndSize(i),o=a.center,s=a.size;n.selectEffectModels.get(i.uuid)||n.loader.addCustomModel(n.selectEffect).then((function(e){e.object.name="选中效果",e.object.scale.set(1*s.x,1*s.y,1*s.z),e.object.position.set(o.x,o.y,o.z),e.object.traverse((function(e){"Mesh"===e.type&&(e.material.color.setHex(0),e.material.emissive.setHex(16776960)),"Box003"===e.name&&(e.material.transparent=!0,e.material.opacity=.2)})),r.selectEffectModels.set(i.uuid,e.object)}))}}))}},{key:"setNodeColor",value:function(e,t,n){var r=this,i=this.getObjectByUniqueTarget({id:e,name:t});if(i)if("color"==n)this.color.setObject3DColor(i,16776960);else if("colorBox"==n)this.color.setObjectBoxColor(i,16776960);else if("modelBox"==n){var a=this.bustard.core.getCenterAndSize(i),o=a.center,s=a.size;this.selectEffectModels.get(i.uuid)||this.loader.addCustomModel(this.selectEffect).then((function(e){e.object.name="选中效果",e.object.scale.set(s.x*scale,s.y*scale,s.z*scale),e.object.position.set(o.x,o.y,o.z),e.object.traverse((function(e){"Mesh"===e.type&&(e.material.color.setHex(0),e.material.emissive.setHex(16776960)),"Box003"===e.name&&(e.material.transparent=!0,e.material.opacity=.2)})),r.selectEffectModels.set(i.uuid,e.object)}))}}},{key:"hideModel",value:function(e){var t=this.loader.modelMap.get(e);t&&this.modelHide.hide(t)}},{key:"transparentModel",value:function(e){var t=this.loader.modelMap.get(e);t&&this.transparent.transparentObject(t)}},{key:"transparentNode",value:function(e,t){var n=this.getObjectByUniqueTarget({id:e,name:t});n&&this.transparent.transparentObject(n)}},{key:"highLightModel",value:function(e){var t=this.loader.modelMap.get(e);t&&(this.bustard.core.resetObject3DFromAllInstances(t),this.outLine.highLight2(t),this.bustard.core.transformControls.object&&this.bustard.core.transformControlDetach())}},{key:"highLightNode",value:function(e,t){var n=this.getObjectByUniqueTarget({id:e,name:t});n&&(this.outLine.highLight2(n),this.bustard.core.transformControls.object&&this.bustard.core.transformControlDetach())}},{key:"setCanvasToMesh",value:function(e,t,n){var r=this.loader.modelMap.get(e);if(r){var i=this.bustard.core.getModelMeshByName(r,t);i&&(this.texture.addCanvasForMesh(i,n),this.isUpdateTexture=!0)}}},{key:"getModelTopPosition",value:function(e){var t=this,n=[];if(e.forEach((function(e){var r=t.loader.modelMap.get(e);r&&n.push(r)})),n.length>0)return this.bustard.core.getCenterAndSize2(n)}},{key:"getNodeTopPosition",value:function(e,t){var n=this.getObjectByUniqueTarget({id:e,name:t},!1);if(n)return this.bustard.core.getCenterAndSize(n)}},{key:"getNodesTopPosition",value:function(e){var t=this,n=[];if(e.forEach((function(e){var r=t.getObjectByUniqueTarget({id:e.id,name:e.name},!1);r&&n.push(r)})),0!=n.length)return this.bustard.core.getCenterAndSize2(n)}},{key:"addInstancePathTubeLines",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{radius:.002,length:.05,length2:.02,cornerRadius:.01},i=[];t.forEach((function(e){var t=n.loader.modelMap.get(e.id);if(t){var r=new THREE.Matrix4;r.compose(t.position,new THREE.Quaternion,t.scale);var a,o,s,l,u=r.clone().multiply(t.matrixWorld.clone().invert());if(e.name?e.name.indexOf("/")>-1?a=n.bustard.core.getModelNodeByPathNames2(t,e.name,!1):(a=n.bustard.core.getModelNodeByName(t,e.name,!1))||(a=n.bustard.core.getModelMeshByName2(t,e.name)):a=t,a)"instanceId"in a?(s=n.bustard.core.setFromInstanceMesh(a.mesh,a.instanceId).getCenter(new THREE.Vector3),l=n.bustard.core.setFromInstanceMesh(a.mesh,a.instanceId,u).getSize(new THREE.Vector3),s.x+=l.x/2):(s=n.bustard.core.bbox3([a]).getCenter(new THREE.Vector3),l=n.bustard.core.getCenterAndSize3(a,u).size,s.x+=l.x/2),i.push({id:e.id+"-"+e.name,color:e.color,position:s,rotation:null!==(o=e.rotation)&&void 0!==o?o:{x:0,y:0,z:0},userData:e})}})),i.length>0&&this.lineEffect2.addInstancePathTubeLines(e,i,r)}},{key:"addPathTubeLineByDevicePort",value:function(e,t,n){var r=this.loader.modelMap.get(e);if(r){var i,a=this.bustard.core.getCenterAndSize2([r]),o=a.center,s=a.size,l=o.y-s.y/2;if(t?t.indexOf("/")>-1?i=this.bustard.core.getModelNodeByPathNames2(r,t,!1):(i=this.bustard.core.getModelNodeByName(r,t,!1))||(i=this.bustard.core.getModelMeshByName2(r,t)):i=r,i){var u,c,h,d;d="instanceId"in i?this.bustard.core.setFromInstanceMesh(i.mesh,i.instanceId).getCenter(new THREE.Vector3):this.bustard.core.bbox3([i]).getCenter(new THREE.Vector3);var p=this.addPathTubeLine(e+"-"+t,[{x:0,y:0,z:0},{x:null!==(u=n.length)&&void 0!==u?u:.03,y:0,z:0},{x:null!==(c=n.length)&&void 0!==c?c:.03,y:l-d.y,z:0}],n.url,n),f=null!==(h=n.rotation)&&void 0!==h?h:{x:0,y:0,z:0};p.position.set(d.x,d.y,d.z),p.rotation.set(f.x,f.y,f.z)}}}},{key:"getObjectByUniqueTarget",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return null===(t=this.getObjectByUniqueTargets([e],n))||void 0===t?void 0:t[0]}},{key:"getObjectByUniqueTargets",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.map((function(e){var r=e.id,i=e.name,a=t.loader.modelMap.get(r);if(a){if(!i)return a;if(i.indexOf("/")>-1)return t.bustard.core.getModelNodeByPathNames(a,i,n);var o=t.bustard.core.getModelNodeByName(a,i,n);return o||(o=t.bustard.core.getModelMeshByName(a,i)),o}})).filter(Boolean)}},{key:"getNodeTopPositionByCesium",value:function(e,t){var n,r=this.loader.modelMap.get(e);if(r&&(t?t.indexOf("/")>-1?n=this.bustard.core.getModelNodeByPathNames(r,t,!1):(n=this.bustard.core.getModelNodeByName(r,t,!1))||(n=this.bustard.core.getModelMeshByName(r,t)):n=r,n))return this.bustard.core.getCenterAndSize3(n,r.matrixWorld2.clone().multiply(r.matrixWorld.clone().invert()))}},{key:"getModelClipRange",value:function(e){if(!this.inCesium){var t=this.getNodeTopPosition(e),n=t.center,r=t.size;return{xRange:[n.x-r.x/2,n.x+r.x/2],yRange:[n.y-r.y/2,n.y+r.y/2],zRange:[n.z-r.z/2,n.z+r.z/2]}}var i=this.loader.modelMap.get(e);if(i)return this.bustard.core.getCesiumClipRange(i,i.matrixWorld)}},{key:"getSceneClipRange",value:function(){var e=this;if(this.inCesium){var t={xRange:[1/0,-1/0],yRange:[1/0,-1/0],zRange:[1/0,-1/0]};return this.loader.modelMap.forEach((function(n,r){var i=e.bustard.core.getCesiumClipRange(n,n.matrixWorld),a=i.xRange,o=i.yRange,s=i.zRange;t.xRange[0]=Math.min(t.xRange[0],a[0]),t.xRange[1]=Math.max(t.xRange[1],a[1]),t.yRange[0]=Math.min(t.yRange[0],o[0]),t.yRange[1]=Math.max(t.yRange[1],o[1]),t.zRange[0]=Math.min(t.zRange[0],s[0]),t.zRange[1]=Math.max(t.zRange[1],s[1])})),t}var n=this.getSceneSize(),r=n.center,i=n.size;return{xRange:[r.x-i.x/2,r.x+i.x/2],yRange:[r.y-i.y/2,r.y+i.y/2],zRange:[r.z-i.z/2,r.z+i.z/2]}}},{key:"focusNode",value:function(e,t){var n,r=this.loader.modelMap.get(e);if(r)return t.indexOf("/")>-1?n=this.bustard.core.getModelNodeByPathNames(r,t,!1):(n=this.bustard.core.getModelNodeByName(r,t,!1))||(n=this.bustard.core.getModelMeshByName(r,t)),n&&this.roam.focusingToObject(n,!0,this.showPercentageToFocusObject),n}},{key:"setModelTextureRun",value:function(e,t,n){var r=this,i=this.loader.modelMap.get(e);i&&i.traverse((function(e){"Mesh"===e.type&&e.material.map&&(t?e.userData.interval||(e.userData.interval=setInterval((function(){e.material.map.offset.x+=n&&n.speed?n.speed:.001}),50),r.runTextureMeshList.push(e)):e.userData.interval&&(clearInterval(e.userData.interval),e.userData.interval=null,r.runTextureMeshList.splice(r.runTextureMeshList.indexOf(e),1)))}))}},{key:"clearModelTextureRun",value:function(){this.runTextureMeshList.forEach((function(e){e.userData.interval&&(clearInterval(e.userData.interval),e.userData.interval=null)})),this.runTextureMeshList=[]}},{key:"setNodeTextureRun",value:function(e,t,n,r){var i,a=this,o=this.loader.modelMap.get(e);o&&(t.indexOf("/")>-1?i=this.bustard.core.getModelNodeByPathNames(o,t):(i=this.bustard.core.getModelNodeByName(o,t))||(i=this.bustard.core.getModelMeshByName(o,t)),i&&i.traverse((function(e){"Mesh"===e.type&&e.material.map&&(n?e.userData.interval||(e.userData.interval=setInterval((function(){e.material.map.offset.x+=r&&r.speed?r.speed:.001}),50),a.runTextureMeshList.push(e)):e.userData.interval&&(clearInterval(e.userData.interval),e.userData.interval=null,a.runTextureMeshList.splice(a.runTextureMeshList.indexOf(e),1)))})))}},{key:"setCameraRotateState",value:function(e,t){this.isRotate=e,e?(this.cameraRotateStartView&&this.lerpLookAt(this.cameraRotateStartView.position,this.cameraRotateStartView.target,1e3,!1),this.startCameraRotateAnimation(t)):this.stopCameraRotateAnimation()}},{key:"setCameraRotateStartView",value:function(e,t){this.cameraRotateStartView={position:e,target:t}}},{key:"setRecoveryRotateInterval",value:function(e){this.recoveryRotateInterval=e}},{key:"setCameraMoveValues",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[{x:-250,y:0,z:-300},{x:250,y:200,z:100}];this.bustard.core.setCameraMoveValues(e)}},{key:"addSkyBox",value:function(){var e=(0,i.default)(t.default.mark((function e(n){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||""==n||!n.url){e.next=15;break}if("string"!=typeof n.url){e.next=8;break}return 1==this.skyboxType&&this.removeSkybox(),this.skyboxType=0,e.next=6,this.loader.addSkyBox4(n.url,n.position,n.radius);case 6:e.next=13;break;case 8:if(n.url.constructor!=Array||6!=n.url.length){e.next=13;break}return 0==this.skyboxType&&this.removeSkybox(),this.skyboxType=1,e.next=13,this.loader.addSkyBox(n.url);case 13:e.next=16;break;case 15:this.removeSkybox();case 16:this.renderTool.setNeedUpdate();case 17:case"end":return e.stop()}}),e,this)})));function n(t){return e.apply(this,arguments)}return n}()},{key:"removeSkybox",value:function(){this.loader.removeSkybox()}},{key:"setSceneBackground",value:function(e){this.bustard.core.changeBackgroundColor(e)}},{key:"setCameraControllerDistanceAndPolarAngle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.PI/2.2;this.cameraController.minDistance=e,this.cameraController.maxDistance=t,this.cameraController.maxPolarAngle=n,this.cameraController.setBoundary()}},{key:"setCameraPosition",value:function(e,t,n,r,i,a){this.bustard.core.setCameraPosition(e,t,n,r,i,a)}},{key:"setMouseButtonsState",value:function(e,t){this.cameraController.mouseButtons[e]=t}},{key:"enabledCameraControls",value:function(e){this.bustard.core.enabledcameraControls(e)}},{key:"setRoamingCoords",value:function(e,t){e&&""!=e&&this.autoRoam.readCoordsFromJSON(e,t)}},{key:"startRoaming",value:function(e){var t=this;this.autoRoam.isCycle=!1,this.autoRoam.startFn((function(){setTimeout((function(){t.setDefaultCameraPosition()}),2e3),e&&e()}))}},{key:"suspendRoaming",value:function(){this.autoRoam.stopFn()}},{key:"endRoaming",value:function(){this.autoRoam.isCycle=!1,this.autoRoam.endFn()}},{key:"setRoamPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=arguments.length>1?arguments[1]:void 0;this.autoRoam.addEdit(e,t)}},{key:"setRoamSpeed",value:function(e){this.autoRoam.setSpeed(e)}},{key:"addRoamByList",value:function(e){this.autoRoam.setEdit(e)}},{key:"getRoamList",value:function(){return this.autoRoam.endEdit()}},{key:"startRoam",value:function(e){this.autoRoam.startRoam(e)}},{key:"setRoamOnDelayCallback",value:function(e){this.autoRoam.onDelayCallback=e}},{key:"setRoamOffDelayCallback",value:function(e){this.autoRoam.offDelayCallback=e}},{key:"enableClick",value:function(e){this.pick.activeClick=e,this.bustard.clickAction=e}},{key:"setPickAction",value:function(e){this.pickAction=e}},{key:"setRightDoubleClickAction",value:function(e){this.rightDoubleClickAction=e}},{key:"setRightClickAction",value:function(e){this.rightClickAction=e}},{key:"setDoubleClickModelAction",value:function(e){this.doubleClickModelAction=e}},{key:"setDragAction",value:function(e){this.dragAction=e}},{key:"setPickEditAction",value:function(e){this.pickEditAction=e}},{key:"enableTouch",value:function(e){this.pick._isTouch=e,this.bustard.touchAction=e,e||(this.content.style.cursor=this.cursorValue.default)}},{key:"setTouchAction",value:function(e){this.touchAction=e}},{key:"adsorptionModel",value:function(e){var t=this,n=this.adsorptionModelUrl,r=this.bustard.core.transformControls.object;if(r){var i=this.getModelCenter(r),a=i.boxCenter,o=i.boxSize,s=10,l=this.getModelRayPosition(a,o,"top",s),u=this.getModelRayPosition(a,o,"bottom",s),c=this.getModelRayPosition(a,o,"left",s),h=this.getModelRayPosition(a,o,"right",s),d=this.getModelRayPosition(a,o,"forward",s),p=this.getModelRayPosition(a,o,"back",s);if("adsorptionTop"!=e&&l.length){for(var f=0,m=!0;f<l.length;f++)if(l[f].distance>o.y/2&&l[f].distance<o.y/2+s){this.adsorptionDistance.distanceTop=l[f].distance;var v=this.label.labelMap.get("adsorptionTop");if(v)v.position.set(r.position.x,r.position.y+1,r.position.z);else{var g=document.createElement("div");g.style.width="40px",g.style.height="40px",g.style.cursor="pointer";var y=document.createElement("div");y.style.width="100%",y.style.height="100%",y.style.transform="rotate(0deg)",y.style.backgroundImage="url("+n+")",y.style.backgroundSize="100% 100%",g.appendChild(y),g.onclick=function(e){e.stopPropagation(),t.updateAdsorptionModel("adsorptionTop");var n=t.bustard.core.transformControls.object;n&&t.dragAction&&t.dragAction({id:n.name,type:"adsorption",position:{x:n.position.x,y:n.position.y,z:n.position.z},rotation:{x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},scale:{x:n.scale.x,y:n.scale.y,z:n.scale.z}})},this.addLabel("adsorptionTop",g,{x:r.position.x,y:r.position.y+1,z:r.position.z},[],"adsorption")}m=!1;break}m&&this.label.labelMap.get("adsorptionTop")&&this.label.emptyLabelByName("adsorptionTop")}else this.label.labelMap.get("adsorptionTop")&&this.label.emptyLabelByName("adsorptionTop");if("adsorptionBottom"!=e&&u.length){for(var x=0,b=!0;x<u.length;x++)if(u[x].distance>o.y/2&&u[x].distance<o.y/2+s){this.adsorptionDistance.distanceBottom=u[x].distance;var M=this.label.labelMap.get("adsorptionBottom");if(M)M.position.set(r.position.x,r.position.y-1,r.position.z);else{var w=document.createElement("div");w.style.width="40px",w.style.height="40px",w.style.cursor="pointer";var _=document.createElement("div");_.style.width="100%",_.style.height="100%",_.style.transform="rotate(180deg)",_.style.backgroundImage="url("+n+")",_.style.backgroundSize="100% 100%",w.appendChild(_),w.onclick=function(e){e.stopPropagation(),t.updateAdsorptionModel("adsorptionBottom");var n=t.bustard.core.transformControls.object;n&&t.dragAction&&t.dragAction({id:n.name,type:"adsorption",position:{x:n.position.x,y:n.position.y,z:n.position.z},rotation:{x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},scale:{x:n.scale.x,y:n.scale.y,z:n.scale.z}})},this.addLabel("adsorptionBottom",w,{x:r.position.x,y:r.position.y-1,z:r.position.z},[],"adsorption")}b=!1;break}b&&this.label.labelMap.get("adsorptionBottom")&&this.label.emptyLabelByName("adsorptionBottom")}else this.label.labelMap.get("adsorptionBottom")&&this.label.emptyLabelByName("adsorptionBottom");if("adsorptionLeft"!=e&&c.length){for(var A=0,C=!0;A<c.length;A++)if(c[A].distance>o.x/2&&c[A].distance<o.x/2+s){this.adsorptionDistance.distanceLeft=c[A].distance;var T=this.label.labelMap.get("adsorptionLeft");if(T)T.position.set(r.position.x-1,r.position.y,r.position.z);else{var S=document.createElement("div");S.style.width="40px",S.style.height="40px",S.style.cursor="pointer";var E=document.createElement("div");E.style.width="100%",E.style.height="100%",E.style.transform="rotate(-90deg)",E.style.backgroundImage="url("+n+")",E.style.backgroundSize="100% 100%",S.appendChild(E),S.onclick=function(e){e.stopPropagation(),t.updateAdsorptionModel("adsorptionLeft");var n=t.bustard.core.transformControls.object;n&&t.dragAction&&t.dragAction({id:n.name,type:"adsorption",position:{x:n.position.x,y:n.position.y,z:n.position.z},rotation:{x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},scale:{x:n.scale.x,y:n.scale.y,z:n.scale.z}})},this.addLabel("adsorptionLeft",S,{x:r.position.x-1,y:r.position.y,z:r.position.z},[],"adsorption")}C=!1;break}C&&this.label.labelMap.get("adsorptionLeft")&&this.label.emptyLabelByName("adsorptionLeft")}else this.label.labelMap.get("adsorptionLeft")&&this.label.emptyLabelByName("adsorptionLeft");if("adsorptionRight"!=e&&h.length){for(var L=0,P=!0;L<h.length;L++)if(h[L].distance>o.x/2&&h[L].distance<o.x/2+s){this.adsorptionDistance.distanceRight=h[L].distance;var B=this.label.labelMap.get("adsorptionRight");if(B)B.position.set(r.position.x+1,r.position.y,r.position.z);else{var D=document.createElement("div");D.style.width="40px",D.style.height="40px",D.style.cursor="pointer";var k=document.createElement("div");k.style.width="100%",k.style.height="100%",k.style.transform="rotate(90deg)",k.style.backgroundImage="url("+n+")",k.style.backgroundSize="100% 100%",D.appendChild(k),D.onclick=function(e){e.stopPropagation(),t.updateAdsorptionModel("adsorptionRight");var n=t.bustard.core.transformControls.object;n&&t.dragAction&&t.dragAction({id:n.name,type:"adsorption",position:{x:n.position.x,y:n.position.y,z:n.position.z},rotation:{x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},scale:{x:n.scale.x,y:n.scale.y,z:n.scale.z}})},this.addLabel("adsorptionRight",D,{x:r.position.x+1,y:r.position.y,z:r.position.z},[],"adsorption")}P=!1;break}P&&this.label.labelMap.get("adsorptionRight")&&this.label.emptyLabelByName("adsorptionRight")}else this.label.labelMap.get("adsorptionRight")&&this.label.emptyLabelByName("adsorptionRight");if("adsorptionForward"!=e&&d.length){for(var R=0,O=!0;R<d.length;R++)if(d[R].distance>o.z/2&&d[R].distance<o.z/2+s){this.adsorptionDistance.distanceForward=d[R].distance;var I=this.label.labelMap.get("adsorptionForward");if(I)I.position.set(r.position.x,r.position.y,r.position.z+1);else{var F=document.createElement("div");F.style.width="40px",F.style.height="40px",F.style.cursor="pointer";var N=document.createElement("div");N.style.width="100%",N.style.height="100%",N.style.transform="rotate(90deg)",N.style.backgroundImage="url("+n+")",N.style.backgroundSize="100% 100%",F.appendChild(N),F.onclick=function(e){e.stopPropagation(),t.updateAdsorptionModel("adsorptionForward");var n=t.bustard.core.transformControls.object;n&&t.dragAction&&t.dragAction({id:n.name,type:"adsorption",position:{x:n.position.x,y:n.position.y,z:n.position.z},rotation:{x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},scale:{x:n.scale.x,y:n.scale.y,z:n.scale.z}})},this.addLabel("adsorptionForward",F,{x:r.position.x,y:r.position.y,z:r.position.z+1},[],"adsorption")}O=!1;break}O&&this.label.labelMap.get("adsorptionForward")&&this.label.emptyLabelByName("adsorptionForward")}else this.label.labelMap.get("adsorptionForward")&&this.label.emptyLabelByName("adsorptionForward");if("adsorptionBack"!=e&&p.length){for(var z=0,U=!0;z<p.length;z++)if(p[z].distance>o.z/2&&p[z].distance<o.z/2+s){this.adsorptionDistance.distanceBack=p[z].distance;var H=this.label.labelMap.get("adsorptionBack");if(H)H.position.set(r.position.x,r.position.y,r.position.z-1);else{var j=document.createElement("div");j.style.width="40px",j.style.height="40px",j.style.cursor="pointer";var G=document.createElement("div");G.style.width="100%",G.style.height="100%",G.style.transform="rotate(-90deg)",G.style.backgroundImage="url("+n+")",G.style.backgroundSize="100% 100%",j.appendChild(G),j.onclick=function(e){e.stopPropagation(),t.updateAdsorptionModel("adsorptionBack");var n=t.bustard.core.transformControls.object;n&&t.dragAction&&t.dragAction({id:n.name,type:"adsorption",position:{x:n.position.x,y:n.position.y,z:n.position.z},rotation:{x:n.rotation.x,y:n.rotation.y,z:n.rotation.z},scale:{x:n.scale.x,y:n.scale.y,z:n.scale.z}})},this.addLabel("adsorptionBack",j,{x:r.position.x,y:r.position.y,z:r.position.z-1},[],"adsorption")}U=!1;break}U&&this.label.labelMap.get("adsorptionBack")&&this.label.emptyLabelByName("adsorptionBack")}else this.label.labelMap.get("adsorptionBack")&&this.label.emptyLabelByName("adsorptionBack")}}},{key:"updateAdsorptionModel",value:function(e){var t=this.bustard.core.transformControls.object;if(t){var n=this.getModelCenter(t),r=(n.boxCenter,n.boxSize);"adsorptionLeft"===e?t.position.x-=this.adsorptionDistance.distanceLeft-r.x/2:"adsorptionRight"===e?t.position.x+=this.adsorptionDistance.distanceRight-r.x/2:"adsorptionTop"===e?t.position.y+=this.adsorptionDistance.distanceTop-r.y/2:"adsorptionBottom"===e?t.position.y-=this.adsorptionDistance.distanceBottom-r.y/2:"adsorptionForward"===e?t.position.z+=this.adsorptionDistance.distanceForward-r.z/2:"adsorptionBack"===e&&(t.position.z-=this.adsorptionDistance.distanceBack-r.z/2),this.adsorptionModel(e)}}},{key:"getModelCenter",value:function(e){var t;t="string"==typeof e?this.getNodeByName(e)||this.bustard.core.getMeshByName(e):e;var n=this.bustard.core.getCenterAndSize(t);return{boxCenter:n.center,boxSize:n.size}}},{key:"getModelRayPosition",value:function(e,t,n,r){var i=[],a=[],o=99;return"top"===n?(i=this.bustard.core.getFirstIntersectionObjectByPositions(e,{x:e.x,y:e.y+t.y/2,z:e.z},t.y/2+r),a.push(this.getDistanceForRay(i,t.y/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x+t.x/2,y:e.y,z:e.z},{x:e.x+t.x/2,y:e.y+t.y/2,z:e.z},t.y/2+r),a.push(this.getDistanceForRay(i,t.y/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x-t.x/2,y:e.y,z:e.z},{x:e.x-t.x/2,y:e.y+t.y/2,z:e.z},t.y/2+r),a.push(this.getDistanceForRay(i,t.y/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y,z:e.z+t.x/2},{x:e.x,y:e.y+t.y/2,z:e.z+t.x/2},t.y/2+r),a.push(this.getDistanceForRay(i,t.y/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y,z:e.z-t.x/2},{x:e.x,y:e.y+t.y/2,z:e.z-t.x/2},t.y/2+r),a.push(this.getDistanceForRay(i,t.y/2,r)),o=a.reduce((function(e,t){return Math.min(e||99,t||99)}))):"bottom"===n?(i=this.bustard.core.getFirstIntersectionObjectByPositions(e,{x:e.x,y:e.y-t.y/2,z:e.z},t.y/2+r),a.push(this.getDistanceForRay(i,t.y/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x+t.x/2,y:e.y,z:e.z},{x:e.x+t.x/2,y:e.y-t.y/2,z:e.z},t.y/2+r),a.push(this.getDistanceForRay(i,t.y/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x-t.x/2,y:e.y,z:e.z},{x:e.x-t.x/2,y:e.y-t.y/2,z:e.z},t.y/2+r),a.push(this.getDistanceForRay(i,t.y/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y,z:e.z+t.x/2},{x:e.x,y:e.y-t.y/2,z:e.z+t.x/2},t.y/2+r),a.push(this.getDistanceForRay(i,t.y/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y,z:e.z-t.x/2},{x:e.x,y:e.y-t.y/2,z:e.z-t.x/2},t.y/2+r),a.push(this.getDistanceForRay(i,t.y/2,r)),o=a.reduce((function(e,t){return Math.min(e||99,t||99)}))):"left"===n?(i=this.bustard.core.getFirstIntersectionObjectByPositions(e,{x:e.x-t.x/2,y:e.y,z:e.z},t.x/2+r),a.push(this.getDistanceForRay(i,t.x/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y+t.y/2,z:e.z},{x:e.x-t.x/2,y:e.y+t.y/2,z:e.z},t.x/2+r),a.push(this.getDistanceForRay(i,t.x/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y-t.y/2,z:e.z},{x:e.x-t.x/2,y:e.y-t.y/2,z:e.z},t.x/2+r),a.push(this.getDistanceForRay(i,t.x/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y,z:e.z+t.z/2},{x:e.x-t.x/2,y:e.y,z:e.z+t.z/2},t.x/2+r),a.push(this.getDistanceForRay(i,t.x/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y,z:e.z-t.z/2},{x:e.x-t.x/2,y:e.y,z:e.z-t.z/2},t.x/2+r),a.push(this.getDistanceForRay(i,t.x/2,r)),o=a.reduce((function(e,t){return Math.min(e||99,t||99)}))):"right"===n?(i=this.bustard.core.getFirstIntersectionObjectByPositions(e,{x:e.x+t.x/2,y:e.y,z:e.z},t.x/2+r),a.push(this.getDistanceForRay(i,t.x/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y+t.y/2,z:e.z},{x:e.x+t.x/2,y:e.y+t.y/2,z:e.z},t.x/2+r),a.push(this.getDistanceForRay(i,t.x/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y-t.y/2,z:e.z},{x:e.x+t.x/2,y:e.y-t.y/2,z:e.z},t.x/2+r),a.push(this.getDistanceForRay(i,t.x/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y,z:e.z+t.z/2},{x:e.x+t.x/2,y:e.y,z:e.z+t.z/2},t.x/2+r),a.push(this.getDistanceForRay(i,t.x/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y,z:e.z-t.z/2},{x:e.x+t.x/2,y:e.y,z:e.z-t.z/2},t.x/2+r),a.push(this.getDistanceForRay(i,t.x/2,r)),o=a.reduce((function(e,t){return Math.min(e||99,t||99)}))):"forward"===n?(i=this.bustard.core.getFirstIntersectionObjectByPositions(e,{x:e.x,y:e.y,z:e.z+t.z/2},t.z/2+r),a.push(this.getDistanceForRay(i,t.z/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x+t.x/2,y:e.y,z:e.z},{x:e.x+t.x/2,y:e.y,z:e.z+t.z/2},t.z/2+r),a.push(this.getDistanceForRay(i,t.z/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x-t.x/2,y:e.y,z:e.z},{x:e.x-t.x/2,y:e.y,z:e.z+t.z/2},t.z/2+r),a.push(this.getDistanceForRay(i,t.z/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y+t.y/2,z:e.z},{x:e.x,y:e.y+t.y/2,z:e.z+t.z/2},t.z/2+r),a.push(this.getDistanceForRay(i,t.z/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y-t.y/2,z:e.z},{x:e.x,y:e.y-t.y/2,z:e.z+t.z/2},t.z/2+r),a.push(this.getDistanceForRay(i,t.z/2,r)),o=a.reduce((function(e,t){return Math.min(e||99,t||99)}))):"back"===n&&(i=this.bustard.core.getFirstIntersectionObjectByPositions(e,{x:e.x,y:e.y,z:e.z-t.z/2},t.z/2+r),a.push(this.getDistanceForRay(i,t.z/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x+t.x/2,y:e.y,z:e.z},{x:e.x+t.x/2,y:e.y,z:e.z-t.z/2},t.z/2+r),a.push(this.getDistanceForRay(i,t.z/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x-t.x/2,y:e.y,z:e.z},{x:e.x-t.x/2,y:e.y,z:e.z-t.z/2},t.z/2+r),a.push(this.getDistanceForRay(i,t.z/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y+t.y/2,z:e.z},{x:e.x,y:e.y+t.y/2,z:e.z-t.z/2},t.z/2+r),a.push(this.getDistanceForRay(i,t.z/2,r)),i=this.bustard.core.getFirstIntersectionObjectByPositions({x:e.x,y:e.y-t.y/2,z:e.z},{x:e.x,y:e.y-t.y/2,z:e.z-t.z/2},t.z/2+r),a.push(this.getDistanceForRay(i,t.z/2,r)),o=a.reduce((function(e,t){return Math.min(e||99,t||99)}))),isNaN(o)?[]:[{distance:o}]}},{key:"getDistanceForRay",value:function(e,t,n){if(e.length)for(var r=0;r<e.length;r++)if(e[r].distance>t&&e[r].distance<t+n)return e[r].distance;return 99}},{key:"addLabel",value:function(e,t,n,r,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:5;this.setCSS2DRenderState(!0),r?(this.label.addCSS2DLabel(e,t,{x:n.x,y:n.y,z:n.z},i),this.mark.addFatLine(r,a,o,i)):this.label.addCSS2DLabel(e,t,n,i),this.renderTool.setNeedUpdate()}},{key:"updateLabel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.label.labelMap.get(e);if(n){var r=t.position,i=t.visible,a=t.element;r&&n.position.set(r.x,r.y,r.z),void 0!==i&&(n.visible=i),a&&(n.element.remove(),n.element=a),this.renderTool.setNeedUpdate()}}},{key:"getLabel",value:function(e){return this.label.labelMap.get(e)}},{key:"addLabelByNodeName",value:function(e,t,n,r,i){this.setCSS2DRenderState(!0);var a=this.getNodeByName(n,!1)||this.bustard.core.getMeshByName(n);if(a){var o=this.bustard.core.getObject3dPosition(a);this.addLabel(e,t,o,r,i)}}},{key:"addLabelToObject",value:function(e,t,n,r,i,a){this.setCSS2DRenderState(!0);var o=this.getNodeByName(n)||this.bustard.core.getMeshByName(n);o&&(this.label.addCSS2DLabelToObject(e,t,o,r,a),i&&this.mark.addLineToObject(i,o))}},{key:"addLabelToModel",value:function(e,t,n,r,i,a){var o=this.loader.modelMap.get(t);o&&(this.setCSS2DRenderState(!0),this.label.addCSS2DLabelToObject(e,n,o,r,a),i&&this.mark.addLineToObject(i,o))}},{key:"setCSS2DRenderState",value:function(e){this.isCSS2DRender!==e&&(this.bustard.core.CSS2DRenderControl(e),this.isCSS2DRender=e)}},{key:"addLabelGlowRing",value:function(e,t){this.glow.addLabelGlowRing("glowRing_"+e,{position:t.position,surfaceSize:t.surfaceSize,color:16777215,surfaceTextureUrl:this.surfaceTextureUrl})}},{key:"add3DLabel",value:function(e,t){this.glow.addLabelGlowRing("glowRing_"+e,{position:t.position,surfaceSize:t.surfaceSize,color:16777215,surfaceTextureUrl:this.surfaceTextureUrl}),this.isGlowRing=!0,this.texture.addLabelPlane("labelPlane_"+e,t.lineWidth,t.lineHeight,t.baseHeight,t.position,{url:this.lineMidUrl,color:t.lineColor?t.lineColor:16777215,baseUrl:this.lineTopUrl}),this.addLabel(e,t.element,{x:t.position.x,y:t.position.y+t.lineHeight+2*t.baseHeight,z:t.position.z},[])}},{key:"add3DMaker1",value:function(e,t){this.glow.addLabelGlowRing("glowRing_"+e,{position:t.position,surfaceSize:t.surfaceSize,color:null!=t&&t.ringColor?t.ringColor:16777215,surfaceTextureUrl:this.surfaceTextureUrl}),this.isGlowRing=!0,t.modelUrl,this.addPlane("markModel1_"+e,t.iconSize[0],t.iconSize[1],{x:0,y:0,z:0},{x:1,y:1,z:1},{x:t.position.x,y:t.position.y+t.labelHeight/2,z:t.position.z},t.iconPath,{x:1,y:1},30,!1),this.addPlane("markModel2_"+e,t.iconSize[0],t.iconSize[1],{x:0,y:Math.PI/2,z:0},{x:1,y:1,z:1},{x:t.position.x,y:t.position.y+t.labelHeight/2,z:t.position.z},t.iconPath,{x:1,y:1},30,!1),this.addSpriteToScene(e,t.imagePath,{x:t.position.x,y:t.position.y+t.labelHeight+t.imageSize[1]/2,z:t.position.z},t.imageSize),this.sprite.addText("labelText_"+e,t.text,[t.position.x,t.position.y+t.labelHeight+t.imageSize[1]/2,t.position.z],t)}},{key:"add3DMaker2",value:function(e,t){var n,r=this.sprite.addTextPlane("labelText_"+e,t.text,t);t&&t.automaticOrientation&&this.texture.addAutomaticOrientation(r,null!==(n=null==t?void 0:t.axis)&&void 0!==n?n:"z")}},{key:"remove3DMaker",value:function(e){this.glow.removeLabelGlowRing("glowRing_"+e),this.removePlane("markModel1_"+e),this.removePlane("markModel2_"+e),this.sprite.removeSignageByName(e),this.sprite.removeSignageByName("labelText_"+e)}},{key:"clear3DMaker",value:function(){this.glow.emptyLabelGlowRings(),this.removePlane(),this.removeAllSprite()}},{key:"remove3DLabel",value:function(e){this.glow.removeLabelGlowRing("glowRing_"+e),this.texture.removeLabelPlane("labelPlane_"+e),this.label.emptyLabelByName(e)}},{key:"clear3DLabel",value:function(){this.glow.emptyLabelGlowRings(),this.texture.clearLabelPlane(),this.emptyLabel()}},{key:"hide3DLabel",value:function(e){var t=this.glow.labelGlowRingMap.get("glowRing_"+e);t&&(t.visible=!1),this.texture.setLabelPlaneVisible("labelPlane_"+e,!1);var n=this.label.labelMap.get(e);n&&(n.visible=!1)}},{key:"show3DLabel",value:function(e){var t=this.glow.labelGlowRingMap.get("glowRing_"+e);t&&(t.visible=!0),this.texture.setLabelPlaneVisible("labelPlane_"+e,!0);var n=this.label.labelMap.get(e);n&&(n.visible=!0)}},{key:"update3DLabel",value:function(e,t){var n=this.glow.labelGlowRingMap.get("glowRing_"+e);n&&n.material.color.setHex(t.glowColor),t.lineColor&&this.texture.setLabelPlaneColor("labelPlane_"+e,t.lineColor);var r=this.label.labelMap.get(e);r&&t.labelColor&&(r.element.style.backgroundColor=t.labelColor)}},{key:"deleteLabel",value:function(e){this.label.emptyLabelByName(e),this.sprite.removeSignageByName(e)}},{key:"emptyLabel",value:function(e){var t;e?(this.label.emptyLabelByLabelType(e),this.mark.removeLinesByType(e),this.sprite.removeByType(e)):(null===(t=this._spriteLabelManager)||void 0===t||t.removeAllAutoScaleSpriteLabel(),this.setCSS2DRenderState(!1),this.label.emptyLabel(),this.mark.removeAllLine(),this.sprite.removeAllSignage()),this.renderTool.setNeedUpdate()}},{key:"setdefaultLightProperty",value:function(e){this.defaultLightProperty=e,this.light.setdefaultLightProperty(e)}},{key:"addDirectionalLight",value:function(e,t,n,r,i){this.isCustomerDirectionalLight||(this.light.addDirectionalLightForScene(e,t,n,r,i),this.isCustomerDirectionalLight=!0)}},{key:"addLightTemp",value:function(e,t){this.light.addTemplateLight(e,t)}},{key:"addPointLightByTemplate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:1,z:0},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.light.addTemplateLightToScene(e,t,this.templatePointLightType,n)}},{key:"addAreaLight",value:function(e,t,n,r,i,a,o,s,l){return this.light.addAreaLight(e,t,n,r,i,a,o,s,l)}},{key:"updateAreaLight",value:function(e,t){var n=this.light.sceneLights.get(e);n&&(t.color&&n.color.setStyle(t.color),"intensity"in t&&(n.intensity=t.intensity),"width"in t&&(n.width=t.width),"height"in t&&(n.height=t.height),t.position&&n.position.set(t.position.x,t.position.y,t.position.z),t.rotation&&n.rotation.set(t.target.x,t.target.y,t.target.z),"visible"in t&&(n.visible=t.visible),this.renderTool.setNeedUpdate())}},{key:"removeAllPointsLights",value:function(){this.light.removeAllInteriorLights()}},{key:"setSceneLightVisible",value:function(e,t){this.light.sceneLights.get(e).visible=t}},{key:"removeAllSceneLights",value:function(){this.light.removeAllSceneLight()}},{key:"hideAllSceneLights",value:function(){this.light.sceneLights.forEach((function(e,t){e.visible=!1}))}},{key:"setSceneLightsPropertyByType",value:function(e,t,n){this.light.setdefaultLightPropertyByType(e,t,n)}},{key:"setRendererOutputEncoding",value:function(e){this.bustard.core.setRendererOutputEncoding(e)}},{key:"lightAnimation",value:function(e){var t=e.AmbientLight.intensity,n=e.DirectionalLight.intensity;this.ambientLightTween&&this.ambientLightTween.stop(),this.light.defaultAmbientLight.intensity!=t&&(this.ambientLightTween=new c.default.Tween(this.light.defaultAmbientLight).to({intensity:t},1e3).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){})).onComplete((function(e){})).start()),this.directionalLightTween&&this.directionalLightTween.stop(),this.light.defaultDirectionalLight.intensity!=n&&(this.directionalLightTween=new c.default.Tween(this.light.defaultDirectionalLight).to({intensity:n},1e3).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){})).onComplete((function(e){})).start())}},{key:"addRingEffect",value:function(e,t,n,r){var i=this.ringEffect.addRing(e,{color:{value:n}},r);i.position.set(t.x,t.y,t.z),i.rotation.x=-Math.PI/2,this.isRingEffect=!0}},{key:"addNewRingEffect",value:function(e,t,n,r,i,a,o){this.ringEffect.addRing2(e,t,n,r,i,a).renderOrder=o,this.isRingEffect=!0}},{key:"scatterCircle",value:function(e,t,n,r,i,a,o,s){var l=this,u=this.ringEffect.scatterCircle(t,n,r,i,a,o);u.position.set(e.x,e.y,e.z),new c.default.Tween(u.material.uniforms.u_r).to({value:o?t:n},1e3).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){})).onComplete((function(e){l.bustard.core.dispose(u),s&&s()})).start()}},{key:"removeRingEffect",value:function(){this.isRingEffect&&(this.ringEffect.removeRingMeshs(),this.isRingEffect=!1)}},{key:"addRoutPipe",value:function(e,t,n,r){this.mark.addRoutPipe(e,t,n,r),this.isRoutRun||this.setFlow()}},{key:"removeRoutpipe",value:function(){this.isRoutRun&&(this.mark.removeRoutpipe(),this.stopFlow())}},{key:"addEndSprite",value:function(e){for(var t=e.length-1;t>-1;t--)this.sprite.addTemplateSignageByCoord("出口"+(t+1),"出口",{x:this.roadNetNode[e[t]].position.x,y:this.roadNetNode[e[t]].position.y+4,z:this.roadNetNode[e[t]].position.z},[3,2,1])}},{key:"addStartSprite",value:function(e){this.sprite.addTemplateSignageByCoord("所在位置","当前位置",{x:e.x,y:e.y+4,z:e.z},[3,2,1])}},{key:"addFireSprite",value:function(e,t){this.particle.addParticleFire("火情"+e.x+e.z,{x:e.x,y:e.y+.5,z:e.z},t)}},{key:"removeAllParticleFire",value:function(){this.particle.removeAllParticleFire()}},{key:"addSmoke",value:function(e,t,n,r,i){this.bustard.smokeEffect.createSmoke(e,this.smokeImg,t,n,r,i)}},{key:"setFlow",value:function(){this.isRoutRun=!0}},{key:"stopFlow",value:function(){this.isRoutRun=!1}},{key:"initEscapeRoute",value:function(e){var t=this;if(this.roadNetNode=e.roadNetNode,this.routNodeCount=e.roadNetNode.length,!this.isRoutTest){this.isRoutRun?(this.stopFlow(),this.mark.removeRoutpipe(),this.sprite.removeAllSignage(),this.particle.removeAllParticleFire()):this.addSignage();for(var n=1/0,r=0,i=0;i<this.routNodeCount;i++){this.routNet[i]=new Array;for(var a=0;a<this.routNodeCount;a++)this.routNet[i][a]=n;this.routNet[i][i]=r}e.connections.forEach((function(e){t.setDistance(e[0],e[1])})),this.setStart(e.startNode),this.addEndSprite(e.endNodes);for(var o=e.fireNodes.length-1;o>-1;o--)this.addFireNode(e.fireNodes[o]);this.getRoutTest(e.startNode,e.endNodes,e.params)}}},{key:"removeEscapeRoute",value:function(){this.isRoutTest&&(this.stopFlow(),this.mark.removeRoutpipe(),this.sprite.removeAllSignage(),this.particle.removeAllParticleFire(),this.isRoutTest=!1,this.roadNetNode=[],this.routNodeCount=0,this.routNet=new Array,this.fireNodes=[])}},{key:"setDistance",value:function(e,t){var n=this;this.routNet[e][t]=Math.sqrt(Math.pow(n.roadNetNode[e].position.x-n.roadNetNode[t].position.x,2)+Math.pow(n.roadNetNode[e].position.z-n.roadNetNode[t].position.z,2)),this.routNet[t][e]=Math.sqrt(Math.pow(n.roadNetNode[e].position.x-n.roadNetNode[t].position.x,2)+Math.pow(n.roadNetNode[e].position.z-n.roadNetNode[t].position.z,2))}},{key:"getRout",value:function(e,t,n,r,i){var a,o=this.Dijkstra(e,t),s=[];if(r.length>0)for(var l=0;l<r.length;l++)for(var u=0,c=n.length;u<c;u++)r[l]<n[u]&&n[u]--;var h=0;function d(e,t){null!==e[t].pre&&(s.push(e[t].pre),d(e,e[t].pre))}n.forEach((function(e){(0==h||o[e].val<h)&&(h=o[e].val,a=e)})),d(o,a),s.reverse(),s.push(a);for(var p=[],f=0;f<s.length;f++)this.roadNetNode[s[f]].name,p.push(this.roadNetNode[s[f]].position);return this.addRoutPipe(p,!1,i),s}},{key:"Dijkstra",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;function n(e,t){this.val=e,this.pre=t||null}var r=e.length,i=e[0].length;if(r!==i||t>=r)return new Error("邻接矩阵错误或者源点错误");for(var a=new Array(r),o=0;o<r;++o)a[o]=new n(1/0);var s=new Array(r).fill(!1);for(a[t]=new n(0);s.some((function(e){return!e}));){if(s[t]=!0,a[t].val<1/0)for(var l=0;l<i;l++)e[t][l]+a[t].val<a[l].val&&(a[l].val=e[t][l]+a[t].val,a[l].pre+=t);for(var u=-1,c=1/0,h=0;h<r;h++)!s[h]&&a[h].val<c&&(c=a[h].val,u=h);t=u}return a}},{key:"getRoutTest",value:function(e,t,n){if(!this.isRoutTest){if(this.fireNodes.length>0)for(var r=0;r<this.fireNodes.length;r++)this.fireNodes[r]<e&&(e-=1);this.getRout(this.routNet,e,t,this.fireNodes,n),this.isRoutTest=!0}}},{key:"addFireNode",value:function(e){if(!this.isRoutTest){this.addFireSprite(this.roadNetNode[e].position);for(var t=0;t<this.routNet.length;t++)this.routNet[t].splice(e,1);this.routNet.splice(e,1),this.roadNetNode.splice(e,1),this.fireNodes.push(e)}}},{key:"setStart",value:function(e){this.isRoutTest||this.addStartSprite(this.roadNetNode[e].position)}},{key:"addSignage",value:function(){this.sprite.addTemplateSignage("当前位置",this.inSignageUrl),this.sprite.addTemplateSignage("出口",this.outSignageUrl)}},{key:"addSpriteToObject",value:function(e,t,n,r,i,a){var o=this.getNodeByName(t);o||(o=this.bustard.core.getMeshByName(t)),o&&(this.sprite.addTemplateSignage(n,n,a),this.sprite.addTemplateSignageByCoordToObject(e,o,n,r,i))}},{key:"addSpriteToScene",value:function(e,t,n,r,i,a){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return this.addSpriteToScene2({name:e,url:t,position:n,scale:r,sizeAttenuation:i,labelType:a,alwaysOnTop:o})}},{key:"addSpriteToScene2",value:function(e){var t=e.name,n=e.url,r=e.position,i=e.scale,a=e.sizeAttenuation,o=e.labelType,s=e.alwaysOnTop,l=void 0!==s&&s,u=e.touchEnable,c=void 0!==u&&u,h=e.shouldCloneMaterial,d=void 0!==h&&h,p=e.renderOrder,f=e.center;if(n instanceof HTMLCanvasElement)return this.sprite.addSprteByCanvas(t,n,a,r,i,o);var m="".concat(n,"_").concat(a,"_").concat(l);return this.sprite.addTemplateSignage2({name:m,url:n,sizeAttenuation:a,alwaysOnTop:l}),this.sprite.addTemplateSignageByCoord2({name:t,templateSignageName:m,coord:r,scale:i,labelType:o,touchEnable:c,shouldCloneMaterial:d,renderOrder:p,center:f})}},{key:"updateSpriteUrl",value:function(e,t,n,r){var i=this.sprite.signageMap.get(e);if(i){var a=i.material.clone(!1);if(a.sizeAttenuation=!1,t){var o=new Image,s=a.map.clone(!1);o.src=t,s.image=o,s.needsUpdate=!0,a.map=s}n&&i.scale.set(n[0],n[1],n[2]),i.material=a}}},{key:"updateSpriteVisible",value:function(e,t){var n=this.sprite.signageMap.get(e);n&&(n.visible=t)}},{key:"removeSingleSprite",value:function(e){this.sprite.removeSignageByName(e)}},{key:"removeAllSprite",value:function(){this.sprite.removeAllSignage()}},{key:"addPlane",value:function(e,t,n,r,i,a,o,s,l,u){return this.texture.addPlane(e,t,n,r,i,a,o,s,l,!0,u)}},{key:"addPlane2",value:function(e){var t=this,n=e.name,r=e.width,i=e.long,a=e.rotation,o=e.scale,s=e.position,l=e.url,u=e.repeat,c=e.renderOrder,h=e.depthWrite,d=e.pickable,p=void 0===d||d,f=e.params;return new Promise((function(e,d){t.texture.addPlane(n,r,i,a,o,s,l,u,c,h,f,{resolve:e,reject:d})})).then((function(e){p||e.layers.set(0)}))}},{key:"removePlane",value:function(e){e?this.texture.removePlane(e):this.texture.clearPlane()}},{key:"addBallEfffect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16711680,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1;this.ballEffect.addBall(e,t,32,{color:{value:n}},{speed:r,isRunning:!0}),this.isBallEffect=!0}},{key:"removeBallEfffect",value:function(){this.isBallEffect&&(this.ballEffect.removeBallMeshs(),this.isBallEffect=!1)}},{key:"addArrow",value:function(e,t){this.arrowTexture||(this.texture.addFirstRepetitiveTexture(t.leftTextureUrl,t.rightTextureUrl),this.arrowTexture=!0),this.texture.addArrow(e,{direction:t.direction?t.direction:"left",planWidth:t.planWidth?t.planWidth:.4,height:t.height?t.height:.5}),this.isArrow=!0}},{key:"removeAllArrow",value:function(){this.isArrow&&(this.texture.removeAllArrow(),this.isArrow=!1)}},{key:"addRail",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.baseUrl,i=void 0===r?this.baseUrl:r,a=n.moveUrl,o=void 0===a?this.moveUrl:a,s=n.height,l=void 0===s?2:s,u=n.repeatX,h=void 0===u?1:u,d=n.repeatY,p=void 0===d?1:d,f=n.speed,m=void 0===f?.01:f,v={textureBase:{type:"t",value:i},textureMove:{type:"t",value:o},repeat:{type:"f",value:[h,p]}},g=this.railEffect.addRail(e,t,l,v,{speed:m});g.material.depthWrite=!1,new c.default.Tween(g.scale).to({y:1},2e3).easing(c.default.Easing.Linear.None).onStart((function(e){})).onUpdate((function(e){})).onComplete((function(e){})).start(),this.isRailEffect=!0}},{key:"focusRail",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.railEffect.railMeshs.get(e);if(r){var i=this.showPercentageToFocusObject;n&&n.percentage&&(i=n.percentage),n.percentage=i,this.autoRoam.focusingToObjectsByParams([r],n,null!==(t=null==n?void 0:n.callback)&&void 0!==t?t:null)}}},{key:"addRailByModelBox",value:function(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=i.boxSize,o=void 0===a?1.1:a,s=i.scalar,l=void 0===s?{x:0,y:0,z:0}:s;if("x"in l||(l.x=0),"y"in l||(l.y=0),"z"in l||(l.z=0),i.center&&i.size)n=new THREE.Vector3(i.center.x,i.center.y,i.center.z),r=new THREE.Vector3(i.size.x,i.size.y,i.size.z);else{var u=this.getObjectByUniqueTargets(t,!1);if(0===u.length)return;var c=this.bustard.core.bbox3(u);n=c.getCenter(new THREE.Vector3),r=c.getSize(new THREE.Vector3)}r.x=r.x*o,r.z=r.z*o;var h=(new THREE.Box3).setFromCenterAndSize(n,r);h.min.x-=l.x,h.min.z-=l.z,h.max.x+=l.x,h.max.z+=l.z;var d,p,f=h.min,m=h.max,v=[new THREE.Vector3(f.x,f.y,f.z),new THREE.Vector3(m.x,f.y,f.z),new THREE.Vector3(m.x,f.y,m.z),new THREE.Vector3(f.x,f.y,m.z),new THREE.Vector3(f.x,f.y,f.z)];i.aspect&&(i.height=(null!==(d=i.height)&&void 0!==d?d:2)+l.y,i.repeatY=null!==(p=i.repeatY)&&void 0!==p?p:1,i.repeatX=(2*r.x+2*r.z+2*l.x+2*l.z)*i.repeatY/(i.height*i.aspect)),this.addRail(e,v,i)}},{key:"removeRailEffect",value:function(){this.railEffect.removeRailMeshs(),this.isRailEffect=!1}},{key:"addMovingLines",value:function(e,t,n){this.lineEffect.addMeshLines(e,{useMap:!t||!("useMap"in t)||t.useMap,url:t.url,color:t&&"color"in t?t.color:16777215,lineWidth:t.lineWidth?t.lineWidth:.1,opacity:t.opacity?t.opacity:1,speed:t.speed?t.speed:.005,repeat:{x:t.repeat?t.repeat.x:3,y:t.repeat?t.repeat.y:1},renderOrder:t.renderOrder,isRandom:!!t.isRandom},null!=n?n:1),this.isLineEffect=!t||!("isRunning"in t)||t.isRunning}},{key:"addMigrationLine",value:function(e,t,n,r){this.lineEffect.addMigrationLine(e,t,n,{useMap:!r||!("useMap"in r)||r.useMap,url:r.url,color:r&&"color"in r?r.color:16777215,lineWidth:r.lineWidth?r.lineWidth:.1,opacity:r.opacity?r.opacity:1,speed:r.speed?r.speed:.005,repeat:{x:r.repeat?r.repeat.x:3,y:r.repeat?r.repeat.y:1},renderOrder:r.renderOrder,isRandom:!!r.isRandom}),this.isLineEffect=!r||!("isRunning"in r)||r.isRunning}},{key:"removeMovingLines",value:function(){this.removeClipLines(),this.lineEffect.removeLineMeshs(),this.lineEffect2.removeLineMeshs()}},{key:"highLight",value:function(e){var t=this.getNodeByName(e);t||(t=this.bustard.core.getMeshByName(e)),t&&this.outLine.highLight2(t)}},{key:"removeAllHighLight",value:function(){this.outLine.removeAllHighLight()}},{key:"removeAllFlash",value:function(){this.outLine.removeAllFlash()}},{key:"addLineEffect",value:function(){var e=this,t=0;this.roadLinePositions.forEach((function(n){e.bustard.lineEffect2.addPathLine("roadLine"+t,n,e.roadLineParams.url,e.roadLineParams),t++})),this.isLineEffect=!0}},{key:"addSceneRingEffect",value:function(){this.addNewRingEffect(this.defaultRingParams.r,this.defaultRingParams.init,this.defaultRingParams.ring,this.defaultRingParams.color,this.defaultRingParams.speed,this.defaultRingParams.position,this.defaultRingParams.renderOrder)}},{key:"addUpLineEffect",value:function(){this.addMovingLines(this.upLinePositions,this.upLineParams)}},{key:"setColor",value:function(e,t){var n;(n="string"==typeof e?this.getNodeByName(e):e)||(n=this.bustard.core.getMeshByName(e)),n&&this.color.setObject3DColor(n,t)}},{key:"restoreMesh",value:function(e){var t=this.bustard.core.getMeshByName(e);t&&this.color.restoreMesh(t)}},{key:"restoreColor",value:function(){this.color.restore()}},{key:"removeObjectBox",value:function(){this.color.removeObjectBox(),this.loader.modelMap.forEach((function(e){e.userData.colorBox=[]}))}},{key:"addEmissiveMap",value:function(e,t){var n=this,r=this.getNodeByName(e);r||(r=this.bustard.core.getMeshByName(e)),r&&("Mesh"==r.type?n.texture.addEmissiveMapForMesh(r,t,1):r.traverse((function(e){"Mesh"===e.type&&n.texture.addEmissiveMapForMesh(e,t,1)})))}},{key:"openLight",value:function(e,t,n){if(this.floorGlassName&&e in this.floorGlassName&&t in this.floorGlassName[e]){var r=this.floorGlassName[e][t],i=this,a=this.getNodeByName(r);if(a||(a=this.bustard.core.getMeshByName(r)),a){"Mesh"==a.type?i.texture.addEmissiveMapForMesh(a,n,1):a.traverse((function(e){"Mesh"===e.type&&i.texture.addEmissiveMapForMesh(e,n,1)}));var o=this.bustard.core.getCenterAndSize(a),s=o.center,l=o.size.length()/2;this.scatterCircle(s,2*l,l,l,8,16113331,!0)}}}},{key:"closeLight",value:function(e,t){if(this.floorGlassName&&e in this.floorGlassName&&t in this.floorGlassName[e]){var n=this.floorGlassName[e][t],r=this,i=this.getNodeByName(n);if(i||(i=this.bustard.core.getMeshByName(n)),i){var a=this.bustard.core.getCenterAndSize(i),o=a.center,s=a.size.length()/2;this.scatterCircle(o,2*s,s,2*s,8,16113331,!1,(function(){"Mesh"==i.type?r.texture.restoreMaterialByMesh(i):i.traverse((function(e){"Mesh"===e.type&&r.texture.restoreMaterialByMesh(e)}))}))}}}},{key:"openLight1",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(this.floorGlassName&&e in this.floorGlassName&&t in this.floorGlassName[e]){var i=this.floorGlassName[e][t],a=this.getNodeByName(i);if(a||(a=this.bustard.core.getMeshByName(i)),a&&("Mesh"==a.type?(a.userData.isClone||(a.material=a.material.clone(),a.userData.isClone=!0),a.material.emissiveIntensity=1):a.traverse((function(e){"Mesh"===e.type&&(e.userData.isClone||(e.material=e.material.clone(),e.userData.isClone=!0),e.material.emissiveIntensity=1)})),r)){var o=this.bustard.core.getCenterAndSize(a),s=o.center,l=o.size.length()/2;this.scatterCircle(s,2*l,l,l,8,16113331,!0)}}}},{key:"closeLight1",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.floorGlassName&&e in this.floorGlassName&&t in this.floorGlassName[e]){var r=this.floorGlassName[e][t],i=this.getNodeByName(r);if(i||(i=this.bustard.core.getMeshByName(r)),i)if(n){var a=this.bustard.core.getCenterAndSize(i),o=a.center,s=a.size.length()/2;this.scatterCircle(o,2*s,s,2*s,8,16113331,!1,(function(){"Mesh"==i.type?(i.userData.isClone||(i.material=i.material.clone(),i.userData.isClone=!0),i.material.emissiveIntensity=0):i.traverse((function(e){"Mesh"===e.type&&(e.userData.isClone||(e.material=e.material.clone(),e.userData.isClone=!0),e.material.emissiveIntensity=0)}))}))}else"Mesh"==i.type?(i.userData.isClone||(i.material=i.material.clone(),i.userData.isClone=!0),i.material.emissiveIntensity=0):i.traverse((function(e){"Mesh"===e.type&&(e.userData.isClone||(e.material=e.material.clone(),e.userData.isClone=!0),e.material.emissiveIntensity=0)}))}}},{key:"restoreMaterialByName",value:function(e){var t=this,n=this.getNodeByName(e);n||(n=this.bustard.core.getMeshByName(e)),n&&("Mesh"==n.type?t.texture.restoreMaterialByMesh(n):n.traverse((function(e){"Mesh"===e.type&&t.texture.restoreMaterialByMesh(e)})))}},{key:"restoreMaterial",value:function(){this.texture.restoreMaterial()}},{key:"addEmissiveBox",value:function(e,t,n,r,i){var a=this,o=this.texture.addEmissiveBox(e,t,n,r);new c.default.Tween(o.object.scale).to({y:1},1e3).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){})).onComplete((function(e){})).start(),new c.default.Tween(o.texture.offset).to({y:-3},3e3).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){})).onComplete((function(e){new c.default.Tween(o.object.scale).to({y:0},1e3).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){})).onComplete((function(e){a.bustard.core.removeObject(o.object),i&&i()})).start()})).start()}},{key:"addMovingModel",value:function(e,t,n){var r=this;this.loader.addCustomModel(e,t).then((function(e){new c.default.Tween(e.object.scale).to({y:1},1e3).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){})).onComplete((function(e){})).start(),new c.default.Tween(e.texture.offset).to({y:3},3e3).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){})).onComplete((function(t){new c.default.Tween(e.object.scale).to({y:0},1e3).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){})).onComplete((function(t){r.bustard.core.removeObject(e.object),n&&n()})).start()})).start()}))}},{key:"addCustomLines2",value:function(e,t,n){var r=this.addClipLines(n,{url:e,lineWidth:1,opacity:2,repeat:{x:1,y:1},isRunning:!0,speed:0,renderOrder:30},3),i=this.addClipLines(t,{useMap:!1,lineWidth:1.5,lineHeight:0,opacity:10,color:15658496,repeat:{x:40,y:1},isRunning:!0,speed:-.001,renderOrder:31},3);this.lineTween||(this.lineTween=new c.default.Tween({v:0}).to({v:1},1e4).easing(c.default.Easing.Linear.None).onStart((function(e){})).onUpdate((function(e){if(i.children.forEach((function(t){t.material.uniforms.lineHeight.value=86*e.v})),1==e.v)setTimeout((function(){r.children.forEach((function(e){e.material.uniforms.opacity.value=2}))}),500);else if(0==(e.v%.05).toFixed(2)){var t=Number.parseInt(e.v.toFixed(2)/.05);t<=15?(r.children[6*t].material.uniforms.opacity.value=10,r.children[6*t+1].material.uniforms.opacity.value=10,r.children[6*t+2].material.uniforms.opacity.value=10,r.children[6*t+3].material.uniforms.opacity.value=10,r.children[6*t+4].material.uniforms.opacity.value=10,r.children[6*t+5].material.uniforms.opacity.value=10):(r.children[15+5*t+1].material.uniforms.opacity.value=10,r.children[15+5*t+2].material.uniforms.opacity.value=10,r.children[15+5*t+3].material.uniforms.opacity.value=10,r.children[15+5*t+4].material.uniforms.opacity.value=10,r.children[15+5*t+5].material.uniforms.opacity.value=10)}})).onComplete((function(e){})).start().repeat(1/0).delay(500))}},{key:"addClipLines",value:function(e,t,n){var r=this.lineEffect.addClipMeshLine(e,{useMap:!t||!("useMap"in t)||t.useMap,url:t.url,color:t&&"color"in t?t.color:16777215,lineWidth:t.lineWidth?t.lineWidth:.1,lineHeight:t&&"lineHeight"in t?t.lineHeight:1/0,highHeight:t&&"highHeight"in t?t.highHeight:-1/0,opacity:t.opacity?t.opacity:1,speed:"speed"in t?t.speed:.005,repeat:{x:t.repeat?t.repeat.x:3,y:t.repeat?t.repeat.y:1},renderOrder:t.renderOrder,isRandom:!!t.isRandom,isRunning:t.isRunning},null!=n?n:1);return this.isLineEffect=!t||!("isRunning"in t)||t.isRunning,r}},{key:"removeClipLines",value:function(){this.lineTween&&(c.default.remove(this.lineTween),this.lineTween=null)}},{key:"addEmissiveCylinder",value:function(e,t,n,r,i){var a=this,o=this.texture.addEmissiveCylinder(e,t,n,r);new c.default.Tween(o.scale).to({y:1},1e3).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){})).onComplete((function(e){a.bustard.core.removeObject(o),i&&i()})).start()}},{key:"addEmissiveRing",value:function(e,t){var n=this.texture.addEmissiveRing(e,t);new c.default.Tween({value:0}).to({value:1},1e3).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){n.scale.x=e.value,n.scale.y=e.value,n.material.opacity=e.value})).onComplete((function(e){})).start()}},{key:"hideMap",value:function(e){var t=[],n=this.getSceneByName(e);null!=n&&this.bustard.core.traverseNodes(n,(function(e){"Mesh"==e.type&&("count"in e||(e.material=e.material.clone(),e.material.userData.hex=e.material.color.getHex()),-1==t.indexOf(e.material.uuid)&&(t.push(e.material.uuid),e.material.userData.map=e.material.map,e.material.userData.opacity=e.material.opacity,e.material.userData.transparent=e.material.transparent,e.material.map=null,e.material.transparent=!0,e.material.opacity=.6,e.material.needsUpdate=!0))}))}},{key:"restoreMap",value:function(e){var t=this.getSceneByName(e);null!=t&&this.bustard.core.traverseNodes(t,(function(e){"Mesh"==e.type&&(e.material.map=e.material.userData.map,e.material.transparent=e.material.userData.transparent,e.material.opacity=e.material.userData.opacity,e.material.needsUpdate=!0)}))}},{key:"selectGroup",value:function(e,t){var n=this;this.bustard.core.getNodeByName(e,!1).traverse((function(e){"instancedMeshes"in e.userData&&e.userData.instancedMeshes.forEach((function(e){var r=e.mesh,i=e.id,a=n.color.getColor(t);r.geometry.attributes.instanceColor.setXYZ(i,a.r,a.g,a.b),r.geometry.attributes.instanceColor.needsUpdate=!0})),"Mesh"==e.type&&e.material.color.setHex(t)}))}},{key:"restoreGroup",value:function(e){var t=this.getSceneByName(e);null!=t&&t.traverse((function(e){"instancedMeshes"in e.userData&&e.userData.instancedMeshes.forEach((function(e){var t=e.mesh,n=e.id;t.geometry.attributes.instanceColor.setXYZ(n,1,1,1),t.geometry.attributes.instanceColor.needsUpdate=!0})),"Mesh"!=e.type||"count"in e||e.material.color.setHex(e.material.userData.hex)}))}},{key:"hideObject",value:function(e){var t=this.getNodeByName(e);t||(t=this.bustard.core.getMeshByName(e)),t&&this.modelHide.hide(t)}},{key:"restoreHideObjects",value:function(){var e=this;this.modelHide.restore(),this.hideObjects.forEach((function(t,n){e.bustard.core.showObject3D(t,!1)})),this.hideObjects=new Map}},{key:"transparentObject",value:function(e){var t=this.getNodeByName(e);t||(t=this.bustard.core.getMeshByName(e)),t&&this.transparent.transparentObject(t)}},{key:"restoreTransparentObjects",value:function(){this.transparent.restore()}},{key:"modelPositionAnimation",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,r=arguments.length>3?arguments[3]:void 0;e.userData.tween&&(e.userData.tween.stop(),e.userData.tween=null);var i=new c.default.Tween(e.position).to(t,n).easing(c.default.Easing.Cubic.InOut).onStart((function(t){e.userData.tween=i})).onComplete((function(t){e.userData.tween=null,r&&r()})).start()}},{key:"modelMoveAnimation",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,i=(Math.sqrt(Math.pow(t.x-e.position.x,2)+Math.pow(t.y-e.position.y,2)+Math.pow(t.z-e.position.z,2))/n*1e3).toFixed(2);new c.default.Tween(e.position).to(t,i).onComplete((function(e){r&&r()})).start()}},{key:"textureAnimation",value:function(e,t,n,r,i){var a=this.getNodeByName(e)||this.bustard.core.getMeshByName(e),o=(0,l.default)((0,l.default)({},t,n),"x"===t?"y":"x",0);new c.default.Tween(a.material.map.offset).to(o,r).repeat(1/0).onComplete((function(e){i&&i()})).start()}},{key:"modelScaleAnimation",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,r=arguments.length>3?arguments[3]:void 0,i=this;new c.default.Tween(e.scale).to(t,n).onUpdate((function(e){i.bustard.core.renderer.shadowMap.needsUpdate=!0})).onComplete((function(e){r&&r()})).start()}},{key:"hideProvinceMapModel",value:function(e,t,n,r){var i,a=this;this.bustard.core.scene.children.forEach((function(t){t.name==e&&(i=t)}));var o=0;i.children.forEach((function(e,n){"Object3D"==e.type&&(e.name==t?e.visible=!1:(e.children.forEach((function(t){t.layers.disable(5),t.name==e.name+"外轮廓线"||t.name==e.name+"内轮廓线"?a.color.setObject3DColor(t,3890311):t.name==e.name+"面"?a.color.setObject3DColor(t,134675):t.name==e.name+"底面"&&(t.renderOrder=1.5)})),a.modelScaleAnimation(e,{x:1,y:1,z:.1},500,(function(){1==++o&&r&&r()}))))}))}},{key:"setMapModelVisible",value:function(e,t){var n;this.bustard.core.scene.children.forEach((function(t){t.name==e&&(n=t)})),n.visible=t}},{key:"hideDistrictMapModel",value:function(e,t,n,r){var i,a=this;this.bustard.core.scene.children.forEach((function(t){t.name==e&&(i=t)})),i.children.forEach((function(e,n){"Object3D"==e.type&&(e.name!=t&&e.children.forEach((function(t){t.layers.disable(5),t.name==e.name+"外轮廓线"||t.name==e.name+"内轮廓线"?(a.color.setObject3DColor(t,3890311),t.renderOrder=1.68):t.name==e.name+"面"?(a.color.setObject3DColor(t,134675),t.renderOrder=1.66):t.name==e.name+"底面"?t.renderOrder=1.5:t.name==e.name+"内立面"||t.name==e.name+"背立面"||t.name==e.name+"外立面"?t.renderOrder=1.62:t.name==e.name+"外立面高亮"&&(t.renderOrder=1.64)})),a.modelScaleAnimation(e,{x:1,y:1,z:e.name!=t?.2:.5},e.name!=t?500:0,(function(){0==n&&r&&r()})))}))}},{key:"setCameraNearFar",value:function(e,t){this.bustard.core.camera.near=e,this.bustard.core.camera.far=t,this.bustard.core.camera.updateProjectionMatrix(),this.renderTool.setNeedUpdate()}},{key:"setCameraFov",value:function(e){this.bustard.core.camera.fov=e,this.bustard.core.camera.updateProjectionMatrix(),this.renderTool.setNeedUpdate()}},{key:"showMapModel",value:function(e,t){var n,r=this;this.bustard.core.scene.children.forEach((function(t){t.name==e&&(n=t)})),n.children.forEach((function(e,n){"Object3D"==e.type?(e.children.forEach((function(t){t.layers.enable(5),r.color.restoreMesh(t),r.transparent.restoreObject(t),t.name==e.name+"外轮廓线"||t.name==e.name+"内轮廓线"?t.renderOrder=2.1:t.name==e.name+"面"?t.renderOrder=2:t.name==e.name+"底面"?t.renderOrder=1.7:t.name==e.name+"内立面"||t.name==e.name+"背立面"||t.name==e.name+"外立面"?t.renderOrder=1.8:t.name==e.name+"外立面高亮"&&(t.renderOrder=1.9)})),e.visible=!0,r.modelScaleAnimation(e,{x:1,y:1,z:1},500,(function(){0==n&&t&&t()}))):e.visible=!1}))}},{key:"hideDistrictMapModel2",value:function(e,t,n){var r,i=this;this.bustard.core.scene.children.forEach((function(t){t.name==e&&(r=t)})),r.children.forEach((function(e,r){"Object3D"==e.type&&(e.name!=t?e.children.forEach((function(t){t.name==e.name+"外轮廓线"||t.name==e.name+"内轮廓线"?(i.color.setObject3DColor3(t,4229537,.5),t.renderOrder=1.68):t.name==e.name+"面"?(i.transparent.opacity=.5,i.transparent.transparentObject(t),t.renderOrder=1.66):t.name==e.name+"底面"?t.renderOrder=1.5:t.name==e.name+"内立面"||t.name==e.name+"背立面"||t.name==e.name+"外立面"?t.renderOrder=1.62:t.name==e.name+"外立面高亮"&&(t.renderOrder=1.64)})):e.children.forEach((function(t){t.name==e.name+"外轮廓线"||t.name==e.name+"内轮廓线"?(i.color.setObject3DColor3(t,3390652,1),t.renderOrder=2.1):t.name==e.name+"面"?(i.transparent.restoreObject(t),t.renderOrder=2):t.name==e.name+"底面"?t.renderOrder=1.7:t.name==e.name+"内立面"||t.name==e.name+"背立面"||t.name==e.name+"外立面"?t.renderOrder=1.8:t.name==e.name+"外立面高亮"&&(t.renderOrder=1.9)})),i.modelScaleAnimation(e,{x:1,y:1,z:e.name!=t?.2:.5},e.name!=t?500:0,(function(){0==r&&n&&n()})))}))}},{key:"pathMoveObject2",value:function(e,t,n,r){var i,a=this.loader.modelMap.get(e);if(a&&(t.indexOf("/")>-1?i=this.bustard.core.getModelNodeByPathNames(a,t):(i=this.bustard.core.getModelNodeByName(a,t))||(i=this.bustard.core.getModelMeshByName(a,t))),i){i.userData.moveTween&&(i.userData.moveTween.stop(),i.userData.moveTween=null),null==r?void 0:r.openFollowView;for(var o=(r&&"followViewDistance"in r?r.followViewDistance:5),s=(r&&"followViewAngle"in r?r.followViewAngle:45),l=[],u=0;u<n.length;u++){var c=r&&"speed"in r?r.speed:50;0==u&&(c=0);var h=i.position.distanceTo(n[u].position),d=i.position.clone().applyMatrix4(i.parent.matrixWorld);u>0&&(h=new THREE.Vector3(n[u-1].position.x,n[u-1].position.y,n[u-1].position.z).distanceTo(n[u].position),d=new THREE.Vector3(n[u-1].position.x,n[u-1].position.y,n[u-1].position.z).applyMatrix4(i.parent.matrixWorld));var p=new THREE.Vector3(n[u].position.x,n[u].position.y,n[u].position.z).applyMatrix4(i.parent.matrixWorld),f=d.distanceTo(p),m={x:d.x+(d.x-p.x)*o*Math.cos(s)/f,y:d.y+o*Math.sin(s),z:d.z+(d.z-p.z)*o*Math.cos(s)/f,target:d,time:h*c};m.y=Math.round(1e3*m.y)/1e3,m.target.y=Math.round(1e3*m.target.y)/1e3;var v={x:p.x+(d.x-p.x)*o*Math.cos(s)/f,y:p.y+o*Math.sin(s),z:p.z+(d.z-p.z)*o*Math.cos(s)/f,target:p,time:0};v.y=Math.round(1e3*v.y)/1e3,v.target.y=Math.round(1e3*v.target.y)/1e3,u==n.length-1?l.push(m,v):l.push(m)}this.addRoamByList(l),this.startRoam((function(){})),this.moveObjectChain(e,t,n,r,0)}}},{key:"pathMoveObject",value:function(e,t,n,r,i){var a=[],o=n.length;if(!(o<2)){for(var s=0;s<o;s++)if(s>0&&s<o-1){var l={position:n[s]},u={position:{x:n[s].x,y:n[s].y,z:n[s].z}},c=n[s-1],h=n[s],d=Math.atan2(h.x-c.x,h.z-c.z);l.rotation={x:0,y:d,z:0},a.push(l);var p=n[s],f=n[s+1],m=Math.atan2(f.x-p.x,f.z-p.z);u.rotation={x:0,y:m,z:0},a.push(u)}else if(0==s){var v={position:n[s]},g=n[s],y=n[s+1],x=Math.atan2(y.x-g.x,y.z-g.z);v.rotation={x:0,y:x,z:0},a.push(v)}else if(s==o-1){var b={position:n[s]},M=n[s-1],w=n[s],_=Math.atan2(w.x-M.x,w.z-M.z);b.rotation={x:0,y:_,z:0},a.push(b)}this.moveObjectChain(e,t,a,r,0,i)}}},{key:"moveObjectChain",value:function(e,t,n,r,i,a){var o=this;if(i<n.length){var s=r&&"speed"in r?r.speed:50,l=r&&"rotateSpeed"in r?r.rotateSpeed:60;0==i&&(s=0),this.moveObject2(e,t,n[i],s,l,r,(function(){i++,o.moveObjectChain(e,t,n,r,i,a)}))}else a&&a()}},{key:"moveObject2",value:function(e,t,n,r,i,a,o){var s=this,l=72*Math.PI/180;a&&a.followView&&"polarAngle"in a.followView&&(l=a.followView.polarAngle*Math.PI/180);var u=3;a&&a.followView&&"distance"in a.followView&&(u=a.followView.distance);var h=.9;a&&a.followView&&"height"in a.followView&&(h=a.followView.height);var d,p=this.loader.modelMap.get(e);if(p&&(t.indexOf("/")>-1?d=this.bustard.core.getModelNodeByPathNames(p,t):(d=this.bustard.core.getModelNodeByName(p,t))||(d=this.bustard.core.getModelMeshByName(p,t))),d){d.userData.moveTween&&(d.userData.moveTween.stop(),d.userData.moveTween=null);var f=d.position.distanceTo(n.position);d.rotation.x-n.rotation.x>Math.PI?d.rotation.x-=2*Math.PI:d.rotation.x-n.rotation.x<-Math.PI&&(d.rotation.x+=2*Math.PI),d.rotation.y-n.rotation.y>Math.PI?d.rotation.y-=2*Math.PI:d.rotation.y-n.rotation.y<-Math.PI&&(d.rotation.y+=2*Math.PI),d.rotation.z-n.rotation.z>Math.PI?d.rotation.z-=2*Math.PI:d.rotation.z-n.rotation.z<-Math.PI&&(d.rotation.z+=2*Math.PI);var m=f*r;0!=r&&0==m&&(m=1e3*Math.abs(180*(d.rotation.y-n.rotation.y)/Math.PI)/i);var v=new c.default.Tween({px:d.position.x,py:d.position.y,pz:d.position.z,rx:d.rotation.x,ry:d.rotation.y,rz:d.rotation.z}).to({px:n.position.x,py:n.position.y,pz:n.position.z,rx:n.rotation.x,ry:n.rotation.y,rz:n.rotation.z},m).easing(c.default.Easing.Linear.None).onStart((function(e){d.userData.moveTween=v})).onUpdate((function(e){if(d.position.set(e.px,e.py,e.pz),d.rotation.set(e.rx,e.ry,e.rz),a&&a.followView&&a.followView.open){var t={x:e.px-Math.sin(e.ry)*Math.sin(l)*u,y:e.py+Math.cos(l)*u+h,z:e.pz-Math.cos(e.ry)*Math.sin(l)*u};s.cameraController.setLookAt(t.x,t.y,t.z,e.px,e.py+h,e.pz)}})).onComplete((function(e){d.userData.moveTween=null,o&&o()})).start()}}},{key:"moveObjectByTime",value:function(e,t,n,r,i){var a,o=this.loader.modelMap.get(e);if(o&&(t.indexOf("/")>-1?a=this.bustard.core.getModelNodeByPathNames(o,t):(a=this.bustard.core.getModelNodeByName(o,t))||(a=this.bustard.core.getModelMeshByName(o,t))),a){a.userData.moveTween&&(a.userData.moveTween.stop(),a.userData.moveTween=null),a.position.distanceTo(n.position),a.rotation.x-n.rotation.x>Math.PI?a.rotation.x-=2*Math.PI:a.rotation.x-n.rotation.x<-Math.PI&&(a.rotation.x+=2*Math.PI),a.rotation.y-n.rotation.y>Math.PI?a.rotation.y-=2*Math.PI:a.rotation.y-n.rotation.y<-Math.PI&&(a.rotation.y+=2*Math.PI),a.rotation.z-n.rotation.z>Math.PI?a.rotation.z-=2*Math.PI:a.rotation.z-n.rotation.z<-Math.PI&&(a.rotation.z+=2*Math.PI);var s=new c.default.Tween({px:a.position.x,py:a.position.y,pz:a.position.z,rx:a.rotation.x,ry:a.rotation.y,rz:a.rotation.z}).to({px:n.position.x,py:n.position.y,pz:n.position.z,rx:n.rotation.x,ry:n.rotation.y,rz:n.rotation.z},r).easing(c.default.Easing.Linear.None).onStart((function(e){a.userData.moveTween=s})).onUpdate((function(e){a.position.set(e.px,e.py,e.pz),a.rotation.set(e.rx,e.ry,e.rz)})).onComplete((function(e){a.userData.moveTween=null,i&&i()})).start()}}},{key:"moveObject",value:function(e,t,n,r,i){var a,o=this.loader.modelMap.get(e);if(o&&(t.indexOf("/")>-1?a=this.bustard.core.getModelNodeByPathNames(o,t):(a=this.bustard.core.getModelNodeByName(o,t))||(a=this.bustard.core.getModelMeshByName(o,t))),a){a.userData.moveTween&&(a.userData.moveTween.stop(),a.userData.moveTween=null);var s=a.position.distanceTo(n.position);a.rotation.x-n.rotation.x>Math.PI?a.rotation.x-=2*Math.PI:a.rotation.x-n.rotation.x<-Math.PI&&(a.rotation.x+=2*Math.PI),a.rotation.y-n.rotation.y>Math.PI?a.rotation.y-=2*Math.PI:a.rotation.y-n.rotation.y<-Math.PI&&(a.rotation.y+=2*Math.PI),a.rotation.z-n.rotation.z>Math.PI?a.rotation.z-=2*Math.PI:a.rotation.z-n.rotation.z<-Math.PI&&(a.rotation.z+=2*Math.PI);var l=new c.default.Tween({px:a.position.x,py:a.position.y,pz:a.position.z,rx:a.rotation.x,ry:a.rotation.y,rz:a.rotation.z}).to({px:n.position.x,py:n.position.y,pz:n.position.z,rx:n.rotation.x,ry:n.rotation.y,rz:n.rotation.z},s*r).easing(c.default.Easing.Linear.None).onStart((function(e){a.userData.moveTween=l})).onUpdate((function(e){a.position.set(e.px,e.py,e.pz),a.rotation.set(e.rx,e.ry,e.rz)})).onComplete((function(e){a.userData.moveTween=null,i&&i()})).start()}}},{key:"stopMoveObject",value:function(e,t){this.endRoaming();var n,r=this.loader.modelMap.get(e);r&&(t.indexOf("/")>-1?n=this.bustard.core.getModelNodeByPathNames(r,t):(n=this.bustard.core.getModelNodeByName(r,t))||(n=this.bustard.core.getModelMeshByName(r,t))),n&&n.userData.moveTween&&(n.userData.moveTween.stop(),n.userData.moveTween=null)}},{key:"rotateObjectOnAxis",value:function(e,t,n){var r=this.getNodeByName(e);if(r||(r=this.bustard.core.getMeshByName(e)),r)switch(t){case"x":r.rotateX(n);break;case"y":r.rotateY(n);break;case"z":r.rotateZ(n)}}},{key:"separateModel",value:function(e,t){var n=this,r=this.getNodeByName(e);if(r){var i=this.bustard.core.getObjectBox(r).getCenter();return r.children.forEach((function(e){var r=n.bustard.core.getObjectBox(e).getCenter(),a=n.extentLine(i,r,t),o=a.x,s=a.y,l=a.z;e.userData.oldPosition||(e.userData.oldPosition={x:e.position.x,y:e.position.y,z:e.position.z});var u={x:e.position.x+o,y:e.position.y+s,z:e.position.z+l};e.userData.oldPosition.x.toFixed(6)===e.position.x.toFixed(6)&&e.userData.oldPosition.y.toFixed(6)===e.position.y.toFixed(6)&&e.userData.oldPosition.z.toFixed(6)===e.position.z.toFixed(6)?n.modelPositionAnimation(e,u,3e3):n.modelPositionAnimation(e,e.userData.oldPosition,3e3)})),this.separateModelMap.set(e,r),i}}},{key:"separate2",value:function(e,t,n){var r=this;if(e)if(-1==this.separateModelList.indexOf(e)){if(n){var i=this.bustard.core.getObjectBox(e).getCenter();e.children.forEach((function(e){var n=r.bustard.core.getObjectBox(e).getCenter(),a=r.extentLine(i,n,t),o=a.x,s=a.y,l=a.z;e.userData.oldPosition||(e.userData.oldPosition={x:e.position.x,y:e.position.y,z:e.position.z},e.userData.newPosition={x:e.position.x+o,y:e.position.y+s,z:e.position.z+l});var u={x:e.position.x+o,y:e.position.y+s,z:e.position.z+l};e.userData.oldPosition.x.toFixed(6)===e.position.x.toFixed(6)&&e.userData.oldPosition.y.toFixed(6)===e.position.y.toFixed(6)&&e.userData.oldPosition.z.toFixed(6)===e.position.z.toFixed(6)?r.modelPositionAnimation(e,u,3e3):r.modelPositionAnimation(e,e.userData.oldPosition,3e3)})),this.separateModelList.push(e)}}else n||(e.children.forEach((function(e){r.modelPositionAnimation(e,e.userData.oldPosition,3e3)})),this.separateModelList.splice(this.separateModelList.indexOf(e),1))}},{key:"separate",value:function(e,t){var n=this;if(e)if(-1==this.separateModelList.indexOf(e)){var r=this.bustard.core.getObjectBox(e).getCenter();e.children.forEach((function(e){var i=n.bustard.core.getObjectBox(e).getCenter(),a=n.extentLine(r,i,t),o=a.x,s=a.y,l=a.z;e.userData.oldPosition={x:e.position.x,y:e.position.y,z:e.position.z},e.userData.newPosition={x:e.position.x+o,y:e.position.y+s,z:e.position.z+l},n.modelPositionAnimation(e,e.userData.newPosition,3e3)})),e.userData.isSeparate=!0,this.separateModelList.push(e)}else e.children.forEach((function(t){n.modelPositionAnimation(t,e.userData.isSeparate?t.userData.oldPosition:t.userData.newPosition,3e3)})),e.userData.isSeparate=!e.userData.isSeparate}},{key:"extentLine",value:function(e,t,n){return{x:n*(t.x-e.x),y:n*(t.y-e.y),z:n*(t.z-e.z)}}},{key:"resetSeparateModel",value:function(){var e=this;this.separateModelList.forEach((function(t){t.children.forEach((function(t){e.modelPositionAnimation(t,t.userData.oldPosition,0)}))})),this.separateModelList=[]}},{key:"drawerModel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"forward",n=this.getNodeByName(e)||this.bustard.core.getMeshByName(e),r=this.bustard.core.getObjectBox(n).getSize(new THREE.Vector3);n.userData.drawer||(n.userData.drawer={x:n.position.x,y:n.position.y,z:n.position.z});var i={x:n.position.x,y:n.position.y,z:n.position.z};"top"===t&&(i.y+=r.y),"bottom"===t&&(i.y-=r.y),"forward"===t&&(i.z+=r.z),"back"===t&&(i.z-=r.z),"left"===t&&(i.x-=r.x),"right"===t&&(i.x+=r.x),n.userData.drawer.x.toFixed(6)===n.position.x.toFixed(6)&&n.userData.drawer.y.toFixed(6)===n.position.y.toFixed(6)&&n.userData.drawer.z.toFixed(6)===n.position.z.toFixed(6)?this.modelPositionAnimation(n,i,3e3):this.modelPositionAnimation(n,n.userData.drawer,3e3)}},{key:"rotationModel",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3?arguments[3]:void 0;(n=e.type?e:this.getNodeByName(e)||this.bustard.core.getMeshByName(e))&&new c.default.Tween(n.rotation).to(t,r).onComplete((function(){i&&i()})).start()}},{key:"getEquPosition",value:function(e,t){var n=this.getNodeByName(e.entityLabel);if(n){var r=this.bustard.core.getCenterAndSize(n).center;return{x:r.x,y:r.y,z:r.z}}}},{key:"getNodeByName",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.bustard.core.getNodeByName(e,t)}},{key:"getSceneByName",value:function(e){var t,n=j(this.bustard.core.scene.children);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.name===e)return r}}catch(e){n.e(e)}finally{n.f()}return null}},{key:"removeSceneByName",value:function(e,t,n){var r=this,i=this,a={},o={},s=new Map;e.forEach((function(e){var n=r.scenesMap.get(e);n&&(n.traverse((function(e){if("Mesh"===e.type){if(!r.materialMap.get(e.uuid)){var n,i=s.get(e.material.uuid);if(i)n=i;else{var l=e.material.uuid;n=r.bustard.core._getMeshMaterial(e),s.set(l,n)}r.materialMap.set(e.uuid,{mesh:e,material:n})}var u=r.bustard.core._getMeshMaterial(e);u.transparent=!0,u.depthWrite=!1,a[e.uuid]=u.opacity,o[e.uuid]=t.value}})),(0,R.isInArray)(i.havingTweenDownArray,e)||i.havingTweenDownArray.push(e))})),this.tweenAlphaMap.forEach((function(t,n){for(var i=!1,a=n.split("_"),o=0,s=a.length;o<s;o++)if((0,R.isInArray)(e,a[o])){i=!0;break}i&&(t.stop(),r.tweenAlphaMap.delete(n))})),this.tweenAlphaMap.set(e.join("_"),new c.default.Tween(a).to(o,t&&t.time?t.time:1e3).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){for(var t in e)i.materialMap.get(t).mesh.material.opacity=e[t]})).onComplete((function(r){e.forEach((function(e){var n=i.scenesMap.get(e);null!=n&&(t.value?(n.visible=!0,i.scenesState.set(e,!0)):(n.visible=!1,i.scenesState.set(e,!1)))})),i.bustard.core.renderer.shadowMap.needsUpdate=!0,n&&n()})).start())}},{key:"restroeSceneByName",value:function(e,t,n){var r=this,i=this,a={},o={};try{e.forEach((function(e){if(!(0,R.isInArray)(r.havingTweenDownArray,e))throw new Error("未曾渐变对应，无法恢复");var t=r.scenesMap.get(e);t&&(t.visible=!0,r.scenesState.set(e,!0),t.traverse((function(e){if("Mesh"===e.type){var t=e.material;(0,R.isInArray)(["新大草地","A2区内部路","新地面"],e.name)&&(t.depthWrite=!0),a[e.uuid]=t.opacity;var n=r.materialMap.get(e.uuid).material;o[e.uuid]=n.opacity}})))}))}catch(e){return}this.tweenAlphaMap.forEach((function(t,n){for(var i=!1,a=n.split("_"),o=0,s=a.length;o<s;o++)if((0,R.isInArray)(e,a[o])){i=!0;break}i&&(t.stop(),r.tweenAlphaMap.delete(n))})),this.tweenAlphaMap.set(e.join("_"),new c.default.Tween(a).to(o,t&&t.time?t.time:1e3).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){for(var t in e)i.materialMap.get(t).mesh.material.opacity=e[t]})).onComplete((function(e){for(var t in i.bustard.core.renderer.shadowMap.needsUpdate=!0,e)i.materialMap.get(t).mesh.material=i.materialMap.get(t).material;n&&n()})).start())}},{key:"modelAlphaAnimation",value:function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{value:0,time:1e3};""==t&&(t=null),""==n&&(n=null),"电梯"===e&&(this.isCameraFollow=r),this.restoreColor(),this.transparent.restore();var o=[];this.loadAndParseModels.forEach((function(r){r.sceneName!=e||t&&r.buildingName!=t||n&&r.type!=n||o.push(r.fileName)})),0==o.length?i&&i():r?this.restroeSceneByName(o,a,i):this.removeSceneByName(o,a,i)}},{key:"hideOrShowModels",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{value:0,time:1e3};this.restoreColor(),this.transparent.restore();var i=[];e.forEach((function(e){i.push(e.fileName)})),0==i.length?n&&n():t?this.restroeSceneByName(i,r,n):this.removeSceneByName(i,r,n)}},{key:"addSelectEffect",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=this;n="string"==typeof e?a.getNodeByName(e)||a.bustard.core.getMeshByName(e):e;var o=a.bustard.core.getObjectBox(n),s=o.center,l=o.size;this.selectEffectModels.get(n.uuid)||this.loader.addCustomModel(this.selectEffect).then((function(e){e.object.name="选中效果",e.object.scale.set(l.x*i,l.y*i,l.z*i),e.object.position.set(s.x,s.y,s.z),e.object.traverse((function(e){"Mesh"===e.type&&(e.material.color.setHex(0),e.material.emissive.setHex(t)),"Box003"===e.name&&(e.material.transparent=!0,e.material.opacity=r)})),a.selectEffectModels.set(n.uuid,e.object)}))}},{key:"emptySelectEffect",value:function(){var e=this;this.selectEffectModels.forEach((function(t,n){e.bustard.core.dispose(t)})),this.selectEffectModels=new Map,this.loader.modelMap.forEach((function(e){e.userData.modelBox=[]}))}},{key:"emptySelectEffectById",value:function(e){var t=this.selectEffectModels.get(e);t&&(this.bustard.core.dispose(t),this.selectEffectModels.delete(e))}},{key:"setSelectEffectVisibleById",value:function(e,t){var n=this.selectEffectModels.get(e);n&&(n.visible=t)}},{key:"addHdr",value:function(e,t,n){this.bustard.core.scene.environment&&(this.bustard.core.scene.environment.dispose(),this.bustard.core.scene.environment=null),e&&""!=e?this.loader.RGBELoadByUrl2(e,t,n):this.renderTool.setNeedUpdate()}},{key:"addSceneLight",value:function(){this.lightState||(this.light.addSceneDefaultLights(),this.light.setdefaultLightProperty(this.defaultLightProperty),this.lightState=!0)}},{key:"setColorMap",value:function(e,t,n,r,i){this.color.addLutColorMap(e,t,n,r,i)}},{key:"showRoom",value:function(e,t,n){var r=this.getNodeByName(e);if(r){this.color.setObject3DColor(r,t);var i=this.bustard.core.getCenterAndSize(r),a=i.center,o=i.size.length(),s={x:a.x,y:a.y+o.y/2,z:a.z};this.addLabel(e,n,s)}}},{key:"showRooms",value:function(e){var t=this;this.restoreColor();var n=[];e instanceof Array&&e.forEach((function(e){n.push(e.nodeName),t.showRoom(e.nodeName,e.color,e.element)}));var r=this.getSceneByName("房间");null!=r&&this.bustard.core.traverseNodes(r,(function(e){"Mesh"==e.type&&((0,R.isInArray)(n,e.parent.name)?e.visible=!0:e.visible=!1)}))}},{key:"showEnergy",value:function(e,t){var n=this;this.getSceneByName("透明外壳")&&(t.forEach((function(t){var r=n.energyFloorInfo[t.buildingName][t.floor];if(r){var i=n.bustard.core.getMeshByName(r);i&&(i.material=i.material.clone(),i.material.opacity=e,i.material.emissive=n.color.getLutColor(t.value),i.material.color.setHex(0),i.parent.userData.buildingName=t.buildingName,i.parent.userData.floor=t.floor,i.parent.userData.powerValue=t.value)}})),this.bustard.touchAction=!0,this.pick._isTouch=!0)}},{key:"addEnergyLabel",value:function(e){for(var t in this.energyFloorInfo)for(var n in this.energyFloorInfo[t]){var r=e.cloneNode(!0);r.innerHTML=n+"F",this.addLabel("Energy-"+t+"-"+n,r,{x:this.energyLabelPosition[t].x,y:(this.floorBottomHeight[t][n]+this.floorTopHeight[t][n])/2,z:this.energyLabelPosition[t].z})}}},{key:"hideEnergy",value:function(){var e=this.getSceneByName("能耗");e&&(e.children.forEach((function(e){e.visible=!1})),this.bustard.core.touchTargetObjs=[],this.bustard.core.touchTargetIDs=[],this.pick._isTouch=!1,this.bustard.touchAction=!1,this.bustard.clickAction=!0)}},{key:"moveElevator",value:function(e,t,n){if(!(e in this.elevatorInfo))throw new Error("buildingName传值错误");if(!(n in this.floorBottomHeight[e]))throw new Error("floor传值错误");if(!this.elevatorInfo[e][t])throw new Error("index传值错误");var r=this.floorBottomHeight[e][n]+2;null!=r&&this.moveObject(this.elevatorInfo[e][t],{y:r},this.elevatorSpeed)}},{key:"setElevatorColor",value:function(e,t,n){if(this.restoreColor(),!this.elevatorInfo[e])throw new Error("buildingName传值错误");if(!this.elevatorInfo[e][t])throw new Error("id传值错误");var r=this.elevatorInfo[e][t],i=this.getNodeByName(r);for(var a in i&&(this.color.setObject3DColor(i,n),this.color.setObject3DEmissive(i,n)),this.elevatorMap)if(this.elevatorMap[a]==r){var o=this.getNodeByName(a);o&&(this.color.setObject3DColor(o,n),this.color.setObject3DEmissive(o,n))}}},{key:"addElevatorLabel",value:function(e,t,n,r){if(!this.elevatorInfo[n])throw new Error("buildingName传值错误");if(!this.elevatorInfo[n][r-1])throw new Error("id传值错误");var i=this.getNodeByName(this.elevatorInfo[n][r-1]);this.addCustomLabelToModel(e,t,i,{x:0,y:0,z:20})}},{key:"addTemplateModel",value:function(e,t,n){this.loader.addTemplateModel(e,t).then((function(e){n&&n(e)}))}},{key:"addSignageModelByCoords",value:function(e,t,n,r,i,a,o){var s=this,l=this.loader.addSignageModelByCoord(n,e,t,r,i,a);if(l)return l.traverse((function(e){"Mesh"===e.type&&o&&e.layers.enable(s.pickEnableLayers[0])})),this.bustard.core.renderer.shadowMap.needsUpdate=!0,l}},{key:"add",value:function(e,t,n,r,i,a,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8?arguments[8]:void 0,u=this;this.addTemplateModel(t,t,(function(){var c=u.addSignageModelByCoords(t,e,n,r,i,a,s);o&&c.traverse((function(e){"Mesh"===e.type&&(e.userData.enbaleTouch=!0,u.bustard.core.touchTargetObjs.push(e),u.bustard.core.touchTargetIDs.push(e.uuid))})),l&&l(c)}))}},{key:"initMarks",value:function(e){var t=this;e.forEach((function(e){var n=t.loader.modelMap.get(e.parentRootCode);if(n){var r=t.bustard.core.getModelNodeByPathNames(n,e.parentCode,!1);r&&(r.userData.isTemplate&&"RootNode"==r.children[0].name&&(r=r.children[0]),t.addTemplateModel(e.url,e.url,(function(){t.loader.addMarkToModel(r,e.url,e.code,e.position,e.rotation,e.scale),t.renderTool.setNeedUpdate()})))}}))}},{key:"addSignageModelByCesium",value:function(e,t,n,r,i,a,o,s){var l=this;this.addTemplateModel(e,e,(function(u){if(u){var c=l.loader.addSignageModelByCoord(n,e,t,{x:0,y:0,z:0},a,o);if(!c)return;c.traverse((function(e){"Mesh"===e.type&&e.layers.enable(l.pickEnableLayers[0])}));var h=(new THREE.Vector3).subVectors(n,r).normalize();c.up.copy(h),c.lookAt(r.x,r.y,r.z);var d=(new THREE.Matrix4).makeRotationFromEuler(c.rotation),p=(new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(Math.PI/2,0,0));d.multiply(p);var f=(new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(i.x,i.y,i.z));d.multiply(f),c.rotation.copy((new THREE.Euler).setFromRotationMatrix(d)),c.userData.rotationY=i.y,l.bustard.core.renderer.shadowMap.needsUpdate=!0,s&&s(c)}else s&&s(null)}))}},{key:"addTemplateModelByMatrix",value:function(e,t,n){var r=this;this.addTemplateModel(e,e,(function(i){if(i){var a=r.loader.addTemplateModelByMatrix(e,t);r.showLoading&&(a.visible=!0),a&&(r.bustard.core.renderer.shadowMap.needsUpdate=!0,a.traverse((function(e){"Mesh"===e.type&&(e.layers.enable(r.pickEnableLayers[0]),"外立面"==t[0].type&&0!=e.material.opacity&&(e.material.depthWrite=!0))}))),t.forEach((function(e){"transparency"in e&&e.transparency>=0&&e.transparency<100&&r.performAction([{id:e.name}],"transparent",{opacity:e.transparency/100})})),r.addScenes.push(a)}n&&n()}))}},{key:"addTemplateModelsByCesium",value:function(e,t,n){var r=this;this.addTemplateModel(e,e,(function(i){if(i){var a=r.loader.addTemplateModelsByCesium(e,t);r.bustard.core.renderer.shadowMap.needsUpdate=!0,a.traverse((function(e){"Mesh"===e.type&&(e.layers.enable(r.pickEnableLayers[0]),"外立面"==t[0].type&&0!=e.material.opacity&&(e.material.depthWrite=!0))})),t.forEach((function(e){"transparency"in e&&e.transparency>=0&&e.transparency<100&&r.performAction([{id:e.name}],"transparent",{opacity:e.transparency/100})}))}n&&n()}))}},{key:"removeTemplateModelByType",value:function(e){this.loader.removeTemplateModelByType(e)}},{key:"addParkingCars",value:function(e,t){var n=this;this.removeTemplateModelsByType("car"),e&&t?(this.isAddCars=!0,this.addTemplateModel(e,"car",(function(e){t.forEach((function(e){var t=n.addSignageModelByCoords("car","car"+e.modelId,{x:e.position[0],y:e.position[1],z:e.position[2]},e.rotation);t&&(t.userData.buildingName=e.buildingName,t.userData.floor=e.floor)}))}))):this.isAddCars=!1}},{key:"removeTemplateModelsByType",value:function(e){this.loader.removeSignageModelByType(e)}},{key:"showTemplateModelsByFloor",value:function(e,t){this.bustard.core.scene.children.forEach((function(n){"Object3D"==n.type&&"floor"in n.userData&&(t!=n.userData.floor||n.userData.buildingName&&e!=n.userData.buildingName?n.visible=!1:n.visible=!0)}))}},{key:"addMonitor",value:function(e,t,n,r){var i=this;this.cancelMonitor();var a=this.loader.addSignageModelByCoord({x:t.x,y:this.floorTopHeight[n][r],z:t.z},e,(0,R.uuid)());a.traverse((function(e){"Mesh"===e.type&&e.layers.enable(i.pickEnableLayers[0])})),a.userData.buildingName=n,a.userData.floor=r,this.pickEditAction=null,this.bustard.core.transformControlAttach(a)}},{key:"initMonitors",value:function(e,t){var n=this,r=[];e.forEach((function(e){r.push({name:e.templateId,url:e.templateUrl}),n.modelTemplateUrls[e.templateId]=e.templateUrl})),0!=r.length&&this.loader.addTemplateModels(r).then((function(e){t&&t.forEach((function(e){if(e.templateId in n.modelTemplateUrls){var t=e.modelPosition,r=e.modelRotation,i=e.modelScale,a=n.loader.addSignageModelByCoord({x:Number(t[0]),y:Number(t[1]),z:Number(t[2])},e.templateId,e.modelId);a.rotation.set(Number(r[0]),Number(r[1]),Number(r[2])),a.scale.set(Number(i[0]),Number(i[1]),Number(i[2])),a.traverse((function(e){"Mesh"===e.type&&e.layers.enable(n.pickEnableLayers[0])})),a.userData.buildingName=e.physicalBuildingName,a.userData.floor=e.physicalFloorName}}))}))}},{key:"cancelMonitor",value:function(){this.pickEditAction=null;var e,t=this.bustard.core.transformControls.object;return t&&(e=t.name,this.bustard.core.transformControlDetach(),t.parent.remove(t)),e}},{key:"removePublicModel",value:function(e){this.bustard.core.transformControlDetach(),this.loader.modelMap.get(e)&&object.parent.remove(object)}},{key:"updateModel",value:function(e){var t=this;if(!e.id)return 0;var n=e.id,r=this.loader.modelMap.get(n);if(r){var i,a,o,s,l,u=null!==(i=e.position)&&void 0!==i?i:r.position,c=null!==(a=e.rotation)&&void 0!==a?a:r.rotation,h=null!==(o=e.scale)&&void 0!==o?o:r.scale,d=null!==(s=e.type)&&void 0!==s?s:r.userData.type,p=null!==(l=e.enbaleTouch)&&void 0!==l&&l;"url"in e&&r.userData.templateType!=e.url?(this.loader.removeTemplateModelByName(n),this.add(n,e.url,u,c,h,d,p,!0,e.callback)):(r.position.set(u.x,u.y,u.z),r.rotation.set(c.x,c.y,c.z),"TRAY"==r.userData.type?(r.scale.y=h.y,this.loader.updateTrayScale(r,h)):r.scale.set(h.x,h.y,h.z),r.updateWorldMatrix(!1,!0),r.traverse((function(e){if(p&&"Mesh"===e.type&&(t.bustard.core.touchTargetObjs.push(e),t.bustard.core.touchTargetIDs.push(e.uuid)),!r.userData.isOnly&&"instancedMeshes"in e.userData)for(var n=0;n<e.userData.instancedMeshes.length;n++){var i=e.userData.instancedMeshes[n].mesh,a=e.userData.instancedMeshes[n].id,o=i.userData.parent[a].matrixWorld,s=i.userData.meshMatrix[a],l=o.clone().multiply(s);i.setMatrixAt(a,l),i.instanceMatrix.needsUpdate=!0,i.userData.matrix[a]=l}})),this.renderTool.setNeedUpdate(),e.callback&&e.callback())}}},{key:"controlMonitor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.loader.modelMap.get(e);n&&(t?this.bustard.core.transformControlAttach2(n):this.bustard.core.transformControlAttach(n)),this.outLine.highLightedObjectsMap.size>0&&(this.bustard.core.isComposerRender=!1)}},{key:"cancelControlMonitor",value:function(){this.pickEditAction=null;var e=this.bustard.core.transformControls.object;e&&(e.name,this.bustard.core.transformControlDetach(),this.outLine.highLightedObjectsMap.size>0&&(this.bustard.core.isComposerRender=!0)),this.label.emptyLabelByLabelType("adsorption")}},{key:"saveMonitor",value:function(){var e=this.bustard.core.transformControls.object;if(e){var t=this.roam.curPosition(),n=this.roam.curTarget();return this.bustard.core.transformControlDetach(),{modelId:e.name,templateId:e.userData.type,physicalBuildingName:e.userData.buildingName,physicalFloorName:e.userData.floor,modelPosition:e.position.x+","+e.position.y+","+e.position.z,modelRotation:e.rotation.x+","+e.rotation.y+","+e.rotation.z,modelScale:e.scale.x+","+e.scale.y+","+e.scale.z,modelViewPosition:t.x+","+t.y+","+t.z,modelViewTarget:n.x+","+n.y+","+n.z}}}},{key:"creatProgressBar",value:function(){if(this.haveProgressBar)document.getElementById("fill").style.width="2%";else{this.haveProgressBar=!0;var e=document.createElement("div");e.className="loading",e.id="loading",e.style.cssText="top: 50%;left: 50%;width: 30%;translate:-50% -50%;height: auto;position: absolute;margin: auto;display: block;font-size: 1vw;z-index: 1;text-align: center;color: #FFFFFF;display: none;z-index: 1;",e.textContent="正在加载...";var t=document.createElement("div");t.id="frame",t.style.cssText="border-radius: 50px;position: absolute;width: 100%;height: 0.8vw;border: 0.2vw solid #5197ff;";var n=document.createElement("div");n.id="fill",n.style.cssText="color:white;border-radius: 1vw;position: absolute;text-align: center;width: 2%;height: 100%;background-image: linear-gradient(to right, #1f77bb, #111a26);margin-left: -0.1vw;padding-right: 0.1vw;";var r=document.createElement("div");r.id="fillNode",r.style.cssText="height: 0.8vw;width: 1vw;float: right;background-image: radial-gradient(#FFFFFF, rgba(55,126,233,1));border-radius: 1vw;margin-right: -0.1vw;",e.appendChild(t),t.appendChild(n),n.appendChild(r),this.content.appendChild(e)}}},{key:"getInspectionRoute",value:function(e,t){var n=this,r=[];if(!(e in this.inspectionRoute))throw new Error("buildingName传值错误");if(r=this.inspectionRoute[e],null!=t){if(!(e in this.floorBottomHeight))throw new Error("buildingName传值错误");if(!(t in this.floorBottomHeight[e]))throw new Error("floor传值错误");var i=[];return r.forEach((function(r){r.y>=n.floorBottomHeight[e][t]&&r.y<=n.floorTopHeight[e][t]&&i.push(r)})),this.handleLineData(i)}return this.handleLineData(r)}},{key:"handleLineData",value:function(e){var t=e.length;if(t<2)return e;var n=[];n.push(e[0]);for(var r=1;r<t;r++)e[r].x==e[r-1].x&&e[r].y==e[r-1].y||e[r].x==e[r-1].x&&e[r].z==e[r-1].z?(e[r].x+=.001,n.push(e[r])):e[r].y==e[r-1].y&&e[r].z==e[r-1].z?(e[r].z+=.001,n.push(e[r])):n.push(e[r]);return n}},{key:"clipY",value:function(e){this.selectInClipCars.forEach((function(t){t.clipYSub(Number(e))})),this.selectOutClipCars.forEach((function(t){t.clipYPlus(Number(e))}))}},{key:"hideOrShowUpGroundModels",value:function(e){var t=this;this.loadAndParseModels.forEach((function(n){if("停车场"!=n.sceneName){var r=t.getSceneByName(n.sceneName);r&&r.children.forEach((function(t){t.visible=e}))}}))}},{key:"changeVisibleByScene",value:function(e,t){var n=this;e.forEach((function(e){var r=n.getSceneByName(e);r&&r.children.forEach((function(e){e.visible=t}))}))}},{key:"hideOrShowDownGroundModels",value:function(e){var t=this.getSceneByName("停车场");t&&t.children.forEach((function(t){t.visible=e}))}},{key:"changeClip",value:function(e){var t=this;this.selectInClipCars=[],this.selectOutClipCars=[],this.loadAndParseModels.forEach((function(n){if(!("外立面"!=n.sceneName&&"土建"!=n.sceneName||e&&n.buildingName!=e)){var r=t.outClipCars.get(n.fileName);r&&t.selectOutClipCars.push(r)}}))}},{key:"changeClipByFloor",value:function(e){var t=this;this.selectInClipCars=[],this.selectOutClipCars=[],this.loadAndParseModels.forEach((function(n){if(!("外立面"!=n.sceneName&&"土建"!=n.sceneName&&"设备"!=n.sceneName||e&&n.buildingName!=e)){var r=t.outClipCars.get(n.fileName);r&&t.selectOutClipCars.push(r)}}))}},{key:"changeDownClipByFloor",value:function(e){var t=this;this.selectDownClipCars=[],this.loadAndParseModels.forEach((function(n){if("设备"==n.sceneName&&n.buildingName==e){var r=t.outClipCars.get(n.fileName);r&&t.selectDownClipCars.push(r)}}))}},{key:"startClipTween",value:function(e,t,n,r,i){if(!(e in this.floorTopHeight))throw new Error("buildingName传值错误");if(!(t in this.floorTopHeight[e]))throw new Error("floor传值错误");null!=t&&(this.isFloorClip=!0,this.changeClipByFloor(e),this.endClipY=this.floorTopHeight[e][t],n&&(this.isFloorLight?(this.setCameraPosition(this.floorFocusPosition[e][t].position.x,this.floorFocusPosition[e][t].position.y,this.floorFocusPosition[e][t].position.z,this.floorFocusPosition[e][t].target.x,this.floorFocusPosition[e][t].target.y,this.floorFocusPosition[e][t].target.z),this.isFloorLight=!1):this.lerpLookAt(this.floorFocusPosition[e][t].position,this.floorFocusPosition[e][t].target,1e3,!0,i)));for(var a={},o={},s=0,l=this.selectOutClipCars.length;s<l;s++)a[s]=this.selectOutClipCars[s].clipPlanes[2].constant,o[s]=this.endClipY;var u=this,h=this.endClipY>this.selectOutClipCars[0].clipPlanes[2].constant;h||this.showTemplateModelsByFloor(e,t),new c.default.Tween(a).to(o,0).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){for(var t in e)u.selectOutClipCars[t].clipYPlus(e[t])})).onComplete((function(n){h&&u.showTemplateModelsByFloor(e,t),r&&r()})).start()}},{key:"showFloor",value:function(e,t,n,r,i){this.restoreColor(),this.changeDownClipByFloor(e);var a=this.floorBottomHeight[e][t];this.resetDownClip();var o=this;this.startClipTween(e,t,n,(function(){o.selectDownClipCars.forEach((function(e){e.clipYSub(Number(a))})),r&&r()}),i)}},{key:"showFloorDevice",value:function(e,t,n){this.changeDownClipByFloor(e);var r=this.floorBottomHeight[e][t];this.resetDownClip();var i=this;this.showFloor(e,t,!0,(function(){i.selectDownClipCars.forEach((function(e){e.clipYSub(Number(r))})),n&&n()}))}},{key:"showGlobelLight",value:function(e,t){var n=this;this.restoreColor(),this.transparent.restore(),e&&e.forEach((function(e){var t=n.getNodeByName(n.wireframeModelFloorInfo[e.buildingName][e.floor]);t||(t=n.bustard.core.getMeshByName(n.wireframeModelFloorInfo[e.buildingName][e.floor])),t&&(n.transparent.transparent(t,.1),n.color.setObject3DColor(t,16776960),n.color.setObject3DEmissive(t,16776960))}))}},{key:"showFloorLight",value:function(e,t,n){var r=this;this.hideAllSceneLights(),this.changeDownClipByFloor(e);var i=this.floorBottomHeight[e][t];this.resetDownClip(),this.modelAlphaAnimation("地形","","地面",!1,(function(){r.isNight=!0}),{value:.1,time:1e3}),this.modelAlphaAnimation("地形","","配楼",!1),this.modelAlphaAnimation("地形","","植物",!1),this.showFloor(e,t,!0,null,(function(){r.selectDownClipCars.forEach((function(e){e.clipYSub(Number(i))})),n&&n()}))}},{key:"addAllFloorLights",value:function(e){for(var t in e)for(var n in e[t])for(var r in e[t][n])for(var i=e[t][n][r].lights.length,a=0;a<i;a++){var o=this.addAreaLight(t+"_"+n+"_"+r+"_"+a,this.areaLightConfig.color,this.areaLightConfig.intensity,e[t][n][r].lights[a].width,e[t][n][r].lights[a].height,e[t][n][r].lights[a].position,{x:this.areaLightConfig.rotation[0],y:this.areaLightConfig.rotation[1],z:this.areaLightConfig.rotation[2]},!1,!1);o.userData.buildingName=t,o.userData.floor=n,o.userData.room=r}}},{key:"resetFloorLights",value:function(e,t,n){if(!n[e])throw new Error("buildingName传值错误");if(!n[e][t])throw new Error("floor传值错误");for(var r in n[e][t])for(var i=n[e][t][r].lights.length,a=0;a<i;a++)this.setSceneLightVisible(e+"_"+t+"_"+r+"_"+a,n[e][t][r].open)}},{key:"controllerRoomLight",value:function(e,t,n,r,i){if(!r[e])throw new Error("buildingName传值错误");if(!r[e][t])throw new Error("floor传值错误");if(""!=n){if(!r[e][t][n])throw new Error("room传值错误");for(var a=r[e][t][n].lights.length,o=0;o<a;o++)this.setSceneLightVisible(e+"_"+t+"_"+n+"_"+o,i)}else for(var s in r[e][t])for(var l=r[e][t][s].lights.length,u=0;u<l;u++)this.setSceneLightVisible(e+"_"+t+"_"+s+"_"+u,i)}},{key:"resetDownClip",value:function(){this.selectDownClipCars.forEach((function(e){e.clipYSub(e.minClipY)}))}},{key:"removeAllEffect",value:function(){this.restoreColor(),this.removeObjectBox(),this.emptySelectEffect(),this.restoreHideObjects(),this.restoreTransparentObjects(),this.restoreMaterial(),this.emptyLabel(),this.hideEnergy(),this.showGlobelLight(),this.removeRoutpipe(),this.removeRingEffect(),this.removeBallEfffect(),this.removeAllArrow(),this.removeRailEffect(),this.removeMovingLines(),this.removeEscapeRoute()}},{key:"endClipTween",value:function(e){var t=this;this.isFloorClip?(this.changeClipByFloor(),this.isFloorClip=!1):this.changeClip(),this.showTemplateModelsByFloor(),this.isNight&&(this.isNight=!1);for(var n={},r={},i=0,a=this.selectOutClipCars.length;i<a;i++)n[i]=this.selectOutClipCars[i].clipPlanes[2].constant,r[i]=this.selectOutClipCars[i].maxClipY;new c.default.Tween(n).to(r,1e3).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){for(var n in e)t.selectOutClipCars[n].clipYPlus(e[n])})).onComplete((function(t){e&&e()})).start()}},{key:"fromFloorToHomeView",value:function(e){this.isFloorClip?(this.hideAllSceneLights(),this.alpha=0,this.resetDownClip(),this.bustard.core.isGlow=!1,this.endClipTween(e)):e&&e()}},{key:"endClipTweenByBuilding",value:function(e,t){var n=this;this.isFloorClip?(this.changeClipByFloor(e),this.isFloorClip=!1):this.changeClip(e),this.showTemplateModelsByFloor(),this.isNight&&(this.isNight=!1);for(var r={},i={},a=0,o=this.selectOutClipCars.length;a<o;a++)r[a]=this.selectOutClipCars[a].clipPlanes[2].constant,i[a]=this.selectOutClipCars[a].maxClipY;new c.default.Tween(r).to(i,1e3).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){for(var t in e)n.selectOutClipCars[t].clipYPlus(e[t])})).onComplete((function(e){t&&t()})).start()}},{key:"showBuilding",value:function(e,t){this.hideAllSceneLights(),this.alpha=0,this.resetDownClip(),this.bustard.core.isGlow=!1,this.endClipTweenByBuilding(e,t)}},{key:"animations",value:function(e){var t;c.default.update(),c.default.getAll().length>0||this.runTextureMeshList.length>0||this.lightInterval||Object.keys(this.interval).length>0||this.isBallEffect||this.isRingEffect||this.weatherTool.hasWeatherAnimation||this.isRailEffect||this.isRoutRun||this.isArrow||this.isLineEffect||this.isUpdateTexture||this.isWaterEffect||this.bustard.groundEffect.isRunning||this.particle.particleFireAnimationState||this.isGlowRing||this.autoRotateObjects.length>0||this.bustard.smokeEffect.smokeMap.size>0||this.bustard.smokeEffect2.smokeMap.size>0?this.bustard.core.hasAnimation=!0:this.bustard.core.hasAnimation=!1,this.ballEffectAnimation(),this.ringEffectAnimation(),this.weatherTool.updateWeahterAnimation(e),this.animationTool.updateAnimation(),this.railEffectAnimation(),this.routeEffectAnimation(),this.arrowEffectAnimation(),this.lineEffectAnimation(),this.line2EffectAnimation(),this.autoRotateAnimation(),this.isUpdateTexture&&this.texture.updateTexture(),this.isWaterEffect&&this.waterEffect.run(),null!==(t=this.bustard.groundEffect)&&void 0!==t&&t.isRunning&&this.bustard.groundEffect.run(),this.particle.particleAnimation(),this.isRunLightning&&this.lineEffect.runLightning(),this.isGlowRing&&this.glow.glowRingsRun(1),this.autoRotateObjects.length>0&&this.autoRotateObjects.forEach((function(e){e.userData.rotateSpeed||(e.userData.rotateSpeed=1),"x"==e.userData.rotateAxis?e.rotateX(-1*e.userData.rotateSpeed*Math.PI/180):"y"==e.userData.rotateAxis?e.rotateY(-1*e.userData.rotateSpeed*Math.PI/180):e.rotateZ(-1*e.userData.rotateSpeed*Math.PI/180)}))}},{key:"ballEffectAnimation",value:function(){this.isBallEffect&&this.ballEffect.run()}},{key:"ringEffectAnimation",value:function(){this.isRingEffect&&this.ringEffect.run()}},{key:"railEffectAnimation",value:function(){this.isRailEffect&&this.railEffect.run()}},{key:"routeEffectAnimation",value:function(){this.isRoutRun&&this.mark.run()}},{key:"arrowEffectAnimation",value:function(){this.isArrow&&this.texture.run(this.arrowSpeed)}},{key:"lineEffectAnimation",value:function(){this.isLineEffect&&(this.lineEffect.run(),this.bustard.lineEffect2.run())}},{key:"addPathLine",value:function(e,t,n,r){var i;if(!(t.length<2)){this.isLineEffect2=!0;var a=this.lineEffect2.addPathLine(e,t,n,r);a.material.map.offset.x=r.offsetX?r.offsetX:0;var o=1e3/(null!==(i=null==r?void 0:r.scrollSpeed)&&void 0!==i?i:1);a.userData.tween=new c.default.Tween({value:r.offsetX}).to({value:r.offsetX+(o>0?1:-1)},Math.abs(o)).easing(c.default.Easing.Linear.None).onStart((function(e){})).onUpdate((function(e){a.material.map.offset.x=e.value})).repeat(1/0).start()}}},{key:"addPathTubeLines",value:function(e,t,n,r){var i,a,o=this,s=[],l=r.distance,u=2*r.radius+r.spacing,h=r.distance2,d=r.spacing2,p=r.distance3,f=null!==(i=r.offsetLeft)&&void 0!==i?i:0,m=null!==(a=r.offsetRight)&&void 0!==a?a:0;if(t.forEach((function(e){var t=e.id,n=e.name,i=e.rowIndex,a=e.index,c=e.rowDirection,v=e.order,g=e.number,y=o.loader.modelMap.get(t);if(y){o.bustard.core.getCenterAndSize2([y]);var x=new THREE.Matrix4;x.compose(y.position,new THREE.Quaternion,y.scale);var b,M=x.clone().multiply(y.matrixWorld.clone().invert()),w=o.bustard.core.getCenterAndSize4(y,M);if(n?n.indexOf("/")>-1?b=o.bustard.core.getModelNodeByPathNames2(y,n,!1):(b=o.bustard.core.getModelNodeByName(y,n,!1))||(b=o.bustard.core.getModelMeshByName2(y,n)):b=y,b){var _,A,C,T;if("instanceId"in b){A=o.bustard.core.setFromInstanceMesh(b.mesh,b.instanceId).getCenter(new THREE.Vector3);var S=o.bustard.core.setFromInstanceMesh(b.mesh,b.instanceId,M);C=S.getCenter(new THREE.Vector3),T=S.getSize(new THREE.Vector3)}else{A=o.bustard.core.bbox3([b]).getCenter(new THREE.Vector3);var E=o.bustard.core.getCenterAndSize3(b,M);C=E.center,T=E.size}var L,P=w.center.z+w.size.z/2+f,B=w.center.z-w.size.z/2-m,D=w.center.y-w.size.y/2,k={x:A.x+T.x/2,y:A.y,z:A.z},R={x:0,y:0,z:0},O={x:l+u*(L=0==v?g-a:a-1),y:0,z:0},I={x:l+u*L,y:-h,z:0},F={x:l+u*L,y:-h,z:("left"==c?P-(i-1)*d:B+(i-1)*d)-C.z},N={x:l+u*L,y:D-p-C.y,z:("left"==c?P-(i-1)*d:B+(i-1)*d)-C.z};s.push({id:t+"-"+n,color:e.color,position:k,rotation:null!==(_=e.rotation)&&void 0!==_?_:{x:0,y:0,z:0},positions:r.reverse?[N,F,I,O,R]:[R,O,I,F,N],visible:!("visible"in e)||e.visible,scroll:e.scroll,flash:e.flash,userData:e})}}})),s.length>0){var v=this.lineEffect2.addPathTubeLines(e,s,n,r);if(v){if(v.userData.scrollList.length>0){var g,y=1e3/(null!==(g=null==r?void 0:r.scrollSpeed)&&void 0!==g?g:1);v.userData.tween=new c.default.Tween({value:0}).to({value:0+(y>0?1:-1)},Math.abs(y)).easing(c.default.Easing.Linear.None).onStart((function(e){})).onUpdate((function(e){v.userData.scrollList.forEach((function(t){t.instanceMesh.geometry.attributes.offsetX.setX(t.instanceId,e.value),t.instanceMesh.geometry.attributes.offsetX.needsUpdate=!0}))})).repeat(1/0).start()}var x;v.userData.flashList.length>0&&(v.userData.opacityTween=new c.default.Tween({value:.2}).to({value:1},null!==(x=null==r?void 0:r.flashInterval)&&void 0!==x?x:500).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){v.userData.flashList.forEach((function(t){t.instanceMesh.geometry.attributes.customOpacity.setX(t.instanceId,e.value),t.instanceMesh.geometry.attributes.customOpacity.needsUpdate=!0}))})).onComplete((function(e){})).start().repeat(1/0).yoyo(!0))}}}},{key:"updatePathTubeLines",value:function(e,t,n){var r=this.lineEffect2.updatePathTubeLines(e,t);if(r){if(r.userData.scrollList.length>0){var i;r.userData.tween&&(r.userData.tween.stop(),r.userData.tween=null);var a=1e3/(null!==(i=null==n?void 0:n.scrollSpeed)&&void 0!==i?i:1);r.userData.tween=new c.default.Tween({value:0}).to({value:0+(a>0?1:-1)},Math.abs(a)).easing(c.default.Easing.Linear.None).onStart((function(e){})).onUpdate((function(e){r.userData.scrollList.forEach((function(t){t.instanceMesh.geometry.attributes.offsetX.setX(t.instanceId,e.value),t.instanceMesh.geometry.attributes.offsetX.needsUpdate=!0}))})).repeat(1/0).start()}var o;r.userData.flashList.length>0&&(r.userData.opacityTween&&(r.userData.opacityTween.stop(),r.userData.opacityTween=null),r.userData.opacityTween=new c.default.Tween({value:.2}).to({value:1},null!==(o=null==n?void 0:n.flashInterval)&&void 0!==o?o:500).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(e){r.userData.flashList.forEach((function(t){t.instanceMesh.geometry.attributes.customOpacity.setX(t.instanceId,e.value),t.instanceMesh.geometry.attributes.customOpacity.needsUpdate=!0}))})).onComplete((function(e){})).start().repeat(1/0).yoyo(!0))}}},{key:"addPathTubeLine",value:function(e,t,n,r){var i;if(this.isLineEffect2=!0,!(t.length<2)){t[0].y==t[1].y&&(t[0].y+=1e-4);var a=this.lineEffect2.addPathTubeLine(e,t,n,r),o=r.offsetX?r.offsetX:0;if(a){if(a.material.map.offset.x=o,r&&r.scrollSpeed){var s,l=1e3/(null!==(s=null==r?void 0:r.scrollSpeed)&&void 0!==s?s:1);a.userData.tween=new c.default.Tween({value:o}).to({value:o+(l>0?1:-1)},Math.abs(l)).easing(c.default.Easing.Linear.None).onStart((function(e){})).onUpdate((function(e){a.material.map.offset.x=e.value})).repeat(1/0).start()}return a&&r&&r.flash&&this.setObjectFlashOpacity(a,.2,1,null!==(i=null==r?void 0:r.flashInterval)&&void 0!==i?i:500),a}}}},{key:"updatePathTubeLine",value:function(e,t){var n=this.lineEffect2.getPathTubeLine(e);if(n){"visible"in t&&(n.visible=t.visible),t.color&&n.material.color.setHex(t.color);var r,i=t.offsetX?t.offsetX:0;if(t&&t.scrollSpeed){var a;if(n.userData.tween)return;var o=1e3/(null!==(a=null==t?void 0:t.scrollSpeed)&&void 0!==a?a:1);n.userData.tween=new c.default.Tween({value:i}).to({value:i+(o>0?1:-1)},Math.abs(o)).easing(c.default.Easing.Linear.None).onStart((function(e){})).onUpdate((function(e){n.material.map.offset.x=e.value})).repeat(1/0).start()}else n.userData.tween&&(n.userData.tween.stop(),n.userData.tween=null),n.material.map.offset.x=i;return n&&(t&&t.flash?this.setObjectFlashOpacity(n,.5,1,null!==(r=null==t?void 0:t.flashInterval)&&void 0!==r?r:500):n.userData.opacityTween&&(n.userData.opacityTween.stop(),n.userData.opacityTween=null,n.material.opacity=1)),this.renderTool.setNeedUpdate(),n}}},{key:"startPathTubeLinePlaying",value:function(e,t,n,r,i){var a=this.lineEffect2.getPathTubeLine(e);if(a){var o=this;new c.default.Tween({value:a.userData.progress}).to({value:n},r).easing(c.default.Easing.Linear.None).onStart((function(e){})).onUpdate((function(e){o.lineEffect2.updatePathTubeLine(a,t,e.value)})).onComplete((function(e){i&&i()})).start()}}},{key:"removePathLineByName",value:function(e){this.lineEffect2.removeByName(e)}},{key:"line2EffectAnimation",value:function(){}},{key:"autoRotateAnimation",value:function(){var e=(new Date).getTime();this.cameraRotateAnimation&&(this.isRotate||e-this.stopRotateTime>=this.recoveryRotateInterval)&&(this.isRotate||(this.cameraRotateStartView&&this.lerpLookAt(this.cameraRotateStartView.position,this.cameraRotateStartView.target,1e3,!1),this.startCameraRotateAnimation(this.cameraRotateAnimationParams)),this.isRotate=!0)}},{key:"startCameraRotateAnimation",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.reverse,r=void 0!==n&&n,i=t.repeat,a=void 0===i?1/0:i,o=t.time,s=void 0===o?12e4:o,l=t.onRepeatCallback,u=t.onCompleteCallback;this.stopCameraRotateAnimation(),this.isRotate=!0,this.cameraRotateAnimationParams=t;var h=r?2*-Math.PI:2*Math.PI,d=this.cameraController.azimuthAngle+h;this.cameraRotateAnimation=new c.default.Tween(this.cameraController).to({azimuthAngle:d},s).easing(c.default.Easing.Linear.None).onRepeat((function(){l&&l()})).onComplete((function(){e.isRotate=!1,e.cameraRotateAnimation=null,u&&u()})).repeat(a).start()}},{key:"stopCameraRotateAnimation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isRotate=!1,this.cameraRotateAnimation&&(this.cameraRotateAnimation.stop(),e||(this.cameraRotateAnimation=null))}},{key:"showNightScene",value:function(e){var t=this;this.loader.removeSkybox(),this.isAddSkyBox=!1,this.modelAlphaAnimation("透明外壳","","",!0,(function(){t.addLineEffect(),e&&e()})),this.modelAlphaAnimation("外立面","","",!1),this.modelAlphaAnimation("土建","","",!1),this.modelAlphaAnimation("地形","","地面",!1,(function(){t.isNight=!0}),{value:.1,time:1e3}),this.modelAlphaAnimation("地形","","配楼",!1,null,{value:.1,time:1e3}),this.modelAlphaAnimation("地形","","植物",!1)}},{key:"showRealScene",value:function(e){var t=this;this.setDefaultCameraPosition(),this.lineEffect.removeLineMeshs(),this.modelAlphaAnimation("外立面","","",!0,(function(){t.isNight=!1,e&&e()})),this.modelAlphaAnimation("土建","","",!0),this.modelAlphaAnimation("地形","","",!0)}},{key:"setCameraChangeHandler",value:function(e,t){var n=this,r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).removeOthers;(void 0===r||r)&&this.cameraController.removeAllEventListeners(),this.cameraController.addEventListener(e,(function(){var e=H(H({},n.getCameraPosition()),n.getCameraAngle());t&&t(e)}))}},{key:"emptyScene",value:function(){this.elementEventAbortController.abort(),(0,B.destroyIfNeed)(this._pipeLineTool),(0,B.destroyIfNeed)(this._transformControlManager),(0,B.destroyIfNeed)(this._spriteLabelManager),(0,B.destroyIfNeed)(this._oldMeasurementTool),(0,B.destroyIfNeed)(this._drawTool),(0,B.destroyIfNeed)(this.targetIconTool),(0,B.destroyIfNeed)(this.clipTool),(0,B.destroyIfNeed)(this.measureTool),(0,B.destroyIfNeed)(this.occlusionHideTool),(0,B.destroyIfNeed)(this.selectBorderTool),(0,B.destroyIfNeed)(this.selectOnTopTool),(0,B.destroyIfNeed)(this.firstPersonRoam),(0,B.destroyIfNeed)(this.nodeSizeTool),(0,B.destroyIfNeed)(this.multipleSelectTool),(0,B.destroyIfNeed)(this.autoRoam),(0,B.destroyIfNeed)(this.meshInfoTool),this.removeAllBeforeRenderCallback(),this.removeAllAfterRenderCallback(),this.endEffectAnimation(),this.cameraController.removeAllEventListeners(),this.bustard.core.transformControls.removeEventListener("change",this.dragChange),this.bustard.core.transformControls.removeEventListener("dragging-changed",this.editLineAutoChange),(0,B.destroyIfNeed)(this.bustard),this.removeAnimation(),this.removeSkybox(),this.removePathLineByName(),this.mark.removeRoutpipe(),this.sprite.removeAllSignage(),this.particle.removeAllParticleFire(),this.ballEffect.removeBallMeshs(),this.scenesMap.clear(),this.scenesState.clear(),this.loader.modelMap.clear(),this.loader.templateModelMap.clear(),this.loader.DB.db.close(),this.DB.closeDB(),this.outClipCars.clear(),this.selectOutClipCars=[],this.selectInClipCars=[],this.selectDownClipCars=[],this.tweenAlphaMap.clear(),this.havingTweenDownArray=[],this.materialMap.clear(),this.bufferMap.clear(),this.autoRotateObjects=[],this.bustard.core.emptyRootScene(),this.isBallEffect=!1,this.isRoutTest=!1,this.content=null,clearInterval()}},{key:"render",value:function(){this.bustard.core.render()}},{key:"setNeedUpdate",value:function(){this.renderTool.setNeedUpdate()}},{key:"addAnimation",value:function(){this.bustard.core.scene.visible=!0,this.animationStatus||(this.animationStatus=!0,this.bustard.core.animation())}},{key:"removeAnimation",value:function(){this.animationStatus=!1,this.bustard.core.setAnimationState(!1)}},{key:"startEffectAnimation",value:function(){(0,D.isNil)(this.effectAnimationId)&&this.effectAnimation()}},{key:"endEffectAnimation",value:function(){(0,D.isNotNil)(this.effectAnimationId)&&(window.cancelAnimationFrame(this.effectAnimationId),this.effectAnimationId=null)}},{key:"addTweenUpDown",value:function(e){if(!e.userData.tween){var t={x:e.scale.x,y:e.scale.y,z:e.scale.z},n={x:1.3*e.scale.x,y:1.3*e.scale.y,z:1*e.scale.z},r={tweenUp:new c.default.Tween(e.scale).to(n,700).easing(c.default.Easing.Bounce.Out).delay(100).start(),tweenDown:new c.default.Tween(e.scale).to(t,700).easing(c.default.Easing.Bounce.Out).delay(50)};e.userData.tween=r}}},{key:"addGlowRings",value:function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:20;this.glow.addGlowRing(e,{position:t,surfaceTextureUrl:i,surfaceSize:n,color:r,renderOrder:a}),this.isGlowRing=!0}},{key:"removeGlowRings",value:function(){this.glow.emptyGlowRings()}},{key:"setObjectAutoRotate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"y";e.userData.rotateAxis=t,-1==this.autoRotateObjects.indexOf(e)?this.autoRotateObjects.push(e):this.autoRotateObjects.splice(this.autoRotateObjects.indexOf(e),1)}},{key:"clearAutoRotateObjects",value:function(){this.autoRotateObjects=[]}},{key:"addOcean",value:function(e){this.waterEffect.addOcean(e),this.isWaterEffect=!0}},{key:"addModelEffectTest",value:function(e,t){this.waterEffect.addModelEffect(e,t),this.isWaterEffect=!0}},{key:"addModelWaterEffect",value:function(e,t){var n=e.modelName,r=e.nodeName,i=t||{color:"#3599fb",size:10,speed:.5/60,sunDirection:{x:1,y:1,z:1}};this.addModelEffect(n,r,i)}},{key:"removeWaterMeshs",value:function(){this.waterEffect.removeWaterMeshs(),this.isWaterEffect=!1}},{key:"addModelEffect",value:function(e,t,n){var r=this.getObjectByUniqueTarget({id:e,name:t});r&&(n.url=this.waterImg,this.waterEffect.addModelEffect(r,n),this.isWaterEffect=!0)}},{key:"setNodeReflector",value:function(e,t,n){var r=this,i=this.getObjectByUniqueTarget({id:e,name:t});i&&i.traverse((function(e){"Mesh"===e.type&&r.waterEffect.setMeshReflector(e,{definition:n})}))}},{key:"addAutomaticOrientation",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"z",r=this.getObjectByUniqueTarget({id:e,name:t});r&&this.texture.addAutomaticOrientation(r,n)}},{key:"setRoadNameAutomaticOrientation",value:function(){var e=this;this.bustard.core.scene.traverse((function(t){(t.name.includes("路名")||t.name.includes("MCYB_A07.01")||t.name.includes("MCYB_A07.02"))&&e.texture.addAutomaticOrientation(t,"z")}))}},{key:"openFlagAnimation",value:function(){var e=this;this.bustard.core.scene.traverse((function(t){(t.name.includes("国旗")||t.name.includes("MCYB_A06.02.03"))&&e.texture.addFlagAnimation(t)}))}},{key:"openWaterEffect",value:function(e){var t=this,n=[],r=[];this.loader.modelMap.forEach((function(e,t){"地形"===e.userData.type?e.traverse((function(e){(e.name.includes("水面")||e.name.includes("MCYB_A01.07.01"))&&n.push(e)})):e.traverse((function(e){(e.name.includes("水面")||e.name.includes("MCYB_A01.07.01"))&&r.push(e)}))})),n.forEach((function(n){var r,i,a,o;n.parent&&t.addModelEffectTest(n,{url:t.waterImg,enableReflector:null!==(r=null==e?void 0:e.enableReflector)&&void 0!==r&&r,color:null!==(i=null==e?void 0:e.color)&&void 0!==i?i:"#3E5F70",size:null!==(a=null==e?void 0:e.size)&&void 0!==a?a:10,speed:null!==(o=null==e?void 0:e.speed)&&void 0!==o?o:.5/60,sunDirection:{x:1,y:1,z:1}})})),r.forEach((function(n){var r,i,a,o;n.parent&&t.addModelEffectTest(n,{url:t.waterImg,enableReflector:null!==(r=null==e?void 0:e.enableReflector)&&void 0!==r&&r,color:null!==(i=null==e?void 0:e.color2)&&void 0!==i?i:"#3E5F70",size:null!==(a=null==e?void 0:e.size2)&&void 0!==a?a:10,speed:null!==(o=null==e?void 0:e.speed2)&&void 0!==o?o:.5/60,sunDirection:{x:1,y:1,z:1}})}))}},{key:"addReflector",value:function(e){this.waterEffect.addReflector(e)}},{key:"addTextureReflector",value:function(e){this.waterEffect.addTextureReflector(e)}},{key:"removeReflector",value:function(){this.waterEffect.removeReflector()}},{key:"addLightning",value:function(e,t){this.lineEffect.addLightning(e,t),this.isRunLightning=!0}},{key:"createDynamicGround",value:function(e,t,n,r){this.bustard.groundEffect.createDynamicGround(e,t,n,r)}},{key:"removeDynamicGround",value:function(){this.bustard.groundEffect.removeDynamicGround()}},{key:"createGradientGround",value:function(e,t,n,r){this.bustard.groundEffect.createGradientGround(e,t,n,r)}},{key:"removeGradientGround",value:function(){this.bustard.groundEffect.removeGradientGround()}},{key:"addGradient",value:function(e,t,n){var r=this,i=this.bustard.core.getMeshByName(e);i||(i=this.getNodeByName(e)),i&&i.traverse((function(e){"Mesh"===e.type&&r.bustard.groundEffect.addGradient(e,t,n)}))}},{key:"setGlowByName",value:function(e){this.bustard.core.isGlow=!0;var t=this.bustard.core.getMeshByName(e);t||(t=this.getNodeByName(e)),t&&(this.glowObjects.push(t),t.traverse((function(e){"Mesh"===e.type&&e.layers.enable(1)})))}},{key:"stopGlow",value:function(){this.bustard.core.isGlow=!1,this.glowObjects.forEach((function(e){e.traverse((function(e){"Mesh"===e.type&&e.layers.disable(1)}))}))}},{key:"addCanvasForMesh",value:function(e,t){var n=this.bustard.core.getMeshByName(e);n&&(this.texture.addCanvasForMesh(n,t),this.isUpdateTexture=!0)}},{key:"addCanvasForPlane",value:function(e,t){this.texture.addCanvasForPlane(e,t),this.isUpdateTexture=!0}},{key:"removeCanvasPlanes",value:function(){this.texture.removeCanvasPlanes(),this.isUpdateTexture=!1}},{key:"addTextToTexture",value:function(e,t,n){this.texture.addTextToTexture(e,t,n)}},{key:"modelTrackAnimation",value:function(e,t,n,r,i){var a=this,o=this.lineEffect2.addTrack(r,i&&"tension"in i?i.tension:.1,!(!i||!("isClosed"in i))&&i.isClosed,!(!i||!("isShow"in i))&&i.isShow),s=i&&"up"in i?i.up:{x:0,y:1,z:0};this.addTemplateModel(t,n,(function(){for(var t=[],r=0;r<i.number;r++){var l=a.addSignageModelByCoords(n,e+r,o.getPointAt(r/i.number),{x:0,y:0,z:0});l.userData.progress=r/i.number,l.userData.curve=o,l.userData.speed=i&&i.speed?i.speed:.001,l.userData.up=s,t.push(l)}a.addModelTrackAnimation(t,i.number)}))}},{key:"addCustomAnimation",value:function(e,t,n,r,i,a,o,s){var l=this,u=this,h=this.lineEffect2.addPathTubeLine(e,a,o,s),d=s.offsetX?s.offsetX:0;h.material.map.offset.x=d;var p=this.lineEffect2.addTrack(r,i&&"tension"in i?i.tension:.1,!(!i||!("isClosed"in i))&&i.isClosed,!(!i||!("isShow"in i))&&i.isShow),f=i&&"up"in i?i.up:{x:0,y:1,z:0};this.addTemplateModel(t,n,(function(){for(var t=[],r=0;r<i.number;r++){var a=p.getPointAt(r/i.number),o=l.addSignageModelByCoords(n,e+r,a,{x:0,y:0,z:0}),s=p.getPointAt(r/i.number+.001<=1?r/i.number+.001:r/i.number+.001-1);u.lineEffect2.trackAnimation(o,a,s,f),o.userData.progress=r/i.number,o.userData.curve=p,o.userData.speed=i&&i.speed?i.speed:.001,o.userData.up=f,t.push(o)}h.userData.tween=new c.default.Tween({value:0}).to({value:1},i.time?i.time:1e3).easing(c.default.Easing.Linear.None).onStart((function(e){})).onUpdate((function(e){h.material.map.offset.x=e.value+d,t.forEach((function(t){var n=t.userData.curve.getPointAt(e.value/i.number+t.userData.progress),r=t.userData.curve.getPointAt(e.value/i.number+t.userData.progress+.001<=1?e.value/i.number+t.userData.progress+.001:e.value/i.number+t.userData.progress+.001-1);t.position.set(n.x,n.y,n.z),u.lineEffect2.trackAnimation(t,n,r,t.userData.up)}))})).repeat(1/0).start()}))}},{key:"removeCustomAnimation",value:function(e,t){this.removePathLineByName(e),this.removeTemplateModelByType(t)}},{key:"addModelTrackAnimation",value:function(e,t){var n=this;this.tweenTest=new c.default.Tween({value:0}).to({value:1/t},1e3).easing(c.default.Easing.Linear.None).onStart((function(e){})).onUpdate((function(t){e.forEach((function(e){var r=e.userData.curve.getPointAt(t.value+e.userData.progress),i=e.userData.curve.getPointAt(t.value+e.userData.progress+.001<=1?t.value+e.userData.progress+.001:t.value+e.userData.progress+.001-1);e.position.set(r.x,r.y,r.z),n.lineEffect2.trackAnimation(e,r,i,e.userData.up)}))})).onComplete((function(e){})).repeat(1/0)}},{key:"setModelTrackAnimationState",value:function(e,t){var n=this.loader.modelMap.get(e);n&&("start"==t&&"progress"in n.userData&&!n.userData.tween?this.addModelTrackAnimation(n):"stop"==t&&n.userData.tween&&(n.userData.tween.stop(),n.userData.tween=null))}},{key:"setColorValue",value:function(e,t,n){var r=this.getObjectByUniqueTarget({id:e,name:t});r&&this.color.setObject3DColor2(r,this.color.getLutColor(n).getHex())}},{key:"addFloorLabel",value:function(e,t,n,r){var i,a=this.loader.modelMap.get(e);if(a&&(t.indexOf("/")>-1?i=this.bustard.core.getModelNodeByPathNames(a,t,!1):(i=this.bustard.core.getModelNodeByName(a,t,!1))||(i=this.bustard.core.getModelMeshByName(a,t)),i)){var o=this.bustard.core.getCenterAndSize(i);this.addLabel("floorLabel_"+e+"_"+t,n,{x:o.center.x+o.size.x/2+(r&&r.offsetX?r.offsetX:5),y:o.center.y,z:o.center.z},[],r&&r.type?r.type:null)}}},{key:"injectInstancedMeshFromMesh",value:function(e){this.bustard.core.injectInstancedMeshFromMesh(e)}},{key:"addModelSplotLight",value:function(e,t,n){var r=this,i=[];if(t.forEach((function(e){if(e.id){var t,n=r.loader.modelMap.get(e.id);n&&(e.name?(e.name.indexOf("/")>-1?t=r.bustard.core.getModelNodeByPathNames(n,e.name,!1):(t=r.bustard.core.getModelNodeByName(n,e.name,!1))||(t=r.bustard.core.getModelMeshByName(n,e.name)),t&&i.push(t)):i.push(n))}})),0==i.length)return 0;var a=this.bustard.core.bbox(i),o=a.getCenter(new THREE.Vector3),s=a.getSize(new THREE.Vector3),l=s.length(),u={x:o.x,y:o.y-s.y/2,z:o.z},c={x:o.x,y:o.y+s.y/2+l*n.scale/2,z:o.z};return this.addSplotLight(e,c,u,n.color,n.intensity,l*n.scale/2,n.angle,n.penumbra,n.decay,!1,!1),1}},{key:"setObjectFlashOpacity",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500;e.userData.opacityTween||(e.userData.opacityTween=new c.default.Tween({value:t}).to({value:n},r).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(t){e.material.opacity=t.value})).onComplete((function(e){})).start().repeat(1/0).yoyo(!0))}},{key:"setObjectFlashColor",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=this;e.userData.opacityTween||(e.userData.opacityTween=new c.default.Tween({value:t}).to({value:n},r).easing(c.default.Easing.Cubic.InOut).onStart((function(e){})).onUpdate((function(t){i.color.setObject3DColor(e,t.value)})).onComplete((function(e){})).start().repeat(1/0).yoyo(!0))}},{key:"performActionTest",value:function(e,t,n,r){var i=this,a=[],o=!0;if(["focus","colorBox","modelBox","hide","show","transparent","restoreTransparent","color","restoreColor","colorTransparent"].indexOf(t)>-1&&(o=!1),e.forEach((function(e){if(e.id){var n=i.loader.modelMap.get(e.id);if(n)if(e.name&&e.name!=e.id){var r;e.name.indexOf("/")>-1?r=i.bustard.core.getModelNodeByPathNames(n,e.name,o):(r=i.bustard.core.getModelNodeByName(n,e.name,o))||(r=i.bustard.core.getModelMeshByName(n,e.name)),r&&a.push(r)}else{var s=!0;n.userData.isOnly&&["transparent","restoreTransparent","color","restoreColor","colorTransparent","rotate","wireFrame","selectOnTop"].indexOf(t)>-1&&(s=!1),o&&s&&i.bustard.core.resetObject3DFromAllInstances(n),a.push(n)}}})),0==a.length)return 0;if("show"===t)a.forEach((function(e){i.bustard.core.showObject3D(e,!(null==n||!n.isStatus)&&n.isStatus)}));else if("hide"===t)a.forEach((function(e){i.bustard.core.hideObject3D(e,!(null==n||!n.isStatus)&&n.isStatus)}));else if("clipHide"===t)a.forEach((function(e){var t;i.hideByClip(e,n&&"direction"in n?n.direction:0,null!==(t=null==n?void 0:n.time)&&void 0!==t?t:0)}));else if("clipShow"===t)a.forEach((function(e){var t;i.showByClip(e,n&&"direction"in n?n.direction:0,null!==(t=null==n?void 0:n.time)&&void 0!==t?t:0)}));else if("toggleVisible"===t)a.forEach((function(e){e.visible?i.modelHide.hide(e):e.visible=!0}));else if("transparent"===t)a.forEach((function(e){n&&"opacity"in n&&(i.transparent.opacity=n.opacity),i.transparent.transparentObjectNew(e)}));else if("restoreTransparent"===t)a.forEach((function(e){i.transparent.restoreObject(e)}));else if("focus"===t){var s=1e3;if(n&&"time"in n&&(s=n.time),n&&"default"===n.focusView){var l=a.filter((function(e){return e.visible}));l.length>0&&this.autoRoam.focusingToObjects(l,!0,this.showPercentageToFocusObject,s,r)}else n&&n.focusView&&n.focusView.position&&n.focusView.target&&this.lerpLookAt(n.focusView.position,n.focusView.target,s,!0,r)}else if("highLight"===t)a.forEach((function(e){i.outLine.highLight2(e,n)})),this.bustard.core.transformControls.object&&this.bustard.core.transformControlDetach();else if("flash"===t)a.forEach((function(e){i.outLine.highLight3(e,n)})),this.bustard.core.transformControls.object&&this.bustard.core.transformControlDetach();else if("color"===t)a.forEach((function(e){var t;i.color.setObject3DColorNew(e,null!==(t=null==n?void 0:n.color)&&void 0!==t?t:16776960)}));else if("restoreColor"===t)a.forEach((function(e){i.color.restoreObject3DColor(e)}));else if("colorTransparent"===t)a.forEach((function(e){var t,r;i.color.setObject3DColor3New(e,null!==(t=null==n?void 0:n.color)&&void 0!==t?t:16776960,null!==(r=null==n?void 0:n.opacity)&&void 0!==r?r:.5)}));else if("colorBox"===t){var u,c=[];a.forEach((function(e){c.push(e.uuid)}));var h,d=this.color.setObjectsBoxColor(c.join("-"),a,null!==(u=null==n?void 0:n.color)&&void 0!==u?u:16776960,n);d&&n&&n.flash&&this.setObjectFlashOpacity(d,.2,.5,null!==(h=null==n?void 0:n.flashInterval)&&void 0!==h?h:500)}else if("modelBox"===t){var p=[];a.forEach((function(e){p.push(e.uuid)}));var f=p.join("-");if(!this.selectEffectModels.get(f)){var m=this.bustard.core.getCenterAndSize2(a),v=m.center,g=m.size;this.loader.addCustomModel(this.selectEffect).then((function(e){e.object.name="选中效果",e.object.scale.set(1*g.x,1*g.y,1*g.z),e.object.position.set(v.x,v.y,v.z),e.object.traverse((function(e){var t;"Mesh"===e.type&&(e.material.color.setHex(0),e.material.emissive.setHex(null!==(t=null==n?void 0:n.color)&&void 0!==t?t:16776960)),"Box003"===e.name&&(e.material.transparent=!0,e.material.opacity=.2,e.material.depthWrite=!1)})),i.selectEffectModels.set(f,e.object)}))}}else"rotate"===t?a.forEach((function(e){var t;i.setObjectAutoRotate(e,null!==(t=null==n?void 0:n.axis)&&void 0!==t?t:"y")})):"explosion"===t?a.forEach((function(e){i.separate(e,2)})):"texture"===t?a.forEach((function(e){e.traverse((function(e){"Mesh"===e.type&&e.material.map&&(e.material.userData.interval?(clearInterval(e.material.userData.interval),e.material.userData.interval=null,i.runTextureMeshList.splice(i.runTextureMeshList.indexOf(e.material),1)):(e.material.userData.interval=setInterval((function(){var t;"x"==(null!==(t=null==n?void 0:n.axis)&&void 0!==t?t:"x")?e.material.map.offset.x+=n&&n.speed?n.speed:.001:e.material.map.offset.y+=n&&n.speed?n.speed:.001}),50),i.runTextureMeshList.push(e.material)))}))})):"modelAnimation"===t?this.setAction(e[0].id,n.animationName,n.state,1,n&&n.loop?n.loop:1/0):"reset"===t?a.forEach((function(e){i.injectInstancedMeshFromMesh(e)})):"wireFrame"===t?a.forEach((function(e){var t,r;i.setWireFrameMaterial(e,null!==(t=null==n?void 0:n.depthWrite)&&void 0!==t&&t,null!==(r=null==n?void 0:n.opacityScale)&&void 0!==r?r:1)})):"selectOnTop"===t&&this.selectOnTopTool.addTargets(a,n);return r&&"focus"!=t&&r(),1}},{key:"clearSelectOnTop",value:function(e){if((0,D.isNotNil)(e)){var t=this.getObjectByUniqueTarget(e,!1);(0,D.isNotNil)(t)&&this.selectOnTopTool.clearSelectOnTop(t)}else this.selectOnTopTool.clearSelectOnTop()}},{key:"refreshShadow",value:function(){this.bustard.core.renderer.shadowMap.needsUpdate=!0}},{key:"performAction",value:function(e,t,n,i){var a=this,o=[],s=new Map,l=function(e,t){var n=["focus","colorBox","modelBox","hide","show","toggleVisible","transparent","restoreTransparent","color","restoreColor","colorTransparent","selectOnTop"];return e||(n=["focus","colorBox","modelBox","hide","show","toggleVisible"]),!n.includes(t)},u=["transparent","restoreTransparent","color","restoreColor","colorTransparent","rotate","wireFrame","selectOnTop","overColor"],c=[];if(e.filter((function(e){return e.id&&a.loader.modelMap.has(e.id)})).forEach((function(e){var n=a.loader.modelMap.get(e.id),r=l(n.userData.isOnly,t);if(c.push(n),e.name&&e.name!=e.id){if(e.name.indexOf("/")>-1){var i=a.bustard.core.getModelNodeByPathNames(n,e.name,r);return void(i&&o.push(i))}s.has(e.id)||s.set(e.id,[]),s.get(e.id).push({element:e,shouldResetNode:r})}else{var h=!(n.userData.isOnly&&u.includes(t));r&&h&&a.bustard.core.resetObject3DFromAllInstances(n),o.push(n)}})),s.forEach((function(e,t){var n=a.loader.modelMap.get(t),i=e.map((function(e){var t=e.element,n=e.shouldResetNode;return{name:t.name,needReset:n}})),s=a.bustard.core.getPerformTargets(n,i);s.length>0&&o.push.apply(o,(0,r.default)(s))})),0==o.length)return 0;if("show"===t)o.forEach((function(e){a.bustard.core.showObject3D(e,!(null==n||!n.isStatus)&&n.isStatus),a.hideObjects.delete(e.uuid)})),this.selectOnTopTool.refreshCurrentSelectOnTop(),this.refreshShadow();else if("hide"===t)o.forEach((function(e){a.bustard.core.hideObject3D(e,!(null==n||!n.isStatus)&&n.isStatus),a.hideObjects.set(e.uuid,e)})),this.selectOnTopTool.refreshCurrentSelectOnTop(),this.refreshShadow();else if("clipHide"===t)o.forEach((function(e){var t;a.hideByClip(e,n&&"direction"in n?n.direction:0,null!==(t=null==n?void 0:n.time)&&void 0!==t?t:0)}));else if("clipShow"===t)o.forEach((function(e){var t;a.showByClip(e,n&&"direction"in n?n.direction:0,null!==(t=null==n?void 0:n.time)&&void 0!==t?t:0)}));else if("toggleVisible"===t)o.forEach((function(e){a.hideObjects.get(e.uuid)?(a.bustard.core.showObject3D(e,!1),a.hideObjects.delete(e.uuid)):(a.bustard.core.hideObject3D(e,!1),a.hideObjects.set(e.uuid,e))}));else if("transparent"===t)o.forEach((function(e){n&&"opacity"in n&&(a.transparent.opacity=n.opacity),a.transparent.transparentObjectNew(e)}));else if("restoreTransparent"===t)o.forEach((function(e){a.transparent.restoreObject(e)}));else if("focus"===t){var h=1e3;if(n&&"time"in n&&(h=n.time),n&&"default"===n.focusView){var d=o.filter((function(e){return e.visible})),p=this.showPercentageToFocusObject;n&&n.percentage&&(p=n.percentage),n.percentage=p,d.length>0&&this.autoRoam.focusingToObjectsByParams(d,n,i)}else n&&n.focusView&&n.focusView.position&&n.focusView.target&&this.lerpLookAt(n.focusView.position,n.focusView.target,h,0!=h,i)}else if("highLight"===t)o.forEach((function(e){a.outLine.highLight2(e,n)})),this.bustard.core.transformControls.object&&this.bustard.core.transformControlDetach();else if("flash"===t)o.forEach((function(e){a.outLine.highLight3(e,n)})),this.bustard.core.transformControls.object&&this.bustard.core.transformControlDetach();else if("color"===t)o.forEach((function(e){var t;a.color.setObject3DColorNew(e,(0,L.toSRGBThreeColorIfNeed)(null!==(t=null==n?void 0:n.color)&&void 0!==t?t:16776960).getHex())}));else if("overColor"===t)o.forEach((function(e){var t;a.color.setObject3DColor2(e,null!==(t=null==n?void 0:n.color)&&void 0!==t?t:16776960)}));else if("restoreColor"===t)o.forEach((function(e){a.color.restoreObject3DColor(e)}));else if("colorTransparent"===t)o.forEach((function(e){var t,r;a.color.setObject3DColor3New(e,null!==(t=null==n?void 0:n.color)&&void 0!==t?t:16776960,null!==(r=null==n?void 0:n.opacity)&&void 0!==r?r:.5)}));else if("colorBox"===t){var f=[];o.forEach((function(e){f.push(e.uuid)}));var m,v,g,y,x=f.join("-");this.color.boxSize=1.1,n&&n.boxSize&&(this.color.boxSize=n.boxSize),(m=n&&n.autoAngle?this.color.setAutoObjectsBoxColor(x,o,null!==(v=null==n?void 0:n.color)&&void 0!==v?v:16776960,n):this.color.setObjectsBoxColor(x,o,null!==(g=null==n?void 0:n.color)&&void 0!==g?g:16776960,n))&&n&&n.flash&&this.setObjectFlashOpacity(m,.2,.5,null!==(y=null==n?void 0:n.flashInterval)&&void 0!==y?y:500),c.forEach((function(e){"colorBox"in e.userData||(e.userData.colorBox=[]),-1==e.userData.colorBox.indexOf(x)&&e.userData.colorBox.push(x)}))}else if("selectBorder"===t){var b=[];o.forEach((function(e){b.push(e.uuid)}));var M=b.join("-");this.selectBorderTool.addSelectBorder(M,o,n),c.forEach((function(e){"selectBorder"in e.userData||(e.userData.selectBorder=[]),-1==e.userData.selectBorder.indexOf(M)&&e.userData.selectBorder.push(M)}))}else if("modelBox"===t){var w=[];o.forEach((function(e){w.push(e.uuid)}));var _=w.join("-");if(!this.selectEffectModels.get(_)){var A=this.bustard.core.getCenterAndSize2(o),C=A.center,T=A.size;this.loader.addCustomModel(this.selectEffect).then((function(e){e.object.name="选中效果",e.object.scale.set(1*T.x,1*T.y,1*T.z),e.object.position.set(C.x,C.y,C.z),e.object.traverse((function(e){var t,r;if("Box003"===e.name)e.material.transparent=!0,e.material.opacity=null!==(t=null==n?void 0:n.opacity)&&void 0!==t?t:.2,e.material.depthWrite=!1,e.material.color.setHex(0),e.material.emissive.setHex(null!==(r=null==n?void 0:n.faceColor)&&void 0!==r?r:16776960);else if("Line090"===e.name){var i;e.material.color.setHex(0),e.material.emissive.setHex(null!==(i=null==n?void 0:n.lineColor)&&void 0!==i?i:16776960)}})),a.selectEffectModels.set(_,e.object),i&&i()}))}c.forEach((function(e){"modelBox"in e.userData||(e.userData.modelBox=[]),-1==e.userData.modelBox.indexOf(_)&&e.userData.modelBox.push(_)}))}else"rotate"===t?o.forEach((function(e){var t;a.setObjectAutoRotate(e,null!==(t=null==n?void 0:n.axis)&&void 0!==t?t:"y")})):"explosion"===t?o.forEach((function(e){a.separate(e,2)})):"texture"===t?o.forEach((function(e){var t=[];e.traverse((function(e){"Mesh"===e.type&&e.material.map&&-1==t.indexOf(e.material.uuid)&&(t.push(e.material.uuid),e.material.userData.interval?(clearInterval(e.material.userData.interval),e.material.userData.interval=null,a.runTextureMeshList.splice(a.runTextureMeshList.indexOf(e.material),1)):(e.material.userData.interval=setInterval((function(){var t;"x"==(null!==(t=null==n?void 0:n.axis)&&void 0!==t?t:"x")?e.material.map.offset.x+=n&&n.speed?n.speed:.001:e.material.map.offset.y+=n&&n.speed?n.speed:.001}),50),a.runTextureMeshList.push(e.material)))}))})):"modelAnimation"===t?this.setAction(e[0].id,n.animationName,n.state,1,n&&n.loop?n.loop:1/0):"reset"===t?o.forEach((function(e){a.injectInstancedMeshFromMesh(e)})):"wireFrame"===t?o.forEach((function(e){var t,r;a.setWireFrameMaterial(e,null!==(t=null==n?void 0:n.depthWrite)&&void 0!==t&&t,null!==(r=null==n?void 0:n.opacityScale)&&void 0!==r?r:1)})):"selectOnTop"===t&&this.selectOnTopTool.addTargets(o,n);return i&&"focus"!=t&&"modelBox"!=t&&i(),1}},{key:"restoreAction",value:function(e,t,n){var i=this,a=[],o=new Map,s=function(e,t){var n=["focus","colorBox","modelBox","hide","show","toggleVisible","transparent","restoreTransparent","color","restoreColor","colorTransparent","selectOnTop"];return e||(n=["focus","colorBox","modelBox","hide","show","toggleVisible"]),!n.includes(t)},l=["transparent","restoreTransparent","color","restoreColor","colorTransparent","rotate","wireFrame","selectOnTop","overColor"],u=[];if(e.filter((function(e){return e.id&&i.loader.modelMap.has(e.id)})).forEach((function(e){var n=i.loader.modelMap.get(e.id);u.push(n);var r=s(n.userData.isOnly,t);if(e.name&&e.name!=e.id){if(e.name.indexOf("/")>-1){var c=i.bustard.core.getModelNodeByPathNames(n,e.name,r);return void(c&&a.push(c))}o.has(e.id)||o.set(e.id,[]),o.get(e.id).push({element:e,shouldResetNode:r})}else{var h=!(n.userData.isOnly&&l.includes(t));r&&h&&i.bustard.core.resetObject3DFromAllInstances(n),a.push(n)}})),o.forEach((function(e,t){var n=i.loader.modelMap.get(t),o=e.map((function(e){var t=e.element,n=e.shouldResetNode;return{name:t.name,needReset:n}})),s=i.bustard.core.getPerformTargets(n,o);s.length>0&&a.push.apply(a,(0,r.default)(s))})),0==a.length)return 0;if("transparent"===t)a.forEach((function(e){i.transparent.restoreObject(e)}));else if("highLight"===t)a.forEach((function(e){i.outLine.highLight2(e,null,!0)}));else if("flash"===t)a.forEach((function(e){i.outLine.highLight3(e,null,!0)}));else if("color"===t)a.forEach((function(e){i.color.restoreObject3DColor(e)}));else if("overColor"===t)a.forEach((function(e){i.color.restoreObject3DColor(e)}));else if("colorTransparent"===t)a.forEach((function(e){i.color.restoreObject3DColor(e)}));else if("colorBox"===t){var c=[];a.forEach((function(e){c.push(e.uuid)}));var h=c.join("-");this.color.removeObjectBoxById(h),u.forEach((function(e){if("colorBox"in e.userData){var t=e.userData.colorBox.indexOf(h);t>-1&&e.userData.colorBox.splice(t,1)}}))}else if("selectBorder"===t){var d=[];a.forEach((function(e){d.push(e.uuid)}));var p=d.join("-");this.selectBorderTool.removeSelectBorder(p),u.forEach((function(e){if("selectBorder"in e.userData){var t=e.userData.selectBorder.indexOf(p);t>-1&&e.userData.selectBorder.splice(t,1)}}))}else if("modelBox"===t){var f=[];a.forEach((function(e){f.push(e.uuid)}));var m=f.join("-");this.emptySelectEffectById(m),u.forEach((function(e){if("modelBox"in e.userData){var t=e.userData.modelBox.indexOf(m);t>-1&&e.userData.modelBox.splice(t,1)}}))}else"reset"===t?a.forEach((function(e){i.injectInstancedMeshFromMesh(e)})):"wireFrame"===t&&a.forEach((function(e){i.restoreWireFrameMaterial(e)}));return n&&n(),1}},{key:"setLightShadowFollowing2",value:function(e){if(e){this.lightInterval&&clearInterval(this.lightInterval);var t=this.bustard.core.cameraControls,n=this,r={x:n.light.defaultDirectionalLight.position.x,y:n.light.defaultDirectionalLight.position.y,z:n.light.defaultDirectionalLight.position.z},i=Math.sqrt(r.x*r.x+r.z*r.z);Math.atan(r.x/r.z),Math.PI,this.lightInterval=setInterval((function(){var e=t.getPosition(new THREE.Vector3),a=t.getTarget(new THREE.Vector3),o=180*Math.atan2(e.x-a.x,e.z-a.z)/Math.PI,s=Math.sin(Math.PI*o/180)*i,l=Math.cos(Math.PI*o/180)*i;n.light.defaultDirectionalLight.position.set(s,r.y,l)}),50)}else this.lightInterval&&(clearInterval(this.lightInterval),this.light.setdefaultLightProperty(this.defaultLightProperty),this.lightInterval=null)}},{key:"setSceneShadowStatus",value:function(e){this.light.defaultDirectionalLight.castShadow!=e&&(this.light.defaultDirectionalLight.castShadow=e,this.renderTool.setNeedUpdate())}},{key:"setLightShadowFollowing",value:function(e){if(e){this.lightInterval&&clearInterval(this.lightInterval);var t,n=this.bustard.core,r=n.cameraControls,i=n.renderer,a=this,o={x:a.light.defaultDirectionalLight.position.x,y:a.light.defaultDirectionalLight.position.y,z:a.light.defaultDirectionalLight.position.z},s=Math.sqrt(o.x*o.x+o.z*o.z),l=180*Math.atan(o.x/o.z)/Math.PI,u=!0;this.lightInterval=setInterval((function(){var e=r.getPosition(new THREE.Vector3),n=r.getTarget(new THREE.Vector3),c=180*Math.atan2(e.x-n.x,e.z-n.z)/Math.PI;if(t){var h=t-l;h>180&&(h-=360),h<-180&&(h+=360);var d=c-l;d>180&&(d-=360),d<-180&&(d+=360);var p=!1,f=1;if(d>=-45&&d<45?(f=1,(h>-135&&h<-45||h>45&&h<135)&&(p=!0)):d<=135&&d>45?(f=2,(h>-45&&h<45||h>135||h<-135)&&(p=!0)):d>=135?(f=3,(h>-135&&h<-45||h>45&&h<135)&&(p=!0)):d>=-135&&d<-45&&(f=4,(h>135||h<-135||h>-45&&h<45)&&(p=!0)),p){var m=Math.sin(Math.PI*(l+90*(f-1))/180)*s,v=Math.cos(Math.PI*(l+90*(f-1))/180)*s;a.light.defaultDirectionalLight.position.set(m,o.y,v),i.shadowMap.needsUpdate=!0}if(u){var g=Math.sin(Math.PI*(l+90*(f-1))/180)*s,y=Math.cos(Math.PI*(l+90*(f-1))/180)*s;a.light.defaultDirectionalLight.position.set(g,o.y,y),i.shadowMap.needsUpdate=!0}u=!1}t=c}),50)}else this.lightInterval&&(clearInterval(this.lightInterval),this.light.setdefaultLightProperty(this.defaultLightProperty),this.lightInterval=null)}},{key:"getSceneSize",value:function(){var e=this.bustard.core.getCenterAndSize(this.bustard.core.scene);return{center:e.center,size:e.size}}},{key:"setFirstPersonRoamConfig",value:function(e,t){this.bustard.core.enablekey[e]=t}},{key:"setSelectStyle",value:function(e){e.meshTouch&&(this.cursorValue.meshTouch=e.meshTouch),e.default&&(this.cursorValue.default=e.default)}},{key:"updateModelParent",value:function(e,t){var n=this,r=this.loader.modelMap.get(e);if(r){var i=this.bustard.core.getObject3dPosition(r),a=[];t.forEach((function(e){var t=n.loader.modelMap.get(e);t&&a.push(t)}));var o=this.bustard.core.getIntersectionObjectsByPositions(i,{x:i.x,y:i.y-1,z:i.z},a),s=[];return o.forEach((function(e){var t,n=e.instanceId,r=e.object,i=[];null==n?(t=r.userData.modelName,(0,R.getNodeTree)(i,r,t)):(t=r.userData.modelName[n],r.userData.name&&r.userData.name[n]&&i.push({id:t,name:r.userData.name[n]}),(0,R.getNodeTree)(i,r.userData.parent[n],t)),s.push(i)})),s}}},{key:"isInBox",value:function(e,t){var n=this,r=this.loader.modelMap.get(e);if(!r)return!1;var i=this.bustard.core.getObject3dPosition(r),a=[];return t.forEach((function(e){var t,r=n.loader.modelMap.get(e.id);r&&(e.name?e.name.indexOf("/")>-1?t=n.bustard.core.getModelNodeByPathNames(r,e.name,!1):(t=n.bustard.core.getModelNodeByName(r,e.name,!1))||(t=n.bustard.core.getModelMeshByName(r,e.name)):t=r,t&&a.push(t))})),a.length>0&&this.bustard.core.bbox3(a).containsPoint(i)}},{key:"modelFadeOut",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,r=this;e.children.length?e.children.forEach((function(e){t.modelFadeOut(e,n)})):"Mesh"===e.type&&(e.userData.defaultOpacity||(e.userData.oldMaterial=e.material,e.oldCastShadow=e.castShadow,e.material=e.material.clone(),e.userData.defaultOpacity=e.material.opacity),e.material.transparent=!0,e.userData.fadeTween&&e.userData.fadeTween.stop(),e.userData.fadeTween=new c.default.Tween(e.material).to({opacity:0},n).onComplete((function(t){e.visible=!1,e.castShadow=!1,r.bustard.core.renderer.shadowMap.needsUpdate=!0,e.userData.fadeTween=null})).start())}},{key:"modelFadeIn",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,r=this;e.children.length?e.children.forEach((function(e){t.modelFadeIn(e,n)})):"Mesh"===e.type&&e.userData.defaultOpacity&&(e.material.transparent=!0,e.visible=!0,e.userData.fadeTween&&e.userData.fadeTween.stop(),e.userData.fadeTween=new c.default.Tween(e.material).to({opacity:e.userData.defaultOpacity},n).onComplete((function(t){e.userData.defaultOpacity=null,e.castShadow=e.oldCastShadow,e.material=e.userData.oldMaterial,r.bustard.core.renderer.shadowMap.needsUpdate=!0,e.userData.fadeTween=null})).start())}},{key:"openOcclusionHide",value:function(e,t){var n=this;if(!t)throw Error("没有配置hideModelConfig，请在config中配置");var r=t.objects,i=t.positions,a=t.time,o=[],s=[],l=!0;r.forEach((function(e){if(e.id){var t,r=n.loader.modelMap.get(e.id);r&&(s.push(e.id),e.name?(e.name.indexOf("/")>-1?t=n.bustard.core.getModelNodeByPathNames(r,e.name,l):(t=n.bustard.core.getModelNodeByName(r,e.name,l))||(t=n.bustard.core.getModelMeshByName(r,e.name)),t&&(t.userData.notReset=!0,o.push(t))):(l&&n.bustard.core.resetObject3DFromAllInstances(r),r.userData.notReset=!0,o.push(r)))}})),o.length>0&&!this.interval[e]&&(this.interval[e]=setInterval((function(){var e=[];i.forEach((function(t){for(var r=n.bustard.core.getFirstIntersectionObjectByPosition(t,o),i=0,a=r.length;i<a;i++){var l=r[i],u=(0,R.getModelByMesh)(l.object);if((0,R.isChildByScene)("实体大楼",l.object)||(0,R.isChildByScene)("土建",l.object))break;s.indexOf(u.name)>-1&&e.push(l.object)}})),o.forEach((function(t){for(var r=!1,i=0,a=e.length;i<a;i++)if((0,R.isParent)(t,e[i])){r=!0;break}r?n.modelFadeOut(t,500):n.modelFadeIn(t,500)}))}),a))}},{key:"openOcclusionHide2",value:function(e,t){var n=this;if(!t)throw Error("没有配置hideModelConfig，请在config中配置");var r=t.objects,i=t.time,a=-135,o=-45;t&&"minAngle"in t&&(a=t.minAngle),t&&"maxAngle"in t&&(o=t.maxAngle);var s=[],l=[],u=!0;r.forEach((function(e){if(e.id){var t,r=n.loader.modelMap.get(e.id);r&&(l.push(e.id),e.name?(e.name.indexOf("/")>-1?t=n.bustard.core.getModelNodeByPathNames(r,e.name,u):(t=n.bustard.core.getModelNodeByName(r,e.name,u))||(t=n.bustard.core.getModelMeshByName(r,e.name)),t&&(t.userData.notReset=!0,s.push(t))):(u&&n.bustard.core.resetObject3DFromAllInstances(r),r.userData.notReset=!0,s.push(r)))}})),s.length>0&&!this.interval[e]&&(this.interval[e]=setInterval((function(){var e=n.cameraController.getPosition(new THREE.Vector3),t=n.cameraController.getTarget(new THREE.Vector3),r=180*Math.atan2(e.x-t.x,e.z-t.z)/Math.PI;s.forEach((function(e){r<o&&r>a?n.modelFadeOut(e,500):n.modelFadeIn(e,500)}))}),i))}},{key:"closeOcclusionHide",value:function(e,t){var n=this;if(this.interval[e]&&(window.clearInterval(this.interval[e]),delete this.interval[e],t)){var r=t.objects,i=[],a=[],o=!0;r.forEach((function(e){if(e.id){var t,r=n.loader.modelMap.get(e.id);r&&(a.push(e.id),e.name?(e.name.indexOf("/")>-1?t=n.bustard.core.getModelNodeByPathNames(r,e.name,o):(t=n.bustard.core.getModelNodeByName(r,e.name,o))||(t=n.bustard.core.getModelMeshByName(r,e.name)),t&&(t.userData.notReset=!0,i.push(t))):(o&&n.bustard.core.resetObject3DFromAllInstances(r),r.userData.notReset=!0,i.push(r)))}})),i.length>0&&i.forEach((function(e){n.modelFadeIn(e,500),n.injectInstancedMeshFromMesh(e)}))}}},{key:"occlusionHide",value:function(e,t,n){this.occlusionHideTool.occlusionHide(e,t,n)}},{key:"occlusionShow",value:function(){this.occlusionHideTool.occlusionShow()}},{key:"transparentMaterial",value:function(e,t,n){var r,i=this.loader.modelMap.get(e);i&&i.traverse((function(e){"Mesh"===e.type&&e.material.name==t&&((r=e.material).transparent=n<1,r.opacity=n)}))}},{key:"setWireFrameMaterial",value:function(e,t,n){var r=this,i=new Map;e.traverse((function(e){if("Mesh"===e.type&&"MeshStandardMaterial"===e.material.type&&!r.materialMap.get(e.uuid)){if(!i.get(e.material.uuid)){var a=r.getWireFrameMaterial(e.material.name);i.set(e.material.uuid,{material:e.material.clone(),wireFrameMaterial:new THREE.MeshStandardMaterial({name:e.material.name,transparent:!0,opacity:a.opacity*n,color:new THREE.Color(a.color),metalness:a.metalness,roughness:a.roughness,depthWrite:t})})}r.materialMap.set(e.uuid,{mesh:e,material:i.get(e.material.uuid).material}),e.material=i.get(e.material.uuid).wireFrameMaterial}}))}},{key:"restoreWireFrameMaterial",value:function(e){var t=this;e.traverse((function(e){if("Mesh"===e.type&&"MeshStandardMaterial"===e.material.type){var n=t.materialMap.get(e.uuid);n&&(n.mesh.material=n.material,t.materialMap.delete(e.uuid))}}))}},{key:"getWireFrameMaterial",value:function(e){var t={metalness:.4,roughness:.7,color:"rgb(74,136,168)",opacity:.2};for(var n in this.wireframeMatreialMap)if(e.indexOf(n)>-1){t=this.wireframeMatreialMap[n];break}return t}},{key:"clearWireFrameMaterial",value:function(){this.materialMap.forEach((function(e,t){e.mesh.material=e.material})),this.materialMap.clear()}},{key:"hideByClip",value:function(e,t,n,r){e.traverse((function(e){"Mesh"===e.type&&(e.material=e.material.clone())}));var i,a,o=this.bustard.use(new h.default.Clip2(e));0==t?(i={value:o.boxBorder[0]},a={value:-o.boxBorder[1]}):1==t?(a={value:o.boxBorder[0]},i={value:-o.boxBorder[1]}):2==t?(i={value:o.boxBorder[2]},a={value:-o.boxBorder[3]}):3==t?(a={value:o.boxBorder[2]},i={value:-o.boxBorder[3]}):4==t?(i={value:o.boxBorder[4]},a={value:-o.boxBorder[5]}):5==t&&(a={value:o.boxBorder[4]},i={value:-o.boxBorder[5]}),new c.default.Tween(i).to(a,n).easing(c.default.Easing.Linear.None).onStart((function(e){})).onUpdate((function(e){0==t?o.clipXPlus(e.value):1==t?o.clipXSub(e.value):2==t?o.clipYPlus(e.value):3==t?o.clipYSub(e.value):4==t?o.clipZPlus(e.value):5==t&&o.clipZSub(e.value)})).onComplete((function(e){r&&r()})).start()}},{key:"showByClip",value:function(e,t,n,r){e.traverse((function(e){"Mesh"===e.type&&(e.material=e.material.clone())}));var i,a,o=this.bustard.use(new h.default.Clip2(e));0==t?(i={value:o.boxBorder[0]},a={value:-o.boxBorder[1]}):1==t?(a={value:o.boxBorder[0]},i={value:-o.boxBorder[1]}):2==t?(i={value:o.boxBorder[2]},a={value:-o.boxBorder[3]}):3==t?(a={value:o.boxBorder[2]},i={value:-o.boxBorder[3]}):4==t?(i={value:o.boxBorder[4]},a={value:-o.boxBorder[5]}):5==t&&(a={value:o.boxBorder[4]},i={value:-o.boxBorder[5]}),new c.default.Tween(a).to(i,n).easing(c.default.Easing.Linear.None).onStart((function(e){})).onUpdate((function(e){0==t?o.clipXPlus(e.value):1==t?o.clipXSub(e.value):2==t?o.clipYPlus(e.value):3==t?o.clipYSub(e.value):4==t?o.clipZPlus(e.value):5==t&&o.clipZSub(e.value)})).onComplete((function(e){r&&r()})).start()}},{key:"setBeforeRenderCallback",value:function(e){this.bustard.core.addBeforeRenderCallback(e)}},{key:"removeBeforeRenderCallback",value:function(e){this.bustard.core.removeBeforeRenderCallback(e)}},{key:"removeAllBeforeRenderCallback",value:function(){this.bustard.core.removeAllBeforeRenderCallback()}},{key:"setAfterRenderCallback",value:function(e){this.bustard.core.addAfterRenderCallback(e)}},{key:"removeAfterRenderCallback",value:function(e){this.bustard.core.removeAfterRenderCallback(e)}},{key:"removeAllAfterRenderCallback",value:function(){this.bustard.core.removeAllAfterRenderCallback()}},{key:"setCesiumBackground",value:function(e,t){if(e){e.endEffectAnimation();var n=this.bustard.core.getCamera(),r=this.bustard.core.getCameraControls(),i=n.aspect;if(i<1){var a=Math.PI*(n.fov/180);e.setCameraFov(a)}else{var o=Math.PI*(n.fov/180),s=2*Math.atan(Math.tan(.5*o)*i);e.setCameraFov(s)}var l=function(){var i=r.getPosition(new THREE.Vector3,!1),a=n.matrixWorld.clone();a.setPosition(i);var o=new THREE.Vector3(0,0,0).applyMatrix4(a),s=new THREE.Vector3(0,600,0).applyMatrix4(a),l=r.getTarget(new THREE.Vector3,!1),u=t(o),c=t(s),h=t(l),d=(new THREE.Vector3).subVectors(h,u).normalize(),p=(new THREE.Vector3).subVectors(c,u).normalize();e.setViewByUpAndDirection(u,{direction:d,up:p}),e.viewer.render()};this.setAfterRenderCallback(l),this.renderTool.setNeedUpdate()}}},{key:"showModelWireLine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6710886,n=new THREE.LineBasicMaterial({color:t}),r=[];e.traverse((function(e){if("Mesh"==e.type)if(e.count)for(var t=0;t<e.count;t++){var n;(n=new THREE.EdgesGeometry(e.geometry,30)).applyMatrix4(e.userData.matrix[t]),r.push(n)}else(n=new THREE.EdgesGeometry(e.geometry,30)).applyMatrix4(e.matrixWorld.clone()),r.push(n)}));var i=this.bustard.core.mergeBufferGeometries(r),a=new THREE.LineSegments(i,n);this.bustard.core.scene.add(a)}},{key:"closeCameraControlAnimation",value:function(){var e=this.bustard.core.getCameraControls();e.draggingDampingFactor=1,e.dampingFactor=1}},{key:"openCameraControlAnimation",value:function(){var e=this.bustard.core.getCameraControls();e.draggingDampingFactor=.25,e.dampingFactor=.05}},{key:"setPickControlBlock",value:function(e){this.pick.blockWhenCtrl=e}},{key:"setWebglContextLostCallback",value:function(e){this.bustard.core.renderer.domElement.addEventListener("webglcontextlost",(function(t){t.preventDefault(),e&&e()}),!1)}},{key:"getScreenPosition",value:function(e){return this.bustard.core.computeScreenCoord((0,D.toVevtor3)(e))}},{key:"addAirConditionerWind",value:function(e,t,n){var r=this;if(-1==e.indexOf("MCYB_A04.02.12.01"))return 0;if(this.AirConditionerWind.get(e))return 0;var i=this.loader.modelMap.get(e);if(i){var a,o=this.bustard.core.getCenterAndSize2([i]).center,s="MCYB_A04.02.12.01.01";if((a=this.bustard.core.getModelNodeByQueryName(i,s,!1))||(a=this.bustard.core.getModelMeshByQueryName(i,s)),a){var l,u=this.bustard.core.getAutoBox([a],1),c=u.box,h=u.rotationY,d=u.position,p=Math.atan2(d.z-o.z,d.x-o.x),f=c.getSize(new THREE.Vector3),m=[],v=null!==(l=null==n?void 0:n.number)&&void 0!==l?l:30,g=new THREE.Matrix4,y=new THREE.Euler(0,h,0);g.compose(d,(new THREE.Quaternion).setFromEuler(y),new THREE.Vector3(1,1,1));var x=f.x>f.z?f.x/2:f.z/2;if(f.x>f.z)for(var b=f.x/(v+1),M=1;M<=v;M++){var w=new THREE.Vector3(-f.x/2+b*M,0,0);w.applyMatrix4(g),m.push(w)}else for(var _=f.z/(v+1),A=1;A<=v;A++){var C=new THREE.Vector3(0,0,-f.z/2+_*A);C.applyMatrix4(g),m.push(C)}return this.AirConditionerWind.set(e,[]),m.forEach((function(i,a){var o=Math.atan2(i.z-d.z,i.x-d.x),s=Math.sqrt(Math.pow(i.z-d.z,2)+Math.pow(i.x-d.x,2))/x,l={x:i.x+.25*Math.cos(p)+.05*Math.cos(o)*s,y:i.y-.2,z:i.z+.25*Math.sin(p)+.05*Math.sin(o)*s},u={x:i.x+.5*Math.cos(p)+.1*Math.cos(o)*s,y:i.y-.3,z:i.z+.5*Math.sin(p)+.1*Math.sin(o)*s},c={x:i.x+.75*Math.cos(p)+.15*Math.cos(o)*s,y:i.y-.4,z:i.z+.75*Math.sin(p)+.15*Math.sin(o)*s};a%2==0?(r.addPathLine(e+a,[c,u,l,i],t,H(H({},n),{},{offsetX:Math.random()})),r.AirConditionerWind.get(e).push(e+a)):(r.addPathLine(e+a,[u,l,i],t,H(H({},n),{},{width:n.width/2,offsetX:Math.random()})),r.AirConditionerWind.get(e).push(e+a))})),1}}}},{key:"removeAirConditionerWind",value:function(e){var t=this;if(e){var n=this.AirConditionerWind.get(e);n&&(n.forEach((function(e){t.removePathLineByName(e)})),this.AirConditionerWind.delete(e))}else this.AirConditionerWind.forEach((function(e,n){e.forEach((function(e){t.removePathLineByName(e)}))})),this.AirConditionerWind.clear()}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},5084:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(4012),n(2026)],void 0===(a="function"==typeof(r=function(e,t,r){"use strict";var i=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.Context=void 0,t=i(t),r=i(r),e.Context=(0,t.default)((function e(t){(0,r.default)(this,e),this.code=t.code,this.rootCode=t.rootCode,this.codeName=t.codeName,this.contextBehavior=t.contextBehavior,this.children=[],this.parent=null,this.level=1}))})?r.apply(t,i):r)||(e.exports=a)},2405:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(791),n(6940),n(2026),n(4012),n(5220),n(8552)],r=function(e,t,r,i,a,o,s){"use strict";var l=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.FirstPersonRoam=void 0,t=l(t),r=l(r),i=l(i),a=l(a),o=l(o),e.FirstPersonRoam=function(){function e(n){var a=this;(0,i.default)(this,e),(0,o.default)(this,"modelCalculator",void 0),(0,o.default)(this,"isPause",!1),(0,o.default)(this,"pasueCameraPosition",null),(0,o.default)(this,"mixer",null),(0,o.default)(this,"pickAction",(function(e){var n=e.point;if(a._isOpenFirst&&!a.isAddPerson){a.modelCalculator.isOpenFirst=!1,a.modelCalculator.content.style.cursor="default",a.modelCalculator.setMouseButtonsState("right",0);var i=(180*a.modelCalculator.cameraController.azimuthAngle/Math.PI-180)*Math.PI/180,o={x:n.x,y:n.y+1.8,z:n.z},s=new THREE.Vector3(4*Math.sin(Math.PI/2)*Math.sin(a.modelCalculator.cameraController.azimuthAngle)+o.x,4*Math.cos(Math.PI/2)+o.y,4*Math.sin(Math.PI/2)*Math.cos(a.modelCalculator.cameraController.azimuthAngle)+o.z),l=new Promise((function(e){a.modelCalculator.lerpLookAt(s,o,void 0,void 0,(function(){e()}))})),u=!1,c=new Promise(function(){var e=(0,r.default)(t.default.mark((function e(r){var o,s,l,c,h,d;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={x:n.x,y:n.y+1.8,z:n.z},s={x:n.x+.1*Math.sin(a.modelCalculator.cameraController.azimuthAngle),y:n.y+1.8,z:n.z+.1*Math.cos(a.modelCalculator.cameraController.azimuthAngle)},(l=a.modelCalculator.bustard.core.getFirstIntersectionObjectByPositions(s,o,.11))&&l.length>0&&(n={x:n.x+.1*Math.sin(a.modelCalculator.cameraController.azimuthAngle),y:n.y,z:n.z+.1*Math.cos(a.modelCalculator.cameraController.azimuthAngle)},u=!0),e.next=6,a.addGLTFModelByUrl(a.config.personUrl,a.personName,n);case 6:(c=e.sent).rotation.y=i,h=a.modelCalculator.loader.actions[a.personName][0].value,(d=a.modelCalculator.loader.actions[a.personName][1].value).timeScale=.6,a.model=c,a.stopMix=h,a.walkMix=d,a.stopMix.play(),r(c);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());Promise.all([c,l]).then((function(){if(a.modelCalculator.cameraController.addEventListener("update",a.updateAction),a.modelCalculator.cameraController.addEventListener("sleep",a.sleepAction),window.addEventListener("keydown",a.keydownFn),window.addEventListener("keyup",a.keyupFn),u){var e=new KeyboardEvent("keydown",{key:"s",code:"KeyS",keyCode:83,which:83,bubbles:!0,cancelable:!0});document.dispatchEvent(e)}a.setPositionCallback&&a.setPositionCallback(o)})),a.isAddPerson=!0}})),(0,o.default)(this,"updateAction",(function(){if(a.model&&!a.isPause){a.model.position.set(a.modelCalculator.cameraController._target.x,a.modelCalculator.cameraController._target.y-1.8,a.modelCalculator.cameraController._target.z);var e=(180*a.modelCalculator.cameraController.azimuthAngle/Math.PI-180)*Math.PI/180;if(a.model.rotation.y=e,a.walkMix.isRunning()||(a.stopMix.stop(),a.walkMix.play()),!(a.keyWDown||a.keySDown||a.keyADown||a.keyDDown)){var t=a.modelCalculator.cameraController.getPosition(),n=a.modelCalculator.cameraController.getTarget(),r=a.modelCalculator.bustard.core.getFirstIntersectionObjectByPositions(n,t,a.modelCalculator.cameraController.distance);if(r&&r.length>0){var i=r[0].distance;i<4&&(i=.01),a.modelCalculator.cameraController.distance=i}}}})),(0,o.default)(this,"sleepAction",(function(){a.model&&!a.isPause&&(a.keyWDown||a.keySDown||a.keyADown||a.keyDDown||(a.walkMix.stop(),a.stopMix.play()))})),(0,o.default)(this,"keyDownWalk",(function(){a.keyWDown||a.keySDown||a.keyADown||a.keyDDown?a.walkMix.isRunning()||(a.stopMix.stop(),a.walkMix.play()):(a.walkMix.stop(),a.stopMix.play())})),(0,o.default)(this,"keydownFn",(function(e){if(a.model&&!a.isPause&&1!=a.runStatus){var t=(180*a.modelCalculator.cameraController.azimuthAngle/Math.PI-180)*Math.PI/180,n=a.modelCalculator.cameraController.getPosition(),r=a.modelCalculator.cameraController._target.x,i=a.modelCalculator.cameraController._target.y-1.8,o=a.modelCalculator.cameraController._target.z,s=null;switch(e.code){case"KeyW":a.keyWDown=!0,s=t;break;case"KeyS":a.keySDown=!0,s=t+Math.PI;break;case"KeyA":a.keyADown=!0,s=t+Math.PI/2;break;case"KeyD":a.keyDDown=!0,s=t-Math.PI/2;break;default:return}if(r+=.5*Math.sin(s),o+=.5*Math.cos(s),a.keyDownWalk(),a.gravityDetection){var l=a.modelCalculator.bustard.core.getFirstIntersectionObjectByPositions({x:r,y:i+1.8,z:o},{x:r,y:i,z:o},Number.POSITIVE_INFINITY);l&&l.length>0&&l[0].distance>.5&&(i=l[0].point.y,Math.abs(l[0].point.y-i))}var u=a.modelCalculator.cameraController.getTarget(),c=null,h=!1;if("KeyS"==e.code){var d=a.modelCalculator.bustard.core.getFirstIntersectionObjectByPositions(u,n,4);d&&d.length>0&&(c=d[0].distance,h=!0)}else{var p=a.modelCalculator.bustard.core.getFirstIntersectionObjectByPositions(u,n,a.modelCalculator.cameraController.distance);p&&p.length>0&&(c=p[0].distance)}var f=a.modelCalculator.bustard.core.getFirstIntersectionObjectByPositions(a.modelCalculator.cameraController._target,{x:r,y:a.modelCalculator.cameraController._target.y,z:o},.5);if(f&&f.length>0){if(a.collisionDetection)return;a.runStatus=1,a.modelCalculator.autoRoam.lerpLookAt({x:r-.01*Math.sin(t),y:i+1.8,z:o-.01*Math.cos(t)},{x:r,y:i+1.8,z:o},a.speed/.05,!1,(function(){a.runStatus=0}))}else"KeyS"!=e.code||h||(a.modelCalculator.cameraController.polarAngle=90*Math.PI/180,a.modelCalculator.cameraController.distance=4),a.runStatus=1,c?(c<4&&(c=.01),a.modelCalculator.autoRoam.moveToByDistance({x:r,y:i+1.8,z:o},c,a.speed/.05,(function(){a.runStatus=0}))):("KeyW"==e.code||"KeyS"==e.code)&&a.modelCalculator.cameraController.distance<4?a.modelCalculator.autoRoam.lookAt({x:n.x,y:i+1.8,z:n.z},{x:r,y:i+1.8,z:o},a.speed/.05,(function(){a.runStatus=0})):a.modelCalculator.autoRoam.moveTo({x:r,y:i+1.8,z:o},a.speed/.05,(function(){a.runStatus=0}))}})),(0,o.default)(this,"keyupFn",(function(e){if(a.model&&!a.isPause){switch(e.code){case"KeyW":a.keyWDown=!1;break;case"KeyS":a.keySDown=!1;break;case"KeyA":a.keyADown=!1;break;case"KeyD":a.keyDDown=!1}a.keyDownWalk()}})),this.modelCalculator=n,this._isOpenFirst=!1,this.isAddPerson=!1,this.keyWDown=!1,this.keySDown=!1,this.keyADown=!1,this.keyDDown=!1,this.gravityDetection=!0,this.collisionDetection=!0,this.speed=.06,this.personName="firstPerson",this.runStatus=0}return(0,a.default)(e,[{key:"isOpenFirst",get:function(){return this._isOpenFirst}},{key:"openFirst",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{personUrl:"./lib/models/walk.glb",cursor:"url(./lib/resource/etc/person.svg);",speed:.02,setPositionCallback:function(){}},t=e.speed,n=void 0===t?.02:t,r=e.setPositionCallback;this.speed=n,this.setPositionCallback=r,this.config=e,this._isOpenFirst||(this._isOpenFirst=!0,this.modelCalculator.isOpenFirst=!0,this.modelCalculator.content.style.cursor=e.cursor)}},{key:"addGLTFModelByUrl",value:function(e,t,n){var r=this,i=this.modelCalculator.loader.getCore(),a=i.gltfAddScene,o=i.mixers;return new Promise((function(i,s){r.modelCalculator.loader.gltfLoader.load(e,(function(e){var s=e.scene;s.name=t,s.position.set(n.x,n.y,n.z),a(s,t),s.traverse((function(e){e.frustumCulled=!1}));var l=e.animations;if(l.length){var u=new THREE.AnimationMixer(s);r.modelCalculator.loader.actions[t]=[],l.forEach((function(e){r.modelCalculator.loader.actions[t].push({name:e.name,value:u.clipAction(THREE.AnimationUtils.subclip(e,e.name,0,30))}),r.modelCalculator.loader.actions[t].push({name:e.name,value:u.clipAction(THREE.AnimationUtils.subclip(e,e.name,31,61))})})),o.set(t,u),r.mixer=u}r.modelCalculator.loader.modelMap.set(t,s),i(s)}))}))}},{key:"closeFirst",value:function(){this.isPause=!1,window.removeEventListener("keydown",this.keydownFn),window.removeEventListener("keyup",this.keyupFn),this.modelCalculator.cameraController.removeEventListener("update",this.updateAction),this.modelCalculator.cameraController.removeEventListener("sleep",this.sleepAction),this._isOpenFirst=!1,this.modelCalculator.content.style.cursor="default";var e=this.modelCalculator.loader.modelMap.get(this.personName);this.modelCalculator.loader.modelMap.delete(this.personName),this.modelCalculator.loader.treeMap.delete(this.personName),this.modelCalculator.bustard.core.mixers.delete(this.personName),e&&this.modelCalculator.bustard.core.dispose(e),this.model=null,this.mixer=null,this.walkMix=null,this.stopMix=null,this.modelCalculator.loader.actions[this.personName]=[],this.isAddPerson=!1,this.modelCalculator.setMouseButtonsState("right",2),this.modelCalculator.setNeedUpdate()}},{key:"openGravityDetection",value:function(){this.gravityDetection=!0}},{key:"closeGravityDetection",value:function(){this.gravityDetection=!1}},{key:"openCollisionDetection",value:function(){this.collisionDetection=!0}},{key:"closeCollisionDetection",value:function(){this.collisionDetection=!1}},{key:"isManSet",value:function(){return this.isAddPerson}},{key:"pauseFirst",value:function(){this.model&&(this.model.visible=!1,this.modelCalculator.bustard.core.mixers.delete(this.personName),this.modelCalculator.setNeedUpdate()),this.modelCalculator.setMouseButtonsState("right",2),this.pasueCameraPosition=this.modelCalculator.getCameraPosition(),this.isPause=!0}},{key:"resumeFirst",value:function(){if(this.model&&(this.model.visible=!0,this.modelCalculator.bustard.core.mixers.set(this.personName,this.mixer)),this.modelCalculator.setMouseButtonsState("right",0),this.pasueCameraPosition){var e=this.pasueCameraPosition,t=e.position,n=e.target;this.modelCalculator.lerpLookAt(t,n,0),this.pasueCameraPosition=null}this.isPause=!1}},{key:"destroy",value:function(){window.removeEventListener("keydown",this.keydownFn),window.removeEventListener("keyup",this.keyupFn),this.modelCalculator=null}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},6193:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(4012),n(2026)],void 0===(a="function"==typeof(r=function(e,t,r){"use strict";var i=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.LogicTree=void 0,t=i(t),r=i(r),e.LogicTree=(0,t.default)((function e(t){(0,r.default)(this,e),this.code=t.code,this.rootCode=t.rootCode,this.codeName=t.codeName,this.position=t.position,this.rotation=t.rotation,this.scale=t.scale,this.url=t.url,this.type=t.type,this.isContext=t.isContext,this.children=[],this.level=1,this.statusCodes=[],this.statusCode="",this.parent=null,this.contentRootCode="",this.contentCode="",this.userData=t.userData,this.focusView=t.focusView,this.isFolder=!1,(t.rootCode.includes("MCYB_F00")||t.rootCode.includes("MCYB_A00"))&&(this.isFolder=!0)}))})?r.apply(t,i):r)||(e.exports=a)},6885:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220)],r=function(e,t,r,i){"use strict";var a=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.MultipleSelectTool=void 0,t=a(t),r=a(r),i=a(i),e.MultipleSelectTool=function(){function e(n){(0,t.default)(this,e),(0,i.default)(this,"mulMouseDown",(function(){})),(0,i.default)(this,"marqueeSelect",(function(){})),(0,i.default)(this,"mulMouseUp",(function(){})),(0,i.default)(this,"threeBase",void 0),this.threeBase=n}return(0,r.default)(e,[{key:"styleCreate",value:function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];e.style[i]=t[i]}}},{key:"multipleSelect",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this,i=new Map;this.threeBase.loader.modelMap.forEach((function(e){if(n){for(var t=new THREE.Box3,r=e.children[0].children.length,a=function(){for(var n=new THREE.Box3,r=e.children[0].children[o].children.length,a=function(){for(var r=new THREE.Box3,a=e.children[0].children[o].children[s],l=a.children.length,u=0;u<l;u++){var c=new THREE.Box3;c.setFromObject(a.children[u]),i.set(a.children[u].name,c),r.union(c),n.union(c),t.union(c)}"instancedMeshes"in a.userData&&!a.userData.isReset&&a.userData.instancedMeshes.forEach((function(e){var a=e.mesh,o=e.id;if(a.userData.meshVisible[o]&&a.userData.isShowArr[o]){a.updateWorldMatrix(!1,!1);var s=a.geometry;if(void 0!==s){null===s.boundingBox&&s.computeBoundingBox();var l=new THREE.Box3;l.copy(s.boundingBox),l.applyMatrix4(a.userData.matrix[o]).applyMatrix4(a.matrixWorld),i.set(a.userData.name[o],l),r.union(l),n.union(l),t.union(l)}}})),i.set(a.name,r)},s=0;s<r;s++)a();i.set(e.children[0].children[o].name,n)},o=0;o<r;o++)a();i.set(e.name,t)}else for(var s=e.children[0].children.length,l=0;l<s;l++){var u=new THREE.Box3;u.setFromObject(e.children[0].children[l]),i.set(e.children[0].children[l].name,u)}}));var a=this.threeBase.content,o=this.threeBase.cameraController,s=this.threeBase.bustard.core.width,l=this.threeBase.bustard.core.height,u=this.threeBase.bustard.core.camera,c={},h=!1,d=!1,p=document.createElement("div");p.id="select-marquee";var f={position:"absolute",top:"-2px",left:"-2px",zIndex:9999,height:"0px",width:"10px",backgroundColor:"rgba(208, 255, 242, 0.5)",border:"solid 2px #00825e",margin:0,padding:0,pointerEvents:"none"};function m(){o.enabled=!0,h=!1,p.style.display="none",p.style.width=0,p.style.height=0,c={}}function v(e,t){var n,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a={},o={},s=[];return a.x=e.x,a.y=e.y,o.x=c.x,o.y=c.y,n=x(a,c),r.threeBase.loader.modelMap.forEach((function(e){if(i){var r=t.get(e.name);if(g(e.name,r,n))s.push({id:e.name});else for(var a=e.children[0].children.length,o=0;o<a;o++){var l=t.get(e.children[0].children[o].name);if(g(e.children[0].children[o].name,l,n))s.push({id:e.name,name:e.children[0].children[o].name});else for(var u=e.children[0].children[o].children.length,c=0;c<u;c++){var h=e.children[0].children[o].children[c],d=t.get(h.name);if(g(h.name,d,n))s.push({id:e.name,name:h.name});else{for(var p=h.children.length,f=0;f<p;f++){var m=t.get(h.children[f].name);g(h.children[f].name,m,n)&&s.push({id:e.name,name:h.children[f].name})}"instancedMeshes"in h.userData&&!h.userData.isReset&&h.userData.instancedMeshes.forEach((function(r){var i=r.mesh,a=r.id;if(i.userData.meshVisible[a]&&i.userData.isShowArr[a]){i.updateWorldMatrix(!1,!1);var o=i.geometry;if(void 0!==o){null===o.boundingBox&&o.computeBoundingBox();var l=t.get(i.userData.name[a]);g(i.userData.name[a],l,n)&&s.push({id:e.name,name:i.userData.name[a]})}}}))}}}}else for(var v=e.children[0].children.length,y=0;y<v;y++){var x=t.get(e.children[0].children[y].name);g(e.children[0].children[y].name,x,n)&&s.push({id:e.name,name:e.children[0].children[y].name})}})),s}function g(e,t,n){var r=b(t.min),i=b(t.max);return y(r,n)&&y(i,n)}function y(e,t){var n=t.origin.x,r=t.origin.x+t.delta.x,i=t.origin.y,a=t.origin.y+t.delta.y;return e.x>=n&&e.x<=r&&e.y>=i&&e.y<=a}function x(e,t){var n={},r={};return e.y<t.y?(n.y=e.y,r.y=t.y-e.y):(n.y=t.y,r.y=e.y-t.y),e.x<t.x?(n.x=e.x,r.x=t.x-e.x):(n.x=t.x,r.x=e.x-t.x),{origin:n,delta:r}}function b(e){var t=e.clone(),n=new THREE.Matrix4;return n.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),t.applyMatrix4(n),{x:(t.x+1)*s/2,y:(1-t.y)*l/2}}this.styleCreate(p,f),a.appendChild(p),this.mulMouseDown=function(e){if(!e.ctrlKey||0!==e.button)return!1;o.enabled=!1;var t={};h=!0,d=!1,(c={}).x=e.layerX,c.y=e.layerY,t.x=e.layerX/s*2-1,t.y=-e.layerY/l*2+1,new THREE.Vector3(t.x,t.y,1).unproject(u)},this.marqueeSelect=function(e){if(!e.ctrlKey||0!==e.button)return m(),!1;if(h){d=!0,p.style.display="block";var t={};t.x=e.layerX-c.x,t.y=e.layerY-c.y,t.x<0&&t.y<0?(p.style.left="".concat(e.layerX,"px"),p.style.width="".concat(-t.x,"px"),p.style.top="".concat(e.layerY,"px"),p.style.height="".concat(-t.y,"px")):t.x>=0&&t.y<=0?(p.style.left="".concat(c.x,"px"),p.style.width="".concat(t.x,"px"),p.style.top="".concat(e.layerY,"px"),p.style.height="".concat(-t.y,"px")):t.x>=0&&t.y>=0?(p.style.left="".concat(c.x,"px"),p.style.width="".concat(t.x,"px"),p.style.height="".concat(t.y,"px"),p.style.top="".concat(c.y,"px")):t.x<0&&t.y>=0&&(p.style.left="".concat(e.layerX,"px"),p.style.width="".concat(-t.x,"px"),p.style.height="".concat(t.y,"px"),p.style.top="".concat(c.y,"px"))}},this.mulMouseUp=function(r){if(!r.ctrlKey||0!==r.button||!d)return m(),!1;d=!1,t.threeBase.clearSelectOnTop();var a=v({x:r.layerX,y:r.layerY},i,n);e&&e(a),m()},a.addEventListener("mousedown",this.mulMouseDown,!1),a.addEventListener("mousemove",this.marqueeSelect,!1),a.addEventListener("mouseup",this.mulMouseUp,!1)}},{key:"multipleSelectEnd",value:function(){var e=this.threeBase.content;e.removeEventListener("mousedown",this.mulMouseDown),e.removeEventListener("mousemove",this.marqueeSelect),e.removeEventListener("mouseup",this.mulMouseUp)}},{key:"destroy",value:function(){this.threeBase=null}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},1212:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220),n(8552),n(8828),n(3286)],r=function(e,t,r,i,a,o,s){"use strict";var l=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.OcclusionHideTool=void 0,t=l(t),r=l(r),i=l(i),e.OcclusionHideTool=function(){function e(n){(0,t.default)(this,e),(0,i.default)(this,"autoOcclusionHideInterval",null),(0,i.default)(this,"hideModels",[]),(0,i.default)(this,"hideIds",[]),(0,i.default)(this,"hideDevice",null),(0,i.default)(this,"restoreDevice",null),(0,i.default)(this,"threeBase",void 0),this.threeBase=n,this.hideIds=[]}return(0,r.default)(e,[{key:"occlusionHide",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.occlusionShow();var i=r.rangeScale,a=void 0===i?.5:i;a*=.5;var l=this.threeBase.getObjectByUniqueTarget({id:e,name:t},!1);if(!(0,s.isNil)(l)){var u=this.threeBase.bustard.core.getCenterAndSize(l),c=u.center,h=u.size;h.x-=.001,h.y-=.001,h.z-=.001;var d=[{x:c.x+h.x*a,y:c.y+h.y*a,z:c.z+h.z*a},{x:c.x-h.x*a,y:c.y+h.y*a,z:c.z+h.z*a},{x:c.x+h.x*a,y:c.y+h.y*a,z:c.z-h.z*a},{x:c.x-h.x*a,y:c.y+h.y*a,z:c.z-h.z*a},{x:c.x+h.x*a,y:c.y-h.y*a,z:c.z+h.z*a},{x:c.x-h.x*a,y:c.y-h.y*a,z:c.z+h.z*a},{x:c.x+h.x*a,y:c.y-h.y*a,z:c.z-h.z*a},{x:c.x-h.x*a,y:c.y-h.y*a,z:c.z-h.z*a}],p=[];this.hideModels=[],d.forEach((function(e){n.threeBase.bustard.core.getFirstIntersectionObjectByPosition(e,n.threeBase.bustard.core.scene.children).forEach((function(e){var t=e.instanceId,r=e.object;if(((0,s.isNil)(t)||r.userData.parent)&&(r.userData.parent&&(r=r.userData.parent[t]),!(0,o.isParent)(l,r))){var i=(0,o.getModelByMesh)(r);"设备"!==i.userData.type||p.includes(i.name)||(p.push(i.name),n.hideModels.push(i))}}))})),this.hideModels.forEach((function(e){n.threeBase.bustard.core.hideObject3D(e),n.setModelEffectVisible(e,!1)}));var f=[],m=[];p.forEach((function(e){n.hideIds.includes(e)||f.push(e)})),this.hideIds.forEach((function(e){p.includes(e)||m.push(e)})),this.hideIds=p,this.hideDevice&&f.length>0&&this.hideDevice(f),this.restoreDevice&&m.length>0&&this.restoreDevice(m)}}},{key:"occlusionAutoHide",value:function(e,t){var n=this;this.occlusionShow();var r=[];this.hideModels=[];var i=new THREE.Vector3;this.threeBase.cameraController.getPosition(i),e.forEach((function(e){t.forEach((function(t){n.threeBase.bustard.core.getIntersectionByLineAndBox(e,i,t.box)&&!r.includes(t.model.name)&&(r.push(t.model.name),n.hideModels.push(t.model))}))})),this.hideModels.forEach((function(e){n.threeBase.bustard.core.hideObject3D(e),n.setModelEffectVisible(e,!1)}));var a=[],o=[];r.forEach((function(e){n.hideIds.includes(e)||a.push(e)})),this.hideIds.forEach((function(e){r.includes(e)||o.push(e)})),this.hideIds=r,this.hideDevice&&a.length>0&&this.hideDevice(a),this.restoreDevice&&o.length>0&&this.restoreDevice(o)}},{key:"setModelEffectVisible",value:function(e,t){var n=this;e.userData.colorBox&&e.userData.colorBox.forEach((function(e){n.threeBase.color.setObjectBoxVisibleById(e,t)})),e.userData.selectBorder&&e.userData.selectBorder.forEach((function(e){n.threeBase.selectBorderTool.setSelectBorderVisible(e,t)})),e.userData.modelBox&&e.userData.modelBox.forEach((function(e){n.threeBase.setSelectEffectVisibleById(e,t)}))}},{key:"occlusionShow",value:function(){var e=this;this.hideModels.forEach((function(t){e.threeBase.bustard.core.showObject3D(t),e.setModelEffectVisible(t,!0)})),this.hideModels=[]}},{key:"openAutoOcclusionHide",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.closeAutoOcclusionHide();var i=100;r&&r.interval&&(i=r.interval),r&&r.hideDevice&&(this.hideDevice=r.hideDevice),r&&r.restoreDevice&&(this.restoreDevice=r.restoreDevice);var a=r.rangeScale,o=void 0===a?.5:a;o*=.5;var l=this.threeBase.getObjectByUniqueTarget({id:e,name:t},!1);if(!(0,s.isNil)(l)){var u=this.threeBase.bustard.core.getCenterAndSize(l),c=u.center,h=u.size;h.x-=.001,h.y-=.001,h.z-=.001;var d=[{x:c.x+h.x*o,y:c.y+h.y*o,z:c.z+h.z*o},{x:c.x-h.x*o,y:c.y+h.y*o,z:c.z+h.z*o},{x:c.x+h.x*o,y:c.y+h.y*o,z:c.z-h.z*o},{x:c.x-h.x*o,y:c.y+h.y*o,z:c.z-h.z*o},{x:c.x+h.x*o,y:c.y-h.y*o,z:c.z+h.z*o},{x:c.x-h.x*o,y:c.y-h.y*o,z:c.z+h.z*o},{x:c.x+h.x*o,y:c.y-h.y*o,z:c.z-h.z*o},{x:c.x-h.x*o,y:c.y-h.y*o,z:c.z-h.z*o}],p=[];this.threeBase.loader.modelMap.forEach((function(e,r){if("设备"===e.userData.type&&r!=t){var i=n.threeBase.bustard.core.getObjectBox(e);p.push({model:e,box:i})}})),this.autoOcclusionHideInterval=setInterval((function(){n.occlusionAutoHide(d,p)}),i)}}},{key:"closeAutoOcclusionHide",value:function(){clearInterval(this.autoOcclusionHideInterval),this.autoOcclusionHideInterval=null,this.occlusionShow(),this.restoreDevice&&this.hideIds.length>0&&this.restoreDevice(this.hideIds),this.hideIds=[],this.hideDevice=null,this.restoreDevice=null}},{key:"destroy",value:function(){this.threeBase=null,clearInterval(this.autoOcclusionHideInterval),this.hideModels=[],this.hideIds=[],this.hideDevice=null,this.restoreDevice=null}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},4051:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(791),n(6940),n(2026),n(4012),n(5220),n(8552)],r=function(e,t,r,i,a,o,s){"use strict";var l,u,c=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.SelectBorderTool=void 0,t=c(t),r=c(r),i=c(i),a=c(a),o=c(o);var h=null!==(l=null===(u=globalThis.THREE)||void 0===u?void 0:u.Euler)&&void 0!==l?l:function(){},d=new h(-Math.PI/2,0,Math.PI/2),p=new h(0,0,Math.PI/2),f=new h(-Math.PI,Math.PI/2,0),m=new h(0,-Math.PI,0),v=new h(-Math.PI,0,0),g=new h(-Math.PI/2,0,0),y=new h(0,-Math.PI/2,0),x=new h(0,0,0);function b(e){var t=e.xData,n=t.len,r=t.width,i=t.depth,a=e.zData,o=a.len,s=a.width,l=a.depth,u=e.yData,c=u.len,h=u.width,d=u.depth,p=e.color,f=M({xLen:n,yLen:c,xWidth:r,yWidth:h,depth:l,color:p,rotation:{x:0,y:0,z:0},translate:{x:0,y:0,z:-l}}),m=M({xLen:o-l,yLen:c,xWidth:s-l,yWidth:h,depth:i,color:p,rotation:{x:0,y:Math.PI/2,z:0},translate:{x:l,y:0,z:0}}),v=M({xLen:o-l,yLen:n-i,xWidth:s-l,yWidth:r-i,depth:d,color:p,rotation:{x:Math.PI/2,y:0,z:-Math.PI/2},translate:{x:l,y:i,z:-d}}),g=new THREE.Object3D;return g.add(m),g.add(f),g.add(v),g}function M(e){var t=e.xLen,n=e.yLen,r=e.xWidth,i=e.yWidth,a=e.depth,o=e.rotation,s=e.color,l=e.translate,u=[new THREE.Vector2(0,n),new THREE.Vector2(0,0),new THREE.Vector2(t,0),new THREE.Vector2(t,i),new THREE.Vector2(r,i),new THREE.Vector2(r,n),new THREE.Vector2(0,n)],c=new THREE.Shape(u),h={depth:a,bevelEnabled:!0,bevelSegments:1,steps:1,bevelSize:1e-4,bevelThickness:1e-4},d=new THREE.ExtrudeGeometry(c,h);d.translate(l.x,l.y,l.z);var p=new THREE.Matrix4;p.makeRotationFromEuler(new THREE.Euler(o.x,o.y,o.z)),d.applyMatrix4(p);var f=new THREE.Mesh(d,new THREE.MeshStandardMaterial({color:s,metalness:.4}));return f.scale.set(1,1,1),f}e.SelectBorderTool=function(){function e(t){(0,i.default)(this,e),(0,o.default)(this,"threeBase",void 0),(0,o.default)(this,"targetBorderMap",new Map),this.threeBase=t}return(0,a.default)(e,[{key:"loader",get:function(){return this.threeBase.loader}},{key:"addSelectBorder",value:function(e,t,n){if(e&&!this.targetBorderMap.has(e)){var r=this.getTargetBox(t,"boxSize"in n?n.boxSize:1),i=this.createSeletBorderByBox3(r.box,n);i.position.copy(r.position),i.rotation.y=r.rotationY,this.threeBase.bustard.core.scene.add(i),this.targetBorderMap.set(e,i),this.threeBase.setNeedUpdate()}}},{key:"createSeletBorderByBox3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.len,r=t.lenFactor,i=void 0===r?.2:r,a=t.width,o=t.widthFactor,s=void 0===o?.07:o,l=t.depth,u=t.depthFactor,c=void 0===u?.005:u,h=t.color,M=void 0===h?12097310:h,w=e.getSize(new THREE.Vector3),_=Math.min(w.x,w.y,w.z),A=_*i*1.5,C=_*s*1.2,T=_*c*1,S={len:null!=n?n:Math.min(w.x*i,A),width:null!=a?a:Math.min(w.x*s,C),depth:null!=l?l:Math.min(w.x*c,T)},E={len:null!=n?n:Math.min(w.z*i,A),width:null!=a?a:Math.min(w.z*s,C),depth:null!=l?l:Math.min(w.z*c,T)},L={len:null!=n?n:Math.min(w.y*i,A),width:null!=a?a:Math.min(w.y*s,C),depth:null!=l?l:Math.min(w.y*c,T)},P=new THREE.Vector3(S.depth,L.depth,E.depth),B=new THREE.Vector3(-S.depth,-L.depth,-E.depth);e.max.add(P),e.min.add(B);var D=e.min.clone(),k=new THREE.Vector3(e.min.x,e.min.y,e.max.z),R=new THREE.Vector3(e.min.x,e.max.y,e.min.z),O=new THREE.Vector3(e.min.x,e.max.y,e.max.z),I=new THREE.Vector3(e.max.x,e.min.y,e.min.z),F=new THREE.Vector3(e.max.x,e.min.y,e.max.z),N=new THREE.Vector3(e.max.x,e.max.y,e.min.z),z=e.max.clone(),U=b({xData:S,zData:E,yData:L,color:M});U.rotation.copy(x),U.position.copy(k);var H=b({xData:E,zData:S,yData:L,color:M});H.position.copy(D),H.rotation.copy(y);var j=b({xData:S,zData:E,yData:L,color:M});j.position.copy(R),j.rotation.copy(v);var G=b({xData:S,zData:L,yData:E,color:M});G.position.copy(O),G.rotation.copy(g);var V=b({xData:S,zData:E,yData:L,color:M});V.position.copy(I),V.rotation.copy(m);var W=b({xData:E,zData:L,yData:S,color:M});W.position.copy(z),W.rotation.copy(d);var X=b({xData:E,zData:S,yData:L,color:M});X.position.copy(N),X.rotation.copy(f);var Y=b({xData:L,zData:E,yData:S,color:M});Y.position.copy(F),Y.rotation.copy(p);var J=new THREE.Object3D;return J.add(U),J.add(H),J.add(j),J.add(G),J.add(V),J.add(W),J.add(X),J.add(Y),J}},{key:"getTargetBox",value:function(e,t){var n=this.threeBase.bustard.core.getAutoBox(e,t);return{box:n.box,rotationY:n.rotationY,position:n.position}}},{key:"removeSelectBorder",value:function(){var e=(0,r.default)(t.default.mark((function e(n){var r;return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:if(r=this.targetBorderMap.get(n)){e.next=6;break}return e.abrupt("return");case 6:this.threeBase.bustard.core.dispose(r),this.targetBorderMap.delete(n),this.threeBase.setNeedUpdate();case 9:case"end":return e.stop()}}),e,this)})));function n(t){return e.apply(this,arguments)}return n}()},{key:"setSelectBorderVisible",value:function(e,t){if(e){var n=this.targetBorderMap.get(e);n&&(n.visible=t)}}},{key:"emptySelectBorder",value:function(){var e=this;this.targetBorderMap.forEach((function(t,n){e.threeBase.bustard.core.dispose(t)})),this.targetBorderMap.clear(),this.threeBase.setNeedUpdate(),this.threeBase.loader.modelMap.forEach((function(e){e.userData.selectBorder=[]}))}},{key:"addHelpBox",value:function(e){var t=e.center,n=e.size,r=new THREE.BoxGeometry(n.x,n.y,n.z),i=new THREE.MeshBasicMaterial({color:65280,transparent:!0,opacity:.5}),a=new THREE.Mesh(r,i);a.position.set(t.x,t.y,t.z),this.threeBase.bustard.core.scene.add(a)}},{key:"destroy",value:function(){this.threeBase=null}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},8664:function(e,t){var n,r,i;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,r=[t],void 0===(i="function"==typeof(n=function(e){"use strict";function t(e,n){e.children.forEach((function(e){e.url?n.push({id:e.code}):e.isFolder&&t(e,n)}))}Object.defineProperty(e,"__esModule",{value:!0}),e.parseFolder=t})?n.apply(t,r):n)||(e.exports=i)},841:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220),n(7805),n(8552)],r=function(e,t,r,i,a,o){"use strict";var s=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.HoverPlane=void 0,t=s(t),r=s(r),i=s(i),e.HoverPlane=function(){function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,t.default)(this,e),(0,i.default)(this,"web3d",void 0),(0,i.default)(this,"hoverPlaneStyleOptions",{color:2141177,opacity:.2,borderColor:2141177,cursor:"pointer",size:.15}),(0,i.default)(this,"hoverPlane",void 0),this.web3d=n,Object.assign(this.hoverPlaneStyleOptions,r),void 0!==r.color&&(this.hoverPlaneStyleOptions.color=new THREE.Color(r.color)),void 0!==r.borderColor&&(this.hoverPlaneStyleOptions.borderColor=new THREE.Color(r.borderColor)),this.initHoverPlane()}return(0,r.default)(e,[{key:"scene",get:function(){return this.web3d.bustard.core.scene}},{key:"initHoverPlane",value:function(){var e,t=this.hoverPlaneStyleOptions,n=t.color,r=t.opacity,i=t.borderColor,o=t.cursor,s=t.size,l=t.hoverPlaneShape;e="circle"===(void 0===l?"square":l)?new THREE.CircleGeometry(s,24):new THREE.PlaneGeometry(s,s);var u=new THREE.MeshBasicMaterial({color:(0,a.toSRGBThreeColorIfNeed)(n),side:THREE.DoubleSide,transparent:!0,opacity:r});this.hoverPlane=new THREE.Mesh(e,u),this.hoverPlane.visible=!0;var c=new THREE.EdgesGeometry(this.hoverPlane.geometry),h=new THREE.LineBasicMaterial({color:i}),d=new THREE.LineSegments(c,h);this.hoverPlane.add(d),this.scene.add(this.hoverPlane),this.web3d.content.style.cursor=o}},{key:"dispose",value:function(){this.scene.remove(this.hoverPlane),this.hoverPlane.children[0].geometry.dispose(),this.hoverPlane.children[0].material.dispose(),this.hoverPlane.geometry.dispose(),this.hoverPlane.material.dispose(),this.web3d=null}},{key:"update",value:function(e){var t=e.object,n=e.face,r=e.point,i=e.instancedID,a=t.matrixWorld;null!==i&&t.getMatrixAt(i,a);var o=n.normal.clone().applyMatrix3((new THREE.Matrix3).getNormalMatrix(a)),s=(new THREE.Vector3).copy(o).add(r),l=this.web3d.getCameraPosition().position,u=s.distanceTo(l)/10;this.hoverPlane.scale.set(u,u,u),this.hoverPlane.position.copy(r.addScaledVector(o,1e-4)),this.hoverPlane.lookAt(s)}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},5336:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220),n(8552),n(841),n(4555),n(2182)],r=function(e,t,r,i,a,o,s,l){"use strict";var u=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.MeasurementTool=void 0,t=u(t),r=u(r),i=u(i),e.MeasurementTool=function(){function e(n){var r=this;(0,t.default)(this,e),(0,i.default)(this,"threeBase",void 0),(0,i.default)(this,"_isMeasuring",!1),(0,i.default)(this,"hoverPlane",void 0),(0,i.default)(this,"measureMode","line"),(0,i.default)(this,"newAddCurrentLine",void 0),(0,i.default)(this,"measureLineMap",new Map),(0,i.default)(this,"measureDataChangeCallback",null),(0,i.default)(this,"measureLineClickCallback",null),(0,i.default)(this,"multiMeasureLineStyleOptions",void 0),(0,i.default)(this,"twoPointMeasureLineStyleOptions",void 0),(0,i.default)(this,"hoverPlaneStyleOptions",void 0),(0,i.default)(this,"handleLabelClickCallback",(function(e){var t=e.currentTarget.getAttribute("measure-id");t&&(r.endCurrentMeasure(),e.preventDefault(),e.stopImmediatePropagation(),r.measureLineMap.forEach((function(e){e.setIsSelected(e.id===t)})),r.doMeasureDataChangeCallback(),r.doMeasureLineClickCallback(),r.threeBase.setNeedUpdate())})),this.threeBase=n,window.MeasurementTool=this}return(0,r.default)(e,[{key:"shouldBlockAction",get:function(){return this._isMeasuring||this.measureLineMap.size>0}},{key:"bustard",get:function(){return this.threeBase.bustard}},{key:"scene",get:function(){return this.bustard.core.scene}},{key:"setMultiMeasureLineStyle",value:function(e){this.multiMeasureLineStyleOptions=e}},{key:"setTwoPointMeasureLintStyle",value:function(e){this.twoPointMeasureLineStyleOptions=e}},{key:"setHonverPlaneStyle",value:function(e){this.hoverPlaneStyleOptions=e}},{key:"startMeasureMode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"line";this.measureMode=e,this.hoverPlane||(this.hoverPlane=new o.HoverPlane(this.threeBase,this.hoverPlaneStyleOptions)),this._isMeasuring=!0}},{key:"switchMeasureMode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"line";this.endCurrentMeasure(),this.measureMode=e}},{key:"quitMeasureMode",value:function(){this._isMeasuring&&(this.endCurrentMeasure(),this._isMeasuring=!1,this.clearMeasurement(),this.hoverPlane&&(this.hoverPlane.dispose(),this.hoverPlane=void 0),this.threeBase.content.style.cursor="auto",this.threeBase.setNeedUpdate())}},{key:"endCurrentMeasure",value:function(){this.newAddCurrentLine&&(this.newAddCurrentLine.endMeasure(),this.newAddCurrentLine.segmentNumber<1?this.newAddCurrentLine.remove():this.measureLineMap.set(this.newAddCurrentLine.id,this.newAddCurrentLine),this.doMeasureDataChangeCallback()),this.newAddCurrentLine=null}},{key:"clearMeasurement",value:function(){this.endCurrentMeasure(),this.measureLineMap.forEach((function(e){e.remove()})),this.measureLineMap.clear(),this.measureDataChangeCallback&&this.measureDataChangeCallback(void 0)}},{key:"getCurrentMeasureData",value:function(){if(this.newAddCurrentLine)return this.newAddCurrentLine.getMeasureData();var e=Array.from(this.measureLineMap.values()).find((function(e){return e._isSelected}));return null==e?void 0:e.getMeasureData()}},{key:"removeMeasureLineById",value:function(e){var t=this.measureLineMap.get(e);t?(t.remove(),this.measureLineMap.delete(e),this.measureDataChangeCallback&&this.measureDataChangeCallback(this.getCurrentMeasureData())):this.newAddCurrentLine&&this.newAddCurrentLine.id===e&&(this.newAddCurrentLine.remove(),this.newAddCurrentLine=null,this.measureDataChangeCallback&&this.measureDataChangeCallback(void 0))}},{key:"handleTouch",value:function(e){var t=e.object,n=e.face,r=e.point,i=e.instancedID;t&&n&&r&&this._isMeasuring&&(this.hoverPlane.update({object:t,face:n,point:r,instancedID:i}),this.newAddCurrentLine&&this.newAddCurrentLine.updateEndPosition(r),this.threeBase.setNeedUpdate())}},{key:"handleClick",value:function(e){var t=e.object,n=e.point;if(!t||!n||!this._isMeasuring)return this.shouldBlockAction;this.newAddCurrentLine?this.newAddCurrentLine.addNewPoint(n.clone())&&this.endCurrentMeasure():(this.measureLineMap.forEach((function(e){e.setIsSelected(!1)})),this.newAddCurrentLine=this.createTempMeasureTarget(n),this.newAddCurrentLine.addEventListeners("click",this.handleLabelClickCallback.bind(this))),this.doMeasureDataChangeCallback(),this.threeBase.setNeedUpdate()}},{key:"setMeasureDataChangeCallback",value:function(e){this.measureDataChangeCallback=e}},{key:"setMeasureLineClickCallback",value:function(e){this.measureLineClickCallback=e}},{key:"doMeasureDataChangeCallback",value:function(){this.measureDataChangeCallback&&this.measureDataChangeCallback(this.getCurrentMeasureData())}},{key:"doMeasureLineClickCallback",value:function(){this.measureLineClickCallback&&this.measureLineClickCallback(this.getCurrentMeasureData())}},{key:"createTempMeasureTarget",value:function(e){switch(this.measureMode){case"line":return new s.MultiMeasureLine(this.threeBase,e.clone(),this.multiMeasureLineStyleOptions);case"twoPoint":return new l.TwoPointMeasureLine(this.threeBase,e.clone(),this.twoPointMeasureLineStyleOptions)}}},{key:"destroy",value:function(){var e;null===(e=this.hoverPlane)||void 0===e||e.dispose(),this.clearMeasurement(),this.threeBase=null}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},4555:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(4563),n(2026),n(4012),n(5220),n(8552),n(8828),n(7805)],r=function(e,t,r,i,a,o,s,l){"use strict";var u=n(9173);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,a.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Object.defineProperty(e,"__esModule",{value:!0}),e.MultiMeasureLine=void 0,t=u(t),r=u(r),i=u(i),a=u(a);var d=5,p={style:{boxSizing:"border-box",backgroundColor:"rgba(255, 168, 0, 1)",fontSize:"14px",color:"rgba(255, 255, 255, 1)",padding:"4px",border:"1px solid rgba(255, 168, 0, 1)",borderRadius:"4px"},selectedStyle:{boxSizing:"border-box",backgroundColor:"rgba(255, 255, 255, 1)",fontSize:"14px",color:"rgba(255, 168, 0, 1)",padding:"4px",border:"1px solid rgba(255, 168, 0, 1)",borderRadius:"4px"},formatter:function(e){return"".concat(e,"m")}},f={style:{boxSizing:"border-box",backgroundColor:"rgba(67, 145, 255, 1)",fontSize:"14px",color:"rgba(255, 255, 255, 1)",padding:"4px",border:"1px solid rgba(67, 145, 255, 1)",borderRadius:"4px"},selectedStyle:{boxSizing:"border-box",backgroundColor:"rgba(255, 255, 255, 1)",fontSize:"14px",color:"rgba(67, 145, 255, 1)",padding:"4px",border:"1px solid rgba(67, 145, 255, 1)",borderRadius:"4px"},formatter:function(e){return"总长度：".concat(e,"m")}},m={style:{color:"rgb(255, 168, 0)",lineWidth:2},selectedStyle:{}},v={style:{boxSizing:"border-box",backgroundColor:"rgba(255, 168, 0, 1)",width:"10px",height:"10px",border:"1px solid rgba(255, 168, 0, 1)",borderRadius:"50%"},selectedStyle:{boxSizing:"border-box",backgroundColor:"rgba(255, 255, 255, 1)",width:"10px",height:"10px",border:"1px solid rgba(255, 168, 0, 1)",borderRadius:"50%"}};e.MultiMeasureLine=function(){function e(t,n){var i,o,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,r.default)(this,e),(0,a.default)(this,"id",(0,s.uuid)()),(0,a.default)(this,"type","line"),(0,a.default)(this,"isMeasureDone",!1),(0,a.default)(this,"_isSelected",!0),(0,a.default)(this,"web3d",void 0),(0,a.default)(this,"line",void 0),(0,a.default)(this,"worldPoints",[]),(0,a.default)(this,"rtcObject",void 0),(0,a.default)(this,"pointLabels",[]),(0,a.default)(this,"textLabels",[]),(0,a.default)(this,"clickCallbackList",[]),(0,a.default)(this,"styleOptions",void 0),(0,a.default)(this,"abortController",new AbortController),this.web3d=t;var c=u.label,d=void 0===c?{normal:{},selected:{},totalNormal:{},totalSelected:{}}:c,g=u.point,y=void 0===g?{normal:{},selected:{}}:g,x=u.line,b=void 0===x?{normal:{}}:x;this.styleOptions={label:{normal:h(h({},p.style),d.normal),selected:h(h({},p.selectedStyle),d.selected),totalNormal:h(h({},f.style),d.totalNormal),totalSelected:h(h({},f.selectedStyle),d.totalSelected),formatter:null!==(i=d.formatter)&&void 0!==i?i:p.formatter,totalFormatter:null!==(o=d.totalFormatter)&&void 0!==o?o:f.formatter},point:{normal:h(h({},v.style),y.normal),selected:h(h({},v.selectedStyle),y.selected)},line:{normal:h(h({},m.style),b.normal)}};var M=new THREE.LineMaterial({color:(0,l.toSRGBThreeColorIfNeed)(this.styleOptions.line.normal.color),depthTest:!1,depthWrite:!1,linewidth:this.styleOptions.line.normal.lineWidth,sizeAttenuation:!0,alphaToCoverage:!0});M.resolution.set(window.innerWidth,window.innerHeight);var w=new THREE.LineGeometry;w.setPositions([0,0,0,0,0,0]);var _=new THREE.Line2(w,M);_.scale.set(1,1,1),_.frustumCulled=!1,_.renderOrder=999;var A=new THREE.Object3D;A.add(_),A.position.copy(n),this.addToScene(A),this.line=_,this.rtcObject=A,this.addPointLabel(n),this.worldPoints.push((new THREE.Vector3).copy(n))}return(0,i.default)(e,[{key:"scene",get:function(){return this.web3d.bustard.core.scene}},{key:"defaultUserData",get:function(){return{measurement:{id:this.id}}}},{key:"segmentNumber",get:function(){return this.worldPoints.length-1}},{key:"getLineVertices",value:function(){return this.isMeasureDone?this.line.geometry.attributes.position.array:this.line.geometry.attributes.position.array.slice(0,-3)}},{key:"getLineRtcPoint",value:function(){return this.rtcObject.position}},{key:"addNewPoint",value:function(e){var n=this;this.addPointLabel(e),this.worldPoints.push((new THREE.Vector3).copy(e));var r=this.worldPoints.map((function(e){var t=e.clone().sub(n.getLineRtcPoint());return[t.x,t.y,t.z]})).flat(),i=new THREE.LineGeometry;i.setPositions([].concat((0,t.default)(r),[r[r.length-3],r[r.length-2],r[r.length-1]])),this.line.geometry.dispose(),this.line.geometry=i;var a=r.length;this.addTextLabelBetweenPoint(r.slice(a-6,a-3),r.slice(a-3,a))}},{key:"addTextLabelBetweenPoint",value:function(e,t){var n=this.calculateDistance(e,t),r=this.getLineRtcPoint(),i=r.x,a=r.y,o=r.z,s={x:(e[0]+t[0])/2+i,y:(e[1]+t[1])/2+a,z:(e[2]+t[2])/2+o};this.addSpriteText(n,s)}},{key:"calculateDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=Math.sqrt(n*n+r*r+i*i);return Number(a.toFixed(2))}},{key:"updateEndPosition",value:function(e){var t=this,n=this.worldPoints.map((function(e){var n=e.clone().sub(t.getLineRtcPoint());return[n.x,n.y,n.z]})).flat(),r=e.clone().sub(this.getLineRtcPoint());n.push(r.x,r.y,r.z),this.line.geometry.setPositions(n),this.line.geometry.attributes.position.needsUpdate=!0}},{key:"addPointLabel",value:function(e){var t=document.createElement("div"),n=this.styleOptions.point,r=n.normal,i=n.selected,a=this._isSelected?i:r;for(var o in a)t.style[o]=a[o];var s=this.addLabelToScene("".concat(this.id,"-").concat(this.pointLabels.length,"-point"),t,e);this.pointLabels.push(s)}},{key:"addSpriteText",value:function(e,t){var n=document.createElement("div"),r=this.styleOptions.label,i=r.normal,a=r.formatter,o=r.selected,s=this._isSelected?o:i;for(var l in s)n.style[l]=s[l];n.textContent=a(e);var u=this.addLabelToScene("".concat(this.id,"-").concat(this.textLabels.length,"-label"),n,t);this.textLabels.push(u)}},{key:"addTotalSpriteText",value:function(e,t){var n=document.createElement("div"),r=this.styleOptions.label,i=r.totalNormal,a=r.totalFormatter,o=r.totalSelected,s=this._isSelected?o:i;for(var l in s)n.style[l]=s[l];n.textContent=a(e);var u=this.addLabelToScene("".concat(this.id,"-total-label"),n,t);this.textLabels.push(u)}},{key:"endMeasure",value:function(){var e=this;this.isMeasureDone=!0;var t=this.worldPoints.map((function(t){var n=t.clone().sub(e.getLineRtcPoint());return[n.x,n.y,n.z]})).flat(),n=new THREE.LineGeometry;n.setPositions(t),this.line.geometry.dispose(),this.line.geometry=n;var r=this.getTotalDistance(),i="".concat(r),a=this.getLineRtcPoint(),o=a.x,s=a.y,l=a.z;this.addTotalSpriteText(i,{x:o,y:s+1,z:l})}},{key:"getTotalDistance",value:function(){var e=this,t=this.worldPoints.reduce((function(t,n,r){if(0===r)return t;var i=e.worldPoints[r-1],a=n;return t+e.calculateDistance(i.toArray(),a.toArray())}),0);return Number(t.toFixed(2))}},{key:"getMeasureData",value:function(){for(var e=[],t=0;t<this.worldPoints.length-1;t++){var n=this.worldPoints[t],r=this.worldPoints[t+1],i=this.calculateDistance(n.toArray(),r.toArray());e.push({index:t,start:n.clone(),end:r.clone(),distance:i})}var a=e.reduce((function(e,t){return e+t.distance}),0);return{id:this.id,type:this.type,totalDistance:Number(a.toFixed(2)),segments:e}}},{key:"remove",value:function(){this.line.geometry.dispose(),this.line.material.dispose(),this.scene.remove(this.rtcObject),this.web3d.emptyLabel("measumentToolLabel-".concat(this.id)),this.abortController.abort(),this.clickCallbackList=[],this.pointLabels=[],this.textLabels=[]}},{key:"addToScene",value:function(e){(0,s.setLayer)(e,d),(0,s.setUserData)(e,this.defaultUserData),this.scene.add(e)}},{key:"addLabelToScene",value:function(e,t,n){var r=this,i=document.createElement("div");return i.appendChild(t),this.clickCallbackList.length>0&&this.clickCallbackList.forEach((function(e){i.addEventListener(e.type,e.callback,{signal:r.abortController.signal})})),i.setAttribute("measure-id",this.id),this.web3d.addLabel(e,i,n,[],"measumentToolLabel-".concat(this.id)),{labelId:e,containerDiv:i}}},{key:"addEventListeners",value:function(e,t){var n=this;this.clickCallbackList.push({type:e,callback:t}),this.pointLabels.forEach((function(r){r.containerDiv.addEventListener(e,t,{signal:n.abortController.signal})})),this.textLabels.forEach((function(r){r.containerDiv.addEventListener(e,t,{signal:n.abortController.signal})}))}},{key:"removeEventListeners",value:function(e,t){this.pointLabels.forEach((function(n){n.containerDiv.removeEventListener(e,t)})),this.textLabels.forEach((function(n){n.containerDiv.removeEventListener(e,t)})),this.clickCallbackList=this.clickCallbackList.filter((function(n){return n.type!==e||n.callback!==t}))}},{key:"setIsSelected",value:function(e){if(this._isSelected!==e){var t=this.styleOptions,n=t.label,r=t.point,i=r.normal,a=n.normal,o=n.totalNormal;e&&(i=r.selected,a=n.selected,o=n.totalSelected),this.pointLabels.forEach((function(e){var t=e.containerDiv;for(var n in i)t.firstChild.style[n]=i[n]})),this.textLabels.forEach((function(e){var t=e.labelId,n=e.containerDiv;if(t.endsWith("-total-label"))for(var r in o)n.firstChild.style[r]=o[r];else for(var i in a)n.firstChild.style[i]=a[i]})),this._isSelected=e}}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},2182:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(7264),n(2026),n(4012),n(5220),n(8552),n(8828),n(7805)],r=function(e,t,r,i,a,o,s,l){"use strict";var u=n(9173);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,a.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Object.defineProperty(e,"__esModule",{value:!0}),e.TwoPointMeasureLine=void 0,t=u(t),r=u(r),i=u(i),a=u(a);var d={style:{boxSizing:"border-box",backgroundColor:"rgba(255, 168, 0, 1)",fontSize:"14px",color:"rgba(255, 255, 255, 1)",padding:"4px",border:"1px solid rgba(255, 168, 0, 1)",borderRadius:"4px"},selectedStyle:{boxSizing:"border-box",backgroundColor:"rgba(255, 255, 255, 1)",fontSize:"14px",color:"rgba(255, 168, 0, 1)",padding:"4px",border:"1px solid rgba(255, 168, 0, 1)",borderRadius:"4px"},formatter:function(e){return"".concat(e,"m")}},p={style:{color:"rgb(255, 168, 0)",lineWidth:2},selectedStyle:{}},f={style:{boxSizing:"border-box",backgroundColor:"rgba(255, 168, 0, 1)",width:"10px",height:"10px",border:"1px solid rgba(255, 168, 0, 1)",borderRadius:"50%"},selectedStyle:{boxSizing:"border-box",backgroundColor:"rgba(255, 255, 255, 1)",width:"10px",height:"10px",border:"1px solid rgba(255, 168, 0, 1)",borderRadius:"50%"}},m={style:{color:"rgb(251, 80, 81)",visible:!1},selectedStyle:{color:"rgb(251, 80, 81)",visible:!0}},v={style:{color:"rgb(50, 226, 50)",visible:!1},selectedStyle:{color:"rgb(50, 226, 50)",visible:!0}},g={style:{color:"rgb(67, 145, 255)",visible:!1},selectedStyle:{color:"rgb(67, 145, 255)",visible:!0}};e.TwoPointMeasureLine=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,r.default)(this,e),(0,a.default)(this,"id",(0,s.uuid)()),(0,a.default)(this,"type","twoPoint"),(0,a.default)(this,"_isSelected",!0),(0,a.default)(this,"web3d",void 0),(0,a.default)(this,"line",void 0),(0,a.default)(this,"worldPoints",[]),(0,a.default)(this,"rtcObject",void 0),(0,a.default)(this,"styleOptions",void 0),(0,a.default)(this,"pointLabels",[]),(0,a.default)(this,"textLabels",[]),(0,a.default)(this,"clickCallbackList",[]),(0,a.default)(this,"xLine",void 0),(0,a.default)(this,"yLine",void 0),(0,a.default)(this,"zLine",void 0),(0,a.default)(this,"abortController",new AbortController),this.web3d=t,this.initStyleOptions(i);var o=new THREE.LineMaterial({color:(0,l.toSRGBThreeColorIfNeed)(this.styleOptions.line.normal.color),depthTest:!1,depthWrite:!1,linewidth:this.styleOptions.line.normal.lineWidth,transparent:!0});o.resolution.set(window.innerWidth,window.innerHeight);var u=new THREE.LineGeometry;u.setPositions([0,0,0,0,0,0]);var c=new THREE.Line2(u,o);c.frustumCulled=!1,c.renderOrder=999;var h=new THREE.Object3D;h.add(c),h.position.copy(n),this.addToScene(h),this.line=c,this.rtcObject=h,this.addPointLabel(n),this.worldPoints.push(new THREE.Vector3(n.x,n.y,n.z))}return(0,i.default)(e,[{key:"scene",get:function(){return this.web3d.bustard.core.scene}},{key:"defaultUserData",get:function(){return{measurement:{id:this.id}}}},{key:"segmentNumber",get:function(){return this.worldPoints.length-1}},{key:"initStyleOptions",value:function(e){var t,n=e.label,r=void 0===n?{normal:{},selected:{},totalNormal:{},totalSelected:{},formatter:void 0}:n,i=e.point,a=void 0===i?{normal:{},selected:{}}:i,o=e.line,s=void 0===o?{normal:{},xNormal:{},yNormal:{},zNormal:{},xSelected:{},ySelected:{},zSelected:{}}:o;this.styleOptions={label:{normal:h(h({},d.style),r.normal),selected:h(h({},d.selectedStyle),r.selected),formatter:null!==(t=r.formatter)&&void 0!==t?t:d.formatter},point:{normal:h(h({},f.style),a.normal),selected:h(h({},f.selectedStyle),a.selected)},line:{normal:h(h({},p.style),s.normal),xNormal:h(h({},m.style),s.xNormal),yNormal:h(h({},v.style),s.yNormal),zNormal:h(h({},g.style),s.zNormal),xSelected:h(h({},m.selectedStyle),s.xSelected),ySelected:h(h({},v.selectedStyle),s.ySelected),zSelected:h(h({},g.selectedStyle),s.zSelected)}};var u=this.styleOptions.line;u.xNormal.color=(0,l.toSRGBThreeColorIfNeed)(u.xNormal.color),u.yNormal.color=(0,l.toSRGBThreeColorIfNeed)(u.yNormal.color),u.zNormal.color=(0,l.toSRGBThreeColorIfNeed)(u.zNormal.color),u.xSelected.color=(0,l.toSRGBThreeColorIfNeed)(u.xSelected.color),u.ySelected.color=(0,l.toSRGBThreeColorIfNeed)(u.ySelected.color),u.zSelected.color=(0,l.toSRGBThreeColorIfNeed)(u.zSelected.color),u.xNormal.lineWidth=u.normal.lineWidth,u.yNormal.lineWidth=u.normal.lineWidth,u.zNormal.lineWidth=u.normal.lineWidth,u.xSelected.lineWidth=u.normal.lineWidth,u.ySelected.lineWidth=u.normal.lineWidth,u.zSelected.lineWidth=u.normal.lineWidth}},{key:"addToScene",value:function(e){(0,s.setUserData)(e,this.defaultUserData),this.scene.add(e)}},{key:"addPointLabel",value:function(e){var t=document.createElement("div"),n=this.styleOptions.point,r=n.normal,i=n.selected,a=this._isSelected?i:r;for(var o in a)t.style[o]=a[o];var s=this.addLabelToScene("".concat(this.id,"-").concat(this.pointLabels.length,"-point"),t,e);this.pointLabels.push(s)}},{key:"addLabelToScene",value:function(e,t,n){var r=this,i=document.createElement("div");return i.appendChild(t),this.clickCallbackList.length>0&&this.clickCallbackList.forEach((function(e){i.addEventListener(e.type,e.callback,{signal:r.abortController.signal})})),i.setAttribute("measure-id",this.id),this.web3d.addLabel(e,i,n,[],"measumentToolLabel-".concat(this.id)),{labelId:e,containerDiv:i}}},{key:"getLineRtcPoint",value:function(){return this.rtcObject.position}},{key:"updateEndPosition",value:function(e){var t=e.clone().sub(this.getLineRtcPoint());this.line.geometry.setPositions([0,0,0,t.x,t.y,t.z]),this.line.geometry.attributes.position.needsUpdate=!0}},{key:"addEventListeners",value:function(e,t){var n=this;this.clickCallbackList.push({type:e,callback:t}),this.pointLabels.forEach((function(r){r.containerDiv.addEventListener(e,t,{signal:n.abortController.signal})})),this.textLabels.forEach((function(r){r.containerDiv.addEventListener(e,t,{signal:n.abortController.signal})}))}},{key:"addNewPoint",value:function(e){this.addPointLabel(e);var t=e.clone().sub(this.getLineRtcPoint());return this.line.geometry.setPositions([0,0,0,t.x,t.y,t.z]),this.line.geometry.attributes.position.needsUpdate=!0,this.addTextLabelBetweenPoint([0,0,0],[t.x,t.y,t.z]),this.worldPoints.push(e.clone()),!0}},{key:"addTextLabelBetweenPoint",value:function(e,t){var n=this.calculateDistance(e,t),r=this.getLineRtcPoint(),i=r.x,a=r.y,o=r.z,s={x:(e[0]+t[0])/2+i,y:(e[1]+t[1])/2+a,z:(e[2]+t[2])/2+o};this.addSpriteText(n,s)}},{key:"calculateDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=Math.sqrt(n*n+r*r+i*i);return Number(a.toFixed(2))}},{key:"addSpriteText",value:function(e,t){var n=document.createElement("div"),r=this.styleOptions.label,i=r.normal,a=r.formatter,o=r.selected,s=this._isSelected?o:i;for(var l in s)n.style[l]=s[l];n.textContent=a(e);var u=this.addLabelToScene("".concat(this.id,"-").concat(this.textLabels.length,"-label"),n,t);this.textLabels.push(u)}},{key:"endMeasure",value:function(){this.isMeasureDone=!0,1===this.segmentNumber&&this.addXYZLine()}},{key:"addXYZLine",value:function(){var e=this.getLineRtcStartEnd(),t=e.start,n=e.end;this.xLine=this.addDashLine(t,new THREE.Vector3(n.x,t.y,t.z),this.styleOptions.line.xSelected),this.zLine=this.addDashLine(new THREE.Vector3(n.x,t.y,t.z),new THREE.Vector3(n.x,t.y,n.z),this.styleOptions.line.zSelected),this.yLine=this.addDashLine(new THREE.Vector3(n.x,t.y,n.z),n,this.styleOptions.line.ySelected)}},{key:"addDashLine",value:function(e,t,n){var r=n.color,i=n.visible,a=n.lineWidth,o=new THREE.LineMaterial({color:r,dashed:!0,dashSize:1,gapSize:.75,depthTest:!1,depthWrite:!1,linewidth:a,transparent:!0});o.resolution.set(window.innerWidth,window.innerHeight),o.defines.USE_DASH="";var s=new THREE.LineGeometry;s.setPositions([e.x,e.y,e.z,t.x,t.y,t.z]);var l=new THREE.Line2(s,o);return l.frustumCulled=!1,l.renderOrder=999,l.computeLineDistances(),l.visible=i,this.rtcObject.add(l),l}},{key:"setIsSelected",value:function(e){if(this._isSelected!==e){var t=this.styleOptions,n=t.label,r=t.point,i=r.normal,a=n.normal,o=this.styleOptions.line.xNormal,s=this.styleOptions.line.yNormal,l=this.styleOptions.line.zNormal;e&&(i=r.selected,a=n.selected,o=this.styleOptions.line.xSelected,s=this.styleOptions.line.ySelected,l=this.styleOptions.line.zSelected),this.pointLabels.forEach((function(e){var t=e.containerDiv;for(var n in i)t.firstChild.style[n]=i[n]})),this.textLabels.forEach((function(e){var t=e.containerDiv;for(var n in a)t.firstChild.style[n]=a[n]})),this.xLine.material.color=o.color,this.yLine.material.color=s.color,this.zLine.material.color=l.color,this.xLine.visible=o.visible,this.yLine.visible=s.visible,this.zLine.visible=l.visible,this._isSelected=e}}},{key:"getLineVertices",value:function(){return this.isMeasureDone?this.line.geometry.attributes.position.array:this.line.geometry.attributes.position.array.slice(0,-3)}},{key:"getLineRtcStartEnd",value:function(){var e=this.getLineRtcPoint();return this.worldPoints[0].y<this.worldPoints[1].y?{start:this.worldPoints[0].clone().sub(e),end:this.worldPoints[1].clone().sub(e)}:{start:this.worldPoints[1].clone().sub(e),end:this.worldPoints[0].clone().sub(e)}}},{key:"getMeasureData",value:function(){if(this.worldPoints.length<2)return{id:this.id,type:this.type,distance:0};var e=(0,t.default)(this.worldPoints,2),n=e[0],r=e[1],i=n.distanceTo(r);return{id:this.id,type:this.type,start:n,end:r,distance:i,xDistance:Math.abs(n.x-r.x),yDistance:Math.abs(n.y-r.y),zDistance:Math.abs(n.z-r.z)}}},{key:"remove",value:function(){this.line.geometry.dispose(),this.line.material.dispose(),this.xLine&&(this.xLine.geometry.dispose(),this.xLine.material.dispose()),this.yLine&&(this.yLine.geometry.dispose(),this.yLine.material.dispose()),this.zLine&&(this.zLine.geometry.dispose(),this.zLine.material.dispose()),this.scene.remove(this.rtcObject),this.web3d.emptyLabel("measumentToolLabel-".concat(this.id)),this.abortController.abort(),this.clickCallbackList=[],this.pointLabels=[],this.textLabels=[]}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},4321:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220),n(8828),n(3286),n(7805)],r=function(e,t,r,i,a,o,s){"use strict";var l=n(9173);function u(e){return{vertexCount:e.reduce((function(e,t){return e+t.attributes.position.count}),0),indexCount:e.reduce((function(e,t){return e+t.index.count}),0),geometryCount:e.length}}Object.defineProperty(e,"__esModule",{value:!0}),e.SelectOnTopTool=void 0,t=l(t),r=l(r),i=l(i),e.SelectOnTopTool=function(){function e(n){(0,t.default)(this,e),(0,i.default)(this,"topMaterialMap",new Map),(0,i.default)(this,"selectOnTopList",[]),(0,i.default)(this,"renderSelectOnTopList",[]),(0,i.default)(this,"geometryCacheMap",new Map),(0,i.default)(this,"threeBase",void 0),this.threeBase=n}return(0,r.default)(e,[{key:"bustard",get:function(){return this.threeBase.bustard}},{key:"addTarget",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.color,r=void 0===n?16776960:n,i=t.opacity,a=void 0===i?.2:i;this.selectOnTopList.push({model:e,params:{color:r,opacity:a}}),this.addToRenderTargets(e,{color:r,opacity:a})}},{key:"addToRenderTargets",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.color,i=void 0===r?16776960:r,o=n.opacity,s=void 0===o?.2:o;this.renderSelectOnTopList=this.renderSelectOnTopList.filter((function(n){var r=n.model,i=!(0,a.isParent)(e,r);return i||t.removeSelectFromModel(r),i})),this.renderSelectOnTopList.some((function(t){var n=t.model;return(0,a.isParent)(n,e)}))||(this.renderSelectOnTopList.push({model:e,params:{color:i,opacity:s}}),this.selectOnTop(e,{color:i,opacity:s}))}},{key:"addTargets",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.color,i=void 0===r?16776960:r,a=n.opacity,o=void 0===a?.2:a;e.forEach((function(e){t.addTarget(e,{color:i,opacity:o})}))}},{key:"removeTarget",value:function(e){var t=this;this.selectOnTopList=this.selectOnTopList.filter((function(t){return t.model.uuid!==e.uuid})),this.renderSelectOnTopList.some((function(t){return t.model.uuid===e.uuid}))&&(this.renderSelectOnTopList=this.renderSelectOnTopList.filter((function(t){return t.model.uuid!==e.uuid})),this.removeSelectFromModel(e),this.selectOnTopList.filter((function(t){var n=t.model;return(0,a.isParent)(e,n)})).forEach((function(e){var n=e.model,r=e.params;t.addToRenderTargets(n,r)})))}},{key:"setUpMaterial",value:function(e,t){var n=this,r=new Map;e.traverse((function(e){if("Mesh"===e.type&&"MeshStandardMaterial"===e.material.type){if(!r.get(e.material.uuid)){var i,a,o=new THREE.MeshStandardMaterial({transparent:!0,opacity:null!==(i=null==t?void 0:t.opacity)&&void 0!==i?i:.3,color:null!==(a=null==t?void 0:t.color)&&void 0!==a?a:16776960,metalness:.3,roughness:.7,depthTest:!1});o.clippingPlanes=e.material.clippingPlanes,r.set(e.material.uuid,{topMaterial:o})}n.topMaterialMap.get(e.uuid)||n.topMaterialMap.set(e.uuid,{mesh:e,material:e.material}),e.material=r.get(e.material.uuid).topMaterial}}))}},{key:"getMergeGeometryList",value:function(e){var t=this,n=this.getModelGeometryCacheMap(e),r=[],i=new THREE.Matrix4;return e.updateMatrixWorld(),i.copy(e.matrixWorld).invert(),e.traverseVisible((function(e){var a;if(("Group"===e.type||"Object3D"===e.type||"Scene"===e.type)&&(null===(a=e.userData)||void 0===a||null===(a=a.instancedMeshes)||void 0===a?void 0:a.length)>0)e.userData.instancedMeshes.forEach((function(e){var n=e.id,a=e.mesh,o=a.geometry.clone();t.bustard.core.deinterleaveGeometry(o);var s=new THREE.Matrix4;a.getMatrixAt(n,s),o.applyMatrix4(i.clone().multiply(a.matrixWorld).multiply(s)),o.deleteAttribute("customOpacity"),o.deleteAttribute("uv"),o.deleteAttribute("_PARENT_INDEX"),!1!==a.userData.isShowArr[n]&&r.push(o)}));else if("Mesh"===e.type&&"MeshStandardMaterial"===e.material.type&&!e.count){if(!n.has(e.uuid)){var o=e.geometry.clone();t.bustard.core.deinterleaveGeometry(o),o.deleteAttribute("customOpacity"),o.deleteAttribute("uv"),o.deleteAttribute("_PARENT_INDEX"),o.applyMatrix4(i.clone().multiply(e.matrixWorld)),n.set(e.uuid,o)}r.push(n.get(e.uuid))}})),r}},{key:"selectOnTop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(window.__THREE__&&Number(window.__THREE__)>=163)this.selectOnTopNew(e,t);else{var n=t.color,r=void 0===n?16776960:n,i=t.opacity,a=void 0===i?.2:i,s=new THREE.MeshBasicMaterial({color:r,opacity:a,transparent:!0,depthTest:!1,clippingPlanes:this.bustard.clip3.getCurrentClipPlanes()}),l=this.getMergeGeometryList(e);if(!(0,o.isNilOrEmptyArray)(l)){var u=this.bustard.core.mergeBufferGeometries(l);l.forEach((function(e){e.dispose()}));var c=new THREE.Mesh(u,s);c.userData={isSelectOnTopMesh:!0},e.add(c)}}}},{key:"selectOnTopNew",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.color,r=void 0===n?16776960:n,i=t.opacity,a=void 0===i?.2:i,o=(0,s.toSRGBThreeColorIfNeed)(r),l=new THREE.MeshBasicMaterial({color:o,opacity:a,transparent:!0,depthTest:!1,clippingPlanes:this.bustard.clip3.getCurrentClipPlanes()}),c=[],h=[],d=new THREE.Matrix4;e.updateMatrixWorld(),d.copy(e.matrixWorld).invert();var p=new Map;e.traverseVisible((function(e){var t;if((null===(t=e.userData)||void 0===t||null===(t=t.instancedMeshes)||void 0===t?void 0:t.length)>0)e.userData.instancedMeshes.forEach((function(e){var t=e.id,n=e.mesh;if(!1!==n.userData.isShowArr[t]){var r=p.get(n.geometry.uuid);r||((r=n.geometry.clone()).deleteAttribute("customOpacity"),r.deleteAttribute("uv"),r.deleteAttribute("_PARENT_INDEX"),p.set(n.geometry.uuid,r));var i=new THREE.Matrix4;n.getMatrixAt(t,i);var a=d.clone().multiply(n.matrixWorld).multiply(i);h.push(a),c.push(r)}}));else if("Mesh"===e.type&&"MeshStandardMaterial"===e.material.type&&!e.count){var n=p.get(e.geometry.uuid);n||((n=e.geometry.clone()).deleteAttribute("customOpacity"),n.deleteAttribute("uv"),n.deleteAttribute("_PARENT_INDEX"),p.set(e.geometry.uuid,n));var r=d.clone().multiply(e.matrixWorld);h.push(r),c.push(n)}}));for(var f=u(c),m=f.geometryCount,v=f.vertexCount,g=f.indexCount,y=new THREE.BatchedMesh(m,v,g,l),x=0;x<m;x++){var b=y.addGeometry(c[x]);y.setMatrixAt(b,h[x])}y.userData={isSelectOnTopMesh:!0},e.add(y)}},{key:"selectOnTop2",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.color,r=void 0===n?16776960:n,i=t.opacity,a=void 0===i?.2:i,o=new THREE.LineBasicMaterial({color:r,depthTest:!1,opacity:2*a,transparent:!0}),s=new THREE.MeshBasicMaterial({color:r,opacity:a,transparent:!0,depthTest:!1}),l=this.getMergeGeometryList(e),u=this.bustard.core.mergeBufferGeometries(l),c=new THREE.Mesh(u,s);e.add(c);var h=new THREE.EdgesGeometry(u,30),d=new THREE.LineSegments(h,o);e.add(d)}},{key:"selectOnTopWASM",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};THREE.FastEdgesGeometry.init().then((function(r){var i=n.color,a=void 0===i?16776960:i,o=n.opacity,s=void 0===o?.2:o,l=new THREE.LineBasicMaterial({color:a,depthTest:!1,opacity:2*s,transparent:!0}),u=new THREE.MeshBasicMaterial({color:a,opacity:s,transparent:!0,depthTest:!1}),c=t.getMergeGeometryList(e),h=t.bustard.core.mergeBufferGeometries(c),d=new THREE.Mesh(h,u);e.add(d);var p=h.attributes.position.array,f=h.index.array,m=r.createEdges(p,f,30),v=new THREE.BufferGeometry;v.setAttribute("position",new THREE.BufferAttribute(m.slice(),3));var g=new THREE.LineSegments(v,l);e.add(g)}))}},{key:"selectOnTopWASMWorker",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.color,r=void 0===n?16776960:n,i=t.opacity,a=void 0===i?.2:i,o=new THREE.LineBasicMaterial({color:r,depthTest:!1,opacity:2*a,transparent:!0}),s=new THREE.MeshBasicMaterial({color:r,opacity:a,transparent:!0,depthTest:!1}),l=this.getMergeGeometryList(e),u=this.bustard.core.mergeBufferGeometries(l),c=new THREE.Mesh(u,s);c.userData={isSelectOnTopMesh:!0},e.add(c);var h=u.attributes.position.array,d=u.index.array;this.bustard.core.createEdgesGeometry(h,d).then((function(t){var n=new THREE.BufferGeometry;n.setAttribute("position",new THREE.BufferAttribute(t.slice(),3));var r=new THREE.LineSegments(n,o);r.userData={isSelectOnTopMesh:!0},e.add(r)}))}},{key:"clearSetMaterial",value:function(){this.topMaterialMap.forEach((function(e,t){e.mesh.material=e.material})),this.topMaterialMap.clear()}},{key:"clearSelectOnTop",value:function(e){var t=this;(0,o.isNotNil)(e)?this.removeTarget(e):(this.renderSelectOnTopList.forEach((function(e){var n=e.model;t.removeSelectFromModel(n)})),this.geometryCacheMap.clear(),this.renderSelectOnTopList=[],this.selectOnTopList=[])}},{key:"refreshCurrentSelectOnTop",value:function(){var e=this;this.renderSelectOnTopList.forEach((function(t){var n=t.model;e.removeSelectFromModel(n)})),this.renderSelectOnTopList.forEach((function(t){var n=t.model,r=t.params;e.selectOnTop(n,r)}))}},{key:"getModelGeometryCacheMap",value:function(e){if(this.geometryCacheMap.has(e.uuid))return this.geometryCacheMap.get(e.uuid);var t=new Map;return this.geometryCacheMap.set(e.uuid,t),t}},{key:"removeSelectFromModel",value:function(e){e.children.filter((function(e){return e.userData.isSelectOnTopMesh})).forEach((function(t){e.remove(t),t.isBatchedMesh?t.dispose():(t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose())})),this.threeBase.setNeedUpdate()}},{key:"destroy",value:function(){this.threeBase=null}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},4728:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(791),n(4563),n(6940),n(831),n(2026),n(4012),n(5220),n(8552),n(2851),n(6193),n(5084),n(8664),n(1212),n(4051),n(4341),n(787),n(2405),n(5336),n(8853),n(1828),n(3977),n(1416),n(5341),n(5416),n(6928),n(621),n(4258),n(8828),n(7805),n(3286),n(7154)],r=function(e,t,r,i,a,o,s,l,u,c,h,d,p,f,m,v,g,y,x,b,M,w,_,A,C,T,S,E,L,P,B,D){"use strict";var k=n(9173);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){(0,l.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Object.defineProperty(e,"__esModule",{value:!0}),e.Web3D=void 0,Object.defineProperty(e,"__WEB3D_VERSION__",{enumerable:!0,get:function(){return c.__WEB3D_VERSION__}}),t=k(t),r=k(r),i=k(i),a=k(a),o=k(o),s=k(s),l=k(l);var I=e.Web3D=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{scene,systemConfig:void 0,inCesium:!1,pickAction:null,pickLabelAction:null,touchAction:null,doubleClickModelAction:null,loadingAction:null,loadedAction:null,dragAction:null,enableContextSelect:!1,showLoading:!1};return function(){(0,o.default)(n,e),(0,l.default)(n,"modelCalculator",void 0),(0,l.default)(n,"_actions",null),(0,l.default)(n,"logicTreeMap",new Map),(0,l.default)(n,"labelMap",new Map),(0,l.default)(n,"labelGroupMap",new Map),(0,l.default)(n,"clipLabelMap",new Map),(0,l.default)(n,"clipLabelGroupMap",new Map),(0,l.default)(n,"currentClipLabelMap",new Map),(0,l.default)(n,"currentClipLabelGroupMap",new Map),(0,l.default)(n,"labelInterval",null),(0,l.default)(n,"restoreMaterial",new Map),(0,l.default)(n,"flags",{}),(0,l.default)(n,"selectedProvince",void 0),(0,l.default)(n,"selectedCity",void 0),(0,l.default)(n,"selectedDistrict",void 0),(0,l.default)(n,"enableSwitch",!0),(0,l.default)(n,"hideObjects",[]),(0,l.default)(n,"contextRootCode",""),(0,l.default)(n,"contextCode",""),(0,l.default)(n,"contextLevel",1),(0,l.default)(n,"switchLinkModels",!0),(0,l.default)(n,"context",null),(0,l.default)(n,"upContent",null),(0,l.default)(n,"buildings",[]),(0,l.default)(n,"modelUserDataMap",null),(0,l.default)(n,"allContext",[]),(0,l.default)(n,"hideObjects",[]),(0,l.default)(n,"modelTree",void 0),(0,l.default)(n,"lightActingModels",[]),(0,l.default)(n,"lightNotActingModels",[]),(0,l.default)(n,"freeSwitchTypes",[]),(0,l.default)(n,"enableContextSelect",!1),(0,l.default)(n,"enableContextDefaultToggle",!1),(0,l.default)(n,"enableStatusDefaultToggle",!1),(0,l.default)(n,"mapConfig",null);var i=r.systemConfig,a=r.enableContextSelect,s=r.pickLabelAction,c=r.scene,h=r.inCesium,d=r.pickAction,p=r.touchAction,f=r.loadedAction,m=r.loadingAction,v=r.doubleClickModelAction,g=r.dragAction,y=r.showLoading;n.enableContextSelect=a,n.pickLabelAction=s,document.getElementById(t)&&(0,T.loadSystemConfigIfNeed)(i).then((function(e){n.mapConfig=e.mapConfig;var r=!1;c.cameraPosition||(r=!0,c.cameraPosition={position:{x:6.631075526013411,y:183.7423830246624,z:209.65599107724563},target:{x:6.295779529004475,y:.1224709915533935,z:-25.42572220983519}}),n.parseScene(c),n.modelCalculator=new u.ThreeBase(t,e,{initModule:c,inCesium:h,loadingAction:m,loadedAction:function(){n.setPickAction(d),n.setTouchAction(p),n.setDoubleClickModelAction(v),n.setRightDoubleClickAction(),f&&f(),n.modelTree&&(n.selectContext(n.modelTree.rootCode,n.modelTree.code),n.initMarks())},dragAction:g,showLoading:y}),n.modelCalculator.initScene(c,(function(){c.modelUrls.length>0&&r&&n.changeOrientation("before"),n.initRoam(n.roamList),n.initLabel(c),n.enableTouch(!0)}))}))}()}return(0,s.default)(e,[{key:"actions",get:function(){return this._actions||(this._actions=new _.ActionsTool(this)),this._actions}},{key:"dict",get:function(){return A.dict}},{key:"formDict",get:function(){return(0,A.getFormDict)()}},{key:"measureTool",get:function(){return this.modelCalculator.measureTool}},{key:"clipTool",get:function(){return this.modelCalculator.clipTool}},{key:"targetIconTool",get:function(){return this.modelCalculator.targetIconTool}},{key:"firstPersonRoam",get:function(){return this.modelCalculator.firstPersonRoam}},{key:"nodeSizeTool",get:function(){return this.modelCalculator.nodeSizeTool}},{key:"selectBorderTool",get:function(){return this.modelCalculator.selectBorderTool}},{key:"occlusionHideTool",get:function(){return this.modelCalculator.occlusionHideTool}},{key:"spriteLabelManager",get:function(){return this.modelCalculator.spriteLabelManager}},{key:"drawTool",get:function(){return this.modelCalculator.drawTool}},{key:"renderTool",get:function(){return this.modelCalculator.renderTool}},{key:"pipeLineTool",get:function(){return this.modelCalculator.pipeLineTool}},{key:"animationTool",get:function(){return this.modelCalculator.animationTool}},{key:"statusManager",get:function(){return this.modelCalculator.statusManager}},{key:"meshInfoTool",get:function(){return this.modelCalculator.meshInfoTool}},{key:"changeOrientation",value:function(e,t){this.modelCalculator.switchCameraOrientation(e,t)}},{key:"enter",value:function(e,t){this.modelCalculator.bustard.core.touchTargetObjs=[],this.modelCalculator.bustard.core.touchTargetIDs=[],JSON.stringify(e.skybox)!=JSON.stringify(this.modelCalculator.module.skybox)&&this.modelCalculator.addSkyBox(e.skybox),this.modelCalculator.autoRoam.endFn(),e.hdr!=this.modelCalculator.module.hdr&&this.modelCalculator.addHdr(e.hdr,!1,!0),this.modelCalculator.removeAllEffect();var n=this;e.cameraPosition&&(n.modelCalculator.defaultView=e.cameraPosition,n.modelCalculator.lerpLookAt(e.cameraPosition.position,e.cameraPosition.target)),this.modelCalculator.fromFloorToHomeView((function(){var r=[],i=[];e.modelUrls.forEach((function(e){var t=(0,L.inUrls)(n.modelCalculator.module.modelUrls,e);if(0==t)r.push(e);else if(2==t&&("opacity"in e?"外立面"==e.sceneName||"土建"==e.sceneName?n.modelCalculator.removeSceneByName([e.fileName],{value:e.opacity,time:0}):n.modelCalculator.removeSceneByName([e.fileName],{value:e.opacity}):"外立面"==e.sceneName||"土建"==e.sceneName?n.modelCalculator.restroeSceneByName([e.fileName],{time:0}):n.modelCalculator.restroeSceneByName([e.fileName])),e.touchEnable){var i=n.modelCalculator.scenesMap.get(e.fileName);i&&i.traverse((function(e){"Mesh"===e.type&&(n.modelCalculator.bustard.core.touchTargetObjs.push(e),n.modelCalculator.bustard.core.touchTargetIDs.push(e.uuid))}))}})),n.modelCalculator.module.modelUrls.forEach((function(t){(0,L.inUrls)(e.modelUrls,t)||i.push(t)})),r.length>0?(n.modelCalculator.removeModelsByScenes(i),n.modelCalculator.initLoadModels(r,(function(){n.modelCalculator.showLoadModels(),n.updatePublicModel(e.publicModels,t)}))):i.length>0?n.modelCalculator.removeModelsByScenes(i,(function(){n.updatePublicModel(e.publicModels,t)})):n.updatePublicModel(e.publicModels,t),JSON.stringify(n.modelCalculator.module.lightProperty)!=JSON.stringify(e.lightProperty)&&n.modelCalculator.setdefaultLightProperty(e.lightProperty),n.modelCalculator.module=e}))}},{key:"update",value:function(e,t){var n=this;this.modelCalculator.bustard.core.touchTargetObjs=[],this.modelCalculator.bustard.core.touchTargetIDs=[],JSON.stringify(e.skybox)!=JSON.stringify(this.modelCalculator.module.skybox)&&this.modelCalculator.addSkyBox(e.skybox),e.hdr!=this.modelCalculator.module.hdr&&this.modelCalculator.addHdr(e.hdr,!1,!0),e.cameraPosition&&(this.modelCalculator.defaultView=e.cameraPosition),JSON.stringify(this.modelCalculator.module.lightProperty)!=JSON.stringify(e.lightProperty)&&this.modelCalculator.setdefaultLightProperty(e.lightProperty);var r=this,i=[],a=[];e.modelUrls.forEach((function(e){var t=(0,L.inUrls)(r.modelCalculator.module.modelUrls,e);if(0==t)i.push(e);else if(2==t&&("opacity"in e?"外立面"==e.sceneName||"土建"==e.sceneName?r.modelCalculator.removeSceneByName([e.fileName],{value:e.opacity,time:0}):r.modelCalculator.removeSceneByName([e.fileName],{value:e.opacity}):"外立面"==e.sceneName||"土建"==e.sceneName?r.modelCalculator.restroeSceneByName([e.fileName],{time:0}):r.modelCalculator.restroeSceneByName([e.fileName])),e.touchEnable){var n=r.modelCalculator.scenesMap.get(e.fileName);n&&n.traverse((function(e){"Mesh"===e.type&&(r.modelCalculator.bustard.core.touchTargetObjs.push(e),r.modelCalculator.bustard.core.touchTargetIDs.push(e.uuid))}))}})),r.modelCalculator.module.modelUrls.forEach((function(t){(0,L.inUrls)(e.modelUrls,t)||a.push(t)})),i.length>0?(r.modelCalculator.removeModelsByScenes(a),r.modelCalculator.initLoadModels(i,(function(){r.modelCalculator.showLoadModels(),n.updatePublicModel(e.publicModels,t)}))):a.length>0?r.modelCalculator.removeModelsByScenes(a,(function(){n.updatePublicModel(e.publicModels,t)})):this.updatePublicModel(e.publicModels,t),r.modelCalculator.module=e}},{key:"empty",value:function(e){this.modelCalculator.bustard.core.touchTargetObjs=[],this.modelCalculator.bustard.core.touchTargetIDs=[],this.updatePublicModel([],e),this.modelCalculator.module.publicModels=[]}},{key:"updatePublicModel",value:function(e,t){var n=this,r=[];e.forEach((function(e){r.push(e.id)})),this.modelCalculator.module.publicModels.forEach((function(e){-1==r.indexOf(e.id)&&(n.animationTool.removeAnimationByModelId(e.id),n.modelCalculator.loader.removeTemplateModelByName(e.id))})),0==e.length&&t&&t();var i=[];e.forEach((function(e){n.modelCalculator.loader.modelMap.get(e.id)?(n.modelCalculator.updateModel(e),"transparency"in e&&(e.transparency>=0&&e.transparency<100?n.performAction([{id:e.id}],"transparent",{opacity:e.transparency/100}):100==e.transparency&&n.performAction([{id:e.id}],"restoreTransparent"))):i.push(e)})),this.modelCalculator.initPublicModel(i,t)}},{key:"showFloor",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0;this.modelCalculator.showFloor(e,t,n,r)}},{key:"showBuilding",value:function(e,t){this.modelCalculator.showBuilding(e,t)}},{key:"isFloor",value:function(){return this.modelCalculator.isFloorClip}},{key:"emptyScene",value:function(){this.destroy()}},{key:"destroy",value:function(){for(var e in(0,C.destroyIfNeed)(this._actions),this.logicTreeMap=null,this.modelTree=null,this.context=null,this.upContent=null,this.buildings=null,this.modelUserDataMap=null,this.hideObjects=null,this.labelMap=null,this.labelGroupMap=null,this.clipLabelMap=null,this.clipLabelGroupMap=null,this.currentClipLabelMap=null,this.currentClipLabelGroupMap=null,this.restoreMaterial=null,clearInterval(this.labelInterval),this.labelInterval=null,this.endRoam(),this.clearEffect(),this.modelCalculator.emptyScene(),this.modelCalculator.bustard)this.modelCalculator.bustard[e]=null;this.modelCalculator.bustard=null,this.modelCalculator=null}},{key:"setContextSelectEnable",value:function(e){if(this.enableContextSelect=e,!this.enableContextSelect){var t=[];this.hideObjects.forEach((function(e){t.push(JSON.parse(e))})),this.performActionTest(t,"show")}}},{key:"openStatusDefaultToggle",value:function(){this.enableStatusDefaultToggle=!0}},{key:"closeStatusDefaultToggle",value:function(){this.enableStatusDefaultToggle=!1}},{key:"openContextDefaultToggle",value:function(){this.enableContextDefaultToggle=!0}},{key:"closeContextDefaultToggle",value:function(){this.enableContextDefaultToggle=!1}},{key:"setFreeSwitchTypes",value:function(e){this.freeSwitchTypes=e}},{key:"getDict",value:function(){return A.dict}},{key:"parseScene",value:function(e){var t,n=this,r=[];this.contextRootCode="",this.contextCode="",this.contextLevel=1,this.switchLinkModels=null===(t=e.switchLinkModels)||void 0===t||t,e.context&&(this.context=this.parseContext(e.context,null,1)),this.upContent={"A02.04":[],"A02.03_C2":[],"A02.03_C3":[],"A02.01_C2":[],"A02.01_C3":[],A00:[]},this.buildings=[];var i=null;this.modelUserDataMap=new Map,e.tree.forEach((function(e){var t,a,o;"MCYB_A00"===e.rootCode?i=e:(r.push({id:e.rootCode,url:e.url,position:e.position,rotation:e.rotation,scale:e.scale,type:e.type,touchEnable:e.touchEnable,show:null===(t=e.show)||void 0===t||t,transparency:null!==(a=e.transparency)&&void 0!==a?a:100,isTemplate:null===(o=e.isTemplate)||void 0===o||o}),e.userData&&n.modelUserDataMap.set(e.rootCode,e.userData))})),this.allContext=[],this.hideObjects=[],i&&(this.modelTree=this.parseTree(i,r,1,null,null,null,!1)),e.modelUrls=[],e.publicModels=r,this.markList=e.markList,this.clipConfig=e.clipConfig,this.roamList=e.roamList,this.alarmConfig=e.alarmConfig}},{key:"queryContext",value:function(e,t,n){if(e.rootCode==t&&e.code==n)return e;for(var r=null,i=0,a=e.children.length;i<a&&null==(r=this.queryContext(e.children[i],t,n));i++);return r}},{key:"getContext",value:function(e,t){return this.queryContext(this.context,e,t)}},{key:"queryLogicTree",value:function(e,t,n){if(e.rootCode==t&&e.code==n)return e;for(var r=null,i=0,a=e.children.length;i<a&&null==(r=this.queryLogicTree(e.children[i],t,n));i++);return r}},{key:"getLogicTree",value:function(e,t){if(this.modelTree)return this.logicTreeMap.get(t)}},{key:"getTree",value:function(e){for(var t="",n=e.length-1;n>=0;n--){var r;null!==(r=e[n])&&void 0!==r&&r.name&&e[n].name.indexOf("MCYB")>-1&&(t=""!=t?t+"/"+e[n].name:e[n].name,e[n].name=t)}return e}},{key:"getNeedNode",value:function(e){for(var t="",n=e.length-1;n>=0;n--){var r;null!==(r=e[n])&&void 0!==r&&r.name&&e[n].name.indexOf("MCYB")>-1&&(t=""!=t?t+"/"+e[n].name:e[n].name,e[n].name=t)}for(var i=[],a=0,o=0,s=e.length;o<s;o++){var l=this.getLogicTree(e[o].id,e[o].name);if(l&&l.statusCodes.length>0){a=o;break}}for(var u=e.slice(a,e.length),c=0,h=u.length;c<h;c++){var d=this.getLogicTree(u[c].id,u[c].name);if(d){var p=this.getLogicTree(this.contextRootCode,this.contextCode);p?p==d?i.push(d):this.isParent(p,d)?(i.push(d),this.getParentInObject(p,d,i)):(this.isParent(d,p),i.push(this.getFirstParent(p,d))):i.push(d);break}}return i[i.length-1]}},{key:"getFirstParent",value:function(e,t){return t.url||this.isParent(t,e)&&t.isContext?t:t.parent?this.getFirstParent(e,t.parent):void 0}},{key:"getParentInObject",value:function(e,t,n){t.level>e.level&&(1==t.isContext&&t.level>2&&n.push(t),t.parent&&this.getParentInObject(e,t.parent,n))}},{key:"getContextByTree",value:function(e){for(var t,n=e.length-1;n>=0;n--){var r=this.getLogicTree(e[n].id,e[n].name);if(r){var i=this.getContext(r.contentRootCode,r.contentCode),a=!1,o=this.getLogicTree(i.rootCode,i.rootCode);if(o&&this.freeSwitchTypes.indexOf(o.type)>-1&&(a=!0),(a||i.level>=this.contextLevel)&&(i.rootCode!=this.contextRootCode||i.code!=this.contextCode)){t=i;break}}}return t}},{key:"addParent",value:function(e,t){e.parent&&(t.push({id:e.parent.rootCode,name:e.parent.code}),this.addParent(e.parent,t))}},{key:"getNodesContext",value:function(e){var t=this;return e.forEach((function(e){var n=t.getLogicTree(e.modelId,e.modelName);n&&n.parent&&(e.contentRootCode=n.parent.contentRootCode,e.contentCode=n.parent.contentCode)})),e}},{key:"getNodeStatusCodes",value:function(e,t){var n=this.getLogicTree(e,t);if(n&&!(n.statusCodes.length<2)&&-1!=n.statusCodes.indexOf("D1"))return{statusCodes:n.statusCodes,statusCode:n.statusCode}}},{key:"changeStatusByPick",value:function(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=this.getNodeStatusCodes(e[n].id,e[n].name);if(i&&2==i.statusCodes.length){var a=i.statusCodes.indexOf(i.statusCode);0==a?t=this.updateNodeStatus(e[n].id,e[n].name,i.statusCodes[1]):1==a&&(t=this.updateNodeStatus(e[n].id,e[n].name,i.statusCodes[0]));break}}return t}},{key:"updateNodeStatus",value:function(e,t,n){var r=this.getLogicTree(e,t);if(!r)return 0;if(r.statusCodes.length<2)return 0;if(-1==r.statusCodes.indexOf("D1"))return 0;if(r.parent&&1==r.parent.isContext)return 0;var i=r.code.split("/"),a=i[i.length-1],o=this.getLogicTree(r.rootCode,r.rootCode);if(a.indexOf("A02.08")>-1&&o&&"设备"==o.type&&r.parent&&r.parent.parent){var s=r.parent.code.split("/"),l=s[s.length-1],u=r.parent.parent.code.split("/"),c=u[u.length-1];if(l.indexOf("_C1_")>-1&&1==c.isContext)return 0}return this.setNodeStatus(r,n),this.renderTool.setNeedUpdate(),1}},{key:"setNodeStatus",value:function(e,t){var n=this;e.statusCode=t,e.children.forEach((function(e){var r=e.code.split("/");r[r.length-1].indexOf("_"+t+"_")>-1?n.performActionTest([{id:e.rootCode,name:e.code}],"show",{isStatus:!0}):n.performActionTest([{id:e.rootCode,name:e.code}],"hide",{isStatus:!0})}))}},{key:"initAllNodeStatus",value:function(){this.updateStatus(this.modelTree)}},{key:"initMarks",value:function(){this.markList&&this.modelCalculator.initMarks(this.markList)}},{key:"getCurrentContext",value:function(){return{contextRootCode:this.contextRootCode,contextCode:this.contextCode}}},{key:"selectContext",value:function(e,t,n){if(!this.enableContextSelect)return 0;if(e==this.contextRootCode&&t==this.contextCode)return 0;var r=this.getLogicTree(e,t);if(r){var i=this.getContext(r.contentRootCode,r.contentCode);if(!i||4==i.contextBehavior)return 0;if(this.lightActingModels=[],this.lightNotActingModels=[],this.updateContext(i),this.contextRootCode=e,this.contextCode=t,this.contextLevel=i.level,this.modelCalculator.bustard.core.renderer.shadowMap.needsUpdate=!0,this.initAllNodeStatus(),this.updateLightModels(),this.renderTool.setNeedUpdate(),this.contextChangeHandler&&this.contextChangeHandler(i),n){var a={contextRootCode:this.contextRootCode,contextCode:this.contextCode,changeContext:!0};a.context=i,a.logicTree=r,n(a)}return 1}}},{key:"updateLightModels",value:function(){var e=this;this.lightActingModels.forEach((function(t){var n=e.modelCalculator.loader.modelMap.get(t.id);n&&n.userData.isOnly&&n.traverse((function(e){if("Mesh"==e.type){var t=["#include <lights_fragment_begin>"].join("\n");e.material.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin2>",t)},e.material.needsUpdate=!0}}))})),this.lightNotActingModels.forEach((function(t){var n=e.modelCalculator.loader.modelMap.get(t.id);n&&n.userData.isOnly&&n.traverse((function(e){if("Mesh"==e.type){var t=["#include <lights_fragment_begin2>"].join("\n");e.material.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",t)},e.material.needsUpdate=!0}}))}))}},{key:"setContextChangeHandler",value:function(e){this.contextChangeHandler=e}},{key:"showContexts",value:function(e){var t=this;if(!this.enableContextSelect)return 0;var n=[];return e.forEach((function(e){var r=t.getContext(e.rootCode,e.code);r&&n.push(r)})),this.updateContexts(n),this.contextRootCode="",this.contextCode="",this.initAllNodeStatus(),this.renderTool.setNeedUpdate(),1}},{key:"updateContexts",value:function(e){var t=this,n=[],r=[];e.forEach((function(e){var n=[];t.getSelectContexts(n,e),r.push(n)}));var i=[];r.forEach((function(e){e.forEach((function(e){i.push(e)}))})),this.updateContextObjects2(this.modelTree,n,i,r,!1);var a=[],o=[];this.hideObjects.forEach((function(e){-1==n.indexOf(e)&&a.push(JSON.parse(e))})),n.forEach((function(e){o.push(JSON.parse(e))})),this.hideObjects=n,this.performActionTest(a,"show"),this.performActionTest(o,"hide"),i.forEach((function(e){e.children.forEach((function(e){var n=e.code.split("/"),r=n[n.length-1];"设备"==t.getLogicTree(e.rootCode,e.rootCode).type&&r.indexOf("A02.08")>-1&&2==e.statusCodes.length?t.setNodeStatus(e,"D2"):r.indexOf("_C1_")>-1&&e.children.forEach((function(e){var n=t.getLogicTree(e.rootCode,e.rootCode),r=e.code.split("/"),i=r[r.length-1];"设备"==n.type&&i.indexOf("A02.08")>-1&&2==e.statusCodes.length&&t.setNodeStatus(e,"D2")}))}))})),this.allContext.forEach((function(e){-1==i.indexOf(e)&&e.children.forEach((function(e){var n=e.code.split("/"),r=n[n.length-1];"设备"==t.getLogicTree(e.rootCode,e.rootCode).type&&r.indexOf("A02.08")>-1&&2==e.statusCodes.length?t.setNodeStatus(e,"D1"):r.indexOf("_C1_")>-1&&e.children.forEach((function(e){var n=t.getLogicTree(e.rootCode,e.rootCode),r=e.code.split("/"),i=r[r.length-1];"设备"==n.type&&i.indexOf("A02.08")>-1&&2==e.statusCodes.length&&t.setNodeStatus(e,"D1")}))}))}))}},{key:"updateContextObjects2",value:function(e,t,n,r,i){var a=this,o=e.code.split("/"),s=o[o.length-1];if(s.indexOf("_C2_")>-1)-1==n.indexOf(e.parent)&&(t.push(JSON.stringify({id:e.rootCode,name:e.code})),i=!0);else if(e.level>3&&e.url)if(this.switchLinkModels)i&&t.push(JSON.stringify({id:e.rootCode,name:e.code}));else{var l=this.getLogicTree(e.parent.contentRootCode,e.parent.contentCode),u=!0;r.forEach((function(t){var n=!1;if(!a.isParent(l,t[0])&&l.level>2)n=!0;else if(!a.isParent(e,t[0])&&!a.isParent(t[0],e))for(var r=t.length-1;r>=0;r--)if(e.parent&&e.parent!=t[r]&&a.isParent(e.parent,t[r])){0!=t[r].contextBehavior&&1!=t[r].contextBehavior||(n=!0);break}n||(u=!1)})),u&&t.push(JSON.stringify({id:e.rootCode,name:e.code}))}else if(-1==s.indexOf("_D")){for(var c=!1,h=0,d=r.length;h<d;h++)if(this.isParent(e,r[h][0])||this.isParent(r[h][0],e)){c=!0;break}if(c)s.indexOf("_C1_")>-1&&n.indexOf(e.parent)>-1&&(0!=e.parent.contextBehavior&&2!=e.parent.contextBehavior||(t.push(JSON.stringify({id:e.rootCode,name:e.code})),i=!0));else for(var p=0,f=r.length;p<f;p++){for(var m=r[p],v=!1,g=m.length-1;g>=0;g--)if(e.parent&&e.parent!=m[g]&&this.isParent(e.parent,m[g])){0!=m[g].contextBehavior&&1!=m[g].contextBehavior||(v=!0);break}if(v){t.push(JSON.stringify({id:e.rootCode,name:e.code})),i=!0;break}}}e.children.forEach((function(e){a.updateContextObjects2(e,t,n,r,i)}))}},{key:"updateContext",value:function(e){var t=this,n=[],r=[];this.getSelectContexts(r,e),this.updateContextObjects(this.modelTree,n,r,!1);var i=[],a=[];this.hideObjects.forEach((function(e){-1==n.indexOf(e)&&i.push(JSON.parse(e))})),n.forEach((function(e){a.push(JSON.parse(e))})),this.hideObjects=n,this.performActionTest(i,"show"),this.performActionTest(a,"hide"),r.forEach((function(e){e.children.forEach((function(e){var n=e.code.split("/"),r=n[n.length-1];"设备"==t.getLogicTree(e.rootCode,e.rootCode).type&&r.indexOf("A02.08")>-1&&2==e.statusCodes.length?t.setNodeStatus(e,"D2"):r.indexOf("_C1_")>-1&&e.children.forEach((function(e){var n=t.getLogicTree(e.rootCode,e.rootCode),r=e.code.split("/"),i=r[r.length-1];"设备"==n.type&&i.indexOf("A02.08")>-1&&2==e.statusCodes.length&&t.setNodeStatus(e,"D2")}))}))})),this.allContext.forEach((function(e){-1==r.indexOf(e)&&e.children.forEach((function(e){var n=e.code.split("/"),r=n[n.length-1];"设备"==t.getLogicTree(e.rootCode,e.rootCode).type&&r.indexOf("A02.08")>-1&&2==e.statusCodes.length?t.setNodeStatus(e,"D1"):r.indexOf("_C1_")>-1&&e.children.forEach((function(e){var n=t.getLogicTree(e.rootCode,e.rootCode),r=e.code.split("/"),i=r[r.length-1];"设备"==n.type&&i.indexOf("A02.08")>-1&&2==e.statusCodes.length&&t.setNodeStatus(e,"D1")}))}))}))}},{key:"getSelectContexts",value:function(e,t){var n=this.getLogicTree(t.rootCode,t.code);n&&(n.contextBehavior=t.contextBehavior,e.push(n)),t.parent&&this.getSelectContexts(e,t.parent)}},{key:"updateContextObjects",value:function(e,t,n,r){var i=this,a=!this.isParent(e,n[0])&&!this.isParent(n[0],e);e.url&&(a?this.lightNotActingModels.push({id:e.rootCode,name:e.code}):this.lightActingModels.push({id:e.rootCode,name:e.code}));var o=e.code.split("/"),s=o[o.length-1];if(s.indexOf("_C2_")>-1)-1==n.indexOf(e.parent)&&(t.push(JSON.stringify({id:e.rootCode,name:e.code})),r=!0);else if(e.level>3&&e.url)if(this.switchLinkModels)r&&t.push(JSON.stringify({id:e.rootCode,name:e.code}));else{var l=this.getLogicTree(e.parent.contentRootCode,e.parent.contentCode);if(!this.isParent(l,n[0])&&l.level>2)t.push(JSON.stringify({id:e.rootCode,name:e.code}));else if(a)for(var u=n.length-1;u>=0;u--)if(e.parent&&e.parent!=n[u]&&this.isParent(e.parent,n[u])){0!=n[u].contextBehavior&&1!=n[u].contextBehavior||t.push(JSON.stringify({id:e.rootCode,name:e.code}));break}}else if(-1==s.indexOf("_D"))if(this.isParent(e,n[0])||this.isParent(n[0],e))s.indexOf("_C1_")>-1&&n.indexOf(e.parent)>-1&&(0!=e.parent.contextBehavior&&2!=e.parent.contextBehavior||(t.push(JSON.stringify({id:e.rootCode,name:e.code})),r=!0));else if(a)for(var c=n.length-1;c>=0;c--)if(e.parent&&e.parent!=n[c]&&this.isParent(e.parent,n[c])){0!=n[c].contextBehavior&&1!=n[c].contextBehavior||(t.push(JSON.stringify({id:e.rootCode,name:e.code})),r=!0);break}e.children.forEach((function(e){i.updateContextObjects(e,t,n,r)}))}},{key:"setRightDoubleClickAction",value:function(e){var t=this;this.modelCalculator.setRightDoubleClickAction((function(){var n=!1;if(t.rightDoubleClickBeforeAction){var r={contextRootCode:t.contextRootCode,contextCode:t.contextCode,changeContext:n};if(r.context=t.getContext(t.contextRootCode,t.contextCode),r.logicTree=t.getLogicTree(t.contextRootCode,t.contextCode),!t.rightDoubleClickBeforeAction(r))return}if(t.modelTree&&t.enableContextSelect&&t.enableContextDefaultToggle){var i=t.getContext(t.contextRootCode,t.contextCode);i&&i.parent&&(3==i.level&&(i=i.parent),t.selectContext(i.parent.rootCode,i.parent.code),n=!0)}if(e){var a={contextRootCode:t.contextRootCode,contextCode:t.contextCode,changeContext:n};a.context=t.getContext(t.contextRootCode,t.contextCode),a.logicTree=t.getLogicTree(t.contextRootCode,t.contextCode),e(a)}}))}},{key:"setRightDoubleClickBeforeAction",value:function(e){this.rightDoubleClickBeforeAction=e}},{key:"isParent",value:function(e,t){return t==e||!(!t||!t.parent)&&this.isParent(e,t.parent)}},{key:"updateStatus",value:function(e){var t=this;e.statusCodes.length>0&&this.setNodeStatus(e,e.statusCode),e.children.forEach((function(e){t.updateStatus(e)}))}},{key:"parseContext",value:function(e,t,n){var r=this,i=new d.Context(e);return i.level=n,i.parent=t,e.children&&(n+=1,e.children.forEach((function(e){i.children.push(r.parseContext(e,i,n))}))),i}},{key:"parseTree",value:function(e,t,n,r,i,a,o){var s=this,l=new h.LogicTree(e);if(this.logicTreeMap.set(l.code,l),l.level=n,l.parent=r,l.isContext&&(i=l.rootCode,a=l.code,this.allContext.push(l)),l.contentRootCode=i,l.contentCode=a,e.url){var u,c=this.getContext(i,a);u=this.switchLinkModels?!o:!(c.level>3),t.push({id:e.rootCode,url:e.url,position:e.position,rotation:e.rotation,scale:e.scale,type:e.type,touchEnable:e.touchEnable,show:u}),"外立面"!=e.type&&"土建"!=e.type||this.buildings.push(e.code)}var d=l.code.split("/"),p=d[d.length-1].split("_");return"A02.04"==p[1]?this.upContent["A02.04"].push({id:l.rootCode,name:l.code}):"A02.03"==p[1]?"C2"==p[2]?this.upContent["A02.03_C2"].push({id:l.rootCode,name:l.code}):"C3"==p[2]&&this.upContent["A02.03_C3"].push({id:l.rootCode,name:l.code}):"A02.01"==p[1]?"C2"==p[2]?this.upContent["A02.01_C2"].push({id:l.rootCode,name:l.code}):"C3"==p[2]&&this.upContent["A02.01_C3"].push({id:l.rootCode,name:l.code}):"A00"==p[1]&&3==p.length&&this.upContent.A00.push({id:l.rootCode,name:l.code}),"C2"==p[2]&&(o=!0),e.children&&(n+=1,e.children.forEach((function(e){l.children.push(s.parseTree(e,t,n,l,i,a,o));var r=e.code.split("/"),u=r[r.length-1];l.url||(u.indexOf("_D1_")>-1?(l.statusCodes.push("D1"),l.statusCode="D1"):u.indexOf("_D2_")>-1?l.statusCodes.push("D2"):u.indexOf("_D2.1_")>-1?l.statusCodes.push("D2.1"):u.indexOf("_D2.2_")>-1?l.statusCodes.push("D2.2"):u.indexOf("_D2.3_")>-1&&l.statusCodes.push("D2.3"))}))),l}},{key:"isEqual",value:function(e,t){for(var n=!1,r=0,i=t.length;r<i;r++)if(t[r].id==e.id&&t[r].name==e.name){n=!0;break}return n}},{key:"updateModelParent",value:function(e){var t=this,n=this.modelCalculator.updateModelParent(e,this.buildings);if(n){var r=[];n.forEach((function(e){(e=t.getTree(e)).forEach((function(e){r.push(e)}))}));for(var i=!1,a=null,o=0,s=this.upContent["A02.04"].length;o<s;o++)if(this.modelCalculator.isInBox(e,[this.upContent["A02.04"][o]])&&this.isEqual(this.upContent["A02.04"][o],r)){a=this.upContent["A02.04"][o],i=!0;break}if(!i)for(var l=0,u=this.upContent["A02.03_C2"].length;l<u;l++)if(this.modelCalculator.isInBox(e,[this.upContent["A02.03_C2"][l]])){a=this.upContent["A02.03_C2"][l],i=!0;break}if(!i)for(var c=0,h=this.upContent["A02.03_C3"].length;c<h;c++)if(this.modelCalculator.isInBox(e,[this.upContent["A02.03_C3"][c]])){a=this.upContent["A02.03_C3"][c],i=!0;break}if(!i)for(var d=0,p=this.upContent["A02.01_C2"].length;d<p;d++)if(this.modelCalculator.isInBox(e,[this.upContent["A02.01_C2"][d]])){a=this.upContent["A02.01_C2"][d],i=!0;break}if(!i)for(var f=0,m=this.upContent["A02.01_C3"].length;f<m;f++)if(this.modelCalculator.isInBox(e,[this.upContent["A02.01_C3"][f]])){a=this.upContent["A02.01_C3"][f],i=!0;break}if(!i)for(var v=0,g=this.upContent.A00.length;v<g;v++){var y=this.parseTargetsWithFolder([this.upContent.A00[v]]);if(this.modelCalculator.isInBox(e,y)){a=this.upContent.A00[v],i=!0;break}}return a?this.getLogicTree(a.id,a.name):null}}},{key:"getModelParent",value:function(e){var t=this.getLogicTree(e,e);if(t)return t.parent}},{key:"initScene",value:function(e,t){var n=this;e=JSON.parse(JSON.stringify(e));var r=!1;e.cameraPosition&&""!=e.cameraPosition||(r=!0),this.parseScene(e),this.initRoam(this.roamList),this.labelMap=new Map,this.labelGroupMap=new Map,this.clipLabelMap=new Map,this.clipLabelGroupMap=new Map,this.currentClipLabelMap=new Map,this.currentClipLabelGroupMap=new Map,this.labelInterval&&clearInterval(this.labelInterval),this.clearEffect(),this.enter(e,(function(){r&&n.changeOrientation("before"),n.initLabel(e),self.modelTree&&self.selectContext(self.modelTree.rootCode,self.modelTree.code),t&&t()}))}},{key:"emptyModel",value:function(){this.labelMap=new Map,this.labelGroupMap=new Map,this.clipLabelMap=new Map,this.clipLabelGroupMap=new Map,this.currentClipLabelMap=new Map,this.currentClipLabelGroupMap=new Map,this.labelInterval&&clearInterval(this.labelInterval),this.emptyLabel(),this.modelCalculator.removeWaterMeshs(),this.clearEffect(),this.empty()}},{key:"updateScene",value:function(e,t){var n=this;e=JSON.parse(JSON.stringify(e));var r=[];this.hideObjects.forEach((function(e){r.push(JSON.parse(e))})),this.performActionTest(r,"show"),this.parseScene(e),this.initRoam(this.roamList),this.clipLabelMap=new Map,this.clipLabelGroupMap=new Map,this.currentClipLabelMap=new Map,this.currentClipLabelGroupMap=new Map,this.clearEffect(),this.update(e,(function(){n.updateSpaceLabel(e),self.modelTree&&n.selectContext(n.modelTree.rootCode,n.modelTree.code),n.modelCalculator.render(),t&&t()}))}},{key:"setColor",value:function(e,t){this.modelCalculator.setColor(e,(0,P.colorToHex)(t))}},{key:"setNodeColorValue",value:function(e,t,n){this.modelCalculator.setColorValue(e,t,n)}},{key:"restoreMesh",value:function(e){this.modelCalculator.restoreMesh(e)}},{key:"restoreColor",value:function(){this.modelCalculator.restoreColor()}},{key:"clearFocusModel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.modelCalculator.restoreColor(),this.modelCalculator.removeObjectBox(),this.modelCalculator.emptySelectEffect(),this.modelCalculator.restoreTransparentObjects(),e&&(this.modelCalculator.modelHide.restore(),this.resetAllClip())}},{key:"setEnableAdsorptionModel",value:function(e){this.modelCalculator.setEnableAdsorptionModel(e)}},{key:"getSnapshot",value:function(){return this.modelCalculator.render(),this.modelCalculator.bustard.core.renderer.domElement.toDataURL("image/png",1)}},{key:"setMouseButtonsState",value:function(e,t){this.modelCalculator.setMouseButtonsState(e,t)}},{key:"initLabel",value:function(e){var t=this;e.label&&""!=e.label&&e.label.forEach((function(e){var n;e.linkClip&&e.linkClip.id&&""!=e.linkClip.id?t.clipLabelMap.set(e.id,e):((n=e.dom&&e.dom instanceof Element?e.dom:t.createLabelElement(e.name,e.style)).onclick=function(n){n.stopPropagation(),t.pickLabelAction&&t.pickLabelAction({id:e.id,name:e.name,userData:e.userData,type:"label"}),e.cameraPosition&&""!=e.cameraPosition&&t.lookAt(e.cameraPosition.position,e.cameraPosition.target)},n.onmousemove=function(e){e.stopPropagation()},t.addLabel(e.id,n,e.position),t.labelMap.set(e.id,e))})),e.labelGroup&&""!=e.labelGroup&&e.labelGroup.forEach((function(e){var n;e.children.length>0&&t.clipLabelMap.get(e.children[0])&&(e.linkClip=t.clipLabelMap.get(e.children[0]).linkClip),e.linkClip&&e.linkClip.id&&""!=e.linkClip.id?t.clipLabelGroupMap.set(e.id,e):((n=e.dom&&e.dom instanceof Element?e.dom:t.createDefaultLabelElement(e.name,{icon:"./lib/resource/label/label.png",textBackgroundColor:"rgba(26, 41, 52, 0.6)",fontFamily:"宋体",color:"#ffffff",fontSize:"12px"})).onclick=function(n){n.stopPropagation(),t.pickLabelAction&&t.pickLabelAction({id:e.id,name:e.name,userData:e.userData,type:"label"}),e.cameraPosition&&""!=e.cameraPosition&&t.lookAt(e.cameraPosition.position,e.cameraPosition.target)},n.onmousemove=function(e){e.stopPropagation()},t.addLabel(e.id,n,e.position),t.labelGroupMap.set(e.id,e))})),this.labelInterval=setInterval((function(){t.labelControl()}),500)}},{key:"labelControl",value:function(){var e=this;this.labelGroupMap.forEach((function(t,n){var r=e.modelCalculator.label.labelMap.get(n);r&&((0,S.pointDistance)(e.modelCalculator.bustard.core.camera.position,t.position)>t.distance?(r.visible=!0,t.children.forEach((function(t){var n=e.modelCalculator.label.labelMap.get(t);n&&(n.visible=!1)}))):(r.visible=!1,t.children.forEach((function(t){var n=e.modelCalculator.label.labelMap.get(t);n&&(n.visible=!0)}))))})),this.currentClipLabelGroupMap.forEach((function(t,n){var r=e.modelCalculator.label.labelMap.get(n);r&&((0,S.pointDistance)(e.modelCalculator.bustard.core.camera.position,t.position)>t.distance?(r.visible=!0,t.children.forEach((function(t){var n=e.modelCalculator.label.labelMap.get(t);n&&(n.visible=!1)}))):(r.visible=!1,t.children.forEach((function(t){var n=e.modelCalculator.label.labelMap.get(t);n&&(n.visible=!0)}))))}))}},{key:"updateSpaceLabel",value:function(e){var t=this;this.labelInterval&&clearInterval(this.labelInterval);var n=new Map;e.label&&""!=e.label&&e.label.forEach((function(e){e.linkClip&&e.linkClip.id&&""!=e.linkClip.id?t.clipLabelMap.set(e.id,e):n.set(e.id,e)}));var r=new Map;e.labelGroup&&""!=e.labelGroup&&e.labelGroup.forEach((function(e){e.children.length>0&&t.clipLabelMap.get(e.children[0])&&(e.linkClip=t.clipLabelMap.get(e.children[0]).linkClip),e.linkClip&&e.linkClip.id&&""!=e.linkClip.id?t.clipLabelGroupMap.set(e.id,e):r.set(e.id,e)})),this.labelMap.forEach((function(e,r){n.get(r)||t.deleteLabel(r)})),n.forEach((function(e,n){var r,i;t.labelMap.get(n)?JSON.stringify(e)!=JSON.stringify(t.labelMap.get(n))&&((r=e.dom&&e.dom instanceof Element?e.dom:t.createLabelElement(e.name,e.style)).onclick=function(r){r.stopPropagation(),t.pickLabelAction&&t.pickLabelAction({id:n,name:e.name,userData:e.userData,type:"label"}),e.cameraPosition&&""!=e.cameraPosition&&t.lookAt(e.cameraPosition.position,e.cameraPosition.target)},r.onmousemove=function(e){e.stopPropagation()},t.updateLabel(n,r,e.position)):((i=e.dom&&e.dom instanceof Element?e.dom:t.createLabelElement(e.name,e.style)).onclick=function(r){r.stopPropagation(),t.pickLabelAction&&t.pickLabelAction({id:n,name:e.name,userData:e.userData,type:"label"}),e.cameraPosition&&""!=e.cameraPosition&&t.lookAt(e.cameraPosition.position,e.cameraPosition.target)},i.onmousemove=function(e){e.stopPropagation()},t.addLabel(n,i,e.position))})),this.labelGroupMap.forEach((function(e,n){r.get(n)||t.deleteLabel(n)})),r.forEach((function(e,n){var r,i;t.labelGroupMap.get(n)?JSON.stringify(e)!=JSON.stringify(t.labelGroupMap.get(n))&&((r=e.dom&&e.dom instanceof Element?e.dom:t.createDefaultLabelElement(e.name,{icon:"./lib/resource/label/label.png",textBackgroundColor:"rgba(26, 41, 52, 0.6)",fontFamily:"宋体",color:"#ffffff",fontSize:"12px"})).onclick=function(r){r.stopPropagation(),t.pickLabelAction&&t.pickLabelAction({id:n,name:e.name,userData:e.userData,type:"label"}),e.cameraPosition&&""!=e.cameraPosition&&t.lookAt(e.cameraPosition.position,e.cameraPosition.target)},r.onmousemove=function(e){e.stopPropagation()},t.updateLabel(n,r,e.position)):((i=e.dom&&e.dom instanceof Element?e.dom:t.createDefaultLabelElement(e.name,{icon:"./lib/resource/label/label.png",textBackgroundColor:"rgba(26, 41, 52, 0.6)",fontFamily:"宋体",color:"#ffffff",fontSize:"12px"})).onclick=function(r){r.stopPropagation(),t.pickLabelAction&&t.pickLabelAction({id:n,name:e.name,userData:e.userData,type:"label"}),e.cameraPosition&&""!=e.cameraPosition&&t.lookAt(e.cameraPosition.position,e.cameraPosition.target)},i.onmousemove=function(e){e.stopPropagation()},t.addLabel(n,i,e.position))})),this.labelMap=n,this.labelGroupMap=r,this.labelInterval=setInterval((function(){t.labelControl()}),500)}},{key:"createLabelElement",value:function(e,t){var n=document.createElement("div");n.style.cursor="pointer",n.style.width=null!=t&&t.width?t.width:"40px",n.style.height=null!=t&&t.height?t.height:"40px",n.style.backgroundImage="url('"+(null==t?void 0:t.icon)+"')",n.style.backgroundSize="100% 100%",n.style.textAlign="center";var r=document.createElement("span");return r.style.position="absolute",r.style.width="100%",r.style.top=20+(null!=t&&t.offsetX?Number(t.offsetX):0)+"px",r.style.left=20+(null!=t&&t.offsetY?Number(t.offsetY):0)+"px",r.style.translate="-50% -50%",r.style.backgroundColor=null==t?void 0:t.textBackgroundColor,r.style.color=null==t?void 0:t.color,r.style.fontFamily=null==t?void 0:t.fontFamily,r.style.fontSize=null==t?void 0:t.fontSize,r.style["text-wrap"]="nowrap",r.style.whiteSpace="nowrap",e&&null!==t&&(r.innerText=e),n.appendChild(r),n}},{key:"createDefaultLabelElement",value:function(e,t){var n=document.createElement("div");n.style.cursor="pointer",n.style.width=t.width?t.width:"64px",n.style.height=t.height?t.height:"35px",n.style.backgroundImage="url('"+t.icon+"')",n.style.backgroundSize="100% 100%",n.style.textAlign="center";var r=document.createElement("span");return r.style.position="absolute",r.style.width="100%",r.style.top="50%",r.style.left="50%",r.style.translate="-50% -50%",r.style.backgroundColor=t.textBackgroundColor,r.style.color=t.color,r.style.fontFamily=t.fontFamily,r.style.fontSize=t.fontSize,r.innerText=e,n.appendChild(r),n}},{key:"add",value:function(e,t,n,r,i,a,o){var s=arguments.length>8?arguments[8]:void 0;this.modelCalculator.add(e,t,n,r,i,a,o,!1,s)}},{key:"addModel",value:function(e,t,n){this.modelCalculator.loader.modelMap.get(e)||this.add(e,t.url,t.position,t.rotation,t.scale,t.type,t.touchEnable,!0,n)}},{key:"updateModel",value:function(e,t,n,r){"object"===(0,a.default)(e)?this.modelCalculator.updateModel(e):this.modelCalculator.updateModel({id:e,position:t,rotation:n,scale:r,enbaleTouch:!1})}},{key:"removeModel",value:function(e){this.modelCalculator.loader.removeTemplateModelByName(e)}},{key:"addPublicModelByMousePosition",value:function(e,t,n,r,i,a,o){var s=this;this.modelCalculator.enableTouch(!1);var l=this.modelCalculator.bustard.core.getFirstIntersection(e,t),u=l?l.point:{x:0,y:0,z:0};this.modelCalculator.addTemplateModel(i,i,(function(){var e=s.modelCalculator.addSignageModelByCoords(i,n,u,{x:0,y:0,z:0},{x:1,y:1,z:1},a,!0);s.modelCalculator.bustard.core.transformControlAttach(e),o&&o({id:n,name:r,type:a,url:i,position:{x:u.x,y:u.y,z:u.z},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},label:null,focusView:null,focusEffect:null,focusLink:[],modelEffect:[],modelAnimation:[],children:[]})}))}},{key:"cancelControl",value:function(){this.modelCalculator.cancelControlMonitor(),this.modelCalculator.enableTouch(!0)}},{key:"startControl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.modelCalculator.enableTouch(!1),this.modelCalculator.controlMonitor(e,t)}},{key:"cancelAdd",value:function(){return this.modelCalculator.cancelMonitor()}},{key:"moveObjectByTime",value:function(e,t,n,r,i){this.modelCalculator.moveObjectByTime(e,t,n,r,i)}},{key:"moveObject",value:function(e,t,n,r,i){this.modelCalculator.moveObject(e,t,n,r,i)}},{key:"pathMoveObject",value:function(e,t,n,r,i){this.modelCalculator.pathMoveObject(e,t,n,r,i)}},{key:"stopMoveObject",value:function(e,t){this.modelCalculator.stopMoveObject(e,t)}},{key:"createAlarm",value:function(e,t){var n=this.alarmConfig.get(e);n&&("ring"==n.type?this.addRingEffect(2,.1,.5,16711680,.05,t):"ball"==n.type?this.addBallEfffect(t,.5,16711680,.1):"fire"==n.type?this.addFireSprite(t,.5):"smoke"==n.type?this.addSmoke("smoke",t,1,3,1):"wall"==n.type&&this.addRail((0,L.uuid)(),t,2,{repeatX:4,repeatY:1,speed:.005}))}},{key:"removeAlarm",value:function(e){var t=this.alarmConfig.get(e);t&&("ring"==t.type?this.removeRingEffect():"ball"==t.type?this.removeBallEfffect():"fire"==t.type?this.removeAllParticleFire():"smoke"==t.type?this.removeAllSmoke():"wall"==t.type&&this.removeRailEffect())}},{key:"resize",value:function(){this.modelCalculator.resize()}},{key:"getModelTree",value:function(e){return this.modelCalculator.loader.treeMap.get(e)}},{key:"addMark",value:function(e,t){var n=(0,E.createMarkElement)(t);this.modelCalculator.addLabel(e,n,t.coordinate)}},{key:"emptyMark",value:function(){this.modelCalculator.emptyLabel()}},{key:"add3DMaker",value:function(e,t){this.modelCalculator.add3DMaker1(e,t)}},{key:"remove3DMaker",value:function(e){return this.modelCalculator.remove3DMaker(e)}},{key:"clear3DMaker",value:function(){return this.modelCalculator.clear3DMaker()}},{key:"addLabel",value:function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:16711680,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:5,s=this.modelCalculator.label.labelMap.get(e);n=(0,B.convertToVector3)(n),s?(s.element.remove(),s.element=t,s.position.set(n.x,n.y,n.z),s.userData.labelType=i,this.renderTool.setNeedUpdate()):this.modelCalculator.addLabel(e,t,n,r,i,a,o)}},{key:"addLabelToModel",value:function(e,t,n,r,i,a){this.modelCalculator.addLabelToModel(e,t,n,r,i,a)}},{key:"addFloorLabel",value:function(e,t,n,r){this.modelCalculator.addFloorLabel(e,t,n,r)}},{key:"deleteLabel",value:function(e){this.modelCalculator.deleteLabel(e)}},{key:"updateLabel",value:function(e,t,n){var r=this.modelCalculator.label.labelMap.get(e);(0,B.isNil)(r)||(r.visible=!0,(0,B.isNotNil)(t)&&(r.element.remove(),r.element=t),(0,B.isNotNil)(n)&&r.position.set(n.x,n.y,n.z))}},{key:"emptyLabel",value:function(e){this.modelCalculator.emptyLabel(e)}},{key:"addSpriteLabel",value:function(e,t,n){var r=t.url,i=t.position,a=t.scale,o=t.sizeAttenuation;this.modelCalculator.addSpriteToScene(e,r,i,a,o,n)}},{key:"updateSpriteLabel",value:function(e,t){var n=t.visible;(0,B.isNotNil)(n)&&this.modelCalculator.updateSpriteVisible(e,n),this.renderTool.setNeedUpdate()}},{key:"addMark3D",value:function(e,t){var n=t.imagePath,r=t.coordinate,i=t.scale,a=t.sizeAttenuation;this.modelCalculator.addSpriteToScene(e,n,r,[i.x,i.y,i.z],a)}},{key:"setAllLabelVisible",value:function(e){this.modelCalculator.label.labelMap.forEach((function(t){t.visible=e}))}},{key:"setLabelVisible",value:function(e,t){var n=this.modelCalculator.label.labelMap.get(e);n&&(n.visible=t)}},{key:"addLabelGlowRing",value:function(e,t){this.modelCalculator.addLabelGlowRing(e,t)}},{key:"add3DLabel",value:function(e,t){if(!t.position){var n=this.modelCalculator.bustard.core.getMeshByName(e+"面");n&&n.userData&&(t.position={x:n.userData.centroid[0],y:"city"==n.userData.type?15.05:7.55,z:n.userData.centroid[1]})}t.position&&this.modelCalculator.add3DLabel(e,t)}},{key:"remove3DLabel",value:function(e){this.modelCalculator.remove3DLabel(e)}},{key:"clear3DLabel",value:function(){this.modelCalculator.clear3DLabel()}},{key:"hide3DLabel",value:function(e){var t=this;"string"==typeof e?this.modelCalculator.hide3DLabel(e):Array.isArray(e)&&e.forEach((function(e){t.modelCalculator.hide3DLabel(e)}))}},{key:"show3DLabel",value:function(e){var t=this;"string"==typeof e?this.modelCalculator.show3DLabel(e):Array.isArray(e)&&e.forEach((function(e){t.modelCalculator.show3DLabel(e)}))}},{key:"update3DLabel",value:function(e,t){this.modelCalculator.update3DLabel(e,t)}},{key:"lookAt",value:function(e,t,n,r,i){this.lookAt2({position:e,target:t,time:n,enableTransition:r,callback:i})}},{key:"lookAt2",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.position,r=t.target,i=t.time,a=t.enableTransition,o=t.callback;this.modelCalculator.lerpLookAt(n,r,i,a,(function(){e.renderTool.setNeedUpdate(),o&&o()}))}},{key:"focusMap",value:function(e,t){this.modelCalculator.focusMap(e,t)}},{key:"addSplotLight",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16777215,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0,u=arguments.length>9?arguments[9]:void 0,c=arguments.length>10?arguments[10]:void 0;this.modelCalculator.addSplotLight(e,t,n,(0,P.colorToHex)(r),i,a,o,s,l,u,c)}},{key:"updateSpotLight",value:function(e,t){this.modelCalculator.updateSpotLight(e,t)}},{key:"addAreaLight",value:function(e,t,n,r,i,a,o,s,l){return this.modelCalculator.addAreaLight(e,(0,P.colorToHex)(t),n,r,i,a,o,s,l)}},{key:"updateAreaLight",value:function(e,t){this.modelCalculator.updateAreaLight(e,t)}},{key:"addMapLight",value:function(e){var t=this.modelCalculator.bustard.core.getMeshByName(e+"面");if(t){var n={x:t.userData.p[0],y:10*t.userData.size/9,z:t.userData.p[1]},r={x:t.userData.p[0],y:8*t.userData.size/9,z:t.userData.p[1]},i={x:t.userData.p[0],y:0,z:t.userData.p[1]};this.addSplotLight("map_spotLight0",n,i,16777215,4,10*t.userData.size*3/9,1,.3,2,!1,!1),this.addSplotLight("map_spotLight1",r,i,16777215,5.5,8*t.userData.size*3/9,.65,1,2,!1,!1)}}},{key:"updateMapLight",value:function(e){var t=this.modelCalculator.bustard.core.getMeshByName(e+"面");if(t){var n={x:t.userData.p[0],y:10*t.userData.size/9,z:t.userData.p[1]},r={x:t.userData.p[0],y:8*t.userData.size/9,z:t.userData.p[1]},i={x:t.userData.p[0],y:0,z:t.userData.p[1]};this.updateSpotLight("map_spotLight0",{position:n,target:i,distance:10*t.userData.size*3/9}),this.updateSpotLight("map_spotLight1",{position:r,target:i,distance:8*t.userData.size*3/9})}}},{key:"switchDefaultView",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;"function"==typeof e?this.modelCalculator.setDefaultCameraPosition(e):this.modelCalculator.setDefaultCameraPosition(t)}},{key:"setDefaultView",value:function(){return this.modelCalculator.setDefaultView()}},{key:"getCameraPosition",value:function(){return this.modelCalculator.getCameraPosition()}},{key:"getCameraAngle",value:function(){return this.modelCalculator.getCameraAngle()}},{key:"setCameraAngle",value:function(e,t){this.modelCalculator.setCameraAngle(e,t)}},{key:"getFirstIntersection",value:function(e,t){return this.modelCalculator.bustard.core.getFirstIntersection(e,t)}},{key:"clipModel",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=this.modelCalculator.outClipCars.get(e);if(i||(i=this.modelCalculator.publicModelClip.get(e)),!i){var a=this.modelCalculator.loader.modelMap.get(e);a&&(a.traverse((function(e){"Mesh"===e.type&&(n.restoreMaterial.set(e.uuid,e.material),e.material=e.material.clone())})),this.modelCalculator.initPublicModelClip(a),i=this.modelCalculator.publicModelClip.get(e))}0==r?i.clipXPlus(t):1==r?i.clipXSub(t):2==r?i.clipYPlus(t):3==r?i.clipYSub(t):4==r?i.clipZPlus(t):5==r&&i.clipZSub(t)}},{key:"getSceneClipRange",value:function(){return this.modelCalculator.getSceneClipRange()}},{key:"getModelClipRange",value:function(e){return this.modelCalculator.getModelClipRange(e)}},{key:"clipScene",value:function(e,t){var n=this;this.modelCalculator.loader.modelMap.forEach((function(r,i){var a=n.modelCalculator.publicModelClip.get(i);a||(r.traverse((function(e){"Mesh"===e.type&&(n.restoreMaterial.set(e.uuid,e.material),e.material=e.material.clone())})),n.modelCalculator.initPublicModelClip(r),a=n.modelCalculator.publicModelClip.get(i)),0==e?a.clipXPlus(t):1==e?a.clipXSub(t):2==e?a.clipYPlus(t):3==e?a.clipYSub(t):4==e?a.clipZPlus(t):5==e&&a.clipZSub(t)}))}},{key:"resetSceneClip",value:function(){var e=this;this.modelCalculator.loader.modelMap.forEach((function(t,n){e.modelCalculator.publicModelClip.get(n)&&(t.traverse((function(t){"Mesh"===t.type&&(t.material=e.restoreMaterial.get(t.uuid),e.restoreMaterial.delete(t.uuid))})),e.modelCalculator.publicModelClip.delete(n),e.renderTool.setNeedUpdate())}))}},{key:"getClipHeightRange",value:function(e){var t=this,n=-1/0,r=1/0,i=this.modelCalculator.outClipCars.get(e);if(i||(i=this.modelCalculator.publicModelClip.get(e)),!i){var a=this.modelCalculator.loader.modelMap.get(e);a&&(a.traverse((function(e){"Mesh"===e.type&&(t.restoreMaterial.set(e.uuid,e.material),e.material=e.material.clone())})),this.modelCalculator.initPublicModelClip(a),i=this.modelCalculator.publicModelClip.get(e))}return{max:n=Math.max(n,i.maxClipY),min:r=Math.min(r,i.minClipY)}}},{key:"resetAllClip",value:function(){if(this.clipConfig&&""!=this.clipConfig)for(var e in this.clipConfig)this.resetClip(e)}},{key:"resetClip",value:function(e){var t=this;this.emptyLabel("clipView");var n=this.modelCalculator.outClipCars.get(e);if(n)n.clipYPlus(n.maxClipY);else if(this.modelCalculator.publicModelClip.get(e)){var r=this.modelCalculator.loader.modelMap.get(e);r&&(r.traverse((function(e){"Mesh"===e.type&&(e.material=t.restoreMaterial.get(e.uuid),t.restoreMaterial.delete(e.uuid))})),this.modelCalculator.publicModelClip.delete(e),this.renderTool.setNeedUpdate())}}},{key:"showClipView",value:function(e,t,n){var r=this,i=this.modelCalculator.outClipCars.get(e);if(i||(i=this.modelCalculator.publicModelClip.get(e)),!i){var a=this.modelCalculator.loader.modelMap.get(e);a&&(a.traverse((function(e){"Mesh"===e.type&&(r.restoreMaterial.set(e.uuid,e.material),e.material=e.material.clone())})),this.modelCalculator.initPublicModelClip(a),i=this.modelCalculator.publicModelClip.get(e))}var o=this.clipConfig[e][t];if(o){var s=o.height,l=o.clipView,u=o.name,c=o.style,h=o.userData,d=o.labelStatus,p=(0,B.fillVector3WithDefaults)(o.positionOffset);i.clipYPlus(s);var f=function(){var a=r.createLabelElement(u,c);a.onclick=function(e){e.stopPropagation(),r.pickLabelAction&&r.pickLabelAction({id:t,name:u,userData:h,type:"clipViewLabel"})},r.currentClipLabelMap=new Map,r.currentClipLabelGroupMap=new Map,r.emptyLabel("clipView"),r.addLabel(t,a,{x:i.center.x+p.x,y:s+p.y,z:i.center.z+p.z},[],"clipView"),(0,B.isNotNil)(d)&&r.updateClipViewLabel(e,t,{labelStatus:d}),r.addClipLinkLabel(e,t),n&&n()};this.lookAt2({position:l.position,target:l.target,time:1e3,enableTransition:!0,callback:f})}}},{key:"updateClipViewLabel",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.positionOffset,i=n.labelStatus,a=this.clipConfig[e][t];if(a){if((0,B.isNotNil)(r)){var o=(0,B.fillVector3WithDefaults)(r);a.positionOffset=(0,B.fillVector3WithDefaults)(a.positionOffset);var s=a.positionOffset,l={x:o.x-s.x,y:o.y-s.y,z:o.z-s.z};Object.assign(a.positionOffset,o);var u=this.modelCalculator.getLabel(t);if(!u)return;var c={x:u.position.x+l.x,y:u.position.y+l.y,z:u.position.z+l.z};this.modelCalculator.updateLabel(t,{position:c})}(0,B.isNotNil)(i)&&(a.labelStatus=i,this.modelCalculator.updateLabel(t,{visible:i}))}}},{key:"addClipLinkLabel",value:function(e,t){var n=this;this.clipLabelMap.forEach((function(r,i){if(r.linkClip.id===e&&r.linkClip.viewId===t){var a=n.createLabelElement(r.name,r.style);a.onclick=function(e){e.stopPropagation(),n.pickLabelAction&&n.pickLabelAction({id:i,name:r.name,userData:r.userData,type:"label"}),r.cameraPosition&&""!=r.cameraPosition&&n.lookAt(r.cameraPosition.position,r.cameraPosition.target)},a.onmousemove=function(e){e.stopPropagation()},n.addLabel(i,a,r.position,[],"clipView"),n.currentClipLabelMap.set(i,r)}})),this.clipLabelGroupMap.forEach((function(r,i){if(r.linkClip.id==e&&r.linkClip.viewId==t){var a=n.createDefaultLabelElement(r.name,{icon:"./lib/resource/label/label.png",textBackgroundColor:"rgba(26, 41, 52, 0.6)",fontFamily:"宋体",color:"#ffffff",fontSize:"12px"});a.onclick=function(e){e.stopPropagation(),n.pickLabelAction&&n.pickLabelAction({id:i,name:r.name,userData:r.userData,type:"label"}),r.cameraPosition&&""!=r.cameraPosition&&n.lookAt(r.cameraPosition.position,r.cameraPosition.target)},a.onmousemove=function(e){e.stopPropagation()},n.addLabel(i,a,r.position,[],"clipView"),n.currentClipLabelGroupMap.set(i,r)}}))}},{key:"initRoam",value:function(e,t){if(e&&""!=e){(0,B.isNotNil)(t)&&this.setRoamSpeed(t);for(var n=[],r=0,i=e.length;r<i;r++)r>0&&e[r].x==e[r-1].x&&e[r].y==e[r-1].y&&e[r].z==e[r-1].z&&e[r].target.x==e[r-1].target.x&&e[r].target.y==e[r-1].target.y&&e[r].target.z==e[r-1].target.z?n[n.length-1].delay=(n[n.length-1].delay?n[n.length-1].delay:0)+e[r].time:n.push(e[r]);this.addRoamByList(n)}}},{key:"addRoamByList",value:function(e){this.modelCalculator.addRoamByList(e)}},{key:"setRoamSpeed",value:function(e){this.modelCalculator.setRoamSpeed(e)}},{key:"startRoam",value:function(e){this.modelCalculator.startRoam(e)}},{key:"suspendRoam",value:function(){this.modelCalculator.suspendRoaming()}},{key:"endRoam",value:function(){this.modelCalculator.endRoaming()}},{key:"setRoamOnDelayCallback",value:function(e){this.modelCalculator.setRoamOnDelayCallback(e)}},{key:"setRoamOffDelayCallback",value:function(e){this.modelCalculator.setRoamOffDelayCallback(e)}},{key:"setRoamPosition",value:function(e,t){this.modelCalculator.setRoamPosition(e,t)}},{key:"removeRoamPosition",value:function(e){this.modelCalculator.autoRoam.removeEdit(e+1)}},{key:"clearRoam",value:function(){this.addRoamByList([])}},{key:"getRoamList",value:function(){return this.modelCalculator.getRoamList()}},{key:"setFirstPersonRoamConfig",value:function(e,t){this.modelCalculator.bustard.core.enablekey[e]=t}},{key:"changeSkyBox",value:function(){var e=(0,i.default)(t.default.mark((function e(n){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.modelCalculator.addSkyBox(n));case 1:case"end":return e.stop()}}),e,this)})));function n(t){return e.apply(this,arguments)}return n}()},{key:"changeHdr",value:function(e){this.modelCalculator.addHdr(e,!1,!0)}},{key:"setSceneLightProperty",value:function(e){var t,n,r,i;(0,B.isNotNil)(null==e||null===(t=e.AmbientLight)||void 0===t?void 0:t.color)&&(e.AmbientLight.color=(0,P.colorToHexString)(e.AmbientLight.color)),(0,B.isNotNil)(null==e||null===(n=e.HemisphereLight)||void 0===n?void 0:n.color)&&(e.HemisphereLight.color=(0,P.colorToHexString)(e.HemisphereLight.color)),(0,B.isNotNil)(null==e||null===(r=e.HemisphereLight)||void 0===r?void 0:r.groundColor)&&(e.HemisphereLight.groundColor=(0,P.colorToHexString)(e.HemisphereLight.groundColor)),(0,B.isNotNil)(null==e||null===(i=e.DirectionalLight)||void 0===i?void 0:i.color)&&(e.DirectionalLight.color=(0,P.colorToHexString)(e.DirectionalLight.color)),this.modelCalculator.setdefaultLightProperty(e)}},{key:"updateDirectionLightShadowProperty",value:function(e){this.modelCalculator.light.defaultDirectionalLight.shadow.camera.left=Number(e.left),this.modelCalculator.light.defaultDirectionalLight.shadow.camera.right=Number(e.right),this.modelCalculator.light.defaultDirectionalLight.shadow.camera.top=Number(e.top),this.modelCalculator.light.defaultDirectionalLight.shadow.camera.bottom=Number(e.bottom),this.modelCalculator.light.defaultDirectionalLight.shadow.camera.far=Number(e.far),this.modelCalculator.light.defaultDirectionalLight.shadow.camera.updateProjectionMatrix(),this.modelCalculator.light.defaultDirectionalLight.shadow.bias=Number(e.bias),this.modelCalculator.light.defaultDirectionalLight.shadow.map.dispose(),this.modelCalculator.bustard.core.renderer.shadowMap.needsUpdate=!0,this.renderTool.setNeedUpdate()}},{key:"getModelAnimations",value:function(e){return this.modelCalculator.loader.actions[e]}},{key:"stopAllModelAnimation",value:function(){this.modelCalculator.loader.stopAllAnimation()}},{key:"clearAutoRotateObjects",value:function(){this.modelCalculator.clearAutoRotateObjects()}},{key:"resetSeparateModel",value:function(){this.modelCalculator.resetSeparateModel()}},{key:"removeAllHighLight",value:function(){this.modelCalculator.removeAllHighLight()}},{key:"setDragAction",value:function(e){this.modelCalculator.setDragAction(e)}},{key:"setCameraChangeHandler",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.modelCalculator.setCameraChangeHandler(e,t,n)}},{key:"enableTouch",value:function(e){this.modelCalculator.enableTouch(e)}},{key:"addRingEffect",value:function(e,t,n,r,i,a){this.modelCalculator.addNewRingEffect(e,t,n,(0,P.colorToHex)(r),i,a)}},{key:"removeRingEffect",value:function(){this.modelCalculator.removeRingEffect()}},{key:"addBallEfffect",value:function(e,t,n,r){this.modelCalculator.addBallEfffect(e,t,(0,P.colorToHex)(n),r)}},{key:"removeBallEfffect",value:function(){this.modelCalculator.removeBallEfffect()}},{key:"addFireSprite",value:function(e,t){this.modelCalculator.addFireSprite(e,t)}},{key:"removeAllParticleFire",value:function(){this.modelCalculator.removeAllParticleFire()}},{key:"addSmoke",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this.modelCalculator.addSmoke(e,t,n,r,i)}},{key:"removeAllSmoke",value:function(){this.modelCalculator.bustard.smokeEffect.removeAllSmoke()}},{key:"addRail",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{baseUrl:void 0,moveUrl:void 0,repeatX:4,repeatY:1,speed:.005};e instanceof Array?this.modelCalculator.addRail((0,L.uuid)(),e,O(O({},n),{},{height:t})):this.modelCalculator.addRail(e,t,O(O({},r),{},{height:n}))}},{key:"removeRail",value:function(e){this.modelCalculator.railEffect.removeRail(e)}},{key:"focusRail",value:function(e,t){this.modelCalculator.focusRail(e,t)}},{key:"addRailByModelBox",value:function(e,t,n){if(e instanceof Array){var r=this.parseTargetsWithFolder(e);this.modelCalculator.addRailByModelBox((0,L.uuid)(),r,t)}else{var i=this.parseTargetsWithFolder(t);this.modelCalculator.addRailByModelBox(e,i,n)}}},{key:"removeRailEffect",value:function(){this.modelCalculator.removeRailEffect()}},{key:"setMeasurement",value:function(e){this.modelCalculator.oldMeasurementTool.setMeasurement(e)}},{key:"setMeasurementStyle",value:function(e){(0,B.isNotNil)(e.color)&&(e.color=(0,P.colorToHex)(e.color)),this.modelCalculator.oldMeasurementTool.setMeasurementStyle(e)}},{key:"startMeasurement",value:function(){this.modelCalculator.oldMeasurementTool.startMeasurement()}},{key:"stopMeasurement",value:function(){this.modelCalculator.oldMeasurementTool.stopMeasurement()}},{key:"setNodeWaterEffect",value:function(e,t,n){this.modelCalculator.addModelEffect(e,t,n)}},{key:"setNodeReflector",value:function(e,t,n){return this.modelCalculator.setNodeReflector(e,t,n)}},{key:"addAutomaticOrientation",value:function(e,t,n){this.modelCalculator.addAutomaticOrientation(e,t,n)}},{key:"setRoadNameAutomaticOrientation",value:function(){this.modelCalculator.setRoadNameAutomaticOrientation()}},{key:"openFlagAnimation",value:function(){this.modelCalculator.openFlagAnimation()}},{key:"openWaterEffect",value:function(e){e.color=(0,P.colorToHexString)(e.color),this.modelCalculator.openWaterEffect(e)}},{key:"addGlowRings",value:function(e,t,n,r,i,a){this.modelCalculator.addGlowRings(e,t,n,(0,P.colorToHex)(r),i,a)}},{key:"removeGlowRings",value:function(){this.modelCalculator.removeGlowRings()}},{key:"removeGlowRing",value:function(e){this.modelCalculator.glow.removeGlowRing(e)}},{key:"addMapGlowRing",value:function(e,t,n,r,i){var a=this.modelCalculator.bustard.core.getMeshByName(t+"面");a&&this.addGlowRings(e,{x:a.userData.centroid[0],y:-2,z:a.userData.centroid[1]},.4*a.userData.size,(0,P.colorToHex)(n),r,i)}},{key:"selectCity",value:function(e,t,n){var r=this;this.enableSwitch&&(this.flags[e]?(this.enableSwitch=!1,this.removeGlowRings(),this.updateMapLight(e),this.setMapModelVisible(e,!0),this.selectedCity=e,this.hideProvinceMapModel(this.selectedProvince,e,!0,(function(){r.addMapGlowRing("ring_"+e,e,6739176,r.mapConfig.glowRingUrl,1.6),r.enableSwitch=!0,setTimeout((function(){n&&n.cameraPosition?r.lookAt(n.cameraPosition.position,n.cameraPosition.target):r.focusMap(e)}),500),n&&n.callback&&n.callback()}))):(this.enableSwitch=!1,this.createProvinceOrCityMap(e,t,!1,(function(){r.removeGlowRings(),r.updateMapLight(e),r.flags[e]=!0,r.selectedCity=e,r.hideProvinceMapModel(r.selectedProvince,e,!0,(function(){r.addMapGlowRing("ring_"+e,e,6739176,r.mapConfig.glowRingUrl,1.6),r.enableSwitch=!0,setTimeout((function(){n&&n.cameraPosition?r.lookAt(n.cameraPosition.position,n.cameraPosition.target):r.focusMap(e)}),500),n&&n.callback&&n.callback()}))}))))}},{key:"selectDistrict",value:function(e,t){var n=this;this.enableSwitch&&(this.enableSwitch=!1,this.enableTouch(!1),this.removeGlowRings(),this.updateMapLight(e),this.selectedDistrict=e,this.hideDistrictMapModel(this.selectedCity,e,!0,(function(){n.addMapGlowRing("ring_"+e,e,6739176,n.mapConfig.glowRingUrl,1.6),n.enableSwitch=!0,setTimeout((function(){t&&t.cameraPosition?n.lookAt(t.cameraPosition.position,t.cameraPosition.target):n.focusMap(e)}),100),t&&t.callback&&t.callback()})))}},{key:"backPreMap",value:function(e){var t=this;if(this.selectedCity&&!this.selectedDistrict){if(!this.enableSwitch)return;this.enableSwitch=!1,e&&e.cameraPosition?this.lookAt(e.cameraPosition.position,e.cameraPosition.target):this.switchDefaultView(),this.updateMapLight(this.selectedProvince),this.removeGlowRings(),this.setMapModelVisible(this.selectedCity,!1),this.showMapModel(this.selectedProvince,(function(){t.addMapGlowRing("ring_"+t.selectedProvince,t.selectedProvince,6739176,t.mapConfig.glowRingUrl,1.6),t.selectedCity=null,t.enableSwitch=!0,e&&e.callback&&e.callback()}))}else if(this.selectedDistrict){if(!this.enableSwitch)return;this.enableSwitch=!1,this.removeGlowRings(),e&&e.cameraPosition?this.lookAt(e.cameraPosition.position,e.cameraPosition.target):this.focusMap(this.selectedCity),this.updateMapLight(this.selectedCity),this.showMapModel(this.selectedCity,(function(){t.addMapGlowRing("ring_"+t.selectedCity,t.selectedCity,6739176,t.mapConfig.glowRingUrl,1.6),t.selectedDistrict=null,t.enableSwitch=!0,t.enableTouch(!0),e&&e.callback&&e.callback()}))}else e&&e.cameraPosition?this.lookAt(e.cameraPosition.position,e.cameraPosition.target,!0,e.callback):this.switchDefaultView(e&&e.callback?e.callback:null)}},{key:"createChinaMap",value:function(e,t,n,r){var i=this;this.modelCalculator.loader.createChinaMap(this.mapConfig.baseUrl+e+".json",t,n,{insideTextureUrl:this.mapConfig.ChinaInsideUrl,radius:.5},(function(){i.selectedProvince=n,i.addMapLight(n),i.addMapGlowRing("ring_"+n,n,6739176,i.mapConfig.glowRingUrl,1.6),r&&r()})),this.addChinaTexture(this.mapConfig.ChinaTexture,6e3,6e3,{x:-1e3,y:-5,z:0}),this.modelCalculator.loader.addBaseTexture(this.mapConfig.baseGroundUrl,this.mapConfig.baseColorUrl,6e3,6e3,{x:-1e3,y:-1.75,z:0})}},{key:"createProvinceOrCityMap",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0;this.modelCalculator.loader.createProvinceMap(e,this.mapConfig.baseUrl+e+".json",t,{backTextureUrl:this.mapConfig.backTextureUrl,insideTextureUrl:this.mapConfig.insideTextureUrl,outsideHTextureUrl:this.mapConfig.outsideHTextureUrl,outsideTextureUrl:this.mapConfig.outsideTextureUrl,radius:n?.5:.25,height:n?15:7.5},r)}},{key:"createCityMap2",value:function(e,t,n,r,i){var a,o;this.modelCalculator.loader.createProvinceMap2(e,t,n,{insideTextureUrl:r.url,radius:null!==(a=null==r?void 0:r.radius)&&void 0!==a?a:.25,height:null!==(o=null==r?void 0:r.height)&&void 0!==o?o:7.5,polygonTextureUrl:r.polygonTextureUrl,polygonOpacity:r.polygonOpacity,polygonColor:r.polygonColor,groundPolygonOpacity:r.groundPolygonOpacity,groundPolygonColor:r.groundPolygonColor,lineOpacity:r.lineOpacity,lineColor:r.lineColor},i),r.groundUrl&&this.modelCalculator.loader.addBaseTexture2(r.groundUrl,6e3,6e3,{x:100,y:-1.75,z:90},75)}},{key:"hideDistrict",value:function(e,t,n){this.modelCalculator.hideDistrictMapModel2(e,t,n)}},{key:"showDistrict",value:function(e,t){this.modelCalculator.showMapModel(e,t)}},{key:"getMapSize",value:function(e){var t=this.modelCalculator.bustard.core.getMeshByName(e+"面");if(t)return t.userData.size}},{key:"createCityMap",value:function(e,t,n,r,i){var a,o;this.modelCalculator.loader.createProvinceMap3(e,t,n,{insideTextureUrl:r.url,radius:null!==(a=null==r?void 0:r.radius)&&void 0!==a?a:.25,height:null!==(o=null==r?void 0:r.height)&&void 0!==o?o:7.5,polygonTextureUrl:r.polygonTextureUrl,polygonOpacity:r.polygonOpacity,polygonColor:r.polygonColor,groundPolygonOpacity:r.groundPolygonOpacity,groundPolygonColor:r.groundPolygonColor,lineOpacity:r.lineOpacity,lineColor:r.lineColor},i)}},{key:"addChinaTexture",value:function(e,t,n,r){this.modelCalculator.loader.addChinaTexture(e,t,n,r)}},{key:"hideProvinceMapModel",value:function(e,t,n,r){this.modelCalculator.hideProvinceMapModel(e,t,n,r)}},{key:"setMapModelVisible",value:function(e,t){this.modelCalculator.setMapModelVisible(e,t)}},{key:"hideDistrictMapModel",value:function(e,t,n,r){this.modelCalculator.hideDistrictMapModel(e,t,n,r)}},{key:"setCameraNearFar",value:function(e,t){this.modelCalculator.setCameraNearFar(e,t)}},{key:"setCameraFov",value:function(e){this.modelCalculator.setCameraFov(e)}},{key:"showMapModel",value:function(e,t){this.modelCalculator.showMapModel(e,t)}},{key:"performAction",value:function(e,t,n,r){var i=this;(0,B.isNotNil)(null==n?void 0:n.color)&&(n.color=(0,P.colorToHex)(n.color)),(0,B.isNotNil)(null==n?void 0:n.lineColor)&&(n.lineColor=(0,P.colorToHex)(n.lineColor)),(0,B.isNotNil)(null==n?void 0:n.faceColor)&&(n.faceColor=(0,P.colorToHex)(n.faceColor));var a=this.parseTargetsWithFolder(e);return this.modelCalculator.performAction(a,t,n,(function(){i.renderTool.setNeedUpdate(),r&&r()}))}},{key:"restoreAction",value:function(e,t,n){var r=this,i=this.parseTargetsWithFolder(e);return this.modelCalculator.restoreAction(i,t,(function(){r.renderTool.setNeedUpdate(),n&&n()}))}},{key:"parseTargetsWithFolder",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t.getLogicTree(e.id,e.name);r&&r.isFolder?(0,p.parseFolder)(r,n):n.push(e)})),n}},{key:"performActionTest",value:function(e,t,n){var r=this.parseTargetsWithFolder(e);return this.modelCalculator.performActionTest(r,t,n)}},{key:"addModelSplotLight",value:function(e,t,n){var r=this.parseTargetsWithFolder(t);return this.modelCalculator.addModelSplotLight(e,r,n)}},{key:"removeLight",value:function(e){this.modelCalculator.removeLight(e)}},{key:"clearEffect",value:function(e){var t=this,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).exclude,i=void 0===n?[]:n,a=["hide","wireFrame","selectOnTop","transparent","clip","selectEffect","colorBox","selectBorder","modelBox","highLight","flash","modelEffect"],o=[];(0,B.isNilOrEmptyArray)(e)?o.push.apply(o,a):Array.isArray(e)?o.push.apply(o,(0,r.default)(e)):o.push(e),o.filter((function(e){return!i.includes(e)})).forEach((function(e){t.clearEffectByType(e)})),this.renderTool.setNeedUpdate()}},{key:"clearEffectByType",value:function(e){var t=this;"hide"===e?this.modelCalculator.modelHide.restore():"wireFrame"===e?this.modelCalculator.clearWireFrameMaterial():"selectOnTop"===e?(this.modelCalculator.clearSelectOnTop(),this.modelCalculator.bustard.core.traverseNodesAll(this.modelCalculator.bustard.core.scene,(function(e){e.userData.notReset||t.modelCalculator.injectInstancedMeshFromMesh(e)}))):"transparent"===e?this.modelCalculator.restoreTransparentObjects():"clip"===e?this.resetAllClip():"selectEffect"===e?this.modelCalculator.restoreColor():"colorBox"===e?this.modelCalculator.removeObjectBox():"selectBorder"===e?this.modelCalculator.selectBorderTool.emptySelectBorder():"modelBox"===e?this.modelCalculator.emptySelectEffect():"highLight"===e?this.removeAllHighLight():"flash"===e?this.modelCalculator.removeAllFlash():"modelEffect"===e&&(this.clearAutoRotateObjects(),this.resetSeparateModel(),this.modelCalculator.clearModelTextureRun(),this.stopAllModelAnimation())}},{key:"clearAllEffect",value:function(e){var t=this;e?"hide"==e?this.modelCalculator.restoreHideObjects():"wireFrame"==e?this.modelCalculator.clearWireFrameMaterial():"selectOnTop"==e?(this.modelCalculator.clearSelectOnTop(),this.modelCalculator.bustard.core.traverseNodesAll(this.modelCalculator.bustard.core.scene,(function(e){e.userData.notReset||t.modelCalculator.injectInstancedMeshFromMesh(e)}))):"transparent"==e?this.modelCalculator.restoreTransparentObjects():"clip"==e?this.resetAllClip():"selectEffect"==e?this.modelCalculator.restoreColor():"colorBox"==e?this.modelCalculator.removeObjectBox():"selectBorder"==e?this.modelCalculator.selectBorderTool.emptySelectBorder():"modelBox"==e?this.modelCalculator.emptySelectEffect():"highLight"==e?this.removeAllHighLight():"flash"==e?this.modelCalculator.removeAllFlash():"modelEffect"==e&&(this.clearAutoRotateObjects(),this.resetSeparateModel(),this.modelCalculator.clearModelTextureRun(),this.stopAllModelAnimation()):(this.modelCalculator.restoreHideObjects(),this.modelCalculator.clearWireFrameMaterial(),this.modelCalculator.clearSelectOnTop(),this.modelCalculator.restoreTransparentObjects(),this.resetAllClip(),this.removeAllHighLight(),this.modelCalculator.removeAllFlash(),this.modelCalculator.restoreColor(),this.modelCalculator.removeObjectBox(),this.modelCalculator.selectBorderTool.emptySelectBorder(),this.modelCalculator.emptySelectEffect(),this.clearAutoRotateObjects(),this.resetSeparateModel(),this.modelCalculator.clearModelTextureRun(),this.stopAllModelAnimation(),this.modelCalculator.bustard.core.traverseNodesAll(this.modelCalculator.bustard.core.scene,(function(e){e.userData.notReset||t.modelCalculator.injectInstancedMeshFromMesh(e)}))),this.renderTool.setNeedUpdate()}},{key:"clearSelectOnTop",value:function(e){this.modelCalculator.clearSelectOnTop(e)}},{key:"setPickAction",value:function(e){var t=this;this.modelCalculator.setPickAction((function(n){n&&"label"==n.type&&t.pickLabelAction&&t.pickLabelAction(n.mesh.userData),n&&n.tree&&"label"!==n.type&&(n.logicTree=t.getNeedNode(n.tree),n.logicTree?n.userData=n.logicTree.userData:n.userData=t.modelUserDataMap.get(n.modelId)),e&&e(n)}))}},{key:"addWaterEffect",value:function(e,t){var n=e.id,r=e.name;this.modelCalculator.addModelWaterEffect({id:n,nodeName:r},t)}},{key:"setPickLabelAction",value:function(e){this.pickLabelAction=e}},{key:"setTouchAction",value:function(e){var t=this;this.modelCalculator.setTouchAction((function(n){n&&n.tree&&"label"!==n.type&&(n.logicTree=t.getNeedNode(n.tree),n.logicTree?n.userData=n.logicTree.userData:n.userData=t.modelUserDataMap.get(n.modelId)),e&&e(n)}))}},{key:"setDoubleClickModelAction",value:function(e){var t=this,n=this;this.modelCalculator.setDoubleClickModelAction((function(r){if(!t.doubleClickModelBeforeAction||(n.modelTree&&(r.contextRootCode=n.contextRootCode,r.contextCode=n.contextCode,r.context=n.getContext(n.contextRootCode,n.contextCode),r.logicTree=n.getLogicTree(n.contextRootCode,n.contextCode)),t.doubleClickModelBeforeAction(r))){if(r&&r.tree){r.logicTree=t.getNeedNode(r.tree),r.logicTree?r.userData=r.logicTree.userData:r.userData=t.modelUserDataMap.get(r.modelId),r.changeContext=!1;var i=0;if(n.modelTree&&n.enableStatusDefaultToggle&&(i=n.changeStatusByPick(r.tree)),!i&&n.modelTree&&n.enableContextSelect&&n.enableContextDefaultToggle){var a=n.getContextByTree(r.tree);a&&(n.selectContext(a.rootCode,a.code),r.changeContext=!0)}}e&&(n.modelTree&&(r.contextRootCode=n.contextRootCode,r.contextCode=n.contextCode,r.context=n.getContext(n.contextRootCode,n.contextCode),r.logicTree=n.getLogicTree(n.contextRootCode,n.contextCode)),e(r))}}))}},{key:"setDoubleClickModelBeforeAction",value:function(e){this.doubleClickModelBeforeAction=e}},{key:"addModelLabel",value:function(e,t,n,r){var i,a=this,o=[];t.forEach((function(e){var t,n=a.modelCalculator.loader.modelMap.get(e.id);n&&(e.name?(e.name.indexOf("/")>-1?t=a.modelCalculator.bustard.core.getModelNodeByPathNames(n,e.name,!1):(t=a.modelCalculator.bustard.core.getModelNodeByName(n,e.name,!1))||(t=a.modelCalculator.bustard.core.getModelMeshByName(n,e.name)),t&&o.push(t)):o.push(n))}));var s=!1;n&&n.dom&&n.dom instanceof Element?i=n.dom:n&&n.canvas?s=!0:i=this.createLabelElement(n.text,n.style);var l=this.modelCalculator.bustard.core.getCenterAndSize2(o),u={x:l.center.x+(n.offset?n.offset.x*l.size.x/2:0),y:l.center.y+(n.offset?n.offset.y*l.size.y/2:l.size.y/2),z:l.center.z+(n.offset?n.offset.z*l.size.z/2:0)};if(s){var c=this.modelCalculator.addSpriteToScene(e,n.canvas,u,n.style.scale,n.style.sizeAttenuation,n.type);c&&(c.userData.id=e,c.userData.objects=t,c.userData.userData=r)}else i.onclick=function(i){i.stopPropagation(),a.pickLabelAction&&a.pickLabelAction({id:e,name:n.text,objects:t,userData:r,type:"label"})},i.onmousemove=function(e){e.stopPropagation()},this.addLabel(e,i,u,[],n.type)}},{key:"addLabels",value:function(e){var t=this;e.forEach((function(e){var n,r=e.id,i=e.position,a=e.label,o=e.userData,s=!1;if(a&&a.dom&&a.dom instanceof Element?n=a.dom:a&&a.canvas?s=!0:n=t.createLabelElement(a.text,a.style),s){var l=t.modelCalculator.addSpriteToScene(r,a.canvas,i,a.style.scale,a.style.sizeAttenuation,a.type);l&&(l.userData.id=r,l.userData.userData=o)}else n.onclick=function(e){e.stopPropagation(),t.pickLabelAction&&t.pickLabelAction({id:r,name:a.text,userData:o,type:"label"})},n.onmousemove=function(e){e.stopPropagation()},t.addLabel(r,n,i,[],a.type)}))}},{key:"addModel3DText",value:function(e,t,n){var r,i,a,o,s,l,u=this,c=[];t.forEach((function(e){var t,n=u.modelCalculator.loader.modelMap.get(e.id);n&&(e.name?(e.name.indexOf("/")>-1?t=u.modelCalculator.bustard.core.getModelNodeByPathNames(n,e.name,!1):(t=u.modelCalculator.bustard.core.getModelNodeByName(n,e.name,!1))||(t=u.modelCalculator.bustard.core.getModelMeshByName(n,e.name)),t&&c.push(t)):c.push(n))}));var h=this.modelCalculator.bustard.core.getCenterAndSize2(c),d={x:h.center.x+(n.offsetScale?n.offsetScale.x*h.size.x/2:0)+(null!==(r=null==n||null===(i=n.offset)||void 0===i?void 0:i.x)&&void 0!==r?r:0),y:h.center.y+(n.offsetScale?n.offsetScale.y*h.size.y/2:h.size.y/2)+(null!==(a=null==n||null===(o=n.offset)||void 0===o?void 0:o.y)&&void 0!==a?a:0),z:h.center.z+(n.offsetScale?n.offsetScale.z*h.size.z/2:0)+(null!==(s=null==n||null===(l=n.offset)||void 0===l?void 0:l.z)&&void 0!==s?s:0)},p=null!=n&&n.fontSize?n.fontSize:20;this.modelCalculator.add3DMaker2(e,{text:n.text,automaticOrientation:!(null==n||!n.automaticOrientation)&&n.automaticOrientation,axis:n.axis,position:d,rotation:null!=n&&n.rotation?n.rotation:{x:0,y:0,z:0},planeWidth:null!=n&&n.width?n.width:.8,planeHeight:null!=n&&n.height?n.height:.5,fontColor:(0,P.colorToHexString)(n.fontColor),fontSize:p,width:n.text.length*p,height:p+10,offsetX:0,offsetY:0})}},{key:"add3DText",value:function(e,t){var n=null!=t&&t.fontSize?t.fontSize:20;this.modelCalculator.add3DMaker2(e,{text:t.text,automaticOrientation:!(null==t||!t.automaticOrientation)&&t.automaticOrientation,axis:t.axis,position:null!=t&&t.position?t.position:{x:0,y:0,z:0},rotation:null!=t&&t.rotation?t.rotation:{x:0,y:0,z:0},planeWidth:null!=t&&t.width?t.width:.8,planeHeight:null!=t&&t.height?t.height:.5,fontColor:(0,P.colorToHexString)(t.fontColor),fontSize:n,width:t.text.length*n,height:n+10,offsetX:0,offsetY:0})}},{key:"addModelProgressBar",value:function(e,t,n){var r=this,i=[];t.forEach((function(e){var t,n=r.modelCalculator.loader.modelMap.get(e.id);n&&(e.name?(e.name.indexOf("/")>-1?t=r.modelCalculator.bustard.core.getModelNodeByPathNames(n,e.name,!1):(t=r.modelCalculator.bustard.core.getModelNodeByName(n,e.name,!1))||(t=r.modelCalculator.bustard.core.getModelMeshByName(n,e.name)),t&&i.push(t)):i.push(n))}));var a=this.modelCalculator.bustard.core.getCenterAndSize2(i),o={x:a.center.x+(n.offset?n.offset.x*a.size.x/2:0),y:a.center.y+(n.offset?n.offset.y*a.size.y/2:a.size.y/2)+(null!=n&&n.height?n.height:.5),z:a.center.z+(n.offset?n.offset.z*a.size.z/2:0)};this.modelCalculator.sprite.addProgressBar(e,{position:o,rotation:null!=n&&n.rotation?n.rotation:{x:0,y:0,z:0},planeWidth:null!=n&&n.width?n.width:.8,planeHeight:null!=n&&n.height?n.height:.5,progress:null!=n&&n.progress?n.progress:1,cornerRadius:null!=n&&n.cornerRadius?n.cornerRadius:10,baseColor:(0,P.colorToHexString)(n.baseColor),progressColor:(0,P.colorToHexString)(n.progressColor),opacity:n.opacity})}},{key:"addModel3DProgressBars",value:function(e,t,n){var r=this,i=[];t.forEach((function(e){var t,n=r.modelCalculator.loader.modelMap.get(e.id);if(n&&(e.name?e.name.indexOf("/")>-1?t=r.modelCalculator.bustard.core.getModelNodeByPathNames(n,e.name,!1):(t=r.modelCalculator.bustard.core.getModelNodeByName(n,e.name,!1))||(t=r.modelCalculator.bustard.core.getModelMeshByName(n,e.name)):t=model,t)){var a,o,s,l,u,c,h=r.modelCalculator.bustard.core.getCenterAndSize2([t]),d={x:h.center.x+(e.offsetScale?e.offsetScale.x*h.size.x/2:0)+(null!==(a=null==e||null===(o=e.offset)||void 0===o?void 0:o.x)&&void 0!==a?a:0),y:h.center.y+(e.offsetScale?e.offsetScale.y*h.size.y/2:h.size.y/2)+(null!==(s=null==e||null===(l=e.offset)||void 0===l?void 0:l.y)&&void 0!==s?s:0),z:h.center.z+(e.offsetScale?e.offsetScale.z*h.size.z/2:0)+(null!==(u=null==e||null===(c=e.offset)||void 0===c?void 0:c.z)&&void 0!==u?u:0)};i.push({id:e.id+"-"+e.name,position:d,rotation:null!=e&&e.rotation?e.rotation:{x:0,y:0,z:0},progress:e.progress?e.progress:1,baseColor:(0,P.colorToHex)(e.baseColor),progressColor:(0,P.colorToHex)(e.progressColor)})}})),i.length>0&&this.add3DProgressBars(e,i,n)}},{key:"updateModel3DProgressBars",value:function(e,t){var n=this,r=[];t.forEach((function(e){var t,i=n.modelCalculator.loader.modelMap.get(e.id);if(i&&(e.name?e.name.indexOf("/")>-1?t=n.modelCalculator.bustard.core.getModelNodeByPathNames(i,e.name,!1):(t=n.modelCalculator.bustard.core.getModelNodeByName(i,e.name,!1))||(t=n.modelCalculator.bustard.core.getModelMeshByName(i,e.name)):t=model,t)){var a,o,s,l,u,c,h=n.modelCalculator.bustard.core.getCenterAndSize2([t]),d={x:h.center.x+(e.offsetScale?e.offsetScale.x*h.size.x/2:0)+(null!==(a=null==e||null===(o=e.offset)||void 0===o?void 0:o.x)&&void 0!==a?a:0),y:h.center.y+(e.offsetScale?e.offsetScale.y*h.size.y/2:h.size.y/2)+(null!==(s=null==e||null===(l=e.offset)||void 0===l?void 0:l.y)&&void 0!==s?s:0),z:h.center.z+(e.offsetScale?e.offsetScale.z*h.size.z/2:0)+(null!==(u=null==e||null===(c=e.offset)||void 0===c?void 0:c.z)&&void 0!==u?u:0)};r.push({id:e.id+"-"+e.name,position:d,rotation:null!=e&&e.rotation?e.rotation:{x:0,y:0,z:0},progress:e.progress?e.progress:1,baseColor:(0,P.colorToHex)(e.baseColor),progressColor:(0,P.colorToHex)(e.progressColor)})}})),r.length>0&&this.update3DProgressBars(e,r)}},{key:"remove3DProgressBars",value:function(e){this.modelCalculator.sprite.removeProgressBar(e)}},{key:"add3DProgressBars",value:function(e,t,n){this.modelCalculator.sprite.add3DProgressBars(e,t,n)}},{key:"update3DProgressBars",value:function(e,t){this.modelCalculator.sprite.update3DProgressBars(e,t)}},{key:"update3DProgressBar",value:function(e,t){this.modelCalculator.sprite.update3DProgressBar(e,t)}},{key:"remove3DProgressBar",value:function(e){this.modelCalculator.sprite.removeProgressBar(e)}},{key:"addProgressBar",value:function(e,t){this.modelCalculator.sprite.addProgressBar(e,t)}},{key:"updateProgressBar",value:function(e,t){(0,B.isNotNil)(t.baseColor)&&(t.baseColor=(0,P.colorToHexString)(t.baseColor)),(0,B.isNotNil)(t.progressColor)&&(t.progressColor=(0,P.colorToHexString)(t.progressColor)),this.modelCalculator.sprite.updateProgressBar(e,t)}},{key:"removeProgressBar",value:function(e){this.modelCalculator.sprite.removeProgressBar(e)}},{key:"addBlockBars",value:function(e,t,n){this.modelCalculator.sprite.addBlockBars(e,t,n)}},{key:"updateBlockBars",value:function(e,t){this.modelCalculator.sprite.updateBlockBars(e,t)}},{key:"removeBlockBars",value:function(e){this.modelCalculator.sprite.removeBlockBars(e)}},{key:"addModelBlockBars",value:function(e,t,n){var r=this,i=[];t.forEach((function(e){(0,B.isNotNil)(e.series)&&e.series.forEach((function(e){var t;(0,B.isNotNil)(null==e||null===(t=e.label)||void 0===t?void 0:t.fotColor)&&(e.label.fontColor=(0,P.colorToHexString)(e.label.fontColor)),(0,B.isNotNil)(e.colors)&&(e.colors=e.colors.map((function(e){return(0,P.colorToHex)(e)})))}));var t,n=r.modelCalculator.loader.modelMap.get(e.id);if(n&&(e.name?e.name.indexOf("/")>-1?t=r.modelCalculator.bustard.core.getModelNodeByPathNames(n,e.name,!1):(t=r.modelCalculator.bustard.core.getModelNodeByName(n,e.name,!1))||(t=r.modelCalculator.bustard.core.getModelMeshByName(n,e.name)):t=model,t)){var a,o,s,l,u,c,h=r.modelCalculator.bustard.core.getCenterAndSize2([t]),d={x:h.center.x+(e.offsetScale?e.offsetScale.x*h.size.x/2:0)+(null!==(a=null==e||null===(o=e.offset)||void 0===o?void 0:o.x)&&void 0!==a?a:0),y:h.center.y+(e.offsetScale?e.offsetScale.y*h.size.y/2:h.size.y/2)+(null!==(s=null==e||null===(l=e.offset)||void 0===l?void 0:l.y)&&void 0!==s?s:0),z:h.center.z+(e.offsetScale?e.offsetScale.z*h.size.z/2:0)+(null!==(u=null==e||null===(c=e.offset)||void 0===c?void 0:c.z)&&void 0!==u?u:0)};i.push({id:e.id+"-"+e.name,visible:!("visible"in e)||e.visible,position:d,series:e.series})}})),i.length>0&&this.addBlockBars(e,i,n)}},{key:"updateModelBlockBars",value:function(e,t){if(0!=t.length){var n=[];t.forEach((function(e){n.push({id:e.id+"-"+e.name,visible:e.visible,series:e.series})})),this.updateBlockBars(e,n)}}},{key:"getSceneSize",value:function(){return this.modelCalculator.getSceneSize()}},{key:"getBoxSize",value:function(e){var t=this.parseTargetsWithFolder([e]);return this.modelCalculator.getNodesTopPosition(t)}},{key:"setLightShadowFollowing",value:function(e){1==(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)?this.modelCalculator.setLightShadowFollowing(e):this.modelCalculator.setLightShadowFollowing2(e)}},{key:"setSceneShadowStatus",value:function(e){this.modelCalculator.setSceneShadowStatus(e)}},{key:"createDynamicGround",value:function(e,t,n,r){this.modelCalculator.createDynamicGround(e,t,n,r)}},{key:"removeDynamicGround",value:function(){this.modelCalculator.removeDynamicGround()}},{key:"createGradientGround",value:function(e,t,n,r){this.modelCalculator.createGradientGround(e,t,n,r)}},{key:"removeGradientGround",value:function(){this.modelCalculator.removeGradientGround()}},{key:"setRotateState",value:function(e,t){this.modelCalculator.setCameraRotateState(e,t)}},{key:"setCameraRotateStartView",value:function(e,t){this.modelCalculator.setCameraRotateStartView(e,t)}},{key:"setRecoveryRotateInterval",value:function(e){this.modelCalculator.setRecoveryRotateInterval(e)}},{key:"setPipeLineState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4;this.setEnableAdsorptionModel(!1),this.pipeLineTool.setPipeLineState(e,t)}},{key:"setChosenPipeLinePoint",value:function(e){this.pipeLineTool.setChosenPipeLinePoint(e)}},{key:"getCurrentPipeLine",value:function(){return this.pipeLineTool.getCurrentPipeLine()}},{key:"recordPipeLinePoint",value:function(){return this.pipeLineTool.recordPipeLinePoint()}},{key:"setDragPipeLinePointAction",value:function(e){this.pipeLineTool.setDragPipeLinePointAction(e)}},{key:"removePipeLinePoint",value:function(e){this.pipeLineTool.removePipeLinePoint(e)}},{key:"removePipeLineLink",value:function(e){this.pipeLineTool.removePipeLineLink(e)}},{key:"restorePipeLine",value:function(){this.pipeLineTool.restorePipeLine()}},{key:"loadPipeLine",value:function(e){this.pipeLineTool.loadPipeLine(e)}},{key:"linkPipeLinePoints",value:function(e,t){return this.pipeLineTool.linkPipeLinePoints(e,t)}},{key:"setSelectStyle",value:function(e){this.modelCalculator.setSelectStyle(e)}},{key:"setPipeLineColor",value:function(e,t){this.pipeLineTool.setPipeLineColor(e,t)}},{key:"resetPipeLineColor",value:function(){this.pipeLineTool.resetPipeLineColor()}},{key:"searchPipeLinePath",value:function(e,t,n,r){return this.pipeLineTool.searchPipeLinePath(e,t,n,r)}},{key:"addPlane",value:function(e,t,n,r,i,a,o,s,l,u){return this.modelCalculator.addPlane(e,t,n,a,o,i,r,s,l,u)}},{key:"addPlane2",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.modelCalculator.addPlane2(e)}},{key:"removePlane",value:function(e){this.modelCalculator.removePlane(e)}},{key:"addPathTubeLine",value:function(e,t,n,r){(0,B.isNotNil)(null==r?void 0:r.color)&&(r.color=(0,P.colorToHex)(r.color)),this.modelCalculator.addPathTubeLine(e,t,n,r)}},{key:"addPathTubeLines",value:function(e,t,n,r){this.modelCalculator.addPathTubeLines(e,t,n,r)}},{key:"updatePathTubeLines",value:function(e,t,n){if(0!=t.length){var r=[];t.forEach((function(e){r.push({id:e.id+"-"+e.name,color:(0,P.colorToHex)(e.color),visible:e.visible,scroll:e.scroll,flash:e.flash})})),this.modelCalculator.updatePathTubeLines(e,r,n)}}},{key:"showPathTubeLines",value:function(e,t){if(0!=t.length){var n=[];t.forEach((function(e){n.push({id:e.id+"-"+e.name})})),this.modelCalculator.lineEffect2.showPathTubeLines(e,n)}}},{key:"hidePathTubeLines",value:function(e,t){if(0!=t.length){var n=[];t.forEach((function(e){n.push({id:e.id+"-"+e.name})})),this.modelCalculator.lineEffect2.hidePathTubeLines(e,n)}}},{key:"removePathTubeLines",value:function(e){this.modelCalculator.lineEffect2.removePathTubeLines(e)}},{key:"updatePathTubeLine",value:function(e,t){this.modelCalculator.updatePathTubeLine(e,t)}},{key:"addPathLine",value:function(e,t,n,r){(0,B.isNotNil)(null==r?void 0:r.color)&&(r.color=(0,P.colorToHex)(r.color)),this.modelCalculator.addPathLine(e,t,n,r)}},{key:"addAirConditionerWind",value:function(e,t,n){(0,B.isNotNil)(null==n?void 0:n.color)&&(n.color=(0,P.colorToHex)(n.color)),this.modelCalculator.addAirConditionerWind(e,t,n)}},{key:"removeAirConditionerWind",value:function(e){this.modelCalculator.removeAirConditionerWind(e)}},{key:"removePathLineByName",value:function(e){this.modelCalculator.removePathLineByName(e)}},{key:"addMovingLines",value:function(e,t,n){(0,B.isNotNil)(null==t?void 0:t.color)&&(t.color=(0,P.colorToHex)(t.color)),this.modelCalculator.addMovingLines(e,t,n)}},{key:"removeMovingLines",value:function(){this.modelCalculator.removeMovingLines()}},{key:"openOcclusionHide",value:function(e,t){this.modelCalculator.openOcclusionHide(e,t)}},{key:"openOcclusionHide2",value:function(e,t){this.modelCalculator.openOcclusionHide2(e,t)}},{key:"closeOcclusionHide",value:function(e,t){this.modelCalculator.closeOcclusionHide(e,t)}},{key:"occlusionHide",value:function(e,t,n){this.modelCalculator.occlusionHide(e,t,n)}},{key:"occlusionShow",value:function(){this.modelCalculator.occlusionShow()}},{key:"addFog",value:function(e,t,n){this.modelCalculator.weatherTool.addFogDay({hex:e,near:t,far:n})}},{key:"removeFog",value:function(){this.modelCalculator.weatherTool.removeFogDay()}},{key:"transparentMaterial",value:function(e,t,n){this.modelCalculator.transparentMaterial(e,t,n)}},{key:"setCanvasToMesh",value:function(e,t,n){this.modelCalculator.setCanvasToMesh(e,t,n)}},{key:"setCesiumBackground",value:function(e,t){this.modelCalculator.setCesiumBackground(e,t)}},{key:"closeCameraControlAnimation",value:function(){this.modelCalculator.closeCameraControlAnimation()}},{key:"openCameraControlAnimation",value:function(){this.modelCalculator.openCameraControlAnimation()}},{key:"setPickControlBlock",value:function(e){this.modelCalculator.setPickControlBlock(e)}},{key:"multipleSelect",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.modelCalculator.multipleSelectTool.multipleSelect(e,t)}},{key:"multipleSelectEnd",value:function(){this.modelCalculator.multipleSelectTool.multipleSelectEnd()}},{key:"setWebglContextLostCallback",value:function(e){this.modelCalculator.setWebglContextLostCallback(e)}},{key:"addInstancePathTubeLines",value:function(e,t,n){t.forEach((function(e){(0,B.isNotNil)(e.color)&&(e.color=(0,P.colorToHex)(e.color))})),this.modelCalculator.addInstancePathTubeLines(e,t,n)}},{key:"removeInstancePathTubeLines",value:function(e){this.modelCalculator.lineEffect2.removeInstancePathTubeLines(e)}},{key:"updateInstancePathTubeLines",value:function(e,t){var n=[];t.forEach((function(e){n.push({id:e.id+"-"+e.name,color:(0,P.colorToHex)(e.color),visible:e.visible})})),this.modelCalculator.lineEffect2.updateInstancePathTubeLines(e,n)}},{key:"hideInstancePathTubeLines",value:function(e,t){var n=[];t.forEach((function(e){n.push({id:e.id+"-"+e.name,color:(0,P.colorToHex)(e.color)})})),this.modelCalculator.lineEffect2.hideInstancePathTubeLines(e,n)}},{key:"showInstancePathTubeLines",value:function(e,t){var n=[];t.forEach((function(e){n.push({id:e.id+"-"+e.name,color:(0,P.colorToHex)(e.color)})})),this.modelCalculator.lineEffect2.showInstancePathTubeLines(e,n)}},{key:"addPathTubeLineByDevicePort",value:function(e,t,n){(0,B.isNotNil)(null==n?void 0:n.color)&&(n.color=(0,P.colorToHex)(n.color)),this.modelCalculator.addPathTubeLineByDevicePort(e,t,n)}},{key:"updatePathTubeLineByDevicePort",value:function(e,t,n){(0,B.isNotNil)(null==n?void 0:n.color)&&(n.color=(0,P.colorToHex)(n.color)),this.modelCalculator.updatePathTubeLine(e+"-"+t,n)}},{key:"removePathTubeLineByDevicePort",value:function(e,t){this.modelCalculator.removePathLineByName(e+"-"+t)}},{key:"getScreenPosition",value:function(e){return this.modelCalculator.getScreenPosition(e)}},{key:"openNeedUpdate",value:function(){this.renderTool.openRenderOnDemand()}},{key:"closeNeedUpdate",value:function(){this.renderTool.closeRenderOnDemand()}},{key:"addParticleSystem",value:function(e){this.modelCalculator.weatherTool.changeWeather(e)}},{key:"removeParticleSystem",value:function(){this.modelCalculator.weatherTool.changeWeather(null)}}],[{key:"initGltfLoader",value:function(t){if(e.gltfLoader||(e.gltfLoader=new THREE.GLTFLoader,e.gltfLoader.setMeshoptDecoder(THREE.MeshoptDecoder)),!(e.gltfLoader instanceof THREE.DRACOLoader)&&t){var n=new THREE.DRACOLoader;n.setDecoderPath(t),e.gltfLoader.setDRACOLoader(n)}return e.gltfLoader}},{key:"getModelTree",value:function(t,n,r){r.children=[],r.nodeUuid=n.name,r.nodeName=n.name,n.userData.node_tag&&(r.nodeName=n.userData.node_tag),"level_elevation"in n.userData&&(r.levelElevation=n.userData.level_elevation),n.children.length&&n.children.forEach((function(n,i){n.isInstancedMesh||""==n.name||(r.children[i]={},e.getModelTree(t,n,r.children[i]))}))}},{key:"dispose",value:function(t){t.children.length&&t.children.filter((function(e){return e})).forEach((function(t){e.dispose(t)})),t instanceof THREE.Mesh||t instanceof THREE.Line?(t.material.map&&(t.material.map.dispose(),t.material.map=null),t.material.emissiveMap&&(t.material.emissiveMap.dispose(),t.material.emissiveMap=null),t.material.dispose(),t.material=null,t.geometry.dispose(),t.geometry=null):t.material&&(t.material.dispose(),t.material=null),t.userData={},t.clear(),t.remove(),t.parent&&t.parent.remove(t)}},{key:"parseBimModel",value:function(t){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).dracoUrl,r=this.initGltfLoader(n);return new Promise((function(n,i){r.load(t,(function(t){var r={};e.getModelTree(t.scene.name,t.scene,r),e.dispose(t.scene),n(r)}),(function(e){}),(function(e){i(e)}))}))}},{key:"createMarkElement",value:function(e){return(0,E.createMarkElement)(e)}}])}();(0,l.default)(I,"gltfLoader",void 0)},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},995:function(e,t,n){var r,i,a;e=n.nmd(e),"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[n(791),n(6192),n(4563),n(7264),n(252),n(1572),n(5220),n(2579),n(3769),n(1338),n(2026),n(4012),n(831)],r=function(o,s,l,u,c,h,d,p,f,m,v,g,y){"use strict";var x,b=n(9173);function M(e,t,n,r,i,a){return(0,s.default)((0,f.default)(a?e.prototype:e),t,n,r,i)}function w(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function _(e,t){if(e){if("string"==typeof e)return A(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function C(e,t,n,r){var i=(0,h.default)((0,f.default)(1&r?e.prototype:e),t,n);return 2&r?function(e){return i.apply(n,e)}:i}function T(e,t,n){return t=(0,f.default)(t),(0,p.default)(e,S()?Reflect.construct(t,n||[],(0,f.default)(e).constructor):t.apply(e,n))}function S(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(S=function(){return!!e})()}o=b(o),s=b(s),l=b(l),u=b(u),c=b(c),h=b(h),d=b(d),p=b(p),f=b(f),m=b(m),v=b(v),g=b(g),y=b(y),self,x=function(){return function(){var e={972:function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.default=e.exports,e.exports.__esModule=!0},274:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0},44:function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e},e.exports.default=e.exports,e.exports.__esModule=!0},220:function(e,t,n){var r=n(495);function i(t,n,a){return"undefined"!=typeof Reflect&&Reflect.get?(e.exports=i=Reflect.get,e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=i=function(e,t,n){var i=r(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(n):a.value}},e.exports.default=e.exports,e.exports.__esModule=!0),i(t,n,a||t)}e.exports=i,e.exports.default=e.exports,e.exports.__esModule=!0},337:function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.default=e.exports,e.exports.__esModule=!0,t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},994:function(e,t,n){var r=n(197);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)},e.exports.default=e.exports,e.exports.__esModule=!0},709:function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.default=e.exports,e.exports.__esModule=!0},611:function(e,t,n){var r=n(735).default,i=n(972);e.exports=function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.default=e.exports,e.exports.__esModule=!0},197:function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.default=e.exports,e.exports.__esModule=!0,t(n,r)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},495:function(e,t,n){var r=n(337);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e},e.exports.default=e.exports,e.exports.__esModule=!0},735:function(e){function t(n){return"function"==typeof Symbol&&"symbol"==(0,y.default)(Symbol.iterator)?(e.exports=t=function(e){return(0,y.default)(e)},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":(0,y.default)(e)},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},40:function(e,t,n){var r,i,a,o=n(735);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(220),n(274),n(44),n(972),n(994),n(611),n(337),n(964)],r=function(e,t,r,i,a,s,l,u,c){var h=n(709);function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}function p(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function f(e){var t=m();return function(){var n,r=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function v(e,t){var n=new c.Matrix4,r=new c.Ray,i=new c.Sphere,a=new c.Vector3,o=this.geometry;if(i.copy(o.boundingSphere),i.applyMatrix4(this.matrixWorld),!1!==e.ray.intersectSphere(i,a)){n.copy(this.matrixWorld).invert(),r.copy(e.ray).applyMatrix4(n);var s=new c.Vector3,l=new c.Vector3,u=new c.Vector3,h=this instanceof c.LineSegments?2:1,d=o.index,p=o.attributes;if(null!==d)for(var f=d.array,m=p.position.array,v=p.width.array,g=0,y=f.length-1;g<y;g+=h){var x=f[g],b=f[g+1];s.fromArray(m,3*x),l.fromArray(m,3*b);var M=null!=v[Math.floor(g/3)]?v[Math.floor(g/3)]:1,w=e.params.Line.threshold+this.material.lineWidth*M/2,_=w*w;if(!(r.distanceSqToSegment(s,l,a,u)>_)){a.applyMatrix4(this.matrixWorld);var A=e.ray.origin.distanceTo(a);A<e.near||A>e.far||(t.push({distance:A,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}),g=y)}}}}function g(e,t,n,r,i){var a;if(e=e.subarray||e.slice?e:e.buffer,n=n.subarray||n.slice?n:n.buffer,e=t?e.subarray?e.subarray(t,i&&t+i):e.slice(t,i&&t+i):e,n.set)n.set(e,r);else for(a=0;a<e.length;a++)n[a+r]=e[a];return n}Object.defineProperty(e,"__esModule",{value:!0}),e.MeshLineMaterial=e.MeshLine=void 0,e.MeshLineRaycast=v,t=h(t),r=h(r),i=h(i),a=h(a),s=h(s),l=h(l),u=h(u);var y=function(t){(0,s.default)(o,t);var n=f(o);function o(){var e;return(0,r.default)(this,o),(e=n.call(this)).type="MeshLine",e.isMeshLine=!0,e.positions=[],e.raycast=v,e.previous=[],e.next=[],e.side=[],e.width=[],e.indices_array=[],e.uvs=[],e.counters=[],e._points=[],e._geom=null,e.widthCallback=null,e.matrixWorld=new c.Matrix4,Object.defineProperties((0,a.default)(e),{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(e){this.setGeometry(e,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(e){this.setPoints(e,this.widthCallback)}}}),e}return(0,i.default)(o,[{key:"setMatrixWorld",value:function(e){this.matrixWorld=e}},{key:"setGeometry",value:function(e,t){this._geometry=e,e instanceof c.BufferGeometry?this.setPoints(e.getAttribute("position").array,t):this.setPoints(e,t)}},{key:"setPoints",value:function(t,n){if(t instanceof Float32Array||t instanceof Array){if(this._points=t,this.widthCallback=n,this.positions=[],this.counters=[],t.length&&t[0]instanceof c.Vector3)for(var r=0;r<t.length;r++){var i=t[r],a=r/t.length;this.positions.push(i.x,i.y,i.z),this.positions.push(i.x,i.y,i.z),this.counters.push(a),this.counters.push(a)}else for(o=0;o<t.length;o+=3)e.MeshLineMaterial=x=o/t.length,this.positions.push(t[o],t[o+1],t[o+2]),this.positions.push(t[o],t[o+1],t[o+2]),this.counters.push(x),this.counters.push(x);this.process()}}},{key:"compareV3",value:function(e,t){var n=6*e,r=6*t;return this.positions[n]===this.positions[r]&&this.positions[n+1]===this.positions[r+1]&&this.positions[n+2]===this.positions[r+2]}},{key:"copyV3",value:function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]}},{key:"process",value:function(){var e,t,n=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],t=this.compareV3(0,n-1)?this.copyV3(n-2):this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(var r=0;r<n;r++){if(this.side.push(1),this.side.push(-1),e=this.widthCallback?this.widthCallback(r/(n-1)):1,this.width.push(e),this.width.push(e),this.uvs.push(r/(n-1),0),this.uvs.push(r/(n-1),1),r<n-1){t=this.copyV3(r),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);var i=2*r;this.indices_array.push(i,i+1,i+2),this.indices_array.push(i+2,i+1,i+3)}r>0&&(t=this.copyV3(r),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]))}t=this.compareV3(n-1,0)?this.copyV3(1):this.copyV3(n-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new c.BufferAttribute(new Float32Array(this.positions),3),previous:new c.BufferAttribute(new Float32Array(this.previous),3),next:new c.BufferAttribute(new Float32Array(this.next),3),side:new c.BufferAttribute(new Float32Array(this.side),1),width:new c.BufferAttribute(new Float32Array(this.width),1),uv:new c.BufferAttribute(new Float32Array(this.uvs),2),index:new c.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new c.BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}},{key:"advance",value:function(e){var t=e.x,n=e.y,r=e.z,i=this._attributes.position.array,a=this._attributes.previous.array,o=this._attributes.next.array,s=i.length;g(i,0,a,0,s),g(i,6,i,0,s-6),i[s-6]=t,i[s-5]=n,i[s-4]=r,i[s-3]=t,i[s-2]=n,i[s-1]=r,g(i,6,o,0,s-6),o[s-6]=t,o[s-5]=n,o[s-4]=r,o[s-3]=t,o[s-2]=n,o[s-1]=r,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}]),o}((c=p(c)).BufferGeometry);e.MeshLine=y,c.ShaderChunk.meshline_vert=["","#include <common>","",c.ShaderChunk.logdepthbuf_pars_vertex,c.ShaderChunk.fog_pars_vertex,"\n    attribute vec3 previous;\n    attribute vec3 next;\n    attribute float side;\n    attribute float width;\n    attribute float counters;\n\n    uniform vec2 resolution;\n    uniform float lineWidth;\n    uniform vec3 color;\n    uniform float opacity;\n    uniform float sizeAttenuation;\n\n    varying vec2 vUV;\n    varying vec4 vColor;\n    varying float vCounters;\n\n    vec2 fix( vec4 i, float aspect ) {\n        vec2 res = i.xy / i.w;\n        res.x *= aspect;\n        vCounters = counters;\n        return res;\n    }\n\n    void main() {\n\n        float aspect = resolution.x / resolution.y;\n\n        vColor = vec4( color, opacity );\n        vUV = uv;\n\n        mat4 m = projectionMatrix * modelViewMatrix;\n        vec4 finalPosition = m * vec4( position, 1.0 );\n        vec4 prevPos = m * vec4( previous, 1.0 );\n        vec4 nextPos = m * vec4( next, 1.0 );\n\n        vec2 currentP = fix( finalPosition, aspect );\n        vec2 prevP = fix( prevPos, aspect );\n        vec2 nextP = fix( nextPos, aspect );\n        float w = lineWidth * width;\n\n        vec2 dir;\n        if( nextP == currentP ) dir = normalize( currentP - prevP );\n        else if( prevP == currentP ) dir = normalize( nextP - currentP );\n        else {\n            vec2 dir1 = normalize( currentP - prevP );\n            vec2 dir2 = normalize( nextP - currentP );\n            dir = normalize( dir1 + dir2 );\n\n            // vec2 perp = vec2( -dir1.y, dir1.x );\n            // vec2 miter = vec2( -dir.y, dir.x );\n            //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );\n        }\n\n        //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;\n        vec4 normal = vec4( -dir.y, dir.x, 0., 1. );\n        normal.xy *= .5 * w;\n        normal *= projectionMatrix;\n        if( sizeAttenuation == 0. ) {\n            normal.xy *= finalPosition.w;\n            normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;\n        }\n        finalPosition.xy += normal.xy * side;\n\n        gl_Position = finalPosition;\n    ",c.ShaderChunk.logdepthbuf_vertex,c.ShaderChunk.fog_vertex&&" vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.fog_vertex,"}"].join("\n"),c.ShaderChunk.meshline_frag=["",c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.logdepthbuf_pars_fragment,"\n    uniform float time;\n\n    uniform sampler2D map;\n    uniform sampler2D alphaMap;\n    uniform float useMap;\n    uniform float useAlphaMap;\n    uniform float visibility;\n    uniform float alphaTest;\n    uniform vec2 repeat;\n\n    varying vec2 vUV;\n    varying vec4 vColor;\n    varying float vCounters;\n\n    void main() {\n    ",c.ShaderChunk.logdepthbuf_fragment,"\n        vec4 c = vColor;\n        if( useMap == 1. ) {\n            vec2 fixUV = vUV;\n            c *= texture2D( map, vec2(fixUV.x + fract(time),fixUV.y) * repeat);\n        }\n        if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;\n        if( c.a < alphaTest ) discard;\n\n        gl_FragColor = c;\n        gl_FragColor.a *= step(vCounters, visibility);\n        ",c.ShaderChunk.fog_fragment,"}"].join("\n");var x=function(e){(0,s.default)(o,e);var n=f(o);function o(e){var t;return(0,r.default)(this,o),(t=n.call(this,{uniforms:Object.assign({},c.UniformsLib.fog,{time:{value:Math.random()},lineWidth:{value:5},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{type:"color",value:new c.Color(16777215)},opacity:{value:1},resolution:{value:new c.Vector2(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0},repeat:{type:"repeat",value:new c.Vector2(1,1)}}),vertexShader:c.ShaderChunk.meshline_vert,fragmentShader:c.ShaderChunk.meshline_frag})).type="MeshLineMaterial",Object.defineProperties((0,a.default)(t),{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(e){this.uniforms.lineWidth.value=e}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(e){this.uniforms.map.value=e}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(e){this.uniforms.useMap.value=e}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(e){this.uniforms.alphaMap.value=e}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(e){this.uniforms.useAlphaMap.value=e}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(e){this.uniforms.color.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(e){this.uniforms.sizeAttenuation.value=e}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(e){this.uniforms.visibility.value=e}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(e){this.uniforms.alphaTest.value=e}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(e){this.uniforms.repeat.value.copy(e)}}}),t.setValues(e),t}return(0,i.default)(o,[{key:"copy",value:function(e){return(0,t.default)((0,u.default)(o.prototype),"copy",this).call(this,e),this.time=e.time,this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}]),o}(c.ShaderMaterial);e.MeshLineMaterial=x},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},924:function(e,t,n){var r,i,a,o=n(735);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(220),n(274),n(44),n(972),n(994),n(611),n(337),n(964)],r=function(e,t,r,i,a,s,l,u,c){var h=n(709);function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}function p(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==o(e)&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function f(e){var t=m();return function(){var n,r=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function v(e,t){var n=new c.Matrix4,r=new c.Ray,i=new c.Sphere,a=new c.Vector3,o=this.geometry;if(i.copy(o.boundingSphere),i.applyMatrix4(this.matrixWorld),!1!==e.ray.intersectSphere(i,a)){n.copy(this.matrixWorld).invert(),r.copy(e.ray).applyMatrix4(n);var s=new c.Vector3,l=new c.Vector3,u=new c.Vector3,h=this instanceof c.LineSegments?2:1,d=o.index,p=o.attributes;if(null!==d)for(var f=d.array,m=p.position.array,v=p.width.array,g=0,y=f.length-1;g<y;g+=h){var x=f[g],b=f[g+1];s.fromArray(m,3*x),l.fromArray(m,3*b);var M=null!=v[Math.floor(g/3)]?v[Math.floor(g/3)]:1,w=e.params.Line.threshold+this.material.lineWidth*M/2,_=w*w;if(!(r.distanceSqToSegment(s,l,a,u)>_)){a.applyMatrix4(this.matrixWorld);var A=e.ray.origin.distanceTo(a);A<e.near||A>e.far||(t.push({distance:A,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}),g=y)}}}}function g(e,t,n,r,i){var a;if(e=e.subarray||e.slice?e:e.buffer,n=n.subarray||n.slice?n:n.buffer,e=t?e.subarray?e.subarray(t,i&&t+i):e.slice(t,i&&t+i):e,n.set)n.set(e,r);else for(a=0;a<e.length;a++)n[a+r]=e[a];return n}Object.defineProperty(e,"__esModule",{value:!0}),e.MeshLineMaterialTest=e.MeshLine=void 0,e.MeshLineRaycast=v,t=h(t),r=h(r),i=h(i),a=h(a),s=h(s),l=h(l),u=h(u);var y=function(t){(0,s.default)(o,t);var n=f(o);function o(){var e;return(0,r.default)(this,o),(e=n.call(this)).type="MeshLine",e.isMeshLine=!0,e.positions=[],e.raycast=v,e.previous=[],e.next=[],e.side=[],e.width=[],e.indices_array=[],e.uvs=[],e.counters=[],e._points=[],e._geom=null,e.widthCallback=null,e.matrixWorld=new c.Matrix4,Object.defineProperties((0,a.default)(e),{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(e){this.setGeometry(e,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(e){this.setPoints(e,this.widthCallback)}}}),e}return(0,i.default)(o,[{key:"setMatrixWorld",value:function(e){this.matrixWorld=e}},{key:"setGeometry",value:function(e,t){this._geometry=e,e instanceof c.BufferGeometry?this.setPoints(e.getAttribute("position").array,t):this.setPoints(e,t)}},{key:"setPoints",value:function(t,n){if(t instanceof Float32Array||t instanceof Array){if(this._points=t,this.widthCallback=n,this.positions=[],this.counters=[],t.length&&t[0]instanceof c.Vector3)for(var r=0;r<t.length;r++){var i=t[r],a=r/t.length;this.positions.push(i.x,i.y,i.z),this.positions.push(i.x,i.y,i.z),this.counters.push(a),this.counters.push(a)}else for(o=0;o<t.length;o+=3)e.MeshLineMaterialTest=x=o/t.length,this.positions.push(t[o],t[o+1],t[o+2]),this.positions.push(t[o],t[o+1],t[o+2]),this.counters.push(x),this.counters.push(x);this.process()}}},{key:"compareV3",value:function(e,t){var n=6*e,r=6*t;return this.positions[n]===this.positions[r]&&this.positions[n+1]===this.positions[r+1]&&this.positions[n+2]===this.positions[r+2]}},{key:"copyV3",value:function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]}},{key:"process",value:function(){var e,t,n=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],t=this.compareV3(0,n-1)?this.copyV3(n-2):this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(var r=0;r<n;r++){if(this.side.push(1),this.side.push(-1),e=this.widthCallback?this.widthCallback(r/(n-1)):1,this.width.push(e),this.width.push(e),this.uvs.push(r/(n-1),0),this.uvs.push(r/(n-1),1),r<n-1){t=this.copyV3(r),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);var i=2*r;this.indices_array.push(i,i+1,i+2),this.indices_array.push(i+2,i+1,i+3)}r>0&&(t=this.copyV3(r),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]))}t=this.compareV3(n-1,0)?this.copyV3(1):this.copyV3(n-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new c.BufferAttribute(new Float32Array(this.positions),3),previous:new c.BufferAttribute(new Float32Array(this.previous),3),next:new c.BufferAttribute(new Float32Array(this.next),3),side:new c.BufferAttribute(new Float32Array(this.side),1),width:new c.BufferAttribute(new Float32Array(this.width),1),uv:new c.BufferAttribute(new Float32Array(this.uvs),2),index:new c.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new c.BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}},{key:"advance",value:function(e){var t=e.x,n=e.y,r=e.z,i=this._attributes.position.array,a=this._attributes.previous.array,o=this._attributes.next.array,s=i.length;g(i,0,a,0,s),g(i,6,i,0,s-6),i[s-6]=t,i[s-5]=n,i[s-4]=r,i[s-3]=t,i[s-2]=n,i[s-1]=r,g(i,6,o,0,s-6),o[s-6]=t,o[s-5]=n,o[s-4]=r,o[s-3]=t,o[s-2]=n,o[s-1]=r,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}]),o}((c=p(c)).BufferGeometry);e.MeshLine=y;var x=function(e){(0,s.default)(o,e);var n=f(o);function o(e){var t;(0,r.default)(this,o);var i=["","#include <common>","",c.ShaderChunk.logdepthbuf_pars_vertex,c.ShaderChunk.fog_pars_vertex,"\n    \tattribute vec3 previous;\n    \tattribute vec3 next;\n    \tattribute float side;\n    \tattribute float width;\n    \tattribute float counters;\n\n    \tuniform vec2 resolution;\n    \tuniform float lineWidth;\n    \tuniform vec3 color;\n    \tuniform float opacity;\n    \tuniform float sizeAttenuation;\n\n    \tvarying vec2 vUV;\n    \tvarying vec4 vColor;\n    \tvarying float vCounters;\n\t\tvarying vec3 vPosition;\n\n    \tvec2 fix( vec4 i, float aspect ) {\n    \t    vec2 res = i.xy / i.w;\n    \t    res.x *= aspect;\n    \t    vCounters = counters;\n    \t    return res;\n    \t}\n\n    \tvoid main() {\n\n    \t    float aspect = resolution.x / resolution.y;\n\n    \t    vColor = vec4( color, opacity );\n    \t    vUV = uv;\n\t\t\tvPosition = position;\n\n    \t    mat4 m = projectionMatrix * modelViewMatrix;\n    \t    vec4 finalPosition = m * vec4( position, 1.0 );\n    \t    vec4 prevPos = m * vec4( previous, 1.0 );\n    \t    vec4 nextPos = m * vec4( next, 1.0 );\n\n    \t    vec2 currentP = fix( finalPosition, aspect );\n    \t    vec2 prevP = fix( prevPos, aspect );\n    \t    vec2 nextP = fix( nextPos, aspect );\n    \t    float w = lineWidth * width;\n\n    \t    vec2 dir;\n    \t    if( nextP == currentP ) dir = normalize( currentP - prevP );\n    \t    else if( prevP == currentP ) dir = normalize( nextP - currentP );\n    \t    else {\n    \t        vec2 dir1 = normalize( currentP - prevP );\n    \t        vec2 dir2 = normalize( nextP - currentP );\n    \t        dir = normalize( dir1 + dir2 );\n\n    \t        // vec2 perp = vec2( -dir1.y, dir1.x );\n    \t        // vec2 miter = vec2( -dir.y, dir.x );\n    \t        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );\n    \t    }\n\n        \t//vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;\n        \tvec4 normal = vec4( -dir.y, dir.x, 0., 1. );\n        \tnormal.xy *= .5 * w;\n        \tnormal *= projectionMatrix;\n        \tif( sizeAttenuation == 0. ) {\n        \t    normal.xy *= finalPosition.w;\n        \t    normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;\n        \t}\n        \tfinalPosition.xy += normal.xy * side;\n\n        \tgl_Position = finalPosition;\n    \t",c.ShaderChunk.logdepthbuf_vertex,c.ShaderChunk.fog_vertex&&" vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",c.ShaderChunk.fog_vertex,"}"].join("\n"),s=["",c.ShaderChunk.fog_pars_fragment,c.ShaderChunk.logdepthbuf_pars_fragment,"\n    \tuniform float time;\n\n    \tuniform sampler2D map;\n    \tuniform sampler2D alphaMap;\n    \tuniform float useMap;\n    \tuniform float useAlphaMap;\n    \tuniform float visibility;\n    \tuniform float alphaTest;\n    \tuniform vec2 repeat;\n\t\tuniform float lineHeight;\n\t\tuniform float highHeight;\n\n    \tvarying vec2 vUV;\n    \tvarying vec4 vColor;\n    \tvarying float vCounters;\n    \tvarying vec3 vPosition;\n\n    \tvoid main() {\n    \t",c.ShaderChunk.logdepthbuf_fragment,"\n        \tvec4 c = vColor;\n        \tif( useMap == 1. ) {\n        \t    vec2 fixUV = vUV;\n        \t    c *= texture2D( map, vec2(fixUV.x + fract(time),fixUV.y) * repeat);\n        \t}\n        \tif( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;\n        \tif( c.a < alphaTest ) discard;\n\t\t\tif( (highHeight < 0.0 && vPosition.y < lineHeight ) || (highHeight > 0.0 && (vPosition.y < lineHeight && vPosition.y > lineHeight-highHeight))) gl_FragColor = c;\n\t\t\telse {\n\t\t\t\tc.a *= 0.01;\n\t\t\t\tgl_FragColor = c;\n\t\t\t}\n        \tgl_FragColor.a *= step(vCounters, visibility);\n        \t",c.ShaderChunk.fog_fragment,"}"].join("\n");return(t=n.call(this,{uniforms:Object.assign({},c.UniformsLib.fog,{time:{value:Math.random()},lineWidth:{value:5},lineHeight:{value:1},highHeight:{value:1/0},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{type:"color",value:new c.Color(16777215)},opacity:{value:1},resolution:{value:new c.Vector2(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0},repeat:{type:"repeat",value:new c.Vector2(1,1)}}),vertexShader:i,fragmentShader:s})).type="MeshLineMaterial",Object.defineProperties((0,a.default)(t),{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(e){this.uniforms.lineWidth.value=e}},lineHeight:{enumerable:!0,get:function(){return this.uniforms.lineHeight.value},set:function(e){this.uniforms.lineHeight.value=e}},highHeight:{enumerable:!0,get:function(){return this.uniforms.highHeight.value},set:function(e){this.uniforms.highHeight.value=e}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(e){this.uniforms.map.value=e}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(e){this.uniforms.useMap.value=e}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(e){this.uniforms.alphaMap.value=e}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(e){this.uniforms.useAlphaMap.value=e}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(e){this.uniforms.color.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(e){this.uniforms.sizeAttenuation.value=e}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(e){this.uniforms.visibility.value=e}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(e){this.uniforms.alphaTest.value=e}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(e){this.uniforms.repeat.value.copy(e)}}}),t.setValues(e),t}return(0,i.default)(o,[{key:"copy",value:function(e){return(0,t.default)((0,u.default)(o.prototype),"copy",this).call(this,e),this.time=e.time,this.lineWidth=e.lineWidth,this.lineHeight=e.lineHeight,this.highHeight=e.highHeight,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}]),o}(c.ShaderMaterial);e.MeshLineMaterialTest=x},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},103:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(274),n(972),n(994),n(611),n(337),n(964)],r=function(e,t,r,i,a,o,s){var l=n(709);function u(e){var t=c();return function(){var n,r=(0,o.default)(e);if(t){var i=(0,o.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}Object.defineProperty(e,"__esModule",{value:!0}),e.ReflectorMesh=void 0,t=l(t),r=l(r),i=l(i),a=l(a),o=l(o);var h=function(e){(0,i.default)(a,e);var n=u(a);function a(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,t.default)(this,a),i=n.call(this,e.geometry.clone());var l=(0,r.default)(i),u=void 0!==o.textureWidth?o.textureWidth:512,c=void 0!==o.textureHeight?o.textureHeight:512,h=void 0!==o.clipBias?o.clipBias:0,d=void 0!==o.eye?o.eye:new s.Vector3(0,0,0),p=void 0!==o.definition?o.definition:.9,f=new s.Plane,m=new s.Vector3,v=new s.Vector3,g=new s.Vector3,y=new s.Matrix4,x=new s.Vector3(0,0,-1),b=new s.Vector4,M=new s.Vector3,w=new s.Vector3,_=new s.Vector4,A=new s.Matrix4,C=new s.PerspectiveCamera,T={minFilter:s.LinearFilter,magFilter:s.LinearFilter,format:s.RGBFormat},S=new s.WebGLRenderTarget(u,c,T);s.MathUtils.isPowerOfTwo(u)&&s.MathUtils.isPowerOfTwo(c)||(S.texture.generateMipmaps=!1);var E=e.material.clone();return E.onBeforeCompile=function(e){e.uniforms.colorMap={value:S.texture},e.uniforms.textureMatrix={value:A},e.uniforms.definition={value:p};var t=["varying vec4 mirrorCoord;","#include <common>"].join("\n"),n=["#include <begin_vertex>","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","mirrorCoord = textureMatrix * mirrorCoord;"].join("\n");e.vertexShader="\n\t\t\tuniform mat4 textureMatrix;\n\t\t\t".concat(e.vertexShader.replace("#include <common>",t).replace("#include <begin_vertex>",n),"\n\t\t  ");var r=["varying vec4 mirrorCoord;","#include <common>"].join("\n");e.fragmentShader="\n\t\t\t  uniform sampler2D colorMap;\n\t\t\t  uniform float definition;\n\t\t\t  ".concat(e.fragmentShader.replace("#include <common>",r).replace("vec4 diffuseColor = vec4( diffuse, opacity );","\n\t\t\t\t  vec3 reflectionSample = vec3( texture2D( colorMap, mirrorCoord.xy / mirrorCoord.w ) );\n\t\t\t\t  vec4 diffuseColor = vec4( diffuse, opacity );\n\t\t\t\t  diffuseColor.rgb = mix(diffuseColor.rgb, reflectionSample*definition, 0.3);\n\t\t\t\t"),"\n\t\t\t")},l.material=E,l.onBeforeRender=function(e,t,n){if(v.setFromMatrixPosition(l.matrixWorld),g.setFromMatrixPosition(n.matrixWorld),y.extractRotation(l.matrixWorld),m.set(0,0,1),m.applyMatrix4(y),M.subVectors(v,g),!(M.dot(m)>0)){M.reflect(m).negate(),M.add(v),y.extractRotation(n.matrixWorld),x.set(0,0,-1),x.applyMatrix4(y),x.add(g),w.subVectors(v,x),w.reflect(m).negate(),w.add(v),C.position.copy(M),C.up.set(0,1,0),C.up.applyMatrix4(y),C.up.reflect(m),C.lookAt(w),C.far=n.far,C.updateMatrixWorld(),C.projectionMatrix.copy(n.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(C.projectionMatrix),A.multiply(C.matrixWorldInverse),f.setFromNormalAndCoplanarPoint(m,v),f.applyMatrix4(C.matrixWorldInverse),b.set(f.normal.x,f.normal.y,f.normal.z,f.constant);var r=C.projectionMatrix;_.x=(Math.sign(b.x)+r.elements[8])/r.elements[0],_.y=(Math.sign(b.y)+r.elements[9])/r.elements[5],_.z=-1,_.w=(1+r.elements[10])/r.elements[14],b.multiplyScalar(2/b.dot(_)),r.elements[2]=b.x,r.elements[6]=b.y,r.elements[10]=b.z+1-h,r.elements[14]=b.w,d.setFromMatrixPosition(n.matrixWorld);var i=e.getRenderTarget(),a=e.xr.enabled,o=e.shadowMap.autoUpdate;l.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(S),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,C),l.visible=!0,e.xr.enabled=a,e.shadowMap.autoUpdate=o,e.setRenderTarget(i);var s=n.viewport;void 0!==s&&e.state.viewport(s)}},i}return a}(s.Mesh);e.ReflectorMesh=h},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},959:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(274),n(44),n(972),n(994),n(611),n(337),n(964)],r=function(e,t,r,i,a,o,s,l){var u=n(709);function c(e){var t=h();return function(){var n,r=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,o.default)(this,n)}}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}Object.defineProperty(e,"__esModule",{value:!0}),e.Water=void 0,t=u(t),r=u(r),i=u(i),a=u(a),o=u(o),s=u(s);var d=function(e){(0,a.default)(o,e);var n=c(o);function o(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,t.default)(this,o),r=n.call(this,e);var s=(0,i.default)(r),u=void 0!==a.textureWidth?a.textureWidth:512,c=void 0!==a.textureHeight?a.textureHeight:512,h=void 0!==a.clipBias?a.clipBias:0,d=void 0!==a.alpha?a.alpha:1,p=void 0!==a.time?a.time:0,f=void 0!==a.waterNormals?a.waterNormals:null,m=void 0!==a.sunDirection?a.sunDirection:new l.Vector3(.70707,.70707,0),v=new l.Color(void 0!==a.sunColor?a.sunColor:16777215),g=new l.Color(void 0!==a.waterColor?a.waterColor:8355711),y=void 0!==a.eye?a.eye:new l.Vector3(0,0,0),x=void 0!==a.distortionScale?a.distortionScale:20,b=void 0!==a.side?a.side:l.FrontSide,M=void 0!==a.fog&&a.fog,w=new l.Plane,_=new l.Vector3,A=new l.Vector3,C=new l.Vector3,T=new l.Matrix4,S=new l.Vector3(0,0,-1),E=new l.Vector4,L=new l.Vector3,P=new l.Vector3,B=new l.Vector4,D=new l.Matrix4,k=new l.PerspectiveCamera,R={minFilter:l.LinearFilter,magFilter:l.LinearFilter,format:l.RGBFormat},O=new l.WebGLRenderTarget(u,c,R);l.MathUtils.isPowerOfTwo(u)&&l.MathUtils.isPowerOfTwo(c)||(O.texture.generateMipmaps=!1);var I={uniforms:l.UniformsUtils.merge([l.UniformsLib.fog,l.UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new l.Matrix4},sunColor:{value:new l.Color(8355711)},sunDirection:{value:new l.Vector3(.70707,.70707,0)},eye:{value:new l.Vector3},waterColor:{value:new l.Color(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","#include <common>","#include <fog_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;","#include <beginnormal_vertex>","#include <defaultnormal_vertex>","#include <logdepthbuf_vertex>","#include <fog_vertex>","#include <shadowmap_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}","#include <common>","#include <packing>","#include <bsdfs>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <lights_pars_begin>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","void main() {","#include <logdepthbuf_fragment>","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );","#include <tonemapping_fragment>","#include <fog_fragment>","}"].join("\n")},F=new l.ShaderMaterial({fragmentShader:I.fragmentShader,vertexShader:I.vertexShader,uniforms:l.UniformsUtils.clone(I.uniforms),lights:!0,side:b,fog:M});return F.uniforms.mirrorSampler.value=O.texture,F.uniforms.textureMatrix.value=D,F.uniforms.alpha.value=d,F.uniforms.time.value=p,F.uniforms.normalSampler.value=f,F.uniforms.sunColor.value=v,F.uniforms.waterColor.value=g,F.uniforms.sunDirection.value=m,F.uniforms.distortionScale.value=x,F.uniforms.eye.value=y,s.material=F,s.onBeforeRender=function(e,t,n){if(A.setFromMatrixPosition(s.matrixWorld),C.setFromMatrixPosition(n.matrixWorld),T.extractRotation(s.matrixWorld),_.set(0,0,1),_.applyMatrix4(T),L.subVectors(A,C),!(L.dot(_)>0)){L.reflect(_).negate(),L.add(A),T.extractRotation(n.matrixWorld),S.set(0,0,-1),S.applyMatrix4(T),S.add(C),P.subVectors(A,S),P.reflect(_).negate(),P.add(A),k.position.copy(L),k.up.set(0,1,0),k.up.applyMatrix4(T),k.up.reflect(_),k.lookAt(P),k.far=n.far,k.updateMatrixWorld(),k.projectionMatrix.copy(n.projectionMatrix),D.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),D.multiply(k.projectionMatrix),D.multiply(k.matrixWorldInverse),w.setFromNormalAndCoplanarPoint(_,A),w.applyMatrix4(k.matrixWorldInverse),E.set(w.normal.x,w.normal.y,w.normal.z,w.constant);var r=k.projectionMatrix;B.x=(Math.sign(E.x)+r.elements[8])/r.elements[0],B.y=(Math.sign(E.y)+r.elements[9])/r.elements[5],B.z=-1,B.w=(1+r.elements[10])/r.elements[14],E.multiplyScalar(2/E.dot(B)),r.elements[2]=E.x,r.elements[6]=E.y,r.elements[10]=E.z+1-h,r.elements[14]=E.w,y.setFromMatrixPosition(n.matrixWorld);var i=e.getRenderTarget(),a=e.xr.enabled,o=e.shadowMap.autoUpdate;s.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(O),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,k),s.visible=!0,e.xr.enabled=a,e.shadowMap.autoUpdate=o,e.setRenderTarget(i);var l=n.viewport;void 0!==l&&e.state.viewport(l)}},r.isRunning=!0,r.speed=.0167,r}return(0,r.default)(o,[{key:"setSpeed",value:function(e){this.speed=e}},{key:"run",value:function(){this.isRunning&&(this.material.uniforms.time.value+=this.speed)}}]),o}(l.Mesh);e.Water=d,d.prototype.isWater=!0},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},817:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(274),n(44),n(972),n(994),n(611),n(337),n(964)],r=function(e,t,r,i,a,o,s,l){var u=n(709);function c(e){var t=h();return function(){var n,r=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,o.default)(this,n)}}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}Object.defineProperty(e,"__esModule",{value:!0}),e.Water2=void 0,t=u(t),r=u(r),i=u(i),a=u(a),o=u(o),s=u(s);var d=function(e){(0,a.default)(o,e);var n=c(o);function o(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,t.default)(this,o),r=n.call(this,e);var s=(0,i.default)(r),u=void 0!==a.textureWidth?a.textureWidth:512,c=void 0!==a.textureHeight?a.textureHeight:512,h=void 0!==a.clipBias?a.clipBias:0,d=void 0!==a.alpha?a.alpha:1,p=void 0!==a.time?a.time:0,f=void 0!==a.waterNormals?a.waterNormals:null,m=void 0!==a.sunDirection?a.sunDirection:new l.Vector3(.70707,.70707,0),v=new l.Color(void 0!==a.sunColor?a.sunColor:16777215),g=new l.Color(void 0!==a.waterColor?a.waterColor:8355711),y=void 0!==a.eye?a.eye:new l.Vector3(0,0,0),x=void 0!==a.distortionScale?a.distortionScale:20,b=void 0!==a.definition?a.definition:.9,M=void 0!==a.gradientRadius?a.gradientRadius:100,w=new l.Color(void 0!==a.gradientColor?a.gradientColor:0),_=void 0!==a.side?a.side:l.FrontSide,A=void 0!==a.fog&&a.fog,C=new l.Plane,T=new l.Vector3,S=new l.Vector3,E=new l.Vector3,L=new l.Matrix4,P=new l.Vector3(0,0,-1),B=new l.Vector4,D=new l.Vector3,k=new l.Vector3,R=new l.Vector4,O=new l.Matrix4,I=new l.PerspectiveCamera,F={minFilter:l.LinearFilter,magFilter:l.LinearFilter,format:l.RGBFormat},N=new l.WebGLRenderTarget(u,c,F);l.MathUtils.isPowerOfTwo(u)&&l.MathUtils.isPowerOfTwo(c)||(N.texture.generateMipmaps=!1);var z={uniforms:l.UniformsUtils.merge([l.UniformsLib.fog,l.UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},definition:{value:.9},gradientRadius:{value:50},gradientColor:{value:new l.Color(0)},textureMatrix:{value:new l.Matrix4},sunColor:{value:new l.Color(16777215)},sunDirection:{value:new l.Vector3(.70707,.70707,0)},eye:{value:new l.Vector3},waterColor:{value:new l.Color(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","varying vec3 vPosition;","#include <common>","#include <fog_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","void main() {","   vPosition = position;","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tmirrorCoord = textureMatrix * mirrorCoord;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;","#include <beginnormal_vertex>","#include <defaultnormal_vertex>","#include <logdepthbuf_vertex>","#include <fog_vertex>","#include <shadowmap_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform float definition;","uniform float gradientRadius;","uniform vec3 gradientColor;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","varying vec3 vPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 103.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 8907.0, 9803.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 );","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}","#include <common>","#include <packing>","#include <bsdfs>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <lights_pars_begin>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","void main() {","#include <logdepthbuf_fragment>","\tfloat pct = distance(vec2(vPosition.x,vPosition.y),vec2(0.0));","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = normalize( worldToEye );","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tvec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, 1.0 ) * waterColor;","\tvec3 albedo = mix( noise.xyz * waterColor, ( vec3( 0.1 ) + reflectionSample * definition + reflectionSample * specularLight ), rf0);","\tvec4 dc = vec4(mix(albedo,vec3("+w.r.toFixed(2)+", "+w.g.toFixed(2)+", "+w.b.toFixed(2)+"),pow(min(pct/"+M.toFixed(2)+",1.00),2.0)), 1.0);","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( dc.xyz, alpha );","#include <tonemapping_fragment>","#include <fog_fragment>","}"].join("\n")},U=new l.ShaderMaterial({fragmentShader:z.fragmentShader,vertexShader:z.vertexShader,uniforms:l.UniformsUtils.clone(z.uniforms),lights:!0,side:_,fog:A});return U.uniforms.mirrorSampler.value=N.texture,U.uniforms.textureMatrix.value=O,U.uniforms.alpha.value=d,U.uniforms.time.value=p,U.uniforms.normalSampler.value=f,U.uniforms.sunColor.value=v,U.uniforms.waterColor.value=g,U.uniforms.sunDirection.value=m,U.uniforms.distortionScale.value=x,U.uniforms.definition.value=b,U.uniforms.gradientRadius.value=M,U.uniforms.gradientColor.value=w,U.uniforms.eye.value=y,s.material=U,s.onBeforeRender=function(e,t,n){if(S.setFromMatrixPosition(s.matrixWorld),E.setFromMatrixPosition(n.matrixWorld),L.extractRotation(s.matrixWorld),T.set(0,0,1),T.applyMatrix4(L),D.subVectors(S,E),!(D.dot(T)>0)){D.reflect(T).negate(),D.add(S),L.extractRotation(n.matrixWorld),P.set(0,0,-1),P.applyMatrix4(L),P.add(E),k.subVectors(S,P),k.reflect(T).negate(),k.add(S),I.position.copy(D),I.up.set(0,1,0),I.up.applyMatrix4(L),I.up.reflect(T),I.lookAt(k),I.far=n.far,I.updateMatrixWorld(),I.projectionMatrix.copy(n.projectionMatrix),O.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),O.multiply(I.projectionMatrix),O.multiply(I.matrixWorldInverse),C.setFromNormalAndCoplanarPoint(T,S),C.applyMatrix4(I.matrixWorldInverse),B.set(C.normal.x,C.normal.y,C.normal.z,C.constant);var r=I.projectionMatrix;R.x=(Math.sign(B.x)+r.elements[8])/r.elements[0],R.y=(Math.sign(B.y)+r.elements[9])/r.elements[5],R.z=-1,R.w=(1+r.elements[10])/r.elements[14],B.multiplyScalar(2/B.dot(R)),r.elements[2]=B.x,r.elements[6]=B.y,r.elements[10]=B.z+1-h,r.elements[14]=B.w,y.setFromMatrixPosition(n.matrixWorld);var i=e.getRenderTarget(),a=e.xr.enabled,o=e.shadowMap.autoUpdate;s.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(N),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,I),s.visible=!0,e.xr.enabled=a,e.shadowMap.autoUpdate=o,e.setRenderTarget(i);var l=n.viewport;void 0!==l&&e.state.viewport(l)}},r.isRunning=!0,r.speed=.0167,r}return(0,r.default)(o,[{key:"setSpeed",value:function(e){this.speed=e}},{key:"run",value:function(){this.isRunning&&(this.material.uniforms.time.value+=this.speed)}}]),o}(l.Mesh);e.Water2=d,d.prototype.isWater=!0},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},562:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(274),n(44),n(972),n(994),n(611),n(337),n(964)],r=function(e,t,r,i,a,o,s,l){var u=n(709);function c(e){var t=h();return function(){var n,r=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,o.default)(this,n)}}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}Object.defineProperty(e,"__esModule",{value:!0}),e.Water3=void 0,t=u(t),r=u(r),i=u(i),a=u(a),o=u(o),s=u(s);var d=function(e){(0,a.default)(o,e);var n=c(o);function o(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,t.default)(this,o),r=n.call(this,e);var s=(0,i.default)(r),u=void 0!==a.alpha?a.alpha:1,c=void 0!==a.time?a.time:0,h=void 0!==a.waterNormals?a.waterNormals:null,d=void 0!==a.sunDirection?a.sunDirection:new l.Vector3(.70707,.70707,0),p=new l.Color(void 0!==a.sunColor?a.sunColor:16777215),f=new l.Color(void 0!==a.waterColor?a.waterColor:8355711),m=void 0!==a.eye?a.eye:new l.Vector3(0,0,0),v=void 0!==a.distortionScale?a.distortionScale:20,g=void 0!==a.side?a.side:l.FrontSide,y=void 0!==a.fog&&a.fog,x={uniforms:l.UniformsUtils.merge([l.UniformsLib.fog,l.UniformsLib.lights,{normalSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},sunColor:{value:new l.Color(8355711)},sunDirection:{value:new l.Vector3(.70707,.70707,0)},eye:{value:new l.Vector3},waterColor:{value:new l.Color(5592405)}}]),vertexShader:["uniform float time;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","#include <common>","#include <fog_pars_vertex>","#include <shadowmap_pars_vertex>","#include <logdepthbuf_pars_vertex>","void main() {","\tmirrorCoord = modelMatrix * vec4( position, 1.0 );","\tworldPosition = mirrorCoord.xyzw;","\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;","#include <beginnormal_vertex>","#include <defaultnormal_vertex>","#include <logdepthbuf_vertex>","#include <fog_vertex>","#include <shadowmap_vertex>","}"].join("\n"),fragmentShader:["uniform float alpha;","uniform float time;","uniform float size;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec4 worldPosition;","vec4 getNoise( vec2 uv ) {","\tvec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","\tvec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","\tvec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","\tvec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","\tvec4 noise = texture2D( normalSampler, uv0 ) +","\t\ttexture2D( normalSampler, uv1 ) +","\t\ttexture2D( normalSampler, uv2 ) +","\t\ttexture2D( normalSampler, uv3 );","\treturn noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {","\tvec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","\tfloat direction = max( 0.0, dot( eyeDirection, reflection ) );","\tspecularColor += pow( direction, shiny ) * sunColor * spec;","\tdiffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}","#include <common>","#include <packing>","#include <bsdfs>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <lights_pars_begin>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","void main() {","#include <logdepthbuf_fragment>","\tvec4 noise = getNoise( worldPosition.xz * size );","\tvec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","\tvec3 diffuseLight = vec3(0.0);","\tvec3 specularLight = vec3(0.0);","\tvec3 worldToEye = eye-worldPosition.xyz;","\tvec3 eyeDirection = vec3(1.0);;","\tsunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );","\tfloat distance = length(worldToEye);","\tvec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;","\tfloat theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","\tfloat rf0 = 0.3;","\tfloat reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","\tvec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","\tvec3 albedo = ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask();","\tvec3 outgoingLight = albedo;","\tgl_FragColor = vec4( outgoingLight, alpha );","#include <tonemapping_fragment>","#include <fog_fragment>","}"].join("\n")},b=new l.ShaderMaterial({fragmentShader:x.fragmentShader,vertexShader:x.vertexShader,uniforms:l.UniformsUtils.clone(x.uniforms),lights:!0,side:g,fog:y});return b.uniforms.alpha.value=u,b.uniforms.time.value=c,b.uniforms.normalSampler.value=h,b.uniforms.sunColor.value=p,b.uniforms.waterColor.value=f,b.uniforms.sunDirection.value=d,b.uniforms.distortionScale.value=v,b.uniforms.eye.value=m,s.material=b,r.isRunning=!0,r.speed=.0167,r}return(0,r.default)(o,[{key:"setSpeed",value:function(e){this.speed=e}},{key:"run",value:function(){this.isRunning&&(this.material.uniforms.time.value+=this.speed)}}]),o}(l.Mesh);e.Water3=d,d.prototype.isWater=!0},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},446:function(e,t){var n,r,i;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,r=[],void 0===(i="function"==typeof(n=function(){var e={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n={};n[THREE.NearestFilter]=e.NEAREST,n[THREE.NearestMipmapNearestFilter]=e.NEAREST_MIPMAP_NEAREST,n[THREE.NearestMipmapLinearFilter]=e.NEAREST_MIPMAP_LINEAR,n[THREE.LinearFilter]=e.LINEAR,n[THREE.LinearMipmapNearestFilter]=e.LINEAR_MIPMAP_NEAREST,n[THREE.LinearMipmapLinearFilter]=e.LINEAR_MIPMAP_LINEAR,n[THREE.ClampToEdgeWrapping]=e.CLAMP_TO_EDGE,n[THREE.RepeatWrapping]=e.REPEAT,n[THREE.MirroredRepeatWrapping]=e.MIRRORED_REPEAT;var r={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};THREE.GLTFExporter=function(){},THREE.GLTFExporter.prototype={constructor:THREE.GLTFExporter,parse:function(i,a,o){var s={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1};(o=Object.assign({},s,o)).animations.length>0&&(o.trs=!0);var l,u={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},c=0,h=[],d=[],p=new Map,f=[],m={},v={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},g=new Map,y=0;function x(e){return g.has(e)||g.set(e,y++),g.get(e)}function b(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}function M(e){return b(e.elements,t)}function w(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;for(var t=new Uint8Array(new ArrayBuffer(e.length)),n=0,r=e.length;n<r;n++){var i=e.charCodeAt(n);t[n]=i>255?32:i}return t.buffer}function _(e,t,n){for(var r={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},i=t;i<t+n;i++)for(var a=0;a<e.itemSize;a++){var o=void 0;e.itemSize>4?o=e.array[i*e.itemSize+a]:0===a?o=e.getX(i):1===a?o=e.getY(i):2===a?o=e.getZ(i):3===a&&(o=e.getW(i)),r.min[a]=Math.min(r.min[a],o),r.max[a]=Math.max(r.max[a],o)}return r}function A(e){if(v.attributesNormalized.has(e))return!1;for(var t=new THREE.Vector3,n=0,r=e.count;n<r;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}function C(e){if(v.attributesNormalized.has(e))return v.attributesNormalized.get(e);for(var t=e.clone(),n=new THREE.Vector3,r=0,i=t.count;r<i;r++)n.fromBufferAttribute(t,r),0===n.x&&0===n.y&&0===n.z?n.setX(1):n.normalize(),t.setXYZ(r,n.x,n.y,n.z);return v.attributesNormalized.set(e,t),t}function T(e){return 4*Math.ceil(e/4)}function S(e,t){t=t||0;var n=T(e.byteLength);if(n!==e.byteLength){var r=new Uint8Array(n);if(r.set(new Uint8Array(e)),0!==t)for(var i=e.byteLength;i<n;i++)r[i]=t;return r.buffer}return e}function E(e,t){if(0!==Object.keys(e.userData).length)try{var n=JSON.parse(JSON.stringify(e.userData));if(o.includeCustomExtensions&&n.gltfExtensions){for(var r in void 0===t.extensions&&(t.extensions={}),n.gltfExtensions)t.extensions[r]=n.gltfExtensions[r],m[r]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(t.extras=n)}catch(e){}}function L(e,t){if(0!==Object.keys(e.userData).length)try{t.extras={},"renderOrder"in e.userData&&(t.extras.renderOrder=e.userData.renderOrder),"node_tag"in e.userData&&(t.extras.node_tag=e.userData.node_tag),"level_elevation"in e.userData&&(t.extras.level_elevation=e.userData.level_elevation),"host"in e.userData&&(t.extras.host=e.userData.host),0===Object.keys(t.extras).length&&(t.extras=null)}catch(e){}}function P(e,t){var n=!1,r={};0===t.offset.x&&0===t.offset.y||(r.offset=t.offset.toArray(),n=!0),0!==t.rotation&&(r.rotation=t.rotation,n=!0),1===t.repeat.x&&1===t.repeat.y||(r.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,m.KHR_texture_transform=!0)}function B(e){return u.buffers||(u.buffers=[{byteLength:0}]),h.push(e),0}function D(t,n,r,i,a){var o;u.bufferViews||(u.bufferViews=[]),o=n===e.UNSIGNED_BYTE?1:n===e.UNSIGNED_SHORT?2:4;for(var s=T(i*t.itemSize*o),l=new DataView(new ArrayBuffer(s)),h=0,d=r;d<r+i;d++)for(var p=0;p<t.itemSize;p++){var f=void 0;t.itemSize>4?f=t.array[d*t.itemSize+p]:0===p?f=t.getX(d):1===p?f=t.getY(d):2===p?f=t.getZ(d):3===p&&(f=t.getW(d)),n===e.FLOAT?l.setFloat32(h,f,!0):n===e.UNSIGNED_INT?l.setUint32(h,f,!0):n===e.UNSIGNED_SHORT?l.setUint16(h,f,!0):n===e.UNSIGNED_BYTE&&l.setUint8(h,f),h+=o}var m={buffer:B(l.buffer),byteOffset:c,byteLength:s};return void 0!==a&&(m.target=a),a===e.ARRAY_BUFFER&&(m.byteStride=t.itemSize*o),c+=s,u.bufferViews.push(m),{id:u.bufferViews.length-1,byteLength:0}}function k(e){return u.bufferViews||(u.bufferViews=[]),new Promise((function(t){var n=new window.FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){var e=S(n.result),r={buffer:B(e),byteOffset:c,byteLength:e.byteLength};c+=e.byteLength,u.bufferViews.push(r),t(u.bufferViews.length-1)}}))}function R(t,n,r,i){var a,s={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"};if(t.array.constructor===Float32Array)a=e.FLOAT;else if(t.array.constructor===Uint32Array)a=e.UNSIGNED_INT;else if(t.array.constructor===Uint16Array)a=e.UNSIGNED_SHORT;else{if(t.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");a=e.UNSIGNED_BYTE}if(void 0===r&&(r=0),void 0===i&&(i=t.count),o.truncateDrawRange&&void 0!==n&&null===n.index){var l=r+i,c=n.drawRange.count===1/0?t.count:n.drawRange.start+n.drawRange.count;r=Math.max(r,n.drawRange.start),(i=Math.min(l,c)-r)<0&&(i=0)}if(0===i)return null;var h,d=_(t,r,i);void 0!==n&&(h=t===n.index?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER);var p=D(t,a,r,i,h),f={bufferView:p.id,byteOffset:p.byteOffset,componentType:a,count:i,max:d.max,min:d.min,type:s[t.itemSize]};return!0===t.normalized&&(f.normalized=!0),u.accessors||(u.accessors=[]),u.accessors.push(f),u.accessors.length-1}function O(e,t,n){v.images.has(e)||v.images.set(e,{});var r=v.images.get(e),i=t===THREE.RGBAFormat?"image/png":"image/jpeg",a=i+":flipY/"+n.toString();if(void 0!==r[a])return r[a];u.images||(u.images=[]);var s={mimeType:i};if(o.embedImages){var c=l=l||document.createElement("canvas");c.width=Math.min(e.width,o.maxTextureSize),c.height=Math.min(e.height,o.maxTextureSize);var h=c.getContext("2d");if(!0===n&&(h.translate(0,c.height),h.scale(1,-1)),"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)h.drawImage(e,0,0,c.width,c.height);else{t!==THREE.RGBAFormat&&THREE.RGBFormat,e.width>o.maxTextureSize||(e.height,o.maxTextureSize);var p=e.data;if(t===THREE.RGBFormat){p=new Uint8ClampedArray(e.height*e.width*4);for(var f=0,m=0;f<p.length;f+=4,m+=3)p[f+0]=e.data[m+0],p[f+1]=e.data[m+1],p[f+2]=e.data[m+2],p[f+3]=255}h.putImageData(new ImageData(p,e.width,e.height),0,0)}!0===o.binary?d.push(new Promise((function(e){c.toBlob((function(t){k(t).then((function(t){s.bufferView=t,e()}))}),i)}))):s.uri=c.toDataURL(i)}else s.uri=e.src;u.images.push(s);var g=u.images.length-1;return r[a]=g,g}function I(e){u.samplers||(u.samplers=[]);var t={magFilter:n[e.magFilter],minFilter:n[e.minFilter],wrapS:n[e.wrapS],wrapT:n[e.wrapT]};return u.samplers.push(t),u.samplers.length-1}function F(e){if(v.textures.has(e))return v.textures.get(e);u.textures||(u.textures=[]);var t={sampler:I(e),source:O(e.image,e.format,e.flipY)};e.name&&(t.name=e.name),u.textures.push(t);var n=u.textures.length-1;return v.textures.set(e,n),n}function N(e){if(v.materials.has(e))return v.materials.get(e);if(e.isShaderMaterial)return null;u.materials||(u.materials=[]);var t={pbrMetallicRoughness:{}};e.isMeshBasicMaterial?(t.extensions={KHR_materials_unlit:{}},m.KHR_materials_unlit=!0):e.isGLTFSpecularGlossinessMaterial?(t.extensions={KHR_materials_pbrSpecularGlossiness:{}},m.KHR_materials_pbrSpecularGlossiness=!0):e.isMeshStandardMaterial;var n=e.color.toArray().concat([e.opacity]);if(b(n,[1,1,1,1])||(t.pbrMetallicRoughness.baseColorFactor=n),e.isMeshStandardMaterial?(t.pbrMetallicRoughness.metallicFactor=e.metalness,t.pbrMetallicRoughness.roughnessFactor=e.roughness):e.isMeshBasicMaterial?(t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9):(t.pbrMetallicRoughness.metallicFactor=.5,t.pbrMetallicRoughness.roughnessFactor=.5),e.isGLTFSpecularGlossinessMaterial){t.pbrMetallicRoughness.baseColorFactor&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);var r=[1,1,1];e.specular.toArray(r,0),t.extensions.KHR_materials_pbrSpecularGlossiness.specularFactor=r,t.extensions.KHR_materials_pbrSpecularGlossiness.glossinessFactor=e.glossiness}if((e.metalnessMap||e.roughnessMap)&&e.metalnessMap===e.roughnessMap){var i={index:F(e.metalnessMap)};P(i,e.metalnessMap),t.pbrMetallicRoughness.metallicRoughnessTexture=i}if(e.map){var a={index:F(e.map)};P(a,e.map),e.isGLTFSpecularGlossinessMaterial&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseTexture=a),t.pbrMetallicRoughness.baseColorTexture=a}if(e.isGLTFSpecularGlossinessMaterial&&e.specularMap){var o={index:F(e.specularMap)};P(o,e.specularMap),t.extensions.KHR_materials_pbrSpecularGlossiness.specularGlossinessTexture=o}if(e.emissive){var s=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray();if(b(s,[0,0,0])||(t.emissiveFactor=s),e.emissiveMap){var l={index:F(e.emissiveMap)};P(l,e.emissiveMap),t.emissiveTexture=l}}if(e.normalMap){var c={index:F(e.normalMap)};e.normalScale&&-1!==e.normalScale.x&&(e.normalScale.x,e.normalScale.y,c.scale=e.normalScale.x),P(c,e.normalMap),t.normalTexture=c}if(e.aoMap){var h={index:F(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(h.strength=e.aoMapIntensity),P(h,e.aoMap),t.occlusionTexture=h}e.transparent?t.alphaMode="BLEND":e.alphaTest>0&&(t.alphaMode="MASK",t.alphaCutoff=e.alphaTest),e.side===THREE.DoubleSide&&(t.doubleSided=!0),""!==e.name&&(t.name=e.name),E(e,t),u.materials.push(t);var d=u.materials.length-1;return v.materials.set(e,d),d}function z(t){var n=[t.geometry.uuid];if(Array.isArray(t.material))for(var r=0,i=t.material.length;r<i;r++)n.push(t.material[r].uuid);else n.push(t.material.uuid);var a=n.join(":");if(v.meshes.has(a))return v.meshes.get(a);var o,s=t.geometry;o=t.isLineSegments?e.LINES:t.isLineLoop?e.LINE_LOOP:t.isLine?e.LINE_STRIP:t.isPoints?e.POINTS:t.material.wireframe?e.LINES:e.TRIANGLES,s.isBufferGeometry||(s=(new THREE.BufferGeometry).setFromObject(t));var l={},c={},h=[],d=[],p={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},f=s.getAttribute("normal");void 0===f||A(f)||s.setAttribute("normal",C(f));var m=null;for(var g in s.attributes)if("morph"!==g.substr(0,5)){var y=s.attributes[g];if(g=p[g]||g.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(g)||(g="_"+g),v.attributes.has(x(y)))c[g]=v.attributes.get(x(y));else{m=null;var b=y.array;"JOINTS_0"!==g||b instanceof Uint16Array||b instanceof Uint8Array||(m=new THREE.BufferAttribute(new Uint16Array(b),y.itemSize,y.normalized));var M=R(m||y,s);null!==M&&(c[g]=M,v.attributes.set(x(y),M))}}if(void 0!==f&&s.setAttribute("normal",f),0===Object.keys(c).length)return null;if(void 0!==t.morphTargetInfluences&&t.morphTargetInfluences.length>0){var w=[],_=[],T={};if(void 0!==t.morphTargetDictionary)for(var S in t.morphTargetDictionary)T[t.morphTargetDictionary[S]]=S;for(var L=0;L<t.morphTargetInfluences.length;++L){var P={},B=!1;for(var D in s.morphAttributes)if("position"===D||"normal"===D){var k=s.morphAttributes[D][L],O=D.toUpperCase(),I=s.attributes[D];if(v.attributes.has(x(k)))P[O]=v.attributes.get(x(k));else{var F=k.clone();if(!s.morphTargetsRelative)for(var z=0,U=k.count;z<U;z++)F.setXYZ(z,k.getX(z)-I.getX(z),k.getY(z)-I.getY(z),k.getZ(z)-I.getZ(z));P[O]=R(F,s),v.attributes.set(x(I),P[O])}}else B||(B=!0);d.push(P),w.push(t.morphTargetInfluences[L]),void 0!==t.morphTargetDictionary&&_.push(T[L])}l.weights=w,_.length>0&&(l.extras={},l.extras.targetNames=_)}var H=Array.isArray(t.material);if(H&&0===s.groups.length)return null;for(var j=H?t.material:[t.material],G=H?s.groups:[{materialIndex:0,start:void 0,count:void 0}],V=0,W=G.length;V<W;V++){var X={mode:o,attributes:c};if(E(s,X),d.length>0&&(X.targets=d),null!==s.index){var Y=x(s.index);void 0===G[V].start&&void 0===G[V].count||(Y+=":"+G[V].start+":"+G[V].count),v.attributes.has(Y)?X.indices=v.attributes.get(Y):(X.indices=R(s.index,s,G[V].start,G[V].count),v.attributes.set(Y,X.indices)),null===X.indices&&delete X.indices}var J=N(j[G[V].materialIndex]);null!==J&&(X.material=J),h.push(X)}l.primitives=h,u.meshes||(u.meshes=[]),u.meshes.push(l);var Q=u.meshes.length-1;return v.meshes.set(a,Q),Q}function U(e){u.cameras||(u.cameras=[]);var t=e.isOrthographicCamera,n={type:t?"orthographic":"perspective"};return t?n.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:THREE.MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(n.name=e.type),u.cameras.push(n),u.cameras.length-1}function H(e,t){u.animations||(u.animations=[]);for(var n=(e=THREE.GLTFExporter.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,i=[],a=[],o=0;o<n.length;++o){var s=n[o],l=THREE.PropertyBinding.parseTrackName(s.name),c=THREE.PropertyBinding.findNode(t,l.nodeName),h=r[l.propertyName];if("bones"===l.objectName&&(c=!0===c.isSkinnedMesh?c.skeleton.getBoneByName(l.objectIndex):void 0),!c||!h)return null;var d=1,f=s.values.length/s.times.length;h===r.morphTargetInfluences&&(f/=c.morphTargetInfluences.length);var m=void 0;!0===s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(m="CUBICSPLINE",f/=3):m=s.getInterpolation()===THREE.InterpolateDiscrete?"STEP":"LINEAR",a.push({input:R(new THREE.BufferAttribute(s.times,d)),output:R(new THREE.BufferAttribute(s.values,f)),interpolation:m}),i.push({sampler:a.length-1,target:{node:p.get(c),path:h}})}return u.animations.push({name:e.name||"clip_"+u.animations.length,samplers:a,channels:i}),u.animations.length-1}function j(e){var t=u.nodes[p.get(e)],n=e.skeleton;if(void 0===n)return null;var r=e.skeleton.bones[0];if(void 0===r)return null;for(var i=[],a=new Float32Array(16*n.bones.length),o=0;o<n.bones.length;++o)i.push(p.get(n.bones[o])),n.boneInverses[o].toArray(a,16*o);return void 0===u.skins&&(u.skins=[]),u.skins.push({inverseBindMatrices:R(new THREE.BufferAttribute(a,16)),joints:i,skeleton:p.get(r)}),t.skin=u.skins.length-1}function G(e){var t={};e.name&&(t.name=e.name),t.color=e.color.toArray(),t.intensity=e.intensity,e.isDirectionalLight?t.type="directional":e.isPointLight?(t.type="point",e.distance>0&&(t.range=e.distance)):e.isSpotLight&&(t.type="spot",e.distance>0&&(t.range=e.distance),t.spot={},t.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,t.spot.outerConeAngle=e.angle),void 0!==e.decay&&e.decay,e.target&&(e.target.parent!==e||0!==e.target.position.x||0!==e.target.position.y||e.target.position.z);var n=u.extensions.KHR_lights_punctual.lights;return n.push(t),n.length-1}function V(e){u.nodes||(u.nodes=[]);var t={};if(o.trs){var n=e.quaternion.toArray(),r=e.position.toArray(),i=e.scale.toArray();b(n,[0,0,0,1])||(t.rotation=n),b(r,[0,0,0])||(t.translation=r),b(i,[1,1,1])||(t.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===M(e.matrix)&&(t.matrix=e.matrix.elements);if(""!==e.name&&(t.name=String(e.name)),L(e,t),e.isMesh||e.isLine||e.isPoints){var a=z(e);null!==a&&(t.mesh=a)}else if(e.isCamera)t.camera=U(e);else if(e.isDirectionalLight||e.isPointLight||e.isSpotLight)m.KHR_lights_punctual||(u.extensions=u.extensions||{},u.extensions.KHR_lights_punctual={lights:[]},m.KHR_lights_punctual=!0),t.extensions=t.extensions||{},t.extensions.KHR_lights_punctual={light:G(e)};else if(e.isLight)return null;if(e.isSkinnedMesh&&f.push(e),e.children.length>0){for(var s=[],l=0,c=e.children.length;l<c;l++){var h=e.children[l];if(h.visible||!1===o.onlyVisible){var d=V(h);null!==d&&s.push(d)}}s.length>0&&(t.children=s)}u.nodes.push(t);var v=u.nodes.length-1;return p.set(e,v),v}function W(e){u.scenes||(u.scenes=[],u.scene=0);var t={};""!==e.name&&(t.name=e.name),u.scenes.push(t);for(var n=[],r=0,i=e.children.length;r<i;r++){var a=e.children[r];if(a.visible||!1===o.onlyVisible){var s=V(a);null!==s&&n.push(s)}}n.length>0&&(t.nodes=n),E(e,t)}function X(e){var t=new THREE.Scene;t.name="AuxScene";for(var n=0;n<e.length;n++)t.children.push(e[n]);W(t)}function Y(e){e=e instanceof Array?e:[e];for(var t=[],n=0;n<e.length;n++)e[n]instanceof THREE.Scene?W(e[n]):t.push(e[n]);t.length>0&&X(t);for(var r=0;r<f.length;++r)j(f[r]);for(var i=0;i<o.animations.length;++i)H(o.animations[i],e[0])}Y(i),Promise.all(d).then((function(){var e=new Blob(h,{type:"application/octet-stream"}),t=Object.keys(m);if(t.length>0&&(u.extensionsUsed=t),u.buffers&&u.buffers.length>0&&(u.buffers[0].byteLength=e.size),!0===o.binary){var n=12,r=1179937895,i=2,s=8,l=1313821514,c=5130562,d=new window.FileReader;d.readAsArrayBuffer(e),d.onloadend=function(){var e=S(d.result),t=new DataView(new ArrayBuffer(s));t.setUint32(0,e.byteLength,!0),t.setUint32(4,c,!0);var o=S(w(JSON.stringify(u)),32),h=new DataView(new ArrayBuffer(s));h.setUint32(0,o.byteLength,!0),h.setUint32(4,l,!0);var p=new ArrayBuffer(n),f=new DataView(p);f.setUint32(0,r,!0),f.setUint32(4,i,!0);var m=n+h.byteLength+o.byteLength+t.byteLength+e.byteLength;f.setUint32(8,m,!0);var v=new Blob([p,h,o,t,e],{type:"application/octet-stream"}),g=new window.FileReader;g.readAsArrayBuffer(v),g.onloadend=function(){a(g.result)}}}else if(u.buffers&&u.buffers.length>0){var p=new window.FileReader;p.readAsDataURL(e),p.onloadend=function(){var e=p.result;u.buffers[0].uri=e,a(u)}}else a(u)}))}},THREE.GLTFExporter.Utils={insertKeyframe:function(e,t){var n,r=.001,i=e.getValueSize(),a=new e.TimeBufferType(e.times.length+1),o=new e.ValueBufferType(e.values.length+i),s=e.createInterpolant(new e.ValueBufferType(i));if(0===e.times.length){a[0]=t;for(var l=0;l<i;l++)o[l]=0;n=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<r)return 0;a[0]=t,a.set(e.times,1),o.set(s.evaluate(t),0),o.set(e.values,i),n=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<r)return e.times.length-1;a[a.length-1]=t,a.set(e.times,0),o.set(e.values,0),o.set(s.evaluate(t),e.values.length),n=a.length-1}else for(var u=0;u<e.times.length;u++){if(Math.abs(e.times[u]-t)<r)return u;if(e.times[u]<t&&e.times[u+1]>t){a.set(e.times.slice(0,u+1),0),a[u+1]=t,a.set(e.times.slice(u+1),u+2),o.set(e.values.slice(0,(u+1)*i),0),o.set(s.evaluate(t),(u+1)*i),o.set(e.values.slice((u+1)*i),(u+2)*i),n=u+1;break}}return e.times=a,e.values=o,n},mergeMorphTargetTracks:function(e,t){for(var n=[],r={},i=e.tracks,a=0;a<i.length;++a){var o=i[a],s=THREE.PropertyBinding.parseTrackName(o.name),l=THREE.PropertyBinding.findNode(t,s.nodeName);if("morphTargetInfluences"===s.propertyName&&void 0!==s.propertyIndex){if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");(o=o.clone()).setInterpolation(THREE.InterpolateLinear)}var u=l.morphTargetInfluences.length,c=l.morphTargetDictionary[s.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+s.propertyIndex);var h=void 0;if(void 0!==r[l.uuid]){var d=o.createInterpolant(new o.ValueBufferType(1));h=r[l.uuid];for(var p=0;p<h.times.length;p++)h.values[p*u+c]=d.evaluate(h.times[p]);for(var f=0;f<o.times.length;f++){var m=this.insertKeyframe(h,o.times[f]);h.values[m*u+c]=o.values[f]}}else{for(var v=new((h=o.clone()).ValueBufferType)(u*h.times.length),g=0;g<h.times.length;g++)v[g*u+c]=h.values[g];h.name=s.nodeName+".morphTargetInfluences",h.values=v,r[l.uuid]=h,n.push(h)}}else n.push(o)}return e.tracks=n,e}}})?n.apply(t,r):n)||(e.exports=i)},149:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[n(735)],void 0===(a="function"==typeof(r=function(e){var t=n(709);e=t(e),THREE.GLTFLoader=function(){function t(e){THREE.Loader.call(this,e),this.commonBinData={},this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new s(e)})),this.register((function(e){return new u(e)})),this.register((function(e){return new c(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new a(e)})),this.register((function(e){return new h(e)}))}function n(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}t.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:t,load:function(e,t,n,r){var i,a=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);var o=function(t){r&&r(t),a.manager.itemError(e),a.manager.itemEnd(e)},s=new THREE.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{a.parse(n,i,(function(n){t(n),a.manager.itemEnd(e)}),o)}catch(e){o(e)}}),n,o)},loadGlb:function(e,t,n,r,i){var a,o=this;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),o.manager.itemStart(e);var s=function(t){i&&i(t),o.manager.itemError(e),o.manager.itemEnd(e)},l=new THREE.FileLoader(o.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),"use-credentials"===o.crossOrigin&&l.setWithCredentials(!0),l.load(e,(function(r){try{o.parseGlb(r,t,a,(function(t){n(t),o.manager.itemEnd(e)}),s)}catch(e){s(e)}}),r,s)},preload:function(e,t,n,r){var i=this;""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),i.manager.itemStart(e);var a=function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)},o=new THREE.FileLoader(i.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),"use-credentials"===i.crossOrigin&&o.setWithCredentials(!0),o.load(e,(function(n){t(n),i.manager.itemError(e),i.manager.itemEnd(e)}),n,a)},loadFileDate:function(e,t,n){var r=this,i=function(e){n&&n(e)};try{r.parse(e,r.resourcePath,(function(e){t(e)}),i)}catch(e){i(e)}},loadNewFileDate:function(e,t,n,r){var i=this,a=function(e){r&&r(e)};try{i.parseGlb(e,t,i.resourcePath,(function(e){n(e)}),a)}catch(e){a(e)}},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,n,a){var s,l={},u={};if("string"==typeof e)s=e;else{var c=THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4));if(c===d||c===p){try{l[r.KHR_BINARY_GLTF]=new v(e)}catch(e){return void(a&&a(e))}s=l[r.KHR_BINARY_GLTF].content}else s=THREE.LoaderUtils.decodeText(new Uint8Array(e))}var h=JSON.parse(s);if(void 0===h.asset||h.asset.version[0]<2)a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var f=new U(h,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});f.fileLoader.setRequestHeader(this.requestHeader);for(var m=0;m<this.pluginCallbacks.length;m++){var x=this.pluginCallbacks[m](f);u[x.name]=x,l[x.name]=!0}if(h.extensionsUsed)for(m=0;m<h.extensionsUsed.length;++m){var w=h.extensionsUsed[m],_=h.extensionsRequired||[];switch(w){case r.KHR_MATERIALS_UNLIT:l[w]=new o;break;case r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:l[w]=new b;break;case r.KHR_DRACO_MESH_COMPRESSION:l[w]=new g(h,this.dracoLoader);break;case r.MSFT_TEXTURE_DDS:l[w]=new i(this.ddsLoader);break;case r.KHR_TEXTURE_TRANSFORM:l[w]=new y;break;case r.KHR_MESH_QUANTIZATION:l[w]=new M;break;default:_.indexOf(w)>=0&&u[w]}}f.setExtensions(l),f.setPlugins(u),f.parse(n,a)}},parseGlb:function(e,t,n,l,u){var c,h=this,f={};if("string"==typeof e)c=e;else{var m=THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4));if(m===d||m===p){try{f[r.KHR_BINARY_GLTF]=new v(e)}catch(e){return void(u&&u(e))}c=f[r.KHR_BINARY_GLTF].content}else c=THREE.LoaderUtils.decodeText(new Uint8Array(e))}var x=JSON.parse(c);if(void 0===x.asset||x.asset.version[0]<2)u&&u(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{if(x.extensionsUsed)for(var w=0;w<x.extensionsUsed.length;++w){var _=x.extensionsUsed[w],A=x.extensionsRequired||[];switch(_){case r.KHR_LIGHTS_PUNCTUAL:f[_]=new a(x);break;case r.KHR_MATERIALS_CLEARCOAT:f[_]=new s;break;case r.KHR_MATERIALS_UNLIT:f[_]=new o;break;case r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:f[_]=new b;break;case r.KHR_DRACO_MESH_COMPRESSION:f[_]=new g(x,this.dracoLoader);break;case r.MSFT_TEXTURE_DDS:f[_]=new i(this.ddsLoader);break;case r.KHR_TEXTURE_TRANSFORM:f[_]=new y;break;case r.KHR_MESH_QUANTIZATION:f[_]=new M;break;default:A.indexOf(_)}}var C=new U(x,f,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});if(C.fileLoader.setRequestHeader(this.requestHeader),0!=t.length){var T=0;x.buffers.forEach((function(e){null!=e.uri&&(e.uri=t[T],e.uri in h.commonBinData||(h.commonBinData[e.uri]=new Promise((function(t,n){C.fileLoader.load(e.uri,t,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.url+'".'))}))}))),C.currentBinData[e.uri]=h.commonBinData[e.uri],T++)}))}C.parse(l,u)}}});var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function i(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=r.MSFT_TEXTURE_DDS,this.ddsLoader=e}function a(e){this.parser=e,this.name=r.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function o(){this.name=r.KHR_MATERIALS_UNLIT}function s(e){this.parser=e,this.name=r.KHR_MATERIALS_CLEARCOAT}function l(e){this.parser=e,this.name=r.KHR_MATERIALS_TRANSMISSION}function u(e){this.parser=e,this.name=r.KHR_TEXTURE_BASISU}function c(e){this.parser=e,this.name=r.EXT_TEXTURE_WEBP,this.isSupported=null}function h(e){this.name=r.EXT_MESHOPT_COMPRESSION,this.parser=e}a.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,r=t.length;n<r;n++){var i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}},a.prototype._loadLight=function(e){var t=this.parser,n="light:"+e,r=t.cache.get(n);if(r)return r;var i,a=t.json,o=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e],s=new THREE.Color(16777215);void 0!==o.color&&s.fromArray(o.color);var l=void 0!==o.range?o.range:0;switch(o.type){case"directional":(i=new THREE.DirectionalLight(s)).target.position.set(0,0,-1),i.add(i.target);break;case"point":(i=new THREE.PointLight(s)).distance=l;break;case"spot":(i=new THREE.SpotLight(s)).distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,i.angle=o.spot.outerConeAngle,i.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+o.type+'".')}return i.position.set(0,0,0),i.decay=2,void 0!==o.intensity&&(i.intensity=o.intensity),i.name=t.createUniqueName(o.name||"light_"+e),r=Promise.resolve(i),t.cache.add(n,r),r},a.prototype.createNodeAttachment=function(e){var t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return n._getNodeRef(t.cache,i,e)}))},o.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial},o.prototype.extendParams=function(e,t,n){var r=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var a=i.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(r)},s.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?THREE.MeshPhysicalMaterial:null},s.prototype.extendMaterialParams=function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],a=r.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&i.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(i.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){var o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new THREE.Vector2(o,o)}return Promise.all(i)},l.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?THREE.MeshPhysicalMaterial:null},l.prototype.extendMaterialParams=function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],a=r.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(i)},u.prototype.loadTexture=function(e){var t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var i=r.extensions[this.name],a=n.images[i.source],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a,o)},c.prototype.loadTexture=function(e){var t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;var a=i.extensions[t],o=r.images[a.source],s=o.uri?n.options.manager.getHandler(o.uri):n.textureLoader;return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,o,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))},c.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported},h.prototype.loadBufferView=function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var r=n.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,a.ready]).then((function(e){var t=r.byteOffset||0,n=r.byteLength||0,i=r.count,o=r.byteStride,s=new ArrayBuffer(i*o),l=new Uint8Array(e[0],t,n);return a.decodeGltfBuffer(new Uint8Array(s),i,o,l,r.mode,r.filter),s}))}return null};var d="glTF",p="glyb",f=12,m={JSON:1313821514,BIN:5130562};function v(e){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,f);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==d&&this.header.magic!==p)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var n=new DataView(e,f),i=0;i<n.byteLength;){var a=n.getUint32(i,!0);i+=4;var o=n.getUint32(i,!0);if(i+=4,o===m.JSON){var s=new Uint8Array(e,f+i,a);this.content=THREE.LoaderUtils.decodeText(s)}else if(o===m.BIN){var l=f+i;this.body=e.slice(l,l+a)}i+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function g(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=r.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function y(){this.name=r.KHR_TEXTURE_TRANSFORM}function x(e){THREE.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(var s in o)e.uniforms[s]=o[s];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function b(){return{name:r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return x},extendParams:function(e,t,n){var r=t.extensions[this.name];e.color=new THREE.Color(1,1,1),e.opacity=1;var i=[];if(Array.isArray(r.diffuseFactor)){var a=r.diffuseFactor;e.color.fromArray(a),e.opacity=a[3]}if(void 0!==r.diffuseTexture&&i.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var o=r.specularGlossinessTexture;i.push(n.assignTexture(e,"glossinessMap",o)),i.push(n.assignTexture(e,"specularMap",o))}return Promise.all(i)},createMaterial:function(e){var t=new x(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=THREE.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function M(){this.name=r.KHR_MESH_QUANTIZATION}function w(e,t,n,r){THREE.Interpolant.call(this,e,t,n,r)}g.prototype.decodePrimitive=function(e,t){var n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(var u in a){var c=E[u]||u.toLowerCase();o[c]=a[u]}for(u in e.attributes)if(c=E[u]||u.toLowerCase(),void 0!==a[u]){var h=n.accessors[e.attributes[u]],d=A[h.componentType];l[c]=d,s[c]=!0===h.normalized}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var n in e.attributes){var r=e.attributes[n],i=s[n];void 0!==i&&(r.normalized=i)}t(e)}),o,l)}))}))},y.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),t.texCoord,e.needsUpdate=!0,e},x.prototype=Object.create(THREE.MeshStandardMaterial.prototype),x.prototype.constructor=x,x.prototype.copy=function(e){return THREE.MeshStandardMaterial.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},w.prototype=Object.create(THREE.Interpolant.prototype),w.prototype.constructor=w,w.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r,a=0;a!==r;a++)t[a]=n[i+a];return t},w.prototype.beforeStart_=w.prototype.copySampleValue_,w.prototype.afterEnd_=w.prototype.copySampleValue_,w.prototype.interpolate_=function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,u=r-t,c=(n-t)/u,h=c*c,d=h*c,p=e*l,f=p-l,m=-2*d+3*h,v=d-h,g=1-m,y=v-h+c,x=0;x!==o;x++){var b=a[f+x+o],M=a[f+x+s]*u,w=a[p+x+o],_=a[p+x]*u;i[x]=g*b+y*M+m*w+v*_}return i};var _={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},A={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},C={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},T={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},S={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},E={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},L={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},P={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},B={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function D(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function k(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),e.DefaultMaterial}function R(e,t,n){for(var r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function O(t,n){void 0!==n.extras&&"object"===(0,e.default)(n.extras)&&Object.assign(t.userData,n.extras)}function I(e,t,n){for(var r=!1,i=!1,a=0,o=t.length;a<o&&(void 0!==(u=t[a]).POSITION&&(r=!0),void 0!==u.NORMAL&&(i=!0),!r||!i);a++);if(!r&&!i)return Promise.resolve(e);var s=[],l=[];for(a=0,o=t.length;a<o;a++){var u=t[a];if(r){var c=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;s.push(c)}i&&(c=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal,l.push(c))}return Promise.all([Promise.all(s),Promise.all(l)]).then((function(t){var n=t[0],a=t[1];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=a),e.morphTargetsRelative=!0,e}))}function F(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length)for(e.morphTargetDictionary={},n=0,r=i.length;n<r;n++)e.morphTargetDictionary[i[n]]=n}}function N(e){var t=e.extensions&&e.extensions[r.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+z(t.attributes):e.indices+":"+z(e.attributes)+":"+e.mode}function z(e){for(var t="",n=Object.keys(e).sort(),r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function U(e,t){this.json=e||{},this.extensions={},this.plugins={},this.options=t||{},this.currentBinData={},this.cache=new n,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new THREE.ImageBitmapLoader(this.options.manager):this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function H(e,t,n){var r=t.attributes,i=new THREE.Box3;if(void 0!==r.POSITION){var a=(d=n.json.accessors[r.POSITION]).min,o=d.max;if(void 0!==a&&void 0!==o){i.set(new THREE.Vector3(a[0],a[1],a[2]),new THREE.Vector3(o[0],o[1],o[2]));var s=t.targets;if(void 0!==s){for(var l=new THREE.Vector3,u=new THREE.Vector3,c=0,h=s.length;c<h;c++){var d,p=s[c];void 0!==p.POSITION&&(a=(d=n.json.accessors[p.POSITION]).min,o=d.max,void 0!==a&&void 0!==o&&(u.setX(Math.max(Math.abs(a[0]),Math.abs(o[0]))),u.setY(Math.max(Math.abs(a[1]),Math.abs(o[1]))),u.setZ(Math.max(Math.abs(a[2]),Math.abs(o[2]))),l.max(u)))}i.expandByVector(l)}e.boundingBox=i;var f=new THREE.Sphere;i.getCenter(f.center),f.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=f}}}function j(e,t,n){var r=t.attributes,i=[];function a(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var o in r){var s=E[o]||o.toLowerCase();s in e.attributes||i.push(a(r[o],s))}if(void 0!==t.indices&&!e.index){var l=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));i.push(l)}return O(e,t),H(e,t,n),Promise.all(i).then((function(){return void 0!==t.targets?I(e,t.targets,n):e}))}function G(e,t){var n=e.getIndex();if(null===n){var r=[],i=e.getAttribute("position");if(void 0===i)return e;for(var a=0;a<i.count;a++)r.push(a);e.setIndex(r),n=e.getIndex()}var o=n.count-2,s=[];if(t===THREE.TriangleFanDrawMode)for(a=1;a<=o;a++)s.push(n.getX(0)),s.push(n.getX(a)),s.push(n.getX(a+1));else for(a=0;a<o;a++)a%2==0?(s.push(n.getX(a)),s.push(n.getX(a+1)),s.push(n.getX(a+2))):(s.push(n.getX(a+2)),s.push(n.getX(a+1)),s.push(n.getX(a)));s.length;var l=e.clone();return l.setIndex(s),l}return U.prototype.setExtensions=function(e){this.extensions=e},U.prototype.setPlugins=function(e){this.plugins=e},U.prototype.parse=function(e,t){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var a={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};R(i,a,r),O(a,r),e(a)})).catch(t)},U.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],r=0,i=t.length;r<i;r++)for(var a=t[r].joints,o=0,s=a.length;o<s;o++)e[a[o]].isBone=!0;for(var l=0,u=e.length;l<u;l++){var c=e[l];void 0!==c.mesh&&(this._addNodeRef(this.meshCache,c.mesh),void 0!==c.skin&&(n[c.mesh].isSkinnedMesh=!0)),void 0!==c.camera&&this._addNodeRef(this.cameraCache,c.camera)}},U.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},U.prototype._getNodeRef=function(e,t,n){if(e.refs[t]<=1)return n;var r=n.clone();return r.name+="_instance_"+e.uses[t]++,r},U.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var r=e(t[n]);if(r)return r}},U.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],r=0;r<t.length;r++){var i=e(t[r]);i&&n.push(i)}return n},U.prototype.getDependency=function(e,t){var n=e+":"+t,r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r},U.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t},U.prototype.loadBuffer=function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);if(t.uri in this.currentBinData)return this.currentBinData[t.uri];var i=this.options;return new Promise((function(e,r){n.load(D(t.uri,i.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},U.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))},U.prototype.loadAccessor=function(e){var t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(e){var i,a,o=e[0],s=S[r.type],l=A[r.componentType],u=l.BYTES_PER_ELEMENT,c=u*s,h=r.byteOffset||0,d=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,p=!0===r.normalized;if(d&&d!==c){var f=Math.floor(h/d),m="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+f+":"+r.count,v=t.cache.get(m);v||(i=new l(o,f*d,r.count*d/u),v=new THREE.InterleavedBuffer(i,d/u),t.cache.add(m,v)),a=new THREE.InterleavedBufferAttribute(v,s,h%d/u,p)}else i=null===o?new l(r.count*s):new l(o,h,r.count*s),a=new THREE.BufferAttribute(i,s,p);if(void 0!==r.sparse){var g=S.SCALAR,y=A[r.sparse.indices.componentType],x=r.sparse.indices.byteOffset||0,b=r.sparse.values.byteOffset||0,M=new y(e[1],x,r.sparse.count*g),w=new l(e[2],b,r.sparse.count*s);null!==o&&(a=new THREE.BufferAttribute(a.array.slice(),a.itemSize,a.normalized));for(var _=0,C=M.length;_<C;_++){var T=M[_];if(a.setX(T,w[_*s]),s>=2&&a.setY(T,w[_*s+1]),s>=3&&a.setZ(T,w[_*s+2]),s>=4&&a.setW(T,w[_*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a}))},U.prototype.loadTexture=function(e){var t,n,i=this,a=this.json,o=this.options,s=a.textures[e],l=s.extensions||{};return(t=l[r.MSFT_TEXTURE_DDS]?a.images[l[r.MSFT_TEXTURE_DDS].source]:a.images[s.source]).uri&&(n=o.manager.getHandler(t.uri)),n||(n=l[r.MSFT_TEXTURE_DDS]?i.extensions[r.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(e,t,n)},U.prototype.loadTextureImage=function(e,t,n){var r=this,i=this.json,a=this.options,o=i.textures[e],s=self.URL||self.webkitURL,l=t.uri,u=!1,c=!0;return"image/jpeg"===t.mimeType&&(c=!1),void 0!==t.bufferView&&(l=r.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){var n=new DataView(e,25,1).getUint8(0,!1);c=6===n||4===n||3===n}u=!0;var r=new Blob([e],{type:t.mimeType});return l=s.createObjectURL(r)}))),Promise.resolve(l).then((function(e){return new Promise((function(t,r){var i=t;!0===n.isImageBitmapLoader&&(i=function(e){t(new THREE.CanvasTexture(e))}),n.load(D(e,a.path),i,void 0,r)}))})).then((function(t){!0===u&&s.revokeObjectURL(l),t.flipY=!1,o.name&&(t.name=o.name),c||(t.format=THREE.RGBFormat);var n=(i.samplers||{})[o.sampler]||{};return t.magFilter=C[n.magFilter]||THREE.LinearFilter,t.minFilter=C[n.minFilter]||THREE.LinearMipmapLinearFilter,t.wrapS=T[n.wrapS]||THREE.RepeatWrapping,t.wrapT=T[n.wrapT]||THREE.RepeatWrapping,r.associations.set(t,{type:"textures",index:e}),t}))},U.prototype.assignTexture=function(e,t,n){var i=this;return this.getDependency("texture",n.index).then((function(a){if(void 0!==n.texCoord&&0!=n.texCoord&&("aoMap"!==t||n.texCoord),i.extensions[r.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[r.KHR_TEXTURE_TRANSFORM]:void 0;if(o){var s=i.associations.get(a);a=i.extensions[r.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),i.associations.set(a,s)}}e[t]=a}))},U.prototype.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,r=void 0!==t.attributes.tangent,i=void 0!==t.attributes.color,a=void 0===t.attributes.normal,o=!0===e.isSkinnedMesh,s=Object.keys(t.morphAttributes).length>0,l=s&&void 0!==t.morphAttributes.normal;if(e.isPoints){var u="PointsMaterial:"+n.uuid,c=this.cache.get(u);c||(c=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(u,c)),n=c}else if(e.isLine){u="LineBasicMaterial:"+n.uuid;var h=this.cache.get(u);h||(h=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(h,n),h.color.copy(n.color),this.cache.add(u,h)),n=h}if(r||i||a||o||s){u="ClonedMaterial:"+n.uuid+":",n.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),o&&(u+="skinning:"),r&&(u+="vertex-tangents:"),i&&(u+="vertex-colors:"),a&&(u+="flat-shading:"),s&&(u+="morph-targets:"),l&&(u+="morph-normals:");var d=this.cache.get(u);d||(d=n.clone(),o&&(d.skinning=!0),r&&(d.vertexTangents=!0),i&&(d.vertexColors=!0),a&&(d.flatShading=!0),s&&(d.morphTargets=!0),l&&(d.morphNormals=!0),this.cache.add(u,d),this.associations.set(d,this.associations.get(n))),n=d}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),n.normalScale&&!r&&(n.normalScale.y=-n.normalScale.y),n.clearcoatNormalScale&&!r&&(n.clearcoatNormalScale.y=-n.clearcoatNormalScale.y),e.material=n},U.prototype.getMaterialType=function(){return THREE.MeshStandardMaterial},U.prototype.loadMaterial=function(e){var t,n=this,i=this.json,a=this.extensions,o=i.materials[e],s={},l=o.extensions||{},u=[];if(l[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var c=a[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=c.getMaterialType(),u.push(c.extendParams(s,o,n))}else if(l[r.KHR_MATERIALS_UNLIT]){var h=a[r.KHR_MATERIALS_UNLIT];t=h.getMaterialType(),u.push(h.extendParams(s,o,n))}else{var d=o.pbrMetallicRoughness||{};if(s.color=new THREE.Color(1,1,1),s.opacity=1,Array.isArray(d.baseColorFactor)){var p=d.baseColorFactor;s.color.fromArray(p),s.opacity=p[3]}void 0!==d.baseColorTexture&&u.push(n.assignTexture(s,"map",d.baseColorTexture)),s.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,s.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(u.push(n.assignTexture(s,"metalnessMap",d.metallicRoughnessTexture)),u.push(n.assignTexture(s,"roughnessMap",d.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),u.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,s)}))))}!0===o.doubleSided&&(s.side=THREE.DoubleSide);var f=o.alphaMode||B.OPAQUE;return f===B.BLEND?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,f===B.MASK&&(s.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&t!==THREE.MeshBasicMaterial&&(u.push(n.assignTexture(s,"normalMap",o.normalTexture)),s.normalScale=new THREE.Vector2(1,1),void 0!==o.normalTexture.scale&&s.normalScale.set(o.normalTexture.scale,o.normalTexture.scale)),void 0!==o.occlusionTexture&&t!==THREE.MeshBasicMaterial&&(u.push(n.assignTexture(s,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(s.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&t!==THREE.MeshBasicMaterial&&(s.emissive=(new THREE.Color).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&t!==THREE.MeshBasicMaterial&&u.push(n.assignTexture(s,"emissiveMap",o.emissiveTexture)),Promise.all(u).then((function(){var i;return i=t===x?a[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new t(s),o.name&&(i.name=o.name),i.map&&(i.map.encoding=THREE.sRGBEncoding),i.emissiveMap&&(i.emissiveMap.encoding=THREE.sRGBEncoding),O(i,o),n.associations.set(i,{type:"materials",index:e}),o.extensions&&R(a,i,o),i}))},U.prototype.createUniqueName=function(e){if(e.indexOf("MCYB_")>-1)return e;var t=THREE.PropertyBinding.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)},U.prototype.loadGeometries=function(e){var t=this,n=this.extensions,i=this.primitiveCache;function a(e){return n[r.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return j(n,e,t)}))}for(var o=[],s=0,l=e.length;s<l;s++){var u,c=e[s],h=N(c),d=i[h];d?o.push(d.promise):(u=c.extensions&&c.extensions[r.KHR_DRACO_MESH_COMPRESSION]?a(c):j(new THREE.BufferGeometry,c,t),i[h]={primitive:c,promise:u},o.push(u))}return Promise.all(o)},U.prototype.loadMesh=function(e){for(var t=this,n=this.json,r=this.extensions,i=n.meshes[e],a=i.primitives,o=[],s=0,l=a.length;s<l;s++){var u=void 0===a[s].material?k(this.cache):this.getDependency("material",a[s].material);o.push(u)}return o.push(t.loadGeometries(a)),Promise.all(o).then((function(n){for(var o=n.slice(0,n.length-1),s=n[n.length-1],l=[],u=0,c=s.length;u<c;u++){var h,d=s[u],p=a[u],f=o[u];if(p.mode===_.TRIANGLES||p.mode===_.TRIANGLE_STRIP||p.mode===_.TRIANGLE_FAN||void 0===p.mode)!0!==(h=!0===i.isSkinnedMesh?new THREE.SkinnedMesh(d,f):new THREE.Mesh(d,f)).isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),p.mode===_.TRIANGLE_STRIP?h.geometry=G(h.geometry,THREE.TriangleStripDrawMode):p.mode===_.TRIANGLE_FAN&&(h.geometry=G(h.geometry,THREE.TriangleFanDrawMode));else if(p.mode===_.LINES)h=new THREE.LineSegments(d,f);else if(p.mode===_.LINE_STRIP)h=new THREE.Line(d,f);else if(p.mode===_.LINE_LOOP)h=new THREE.LineLoop(d,f);else{if(p.mode!==_.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);h=new THREE.Points(d,f)}Object.keys(h.geometry.morphAttributes).length>0&&F(h,i),h.name=t.createUniqueName(i.name||"mesh_"+e),O(h,i),p.extensions&&R(r,h,p),t.assignFinalMaterial(h),l.push(h)}if(1===l.length)return l[0];var m=new THREE.Group;for(u=0,c=l.length;u<c;u++)m.add(l[u]);return m}))},U.prototype.loadCamera=function(e){var t,n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new THREE.OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),O(t,n),Promise.resolve(t)},U.prototype.loadSkin=function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))},U.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],n=[],r=[],i=[],a=[],o=[],s=0,l=t.channels.length;s<l;s++){var u=t.channels[s],c=t.samplers[u.sampler],h=u.target,d=void 0!==h.node?h.node:h.id,p=void 0!==t.parameters?t.parameters[c.input]:c.input,f=void 0!==t.parameters?t.parameters[c.output]:c.output;n.push(this.getDependency("node",d)),r.push(this.getDependency("accessor",p)),i.push(this.getDependency("accessor",f)),a.push(c),o.push(h)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(i),Promise.all(a),Promise.all(o)]).then((function(n){for(var r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],l=[],u=0,c=r.length;u<c;u++){var h=r[u],d=i[u],p=a[u],f=o[u],m=s[u];if(void 0!==h){var v;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,L[m.path]){case L.weights:v=THREE.NumberKeyframeTrack;break;case L.rotation:v=THREE.QuaternionKeyframeTrack;break;case L.position:case L.scale:default:v=THREE.VectorKeyframeTrack}var g=h.name?h.name:h.uuid,y=void 0!==f.interpolation?P[f.interpolation]:THREE.InterpolateLinear,x=[];L[m.path]===L.weights?h.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&x.push(e.name?e.name:e.uuid)})):x.push(g);var b=p.array;if(p.normalized){var M;if(b.constructor===Int8Array)M=1/127;else if(b.constructor===Uint8Array)M=1/255;else if(b.constructor==Int16Array)M=1/32767;else{if(b.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");M=1/65535}for(var _=new Float32Array(b.length),A=0,C=b.length;A<C;A++)_[A]=b[A]*M;b=_}for(A=0,C=x.length;A<C;A++){var T=new v(x[A]+"."+L[m.path],d.array,b,y);"CUBICSPLINE"===f.interpolation&&(T.createInterpolant=function(e){return new w(this.times,this.values,this.getValueSize()/3,e)},T.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(T)}}}var S=t.name?t.name:"animation_"+e;return new THREE.AnimationClip(S,void 0,l)}))},U.prototype.loadNode=function(e){var t,n=this.json,r=this.extensions,i=this,a=n.nodes[e],o=a.name?i.createUniqueName(a.name):"";return(t=[],void 0!==a.mesh&&t.push(i.getDependency("mesh",a.mesh).then((function(e){var t=i._getNodeRef(i.meshCache,a.mesh,e);return void 0!==a.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=a.weights.length;t<n;t++)e.morphTargetInfluences[t]=a.weights[t]})),t}))),void 0!==a.camera&&t.push(i.getDependency("camera",a.camera).then((function(e){return i._getNodeRef(i.cameraCache,a.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)).then((function(t){var n;if((n=!0===a.isBone?new THREE.Bone:t.length>1?new THREE.Group:1===t.length?t[0]:new THREE.Object3D)!==t[0])for(var s=0,l=t.length;s<l;s++)n.add(t[s]);if(a.name&&(n.userData.name=a.name,n.name=o),O(n,a),a.extensions&&R(r,n,a),void 0!==a.matrix){var u=new THREE.Matrix4;u.fromArray(a.matrix),n.applyMatrix4(u)}else void 0!==a.translation&&n.position.fromArray(a.translation),void 0!==a.rotation&&n.quaternion.fromArray(a.rotation),void 0!==a.scale&&n.scale.fromArray(a.scale);return i.associations.set(n,{type:"nodes",index:e}),n}))},U.prototype.loadScene=function(){function e(t,n,r,i){var a=r.nodes[t];return i.getDependency("node",t).then((function(e){return void 0===a.skin?e:i.getDependency("skin",a.skin).then((function(e){for(var n=[],r=0,a=(t=e).joints.length;r<a;r++)n.push(i.getDependency("node",t.joints[r]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var r=[],i=[],a=0,o=n.length;a<o;a++){var s=n[a];if(s){r.push(s);var l=new THREE.Matrix4;void 0!==t.inverseBindMatrices&&l.fromArray(t.inverseBindMatrices.array,16*a),i.push(l)}}e.bind(new THREE.Skeleton(r,i),e.matrixWorld)}})),e}));var t})).then((function(t){n.add(t);var o=[];if(a.children)for(var s=a.children,l=0,u=s.length;l<u;l++){var c=s[l];o.push(e(c,t,r,i))}return Promise.all(o)}))}return function(t){var n=this.json,r=this.extensions,i=this.json.scenes[t],a=this,o=new THREE.Group;i.name&&(o.name=a.createUniqueName(i.name)),O(o,i),i.extensions&&R(r,o,i);for(var s=i.nodes||[],l=[],u=0,c=s.length;u<c;u++)l.push(e(s[u],o,n,a));return Promise.all(l).then((function(){return o}))}}(),t}()})?r.apply(t,i):r)||(e.exports=a)},590:function(e,t){var n,r,i;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,r=[t],void 0===(i="function"==typeof(n=function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Path3D=void 0;var t=function(){this._drawing=!1,this._includeDrawingPoint=!1,this._points=[],this._lastPoint=new THREE.Vector3,this._lastFixedPoint=new THREE.Vector3,this.fixRadius=.5,this.height=.1,this._cornerRadius=.2,this._cornerSplit=10,this._pathPointList=new THREE.PathPointList,this._dirty=!0,this.up=new THREE.Vector3(0,1,0)};e.Path3D=t,Object.defineProperty(t.prototype,"cornerRadius",{set:function(e){this._cornerRadius=e,this._dirty=!0},get:function(){return this._cornerRadius}}),Object.defineProperty(t.prototype,"cornerSplit",{set:function(e){this._cornerSplit=e,this._dirty=!0},get:function(){return this._cornerSplit}}),t.prototype.getPoints=function(){if(this._includeDrawingPoint&&(this._points.pop(),this._includeDrawingPoint=!1),this._drawing&&this._points.length>0){var e=this._getLastFixedPoint();e&&(this._points.push(e),this._includeDrawingPoint=!0)}return this._points},t.prototype.getPathPointList=function(){return(this._drawing||this._dirty)&&(this._pathPointList.set(this.getPoints(),this._cornerRadius,this._cornerSplit,this.up),this._dirty=!1),this._pathPointList},t.prototype.update=function(e){this._lastPoint.copy(e),this._lastPoint.y+=this.height},t.prototype.confirm=function(){this._drawing=!0;var e=this._getLastFixedPoint();e&&(this._includeDrawingPoint&&(this._points.pop(),this._includeDrawingPoint=!1),this._points.push(e.clone())),this._dirty=!0},t.prototype.start=function(){this._drawing=!0,this._dirty=!0},t.prototype.stop=function(){this._drawing=!1,this._dirty=!0},t.prototype.clear=function(){this._drawing=!1,this._includeDrawingPoint=!1,this._points=[],this._dirty=!0};var n=new THREE.Vector3;function r(e,t){return n.copy(t).sub(e).length()}var i=new THREE.Vector3,a=new THREE.Vector3;t.prototype._getLastFixedPoint=function(){if(this._lastFixedPoint.copy(this._lastPoint),this._points.length>0){var e=this._includeDrawingPoint?this._points[this._points.length-2]:this._points[this._points.length-1];if(r(e,this._lastFixedPoint)<this.fixRadius&&(n.normalize().multiplyScalar(this.fixRadius),this._lastFixedPoint.copy(e).add(n)),this._includeDrawingPoint?this._points.length>2:this._points.length>1){var t=this._includeDrawingPoint?this._points[this._points.length-3]:this._points[this._points.length-2];if(i.subVectors(e,t),a.subVectors(this._lastFixedPoint,e),i.normalize(),a.normalize(),i.multiplyScalar(-1).dot(a)>.99)return null}}return this._lastFixedPoint}})?n.apply(t,r):n)||(e.exports=i)},395:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[n(274),n(44),n(994),n(611),n(337)],r=function(e,t,r,i,a){var o,s=n(709);function l(e){var t=u();return function(){var n,r=(0,a.default)(e);if(t){var o=(0,a.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,i.default)(this,n)}}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}e=s(e),t=s(t),r=s(r),i=s(i),a=s(a),(o=function(n){(0,r.default)(a,n);var i=l(a);function a(t,n,r,o){var s;(0,e.default)(this,a),(s=i.call(this)).strength=void 0!==n?n:1,s.radius=r,s.threshold=o,s.resolution=void 0!==t?new THREE.Vector2(t.x,t.y):new THREE.Vector2(256,256),s.clearColor=new THREE.Color(0,0,0);var l={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};s.renderTargetsHorizontal=[],s.renderTargetsVertical=[],s.nMips=5;var u=Math.round(s.resolution.x/2),c=Math.round(s.resolution.y/2);s.renderTargetBright=new THREE.WebGLRenderTarget(u,c,l),s.renderTargetBright.texture.name="UnrealBloomPass.bright",s.renderTargetBright.texture.generateMipmaps=!1;for(var h=0;h<s.nMips;h++){var d=new THREE.WebGLRenderTarget(u,c,l);d.texture.name="UnrealBloomPass.h"+h,d.texture.generateMipmaps=!1,s.renderTargetsHorizontal.push(d);var p=new THREE.WebGLRenderTarget(u,c,l);p.texture.name="UnrealBloomPass.v"+h,p.texture.generateMipmaps=!1,s.renderTargetsVertical.push(p),u=Math.round(u/2),c=Math.round(c/2)}THREE.LuminosityHighPassShader;var f=THREE.LuminosityHighPassShader;s.highPassUniforms=THREE.UniformsUtils.clone(f.uniforms),s.highPassUniforms.luminosityThreshold.value=o,s.highPassUniforms.smoothWidth.value=.01,s.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:s.highPassUniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,defines:{}}),s.separableBlurMaterials=[];var m=[3,5,7,9,11];u=Math.round(s.resolution.x/2),c=Math.round(s.resolution.y/2);for(var v=0;v<s.nMips;v++)s.separableBlurMaterials.push(s.getSeperableBlurMaterial(m[v])),s.separableBlurMaterials[v].uniforms.texSize.value=new THREE.Vector2(u,c),u=Math.round(u/2),c=Math.round(c/2);s.compositeMaterial=s.getCompositeMaterial(s.nMips),s.compositeMaterial.uniforms.blurTexture1.value=s.renderTargetsVertical[0].texture,s.compositeMaterial.uniforms.blurTexture2.value=s.renderTargetsVertical[1].texture,s.compositeMaterial.uniforms.blurTexture3.value=s.renderTargetsVertical[2].texture,s.compositeMaterial.uniforms.blurTexture4.value=s.renderTargetsVertical[3].texture,s.compositeMaterial.uniforms.blurTexture5.value=s.renderTargetsVertical[4].texture,s.compositeMaterial.uniforms.bloomStrength.value=n,s.compositeMaterial.uniforms.bloomRadius.value=.1,s.compositeMaterial.needsUpdate=!0;var g=[1,.8,.6,.4,.2];s.compositeMaterial.uniforms.bloomFactors.value=g,s.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],s.compositeMaterial.uniforms.bloomTintColors.value=s.bloomTintColors,THREE.CopyShader;var y=THREE.CopyShader;return s.copyUniforms=THREE.UniformsUtils.clone(y.uniforms),s.copyUniforms.opacity.value=1,s.materialCopy=new THREE.ShaderMaterial({uniforms:s.copyUniforms,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),s.enabled=!0,s.needsSwap=!1,s.oldClearColor=new THREE.Color,s.oldClearAlpha=1,s.basic=new THREE.MeshBasicMaterial,s.fsQuad=new THREE.Pass.FullScreenQuad(null),s}return(0,t.default)(a,[{key:"dispose",value:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(var t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()}},{key:"setSize",value:function(e,t){var n=Math.round(e/2),r=Math.round(t/2);this.renderTargetBright.setSize(n,r);for(var i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(n,r),this.renderTargetsVertical[i].setSize(n,r),this.separableBlurMaterials[i].uniforms.texSize.value=new THREE.Vector2(n,r),n=Math.round(n/2),r=Math.round(r/2)}},{key:"render",value:function(e,t,n,r,i){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),i&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);for(var s=this.renderTargetBright,l=0;l<this.nMips;l++)this.fsQuad.material=this.separableBlurMaterials[l],this.separableBlurMaterials[l].uniforms.colorTexture.value=s.texture,this.separableBlurMaterials[l].uniforms.direction.value=a.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[l]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[l].uniforms.colorTexture.value=this.renderTargetsHorizontal[l].texture,this.separableBlurMaterials[l].uniforms.direction.value=a.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[l]),e.clear(),this.fsQuad.render(e),s=this.renderTargetsVertical[l];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(n),this.fsQuad.render(e)),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=o}},{key:"getSeperableBlurMaterial",value:function(e){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tfloat alphaSum = 0.0;\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += (sample1.rgb + sample2.rgb) * w;\t\t\t\t\t\talphaSum += (sample1.a + sample2.a) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, alphaSum/weightSum);\n\t\t\t\t}"})}},{key:"getCompositeMaterial",value:function(e){return new THREE.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}]),a}(THREE.Pass)).BlurDirectionX=new THREE.Vector2(1,0),o.BlurDirectionY=new THREE.Vector2(0,1),THREE.UnrealBloomPass=o},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},323:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[n(735)],r=function(o){var s=n(709);o=s(o),function(n,s){"object"===(0,o.default)(t)?s(t):(i=[t],void 0===(a="function"==typeof(r=s)?r.apply(t,i):r)||(e.exports=a))}(0,(function(e){var t=function(){function e(){this.pos=new THREE.Vector3,this.dir=new THREE.Vector3,this.right=new THREE.Vector3,this.up=new THREE.Vector3,this.dist=0,this.widthScale=1,this.sharp=!1}var t=e.prototype;return t.lerpPathPoints=function(e,t,n){this.pos.lerpVectors(e.pos,t.pos,n),this.dir.lerpVectors(e.dir,t.dir,n),this.up.lerpVectors(e.up,t.up,n),this.right.lerpVectors(e.right,t.right,n),this.dist=(t.dist-e.dist)*n+e.dist,this.widthScale=(t.widthScale-e.widthScale)*n+e.widthScale},t.copy=function(e){this.pos.copy(e.pos),this.dir.copy(e.dir),this.up.copy(e.up),this.right.copy(e.right),this.dist=e.dist,this.widthScale=e.widthScale},e}(),n=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Matrix4,o=new THREE.QuadraticBezierCurve3;function s(e,t,i,a,o,s){var l=n.subVectors(t,e),u=r.subVectors(i,t),c=l.length(),h=u.length();l.normalize(),u.normalize();var d=Math.min(.999999*(o?c/2:c),a);s.v0.copy(t).sub(l.multiplyScalar(d)),s.v1.copy(t);var p=Math.min(h/2*.999999,a);return s.v2.copy(t).add(u.multiplyScalar(p)),s}var l=function(){function e(){this.array=[],this.count=0}var l=e.prototype;return l.set=function(e,t,n,r,i){if(void 0===t&&(t=.1),void 0===n&&(n=10),void 0===r&&(r=null),void 0===i&&(i=!1),(e=e.slice(0)).length<2)this.count=0;else{i&&!e[0].equals(e[e.length-1])&&e.push((new THREE.Vector3).copy(e[0]));for(var a=0,o=e.length;a<o;a++)if(0===a)this._start(e[a],e[a+1],r);else if(a===o-1)if(i){this._corner(e[a],e[1],t,n,r);var s=this.array[0].dist;this.array[0].copy(this.array[this.count-1]),this.array[0].dist=s}else this._end(e[a]);else this._corner(e[a],e[a+1],t,n,r)}},l.distance=function(){return this.count>0?this.array[this.count-1].dist:0},l._getByIndex=function(e){return this.array[e]||(this.array[e]=new t),this.array[e]},l._start=function(e,t,n){this.count=0;var r=this._getByIndex(this.count);if(r.pos.copy(e),r.dir.subVectors(t,e),n)r.up.copy(n);else{var i=Number.MAX_VALUE,a=Math.abs(r.dir.x),o=Math.abs(r.dir.y),s=Math.abs(r.dir.z);a<i&&(i=a,r.up.set(1,0,0)),o<i&&(i=o,r.up.set(0,1,0)),s<i&&r.up.set(0,0,1)}r.right.crossVectors(r.dir,r.up).normalize(),r.up.crossVectors(r.right,r.dir).normalize(),r.dist=0,r.widthScale=1,r.sharp=!1,r.dir.normalize(),this.count++},l._end=function(e){var t=this.array[this.count-1],r=this._getByIndex(this.count);r.pos.copy(e),r.dir.subVectors(e,t.pos);var i=r.dir.length();r.dir.normalize(),r.up.copy(t.up);var o=n.crossVectors(t.dir,r.dir);if(o.length()>Number.EPSILON){o.normalize();var s=Math.acos(Math.min(Math.max(t.dir.dot(r.dir),-1),1));r.up.applyMatrix4(a.makeRotationAxis(o,s))}r.right.crossVectors(r.dir,r.up).normalize(),r.dist=t.dist+i,r.widthScale=1,r.sharp=!1,this.count++},l._corner=function(e,t,n,r,i){if(n>0&&r>0){for(var a=s(this.array[this.count-1].pos,e,t,n,this.count-1==0,o).getPoints(r),l=0;l<r;l++)this._sharpCorner(a[l],a[l+1],i,0===l?1:0);a[r].equals(t)||this._sharpCorner(a[r],t,i,2)}else this._sharpCorner(e,t,i,0,!0)},l._sharpCorner=function(e,t,o,s,l){void 0===s&&(s=0),void 0===l&&(l=!1);var u=this.array[this.count-1],c=this._getByIndex(this.count),h=n.subVectors(e,u.pos),d=r.subVectors(t,e),p=h.length();if(h.normalize(),d.normalize(),c.pos.copy(e),1===s?c.dir.copy(h):2===s?c.dir.copy(d):(c.dir.addVectors(h,d),c.dir.normalize()),o)1===c.dir.dot(o)?c.right.crossVectors(d,o).normalize():c.right.crossVectors(c.dir,o).normalize(),c.up.crossVectors(c.right,c.dir).normalize();else{c.up.copy(u.up);var f=i.crossVectors(u.dir,c.dir);if(f.length()>Number.EPSILON){f.normalize();var m=Math.acos(Math.min(Math.max(u.dir.dot(c.dir),-1),1));c.up.applyMatrix4(a.makeRotationAxis(f,m))}c.right.crossVectors(c.dir,c.up).normalize()}c.dist=u.dist+p;var v=h.dot(d);c.widthScale=Math.min(1/Math.sqrt((1+v)/2),1.415)||1,c.sharp=Math.abs(v-1)>.05&&l,this.count++},e}();function u(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}var h=function(e){function t(t,n){var r;return void 0===t&&(t=3e3),void 0===n&&(n=!1),r=e.call(this)||this,isNaN(t)?r._initByData(t.pathPointList,t.options,t.usage,n):r._initByMaxVertex(t,n),r}u(t,e);var n=t.prototype;return n._initByMaxVertex=function(e,t){this.setAttribute("position",new THREE.BufferAttribute(new Float32Array(3*e),3).setUsage(THREE.DynamicDrawUsage)),this.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(3*e),3).setUsage(THREE.DynamicDrawUsage)),this.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(2*e),2).setUsage(THREE.DynamicDrawUsage)),t&&this.setAttribute("uv2",new THREE.BufferAttribute(new Float32Array(2*e),2).setUsage(THREE.DynamicDrawUsage)),this.drawRange.start=0,this.drawRange.count=0,this.setIndex(e>65536?new THREE.Uint32BufferAttribute(3*e,1):new THREE.Uint16BufferAttribute(3*e,1))},n._initByData=function(e,t,n,r){void 0===t&&(t={});var i=d(e,t,r);i&&0!==i.count?(this.setAttribute("position",new THREE.BufferAttribute(new Float32Array(i.position),3).setUsage(n||THREE.StaticDrawUsage)),this.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(i.normal),3).setUsage(n||THREE.StaticDrawUsage)),this.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(i.uv),2).setUsage(n||THREE.StaticDrawUsage)),r&&this.setAttribute("uv2",new THREE.BufferAttribute(new Float32Array(i.uv2),2).setUsage(n||THREE.StaticDrawUsage)),this.setIndex(i.position.length/3>65536?new THREE.Uint32BufferAttribute(i.indices,1):new THREE.Uint16BufferAttribute(i.indices,1))):this._initByMaxVertex(2,r)},n.update=function(e,t){void 0===t&&(t={});var n=!!this.getAttribute("uv2"),r=d(e,t,n);r?(this._updateAttributes(r.position,r.normal,r.uv,n?r.uv2:null,r.indices),this.drawRange.count=r.count):this.drawRange.count=0},n._resizeAttribute=function(e,t){for(var n=this.getAttribute(e);n.array.length<t;){var r=n.array.length,i=new THREE.BufferAttribute(new Float32Array(2*r),n.itemSize,n.normalized);i.name=n.name,i.usage=n.usage,this.setAttribute(e,i),n=i}},n._resizeIndex=function(e){for(var t=this.getIndex();t.array.length<e;){var n=t.array.length,r=new THREE.BufferAttribute(2*n>65535?new Uint32Array(2*n):new Uint16Array(2*n),1);r.name=t.name,r.usage=t.usage,this.setIndex(r),t=r}},n._updateAttributes=function(e,t,n,r,i){this._resizeAttribute("position",e.length);var a=this.getAttribute("position");a.array.set(e,0),a.updateRange.count=e.length,a.needsUpdate=!0,this._resizeAttribute("normal",t.length);var o=this.getAttribute("normal");o.array.set(t,0),o.updateRange.count=t.length,o.needsUpdate=!0,this._resizeAttribute("uv",n.length);var s=this.getAttribute("uv");if(s.array.set(n,0),s.updateRange.count=n.length,s.needsUpdate=!0,r){this._resizeAttribute("uv2",r.length);var l=this.getAttribute("uv2");l.array.set(r,0),l.updateRange.count=r.length,l.needsUpdate=!0}this._resizeIndex(i.length);var u=this.getIndex();u.set(i,0),u.updateRange.count=i.length,u.needsUpdate=!0},t}(THREE.BufferGeometry);function d(e,n,r){void 0===r&&(r=!1);var i=n.width||.1,a=void 0!==n.progress?n.progress:1,o=void 0===n.arrow||n.arrow,s=void 0!==n.side?n.side:"both",l=i/2,u="both"!==s?i/2:i,c=e.distance(),h=a*c;if(0==c)return null;var d=l/u,p=l/c,f=0,m=[],v=[],g=[],y=[],x=[],b=0,M=new THREE.Vector3,w=new THREE.Vector3,_=new THREE.Vector3,A=new THREE.Vector3,C=new THREE.Vector3,T=new THREE.Vector3;function S(e){var t=0===m.length,n=e.sharp&&!t,i=e.dist/c,a=e.dist/c,o=e.dir,u=e.up,h=e.right;if("left"!==s?M.copy(h).multiplyScalar(l*e.widthScale):M.set(0,0,0),"right"!==s?w.copy(h).multiplyScalar(-l*e.widthScale):w.set(0,0,0),M.add(e.pos),w.add(e.pos),n){_.fromArray(m,m.length-6).sub(w),A.fromArray(m,m.length-3).sub(M);var S,E,L=_.length()-A.length();L>0?(S=_,E=w):(S=A,E=M),C.copy(S).setLength(Math.abs(L)).add(E);var P=T.copy(E).sub(C).normalize().dot(o)*T.copy(E).sub(C).length()*2;T.copy(o).setLength(P).add(C),L>0?(m.push(C.x,C.y,C.z,M.x,M.y,M.z,w.x,w.y,w.z,M.x,M.y,M.z,T.x,T.y,T.z,M.x,M.y,M.z),b+=6,x.push(b-6,b-8,b-7,b-6,b-7,b-5,b-4,b-6,b-5,b-2,b-4,b-1),f+=12):(m.push(w.x,w.y,w.z,C.x,C.y,C.z,w.x,w.y,w.z,M.x,M.y,M.z,w.x,w.y,w.z,T.x,T.y,T.z),b+=6,x.push(b-6,b-8,b-7,b-6,b-7,b-5,b-6,b-5,b-3,b-2,b-3,b-1),f+=12),v.push(u.x,u.y,u.z,u.x,u.y,u.z,u.x,u.y,u.z,u.x,u.y,u.z,u.x,u.y,u.z,u.x,u.y,u.z),g.push(i-d,0,i-d,1,i,0,i,1,i+d,0,i+d,1),r&&y.push(a-p,0,a-p,1,a,0,a,1,a+p,0,a+p,1)}else m.push(w.x,w.y,w.z,M.x,M.y,M.z),v.push(u.x,u.y,u.z,u.x,u.y,u.z),g.push(i,0,i,1),r&&y.push(a,0,a,1),b+=2,t||(x.push(b-2,b-4,b-3,b-2,b-3,b-1),f+=6)}var E,L=new THREE.Vector3;function P(e){var t=e.dir,n=e.up,a=e.right,o=e.dist/u,h=e.dist/c;"left"!==s?M.copy(a).multiplyScalar(2*l):M.set(0,0,0),"right"!==s?w.copy(a).multiplyScalar(2*-l):w.set(0,0,0),L.copy(t).setLength(3*l),M.add(e.pos),w.add(e.pos),L.add(e.pos),m.push(w.x,w.y,w.z,M.x,M.y,M.z,L.x,L.y,L.z),v.push(n.x,n.y,n.z,n.x,n.y,n.z,n.x,n.y,n.z),g.push(o,"both"!==s?"right"!==s?-2:0:-.5,o,"both"!==s?"left"!==s?2:0:1.5,o+1.5,"both"!==s?0:.5),r&&y.push(h,"both"!==s?"right"!==s?-2:0:-.5,h,"both"!==s?"left"!==s?2:0:1.5,h+1.5*i/c,"both"!==s?0:.5),b+=3,x.push(b-1,b-3,b-2),f+=3}if(h>0)for(var B=0;B<e.count;B++){var D=e.array[B];if(D.dist>h){var k=e.array[B-1];E=new t;var R=(h-k.dist)/(D.dist-k.dist);E.lerpPathPoints(k,D,R),S(E);break}S(D)}else E=e.array[0];return o&&P(E=E||e.array[e.count-1]),{position:m,normal:v,uv:g,uv2:y,indices:x,count:f}}var p=function(e){function t(t,n){return void 0===t&&(t=1e3),void 0===n&&(n=!1),e.call(this,t,n)||this}u(t,e);var n=t.prototype;return n._initByData=function(e,t,n,r){void 0===t&&(t={});var i=f(e,t,r);i&&0!==i.count?(this.setAttribute("position",new THREE.BufferAttribute(new Float32Array(i.position),3).setUsage(n||THREE.StaticDrawUsage)),this.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(i.normal),3).setUsage(n||THREE.StaticDrawUsage)),this.setAttribute("uv",new THREE.BufferAttribute(new Float32Array(i.uv),2).setUsage(n||THREE.StaticDrawUsage)),r&&this.setAttribute("uv2",new THREE.BufferAttribute(new Float32Array(i.uv2),2).setUsage(n||THREE.StaticDrawUsage)),this.setIndex(i.position.length/3>65536?new THREE.Uint32BufferAttribute(i.indices,1):new THREE.Uint16BufferAttribute(i.indices,1))):this._initByMaxVertex(2,r)},n.update=function(e,t){void 0===t&&(t={});var n=!!this.getAttribute("uv2"),r=f(e,t,n);r?(this._updateAttributes(r.position,r.normal,r.uv,n?r.uv2:null,r.indices),this.drawRange.count=r.count):this.drawRange.count=0},t}(h);function f(e,n,r){void 0===r&&(r=!1);var i=n.radius||.1,a=void 0!==n.progress?n.progress:1,o=Math.max(2,n.radialSegments||8),s=n.startRad||0,l=(Math.PI,e.distance()),u=a*l;if(0==u)return null;var c=0,h=[],d=[],p=[],f=[],m=[],v=0,g=new THREE.Vector3;function y(e,t,n){for(var i=0===h.length,a=e.dist/l,o=e.dist/l,u=0;u<=n;u++){var y=u;y==n&&(y=0),g.copy(e.up).applyAxisAngle(e.dir,s+2*Math.PI*y/n).normalize(),h.push(e.pos.x+g.x*t*e.widthScale,e.pos.y+g.y*t*e.widthScale,e.pos.z+g.z*t*e.widthScale),d.push(g.x,g.y,g.z),p.push(a,u/n),r&&f.push(o,u/n),v++}if(!i)for(var x=v-2*(n+1),b=v-(n+1),M=0;M<n;M++)m.push(b+M,x+M,x+M+1,b+M,x+M+1,b+M+1),c+=6}if(u>0)for(var x=0;x<e.count;x++){var b=e.array[x];if(b.dist>u){var M=e.array[x-1],w=new t,_=(u-M.dist)/(b.dist-M.dist);w.lerpPathPoints(M,b,_),y(w,i,o);break}y(b,i,o)}return{position:h,normal:d,uv:p,uv2:f,indices:m,count:c}}e.PathGeometry=h,e.PathPointList=l,e.PathTubeGeometry=p,Object.defineProperty(e,"__esModule",{value:!0})}))},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},119:function(e){!function(t,n){"object"==(0,y.default)(e.exports)?e.exports=t.document?n(t,!0):function(e){if(!e.document)throw new Error("EZUIPlayer requires a window with a document");return n(e)}:n(t)}("undefined"!=typeof window?window:this,(function(t,n){!function(t,n){function r(){var e=v.elements;return"string"==typeof e?e.split(" "):e}function i(e){var t=m[e[p]];return t||(t={},f++,e[p]=f,m[f]=t),t}function a(e,t,r){return t||(t=n),u?t.createElement(e):(r||(r=i(t)),!(a=r.cache[e]?r.cache[e].cloneNode():d.test(e)?(r.cache[e]=r.createElem(e)).cloneNode():r.createElem(e)).canHaveChildren||h.test(e)||a.tagUrn?a:r.frag.appendChild(a));var a}function o(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return v.shivMethods?a(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+r().join().replace(/[\w\-:]+/g,(function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'}))+");return n}")(v,t.frag)}function s(e){e||(e=n);var t=i(e);return!v.shivCSS||l||t.hasCSS||(t.hasCSS=!!function(e,t){var n=e.createElement("p"),r=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",r.insertBefore(n.lastChild,r.firstChild)}(e,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),u||o(e,t),e}var l,u,c=t.html5||{},h=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,d=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,p="_html5shiv",f=0,m={};!function(){try{var e=n.createElement("a");e.innerHTML="<xyz></xyz>",l="hidden"in e,u=1==e.childNodes.length||function(){n.createElement("a");var e=n.createDocumentFragment();return void 0===e.cloneNode||void 0===e.createDocumentFragment||void 0===e.createElement}()}catch(e){l=!0,u=!0}}();var v={elements:c.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output picture progress section summary template time video",version:"3.7.3",shivCSS:!1!==c.shivCSS,supportsUnknownElements:u,shivMethods:!1!==c.shivMethods,type:"default",shivDocument:s,createElement:a,createDocumentFragment:function(e,t){if(e||(e=n),u)return e.createDocumentFragment();for(var a=(t=t||i(e)).frag.cloneNode(),o=0,s=r(),l=s.length;l>o;o++)a.createElement(s[o]);return a},addElements:function(e,t){var n=v.elements;"string"!=typeof n&&(n=n.join(" ")),"string"!=typeof e&&(e=e.join(" ")),v.elements=n+" "+e,s(t)}};t.html5=v,s(n),e.exports&&(e.exports=v)}(void 0!==t?t:this,document),"document"in self&&("classList"in document.createElement("_")?function(){var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){var n,r=arguments.length;for(n=0;n<r;n++)e=arguments[n],t.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:n.call(this,e)}}e=null}():function(e){if("Element"in e){var t="classList",n="prototype",r=e.Element[n],i=Object,a=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},s=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},l=function(e,t){if(""===t)throw new s("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new s("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(e,t)},u=function(e){for(var t=a.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],r=0,i=n.length;r<i;r++)this.push(n[r]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},c=u[n]=[],h=function(){return new u(this)};if(s[n]=Error[n],c.item=function(e){return this[e]||null},c.contains=function(e){return-1!==l(this,e+="")},c.add=function(){var e,t=arguments,n=0,r=t.length,i=!1;do{-1===l(this,e=t[n]+"")&&(this.push(e),i=!0)}while(++n<r);i&&this._updateClassName()},c.remove=function(){var e,t,n=arguments,r=0,i=n.length,a=!1;do{for(t=l(this,e=n[r]+"");-1!==t;)this.splice(t,1),a=!0,t=l(this,e)}while(++r<i);a&&this._updateClassName()},c.toggle=function(e,t){e+="";var n=this.contains(e),r=n?!0!==t&&"remove":!1!==t&&"add";return r&&this[r](e),!0===t||!1===t?t:!n},c.toString=function(){return this.join(" ")},i.defineProperty){var d={get:h,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,d)}catch(e){-2146823252===e.number&&(d.enumerable=!1,i.defineProperty(r,t,d))}}else i[n].__defineGetter__&&r.__defineGetter__(t,h)}}(self)),Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e};var r="https://open.ys7.com",i=r+"/sdk/js/1.3/ckplayer/ckplayer.js",a=r+"/sdk/js/1.3/ckplayer/ckplayer.swf",o=r+"/sdk/js/1.3/ckplayer/m3u8.swf",s=r+"/sdk/js/1.3/hls.min.js",l="https:"===location.protocol,u=!!navigator.userAgent.match(/(iPhone|iPod|iPad|Android|ios|SymbianOS)/i),c=document.createElement("video"),h=!!c.canPlayType&&!!t.addEventListener,d=h&&c.canPlayType("application/vnd.apple.mpegURL"),p="open_netstream_play_main";function f(e){var t={Ver:"v.1.3.0",PlatAddr:"open.ys7.com",ExterVer:"Ez.1.3.0",CltType:102,StartTime:(new Date).Format("yyyy-MM-dd hh:mm:ss.S"),OS:navigator.platform};for(var n in e)t[n]=e[n];var r=[];for(var i in t)r.push(i+"="+t[i]);var a="?"+r.join("&");(new Image).src="https://log.ys7.com/statistics.do"+a}f({systemName:"open_netstream_localinfo"});var m=/^rtmp/;function v(e,t){var n=document.createElement("script");n.setAttribute("src",e),n.onload=t,document.getElementsByTagName("head")[0].appendChild(n)}var g=function(e){if(!h)throw new Error("不支持ie8等低版本浏览器");if("string"!=typeof e)throw new Error("EZUIPlayer requires parameter videoId");if(this.videoId=e,this.video=document.getElementById(e),!this.video)throw new Error("EZUIPlayer requires parameter videoId");this.opt={},this.opt.sources=[];var n=this.video.getElementsByTagName("source");n=Array.prototype.slice.call(n,0),this.video.src&&(u&&m.test(this.video.src)?(this.video.removeAttribute("src"),this.video.load()):this.opt.sources.push(this.video.src));var r=n.length;if(r>0)for(var i=0;i<r;i++)u&&m.test(n[i].src)?this.video.removeChild(n[i]):this.opt.sources.push(n[i].src);if(this.opt.sources.length<1)throw new Error("no source found in video tag.");this.opt.cur=0,this.handlers={},this.opt.poster=this.video.poster;var a,o=(a=this.video,t.getComputedStyle?t.getComputedStyle(a,null):a.currentStyle),s=this.video.width,l=this.video.height;s?(this.opt.width=s,this.opt.height=l||"auto",this.log("video width:"+this.opt.width+" height:"+this.opt.height)):(this.opt.width=o.width,this.opt.height=o.height,this.log("videoStyle.width:"+o.width+" wideoStyle.height:"+o.height)),this.opt.parentId=e,this.opt.autoplay=!!this.video.autoplay,this.log("autoplay:"+this.video.autoplay),this.tryPlay(),this.initTime=(new Date).getTime(),this.on("play",(function(){f({systemName:p,playurl:this.opt.currentSource,Time:(new Date).Format("yyyy-MM-dd hh:mm:ss.S"),Enc:0,PlTp:1,Via:2,ErrCd:0,Cost:(new Date).getTime()-this.initTime})})),this.retry=2,this.on("error",(function(){f({systemName:p,playurl:this.opt.currentSource,cost:-1,ErrCd:-1})}))};return g.prototype.on=function(e,t){"string"==typeof e&&"function"==typeof t&&(void 0===this.handlers[e]&&(this.handlers[e]=[]),this.handlers[e].push(t))},g.prototype.emit=function(){if(this.handlers[arguments[0]]instanceof Array)for(var e=this.handlers[arguments[0]],t=e.length,n=0;n<t;n++)e[n].apply(this,Array.prototype.slice.call(arguments,1))},g.prototype.tryPlay=function(){if(this.opt.currentSource=this.opt.sources[this.opt.cur],this.opt.currentSource){var e=this;if(/\.m3u8/.test(this.opt.currentSource))u||d?(this.log("使用原生video"),this.video.style.heght=this.opt.height=9*Number(this.opt.width.replace(/px$/g,""))/16+"px",this.initVideoEvent()):l?v(i,(function(){e.initCKPlayer()})):v(s,(function(){Hls.isSupported()?(e.log("使用hls.js"),e.initHLS()):(e.log("2 使用flash"),v(i,(function(){e.initCKPlayer()})))}));else if(/^rtmp:/.test(this.opt.currentSource)){if(u)return this.opt.cur++,void this.tryPlay();v(i,(function(){e.initCKPlayer()}))}}else this.log("未找到合适的播放URL")},g.prototype.initHLS=function(){var e=this,t=new Hls({defaultAudioCodec:"mp4a.40.2"});t.loadSource(this.opt.currentSource),t.attachMedia(this.video),t.on(Hls.Events.MANIFEST_PARSED,(function(){e.opt.autoplay&&e.video.play(),e.initVideoEvent()})),t.on(Hls.Events.ERROR,(function(e,n){if(n.fatal)switch(n.type){case Hls.ErrorTypes.NETWORK_ERROR:t.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:t.recoverMediaError();break;default:t.destroy()}})),this.hls=t},g.prototype.log=function(e){this.emit("log",e)},g.prototype.initCKPlayer=function(){this.log("ckplayer初始化");var e=this,n={play:function(){e.emit("play")},pause:function(){e.emit("pause")},error:function(){e.emit("error")}};t.ckplayer_status=function(){e.log(arguments),n[arguments[0]]&&n[arguments[0]]()},this.videoFlash=document.createElement("DIV"),this.video.parentNode.replaceChild(this.videoFlash,this.video),this.video=this.videoFlash,this.videoFlash.id=this.opt.parentId;var r=null;r=/^rtmp/.test(this.opt.currentSource)?{f:this.opt.currentSource,c:0,p:this.opt.autoplay?1:0,i:this.opt.poster,lv:1,loaded:"loadHandler"}:/\.m3u8/.test(this.opt.currentSource)?{s:4,f:o,a:this.opt.currentSource,c:0,lv:1,p:this.opt.autoplay?1:0,i:this.opt.poster,loaded:"loadHandler"}:{f:this.opt.currentSource,c:0,p:1,loaded:"loadHandler"},this.flashId=this.opt.parentId+"flashId",CKobject.embedSWF(a,this.opt.parentId,this.flashId,this.opt.width,this.opt.height,r,{bgcolor:"#FFF",allowFullScreen:!0,allowScriptAccess:"always",wmode:"transparent"})},g.prototype.initVideoEvent=function(){var e,t,n,r,i=this,a={loadstart:function(e){i.log("loadstart...当浏览器开始查找音频/视频时..."),i.emit("loadstart",e)},durationchange:function(e){i.log("durationchange...当音频/视频的时长已更改时..."),i.emit("durationchange",e)},loadedmetadata:function(e){i.log("loadedmetadata...当浏览器已加载音频/视频的元数据时..."),i.emit("loadedmetadata",e)},loadeddata:function(e){i.log("loadeddata...当浏览器已加载音频/视频的当前帧时..."),i.emit("loadeddata",e)},progress:function(e){i.log("progress...当浏览器正在下载音频/视频时..."),i.emit("progress",e)},canplay:function(e){i.log("canplay...当浏览器可以播放音频/视频时..."),i.emit("canplay",e)},canplaythrough:function(e){i.log("canplaythrough...当浏览器可在不因缓冲而停顿的情况下进行播放时..."),i.emit("canplaythrough",e)},abort:function(e){i.log("abort...当音频/视频的加载已放弃时..."),i.emit("abort",e)},emptied:function(e){i.log("emptied...当目前的播放列表为空时..."),i.emit("emptied",e)},ended:function(e){i.log("ended...当目前的播放列表已结束时..."),i.emit("ended",e)},pause:function(e){i.log("pause...当音频/视频已暂停时..."),i.emit("pause",e)},play:function(e){i.log("play...当音频/视频已开始或不再暂停时..."),i.emit("play",e)},playing:function(e){i.log("playing...当音频/视频在已因缓冲而暂停或停止后已就绪时..."),i.emit("playing",e)},ratechange:function(e){i.log("ratechange...当音频/视频的播放速度已更改时..."),i.emit("ratechange",e)},seeked:function(e){i.log("seeked...当用户已移动/跳跃到音频/视频中的新位置时..."),i.emit("seeked",e)},seeking:function(e){i.log("seeking...当用户开始移动/跳跃到音频/视频中的新位置时..."),i.emit("seeking",e)},stalled:function(e){i.log("stalled...当浏览器尝试获取媒体数据，但数据不可用时..."),i.emit("stalled",e)},suspend:function(e){i.log("suspend...当浏览器刻意不获取媒体数据时..."),i.emit("suspend",e),i.opt.autoplay&&i.video.play()},timeupdate:function(e){i.emit("timeupdate",e)},volumechange:function(e){i.log("volumechange...当音量已更改时..."),i.emit("volumechange",e)},waiting:function(e){i.log("waiting...当视频由于需要缓冲下一帧而停止..."),i.emit("waiting",e)},error:function(e){i.log("error...当在音频/视频加载期间发生错误时..."),i.emit("error",e)}};for(var o in a)this.video.addEventListener(o,a[o],!1);e=this.video,t=!1,n=!1,r=0,e.addEventListener("loadeddata",(function(){t=!0}),!1),e.addEventListener("stalled",(function(){r++,n||r>=2&&!t&&(e.load(),e.play(),t=!1,n=!1,r=0)}),!1),e.addEventListener("playing",(function(){n=!0}))},g.prototype.play=function(){this.opt.autoplay=!0,t.CKobject?CKobject.getObjectById(this.flashId).videoPlay():this.video&&this.video.play()},g.prototype.pause=function(){this.opt.autoplay=!1,t.CKobject?CKobject.getObjectById(this.flashId).videoPause():this.video&&this.video.pause()},g.prototype.load=function(){t.CKobject||this.video&&this.video.load()},n||(t.EZUIPlayer=g),g}))},543:function(e,t,n){var r;e=n.nmd(e),function(){var i,a="Expected a function",o="__lodash_hash_undefined__",s="__lodash_placeholder__",l=16,u=32,c=64,h=128,d=256,p=1/0,f=9007199254740991,m=NaN,v=4294967295,g=[["ary",h],["bind",1],["bindKey",2],["curry",8],["curryRight",l],["flip",512],["partial",u],["partialRight",c],["rearg",d]],x="[object Arguments]",b="[object Array]",M="[object Boolean]",w="[object Date]",_="[object Error]",A="[object Function]",C="[object GeneratorFunction]",T="[object Map]",S="[object Number]",E="[object Object]",L="[object Promise]",P="[object RegExp]",B="[object Set]",D="[object String]",k="[object Symbol]",R="[object WeakMap]",O="[object ArrayBuffer]",I="[object DataView]",F="[object Float32Array]",N="[object Float64Array]",z="[object Int8Array]",U="[object Int16Array]",H="[object Int32Array]",j="[object Uint8Array]",G="[object Uint8ClampedArray]",V="[object Uint16Array]",W="[object Uint32Array]",X=/\b__p \+= '';/g,Y=/\b(__p \+=) '' \+/g,J=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Q=/&(?:amp|lt|gt|quot|#39);/g,q=/[&<>"']/g,K=RegExp(Q.source),Z=RegExp(q.source),$=/<%-([\s\S]+?)%>/g,ee=/<%([\s\S]+?)%>/g,te=/<%=([\s\S]+?)%>/g,ne=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,re=/^\w*$/,ie=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ae=/[\\^$.*+?()[\]{}|]/g,oe=RegExp(ae.source),se=/^\s+/,le=/\s/,ue=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ce=/\{\n\/\* \[wrapped with (.+)\] \*/,he=/,? & /,de=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,pe=/[()=,{}\[\]\/\s]/,fe=/\\(\\)?/g,me=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ve=/\w*$/,ge=/^[-+]0x[0-9a-f]+$/i,ye=/^0b[01]+$/i,xe=/^\[object .+?Constructor\]$/,be=/^0o[0-7]+$/i,Me=/^(?:0|[1-9]\d*)$/,we=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,_e=/($^)/,Ae=/['\n\r\u2028\u2029\\]/g,Ce="\\ud800-\\udfff",Te="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Se="\\u2700-\\u27bf",Ee="a-z\\xdf-\\xf6\\xf8-\\xff",Le="A-Z\\xc0-\\xd6\\xd8-\\xde",Pe="\\ufe0e\\ufe0f",Be="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",De="['’]",ke="["+Ce+"]",Re="["+Be+"]",Oe="["+Te+"]",Ie="\\d+",Fe="["+Se+"]",Ne="["+Ee+"]",ze="[^"+Ce+Be+Ie+Se+Ee+Le+"]",Ue="\\ud83c[\\udffb-\\udfff]",He="[^"+Ce+"]",je="(?:\\ud83c[\\udde6-\\uddff]){2}",Ge="[\\ud800-\\udbff][\\udc00-\\udfff]",Ve="["+Le+"]",We="\\u200d",Xe="(?:"+Ne+"|"+ze+")",Ye="(?:"+Ve+"|"+ze+")",Je="(?:['’](?:d|ll|m|re|s|t|ve))?",Qe="(?:['’](?:D|LL|M|RE|S|T|VE))?",qe="(?:"+Oe+"|"+Ue+")?",Ke="["+Pe+"]?",Ze=Ke+qe+"(?:"+We+"(?:"+[He,je,Ge].join("|")+")"+Ke+qe+")*",$e="(?:"+[Fe,je,Ge].join("|")+")"+Ze,et="(?:"+[He+Oe+"?",Oe,je,Ge,ke].join("|")+")",tt=RegExp(De,"g"),nt=RegExp(Oe,"g"),rt=RegExp(Ue+"(?="+Ue+")|"+et+Ze,"g"),it=RegExp([Ve+"?"+Ne+"+"+Je+"(?="+[Re,Ve,"$"].join("|")+")",Ye+"+"+Qe+"(?="+[Re,Ve+Xe,"$"].join("|")+")",Ve+"?"+Xe+"+"+Je,Ve+"+"+Qe,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ie,$e].join("|"),"g"),at=RegExp("["+We+Ce+Te+Pe+"]"),ot=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,st=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],lt=-1,ut={};ut[F]=ut[N]=ut[z]=ut[U]=ut[H]=ut[j]=ut[G]=ut[V]=ut[W]=!0,ut[x]=ut[b]=ut[O]=ut[M]=ut[I]=ut[w]=ut[_]=ut[A]=ut[T]=ut[S]=ut[E]=ut[P]=ut[B]=ut[D]=ut[R]=!1;var ct={};ct[x]=ct[b]=ct[O]=ct[I]=ct[M]=ct[w]=ct[F]=ct[N]=ct[z]=ct[U]=ct[H]=ct[T]=ct[S]=ct[E]=ct[P]=ct[B]=ct[D]=ct[k]=ct[j]=ct[G]=ct[V]=ct[W]=!0,ct[_]=ct[A]=ct[R]=!1;var ht={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},dt=parseFloat,pt=parseInt,ft="object"==(0,y.default)(n.g)&&n.g&&n.g.Object===Object&&n.g,mt="object"==("undefined"==typeof self?"undefined":(0,y.default)(self))&&self&&self.Object===Object&&self,vt=ft||mt||Function("return this")(),gt=t&&!t.nodeType&&t,yt=gt&&e&&!e.nodeType&&e,xt=yt&&yt.exports===gt,bt=xt&&ft.process,Mt=function(){try{return yt&&yt.require&&yt.require("util").types||bt&&bt.binding&&bt.binding("util")}catch(e){}}(),wt=Mt&&Mt.isArrayBuffer,_t=Mt&&Mt.isDate,At=Mt&&Mt.isMap,Ct=Mt&&Mt.isRegExp,Tt=Mt&&Mt.isSet,St=Mt&&Mt.isTypedArray;function Et(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Lt(e,t,n,r){for(var i=-1,a=null==e?0:e.length;++i<a;){var o=e[i];t(r,o,n(o),e)}return r}function Pt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function Bt(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function Dt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function kt(e,t){for(var n=-1,r=null==e?0:e.length,i=0,a=[];++n<r;){var o=e[n];t(o,n,e)&&(a[i++]=o)}return a}function Rt(e,t){return!(null==e||!e.length)&&Vt(e,t,0)>-1}function Ot(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}function It(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function Ft(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function Nt(e,t,n,r){var i=-1,a=null==e?0:e.length;for(r&&a&&(n=e[++i]);++i<a;)n=t(n,e[i],i,e);return n}function zt(e,t,n,r){var i=null==e?0:e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function Ut(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var Ht=Jt("length");function jt(e,t,n){var r;return n(e,(function(e,n,i){if(t(e,n,i))return r=n,!1})),r}function Gt(e,t,n,r){for(var i=e.length,a=n+(r?1:-1);r?a--:++a<i;)if(t(e[a],a,e))return a;return-1}function Vt(e,t,n){return t==t?function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}(e,t,n):Gt(e,Xt,n)}function Wt(e,t,n,r){for(var i=n-1,a=e.length;++i<a;)if(r(e[i],t))return i;return-1}function Xt(e){return e!=e}function Yt(e,t){var n=null==e?0:e.length;return n?Kt(e,t)/n:m}function Jt(e){return function(t){return null==t?i:t[e]}}function Qt(e){return function(t){return null==e?i:e[t]}}function qt(e,t,n,r,i){return i(e,(function(e,i,a){n=r?(r=!1,e):t(n,e,i,a)})),n}function Kt(e,t){for(var n,r=-1,a=e.length;++r<a;){var o=t(e[r]);o!==i&&(n=n===i?o:n+o)}return n}function Zt(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function $t(e){return e?e.slice(0,gn(e)+1).replace(se,""):e}function en(e){return function(t){return e(t)}}function tn(e,t){return It(t,(function(t){return e[t]}))}function nn(e,t){return e.has(t)}function rn(e,t){for(var n=-1,r=e.length;++n<r&&Vt(t,e[n],0)>-1;);return n}function an(e,t){for(var n=e.length;n--&&Vt(t,e[n],0)>-1;);return n}var on=Qt({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),sn=Qt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function ln(e){return"\\"+ht[e]}function un(e){return at.test(e)}function cn(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function hn(e,t){return function(n){return e(t(n))}}function dn(e,t){for(var n=-1,r=e.length,i=0,a=[];++n<r;){var o=e[n];o!==t&&o!==s||(e[n]=s,a[i++]=n)}return a}function pn(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}function fn(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=[e,e]})),n}function mn(e){return un(e)?function(e){for(var t=rt.lastIndex=0;rt.test(e);)++t;return t}(e):Ht(e)}function vn(e){return un(e)?function(e){return e.match(rt)||[]}(e):function(e){return e.split("")}(e)}function gn(e){for(var t=e.length;t--&&le.test(e.charAt(t)););return t}var yn=Qt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),xn=function e(t){var n,r=(t=null==t?vt:xn.defaults(vt.Object(),t,xn.pick(vt,st))).Array,le=t.Date,Ce=t.Error,Te=t.Function,Se=t.Math,Ee=t.Object,Le=t.RegExp,Pe=t.String,Be=t.TypeError,De=r.prototype,ke=Te.prototype,Re=Ee.prototype,Oe=t["__core-js_shared__"],Ie=ke.toString,Fe=Re.hasOwnProperty,Ne=0,ze=(n=/[^.]+$/.exec(Oe&&Oe.keys&&Oe.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",Ue=Re.toString,He=Ie.call(Ee),je=vt._,Ge=Le("^"+Ie.call(Fe).replace(ae,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ve=xt?t.Buffer:i,We=t.Symbol,Xe=t.Uint8Array,Ye=Ve?Ve.allocUnsafe:i,Je=hn(Ee.getPrototypeOf,Ee),Qe=Ee.create,qe=Re.propertyIsEnumerable,Ke=De.splice,Ze=We?We.isConcatSpreadable:i,$e=We?We.iterator:i,et=We?We.toStringTag:i,rt=function(){try{var e=pa(Ee,"defineProperty");return e({},"",{}),e}catch(e){}}(),at=t.clearTimeout!==vt.clearTimeout&&t.clearTimeout,ht=le&&le.now!==vt.Date.now&&le.now,ft=t.setTimeout!==vt.setTimeout&&t.setTimeout,mt=Se.ceil,gt=Se.floor,yt=Ee.getOwnPropertySymbols,bt=Ve?Ve.isBuffer:i,Mt=t.isFinite,Ht=De.join,Qt=hn(Ee.keys,Ee),bn=Se.max,Mn=Se.min,wn=le.now,_n=t.parseInt,An=Se.random,Cn=De.reverse,Tn=pa(t,"DataView"),Sn=pa(t,"Map"),En=pa(t,"Promise"),Ln=pa(t,"Set"),Pn=pa(t,"WeakMap"),Bn=pa(Ee,"create"),Dn=Pn&&new Pn,kn={},Rn=za(Tn),On=za(Sn),In=za(En),Fn=za(Ln),Nn=za(Pn),zn=We?We.prototype:i,Un=zn?zn.valueOf:i,Hn=zn?zn.toString:i;function jn(e){if(rs(e)&&!Xo(e)&&!(e instanceof Xn)){if(e instanceof Wn)return e;if(Fe.call(e,"__wrapped__"))return Ua(e)}return new Wn(e)}var Gn=function(){function e(){}return function(t){if(!ns(t))return{};if(Qe)return Qe(t);e.prototype=t;var n=new e;return e.prototype=i,n}}();function Vn(){}function Wn(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}function Xn(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=v,this.__views__=[]}function Yn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Jn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Qn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function qn(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Qn;++t<n;)this.add(e[t])}function Kn(e){var t=this.__data__=new Jn(e);this.size=t.size}function Zn(e,t){var n=Xo(e),r=!n&&Wo(e),i=!n&&!r&&qo(e),a=!n&&!r&&!i&&hs(e),o=n||r||i||a,s=o?Zt(e.length,Pe):[],l=s.length;for(var u in e)!t&&!Fe.call(e,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||ba(u,l))||s.push(u);return s}function $n(e){var t=e.length;return t?e[qr(0,t-1)]:i}function er(e,t){return Ia(Bi(e),ur(t,0,e.length))}function tr(e){return Ia(Bi(e))}function nr(e,t,n){(n!==i&&!jo(e[t],n)||n===i&&!(t in e))&&sr(e,t,n)}function rr(e,t,n){var r=e[t];Fe.call(e,t)&&jo(r,n)&&(n!==i||t in e)||sr(e,t,n)}function ir(e,t){for(var n=e.length;n--;)if(jo(e[n][0],t))return n;return-1}function ar(e,t,n,r){return fr(e,(function(e,i,a){t(r,e,n(e),a)})),r}function or(e,t){return e&&Di(t,ks(t),e)}function sr(e,t,n){"__proto__"==t&&rt?rt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function lr(e,t){for(var n=-1,a=t.length,o=r(a),s=null==e;++n<a;)o[n]=s?i:Es(e,t[n]);return o}function ur(e,t,n){return e==e&&(n!==i&&(e=e<=n?e:n),t!==i&&(e=e>=t?e:t)),e}function cr(e,t,n,r,a,o){var s,l=1&t,u=2&t,c=4&t;if(n&&(s=a?n(e,r,a,o):n(e)),s!==i)return s;if(!ns(e))return e;var h=Xo(e);if(h){if(s=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Fe.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!l)return Bi(e,s)}else{var d=va(e),p=d==A||d==C;if(qo(e))return Ci(e,l);if(d==E||d==x||p&&!a){if(s=u||p?{}:ya(e),!l)return u?function(e,t){return Di(e,ma(e),t)}(e,function(e,t){return e&&Di(t,Rs(t),e)}(s,e)):function(e,t){return Di(e,fa(e),t)}(e,or(s,e))}else{if(!ct[d])return a?e:{};s=function(e,t,n){var r,i=e.constructor;switch(t){case O:return Ti(e);case M:case w:return new i(+e);case I:return function(e,t){var n=t?Ti(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case F:case N:case z:case U:case H:case j:case G:case V:case W:return Si(e,n);case T:return new i;case S:case D:return new i(e);case P:return function(e){var t=new e.constructor(e.source,ve.exec(e));return t.lastIndex=e.lastIndex,t}(e);case B:return new i;case k:return r=e,Un?Ee(Un.call(r)):{}}}(e,d,l)}}o||(o=new Kn);var f=o.get(e);if(f)return f;o.set(e,s),ls(e)?e.forEach((function(r){s.add(cr(r,t,n,r,e,o))})):is(e)&&e.forEach((function(r,i){s.set(i,cr(r,t,n,i,e,o))}));var m=h?i:(c?u?oa:aa:u?Rs:ks)(e);return Pt(m||e,(function(r,i){m&&(r=e[i=r]),rr(s,i,cr(r,t,n,i,e,o))})),s}function hr(e,t,n){var r=n.length;if(null==e)return!r;for(e=Ee(e);r--;){var a=n[r],o=t[a],s=e[a];if(s===i&&!(a in e)||!o(s))return!1}return!0}function dr(e,t,n){if("function"!=typeof e)throw new Be(a);return Da((function(){e.apply(i,n)}),t)}function pr(e,t,n,r){var i=-1,a=Rt,o=!0,s=e.length,l=[],u=t.length;if(!s)return l;n&&(t=It(t,en(n))),r?(a=Ot,o=!1):t.length>=200&&(a=nn,o=!1,t=new qn(t));e:for(;++i<s;){var c=e[i],h=null==n?c:n(c);if(c=r||0!==c?c:0,o&&h==h){for(var d=u;d--;)if(t[d]===h)continue e;l.push(c)}else a(t,h,r)||l.push(c)}return l}jn.templateSettings={escape:$,evaluate:ee,interpolate:te,variable:"",imports:{_:jn}},jn.prototype=Vn.prototype,jn.prototype.constructor=jn,Wn.prototype=Gn(Vn.prototype),Wn.prototype.constructor=Wn,Xn.prototype=Gn(Vn.prototype),Xn.prototype.constructor=Xn,Yn.prototype.clear=function(){this.__data__=Bn?Bn(null):{},this.size=0},Yn.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Yn.prototype.get=function(e){var t=this.__data__;if(Bn){var n=t[e];return n===o?i:n}return Fe.call(t,e)?t[e]:i},Yn.prototype.has=function(e){var t=this.__data__;return Bn?t[e]!==i:Fe.call(t,e)},Yn.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Bn&&t===i?o:t,this},Jn.prototype.clear=function(){this.__data__=[],this.size=0},Jn.prototype.delete=function(e){var t=this.__data__,n=ir(t,e);return!(n<0||(n==t.length-1?t.pop():Ke.call(t,n,1),--this.size,0))},Jn.prototype.get=function(e){var t=this.__data__,n=ir(t,e);return n<0?i:t[n][1]},Jn.prototype.has=function(e){return ir(this.__data__,e)>-1},Jn.prototype.set=function(e,t){var n=this.__data__,r=ir(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Qn.prototype.clear=function(){this.size=0,this.__data__={hash:new Yn,map:new(Sn||Jn),string:new Yn}},Qn.prototype.delete=function(e){var t=ha(this,e).delete(e);return this.size-=t?1:0,t},Qn.prototype.get=function(e){return ha(this,e).get(e)},Qn.prototype.has=function(e){return ha(this,e).has(e)},Qn.prototype.set=function(e,t){var n=ha(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},qn.prototype.add=qn.prototype.push=function(e){return this.__data__.set(e,o),this},qn.prototype.has=function(e){return this.__data__.has(e)},Kn.prototype.clear=function(){this.__data__=new Jn,this.size=0},Kn.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Kn.prototype.get=function(e){return this.__data__.get(e)},Kn.prototype.has=function(e){return this.__data__.has(e)},Kn.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Jn){var r=n.__data__;if(!Sn||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Qn(r)}return n.set(e,t),this.size=n.size,this};var fr=Oi(wr),mr=Oi(_r,!0);function vr(e,t){var n=!0;return fr(e,(function(e,r,i){return n=!!t(e,r,i)})),n}function gr(e,t,n){for(var r=-1,a=e.length;++r<a;){var o=e[r],s=t(o);if(null!=s&&(l===i?s==s&&!cs(s):n(s,l)))var l=s,u=o}return u}function yr(e,t){var n=[];return fr(e,(function(e,r,i){t(e,r,i)&&n.push(e)})),n}function xr(e,t,n,r,i){var a=-1,o=e.length;for(n||(n=xa),i||(i=[]);++a<o;){var s=e[a];t>0&&n(s)?t>1?xr(s,t-1,n,r,i):Ft(i,s):r||(i[i.length]=s)}return i}var br=Ii(),Mr=Ii(!0);function wr(e,t){return e&&br(e,t,ks)}function _r(e,t){return e&&Mr(e,t,ks)}function Ar(e,t){return kt(t,(function(t){return $o(e[t])}))}function Cr(e,t){for(var n=0,r=(t=Mi(t,e)).length;null!=e&&n<r;)e=e[Na(t[n++])];return n&&n==r?e:i}function Tr(e,t,n){var r=t(e);return Xo(e)?r:Ft(r,n(e))}function Sr(e){return null==e?e===i?"[object Undefined]":"[object Null]":et&&et in Ee(e)?function(e){var t=Fe.call(e,et),n=e[et];try{e[et]=i;var r=!0}catch(e){}var a=Ue.call(e);return r&&(t?e[et]=n:delete e[et]),a}(e):function(e){return Ue.call(e)}(e)}function Er(e,t){return e>t}function Lr(e,t){return null!=e&&Fe.call(e,t)}function Pr(e,t){return null!=e&&t in Ee(e)}function Br(e,t,n){for(var a=n?Ot:Rt,o=e[0].length,s=e.length,l=s,u=r(s),c=1/0,h=[];l--;){var d=e[l];l&&t&&(d=It(d,en(t))),c=Mn(d.length,c),u[l]=!n&&(t||o>=120&&d.length>=120)?new qn(l&&d):i}d=e[0];var p=-1,f=u[0];e:for(;++p<o&&h.length<c;){var m=d[p],v=t?t(m):m;if(m=n||0!==m?m:0,!(f?nn(f,v):a(h,v,n))){for(l=s;--l;){var g=u[l];if(!(g?nn(g,v):a(e[l],v,n)))continue e}f&&f.push(v),h.push(m)}}return h}function Dr(e,t,n){var r=null==(e=La(e,t=Mi(t,e)))?e:e[Na(Ka(t))];return null==r?i:Et(r,e,n)}function kr(e){return rs(e)&&Sr(e)==x}function Rr(e,t,n,r,a){return e===t||(null==e||null==t||!rs(e)&&!rs(t)?e!=e&&t!=t:function(e,t,n,r,a,o){var s=Xo(e),l=Xo(t),u=s?b:va(e),c=l?b:va(t),h=(u=u==x?E:u)==E,d=(c=c==x?E:c)==E,p=u==c;if(p&&qo(e)){if(!qo(t))return!1;s=!0,h=!1}if(p&&!h)return o||(o=new Kn),s||hs(e)?ra(e,t,n,r,a,o):function(e,t,n,r,i,a,o){switch(n){case I:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case O:return!(e.byteLength!=t.byteLength||!a(new Xe(e),new Xe(t)));case M:case w:case S:return jo(+e,+t);case _:return e.name==t.name&&e.message==t.message;case P:case D:return e==t+"";case T:var s=cn;case B:var l=1&r;if(s||(s=pn),e.size!=t.size&&!l)return!1;var u=o.get(e);if(u)return u==t;r|=2,o.set(e,t);var c=ra(s(e),s(t),r,i,a,o);return o.delete(e),c;case k:if(Un)return Un.call(e)==Un.call(t)}return!1}(e,t,u,n,r,a,o);if(!(1&n)){var f=h&&Fe.call(e,"__wrapped__"),m=d&&Fe.call(t,"__wrapped__");if(f||m){var v=f?e.value():e,g=m?t.value():t;return o||(o=new Kn),a(v,g,n,r,o)}}return!!p&&(o||(o=new Kn),function(e,t,n,r,a,o){var s=1&n,l=aa(e),u=l.length;if(u!=aa(t).length&&!s)return!1;for(var c=u;c--;){var h=l[c];if(!(s?h in t:Fe.call(t,h)))return!1}var d=o.get(e),p=o.get(t);if(d&&p)return d==t&&p==e;var f=!0;o.set(e,t),o.set(t,e);for(var m=s;++c<u;){var v=e[h=l[c]],g=t[h];if(r)var y=s?r(g,v,h,t,e,o):r(v,g,h,e,t,o);if(!(y===i?v===g||a(v,g,n,r,o):y)){f=!1;break}m||(m="constructor"==h)}if(f&&!m){var x=e.constructor,b=t.constructor;x==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof x&&x instanceof x&&"function"==typeof b&&b instanceof b||(f=!1)}return o.delete(e),o.delete(t),f}(e,t,n,r,a,o))}(e,t,n,r,Rr,a))}function Or(e,t,n,r){var a=n.length,o=a,s=!r;if(null==e)return!o;for(e=Ee(e);a--;){var l=n[a];if(s&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++a<o;){var u=(l=n[a])[0],c=e[u],h=l[1];if(s&&l[2]){if(c===i&&!(u in e))return!1}else{var d=new Kn;if(r)var p=r(c,h,u,e,t,d);if(!(p===i?Rr(h,c,3,r,d):p))return!1}}return!0}function Ir(e){return!(!ns(e)||(t=e,ze&&ze in t))&&($o(e)?Ge:xe).test(za(e));var t}function Fr(e){return"function"==typeof e?e:null==e?al:"object"==(0,y.default)(e)?Xo(e)?Gr(e[0],e[1]):jr(e):fl(e)}function Nr(e){if(!Ca(e))return Qt(e);var t=[];for(var n in Ee(e))Fe.call(e,n)&&"constructor"!=n&&t.push(n);return t}function zr(e){if(!ns(e))return function(e){var t=[];if(null!=e)for(var n in Ee(e))t.push(n);return t}(e);var t=Ca(e),n=[];for(var r in e)("constructor"!=r||!t&&Fe.call(e,r))&&n.push(r);return n}function Ur(e,t){return e<t}function Hr(e,t){var n=-1,i=Jo(e)?r(e.length):[];return fr(e,(function(e,r,a){i[++n]=t(e,r,a)})),i}function jr(e){var t=da(e);return 1==t.length&&t[0][2]?Sa(t[0][0],t[0][1]):function(n){return n===e||Or(n,e,t)}}function Gr(e,t){return wa(e)&&Ta(t)?Sa(Na(e),t):function(n){var r=Es(n,e);return r===i&&r===t?Ls(n,e):Rr(t,r,3)}}function Vr(e,t,n,r,a){e!==t&&br(t,(function(o,s){if(a||(a=new Kn),ns(o))!function(e,t,n,r,a,o,s){var l=Pa(e,n),u=Pa(t,n),c=s.get(u);if(c)nr(e,n,c);else{var h=o?o(l,u,n+"",e,t,s):i,d=h===i;if(d){var p=Xo(u),f=!p&&qo(u),m=!p&&!f&&hs(u);h=u,p||f||m?Xo(l)?h=l:Qo(l)?h=Bi(l):f?(d=!1,h=Ci(u,!0)):m?(d=!1,h=Si(u,!0)):h=[]:os(u)||Wo(u)?(h=l,Wo(l)?h=xs(l):ns(l)&&!$o(l)||(h=ya(u))):d=!1}d&&(s.set(u,h),a(h,u,r,o,s),s.delete(u)),nr(e,n,h)}}(e,t,s,n,Vr,r,a);else{var l=r?r(Pa(e,s),o,s+"",e,t,a):i;l===i&&(l=o),nr(e,s,l)}}),Rs)}function Wr(e,t){var n=e.length;if(n)return ba(t+=t<0?n:0,n)?e[t]:i}function Xr(e,t,n){t=t.length?It(t,(function(e){return Xo(e)?function(t){return Cr(t,1===e.length?e[0]:e)}:e})):[al];var r=-1;t=It(t,en(ca()));var i=Hr(e,(function(e,n,i){var a=It(t,(function(t){return t(e)}));return{criteria:a,index:++r,value:e}}));return function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(i,(function(e,t){return function(e,t,n){for(var r=-1,i=e.criteria,a=t.criteria,o=i.length,s=n.length;++r<o;){var l=Ei(i[r],a[r]);if(l)return r>=s?l:l*("desc"==n[r]?-1:1)}return e.index-t.index}(e,t,n)}))}function Yr(e,t,n){for(var r=-1,i=t.length,a={};++r<i;){var o=t[r],s=Cr(e,o);n(s,o)&&ti(a,Mi(o,e),s)}return a}function Jr(e,t,n,r){var i=r?Wt:Vt,a=-1,o=t.length,s=e;for(e===t&&(t=Bi(t)),n&&(s=It(e,en(n)));++a<o;)for(var l=0,u=t[a],c=n?n(u):u;(l=i(s,c,l,r))>-1;)s!==e&&Ke.call(s,l,1),Ke.call(e,l,1);return e}function Qr(e,t){for(var n=e?t.length:0,r=n-1;n--;){var i=t[n];if(n==r||i!==a){var a=i;ba(i)?Ke.call(e,i,1):pi(e,i)}}return e}function qr(e,t){return e+gt(An()*(t-e+1))}function Kr(e,t){var n="";if(!e||t<1||t>f)return n;do{t%2&&(n+=e),(t=gt(t/2))&&(e+=e)}while(t);return n}function Zr(e,t){return ka(Ea(e,t,al),e+"")}function $r(e){return $n(js(e))}function ei(e,t){var n=js(e);return Ia(n,ur(t,0,n.length))}function ti(e,t,n,r){if(!ns(e))return e;for(var a=-1,o=(t=Mi(t,e)).length,s=o-1,l=e;null!=l&&++a<o;){var u=Na(t[a]),c=n;if("__proto__"===u||"constructor"===u||"prototype"===u)return e;if(a!=s){var h=l[u];(c=r?r(h,u,l):i)===i&&(c=ns(h)?h:ba(t[a+1])?[]:{})}rr(l,u,c),l=l[u]}return e}var ni=Dn?function(e,t){return Dn.set(e,t),e}:al,ri=rt?function(e,t){return rt(e,"toString",{configurable:!0,enumerable:!1,value:nl(t),writable:!0})}:al;function ii(e){return Ia(js(e))}function ai(e,t,n){var i=-1,a=e.length;t<0&&(t=-t>a?0:a+t),(n=n>a?a:n)<0&&(n+=a),a=t>n?0:n-t>>>0,t>>>=0;for(var o=r(a);++i<a;)o[i]=e[i+t];return o}function oi(e,t){var n;return fr(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n}function si(e,t,n){var r=0,i=null==e?r:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;r<i;){var a=r+i>>>1,o=e[a];null!==o&&!cs(o)&&(n?o<=t:o<t)?r=a+1:i=a}return i}return li(e,t,al,n)}function li(e,t,n,r){var a=0,o=null==e?0:e.length;if(0===o)return 0;for(var s=(t=n(t))!=t,l=null===t,u=cs(t),c=t===i;a<o;){var h=gt((a+o)/2),d=n(e[h]),p=d!==i,f=null===d,m=d==d,v=cs(d);if(s)var g=r||m;else g=c?m&&(r||p):l?m&&p&&(r||!f):u?m&&p&&!f&&(r||!v):!f&&!v&&(r?d<=t:d<t);g?a=h+1:o=h}return Mn(o,4294967294)}function ui(e,t){for(var n=-1,r=e.length,i=0,a=[];++n<r;){var o=e[n],s=t?t(o):o;if(!n||!jo(s,l)){var l=s;a[i++]=0===o?0:o}}return a}function ci(e){return"number"==typeof e?e:cs(e)?m:+e}function hi(e){if("string"==typeof e)return e;if(Xo(e))return It(e,hi)+"";if(cs(e))return Hn?Hn.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function di(e,t,n){var r=-1,i=Rt,a=e.length,o=!0,s=[],l=s;if(n)o=!1,i=Ot;else if(a>=200){var u=t?null:Ki(e);if(u)return pn(u);o=!1,i=nn,l=new qn}else l=t?[]:s;e:for(;++r<a;){var c=e[r],h=t?t(c):c;if(c=n||0!==c?c:0,o&&h==h){for(var d=l.length;d--;)if(l[d]===h)continue e;t&&l.push(h),s.push(c)}else i(l,h,n)||(l!==s&&l.push(h),s.push(c))}return s}function pi(e,t){return null==(e=La(e,t=Mi(t,e)))||delete e[Na(Ka(t))]}function fi(e,t,n,r){return ti(e,t,n(Cr(e,t)),r)}function mi(e,t,n,r){for(var i=e.length,a=r?i:-1;(r?a--:++a<i)&&t(e[a],a,e););return n?ai(e,r?0:a,r?a+1:i):ai(e,r?a+1:0,r?i:a)}function vi(e,t){var n=e;return n instanceof Xn&&(n=n.value()),Nt(t,(function(e,t){return t.func.apply(t.thisArg,Ft([e],t.args))}),n)}function gi(e,t,n){var i=e.length;if(i<2)return i?di(e[0]):[];for(var a=-1,o=r(i);++a<i;)for(var s=e[a],l=-1;++l<i;)l!=a&&(o[a]=pr(o[a]||s,e[l],t,n));return di(xr(o,1),t,n)}function yi(e,t,n){for(var r=-1,a=e.length,o=t.length,s={};++r<a;){var l=r<o?t[r]:i;n(s,e[r],l)}return s}function xi(e){return Qo(e)?e:[]}function bi(e){return"function"==typeof e?e:al}function Mi(e,t){return Xo(e)?e:wa(e,t)?[e]:Fa(bs(e))}var wi=Zr;function _i(e,t,n){var r=e.length;return n=n===i?r:n,!t&&n>=r?e:ai(e,t,n)}var Ai=at||function(e){return vt.clearTimeout(e)};function Ci(e,t){if(t)return e.slice();var n=e.length,r=Ye?Ye(n):new e.constructor(n);return e.copy(r),r}function Ti(e){var t=new e.constructor(e.byteLength);return new Xe(t).set(new Xe(e)),t}function Si(e,t){var n=t?Ti(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Ei(e,t){if(e!==t){var n=e!==i,r=null===e,a=e==e,o=cs(e),s=t!==i,l=null===t,u=t==t,c=cs(t);if(!l&&!c&&!o&&e>t||o&&s&&u&&!l&&!c||r&&s&&u||!n&&u||!a)return 1;if(!r&&!o&&!c&&e<t||c&&n&&a&&!r&&!o||l&&n&&a||!s&&a||!u)return-1}return 0}function Li(e,t,n,i){for(var a=-1,o=e.length,s=n.length,l=-1,u=t.length,c=bn(o-s,0),h=r(u+c),d=!i;++l<u;)h[l]=t[l];for(;++a<s;)(d||a<o)&&(h[n[a]]=e[a]);for(;c--;)h[l++]=e[a++];return h}function Pi(e,t,n,i){for(var a=-1,o=e.length,s=-1,l=n.length,u=-1,c=t.length,h=bn(o-l,0),d=r(h+c),p=!i;++a<h;)d[a]=e[a];for(var f=a;++u<c;)d[f+u]=t[u];for(;++s<l;)(p||a<o)&&(d[f+n[s]]=e[a++]);return d}function Bi(e,t){var n=-1,i=e.length;for(t||(t=r(i));++n<i;)t[n]=e[n];return t}function Di(e,t,n,r){var a=!n;n||(n={});for(var o=-1,s=t.length;++o<s;){var l=t[o],u=r?r(n[l],e[l],l,n,e):i;u===i&&(u=e[l]),a?sr(n,l,u):rr(n,l,u)}return n}function ki(e,t){return function(n,r){var i=Xo(n)?Lt:ar,a=t?t():{};return i(n,e,ca(r,2),a)}}function Ri(e){return Zr((function(t,n){var r=-1,a=n.length,o=a>1?n[a-1]:i,s=a>2?n[2]:i;for(o=e.length>3&&"function"==typeof o?(a--,o):i,s&&Ma(n[0],n[1],s)&&(o=a<3?i:o,a=1),t=Ee(t);++r<a;){var l=n[r];l&&e(t,l,r,o)}return t}))}function Oi(e,t){return function(n,r){if(null==n)return n;if(!Jo(n))return e(n,r);for(var i=n.length,a=t?i:-1,o=Ee(n);(t?a--:++a<i)&&!1!==r(o[a],a,o););return n}}function Ii(e){return function(t,n,r){for(var i=-1,a=Ee(t),o=r(t),s=o.length;s--;){var l=o[e?s:++i];if(!1===n(a[l],l,a))break}return t}}function Fi(e){return function(t){var n=un(t=bs(t))?vn(t):i,r=n?n[0]:t.charAt(0),a=n?_i(n,1).join(""):t.slice(1);return r[e]()+a}}function Ni(e){return function(t){return Nt($s(Ws(t).replace(tt,"")),e,"")}}function zi(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Gn(e.prototype),r=e.apply(n,t);return ns(r)?r:n}}function Ui(e){return function(t,n,r){var a=Ee(t);if(!Jo(t)){var o=ca(n,3);t=ks(t),n=function(e){return o(a[e],e,a)}}var s=e(t,n,r);return s>-1?a[o?t[s]:s]:i}}function Hi(e){return ia((function(t){var n=t.length,r=n,o=Wn.prototype.thru;for(e&&t.reverse();r--;){var s=t[r];if("function"!=typeof s)throw new Be(a);if(o&&!l&&"wrapper"==la(s))var l=new Wn([],!0)}for(r=l?r:n;++r<n;){var u=la(s=t[r]),c="wrapper"==u?sa(s):i;l=c&&_a(c[0])&&424==c[1]&&!c[4].length&&1==c[9]?l[la(c[0])].apply(l,c[3]):1==s.length&&_a(s)?l[u]():l.thru(s)}return function(){var e=arguments,r=e[0];if(l&&1==e.length&&Xo(r))return l.plant(r).value();for(var i=0,a=n?t[i].apply(this,e):r;++i<n;)a=t[i].call(this,a);return a}}))}function ji(e,t,n,a,o,s,l,u,c,d){var p=t&h,f=1&t,m=2&t,v=24&t,g=512&t,y=m?i:zi(e);return function h(){for(var x=arguments.length,b=r(x),M=x;M--;)b[M]=arguments[M];if(v)var w=ua(h),_=function(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}(b,w);if(a&&(b=Li(b,a,o,v)),s&&(b=Pi(b,s,l,v)),x-=_,v&&x<d){var A=dn(b,w);return Qi(e,t,ji,h.placeholder,n,b,A,u,c,d-x)}var C=f?n:this,T=m?C[e]:e;return x=b.length,u?b=function(e,t){for(var n=e.length,r=Mn(t.length,n),a=Bi(e);r--;){var o=t[r];e[r]=ba(o,n)?a[o]:i}return e}(b,u):g&&x>1&&b.reverse(),p&&c<x&&(b.length=c),this&&this!==vt&&this instanceof h&&(T=y||zi(T)),T.apply(C,b)}}function Gi(e,t){return function(n,r){return function(e,t,n,r){return wr(e,(function(e,i,a){t(r,n(e),i,a)})),r}(n,e,t(r),{})}}function Vi(e,t){return function(n,r){var a;if(n===i&&r===i)return t;if(n!==i&&(a=n),r!==i){if(a===i)return r;"string"==typeof n||"string"==typeof r?(n=hi(n),r=hi(r)):(n=ci(n),r=ci(r)),a=e(n,r)}return a}}function Wi(e){return ia((function(t){return t=It(t,en(ca())),Zr((function(n){var r=this;return e(t,(function(e){return Et(e,r,n)}))}))}))}function Xi(e,t){var n=(t=t===i?" ":hi(t)).length;if(n<2)return n?Kr(t,e):t;var r=Kr(t,mt(e/mn(t)));return un(t)?_i(vn(r),0,e).join(""):r.slice(0,e)}function Yi(e){return function(t,n,a){return a&&"number"!=typeof a&&Ma(t,n,a)&&(n=a=i),t=ms(t),n===i?(n=t,t=0):n=ms(n),function(e,t,n,i){for(var a=-1,o=bn(mt((t-e)/(n||1)),0),s=r(o);o--;)s[i?o:++a]=e,e+=n;return s}(t,n,a=a===i?t<n?1:-1:ms(a),e)}}function Ji(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=ys(t),n=ys(n)),e(t,n)}}function Qi(e,t,n,r,a,o,s,l,h,d){var p=8&t;t|=p?u:c,4&(t&=~(p?c:u))||(t&=-4);var f=[e,t,a,p?o:i,p?s:i,p?i:o,p?i:s,l,h,d],m=n.apply(i,f);return _a(e)&&Ba(m,f),m.placeholder=r,Ra(m,e,t)}function qi(e){var t=Se[e];return function(e,n){if(e=ys(e),(n=null==n?0:Mn(vs(n),292))&&Mt(e)){var r=(bs(e)+"e").split("e");return+((r=(bs(t(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}var Ki=Ln&&1/pn(new Ln([,-0]))[1]==p?function(e){return new Ln(e)}:cl;function Zi(e){return function(t){var n=va(t);return n==T?cn(t):n==B?fn(t):function(e,t){return It(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function $i(e,t,n,o,p,f,m,v){var g=2&t;if(!g&&"function"!=typeof e)throw new Be(a);var y=o?o.length:0;if(y||(t&=-97,o=p=i),m=m===i?m:bn(vs(m),0),v=v===i?v:vs(v),y-=p?p.length:0,t&c){var x=o,b=p;o=p=i}var M=g?i:sa(e),w=[e,t,n,o,p,x,b,f,m,v];if(M&&function(e,t){var n=e[1],r=t[1],i=n|r,a=i<131,o=r==h&&8==n||r==h&&n==d&&e[7].length<=t[8]||384==r&&t[7].length<=t[8]&&8==n;if(!a&&!o)return e;1&r&&(e[2]=t[2],i|=1&n?0:4);var l=t[3];if(l){var u=e[3];e[3]=u?Li(u,l,t[4]):l,e[4]=u?dn(e[3],s):t[4]}(l=t[5])&&(u=e[5],e[5]=u?Pi(u,l,t[6]):l,e[6]=u?dn(e[5],s):t[6]),(l=t[7])&&(e[7]=l),r&h&&(e[8]=null==e[8]?t[8]:Mn(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i}(w,M),e=w[0],t=w[1],n=w[2],o=w[3],p=w[4],!(v=w[9]=w[9]===i?g?0:e.length:bn(w[9]-y,0))&&24&t&&(t&=-25),t&&1!=t)_=8==t||t==l?function(e,t,n){var a=zi(e);return function o(){for(var s=arguments.length,l=r(s),u=s,c=ua(o);u--;)l[u]=arguments[u];var h=s<3&&l[0]!==c&&l[s-1]!==c?[]:dn(l,c);return(s-=h.length)<n?Qi(e,t,ji,o.placeholder,i,l,h,i,i,n-s):Et(this&&this!==vt&&this instanceof o?a:e,this,l)}}(e,t,v):t!=u&&33!=t||p.length?ji.apply(i,w):function(e,t,n,i){var a=1&t,o=zi(e);return function t(){for(var s=-1,l=arguments.length,u=-1,c=i.length,h=r(c+l),d=this&&this!==vt&&this instanceof t?o:e;++u<c;)h[u]=i[u];for(;l--;)h[u++]=arguments[++s];return Et(d,a?n:this,h)}}(e,t,n,o);else var _=function(e,t,n){var r=1&t,i=zi(e);return function t(){return(this&&this!==vt&&this instanceof t?i:e).apply(r?n:this,arguments)}}(e,t,n);return Ra((M?ni:Ba)(_,w),e,t)}function ea(e,t,n,r){return e===i||jo(e,Re[n])&&!Fe.call(r,n)?t:e}function ta(e,t,n,r,a,o){return ns(e)&&ns(t)&&(o.set(t,e),Vr(e,t,i,ta,o),o.delete(t)),e}function na(e){return os(e)?i:e}function ra(e,t,n,r,a,o){var s=1&n,l=e.length,u=t.length;if(l!=u&&!(s&&u>l))return!1;var c=o.get(e),h=o.get(t);if(c&&h)return c==t&&h==e;var d=-1,p=!0,f=2&n?new qn:i;for(o.set(e,t),o.set(t,e);++d<l;){var m=e[d],v=t[d];if(r)var g=s?r(v,m,d,t,e,o):r(m,v,d,e,t,o);if(g!==i){if(g)continue;p=!1;break}if(f){if(!Ut(t,(function(e,t){if(!nn(f,t)&&(m===e||a(m,e,n,r,o)))return f.push(t)}))){p=!1;break}}else if(m!==v&&!a(m,v,n,r,o)){p=!1;break}}return o.delete(e),o.delete(t),p}function ia(e){return ka(Ea(e,i,Xa),e+"")}function aa(e){return Tr(e,ks,fa)}function oa(e){return Tr(e,Rs,ma)}var sa=Dn?function(e){return Dn.get(e)}:cl;function la(e){for(var t=e.name+"",n=kn[t],r=Fe.call(kn,t)?n.length:0;r--;){var i=n[r],a=i.func;if(null==a||a==e)return i.name}return t}function ua(e){return(Fe.call(jn,"placeholder")?jn:e).placeholder}function ca(){var e=jn.iteratee||ol;return e=e===ol?Fr:e,arguments.length?e(arguments[0],arguments[1]):e}function ha(e,t){var n,r,i=e.__data__;return("string"==(r=(0,y.default)(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function da(e){for(var t=ks(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Ta(i)]}return t}function pa(e,t){var n=function(e,t){return null==e?i:e[t]}(e,t);return Ir(n)?n:i}var fa=yt?function(e){return null==e?[]:(e=Ee(e),kt(yt(e),(function(t){return qe.call(e,t)})))}:gl,ma=yt?function(e){for(var t=[];e;)Ft(t,fa(e)),e=Je(e);return t}:gl,va=Sr;function ga(e,t,n){for(var r=-1,i=(t=Mi(t,e)).length,a=!1;++r<i;){var o=Na(t[r]);if(!(a=null!=e&&n(e,o)))break;e=e[o]}return a||++r!=i?a:!!(i=null==e?0:e.length)&&ts(i)&&ba(o,i)&&(Xo(e)||Wo(e))}function ya(e){return"function"!=typeof e.constructor||Ca(e)?{}:Gn(Je(e))}function xa(e){return Xo(e)||Wo(e)||!!(Ze&&e&&e[Ze])}function ba(e,t){var n=(0,y.default)(e);return!!(t=null==t?f:t)&&("number"==n||"symbol"!=n&&Me.test(e))&&e>-1&&e%1==0&&e<t}function Ma(e,t,n){if(!ns(n))return!1;var r=(0,y.default)(t);return!!("number"==r?Jo(n)&&ba(t,n.length):"string"==r&&t in n)&&jo(n[t],e)}function wa(e,t){if(Xo(e))return!1;var n=(0,y.default)(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!cs(e))||re.test(e)||!ne.test(e)||null!=t&&e in Ee(t)}function _a(e){var t=la(e),n=jn[t];if("function"!=typeof n||!(t in Xn.prototype))return!1;if(e===n)return!0;var r=sa(n);return!!r&&e===r[0]}(Tn&&va(new Tn(new ArrayBuffer(1)))!=I||Sn&&va(new Sn)!=T||En&&va(En.resolve())!=L||Ln&&va(new Ln)!=B||Pn&&va(new Pn)!=R)&&(va=function(e){var t=Sr(e),n=t==E?e.constructor:i,r=n?za(n):"";if(r)switch(r){case Rn:return I;case On:return T;case In:return L;case Fn:return B;case Nn:return R}return t});var Aa=Oe?$o:yl;function Ca(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Re)}function Ta(e){return e==e&&!ns(e)}function Sa(e,t){return function(n){return null!=n&&n[e]===t&&(t!==i||e in Ee(n))}}function Ea(e,t,n){return t=bn(t===i?e.length-1:t,0),function(){for(var i=arguments,a=-1,o=bn(i.length-t,0),s=r(o);++a<o;)s[a]=i[t+a];a=-1;for(var l=r(t+1);++a<t;)l[a]=i[a];return l[t]=n(s),Et(e,this,l)}}function La(e,t){return t.length<2?e:Cr(e,ai(t,0,-1))}function Pa(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var Ba=Oa(ni),Da=ft||function(e,t){return vt.setTimeout(e,t)},ka=Oa(ri);function Ra(e,t,n){var r=t+"";return ka(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace(ue,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return Pt(g,(function(n){var r="_."+n[0];t&n[1]&&!Rt(e,r)&&e.push(r)})),e.sort()}(function(e){var t=e.match(ce);return t?t[1].split(he):[]}(r),n)))}function Oa(e){var t=0,n=0;return function(){var r=wn(),a=16-(r-n);if(n=r,a>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(i,arguments)}}function Ia(e,t){var n=-1,r=e.length,a=r-1;for(t=t===i?r:t;++n<t;){var o=qr(n,a),s=e[o];e[o]=e[n],e[n]=s}return e.length=t,e}var Fa=function(e){var t=Io(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ie,(function(e,n,r,i){t.push(r?i.replace(fe,"$1"):n||e)})),t}));function Na(e){if("string"==typeof e||cs(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function za(e){if(null!=e){try{return Ie.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ua(e){if(e instanceof Xn)return e.clone();var t=new Wn(e.__wrapped__,e.__chain__);return t.__actions__=Bi(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Ha=Zr((function(e,t){return Qo(e)?pr(e,xr(t,1,Qo,!0)):[]})),ja=Zr((function(e,t){var n=Ka(t);return Qo(n)&&(n=i),Qo(e)?pr(e,xr(t,1,Qo,!0),ca(n,2)):[]})),Ga=Zr((function(e,t){var n=Ka(t);return Qo(n)&&(n=i),Qo(e)?pr(e,xr(t,1,Qo,!0),i,n):[]}));function Va(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:vs(n);return i<0&&(i=bn(r+i,0)),Gt(e,ca(t,3),i)}function Wa(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var a=r-1;return n!==i&&(a=vs(n),a=n<0?bn(r+a,0):Mn(a,r-1)),Gt(e,ca(t,3),a,!0)}function Xa(e){return null!=e&&e.length?xr(e,1):[]}function Ya(e){return e&&e.length?e[0]:i}var Ja=Zr((function(e){var t=It(e,xi);return t.length&&t[0]===e[0]?Br(t):[]})),Qa=Zr((function(e){var t=Ka(e),n=It(e,xi);return t===Ka(n)?t=i:n.pop(),n.length&&n[0]===e[0]?Br(n,ca(t,2)):[]})),qa=Zr((function(e){var t=Ka(e),n=It(e,xi);return(t="function"==typeof t?t:i)&&n.pop(),n.length&&n[0]===e[0]?Br(n,i,t):[]}));function Ka(e){var t=null==e?0:e.length;return t?e[t-1]:i}var Za=Zr($a);function $a(e,t){return e&&e.length&&t&&t.length?Jr(e,t):e}var eo=ia((function(e,t){var n=null==e?0:e.length,r=lr(e,t);return Qr(e,It(t,(function(e){return ba(e,n)?+e:e})).sort(Ei)),r}));function to(e){return null==e?e:Cn.call(e)}var no=Zr((function(e){return di(xr(e,1,Qo,!0))})),ro=Zr((function(e){var t=Ka(e);return Qo(t)&&(t=i),di(xr(e,1,Qo,!0),ca(t,2))})),io=Zr((function(e){var t=Ka(e);return t="function"==typeof t?t:i,di(xr(e,1,Qo,!0),i,t)}));function ao(e){if(!e||!e.length)return[];var t=0;return e=kt(e,(function(e){if(Qo(e))return t=bn(e.length,t),!0})),Zt(t,(function(t){return It(e,Jt(t))}))}function oo(e,t){if(!e||!e.length)return[];var n=ao(e);return null==t?n:It(n,(function(e){return Et(t,i,e)}))}var so=Zr((function(e,t){return Qo(e)?pr(e,t):[]})),lo=Zr((function(e){return gi(kt(e,Qo))})),uo=Zr((function(e){var t=Ka(e);return Qo(t)&&(t=i),gi(kt(e,Qo),ca(t,2))})),co=Zr((function(e){var t=Ka(e);return t="function"==typeof t?t:i,gi(kt(e,Qo),i,t)})),ho=Zr(ao),po=Zr((function(e){var t=e.length,n=t>1?e[t-1]:i;return n="function"==typeof n?(e.pop(),n):i,oo(e,n)}));function fo(e){var t=jn(e);return t.__chain__=!0,t}function mo(e,t){return t(e)}var vo=ia((function(e){var t=e.length,n=t?e[0]:0,r=this.__wrapped__,a=function(t){return lr(t,e)};return!(t>1||this.__actions__.length)&&r instanceof Xn&&ba(n)?((r=r.slice(n,+n+(t?1:0))).__actions__.push({func:mo,args:[a],thisArg:i}),new Wn(r,this.__chain__).thru((function(e){return t&&!e.length&&e.push(i),e}))):this.thru(a)})),go=ki((function(e,t,n){Fe.call(e,n)?++e[n]:sr(e,n,1)})),yo=Ui(Va),xo=Ui(Wa);function bo(e,t){return(Xo(e)?Pt:fr)(e,ca(t,3))}function Mo(e,t){return(Xo(e)?Bt:mr)(e,ca(t,3))}var wo=ki((function(e,t,n){Fe.call(e,n)?e[n].push(t):sr(e,n,[t])})),_o=Zr((function(e,t,n){var i=-1,a="function"==typeof t,o=Jo(e)?r(e.length):[];return fr(e,(function(e){o[++i]=a?Et(t,e,n):Dr(e,t,n)})),o})),Ao=ki((function(e,t,n){sr(e,n,t)}));function Co(e,t){return(Xo(e)?It:Hr)(e,ca(t,3))}var To=ki((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]})),So=Zr((function(e,t){if(null==e)return[];var n=t.length;return n>1&&Ma(e,t[0],t[1])?t=[]:n>2&&Ma(t[0],t[1],t[2])&&(t=[t[0]]),Xr(e,xr(t,1),[])})),Eo=ht||function(){return vt.Date.now()};function Lo(e,t,n){return t=n?i:t,t=e&&null==t?e.length:t,$i(e,h,i,i,i,i,t)}function Po(e,t){var n;if("function"!=typeof t)throw new Be(a);return e=vs(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=i),n}}var Bo=Zr((function(e,t,n){var r=1;if(n.length){var i=dn(n,ua(Bo));r|=u}return $i(e,r,t,n,i)})),Do=Zr((function(e,t,n){var r=3;if(n.length){var i=dn(n,ua(Do));r|=u}return $i(t,r,e,n,i)}));function ko(e,t,n){var r,o,s,l,u,c,h=0,d=!1,p=!1,f=!0;if("function"!=typeof e)throw new Be(a);function m(t){var n=r,a=o;return r=o=i,h=t,l=e.apply(a,n)}function v(e){var n=e-c;return c===i||n>=t||n<0||p&&e-h>=s}function g(){var e=Eo();if(v(e))return y(e);u=Da(g,function(e){var n=t-(e-c);return p?Mn(n,s-(e-h)):n}(e))}function y(e){return u=i,f&&r?m(e):(r=o=i,l)}function x(){var e=Eo(),n=v(e);if(r=arguments,o=this,c=e,n){if(u===i)return function(e){return h=e,u=Da(g,t),d?m(e):l}(c);if(p)return Ai(u),u=Da(g,t),m(c)}return u===i&&(u=Da(g,t)),l}return t=ys(t)||0,ns(n)&&(d=!!n.leading,s=(p="maxWait"in n)?bn(ys(n.maxWait)||0,t):s,f="trailing"in n?!!n.trailing:f),x.cancel=function(){u!==i&&Ai(u),h=0,r=c=o=u=i},x.flush=function(){return u===i?l:y(Eo())},x}var Ro=Zr((function(e,t){return dr(e,1,t)})),Oo=Zr((function(e,t,n){return dr(e,ys(t)||0,n)}));function Io(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new Be(a);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],a=n.cache;if(a.has(i))return a.get(i);var o=e.apply(this,r);return n.cache=a.set(i,o)||a,o};return n.cache=new(Io.Cache||Qn),n}function Fo(e){if("function"!=typeof e)throw new Be(a);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Io.Cache=Qn;var No=wi((function(e,t){var n=(t=1==t.length&&Xo(t[0])?It(t[0],en(ca())):It(xr(t,1),en(ca()))).length;return Zr((function(r){for(var i=-1,a=Mn(r.length,n);++i<a;)r[i]=t[i].call(this,r[i]);return Et(e,this,r)}))})),zo=Zr((function(e,t){var n=dn(t,ua(zo));return $i(e,u,i,t,n)})),Uo=Zr((function(e,t){var n=dn(t,ua(Uo));return $i(e,c,i,t,n)})),Ho=ia((function(e,t){return $i(e,d,i,i,i,t)}));function jo(e,t){return e===t||e!=e&&t!=t}var Go=Ji(Er),Vo=Ji((function(e,t){return e>=t})),Wo=kr(function(){return arguments}())?kr:function(e){return rs(e)&&Fe.call(e,"callee")&&!qe.call(e,"callee")},Xo=r.isArray,Yo=wt?en(wt):function(e){return rs(e)&&Sr(e)==O};function Jo(e){return null!=e&&ts(e.length)&&!$o(e)}function Qo(e){return rs(e)&&Jo(e)}var qo=bt||yl,Ko=_t?en(_t):function(e){return rs(e)&&Sr(e)==w};function Zo(e){if(!rs(e))return!1;var t=Sr(e);return t==_||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!os(e)}function $o(e){if(!ns(e))return!1;var t=Sr(e);return t==A||t==C||"[object AsyncFunction]"==t||"[object Proxy]"==t}function es(e){return"number"==typeof e&&e==vs(e)}function ts(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=f}function ns(e){var t=(0,y.default)(e);return null!=e&&("object"==t||"function"==t)}function rs(e){return null!=e&&"object"==(0,y.default)(e)}var is=At?en(At):function(e){return rs(e)&&va(e)==T};function as(e){return"number"==typeof e||rs(e)&&Sr(e)==S}function os(e){if(!rs(e)||Sr(e)!=E)return!1;var t=Je(e);if(null===t)return!0;var n=Fe.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Ie.call(n)==He}var ss=Ct?en(Ct):function(e){return rs(e)&&Sr(e)==P},ls=Tt?en(Tt):function(e){return rs(e)&&va(e)==B};function us(e){return"string"==typeof e||!Xo(e)&&rs(e)&&Sr(e)==D}function cs(e){return"symbol"==(0,y.default)(e)||rs(e)&&Sr(e)==k}var hs=St?en(St):function(e){return rs(e)&&ts(e.length)&&!!ut[Sr(e)]},ds=Ji(Ur),ps=Ji((function(e,t){return e<=t}));function fs(e){if(!e)return[];if(Jo(e))return us(e)?vn(e):Bi(e);if($e&&e[$e])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[$e]());var t=va(e);return(t==T?cn:t==B?pn:js)(e)}function ms(e){return e?(e=ys(e))===p||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function vs(e){var t=ms(e),n=t%1;return t==t?n?t-n:t:0}function gs(e){return e?ur(vs(e),0,v):0}function ys(e){if("number"==typeof e)return e;if(cs(e))return m;if(ns(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ns(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=$t(e);var n=ye.test(e);return n||be.test(e)?pt(e.slice(2),n?2:8):ge.test(e)?m:+e}function xs(e){return Di(e,Rs(e))}function bs(e){return null==e?"":hi(e)}var Ms=Ri((function(e,t){if(Ca(t)||Jo(t))Di(t,ks(t),e);else for(var n in t)Fe.call(t,n)&&rr(e,n,t[n])})),ws=Ri((function(e,t){Di(t,Rs(t),e)})),_s=Ri((function(e,t,n,r){Di(t,Rs(t),e,r)})),As=Ri((function(e,t,n,r){Di(t,ks(t),e,r)})),Cs=ia(lr),Ts=Zr((function(e,t){e=Ee(e);var n=-1,r=t.length,a=r>2?t[2]:i;for(a&&Ma(t[0],t[1],a)&&(r=1);++n<r;)for(var o=t[n],s=Rs(o),l=-1,u=s.length;++l<u;){var c=s[l],h=e[c];(h===i||jo(h,Re[c])&&!Fe.call(e,c))&&(e[c]=o[c])}return e})),Ss=Zr((function(e){return e.push(i,ta),Et(Is,i,e)}));function Es(e,t,n){var r=null==e?i:Cr(e,t);return r===i?n:r}function Ls(e,t){return null!=e&&ga(e,t,Pr)}var Ps=Gi((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Ue.call(t)),e[t]=n}),nl(al)),Bs=Gi((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Ue.call(t)),Fe.call(e,t)?e[t].push(n):e[t]=[n]}),ca),Ds=Zr(Dr);function ks(e){return Jo(e)?Zn(e):Nr(e)}function Rs(e){return Jo(e)?Zn(e,!0):zr(e)}var Os=Ri((function(e,t,n){Vr(e,t,n)})),Is=Ri((function(e,t,n,r){Vr(e,t,n,r)})),Fs=ia((function(e,t){var n={};if(null==e)return n;var r=!1;t=It(t,(function(t){return t=Mi(t,e),r||(r=t.length>1),t})),Di(e,oa(e),n),r&&(n=cr(n,7,na));for(var i=t.length;i--;)pi(n,t[i]);return n})),Ns=ia((function(e,t){return null==e?{}:function(e,t){return Yr(e,t,(function(t,n){return Ls(e,n)}))}(e,t)}));function zs(e,t){if(null==e)return{};var n=It(oa(e),(function(e){return[e]}));return t=ca(t),Yr(e,n,(function(e,n){return t(e,n[0])}))}var Us=Zi(ks),Hs=Zi(Rs);function js(e){return null==e?[]:tn(e,ks(e))}var Gs=Ni((function(e,t,n){return t=t.toLowerCase(),e+(n?Vs(t):t)}));function Vs(e){return Zs(bs(e).toLowerCase())}function Ws(e){return(e=bs(e))&&e.replace(we,on).replace(nt,"")}var Xs=Ni((function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),Ys=Ni((function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),Js=Fi("toLowerCase"),Qs=Ni((function(e,t,n){return e+(n?"_":"")+t.toLowerCase()})),qs=Ni((function(e,t,n){return e+(n?" ":"")+Zs(t)})),Ks=Ni((function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),Zs=Fi("toUpperCase");function $s(e,t,n){return e=bs(e),(t=n?i:t)===i?function(e){return ot.test(e)}(e)?function(e){return e.match(it)||[]}(e):function(e){return e.match(de)||[]}(e):e.match(t)||[]}var el=Zr((function(e,t){try{return Et(e,i,t)}catch(e){return Zo(e)?e:new Ce(e)}})),tl=ia((function(e,t){return Pt(t,(function(t){t=Na(t),sr(e,t,Bo(e[t],e))})),e}));function nl(e){return function(){return e}}var rl=Hi(),il=Hi(!0);function al(e){return e}function ol(e){return Fr("function"==typeof e?e:cr(e,1))}var sl=Zr((function(e,t){return function(n){return Dr(n,e,t)}})),ll=Zr((function(e,t){return function(n){return Dr(e,n,t)}}));function ul(e,t,n){var r=ks(t),i=Ar(t,r);null!=n||ns(t)&&(i.length||!r.length)||(n=t,t=e,e=this,i=Ar(t,ks(t)));var a=!(ns(n)&&"chain"in n&&!n.chain),o=$o(e);return Pt(i,(function(n){var r=t[n];e[n]=r,o&&(e.prototype[n]=function(){var t=this.__chain__;if(a||t){var n=e(this.__wrapped__);return(n.__actions__=Bi(this.__actions__)).push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,Ft([this.value()],arguments))})})),e}function cl(){}var hl=Wi(It),dl=Wi(Dt),pl=Wi(Ut);function fl(e){return wa(e)?Jt(Na(e)):function(e){return function(t){return Cr(t,e)}}(e)}var ml=Yi(),vl=Yi(!0);function gl(){return[]}function yl(){return!1}var xl,bl=Vi((function(e,t){return e+t}),0),Ml=qi("ceil"),wl=Vi((function(e,t){return e/t}),1),_l=qi("floor"),Al=Vi((function(e,t){return e*t}),1),Cl=qi("round"),Tl=Vi((function(e,t){return e-t}),0);return jn.after=function(e,t){if("function"!=typeof t)throw new Be(a);return e=vs(e),function(){if(--e<1)return t.apply(this,arguments)}},jn.ary=Lo,jn.assign=Ms,jn.assignIn=ws,jn.assignInWith=_s,jn.assignWith=As,jn.at=Cs,jn.before=Po,jn.bind=Bo,jn.bindAll=tl,jn.bindKey=Do,jn.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Xo(e)?e:[e]},jn.chain=fo,jn.chunk=function(e,t,n){t=(n?Ma(e,t,n):t===i)?1:bn(vs(t),0);var a=null==e?0:e.length;if(!a||t<1)return[];for(var o=0,s=0,l=r(mt(a/t));o<a;)l[s++]=ai(e,o,o+=t);return l},jn.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var a=e[t];a&&(i[r++]=a)}return i},jn.concat=function(){var e=arguments.length;if(!e)return[];for(var t=r(e-1),n=arguments[0],i=e;i--;)t[i-1]=arguments[i];return Ft(Xo(n)?Bi(n):[n],xr(t,1))},jn.cond=function(e){var t=null==e?0:e.length,n=ca();return e=t?It(e,(function(e){if("function"!=typeof e[1])throw new Be(a);return[n(e[0]),e[1]]})):[],Zr((function(n){for(var r=-1;++r<t;){var i=e[r];if(Et(i[0],this,n))return Et(i[1],this,n)}}))},jn.conforms=function(e){return function(e){var t=ks(e);return function(n){return hr(n,e,t)}}(cr(e,1))},jn.constant=nl,jn.countBy=go,jn.create=function(e,t){var n=Gn(e);return null==t?n:or(n,t)},jn.curry=function e(t,n,r){var a=$i(t,8,i,i,i,i,i,n=r?i:n);return a.placeholder=e.placeholder,a},jn.curryRight=function e(t,n,r){var a=$i(t,l,i,i,i,i,i,n=r?i:n);return a.placeholder=e.placeholder,a},jn.debounce=ko,jn.defaults=Ts,jn.defaultsDeep=Ss,jn.defer=Ro,jn.delay=Oo,jn.difference=Ha,jn.differenceBy=ja,jn.differenceWith=Ga,jn.drop=function(e,t,n){var r=null==e?0:e.length;return r?ai(e,(t=n||t===i?1:vs(t))<0?0:t,r):[]},jn.dropRight=function(e,t,n){var r=null==e?0:e.length;return r?ai(e,0,(t=r-(t=n||t===i?1:vs(t)))<0?0:t):[]},jn.dropRightWhile=function(e,t){return e&&e.length?mi(e,ca(t,3),!0,!0):[]},jn.dropWhile=function(e,t){return e&&e.length?mi(e,ca(t,3),!0):[]},jn.fill=function(e,t,n,r){var a=null==e?0:e.length;return a?(n&&"number"!=typeof n&&Ma(e,t,n)&&(n=0,r=a),function(e,t,n,r){var a=e.length;for((n=vs(n))<0&&(n=-n>a?0:a+n),(r=r===i||r>a?a:vs(r))<0&&(r+=a),r=n>r?0:gs(r);n<r;)e[n++]=t;return e}(e,t,n,r)):[]},jn.filter=function(e,t){return(Xo(e)?kt:yr)(e,ca(t,3))},jn.flatMap=function(e,t){return xr(Co(e,t),1)},jn.flatMapDeep=function(e,t){return xr(Co(e,t),p)},jn.flatMapDepth=function(e,t,n){return n=n===i?1:vs(n),xr(Co(e,t),n)},jn.flatten=Xa,jn.flattenDeep=function(e){return null!=e&&e.length?xr(e,p):[]},jn.flattenDepth=function(e,t){return null!=e&&e.length?xr(e,t=t===i?1:vs(t)):[]},jn.flip=function(e){return $i(e,512)},jn.flow=rl,jn.flowRight=il,jn.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},jn.functions=function(e){return null==e?[]:Ar(e,ks(e))},jn.functionsIn=function(e){return null==e?[]:Ar(e,Rs(e))},jn.groupBy=wo,jn.initial=function(e){return null!=e&&e.length?ai(e,0,-1):[]},jn.intersection=Ja,jn.intersectionBy=Qa,jn.intersectionWith=qa,jn.invert=Ps,jn.invertBy=Bs,jn.invokeMap=_o,jn.iteratee=ol,jn.keyBy=Ao,jn.keys=ks,jn.keysIn=Rs,jn.map=Co,jn.mapKeys=function(e,t){var n={};return t=ca(t,3),wr(e,(function(e,r,i){sr(n,t(e,r,i),e)})),n},jn.mapValues=function(e,t){var n={};return t=ca(t,3),wr(e,(function(e,r,i){sr(n,r,t(e,r,i))})),n},jn.matches=function(e){return jr(cr(e,1))},jn.matchesProperty=function(e,t){return Gr(e,cr(t,1))},jn.memoize=Io,jn.merge=Os,jn.mergeWith=Is,jn.method=sl,jn.methodOf=ll,jn.mixin=ul,jn.negate=Fo,jn.nthArg=function(e){return e=vs(e),Zr((function(t){return Wr(t,e)}))},jn.omit=Fs,jn.omitBy=function(e,t){return zs(e,Fo(ca(t)))},jn.once=function(e){return Po(2,e)},jn.orderBy=function(e,t,n,r){return null==e?[]:(Xo(t)||(t=null==t?[]:[t]),Xo(n=r?i:n)||(n=null==n?[]:[n]),Xr(e,t,n))},jn.over=hl,jn.overArgs=No,jn.overEvery=dl,jn.overSome=pl,jn.partial=zo,jn.partialRight=Uo,jn.partition=To,jn.pick=Ns,jn.pickBy=zs,jn.property=fl,jn.propertyOf=function(e){return function(t){return null==e?i:Cr(e,t)}},jn.pull=Za,jn.pullAll=$a,jn.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?Jr(e,t,ca(n,2)):e},jn.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?Jr(e,t,i,n):e},jn.pullAt=eo,jn.range=ml,jn.rangeRight=vl,jn.rearg=Ho,jn.reject=function(e,t){return(Xo(e)?kt:yr)(e,Fo(ca(t,3)))},jn.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],a=e.length;for(t=ca(t,3);++r<a;){var o=e[r];t(o,r,e)&&(n.push(o),i.push(r))}return Qr(e,i),n},jn.rest=function(e,t){if("function"!=typeof e)throw new Be(a);return Zr(e,t=t===i?t:vs(t))},jn.reverse=to,jn.sampleSize=function(e,t,n){return t=(n?Ma(e,t,n):t===i)?1:vs(t),(Xo(e)?er:ei)(e,t)},jn.set=function(e,t,n){return null==e?e:ti(e,t,n)},jn.setWith=function(e,t,n,r){return r="function"==typeof r?r:i,null==e?e:ti(e,t,n,r)},jn.shuffle=function(e){return(Xo(e)?tr:ii)(e)},jn.slice=function(e,t,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&Ma(e,t,n)?(t=0,n=r):(t=null==t?0:vs(t),n=n===i?r:vs(n)),ai(e,t,n)):[]},jn.sortBy=So,jn.sortedUniq=function(e){return e&&e.length?ui(e):[]},jn.sortedUniqBy=function(e,t){return e&&e.length?ui(e,ca(t,2)):[]},jn.split=function(e,t,n){return n&&"number"!=typeof n&&Ma(e,t,n)&&(t=n=i),(n=n===i?v:n>>>0)?(e=bs(e))&&("string"==typeof t||null!=t&&!ss(t))&&!(t=hi(t))&&un(e)?_i(vn(e),0,n):e.split(t,n):[]},jn.spread=function(e,t){if("function"!=typeof e)throw new Be(a);return t=null==t?0:bn(vs(t),0),Zr((function(n){var r=n[t],i=_i(n,0,t);return r&&Ft(i,r),Et(e,this,i)}))},jn.tail=function(e){var t=null==e?0:e.length;return t?ai(e,1,t):[]},jn.take=function(e,t,n){return e&&e.length?ai(e,0,(t=n||t===i?1:vs(t))<0?0:t):[]},jn.takeRight=function(e,t,n){var r=null==e?0:e.length;return r?ai(e,(t=r-(t=n||t===i?1:vs(t)))<0?0:t,r):[]},jn.takeRightWhile=function(e,t){return e&&e.length?mi(e,ca(t,3),!1,!0):[]},jn.takeWhile=function(e,t){return e&&e.length?mi(e,ca(t,3)):[]},jn.tap=function(e,t){return t(e),e},jn.throttle=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new Be(a);return ns(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),ko(e,t,{leading:r,maxWait:t,trailing:i})},jn.thru=mo,jn.toArray=fs,jn.toPairs=Us,jn.toPairsIn=Hs,jn.toPath=function(e){return Xo(e)?It(e,Na):cs(e)?[e]:Bi(Fa(bs(e)))},jn.toPlainObject=xs,jn.transform=function(e,t,n){var r=Xo(e),i=r||qo(e)||hs(e);if(t=ca(t,4),null==n){var a=e&&e.constructor;n=i?r?new a:[]:ns(e)&&$o(a)?Gn(Je(e)):{}}return(i?Pt:wr)(e,(function(e,r,i){return t(n,e,r,i)})),n},jn.unary=function(e){return Lo(e,1)},jn.union=no,jn.unionBy=ro,jn.unionWith=io,jn.uniq=function(e){return e&&e.length?di(e):[]},jn.uniqBy=function(e,t){return e&&e.length?di(e,ca(t,2)):[]},jn.uniqWith=function(e,t){return t="function"==typeof t?t:i,e&&e.length?di(e,i,t):[]},jn.unset=function(e,t){return null==e||pi(e,t)},jn.unzip=ao,jn.unzipWith=oo,jn.update=function(e,t,n){return null==e?e:fi(e,t,bi(n))},jn.updateWith=function(e,t,n,r){return r="function"==typeof r?r:i,null==e?e:fi(e,t,bi(n),r)},jn.values=js,jn.valuesIn=function(e){return null==e?[]:tn(e,Rs(e))},jn.without=so,jn.words=$s,jn.wrap=function(e,t){return zo(bi(t),e)},jn.xor=lo,jn.xorBy=uo,jn.xorWith=co,jn.zip=ho,jn.zipObject=function(e,t){return yi(e||[],t||[],rr)},jn.zipObjectDeep=function(e,t){return yi(e||[],t||[],ti)},jn.zipWith=po,jn.entries=Us,jn.entriesIn=Hs,jn.extend=ws,jn.extendWith=_s,ul(jn,jn),jn.add=bl,jn.attempt=el,jn.camelCase=Gs,jn.capitalize=Vs,jn.ceil=Ml,jn.clamp=function(e,t,n){return n===i&&(n=t,t=i),n!==i&&(n=(n=ys(n))==n?n:0),t!==i&&(t=(t=ys(t))==t?t:0),ur(ys(e),t,n)},jn.clone=function(e){return cr(e,4)},jn.cloneDeep=function(e){return cr(e,5)},jn.cloneDeepWith=function(e,t){return cr(e,5,t="function"==typeof t?t:i)},jn.cloneWith=function(e,t){return cr(e,4,t="function"==typeof t?t:i)},jn.conformsTo=function(e,t){return null==t||hr(e,t,ks(t))},jn.deburr=Ws,jn.defaultTo=function(e,t){return null==e||e!=e?t:e},jn.divide=wl,jn.endsWith=function(e,t,n){e=bs(e),t=hi(t);var r=e.length,a=n=n===i?r:ur(vs(n),0,r);return(n-=t.length)>=0&&e.slice(n,a)==t},jn.eq=jo,jn.escape=function(e){return(e=bs(e))&&Z.test(e)?e.replace(q,sn):e},jn.escapeRegExp=function(e){return(e=bs(e))&&oe.test(e)?e.replace(ae,"\\$&"):e},jn.every=function(e,t,n){var r=Xo(e)?Dt:vr;return n&&Ma(e,t,n)&&(t=i),r(e,ca(t,3))},jn.find=yo,jn.findIndex=Va,jn.findKey=function(e,t){return jt(e,ca(t,3),wr)},jn.findLast=xo,jn.findLastIndex=Wa,jn.findLastKey=function(e,t){return jt(e,ca(t,3),_r)},jn.floor=_l,jn.forEach=bo,jn.forEachRight=Mo,jn.forIn=function(e,t){return null==e?e:br(e,ca(t,3),Rs)},jn.forInRight=function(e,t){return null==e?e:Mr(e,ca(t,3),Rs)},jn.forOwn=function(e,t){return e&&wr(e,ca(t,3))},jn.forOwnRight=function(e,t){return e&&_r(e,ca(t,3))},jn.get=Es,jn.gt=Go,jn.gte=Vo,jn.has=function(e,t){return null!=e&&ga(e,t,Lr)},jn.hasIn=Ls,jn.head=Ya,jn.identity=al,jn.includes=function(e,t,n,r){e=Jo(e)?e:js(e),n=n&&!r?vs(n):0;var i=e.length;return n<0&&(n=bn(i+n,0)),us(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Vt(e,t,n)>-1},jn.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:vs(n);return i<0&&(i=bn(r+i,0)),Vt(e,t,i)},jn.inRange=function(e,t,n){return t=ms(t),n===i?(n=t,t=0):n=ms(n),function(e,t,n){return e>=Mn(t,n)&&e<bn(t,n)}(e=ys(e),t,n)},jn.invoke=Ds,jn.isArguments=Wo,jn.isArray=Xo,jn.isArrayBuffer=Yo,jn.isArrayLike=Jo,jn.isArrayLikeObject=Qo,jn.isBoolean=function(e){return!0===e||!1===e||rs(e)&&Sr(e)==M},jn.isBuffer=qo,jn.isDate=Ko,jn.isElement=function(e){return rs(e)&&1===e.nodeType&&!os(e)},jn.isEmpty=function(e){if(null==e)return!0;if(Jo(e)&&(Xo(e)||"string"==typeof e||"function"==typeof e.splice||qo(e)||hs(e)||Wo(e)))return!e.length;var t=va(e);if(t==T||t==B)return!e.size;if(Ca(e))return!Nr(e).length;for(var n in e)if(Fe.call(e,n))return!1;return!0},jn.isEqual=function(e,t){return Rr(e,t)},jn.isEqualWith=function(e,t,n){var r=(n="function"==typeof n?n:i)?n(e,t):i;return r===i?Rr(e,t,i,n):!!r},jn.isError=Zo,jn.isFinite=function(e){return"number"==typeof e&&Mt(e)},jn.isFunction=$o,jn.isInteger=es,jn.isLength=ts,jn.isMap=is,jn.isMatch=function(e,t){return e===t||Or(e,t,da(t))},jn.isMatchWith=function(e,t,n){return n="function"==typeof n?n:i,Or(e,t,da(t),n)},jn.isNaN=function(e){return as(e)&&e!=+e},jn.isNative=function(e){if(Aa(e))throw new Ce("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Ir(e)},jn.isNil=function(e){return null==e},jn.isNull=function(e){return null===e},jn.isNumber=as,jn.isObject=ns,jn.isObjectLike=rs,jn.isPlainObject=os,jn.isRegExp=ss,jn.isSafeInteger=function(e){return es(e)&&e>=-9007199254740991&&e<=f},jn.isSet=ls,jn.isString=us,jn.isSymbol=cs,jn.isTypedArray=hs,jn.isUndefined=function(e){return e===i},jn.isWeakMap=function(e){return rs(e)&&va(e)==R},jn.isWeakSet=function(e){return rs(e)&&"[object WeakSet]"==Sr(e)},jn.join=function(e,t){return null==e?"":Ht.call(e,t)},jn.kebabCase=Xs,jn.last=Ka,jn.lastIndexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var a=r;return n!==i&&(a=(a=vs(n))<0?bn(r+a,0):Mn(a,r-1)),t==t?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(e,t,a):Gt(e,Xt,a,!0)},jn.lowerCase=Ys,jn.lowerFirst=Js,jn.lt=ds,jn.lte=ps,jn.max=function(e){return e&&e.length?gr(e,al,Er):i},jn.maxBy=function(e,t){return e&&e.length?gr(e,ca(t,2),Er):i},jn.mean=function(e){return Yt(e,al)},jn.meanBy=function(e,t){return Yt(e,ca(t,2))},jn.min=function(e){return e&&e.length?gr(e,al,Ur):i},jn.minBy=function(e,t){return e&&e.length?gr(e,ca(t,2),Ur):i},jn.stubArray=gl,jn.stubFalse=yl,jn.stubObject=function(){return{}},jn.stubString=function(){return""},jn.stubTrue=function(){return!0},jn.multiply=Al,jn.nth=function(e,t){return e&&e.length?Wr(e,vs(t)):i},jn.noConflict=function(){return vt._===this&&(vt._=je),this},jn.noop=cl,jn.now=Eo,jn.pad=function(e,t,n){e=bs(e);var r=(t=vs(t))?mn(e):0;if(!t||r>=t)return e;var i=(t-r)/2;return Xi(gt(i),n)+e+Xi(mt(i),n)},jn.padEnd=function(e,t,n){e=bs(e);var r=(t=vs(t))?mn(e):0;return t&&r<t?e+Xi(t-r,n):e},jn.padStart=function(e,t,n){e=bs(e);var r=(t=vs(t))?mn(e):0;return t&&r<t?Xi(t-r,n)+e:e},jn.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),_n(bs(e).replace(se,""),t||0)},jn.random=function(e,t,n){if(n&&"boolean"!=typeof n&&Ma(e,t,n)&&(t=n=i),n===i&&("boolean"==typeof t?(n=t,t=i):"boolean"==typeof e&&(n=e,e=i)),e===i&&t===i?(e=0,t=1):(e=ms(e),t===i?(t=e,e=0):t=ms(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var a=An();return Mn(e+a*(t-e+dt("1e-"+((a+"").length-1))),t)}return qr(e,t)},jn.reduce=function(e,t,n){var r=Xo(e)?Nt:qt,i=arguments.length<3;return r(e,ca(t,4),n,i,fr)},jn.reduceRight=function(e,t,n){var r=Xo(e)?zt:qt,i=arguments.length<3;return r(e,ca(t,4),n,i,mr)},jn.repeat=function(e,t,n){return t=(n?Ma(e,t,n):t===i)?1:vs(t),Kr(bs(e),t)},jn.replace=function(){var e=arguments,t=bs(e[0]);return e.length<3?t:t.replace(e[1],e[2])},jn.result=function(e,t,n){var r=-1,a=(t=Mi(t,e)).length;for(a||(a=1,e=i);++r<a;){var o=null==e?i:e[Na(t[r])];o===i&&(r=a,o=n),e=$o(o)?o.call(e):o}return e},jn.round=Cl,jn.runInContext=e,jn.sample=function(e){return(Xo(e)?$n:$r)(e)},jn.size=function(e){if(null==e)return 0;if(Jo(e))return us(e)?mn(e):e.length;var t=va(e);return t==T||t==B?e.size:Nr(e).length},jn.snakeCase=Qs,jn.some=function(e,t,n){var r=Xo(e)?Ut:oi;return n&&Ma(e,t,n)&&(t=i),r(e,ca(t,3))},jn.sortedIndex=function(e,t){return si(e,t)},jn.sortedIndexBy=function(e,t,n){return li(e,t,ca(n,2))},jn.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=si(e,t);if(r<n&&jo(e[r],t))return r}return-1},jn.sortedLastIndex=function(e,t){return si(e,t,!0)},jn.sortedLastIndexBy=function(e,t,n){return li(e,t,ca(n,2),!0)},jn.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=si(e,t,!0)-1;if(jo(e[n],t))return n}return-1},jn.startCase=qs,jn.startsWith=function(e,t,n){return e=bs(e),n=null==n?0:ur(vs(n),0,e.length),t=hi(t),e.slice(n,n+t.length)==t},jn.subtract=Tl,jn.sum=function(e){return e&&e.length?Kt(e,al):0},jn.sumBy=function(e,t){return e&&e.length?Kt(e,ca(t,2)):0},jn.template=function(e,t,n){var r=jn.templateSettings;n&&Ma(e,t,n)&&(t=i),e=bs(e),t=_s({},t,r,ea);var a,o,s=_s({},t.imports,r.imports,ea),l=ks(s),u=tn(s,l),c=0,h=t.interpolate||_e,d="__p += '",p=Le((t.escape||_e).source+"|"+h.source+"|"+(h===te?me:_e).source+"|"+(t.evaluate||_e).source+"|$","g"),f="//# sourceURL="+(Fe.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++lt+"]")+"\n";e.replace(p,(function(t,n,r,i,s,l){return r||(r=i),d+=e.slice(c,l).replace(Ae,ln),n&&(a=!0,d+="' +\n__e("+n+") +\n'"),s&&(o=!0,d+="';\n"+s+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=l+t.length,t})),d+="';\n";var m=Fe.call(t,"variable")&&t.variable;if(m){if(pe.test(m))throw new Ce("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(o?d.replace(X,""):d).replace(Y,"$1").replace(J,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var v=el((function(){return Te(l,f+"return "+d).apply(i,u)}));if(v.source=d,Zo(v))throw v;return v},jn.times=function(e,t){if((e=vs(e))<1||e>f)return[];var n=v,r=Mn(e,v);t=ca(t),e-=v;for(var i=Zt(r,t);++n<e;)t(n);return i},jn.toFinite=ms,jn.toInteger=vs,jn.toLength=gs,jn.toLower=function(e){return bs(e).toLowerCase()},jn.toNumber=ys,jn.toSafeInteger=function(e){return e?ur(vs(e),-9007199254740991,f):0===e?e:0},jn.toString=bs,jn.toUpper=function(e){return bs(e).toUpperCase()},jn.trim=function(e,t,n){if((e=bs(e))&&(n||t===i))return $t(e);if(!e||!(t=hi(t)))return e;var r=vn(e),a=vn(t);return _i(r,rn(r,a),an(r,a)+1).join("")},jn.trimEnd=function(e,t,n){if((e=bs(e))&&(n||t===i))return e.slice(0,gn(e)+1);if(!e||!(t=hi(t)))return e;var r=vn(e);return _i(r,0,an(r,vn(t))+1).join("")},jn.trimStart=function(e,t,n){if((e=bs(e))&&(n||t===i))return e.replace(se,"");if(!e||!(t=hi(t)))return e;var r=vn(e);return _i(r,rn(r,vn(t))).join("")},jn.truncate=function(e,t){var n=30,r="...";if(ns(t)){var a="separator"in t?t.separator:a;n="length"in t?vs(t.length):n,r="omission"in t?hi(t.omission):r}var o=(e=bs(e)).length;if(un(e)){var s=vn(e);o=s.length}if(n>=o)return e;var l=n-mn(r);if(l<1)return r;var u=s?_i(s,0,l).join(""):e.slice(0,l);if(a===i)return u+r;if(s&&(l+=u.length-l),ss(a)){if(e.slice(l).search(a)){var c,h=u;for(a.global||(a=Le(a.source,bs(ve.exec(a))+"g")),a.lastIndex=0;c=a.exec(h);)var d=c.index;u=u.slice(0,d===i?l:d)}}else if(e.indexOf(hi(a),l)!=l){var p=u.lastIndexOf(a);p>-1&&(u=u.slice(0,p))}return u+r},jn.unescape=function(e){return(e=bs(e))&&K.test(e)?e.replace(Q,yn):e},jn.uniqueId=function(e){var t=++Ne;return bs(e)+t},jn.upperCase=Ks,jn.upperFirst=Zs,jn.each=bo,jn.eachRight=Mo,jn.first=Ya,ul(jn,(xl={},wr(jn,(function(e,t){Fe.call(jn.prototype,t)||(xl[t]=e)})),xl),{chain:!1}),jn.VERSION="4.17.21",Pt(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){jn[e].placeholder=jn})),Pt(["drop","take"],(function(e,t){Xn.prototype[e]=function(n){n=n===i?1:bn(vs(n),0);var r=this.__filtered__&&!t?new Xn(this):this.clone();return r.__filtered__?r.__takeCount__=Mn(n,r.__takeCount__):r.__views__.push({size:Mn(n,v),type:e+(r.__dir__<0?"Right":"")}),r},Xn.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),Pt(["filter","map","takeWhile"],(function(e,t){var n=t+1,r=1==n||3==n;Xn.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:ca(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}})),Pt(["head","last"],(function(e,t){var n="take"+(t?"Right":"");Xn.prototype[e]=function(){return this[n](1).value()[0]}})),Pt(["initial","tail"],(function(e,t){var n="drop"+(t?"":"Right");Xn.prototype[e]=function(){return this.__filtered__?new Xn(this):this[n](1)}})),Xn.prototype.compact=function(){return this.filter(al)},Xn.prototype.find=function(e){return this.filter(e).head()},Xn.prototype.findLast=function(e){return this.reverse().find(e)},Xn.prototype.invokeMap=Zr((function(e,t){return"function"==typeof e?new Xn(this):this.map((function(n){return Dr(n,e,t)}))})),Xn.prototype.reject=function(e){return this.filter(Fo(ca(e)))},Xn.prototype.slice=function(e,t){e=vs(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Xn(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==i&&(n=(t=vs(t))<0?n.dropRight(-t):n.take(t-e)),n)},Xn.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Xn.prototype.toArray=function(){return this.take(v)},wr(Xn.prototype,(function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),a=jn[r?"take"+("last"==t?"Right":""):t],o=r||/^find/.test(t);a&&(jn.prototype[t]=function(){var t=this.__wrapped__,s=r?[1]:arguments,l=t instanceof Xn,u=s[0],c=l||Xo(t),h=function(e){var t=a.apply(jn,Ft([e],s));return r&&d?t[0]:t};c&&n&&"function"==typeof u&&1!=u.length&&(l=c=!1);var d=this.__chain__,p=!!this.__actions__.length,f=o&&!d,m=l&&!p;if(!o&&c){t=m?t:new Xn(this);var v=e.apply(t,s);return v.__actions__.push({func:mo,args:[h],thisArg:i}),new Wn(v,d)}return f&&m?e.apply(this,s):(v=this.thru(h),f?r?v.value()[0]:v.value():v)})})),Pt(["pop","push","shift","sort","splice","unshift"],(function(e){var t=De[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);jn.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var i=this.value();return t.apply(Xo(i)?i:[],e)}return this[n]((function(n){return t.apply(Xo(n)?n:[],e)}))}})),wr(Xn.prototype,(function(e,t){var n=jn[t];if(n){var r=n.name+"";Fe.call(kn,r)||(kn[r]=[]),kn[r].push({name:t,func:n})}})),kn[ji(i,2).name]=[{name:"wrapper",func:i}],Xn.prototype.clone=function(){var e=new Xn(this.__wrapped__);return e.__actions__=Bi(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Bi(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Bi(this.__views__),e},Xn.prototype.reverse=function(){if(this.__filtered__){var e=new Xn(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Xn.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=Xo(e),r=t<0,i=n?e.length:0,a=function(e,t,n){for(var r=-1,i=n.length;++r<i;){var a=n[r],o=a.size;switch(a.type){case"drop":e+=o;break;case"dropRight":t-=o;break;case"take":t=Mn(t,e+o);break;case"takeRight":e=bn(e,t-o)}}return{start:e,end:t}}(0,i,this.__views__),o=a.start,s=a.end,l=s-o,u=r?s:o-1,c=this.__iteratees__,h=c.length,d=0,p=Mn(l,this.__takeCount__);if(!n||!r&&i==l&&p==l)return vi(e,this.__actions__);var f=[];e:for(;l--&&d<p;){for(var m=-1,v=e[u+=t];++m<h;){var g=c[m],y=g.iteratee,x=g.type,b=y(v);if(2==x)v=b;else if(!b){if(1==x)continue e;break e}}f[d++]=v}return f},jn.prototype.at=vo,jn.prototype.chain=function(){return fo(this)},jn.prototype.commit=function(){return new Wn(this.value(),this.__chain__)},jn.prototype.next=function(){this.__values__===i&&(this.__values__=fs(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?i:this.__values__[this.__index__++]}},jn.prototype.plant=function(e){for(var t,n=this;n instanceof Vn;){var r=Ua(n);r.__index__=0,r.__values__=i,t?a.__wrapped__=r:t=r;var a=r;n=n.__wrapped__}return a.__wrapped__=e,t},jn.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Xn){var t=e;return this.__actions__.length&&(t=new Xn(this)),(t=t.reverse()).__actions__.push({func:mo,args:[to],thisArg:i}),new Wn(t,this.__chain__)}return this.thru(to)},jn.prototype.toJSON=jn.prototype.valueOf=jn.prototype.value=function(){return vi(this.__wrapped__,this.__actions__)},jn.prototype.first=jn.prototype.head,$e&&(jn.prototype[$e]=function(){return this}),jn}();vt._=xn,(r=function(){return xn}.call(t,n,t,e))===i||(e.exports=r)}.call(this)},964:function(e,t,n){n.r(t),n.d(t,{ACESFilmicToneMapping:function(){return he},AddEquation:function(){return R},AddOperation:function(){return oe},AdditiveAnimationBlendMode:function(){return tn},AdditiveBlending:function(){return P},AlphaFormat:function(){return We},AlwaysDepth:function(){return K},AlwaysStencilFunc:function(){return kn},AmbientLight:function(){return Vh},AmbientLightProbe:function(){return dd},AnimationClip:function(){return Kc},AnimationLoader:function(){return ah},AnimationMixer:function(){return Wd},AnimationObjectGroup:function(){return Gd},AnimationUtils:function(){return Nc},ArcCurve:function(){return ph},ArrayCamera:function(){return Xs},ArrowHelper:function(){return Op},Audio:function(){return _d},AudioAnalyser:function(){return Ld},AudioContext:function(){return ud},AudioListener:function(){return wd},AudioLoader:function(){return cd},AxesHelper:function(){return Ip},AxisHelper:function(){return Ff},BackSide:function(){return w},BasicDepthPacking:function(){return fn},BasicShadowMap:function(){return h},BinaryTextureLoader:function(){return jf},Bone:function(){return Cl},BooleanKeyframeTrack:function(){return Vc},BoundingBoxHelper:function(){return Nf},Box2:function(){return tp},Box3:function(){return cr},Box3Helper:function(){return Dp},BoxBufferGeometry:function(){return Aa},BoxGeometry:function(){return su},BoxHelper:function(){return Bp},BufferAttribute:function(){return Oi},BufferGeometry:function(){return ra},BufferGeometryLoader:function(){return Zh},ByteType:function(){return Re},Cache:function(){return $c},Camera:function(){return Ba},CameraHelper:function(){return Tp},CanvasRenderer:function(){return Wf},CanvasTexture:function(){return eu},CatmullRomCurve3:function(){return xh},CineonToneMapping:function(){return ce},CircleBufferGeometry:function(){return lu},CircleGeometry:function(){return uu},ClampToEdgeWrapping:function(){return Me},Clock:function(){return vd},ClosedSplineCurve3:function(){return Rf},Color:function(){return Ei},ColorKeyframeTrack:function(){return Wc},CompressedTexture:function(){return $l},CompressedTextureLoader:function(){return oh},ConeBufferGeometry:function(){return pu},ConeGeometry:function(){return du},CubeCamera:function(){return Oa},CubeGeometry:function(){return su},CubeReflectionMapping:function(){return fe},CubeRefractionMapping:function(){return me},CubeTexture:function(){return Ia},CubeTextureLoader:function(){return lh},CubeUVReflectionMapping:function(){return ye},CubeUVRefractionMapping:function(){return xe},CubicBezierCurve:function(){return _h},CubicBezierCurve3:function(){return Ah},CubicInterpolant:function(){return Uc},CullFaceBack:function(){return s},CullFaceFront:function(){return l},CullFaceFrontBack:function(){return u},CullFaceNone:function(){return o},Curve:function(){return hh},CurvePath:function(){return Bh},CustomBlending:function(){return k},CustomToneMapping:function(){return de},CylinderBufferGeometry:function(){return cu},CylinderGeometry:function(){return hu},Cylindrical:function(){return $d},DataTexture:function(){return Na},DataTexture2DArray:function(){return lo},DataTexture3D:function(){return uo},DataTextureLoader:function(){return uh},DataUtils:function(){return zp},DecrementStencilOp:function(){return wn},DecrementWrapStencilOp:function(){return An},DefaultLoadingManager:function(){return th},DepthFormat:function(){return Ke},DepthStencilFormat:function(){return Ze},DepthTexture:function(){return tu},DirectionalLight:function(){return Gh},DirectionalLightHelper:function(){return _p},DiscreteInterpolant:function(){return jc},DodecahedronBufferGeometry:function(){return mu},DodecahedronGeometry:function(){return vu},DoubleSide:function(){return _},DstAlphaFactor:function(){return W},DstColorFactor:function(){return Y},DynamicBufferAttribute:function(){return Af},DynamicCopyUsage:function(){return Hn},DynamicDrawUsage:function(){return On},DynamicReadUsage:function(){return Nn},EdgesGeometry:function(){return Mu},EdgesHelper:function(){return zf},EllipseCurve:function(){return dh},EqualDepth:function(){return ee},EqualStencilFunc:function(){return En},EquirectangularReflectionMapping:function(){return ve},EquirectangularRefractionMapping:function(){return ge},Euler:function(){return Gr},EventDispatcher:function(){return Wn},ExtrudeBufferGeometry:function(){return qu},ExtrudeGeometry:function(){return Zu},Face3:function(){return Li},Face4:function(){return uf},FaceColors:function(){return pf},FileLoader:function(){return ih},FlatShading:function(){return A},Float16BufferAttribute:function(){return Gi},Float32Attribute:function(){return Df},Float32BufferAttribute:function(){return Vi},Float64Attribute:function(){return kf},Float64BufferAttribute:function(){return Wi},FloatType:function(){return ze},Fog:function(){return el},FogExp2:function(){return $s},Font:function(){return od},FontLoader:function(){return ld},FrontSide:function(){return M},Frustum:function(){return Ha},GLBufferAttribute:function(){return Jd},GLSL1:function(){return Gn},GLSL3:function(){return Vn},GammaEncoding:function(){return ln},Geometry:function(){return ou},GeometryUtils:function(){return Vf},GreaterDepth:function(){return ne},GreaterEqualDepth:function(){return te},GreaterEqualStencilFunc:function(){return Dn},GreaterStencilFunc:function(){return Pn},GridHelper:function(){return yp},Group:function(){return Ys},HalfFloatType:function(){return Ue},HemisphereLight:function(){return Oh},HemisphereLightHelper:function(){return gp},HemisphereLightProbe:function(){return hd},IcosahedronBufferGeometry:function(){return $u},IcosahedronGeometry:function(){return ec},ImageBitmapLoader:function(){return id},ImageLoader:function(){return sh},ImageUtils:function(){return $n},ImmediateRenderObject:function(){return ap},IncrementStencilOp:function(){return Mn},IncrementWrapStencilOp:function(){return _n},InstancedBufferAttribute:function(){return Kh},InstancedBufferGeometry:function(){return qh},InstancedInterleavedBuffer:function(){return Yd},InstancedMesh:function(){return kl},Int16Attribute:function(){return Ef},Int16BufferAttribute:function(){return zi},Int32Attribute:function(){return Pf},Int32BufferAttribute:function(){return Hi},Int8Attribute:function(){return Cf},Int8BufferAttribute:function(){return Ii},IntType:function(){return Fe},InterleavedBuffer:function(){return nl},InterleavedBufferAttribute:function(){return al},Interpolant:function(){return zc},InterpolateDiscrete:function(){return Jt},InterpolateLinear:function(){return Qt},InterpolateSmooth:function(){return qt},InvertStencilOp:function(){return Cn},JSONLoader:function(){return Xf},KeepStencilOp:function(){return xn},KeyframeTrack:function(){return Gc},LOD:function(){return _l},LatheBufferGeometry:function(){return tc},LatheGeometry:function(){return nc},Layers:function(){return Xr},LensFlare:function(){return Jf},LessDepth:function(){return Z},LessEqualDepth:function(){return $},LessEqualStencilFunc:function(){return Ln},LessStencilFunc:function(){return Sn},Light:function(){return Rh},LightProbe:function(){return Yh},Line:function(){return Ul},Line3:function(){return ip},LineBasicMaterial:function(){return Rl},LineCurve:function(){return Ch},LineCurve3:function(){return Th},LineDashedMaterial:function(){return Ic},LineLoop:function(){return Vl},LinePieces:function(){return hf},LineSegments:function(){return Gl},LineStrip:function(){return cf},LinearEncoding:function(){return on},LinearFilter:function(){return Ee},LinearInterpolant:function(){return Hc},LinearMipMapLinearFilter:function(){return De},LinearMipMapNearestFilter:function(){return Pe},LinearMipmapLinearFilter:function(){return Be},LinearMipmapNearestFilter:function(){return Le},LinearToneMapping:function(){return le},Loader:function(){return nh},LoaderUtils:function(){return Qh},LoadingManager:function(){return eh},LogLuvEncoding:function(){return cn},LoopOnce:function(){return Wt},LoopPingPong:function(){return Yt},LoopRepeat:function(){return Xt},LuminanceAlphaFormat:function(){return Qe},LuminanceFormat:function(){return Je},MOUSE:function(){return i},Material:function(){return Bi},MaterialLoader:function(){return Jh},Math:function(){return qn},MathUtils:function(){return qn},Matrix3:function(){return Zn},Matrix4:function(){return Or},MaxEquation:function(){return N},Mesh:function(){return Ma},MeshBasicMaterial:function(){return Di},MeshDepthMaterial:function(){return Ns},MeshDistanceMaterial:function(){return zs},MeshFaceMaterial:function(){return mf},MeshLambertMaterial:function(){return Rc},MeshMatcapMaterial:function(){return Oc},MeshNormalMaterial:function(){return kc},MeshPhongMaterial:function(){return Bc},MeshPhysicalMaterial:function(){return Pc},MeshStandardMaterial:function(){return Lc},MeshToonMaterial:function(){return Dc},MinEquation:function(){return F},MirroredRepeatWrapping:function(){return we},MixOperation:function(){return ae},MultiMaterial:function(){return vf},MultiplyBlending:function(){return D},MultiplyOperation:function(){return ie},NearestFilter:function(){return _e},NearestMipMapLinearFilter:function(){return Se},NearestMipMapNearestFilter:function(){return Ce},NearestMipmapLinearFilter:function(){return Te},NearestMipmapNearestFilter:function(){return Ae},NeverDepth:function(){return q},NeverStencilFunc:function(){return Tn},NoBlending:function(){return E},NoColors:function(){return df},NoToneMapping:function(){return se},NormalAnimationBlendMode:function(){return en},NormalBlending:function(){return L},NotEqualDepth:function(){return re},NotEqualStencilFunc:function(){return Bn},NumberKeyframeTrack:function(){return Xc},Object3D:function(){return oi},ObjectLoader:function(){return ed},ObjectSpaceNormalMap:function(){return gn},OctahedronBufferGeometry:function(){return rc},OctahedronGeometry:function(){return ic},OneFactor:function(){return U},OneMinusDstAlphaFactor:function(){return X},OneMinusDstColorFactor:function(){return J},OneMinusSrcAlphaFactor:function(){return V},OneMinusSrcColorFactor:function(){return j},OrthographicCamera:function(){return Hh},PCFShadowMap:function(){return f},PCFSoftShadowMap:function(){return x},PMREMGenerator:function(){return $p},ParametricBufferGeometry:function(){return ac},ParametricGeometry:function(){return oc},Particle:function(){return yf},ParticleBasicMaterial:function(){return Mf},ParticleSystem:function(){return xf},ParticleSystemMaterial:function(){return wf},Path:function(){return Dh},PerspectiveCamera:function(){return Da},Plane:function(){return ci},PlaneBufferGeometry:function(){return Va},PlaneGeometry:function(){return sc},PlaneHelper:function(){return kp},PointCloud:function(){return gf},PointCloudMaterial:function(){return bf},PointLight:function(){return Uh},PointLightHelper:function(){return pp},Points:function(){return ql},PointsMaterial:function(){return Wl},PolarGridHelper:function(){return xp},PolyhedronBufferGeometry:function(){return fu},PolyhedronGeometry:function(){return lc},PositionalAudio:function(){return Ed},PropertyBinding:function(){return jd},PropertyMixer:function(){return Pd},QuadraticBezierCurve:function(){return Sh},QuadraticBezierCurve3:function(){return Eh},Quaternion:function(){return or},QuaternionKeyframeTrack:function(){return Jc},QuaternionLinearInterpolant:function(){return Yc},REVISION:function(){return r},RGBADepthPacking:function(){return mn},RGBAFormat:function(){return Ye},RGBAIntegerFormat:function(){return it},RGBA_ASTC_10x10_Format:function(){return St},RGBA_ASTC_10x5_Format:function(){return At},RGBA_ASTC_10x6_Format:function(){return Ct},RGBA_ASTC_10x8_Format:function(){return Tt},RGBA_ASTC_12x10_Format:function(){return Et},RGBA_ASTC_12x12_Format:function(){return Lt},RGBA_ASTC_4x4_Format:function(){return vt},RGBA_ASTC_5x4_Format:function(){return gt},RGBA_ASTC_5x5_Format:function(){return yt},RGBA_ASTC_6x5_Format:function(){return xt},RGBA_ASTC_6x6_Format:function(){return bt},RGBA_ASTC_8x5_Format:function(){return Mt},RGBA_ASTC_8x6_Format:function(){return wt},RGBA_ASTC_8x8_Format:function(){return _t},RGBA_BPTC_Format:function(){return Pt},RGBA_ETC2_EAC_Format:function(){return mt},RGBA_PVRTC_2BPPV1_Format:function(){return dt},RGBA_PVRTC_4BPPV1_Format:function(){return ht},RGBA_S3TC_DXT1_Format:function(){return ot},RGBA_S3TC_DXT3_Format:function(){return st},RGBA_S3TC_DXT5_Format:function(){return lt},RGBDEncoding:function(){return pn},RGBEEncoding:function(){return un},RGBEFormat:function(){return qe},RGBFormat:function(){return Xe},RGBIntegerFormat:function(){return rt},RGBM16Encoding:function(){return dn},RGBM7Encoding:function(){return hn},RGB_ETC1_Format:function(){return pt},RGB_ETC2_Format:function(){return ft},RGB_PVRTC_2BPPV1_Format:function(){return ct},RGB_PVRTC_4BPPV1_Format:function(){return ut},RGB_S3TC_DXT1_Format:function(){return at},RGFormat:function(){return tt},RGIntegerFormat:function(){return nt},RawShaderMaterial:function(){return Ec},Ray:function(){return Rr},Raycaster:function(){return Qd},RectAreaLight:function(){return Wh},RedFormat:function(){return $e},RedIntegerFormat:function(){return et},ReinhardToneMapping:function(){return ue},RepeatWrapping:function(){return be},ReplaceStencilOp:function(){return bn},ReverseSubtractEquation:function(){return I},RingBufferGeometry:function(){return uc},RingGeometry:function(){return cc},SRGB8_ALPHA8_ASTC_10x10_Format:function(){return jt},SRGB8_ALPHA8_ASTC_10x5_Format:function(){return zt},SRGB8_ALPHA8_ASTC_10x6_Format:function(){return Ut},SRGB8_ALPHA8_ASTC_10x8_Format:function(){return Ht},SRGB8_ALPHA8_ASTC_12x10_Format:function(){return Gt},SRGB8_ALPHA8_ASTC_12x12_Format:function(){return Vt},SRGB8_ALPHA8_ASTC_4x4_Format:function(){return Bt},SRGB8_ALPHA8_ASTC_5x4_Format:function(){return Dt},SRGB8_ALPHA8_ASTC_5x5_Format:function(){return kt},SRGB8_ALPHA8_ASTC_6x5_Format:function(){return Rt},SRGB8_ALPHA8_ASTC_6x6_Format:function(){return Ot},SRGB8_ALPHA8_ASTC_8x5_Format:function(){return It},SRGB8_ALPHA8_ASTC_8x6_Format:function(){return Ft},SRGB8_ALPHA8_ASTC_8x8_Format:function(){return Nt},Scene:function(){return tl},SceneUtils:function(){return Yf},ShaderChunk:function(){return Wa},ShaderLib:function(){return Ya},ShaderMaterial:function(){return Pa},ShadowMaterial:function(){return Sc},Shape:function(){return kh},ShapeBufferGeometry:function(){return hc},ShapeGeometry:function(){return dc},ShapePath:function(){return ad},ShapeUtils:function(){return Yu},ShortType:function(){return Oe},Skeleton:function(){return El},SkeletonHelper:function(){return hp},SkinnedMesh:function(){return Al},SmoothShading:function(){return S},Sphere:function(){return Tr},SphereBufferGeometry:function(){return pc},SphereGeometry:function(){return fc},Spherical:function(){return Zd},SphericalHarmonics3:function(){return Xh},Spline:function(){return If},SplineCurve:function(){return Lh},SplineCurve3:function(){return Of},SpotLight:function(){return Nh},SpotLightHelper:function(){return sp},Sprite:function(){return xl},SpriteMaterial:function(){return ol},SrcAlphaFactor:function(){return G},SrcAlphaSaturateFactor:function(){return Q},SrcColorFactor:function(){return H},StaticCopyUsage:function(){return Un},StaticDrawUsage:function(){return Rn},StaticReadUsage:function(){return Fn},StereoCamera:function(){return md},StreamCopyUsage:function(){return jn},StreamDrawUsage:function(){return In},StreamReadUsage:function(){return zn},StringKeyframeTrack:function(){return Qc},SubtractEquation:function(){return O},SubtractiveBlending:function(){return B},TOUCH:function(){return a},TangentSpaceNormalMap:function(){return vn},TetrahedronBufferGeometry:function(){return mc},TetrahedronGeometry:function(){return vc},TextBufferGeometry:function(){return gc},TextGeometry:function(){return yc},Texture:function(){return tr},TextureLoader:function(){return ch},TorusBufferGeometry:function(){return xc},TorusGeometry:function(){return bc},TorusKnotBufferGeometry:function(){return Mc},TorusKnotGeometry:function(){return wc},Triangle:function(){return Mi},TriangleFanDrawMode:function(){return an},TriangleStripDrawMode:function(){return rn},TrianglesDrawMode:function(){return nn},TubeBufferGeometry:function(){return _c},TubeGeometry:function(){return Ac},UVMapping:function(){return pe},Uint16Attribute:function(){return Lf},Uint16BufferAttribute:function(){return Ui},Uint32Attribute:function(){return Bf},Uint32BufferAttribute:function(){return ji},Uint8Attribute:function(){return Tf},Uint8BufferAttribute:function(){return Fi},Uint8ClampedAttribute:function(){return Sf},Uint8ClampedBufferAttribute:function(){return Ni},Uniform:function(){return Xd},UniformsLib:function(){return Xa},UniformsUtils:function(){return Sa},UnsignedByteType:function(){return ke},UnsignedInt248Type:function(){return Ve},UnsignedIntType:function(){return Ne},UnsignedShort4444Type:function(){return He},UnsignedShort5551Type:function(){return je},UnsignedShort565Type:function(){return Ge},UnsignedShortType:function(){return Ie},VSMShadowMap:function(){return b},Vector2:function(){return Kn},Vector3:function(){return sr},Vector4:function(){return rr},VectorKeyframeTrack:function(){return qc},Vertex:function(){return _f},VertexColors:function(){return ff},VideoTexture:function(){return Zl},WebGL1Renderer:function(){return Zs},WebGLCubeRenderTarget:function(){return Fa},WebGLMultisampleRenderTarget:function(){return ar},WebGLRenderTarget:function(){return ir},WebGLRenderTargetCube:function(){return Gf},WebGLRenderer:function(){return Ks},WebGLUtils:function(){return Ws},WireframeGeometry:function(){return Cc},WireframeHelper:function(){return Uf},WrapAroundEnding:function(){return $t},XHRLoader:function(){return Hf},ZeroCurvatureEnding:function(){return Kt},ZeroFactor:function(){return z},ZeroSlopeEnding:function(){return Zt},ZeroStencilOp:function(){return yn},sRGBEncoding:function(){return sn}});var r="123",i={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},a={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,s=1,l=2,u=3,h=0,f=1,x=2,b=3,M=0,w=1,_=2,A=1,S=2,E=0,L=1,P=2,B=3,D=4,k=5,R=100,O=101,I=102,F=103,N=104,z=200,U=201,H=202,j=203,G=204,V=205,W=206,X=207,Y=208,J=209,Q=210,q=0,K=1,Z=2,$=3,ee=4,te=5,ne=6,re=7,ie=0,ae=1,oe=2,se=0,le=1,ue=2,ce=3,he=4,de=5,pe=300,fe=301,me=302,ve=303,ge=304,ye=306,xe=307,be=1e3,Me=1001,we=1002,_e=1003,Ae=1004,Ce=1004,Te=1005,Se=1005,Ee=1006,Le=1007,Pe=1007,Be=1008,De=1008,ke=1009,Re=1010,Oe=1011,Ie=1012,Fe=1013,Ne=1014,ze=1015,Ue=1016,He=1017,je=1018,Ge=1019,Ve=1020,We=1021,Xe=1022,Ye=1023,Je=1024,Qe=1025,qe=Ye,Ke=1026,Ze=1027,$e=1028,et=1029,tt=1030,nt=1031,rt=1032,it=1033,at=33776,ot=33777,st=33778,lt=33779,ut=35840,ct=35841,ht=35842,dt=35843,pt=36196,ft=37492,mt=37496,vt=37808,gt=37809,yt=37810,xt=37811,bt=37812,Mt=37813,wt=37814,_t=37815,At=37816,Ct=37817,Tt=37818,St=37819,Et=37820,Lt=37821,Pt=36492,Bt=37840,Dt=37841,kt=37842,Rt=37843,Ot=37844,It=37845,Ft=37846,Nt=37847,zt=37848,Ut=37849,Ht=37850,jt=37851,Gt=37852,Vt=37853,Wt=2200,Xt=2201,Yt=2202,Jt=2300,Qt=2301,qt=2302,Kt=2400,Zt=2401,$t=2402,en=2500,tn=2501,nn=0,rn=1,an=2,on=3e3,sn=3001,ln=3007,un=3002,cn=3003,hn=3004,dn=3005,pn=3006,fn=3200,mn=3201,vn=0,gn=1,yn=0,xn=7680,bn=7681,Mn=7682,wn=7683,_n=34055,An=34056,Cn=5386,Tn=512,Sn=513,En=514,Ln=515,Pn=516,Bn=517,Dn=518,kn=519,Rn=35044,On=35048,In=35040,Fn=35045,Nn=35049,zn=35041,Un=35046,Hn=35050,jn=35042,Gn="100",Vn="300 es";function Wn(){}Object.assign(Wn.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e)}}}});for(var Xn=[],Yn=0;Yn<256;Yn++)Xn[Yn]=(Yn<16?"0":"")+Yn.toString(16);var Jn,Qn=1234567,qn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Xn[255&e]+Xn[e>>8&255]+Xn[e>>16&255]+Xn[e>>24&255]+"-"+Xn[255&t]+Xn[t>>8&255]+"-"+Xn[t>>16&15|64]+Xn[t>>24&255]+"-"+Xn[63&n|128]+Xn[n>>8&255]+"-"+Xn[n>>16&255]+Xn[n>>24&255]+Xn[255&r]+Xn[r>>8&255]+Xn[r>>16&255]+Xn[r>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Qn=e%2147483647),((Qn=16807*Qn%2147483647)-1)/2147483646},degToRad:function(e){return e*qn.DEG2RAD},radToDeg:function(e){return e*qn.RAD2DEG},isPowerOfTwo:function(e){return!(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,i){var a=Math.cos,o=Math.sin,s=a(n/2),l=o(n/2),u=a((t+r)/2),c=o((t+r)/2),h=a((t-r)/2),d=o((t-r)/2),p=a((r-t)/2),f=o((r-t)/2);switch(i){case"XYX":e.set(s*c,l*h,l*d,s*u);break;case"YZY":e.set(l*d,s*c,l*h,s*u);break;case"ZXZ":e.set(l*h,l*d,s*c,s*u);break;case"XZX":e.set(s*c,l*f,l*p,s*u);break;case"YXY":e.set(l*p,s*c,l*f,s*u);break;case"ZYZ":e.set(l*f,l*p,s*c,s*u)}}},Kn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,v.default)(this,e),Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=n}return(0,g.default)(e,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?this.addVectors(e,t):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?this.subVectors(e,t):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){return Math.atan2(-this.y,-this.x)+Math.PI}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,n){return this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}}])}(),Zn=function(){function e(){(0,v.default)(this,e),Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1]}return(0,g.default)(e,[{key:"set",value:function(e,t,n,r,i,a,o,s,l){var u=this.elements;return u[0]=e,u[1]=r,u[2]=o,u[3]=t,u[4]=i,u[5]=s,u[6]=n,u[7]=a,u[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],u=n[4],c=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],v=r[6],g=r[1],y=r[4],x=r[7],b=r[2],M=r[5],w=r[8];return i[0]=a*f+o*g+s*b,i[3]=a*m+o*y+s*M,i[6]=a*v+o*x+s*w,i[1]=l*f+u*g+c*b,i[4]=l*m+u*y+c*M,i[7]=l*v+u*x+c*w,i[2]=h*f+d*g+p*b,i[5]=h*m+d*y+p*M,i[8]=h*v+d*x+p*w,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8];return t*a*u-t*o*l-n*i*u+n*o*s+r*i*l-r*a*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=u*a-o*l,h=o*s-u*i,d=l*i-a*s,p=t*c+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);var f=1/p;return e[0]=c*f,e[1]=(r*l-u*n)*f,e[2]=(o*n-r*a)*f,e[3]=h*f,e[4]=(u*t-r*s)*f,e[5]=(r*i-o*t)*f,e[6]=d*f,e[7]=(n*s-l*t)*f,e[8]=(a*t-n*i)*f,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).copy(this).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,r,i,a,o){var s=Math.cos(i),l=Math.sin(i);this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-r*l,r*s,-r*(-l*a+s*o)+o+t,0,0,1)}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],a=r[3],o=r[6],s=r[1],l=r[4],u=r[7];return r[0]=t*i+n*s,r[3]=t*a+n*l,r[6]=t*o+n*u,r[1]=-n*i+t*s,r[4]=-n*a+t*l,r[7]=-n*o+t*u,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}}])}(),$n={getDataURL:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Jn&&(Jn=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Jn.width=e.width,Jn.height=e.height;var n=Jn.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Jn}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},er=0;function tr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tr.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tr.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Me,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Me,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ee,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Be,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ye,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:ke,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:on;Object.defineProperty(this,"id",{value:er++}),this.uuid=qn.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new Kn(0,0),this.repeat=new Kn(1,1),this.center=new Kn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Zn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.version=0,this.onUpdate=null}function nr(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?$n.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:{}}tr.DEFAULT_IMAGE=void 0,tr.DEFAULT_MAPPING=pe,tr.prototype=Object.assign(Object.create(Wn.prototype),{constructor:tr,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=qn.generateUUID()),!t&&void 0===e.images[r.uuid]){var i;if(Array.isArray(r)){i=[];for(var a=0,o=r.length;a<o;a++)r[a].isDataTexture?i.push(nr(r[a].image)):i.push(nr(r[a]))}else i=nr(r);e.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==pe)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case be:e.x=e.x-Math.floor(e.x);break;case Me:e.x=e.x<0?0:1;break;case we:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case be:e.y=e.y-Math.floor(e.y);break;case Me:e.y=e.y<0?0:1;break;case we:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(tr.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});var rr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;(0,v.default)(this,e),Object.defineProperty(this,"isVector4",{value:!0}),this.x=t,this.y=n,this.z=r,this.w=i}return(0,g.default)(e,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e,t){return void 0!==t?this.addVectors(e,t):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e,t){return void 0!==t?this.subVectors(e,t):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,r,i,a=.01,o=.1,s=e.elements,l=s[0],u=s[4],c=s[8],h=s[1],d=s[5],p=s[9],f=s[2],m=s[6],v=s[10];if(Math.abs(u-h)<a&&Math.abs(c-f)<a&&Math.abs(p-m)<a){if(Math.abs(u+h)<o&&Math.abs(c+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+v-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(l+1)/2,y=(d+1)/2,x=(v+1)/2,b=(u+h)/4,M=(c+f)/4,w=(p+m)/4;return g>y&&g>x?g<a?(n=0,r=.707106781,i=.707106781):(r=b/(n=Math.sqrt(g)),i=M/n):y>x?y<a?(n=.707106781,r=0,i=.707106781):(n=b/(r=Math.sqrt(y)),i=w/r):x<a?(n=.707106781,r=.707106781,i=0):(n=M/(i=Math.sqrt(x)),r=w/i),this.set(n,r,i,t),this}var _=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(h-u)*(h-u));return Math.abs(_)<.001&&(_=1),this.x=(m-p)/_,this.y=(c-f)/_,this.z=(h-u)/_,this.w=Math.acos((l+d+v-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t,n){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}])}();function ir(e,t,n){this.width=e,this.height=t,this.scissor=new rr(0,0,e,t),this.scissorTest=!1,this.viewport=new rr(0,0,e,t),n=n||{},this.texture=new tr(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:Ee,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function ar(e,t,n){ir.call(this,e,t,n),this.samples=4}ir.prototype=Object.assign(Object.create(Wn.prototype),{constructor:ir,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),ar.prototype=Object.assign(Object.create(ir.prototype),{constructor:ar,isWebGLMultisampleRenderTarget:!0,copy:function(e){return ir.prototype.copy.call(this,e),this.samples=e.samples,this}});var or=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;(0,v.default)(this,e),Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=t,this._y=n,this._z=r,this._w=i}return(0,g.default)(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,a=e._order,o=Math.cos,s=Math.sin,l=o(n/2),u=o(r/2),c=o(i/2),h=s(n/2),d=s(r/2),p=s(i/2);switch(a){case"XYZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"YXZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"ZXY":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"ZYX":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"YZX":this._x=h*u*c+l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c-h*d*p;break;case"XZY":this._x=h*u*c-l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c+h*d*p}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],o=t[5],s=t[9],l=t[2],u=t[6],c=t[10],h=n+o+c;if(h>0){var d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(u-s)*d,this._y=(i-l)*d,this._z=(a-r)*d}else if(n>o&&n>c){var p=2*Math.sqrt(1+n-o-c);this._w=(u-s)/p,this._x=.25*p,this._y=(r+a)/p,this._z=(i+l)/p}else if(o>c){var f=2*Math.sqrt(1+o-n-c);this._w=(i-l)/f,this._x=(r+a)/f,this._y=.25*f,this._z=(s+u)/f}else{var m=2*Math.sqrt(1+c-n-o);this._w=(a-r)/m,this._x=(i+l)/m,this._y=(s+u)/m,this._z=.25*m}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(qn.clamp(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?this.multiplyQuaternions(e,t):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,l=t._z,u=t._w;return this._x=n*u+a*o+r*l-i*s,this._y=r*u+a*s+i*o-n*l,this._z=i*u+a*l+n*s-r*o,this._w=a*u-n*o-r*s-i*l,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,a=this._w,o=a*e._w+n*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*n+t*this._x,this._y=l*r+t*this._y,this._z=l*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(s),c=Math.atan2(u,o),h=Math.sin((1-t)*c)/u,d=Math.sin(t*c)/u;return this._w=a*h+this._w*d,this._x=n*h+this._x*d,this._y=r*h+this._y*d,this._z=i*h+this._z*d,this._onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}}],[{key:"slerp",value:function(e,t,n,r){return n.copy(e).slerp(t,r)}},{key:"slerpFlat",value:function(e,t,n,r,i,a,o){var s=n[r+0],l=n[r+1],u=n[r+2],c=n[r+3],h=i[a+0],d=i[a+1],p=i[a+2],f=i[a+3];if(c!==f||s!==h||l!==d||u!==p){var m=1-o,v=s*h+l*d+u*p+c*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var x=Math.sqrt(y),b=Math.atan2(x,v*g);m=Math.sin(m*b)/x,o=Math.sin(o*b)/x}var M=o*g;if(s=s*m+h*M,l=l*m+d*M,u=u*m+p*M,c=c*m+f*M,m===1-o){var w=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=w,l*=w,u*=w,c*=w}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,r,i,a){var o=n[r],s=n[r+1],l=n[r+2],u=n[r+3],c=i[a],h=i[a+1],d=i[a+2],p=i[a+3];return e[t]=o*p+u*c+s*d-l*h,e[t+1]=s*p+u*h+l*c-o*d,e[t+2]=l*p+u*d+o*h-s*c,e[t+3]=u*p-o*c-s*h-l*d,e}}])}(),sr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,v.default)(this,e),Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=n,this.z=r}return(0,g.default)(e,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?this.addVectors(e,t):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?this.subVectors(e,t):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?this.multiplyVectors(e,t):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return!e||e.isEuler,this.applyQuaternion(ur.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(ur.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*r-o*n,u=s*n+o*t-i*r,c=s*r+i*n-a*t,h=-i*t-a*n-o*r;return this.x=l*s+h*-i+u*-o-c*-a,this.y=u*s+h*-a+c*-i-l*-o,this.z=c*s+h*-o+l*-a-u*-i,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e,t){return void 0!==t?this.crossVectors(e,t):this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return lr.copy(this).projectOnVector(e),this.sub(lr)}},{key:"reflect",value:function(e){return this.sub(lr.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(qn.clamp(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,n){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}])}(),lr=new sr,ur=new or,cr=function(){function e(t,n){(0,v.default)(this,e),Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==t?t:new sr(1/0,1/0,1/0),this.max=void 0!==n?n:new sr(-1/0,-1/0,-1/0)}return(0,g.default)(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var u=e[s],c=e[s+1],h=e[s+2];u<t&&(t=u),c<n&&(n=c),h<r&&(r=h),u>i&&(i=u),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var u=e.getX(s),c=e.getY(s),h=e.getZ(s);u<t&&(t=u),c<n&&(n=c),h<r&&(r=h),u>i&&(i=u),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=pr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"setFromObject2",value:function(e){return this.makeEmpty(),this.expandByObject2(e)}},{key:"setFromObject3",value:function(e,t){return this.makeEmpty(),this.expandByObject3(e,t)}},{key:"setFromObject4",value:function(e,t){return this.makeEmpty(),this.expandByObject4(e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return void 0===e&&(e=new sr),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return void 0===e&&(e=new sr),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject3",value:function(e,t){var n=this;if(e.visible){if(e instanceof THREE.InstancedMesh){e.updateWorldMatrix(!1,!1);var r=e.geometry;if(void 0!==r){null===r.boundingBox&&r.computeBoundingBox();for(var i=0;i<e.count;i++)e.userData.meshVisible[i]&&e.userData.isShowArr[i]&&(fr.copy(r.boundingBox),fr.applyMatrix4({elements:e.instanceMatrix.array.slice(16*i,16*(i+1))}).applyMatrix4(t.clone().multiply(e.matrixWorld)),this.union(fr))}}else{e.updateWorldMatrix(!1,!1);var a=e.geometry;void 0!==a&&"skybox"!=e.name&&(null===a.boundingBox&&a.computeBoundingBox(),fr.copy(a.boundingBox),fr.applyMatrix4(t.clone().multiply(e.matrixWorld)),this.union(fr))}"instancedMeshes"in e.userData&&!e.userData.isReset&&e.userData.instancedMeshes.forEach((function(e){var r=e.mesh,i=e.id;if(r.userData.meshVisible[i]&&r.userData.isShowArr[i]){r.updateWorldMatrix(!1,!1);var a=r.geometry;void 0!==a&&(null===a.boundingBox&&a.computeBoundingBox(),fr.copy(a.boundingBox),fr.applyMatrix4(r.userData.matrix[i]).applyMatrix4(t.clone().multiply(r.matrixWorld)),n.union(fr))}}));for(var o=e.children,s=0,l=o.length;s<l;s++)this.expandByObject3(o[s],t);return this}}},{key:"expandByObject4",value:function(e,t){var n=this;if(e.visible){if(e instanceof THREE.InstancedMesh);else{e.updateWorldMatrix(!1,!1);var r=e.geometry;void 0!==r&&"skybox"!=e.name&&(null===r.boundingBox&&r.computeBoundingBox(),fr.copy(r.boundingBox),fr.applyMatrix4(t.clone().multiply(e.matrixWorld)),this.union(fr))}"instancedMeshes"in e.userData&&!e.userData.isReset&&e.userData.instancedMeshes.forEach((function(e){var r=e.mesh,i=e.id;if(r.userData.meshVisible[i]&&r.userData.isShowArr[i]){r.updateWorldMatrix(!1,!1);var a=r.geometry;void 0!==a&&(null===a.boundingBox&&a.computeBoundingBox(),fr.copy(a.boundingBox),fr.applyMatrix4(t.clone().multiply(r.userData.matrix[i])).applyMatrix4(r.matrixWorld),n.union(fr))}}));for(var i=e.children,a=0,o=i.length;a<o;a++)this.expandByObject4(i[a],t);return this}}},{key:"expandByObject",value:function(e){var t=this;if(e.visible){if(e instanceof THREE.InstancedMesh);else{e.updateWorldMatrix(!1,!1);var n=e.geometry;void 0!==n&&"skybox"!=e.name&&(null===n.boundingBox&&n.computeBoundingBox(),fr.copy(n.boundingBox),fr.applyMatrix4(e.matrixWorld),this.union(fr))}"instancedMeshes"in e.userData&&!e.userData.isReset&&e.userData.instancedMeshes.forEach((function(e){var n=e.mesh,r=e.id;if(n.userData.meshVisible[r]&&n.userData.isShowArr[r]){n.updateWorldMatrix(!1,!1);var i=n.geometry;void 0!==i&&(null===i.boundingBox&&i.computeBoundingBox(),fr.copy(i.boundingBox),fr.applyMatrix4(n.userData.matrix[r]).applyMatrix4(n.matrixWorld),t.union(fr))}}));for(var r=e.children,i=0,a=r.length;i<a;i++)this.expandByObject(r[i]);return this}}},{key:"expandByObject2",value:function(e){var t=this;if(e instanceof THREE.InstancedMesh){e.updateWorldMatrix(!1,!1);var n=e.geometry;if(void 0!==n){null===n.boundingBox&&n.computeBoundingBox();for(var r=0;r<e.count;r++)e.userData.meshVisible[r]&&e.userData.isShowArr[r]&&(fr.copy(n.boundingBox),fr.applyMatrix4({elements:e.instanceMatrix.array.slice(16*r,16*(r+1))}).applyMatrix4(e.matrixWorld),this.union(fr))}}else{e.updateWorldMatrix(!1,!1);var i=e.geometry;void 0!==i&&"skybox"!=e.name&&(null===i.boundingBox&&i.computeBoundingBox(),fr.copy(i.boundingBox),fr.applyMatrix4(e.matrixWorld),this.union(fr))}"instancedMeshes"in e.userData&&!e.userData.isReset&&e.userData.instancedMeshes.forEach((function(e){var n=e.mesh,r=e.id;n.updateWorldMatrix(!1,!1);var i=n.geometry;void 0!==i&&(null===i.boundingBox&&i.computeBoundingBox(),fr.copy(i.boundingBox),fr.applyMatrix4(n.userData.matrix[r]).applyMatrix4(n.matrixWorld),t.union(fr))}));for(var a=e.children,o=0,s=a.length;o<s;o++)this.expandByObject2(a[o]);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return void 0===t&&(t=new sr),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,pr),pr.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(Mr),wr.subVectors(this.max,Mr),mr.subVectors(e.a,Mr),vr.subVectors(e.b,Mr),gr.subVectors(e.c,Mr),yr.subVectors(vr,mr),xr.subVectors(gr,vr),br.subVectors(mr,gr);var t=[0,-yr.z,yr.y,0,-xr.z,xr.y,0,-br.z,br.y,yr.z,0,-yr.x,xr.z,0,-xr.x,br.z,0,-br.x,-yr.y,yr.x,0,-xr.y,xr.x,0,-br.y,br.x,0];return!!hr(t,mr,vr,gr,wr)&&!!hr(t=[1,0,0,0,1,0,0,0,1],mr,vr,gr,wr)&&(_r.crossVectors(yr,xr),hr(t=[_r.x,_r.y,_r.z],mr,vr,gr,wr))}},{key:"clampPoint",value:function(e,t){return void 0===t&&(t=new sr),t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return pr.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"getBoundingSphere",value:function(e){return this.getCenter(e.center),e.radius=.5*this.getSize(pr).length(),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(dr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),dr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),dr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),dr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),dr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),dr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),dr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),dr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(dr)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}])}();function hr(e,t,n,r,i){for(var a=0,o=e.length-3;a<=o;a+=3){Ar.fromArray(e,a);var s=i.x*Math.abs(Ar.x)+i.y*Math.abs(Ar.y)+i.z*Math.abs(Ar.z),l=t.dot(Ar),u=n.dot(Ar),c=r.dot(Ar);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>s)return!1}return!0}var dr=[new sr,new sr,new sr,new sr,new sr,new sr,new sr,new sr],pr=new sr,fr=new cr,mr=new sr,vr=new sr,gr=new sr,yr=new sr,xr=new sr,br=new sr,Mr=new sr,wr=new sr,_r=new sr,Ar=new sr,Cr=new cr,Tr=function(){function e(t,n){(0,v.default)(this,e),this.center=void 0!==t?t:new sr,this.radius=void 0!==n?n:-1}return(0,g.default)(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):Cr.setFromPoints(e).getCenter(n);for(var r=0,i=0,a=e.length;i<a;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(t=new sr),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return void 0===e&&(e=new cr),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}])}(),Sr=new sr,Er=new sr,Lr=new sr,Pr=new sr,Br=new sr,Dr=new sr,kr=new sr,Rr=function(){function e(t,n){(0,v.default)(this,e),this.origin=void 0!==t?t:new sr,this.direction=void 0!==n?n:new sr(0,0,-1)}return(0,g.default)(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return void 0===t&&(t=new sr),t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,Sr)),this}},{key:"closestPointToPoint",value:function(e,t){void 0===t&&(t=new sr),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=Sr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Sr.copy(this.direction).multiplyScalar(t).add(this.origin),Sr.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,r){Er.copy(e).add(t).multiplyScalar(.5),Lr.copy(t).sub(e).normalize(),Pr.copy(this.origin).sub(Er);var i,a,o,s,l=.5*e.distanceTo(t),u=-this.direction.dot(Lr),c=Pr.dot(this.direction),h=-Pr.dot(Lr),d=Pr.lengthSq(),p=Math.abs(1-u*u);if(p>0)if(a=u*c-h,s=l*p,(i=u*h-c)>=0)if(a>=-s)if(a<=s){var f=1/p;o=(i*=f)*(i+u*(a*=f)+2*c)+a*(u*i+a+2*h)+d}else a=l,o=-(i=Math.max(0,-(u*a+c)))*i+a*(a+2*h)+d;else a=-l,o=-(i=Math.max(0,-(u*a+c)))*i+a*(a+2*h)+d;else a<=-s?o=-(i=Math.max(0,-(-u*l+c)))*i+(a=i>0?-l:Math.min(Math.max(-l,-h),l))*(a+2*h)+d:a<=s?(i=0,o=(a=Math.min(Math.max(-l,-h),l))*(a+2*h)+d):o=-(i=Math.max(0,-(u*l+c)))*i+(a=i>0?l:Math.min(Math.max(-l,-h),l))*(a+2*h)+d;else a=u>0?-l:l,o=-(i=Math.max(0,-(u*a+c)))*i+a*(a+2*h)+d;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(Lr).multiplyScalar(a).add(Er),o}},{key:"intersectSphere",value:function(e,t){Sr.subVectors(e.center,this.origin);var n=Sr.dot(this.direction),r=Sr.dot(Sr)-n*n,i=e.radius*e.radius;if(r>i)return null;var a=Math.sqrt(i-r),o=n-a,s=n+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,r,i,a,o,s,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),u>=0?(i=(e.min.y-h.y)*u,a=(e.max.y-h.y)*u):(i=(e.max.y-h.y)*u,a=(e.min.y-h.y)*u),n>a||i>r?null:((i>n||n!=n)&&(n=i),(a<r||r!=r)&&(r=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||o>r?null:((o>n||n!=n)&&(n=o),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,Sr)}},{key:"intersectTriangle",value:function(e,t,n,r,i){Br.subVectors(t,e),Dr.subVectors(n,e),kr.crossVectors(Br,Dr);var a,o=this.direction.dot(kr);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Pr.subVectors(this.origin,e);var s=a*this.direction.dot(Dr.crossVectors(Pr,Dr));if(s<0)return null;var l=a*this.direction.dot(Br.cross(Pr));if(l<0)return null;if(s+l>o)return null;var u=-a*Pr.dot(kr);return u<0?null:this.at(u/o,i)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}])}(),Or=function(){function e(){(0,v.default)(this,e),Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return(0,g.default)(e,[{key:"set",value:function(e,t,n,r,i,a,o,s,l,u,c,h,d,p,f,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=r,v[1]=i,v[5]=a,v[9]=o,v[13]=s,v[2]=l,v[6]=u,v[10]=c,v[14]=h,v[3]=d,v[7]=p,v[11]=f,v[15]=m,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,r=1/Ir.setFromMatrixColumn(e,0).length(),i=1/Ir.setFromMatrixColumn(e,1).length(),a=1/Ir.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){!e||e.isEuler;var t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),l=Math.sin(r),u=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){var h=a*u,d=a*c,p=o*u,f=o*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=d+p*l,t[5]=h-f*l,t[9]=-o*s,t[2]=f-h*l,t[6]=p+d*l,t[10]=a*s}else if("YXZ"===e.order){var m=s*u,v=s*c,g=l*u,y=l*c;t[0]=m+y*o,t[4]=g*o-v,t[8]=a*l,t[1]=a*c,t[5]=a*u,t[9]=-o,t[2]=v*o-g,t[6]=y+m*o,t[10]=a*s}else if("ZXY"===e.order){var x=s*u,b=s*c,M=l*u,w=l*c;t[0]=x-w*o,t[4]=-a*c,t[8]=M+b*o,t[1]=b+M*o,t[5]=a*u,t[9]=w-x*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var _=a*u,A=a*c,C=o*u,T=o*c;t[0]=s*u,t[4]=C*l-A,t[8]=_*l+T,t[1]=s*c,t[5]=T*l+_,t[9]=A*l-C,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var S=a*s,E=a*l,L=o*s,P=o*l;t[0]=s*u,t[4]=P-S*c,t[8]=L*c+E,t[1]=c,t[5]=a*u,t[9]=-o*u,t[2]=-l*u,t[6]=E*c+L,t[10]=S-P*c}else if("XZY"===e.order){var B=a*s,D=a*l,k=o*s,R=o*l;t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=B*c+R,t[5]=a*u,t[9]=D*c-k,t[2]=k*c-D,t[6]=o*u,t[10]=R*c+B}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(Nr,e,zr)}},{key:"lookAt",value:function(e,t,n){var r=this.elements;return jr.subVectors(e,t),0===jr.lengthSq()&&(jr.z=1),jr.normalize(),Ur.crossVectors(n,jr),0===Ur.lengthSq()&&(1===Math.abs(n.z)?jr.x+=1e-4:jr.z+=1e-4,jr.normalize(),Ur.crossVectors(n,jr)),Ur.normalize(),Hr.crossVectors(jr,Ur),r[0]=Ur.x,r[4]=Hr.x,r[8]=jr.x,r[1]=Ur.y,r[5]=Hr.y,r[9]=jr.y,r[2]=Ur.z,r[6]=Hr.z,r[10]=jr.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?this.multiplyMatrices(e,t):this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],u=n[1],c=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],v=n[14],g=n[3],y=n[7],x=n[11],b=n[15],M=r[0],w=r[4],_=r[8],A=r[12],C=r[1],T=r[5],S=r[9],E=r[13],L=r[2],P=r[6],B=r[10],D=r[14],k=r[3],R=r[7],O=r[11],I=r[15];return i[0]=a*M+o*C+s*L+l*k,i[4]=a*w+o*T+s*P+l*R,i[8]=a*_+o*S+s*B+l*O,i[12]=a*A+o*E+s*D+l*I,i[1]=u*M+c*C+h*L+d*k,i[5]=u*w+c*T+h*P+d*R,i[9]=u*_+c*S+h*B+d*O,i[13]=u*A+c*E+h*D+d*I,i[2]=p*M+f*C+m*L+v*k,i[6]=p*w+f*T+m*P+v*R,i[10]=p*_+f*S+m*B+v*O,i[14]=p*A+f*E+m*D+v*I,i[3]=g*M+y*C+x*L+b*k,i[7]=g*w+y*T+x*P+b*R,i[11]=g*_+y*S+x*B+b*O,i[15]=g*A+y*E+x*D+b*I,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+i*s*c-r*l*c-i*o*h+n*l*h+r*o*d-n*s*d)+e[7]*(+t*s*d-t*l*h+i*a*h-r*a*d+r*l*u-i*s*u)+e[11]*(+t*l*c-t*o*d-i*a*c+n*a*d+i*o*u-n*l*u)+e[15]*(-r*o*u-t*s*c+t*o*h+r*a*c-n*a*h+n*s*u)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],v=e[15],g=c*m*l-f*h*l+f*s*d-o*m*d-c*s*v+o*h*v,y=p*h*l-u*m*l-p*s*d+a*m*d+u*s*v-a*h*v,x=u*f*l-p*c*l+p*o*d-a*f*d-u*o*v+a*c*v,b=p*c*s-u*f*s-p*o*h+a*f*h+u*o*m-a*c*m,M=t*g+n*y+r*x+i*b;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var w=1/M;return e[0]=g*w,e[1]=(f*h*i-c*m*i-f*r*d+n*m*d+c*r*v-n*h*v)*w,e[2]=(o*m*i-f*s*i+f*r*l-n*m*l-o*r*v+n*s*v)*w,e[3]=(c*s*i-o*h*i-c*r*l+n*h*l+o*r*d-n*s*d)*w,e[4]=y*w,e[5]=(u*m*i-p*h*i+p*r*d-t*m*d-u*r*v+t*h*v)*w,e[6]=(p*s*i-a*m*i-p*r*l+t*m*l+a*r*v-t*s*v)*w,e[7]=(a*h*i-u*s*i+u*r*l-t*h*l-a*r*d+t*s*d)*w,e[8]=x*w,e[9]=(p*c*i-u*f*i-p*n*d+t*f*d+u*n*v-t*c*v)*w,e[10]=(a*f*i-p*o*i+p*n*l-t*f*l-a*n*v+t*o*v)*w,e[11]=(u*o*i-a*c*i-u*n*l+t*c*l+a*n*d-t*o*d)*w,e[12]=b*w,e[13]=(u*f*r-p*c*r+p*n*h-t*f*h-u*n*m+t*c*m)*w,e[14]=(p*o*r-a*f*r-p*n*s+t*f*s+a*n*m-t*o*m)*w,e[15]=(a*c*r-u*o*r+u*n*s-t*c*s-a*n*h+t*o*h)*w,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,l=i*a,u=i*o;return this.set(l*a+n,l*o-r*s,l*s+r*o,0,l*o+r*s,u*o+n,u*s-r*a,0,l*s-r*o,u*s+r*a,i*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var r=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,u=a+a,c=o+o,h=i*l,d=i*u,p=i*c,f=a*u,m=a*c,v=o*c,g=s*l,y=s*u,x=s*c,b=n.x,M=n.y,w=n.z;return r[0]=(1-(f+v))*b,r[1]=(d+x)*b,r[2]=(p-y)*b,r[3]=0,r[4]=(d-x)*M,r[5]=(1-(h+v))*M,r[6]=(m+g)*M,r[7]=0,r[8]=(p+y)*w,r[9]=(m-g)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}},{key:"decompose",value:function(e,t,n){var r=this.elements,i=Ir.set(r[0],r[1],r[2]).length(),a=Ir.set(r[4],r[5],r[6]).length(),o=Ir.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Fr.copy(this);var s=1/i,l=1/a,u=1/o;return Fr.elements[0]*=s,Fr.elements[1]*=s,Fr.elements[2]*=s,Fr.elements[4]*=l,Fr.elements[5]*=l,Fr.elements[6]*=l,Fr.elements[8]*=u,Fr.elements[9]*=u,Fr.elements[10]*=u,t.setFromRotationMatrix(Fr),n.x=i,n.y=a,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,r,i,a){var o=this.elements,s=2*i/(t-e),l=2*i/(n-r),u=(t+e)/(t-e),c=(n+r)/(n-r),h=-(a+i)/(a-i),d=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=l,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,r,i,a){var o=this.elements,s=1/(t-e),l=1/(n-r),u=1/(a-i),c=(t+e)*s,h=(n+r)*l,d=(a+i)*u;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}])}(),Ir=new sr,Fr=new Or,Nr=new sr(0,0,0),zr=new sr(1,1,1),Ur=new sr,Hr=new sr,jr=new sr,Gr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;(0,v.default)(this,e),Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=n,this._z=r,this._order=i}return(0,g.default)(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e,t,n){var r=qn.clamp,i=e.elements,a=i[0],o=i[4],s=i[8],l=i[1],u=i[5],c=i[9],h=i[2],d=i[6],p=i[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(d,u),this._z=0);break;case"YXZ":this._x=Math.asin(-r(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,p),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,a),this._z=0);break;case"ZXY":this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(l,a));break;case"ZYX":this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-o,u));break;case"YZX":this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,p));break;case"XZY":this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-c,p),this._y=0)}return this._order=t,!1!==n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return Vr.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Vr,t,n)}},{key:"setFromVector3",value:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)}},{key:"reorder",value:function(e){return Wr.setFromEuler(this),this.setFromQuaternion(Wr,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"toVector3",value:function(e){return e?e.set(this._x,this._y,this._z):new sr(this._x,this._y,this._z)}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}}])}();Gr.DefaultOrder="XYZ",Gr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Vr=new Or,Wr=new or,Xr=function(){function e(){(0,v.default)(this,e),this.mask=1}return(0,g.default)(e,[{key:"set",value:function(e){this.mask=1<<e}},{key:"enable",value:function(e){this.mask|=1<<e}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e}},{key:"disable",value:function(e){this.mask&=~(1<<e)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return!!(this.mask&e.mask)}}])}(),Yr=0,Jr=new sr,Qr=new or,qr=new Or,Kr=new sr,Zr=new sr,$r=new sr,ei=new or,ti=new sr(1,0,0),ni=new sr(0,1,0),ri=new sr(0,0,1),ii={type:"added"},ai={type:"removed"};function oi(){Object.defineProperty(this,"id",{value:Yr++}),this.uuid=qn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=oi.DefaultUp.clone();var e=new sr,t=new Gr,n=new or,r=new sr(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Or},normalMatrix:{value:new Zn}}),this.matrix=new Or,this.matrixWorld=new Or,this.matrixAutoUpdate=oi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Xr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}oi.DefaultUp=new sr(0,1,0),oi.DefaultMatrixAutoUpdate=!0,oi.prototype=Object.assign(Object.create(Wn.prototype),{constructor:oi,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return Qr.setFromAxisAngle(e,t),this.quaternion.multiply(Qr),this},rotateOnWorldAxis:function(e,t){return Qr.setFromAxisAngle(e,t),this.quaternion.premultiply(Qr),this},rotateX:function(e){return this.rotateOnAxis(ti,e)},rotateY:function(e){return this.rotateOnAxis(ni,e)},rotateZ:function(e){return this.rotateOnAxis(ri,e)},translateOnAxis:function(e,t){return Jr.copy(e).applyQuaternion(this.quaternion),this.position.add(Jr.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(ti,e)},translateY:function(e){return this.translateOnAxis(ni,e)},translateZ:function(e){return this.translateOnAxis(ri,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(qr.copy(this.matrixWorld).invert())},lookAt:function(e,t,n){e.isVector3?Kr.copy(e):Kr.set(e,t,n);var r=this.parent;this.updateWorldMatrix(!0,!1),Zr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?qr.lookAt(Zr,Kr,this.up):qr.lookAt(Kr,Zr,this.up),this.quaternion.setFromRotationMatrix(qr),r&&(qr.extractRotation(r.matrixWorld),Qr.setFromRotationMatrix(qr),this.quaternion.premultiply(Qr.invert()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this||e&&e.isObject3D&&(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ii)),this},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(ai)),this},clear:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(ai)}return this.children.length=0,this},attach:function(e){return this.updateWorldMatrix(!0,!1),qr.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),qr.multiply(e.parent.matrixWorld)),e.applyMatrix4(qr),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(e=new sr),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(e=new or),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Zr,e,$r),e},getWorldScale:function(e){return void 0===e&&(e=new sr),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Zr,ei,e),e},getWorldDirection:function(e){void 0===e&&(e=new sr),this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){var t=!0,n=!1;if(this.traverseAncestors((function(e){t&&(e.visible||(t=!1)),n||e.getMode&&(n=!0)})),t||n){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var r=this.children,i=0,a=r.length;i<a;i++)r[i].updateMatrixWorld(e)}},updateWorldMatrix:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,i=0,a=r.length;i<a;i++)r[i].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,l=o.length;s<l;s++){var u=o[s];i(e.shapes,u)}else i(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var c=[],h=0,d=this.material.length;h<d;h++)c.push(i(e.materials,this.material[h]));r.material=c}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(var p=0;p<this.children.length;p++)r.children.push(this.children[p].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(var f=0;f<this.animations.length;f++){var m=this.animations[f];r.animations.push(i(e.animations,m))}}if(t){var v=_(e.geometries),g=_(e.materials),y=_(e.textures),x=_(e.images),b=_(e.shapes),M=_(e.skeletons),w=_(e.animations);v.length>0&&(n.geometries=v),g.length>0&&(n.materials=g),y.length>0&&(n.textures=y),x.length>0&&(n.images=x),b.length>0&&(n.shapes=b),M.length>0&&(n.skeletons=M),w.length>0&&(n.animations=w)}return n.object=r,n;function _(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}});var si=new sr,li=new sr,ui=new Zn,ci=function(){function e(t,n){(0,v.default)(this,e),Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==t?t:new sr(1,0,0),this.constant=void 0!==n?n:0}return(0,g.default)(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var r=si.subVectors(n,t).cross(li.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return void 0===t&&(t=new sr),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function(e,t){void 0===t&&(t=new sr);var n=e.delta(si),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:t.copy(n).multiplyScalar(i).add(e.start)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return void 0===e&&(e=new sr),e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||ui.getNormalMatrix(e),r=this.coplanarPoint(si).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}])}(),hi=new sr,di=new sr,pi=new sr,fi=new sr,mi=new sr,vi=new sr,gi=new sr,yi=new sr,xi=new sr,bi=new sr,Mi=function(){function e(t,n,r){(0,v.default)(this,e),this.a=void 0!==t?t:new sr,this.b=void 0!==n?n:new sr,this.c=void 0!==r?r:new sr}return(0,g.default)(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return hi.subVectors(this.c,this.b),di.subVectors(this.a,this.b),.5*hi.cross(di).length()}},{key:"getMidpoint",value:function(e){return void 0===e&&(e=new sr),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return void 0===e&&(e=new ci),e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,r,i,a){return e.getUV(t,this.a,this.b,this.c,n,r,i,a)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){void 0===t&&(t=new sr);var n,r,i=this.a,a=this.b,o=this.c;mi.subVectors(a,i),vi.subVectors(o,i),yi.subVectors(e,i);var s=mi.dot(yi),l=vi.dot(yi);if(s<=0&&l<=0)return t.copy(i);xi.subVectors(e,a);var u=mi.dot(xi),c=vi.dot(xi);if(u>=0&&c<=u)return t.copy(a);var h=s*c-u*l;if(h<=0&&s>=0&&u<=0)return n=s/(s-u),t.copy(i).addScaledVector(mi,n);bi.subVectors(e,o);var d=mi.dot(bi),p=vi.dot(bi);if(p>=0&&d<=p)return t.copy(o);var f=d*l-s*p;if(f<=0&&l>=0&&p<=0)return r=l/(l-p),t.copy(i).addScaledVector(vi,r);var m=u*p-d*c;if(m<=0&&c-u>=0&&d-p>=0)return gi.subVectors(o,a),r=(c-u)/(c-u+(d-p)),t.copy(a).addScaledVector(gi,r);var v=1/(m+f+h);return n=f*v,r=h*v,t.copy(i).addScaledVector(mi,n).addScaledVector(vi,r)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,r){void 0===r&&(r=new sr),r.subVectors(n,t),hi.subVectors(e,t),r.cross(hi);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,r,i){hi.subVectors(r,t),di.subVectors(n,t),pi.subVectors(e,t);var a=hi.dot(hi),o=hi.dot(di),s=hi.dot(pi),l=di.dot(di),u=di.dot(pi),c=a*l-o*o;if(void 0===i&&(i=new sr),0===c)return i.set(-2,-1,-1);var h=1/c,d=(l*s-o*u)*h,p=(a*u-o*s)*h;return i.set(1-d-p,p,d)}},{key:"containsPoint",value:function(e,t,n,r){return this.getBarycoord(e,t,n,r,fi),fi.x>=0&&fi.y>=0&&fi.x+fi.y<=1}},{key:"getUV",value:function(e,t,n,r,i,a,o,s){return this.getBarycoord(e,t,n,r,fi),s.set(0,0),s.addScaledVector(i,fi.x),s.addScaledVector(a,fi.y),s.addScaledVector(o,fi.z),s}},{key:"isFrontFacing",value:function(e,t,n,r){return hi.subVectors(n,t),di.subVectors(e,t),hi.cross(di).dot(r)<0}}])}(),wi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_i={h:0,s:0,l:0},Ai={h:0,s:0,l:0};function Ci(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Ti(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Si(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var Ei=function(){function e(t,n,r){return(0,v.default)(this,e),Object.defineProperty(this,"isColor",{value:!0}),void 0===n&&void 0===r?this.set(t):this.setRGB(t,n,r)}return(0,g.default)(e,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}},{key:"setRGB",value:function(e,t,n){return this.r=e,this.g=t,this.b=n,this}},{key:"setHSL",value:function(e,t,n){if(e=qn.euclideanModulo(e,1),t=qn.clamp(t,0,1),n=qn.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=Ci(i,r,e+1/3),this.g=Ci(i,r,e),this.b=Ci(i,r,e-1/3)}return this}},{key:"setStyle",value:function(e){function t(e){void 0!==e&&parseFloat(e)}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r,i=n[1],a=n[2];switch(i){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,l=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(o,s,l)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var u=n[1],c=u.length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}},{key:"setColorName",value:function(e){var t=wi[e];return void 0!==t&&this.setHex(t),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copyGammaToLinear",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}},{key:"copyLinearToGamma",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}},{key:"convertGammaToLinear",value:function(e){return this.copyGammaToLinear(this,e),this}},{key:"convertLinearToGamma",value:function(e){return this.copyLinearToGamma(this,e),this}},{key:"copySRGBToLinear",value:function(e){return this.r=Ti(e.r),this.g=Ti(e.g),this.b=Ti(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=Si(e.r),this.g=Si(e.g),this.b=Si(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){return 255*this.r<<16^255*this.g<<8^255*this.b}},{key:"getHexString",value:function(){return("000000"+this.getHex().toString(16)).slice(-6)}},{key:"getHSL",value:function(e){void 0===e&&(e={h:0,s:0,l:0});var t,n,r=this.r,i=this.g,a=this.b,o=Math.max(r,i,a),s=Math.min(r,i,a),l=(s+o)/2;if(s===o)t=0,n=0;else{var u=o-s;switch(n=l<=.5?u/(o+s):u/(2-o-s),o){case r:t=(i-a)/u+(i<a?6:0);break;case i:t=(a-r)/u+2;break;case a:t=(r-i)/u+4}t/=6}return e.h=t,e.s=n,e.l=l,e}},{key:"getStyle",value:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(_i),_i.h+=e,_i.s+=t,_i.l+=n,this.setHSL(_i.h,_i.s,_i.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(_i),e.getHSL(Ai);var n=qn.lerp(_i.h,Ai.h,t),r=qn.lerp(_i.s,Ai.s,t),i=qn.lerp(_i.l,Ai.l,t);return this.setHSL(n,r,i),this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}},{key:"toJSON",value:function(){return this.getHex()}}])}();Ei.NAMES=wi,Ei.prototype.r=1,Ei.prototype.g=1,Ei.prototype.b=1;var Li=function(){function e(t,n,r,i,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;(0,v.default)(this,e),this.a=t,this.b=n,this.c=r,this.normal=i&&i.isVector3?i:new sr,this.vertexNormals=Array.isArray(i)?i:[],this.color=a&&a.isColor?a:new Ei,this.vertexColors=Array.isArray(a)?a:[],this.materialIndex=o}return(0,g.default)(e,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var r=0,i=e.vertexColors.length;r<i;r++)this.vertexColors[r]=e.vertexColors[r].clone();return this}}])}(),Pi=0;function Bi(){Object.defineProperty(this,"id",{value:Pi++}),this.uuid=qn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=L,this.side=M,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=G,this.blendDst=V,this.blendEquation=R,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=$,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=kn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=xn,this.stencilZFail=xn,this.stencilZPass=xn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Di(e){Bi.call(this),this.type="MeshBasicMaterial",this.color=new Ei(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ie,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}Bi.prototype=Object.assign(Object.create(Wn.prototype),{constructor:Bi,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var r=this[t];void 0!==r&&(r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n)}else this.flatShading=n===A}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==L&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==M&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var i=r(e.textures),a=r(e.images);i.length>0&&(n.textures=i),a.length>0&&(n.images=a)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Bi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Di.prototype=Object.create(Bi.prototype),Di.prototype.constructor=Di,Di.prototype.isMeshBasicMaterial=!0,Di.prototype.copy=function(e){return Bi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var ki=new sr,Ri=new Kn;function Oi(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=Rn,this.updateRange={offset:0,count:-1},this.version=0}function Ii(e,t,n){Oi.call(this,new Int8Array(e),t,n)}function Fi(e,t,n){Oi.call(this,new Uint8Array(e),t,n)}function Ni(e,t,n){Oi.call(this,new Uint8ClampedArray(e),t,n)}function zi(e,t,n){Oi.call(this,new Int16Array(e),t,n)}function Ui(e,t,n){Oi.call(this,new Uint16Array(e),t,n)}function Hi(e,t,n){Oi.call(this,new Int32Array(e),t,n)}function ji(e,t,n){Oi.call(this,new Uint32Array(e),t,n)}function Gi(e,t,n){Oi.call(this,new Uint16Array(e),t,n)}function Vi(e,t,n){Oi.call(this,new Float32Array(e),t,n)}function Wi(e,t,n){Oi.call(this,new Float64Array(e),t,n)}Object.defineProperty(Oi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Oi.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(a=new Ei),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(a=new Kn),t[n++]=a.x,t[n++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(a=new sr),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(a=new rr),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this},applyMatrix3:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)Ri.fromBufferAttribute(this,t),Ri.applyMatrix3(e),this.setXY(t,Ri.x,Ri.y);else if(3===this.itemSize)for(var r=0,i=this.count;r<i;r++)ki.fromBufferAttribute(this,r),ki.applyMatrix3(e),this.setXYZ(r,ki.x,ki.y,ki.z);return this},applyMatrix4:function(e){for(var t=0,n=this.count;t<n;t++)ki.x=this.getX(t),ki.y=this.getY(t),ki.z=this.getZ(t),ki.applyMatrix4(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this},applyNormalMatrix:function(e){for(var t=0,n=this.count;t<n;t++)ki.x=this.getX(t),ki.y=this.getY(t),ki.z=this.getZ(t),ki.applyNormalMatrix(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this},transformDirection:function(e){for(var t=0,n=this.count;t<n;t++)ki.x=this.getX(t),ki.y=this.getY(t),ki.z=this.getZ(t),ki.transformDirection(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this},set:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Ii.prototype=Object.create(Oi.prototype),Ii.prototype.constructor=Ii,Fi.prototype=Object.create(Oi.prototype),Fi.prototype.constructor=Fi,Ni.prototype=Object.create(Oi.prototype),Ni.prototype.constructor=Ni,zi.prototype=Object.create(Oi.prototype),zi.prototype.constructor=zi,Ui.prototype=Object.create(Oi.prototype),Ui.prototype.constructor=Ui,Hi.prototype=Object.create(Oi.prototype),Hi.prototype.constructor=Hi,ji.prototype=Object.create(Oi.prototype),ji.prototype.constructor=ji,Gi.prototype=Object.create(Oi.prototype),Gi.prototype.constructor=Gi,Gi.prototype.isFloat16BufferAttribute=!0,Vi.prototype=Object.create(Oi.prototype),Vi.prototype.constructor=Vi,Wi.prototype=Object.create(Oi.prototype),Wi.prototype.constructor=Wi;var Xi=function(){function e(){(0,v.default)(this,e),this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}return(0,g.default)(e,[{key:"computeGroups",value:function(e){var t,n,r,i=[],a=e.faces;for(n=0;n<a.length;n++){var o=a[n];o.materialIndex!==r&&(r=o.materialIndex,void 0!==t&&(t.count=3*n-t.start,i.push(t)),t={start:3*n,materialIndex:r})}void 0!==t&&(t.count=3*n-t.start,i.push(t)),this.groups=i}},{key:"fromGeometry",value:function(e){var t,n=e.faces,r=e.vertices,i=e.faceVertexUvs,a=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var u=0;u<l;u++)t[u]={name:s[u].name,data:[]};this.morphTargets.position=t}var c,h=e.morphNormals,d=h.length;if(d>0){c=[];for(var p=0;p<d;p++)c[p]={name:h[p].name,data:[]};this.morphTargets.normal=c}var f=e.skinIndices,m=e.skinWeights,v=f.length===r.length,g=m.length===r.length;r.length>0&&n.length;for(var y=0;y<n.length;y++){var x=n[y];this.vertices.push(r[x.a],r[x.b],r[x.c]);var b=x.vertexNormals;if(3===b.length)this.normals.push(b[0],b[1],b[2]);else{var M=x.normal;this.normals.push(M,M,M)}var w=x.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var _=x.color;this.colors.push(_,_,_)}if(!0===a){var A=i[0][y];void 0!==A?this.uvs.push(A[0],A[1],A[2]):this.uvs.push(new Kn,new Kn,new Kn)}if(!0===o){var C=i[1][y];void 0!==C?this.uvs2.push(C[0],C[1],C[2]):this.uvs2.push(new Kn,new Kn,new Kn)}for(var T=0;T<l;T++){var S=s[T].vertices;t[T].data.push(S[x.a],S[x.b],S[x.c])}for(var E=0;E<d;E++){var L=h[E].vertexNormals[y];c[E].data.push(L.a,L.b,L.c)}v&&this.skinIndices.push(f[x.a],f[x.b],f[x.c]),g&&this.skinWeights.push(m[x.a],m[x.b],m[x.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}])}();function Yi(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}var Ji={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Qi(e,t){return new Ji[e](t)}var qi=1,Ki=new Or,Zi=new oi,$i=new sr,ea=new cr,ta=new cr,na=new sr;function ra(){Object.defineProperty(this,"id",{value:qi+=2}),this.uuid=qn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}ra.prototype=Object.assign(Object.create(Wn.prototype),{constructor:ra,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){return Array.isArray(e)?this.index=new(Yi(e)>65535?ji:Ui)(e,1):this.index=e,this},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},hasAttribute:function(e){return void 0!==this.attributes[e]},addGroup:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new Zn).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return Ki.makeRotationX(e),this.applyMatrix4(Ki),this},rotateY:function(e){return Ki.makeRotationY(e),this.applyMatrix4(Ki),this},rotateZ:function(e){return Ki.makeRotationZ(e),this.applyMatrix4(Ki),this},translate:function(e,t,n){return Ki.makeTranslation(e,t,n),this.applyMatrix4(Ki),this},scale:function(e,t,n){return Ki.makeScale(e,t,n),this.applyMatrix4(Ki),this},lookAt:function(e){return Zi.lookAt(e),Zi.updateMatrix(),this.applyMatrix4(Zi.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter($i).negate(),this.translate($i.x,$i.y,$i.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var n=new Vi(3*t.vertices.length,3),r=new Vi(3*t.colors.length,3);if(this.setAttribute("position",n.copyVector3sArray(t.vertices)),this.setAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new Vi(t.lineDistances.length,1);this.setAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Vi(t,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var n=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(n=void 0,t.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(t);n.verticesNeedUpdate=t.verticesNeedUpdate,n.normalsNeedUpdate=t.normalsNeedUpdate,n.colorsNeedUpdate=t.colorsNeedUpdate,n.uvsNeedUpdate=t.uvsNeedUpdate,n.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=n}if(!0===t.verticesNeedUpdate){var r=this.attributes.position;void 0!==r&&(r.copyVector3sArray(t.vertices),r.needsUpdate=!0),t.verticesNeedUpdate=!1}if(!0===t.normalsNeedUpdate){var i=this.attributes.normal;void 0!==i&&(i.copyVector3sArray(t.normals),i.needsUpdate=!0),t.normalsNeedUpdate=!1}if(!0===t.colorsNeedUpdate){var a=this.attributes.color;void 0!==a&&(a.copyColorsArray(t.colors),a.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){var o=this.attributes.uv;void 0!==o&&(o.copyVector2sArray(t.uvs),o.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){var s=this.attributes.lineDistance;void 0!==s&&(s.copyArray(t.lineDistances),s.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Xi).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new Oi(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);this.setAttribute("normal",new Oi(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.setAttribute("color",new Oi(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new Oi(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new Oi(a,2).copyVector2sArray(e.uvs2))}for(var o in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[o],u=0,c=l.length;u<c;u++){var h=l[u],d=new Vi(3*h.data.length,3);d.name=h.name,s.push(d.copyVector3sArray(h.data))}this.morphAttributes[o]=s}if(e.skinIndices.length>0){var p=new Vi(4*e.skinIndices.length,4);this.setAttribute("skinIndex",p.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new Vi(4*e.skinWeights.length,4);this.setAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new cr);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingBox.set(new sr(-1/0,-1/0,-1/0),new sr(1/0,1/0,1/0));else{if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var i=t[n];ea.setFromBufferAttribute(i),this.morphTargetsRelative?(na.addVectors(this.boundingBox.min,ea.min),this.boundingBox.expandByPoint(na),na.addVectors(this.boundingBox.max,ea.max),this.boundingBox.expandByPoint(na)):(this.boundingBox.expandByPoint(ea.min),this.boundingBox.expandByPoint(ea.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Tr);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingSphere.set(new sr,1/0);else if(e){var n=this.boundingSphere.center;if(ea.setFromBufferAttribute(e),t)for(var r=0,i=t.length;r<i;r++){var a=t[r];ta.setFromBufferAttribute(a),this.morphTargetsRelative?(na.addVectors(ea.min,ta.min),ea.expandByPoint(na),na.addVectors(ea.max,ta.max),ea.expandByPoint(na)):(ea.expandByPoint(ta.min),ea.expandByPoint(ta.max))}ea.getCenter(n);for(var o=0,s=0,l=e.count;s<l;s++)na.fromBufferAttribute(e,s),o=Math.max(o,n.distanceToSquared(na));if(t)for(var u=0,c=t.length;u<c;u++)for(var h=t[u],d=this.morphTargetsRelative,p=0,f=h.count;p<f;p++)na.fromBufferAttribute(h,p),d&&($i.fromBufferAttribute(e,p),na.add($i)),o=Math.max(o,n.distanceToSquared(na));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new Oi(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var r=0,i=n.count;r<i;r++)n.setXYZ(r,0,0,0);var a=new sr,o=new sr,s=new sr,l=new sr,u=new sr,c=new sr,h=new sr,d=new sr;if(e)for(var p=0,f=e.count;p<f;p+=3){var m=e.getX(p+0),v=e.getX(p+1),g=e.getX(p+2);a.fromBufferAttribute(t,m),o.fromBufferAttribute(t,v),s.fromBufferAttribute(t,g),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),l.fromBufferAttribute(n,m),u.fromBufferAttribute(n,v),c.fromBufferAttribute(n,g),l.add(h),u.add(h),c.add(h),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(v,u.x,u.y,u.z),n.setXYZ(g,c.x,c.y,c.z)}else for(var y=0,x=t.count;y<x;y+=3)a.fromBufferAttribute(t,y+0),o.fromBufferAttribute(t,y+1),s.fromBufferAttribute(t,y+2),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),n.setXYZ(y+0,h.x,h.y,h.z),n.setXYZ(y+1,h.x,h.y,h.z),n.setXYZ(y+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0);var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var i=n[r].array,a=e.attributes[r],o=a.array,s=a.itemSize*t,l=Math.min(o.length,i.length-s),u=0,c=s;u<l;u++,c++)i[c]=o[u];return this}},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)na.fromBufferAttribute(e,t),na.normalize(),e.setXYZ(t,na.x,na.y,na.z)},toNonIndexed:function(){function e(e,t){for(var n=e.array,r=e.itemSize,i=e.normalized,a=new n.constructor(t.length*r),o=0,s=0,l=0,u=t.length;l<u;l++){o=t[l]*r;for(var c=0;c<r;c++)a[s++]=n[o++]}return new Oi(a,r,i)}if(null===this.index)return this;var t=new ra,n=this.index.array,r=this.attributes;for(var i in r){var a=e(r[i],n);t.setAttribute(i,a)}var o=this.morphAttributes;for(var s in o){for(var l=[],u=o[s],c=0,h=u.length;c<h;c++){var d=e(u[c],n);l.push(d)}t.morphAttributes[s]=l}t.morphTargetsRelative=this.morphTargetsRelative;for(var p=this.groups,f=0,m=p.length;f<m;f++){var v=p[f];t.addGroup(v.start,v.count,v.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var i=this.attributes;for(var a in i){var o=i[a],s=o.toJSON(e.data);""!==o.name&&(s.name=o.name),e.data.attributes[a]=s}var l={},u=!1;for(var c in this.morphAttributes){for(var h=this.morphAttributes[c],d=[],p=0,f=h.length;p<f;p++){var m=h[p],v=m.toJSON(e.data);""!==m.name&&(v.name=m.name),d.push(v)}d.length>0&&(l[c]=d,u=!0)}u&&(e.data.morphAttributes=l,e.data.morphTargetsRelative=this.morphTargetsRelative);var g=this.groups;g.length>0&&(e.data.groups=JSON.parse(JSON.stringify(g)));var y=this.boundingSphere;return null!==y&&(e.data.boundingSphere={center:y.center.toArray(),radius:y.radius}),e},clone:function(){return(new ra).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var r=e.attributes;for(var i in r){var a=r[i];this.setAttribute(i,a.clone(t))}var o=e.morphAttributes;for(var s in o){for(var l=[],u=o[s],c=0,h=u.length;c<h;c++)l.push(u[c].clone(t));this.morphAttributes[s]=l}this.morphTargetsRelative=e.morphTargetsRelative;for(var d=e.groups,p=0,f=d.length;p<f;p++){var m=d[p];this.addGroup(m.start,m.count,m.materialIndex)}var v=e.boundingBox;null!==v&&(this.boundingBox=v.clone());var g=e.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ia=new Or,aa=new Rr,oa=new Tr,sa=new sr,la=new sr,ua=new sr,ca=new sr,ha=new sr,da=new sr,pa=new sr,fa=new sr,ma=new sr,va=new Kn,ga=new Kn,ya=new Kn,xa=new sr,ba=new sr;function Ma(e,t){oi.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new ra,this.material=void 0!==t?t:new Di,this.updateMorphTargets()}function wa(e,t,n,r,i,a,o,s){if(null===(t.side===w?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,t.side!==_,s)))return null;ba.copy(s),ba.applyMatrix4(e.matrixWorld);var l=n.ray.origin.distanceTo(ba);return l<n.near||l>n.far?null:{distance:l,point:ba.clone(),object:e}}function _a(e,t,n,r,i,a,o,s,l,u,c,h){sa.fromBufferAttribute(i,u),la.fromBufferAttribute(i,c),ua.fromBufferAttribute(i,h);var d=e.morphTargetInfluences;if(t.morphTargets&&a&&d){pa.set(0,0,0),fa.set(0,0,0),ma.set(0,0,0);for(var p=0,f=a.length;p<f;p++){var m=d[p],v=a[p];0!==m&&(ca.fromBufferAttribute(v,u),ha.fromBufferAttribute(v,c),da.fromBufferAttribute(v,h),o?(pa.addScaledVector(ca,m),fa.addScaledVector(ha,m),ma.addScaledVector(da,m)):(pa.addScaledVector(ca.sub(sa),m),fa.addScaledVector(ha.sub(la),m),ma.addScaledVector(da.sub(ua),m)))}sa.add(pa),la.add(fa),ua.add(ma)}e.isSkinnedMesh&&(e.boneTransform(u,sa),e.boneTransform(c,la),e.boneTransform(h,ua));var g=wa(e,t,n,r,sa,la,ua,xa);if(g){s&&(va.fromBufferAttribute(s,u),ga.fromBufferAttribute(s,c),ya.fromBufferAttribute(s,h),g.uv=Mi.getUV(xa,sa,la,ua,va,ga,ya,new Kn)),l&&(va.fromBufferAttribute(l,u),ga.fromBufferAttribute(l,c),ya.fromBufferAttribute(l,h),g.uv2=Mi.getUV(xa,sa,la,ua,va,ga,ya,new Kn));var y=new Li(u,c,h);Mi.getNormal(sa,la,ua,y.normal),g.face=y}return g}Ma.prototype=Object.assign(Object.create(oi.prototype),{constructor:Ma,isMesh:!0,copy:function(e){return oi.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,a=r.length;i<a;i++){var o=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;void 0!==s&&s.length}},raycast:function(e,t){if(this.visible){var n=!0,r=!1;if(this.traverseAncestors((function(e){n&&(e.visible||(n=!1)),r||e.getMode&&(r=!0)})),n||r){var i,a=this.geometry,o=this.material,s=this.matrixWorld;if(void 0!==o&&(null===a.boundingSphere&&a.computeBoundingSphere(),oa.copy(a.boundingSphere),oa.applyMatrix4(s),!1!==e.ray.intersectsSphere(oa)&&(ia.copy(s).invert(),aa.copy(e.ray).applyMatrix4(ia),null===a.boundingBox||!1!==aa.intersectsBox(a.boundingBox))))if(a.isBufferGeometry){var l=a.index,u=a.attributes.position,c=a.morphAttributes.position,h=a.morphTargetsRelative,d=a.attributes.uv,p=a.attributes.uv2,f=a.groups,m=a.drawRange;if(null!==l)if(Array.isArray(o))for(var v=0,g=f.length;v<g;v++)for(var y=f[v],x=o[y.materialIndex],b=Math.max(y.start,m.start),M=Math.min(y.start+y.count,m.start+m.count);b<M;b+=3){var w=l.getX(b),_=l.getX(b+1),A=l.getX(b+2);(i=_a(this,x,e,aa,u,c,h,d,p,w,_,A))&&(i.faceIndex=Math.floor(b/3),i.face.materialIndex=y.materialIndex,t.push(i))}else for(var C=Math.max(0,m.start),T=Math.min(l.count,m.start+m.count);C<T;C+=3){var S=l.getX(C),E=l.getX(C+1),L=l.getX(C+2);(i=_a(this,o,e,aa,u,c,h,d,p,S,E,L))&&(i.faceIndex=Math.floor(C/3),t.push(i))}else if(void 0!==u)if(Array.isArray(o))for(var P=0,B=f.length;P<B;P++)for(var D=f[P],k=o[D.materialIndex],R=Math.max(D.start,m.start),O=Math.min(D.start+D.count,m.start+m.count);R<O;R+=3)(i=_a(this,k,e,aa,u,c,h,d,p,R,R+1,R+2))&&(i.faceIndex=Math.floor(R/3),i.face.materialIndex=D.materialIndex,t.push(i));else for(var I=Math.max(0,m.start),F=Math.min(u.count,m.start+m.count);I<F;I+=3)(i=_a(this,o,e,aa,u,c,h,d,p,I,I+1,I+2))&&(i.faceIndex=Math.floor(I/3),t.push(i))}else if(a.isGeometry){var N,z=Array.isArray(o),U=a.vertices,H=a.faces,j=a.faceVertexUvs[0];j.length>0&&(N=j);for(var G=0,V=H.length;G<V;G++){var W=H[G],X=z?o[W.materialIndex]:o;if(void 0!==X){var Y=U[W.a],J=U[W.b],Q=U[W.c];if(i=wa(this,X,e,aa,Y,J,Q,xa)){if(N&&N[G]){var q=N[G];va.copy(q[0]),ga.copy(q[1]),ya.copy(q[2]),i.uv=Mi.getUV(xa,Y,J,Q,va,ga,ya,new Kn)}i.face=W,i.faceIndex=G,t.push(i)}}}}}}}});var Aa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;(0,v.default)(this,t),(e=T(this,t)).type="BoxBufferGeometry",e.parameters={width:n,height:r,depth:i,widthSegments:a,heightSegments:o,depthSegments:s};var l=e;a=Math.floor(a),o=Math.floor(o),s=Math.floor(s);var u=[],c=[],h=[],d=[],p=0,f=0;function m(e,t,n,r,i,a,o,s,m,v,g){for(var y=a/m,x=o/v,b=a/2,M=o/2,w=s/2,_=m+1,A=v+1,C=0,T=0,S=new sr,E=0;E<A;E++)for(var L=E*x-M,P=0;P<_;P++){var B=P*y-b;S[e]=B*r,S[t]=L*i,S[n]=w,c.push(S.x,S.y,S.z),S[e]=0,S[t]=0,S[n]=s>0?1:-1,h.push(S.x,S.y,S.z),d.push(P/m),d.push(1-E/v),C+=1}for(var D=0;D<v;D++)for(var k=0;k<m;k++){var R=p+k+_*D,O=p+k+_*(D+1),I=p+(k+1)+_*(D+1),F=p+(k+1)+_*D;u.push(R,O,F),u.push(O,I,F),T+=6}l.addGroup(f,T,g),f+=T,p+=C}return m("z","y","x",-1,-1,i,r,n,s,o,0),m("z","y","x",1,-1,i,r,-n,s,o,1),m("x","z","y",1,1,n,i,r,a,s,2),m("x","z","y",1,-1,n,i,-r,a,s,3),m("x","y","z",1,-1,n,r,i,a,o,4),m("x","y","z",-1,-1,n,r,-i,a,o,5),e.setIndex(u),e.setAttribute("position",new Vi(c,3)),e.setAttribute("normal",new Vi(h,3)),e.setAttribute("uv",new Vi(d,2)),e}return(0,m.default)(t,e),(0,g.default)(t)}(ra);function Ca(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}return t}function Ta(e){for(var t={},n=0;n<e.length;n++){var r=Ca(e[n]);for(var i in r)t[i]=r[i]}return t}var Sa={clone:Ca,merge:Ta},Ea="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",La="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function Pa(e){Bi.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Ea,this.fragmentShader=La,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(e.attributes,this.setValues(e))}function Ba(){oi.call(this),this.type="Camera",this.matrixWorldInverse=new Or,this.projectionMatrix=new Or,this.projectionMatrixInverse=new Or}function Da(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;Ba.call(this),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Pa.prototype=Object.create(Bi.prototype),Pa.prototype.constructor=Pa,Pa.prototype.isShaderMaterial=!0,Pa.prototype.copy=function(e){return Bi.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ca(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this},Pa.prototype.toJSON=function(e){var t=Bi.prototype.toJSON.call(this,e);for(var n in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var i={};for(var a in this.extensions)!0===this.extensions[a]&&(i[a]=!0);return Object.keys(i).length>0&&(t.extensions=i),t},Ba.prototype=Object.assign(Object.create(oi.prototype),{constructor:Ba,isCamera:!0,copy:function(e,t){return oi.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(e=new sr),this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){oi.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(e,t){oi.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),Da.prototype=Object.assign(Object.create(Ba.prototype),{constructor:Da,isPerspectiveCamera:!0,copy:function(e,t){return Ba.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*qn.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*qn.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*qn.RAD2DEG*Math.atan(Math.tan(.5*qn.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*qn.DEG2RAD*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;i+=a.offsetX*r/o,t-=a.offsetY*n/s,r*=a.width/o,n*=a.height/s}var l=this.filmOffset;0!==l&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){var t=oi.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var ka=90,Ra=1;function Oa(e,t,n){if(oi.call(this),this.type="CubeCamera",!0===n.isWebGLCubeRenderTarget){this.renderTarget=n;var r=new Da(ka,Ra,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new sr(1,0,0)),this.add(r);var i=new Da(ka,Ra,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new sr(-1,0,0)),this.add(i);var a=new Da(ka,Ra,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new sr(0,1,0)),this.add(a);var o=new Da(ka,Ra,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new sr(0,-1,0)),this.add(o);var s=new Da(ka,Ra,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new sr(0,0,1)),this.add(s);var l=new Da(ka,Ra,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new sr(0,0,-1)),this.add(l),this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var u=e.xr.enabled,c=e.getRenderTarget();e.xr.enabled=!1;var h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,a),e.setRenderTarget(n,3),e.render(t,o),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(c),e.xr.enabled=u}}}function Ia(e,t,n,r,i,a,o,s,l,u){e=void 0!==e?e:[],t=void 0!==t?t:fe,o=void 0!==o?o:Xe,tr.call(this,e,t,n,r,i,a,o,s,l,u),this.flipY=!1,this._needsFlipEnvMap=!0}function Fa(e,t,n){Number.isInteger(t)&&(t=n),ir.call(this,e,e,t),t=t||{},this.texture=new Ia(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture._needsFlipEnvMap=!1}function Na(e,t,n,r,i,a,o,s,l,u,c,h){tr.call(this,null,a,o,s,l,u,r,i,c,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==l?l:_e,this.minFilter=void 0!==u?u:_e,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Oa.prototype=Object.create(oi.prototype),Oa.prototype.constructor=Oa,Ia.prototype=Object.create(tr.prototype),Ia.prototype.constructor=Ia,Ia.prototype.isCubeTexture=!0,Object.defineProperty(Ia.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),Fa.prototype=Object.create(ir.prototype),Fa.prototype.constructor=Fa,Fa.prototype.isWebGLCubeRenderTarget=!0,Fa.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=Ye,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",fragmentShader:"\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t"},r=new Aa(5,5,5),i=new Pa({name:"CubemapFromEquirect",uniforms:Ca(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:w,blending:E});i.uniforms.tEquirect.value=t;var a=new Ma(r,i),o=t.minFilter;return t.minFilter===Be&&(t.minFilter=Ee),new Oa(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this},Fa.prototype.clear=function(e,t,n,r){for(var i=e.getRenderTarget(),a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,r);e.setRenderTarget(i)},Na.prototype=Object.create(tr.prototype),Na.prototype.constructor=Na,Na.prototype.isDataTexture=!0;var za=new Tr,Ua=new sr,Ha=function(){function e(t,n,r,i,a,o){(0,v.default)(this,e),this.planes=[void 0!==t?t:new ci,void 0!==n?n:new ci,void 0!==r?r:new ci,void 0!==i?i:new ci,void 0!==a?a:new ci,void 0!==o?o:new ci]}return(0,g.default)(e,[{key:"set",value:function(e,t,n,r,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],l=n[5],u=n[6],c=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],v=n[13],g=n[14],y=n[15];return t[0].setComponents(o-r,c-s,f-h,y-m).normalize(),t[1].setComponents(o+r,c+s,f+h,y+m).normalize(),t[2].setComponents(o+i,c+l,f+d,y+v).normalize(),t[3].setComponents(o-i,c-l,f-d,y-v).normalize(),t[4].setComponents(o-a,c-u,f-p,y-g).normalize(),t[5].setComponents(o+a,c+u,f+p,y+g).normalize(),this}},{key:"intersectsObject",value:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),za.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(za)}},{key:"intersectsSprite",value:function(e){return za.center.set(0,0,0),za.radius=.7071067811865476,za.applyMatrix4(e.matrixWorld),this.intersectsSphere(za)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++)if(t[i].distanceToPoint(n)<r)return!1;return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if(Ua.x=r.normal.x>0?e.max.x:e.min.x,Ua.y=r.normal.y>0?e.max.y:e.min.y,Ua.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Ua)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}}])}();function ja(){var e=null,t=!1,n=null,r=null;function i(t,a){n(t,a),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Ga(e,t){var n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){var a=r.get(t);(!a||a.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var o=r.get(t);void 0===o?r.set(t,function(t,r){var i=t.array,a=t.usage,o=e.createBuffer();e.bindBuffer(r,o),e.bufferData(r,i,a),t.onUploadCallback();var s=5126;return i instanceof Float32Array?s=5126:i instanceof Float64Array||(i instanceof Uint16Array?t.isFloat16BufferAttribute?n&&(s=5131):s=5123:i instanceof Int16Array?s=5122:i instanceof Uint32Array?s=5125:i instanceof Int32Array?s=5124:i instanceof Int8Array?s=5120:i instanceof Uint8Array&&(s=5121)),{buffer:o,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):o.version<t.version&&(function(t,r,i){var a=r.array,o=r.updateRange;e.bindBuffer(i,t),-1===o.count?e.bufferSubData(i,0,a):(n?e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(o.buffer,t,i),o.version=t.version)}}}}var Va=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;(0,v.default)(this,t),(e=T(this,t)).type="PlaneBufferGeometry",e.parameters={width:n,height:r,widthSegments:i,heightSegments:a};for(var o=n/2,s=r/2,l=Math.floor(i),u=Math.floor(a),c=l+1,h=u+1,d=n/l,p=r/u,f=[],m=[],g=[],y=[],x=0;x<h;x++)for(var b=x*p-s,M=0;M<c;M++){var w=M*d-o;m.push(w,-b,0),g.push(0,0,1),y.push(M/l),y.push(1-x/u)}for(var _=0;_<u;_++)for(var A=0;A<l;A++){var C=A+c*_,S=A+c*(_+1),E=A+1+c*(_+1),L=A+1+c*_;f.push(C,S,L),f.push(S,E,L)}return e.setIndex(f),e.setAttribute("position",new Vi(m,3)),e.setAttribute("normal",new Vi(g,3)),e.setAttribute("uv",new Vi(y,2)),e}return(0,m.default)(t,e),(0,g.default)(t)}(ra),Wa={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_begin2:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS < 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS < 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS < 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Xa={common:{diffuse:{value:new Ei(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Zn},uv2Transform:{value:new Zn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Kn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ei(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ei(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Zn}},sprite:{diffuse:{value:new Ei(15658734)},opacity:{value:1},center:{value:new Kn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Zn}}},Ya={basic:{uniforms:Ta([Xa.common,Xa.specularmap,Xa.envmap,Xa.aomap,Xa.lightmap,Xa.fog]),vertexShader:Wa.meshbasic_vert,fragmentShader:Wa.meshbasic_frag},lambert:{uniforms:Ta([Xa.common,Xa.specularmap,Xa.envmap,Xa.aomap,Xa.lightmap,Xa.emissivemap,Xa.fog,Xa.lights,{emissive:{value:new Ei(0)}}]),vertexShader:Wa.meshlambert_vert,fragmentShader:Wa.meshlambert_frag},phong:{uniforms:Ta([Xa.common,Xa.specularmap,Xa.envmap,Xa.aomap,Xa.lightmap,Xa.emissivemap,Xa.bumpmap,Xa.normalmap,Xa.displacementmap,Xa.fog,Xa.lights,{emissive:{value:new Ei(0)},specular:{value:new Ei(1118481)},shininess:{value:30}}]),vertexShader:Wa.meshphong_vert,fragmentShader:Wa.meshphong_frag},standard:{uniforms:Ta([Xa.common,Xa.envmap,Xa.aomap,Xa.lightmap,Xa.emissivemap,Xa.bumpmap,Xa.normalmap,Xa.displacementmap,Xa.roughnessmap,Xa.metalnessmap,Xa.fog,Xa.lights,{emissive:{value:new Ei(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Wa.meshphysical_vert,fragmentShader:Wa.meshphysical_frag},toon:{uniforms:Ta([Xa.common,Xa.aomap,Xa.lightmap,Xa.emissivemap,Xa.bumpmap,Xa.normalmap,Xa.displacementmap,Xa.gradientmap,Xa.fog,Xa.lights,{emissive:{value:new Ei(0)}}]),vertexShader:Wa.meshtoon_vert,fragmentShader:Wa.meshtoon_frag},matcap:{uniforms:Ta([Xa.common,Xa.bumpmap,Xa.normalmap,Xa.displacementmap,Xa.fog,{matcap:{value:null}}]),vertexShader:Wa.meshmatcap_vert,fragmentShader:Wa.meshmatcap_frag},points:{uniforms:Ta([Xa.points,Xa.fog]),vertexShader:Wa.points_vert,fragmentShader:Wa.points_frag},dashed:{uniforms:Ta([Xa.common,Xa.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Wa.linedashed_vert,fragmentShader:Wa.linedashed_frag},depth:{uniforms:Ta([Xa.common,Xa.displacementmap]),vertexShader:Wa.depth_vert,fragmentShader:Wa.depth_frag},normal:{uniforms:Ta([Xa.common,Xa.bumpmap,Xa.normalmap,Xa.displacementmap,{opacity:{value:1}}]),vertexShader:Wa.normal_vert,fragmentShader:Wa.normal_frag},sprite:{uniforms:Ta([Xa.sprite,Xa.fog]),vertexShader:Wa.sprite_vert,fragmentShader:Wa.sprite_frag},background:{uniforms:{uvTransform:{value:new Zn},t2D:{value:null}},vertexShader:Wa.background_vert,fragmentShader:Wa.background_frag},cube:{uniforms:Ta([Xa.envmap,{opacity:{value:1}}]),vertexShader:Wa.cube_vert,fragmentShader:Wa.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Wa.equirect_vert,fragmentShader:Wa.equirect_frag},distanceRGBA:{uniforms:Ta([Xa.common,Xa.displacementmap,{referencePosition:{value:new sr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Wa.distanceRGBA_vert,fragmentShader:Wa.distanceRGBA_frag},shadow:{uniforms:Ta([Xa.lights,Xa.fog,{color:{value:new Ei(0)},opacity:{value:1}}]),vertexShader:Wa.shadow_vert,fragmentShader:Wa.shadow_frag}};function Ja(e,t,n,r,i){var a,o,s=new Ei(0),l=0,u=null,c=0,h=null;function d(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return s},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s.set(e),d(s,l=t)},getClearAlpha:function(){return l},setClearAlpha:function(e){d(s,l=e)},render:function(n,i,p,f){var m=!0===i.isScene?i.background:null;m&&m.isTexture&&(m=t.get(m));var v=e.xr,g=v.getSession&&v.getSession();g&&"additive"===g.environmentBlendMode&&(m=null),null===m?d(s,l):m&&m.isColor&&(d(m,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLCubeRenderTarget||m.mapping===ye)?(void 0===o&&((o=new Ma(new Aa(1,1,1),new Pa({name:"BackgroundCubeMaterial",uniforms:Ca(Ya.cube.uniforms),vertexShader:Ya.cube.vertexShader,fragmentShader:Ya.cube.fragmentShader,side:w,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(o)),m.isWebGLCubeRenderTarget&&(m=m.texture),o.material.uniforms.envMap.value=m,o.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,u===m&&c===m.version&&h===e.toneMapping||(o.material.needsUpdate=!0,u=m,c=m.version,h=e.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null)):m&&m.isTexture&&(void 0===a&&((a=new Ma(new Va(2,2),new Pa({name:"BackgroundMaterial",uniforms:Ca(Ya.background.uniforms),vertexShader:Ya.background.vertexShader,fragmentShader:Ya.background.fragmentShader,side:M,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(a)),a.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),a.material.uniforms.uvTransform.value.copy(m.matrix),u===m&&c===m.version&&h===e.toneMapping||(a.material.needsUpdate=!0,u=m,c=m.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function Qa(e,t,n,r){var i=e.getParameter(34921),a=r.isWebGL2?null:t.get("OES_vertex_array_object"),o=r.isWebGL2||null!==a,s={},l=d(null),u=l;function c(t){return r.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function h(t){return r.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function d(e){for(var t=[],n=[],r=[],a=0;a<i;a++)t[a]=0,n[a]=0,r[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function p(){for(var e=u.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function f(e){m(e,0)}function m(n,i){var a=u.newAttributes,o=u.enabledAttributes,s=u.attributeDivisors;a[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==i&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),s[n]=i)}function v(){for(var t=u.newAttributes,n=u.enabledAttributes,r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function g(t,n,i,a,o,s){!0!==r.isWebGL2||5124!==i&&5125!==i?e.vertexAttribPointer(t,n,i,a,o,s):e.vertexAttribIPointer(t,n,i,o,s)}function y(){x(),u!==l&&c((u=l).object)}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,y,x){var b=!1;if(o){var M=function(t,n,i){var o=!0===i.wireframe,l=s[t.id];void 0===l&&(l={},s[t.id]=l);var u=l[n.id];void 0===u&&(u={},l[n.id]=u);var c=u[o];return void 0===c&&(c=d(r.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),u[o]=c),c}(y,h,l);u!==M&&c((u=M).object),b=function(e,t){var n=u.attributes,r=e.attributes,i=0;for(var a in r){var o=n[a],s=r[a];if(void 0===o)return!0;if(o.attribute!==s)return!0;if(o.data!==s.data)return!0;i++}return u.attributesNum!==i||u.index!==t}(y,x),b&&function(e,t){var n={},r=e.attributes,i=0;for(var a in r){var o=r[a],s={};s.attribute=o,o.data&&(s.data=o.data),n[a]=s,i++}u.attributes=n,u.attributesNum=i,u.index=t}(y,x)}else{var w=!0===l.wireframe;u.geometry===y.id&&u.program===h.id&&u.wireframe===w||(u.geometry=y.id,u.program=h.id,u.wireframe=w,b=!0)}!0===i.isInstancedMesh&&(b=!0),null!==x&&n.update(x,34963),b&&(function(i,a,o,s){if(!1!==r.isWebGL2||!i.isInstancedMesh&&!s.isInstancedBufferGeometry||null!==t.get("ANGLE_instanced_arrays")){p();var l=s.attributes,u=o.getAttributes(),c=a.defaultAttributeValues;for(var h in u){var d=u[h];if(d>=0){var y=l[h];if(void 0!==y){var x=y.normalized,b=y.itemSize,M=n.get(y);if(void 0===M)continue;var w=M.buffer,_=M.type,A=M.bytesPerElement;if(y.isInterleavedBufferAttribute){var C=y.data,T=C.stride,S=y.offset;C&&C.isInstancedInterleavedBuffer?(m(d,C.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=C.meshPerAttribute*C.count)):f(d),e.bindBuffer(34962,w),g(d,b,_,x,T*A,S*A)}else y.isInstancedBufferAttribute?(m(d,y.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=y.meshPerAttribute*y.count)):f(d),e.bindBuffer(34962,w),g(d,b,_,x,0,0)}else if("instanceMatrix"===h){var E=n.get(i.instanceMatrix);if(void 0===E)continue;var L=E.buffer,P=E.type;m(d+0,1),m(d+1,1),m(d+2,1),m(d+3,1),e.bindBuffer(34962,L),e.vertexAttribPointer(d+0,4,P,!1,64,0),e.vertexAttribPointer(d+1,4,P,!1,64,16),e.vertexAttribPointer(d+2,4,P,!1,64,32),e.vertexAttribPointer(d+3,4,P,!1,64,48)}else if("instanceColor"===h){var B=n.get(i.instanceColor);if(void 0===B)continue;var D=B.buffer,k=B.type;m(d,1),e.bindBuffer(34962,D),e.vertexAttribPointer(d,3,k,!1,12,0)}else if(void 0!==c){var R=c[h];if(void 0!==R)switch(R.length){case 2:e.vertexAttrib2fv(d,R);break;case 3:e.vertexAttrib3fv(d,R);break;case 4:e.vertexAttrib4fv(d,R);break;default:e.vertexAttrib1fv(d,R)}}}}v()}}(i,l,h,y),null!==x&&e.bindBuffer(34963,n.get(x).buffer))},reset:y,resetDefaultState:x,dispose:function(){for(var e in y(),s){var t=s[e];for(var n in t){var r=t[n];for(var i in r)h(r[i].object),delete r[i];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var r=t[n];for(var i in r)h(r[i].object),delete r[i];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var r=n[e.id];for(var i in r)h(r[i].object),delete r[i];delete n[e.id]}}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:v}}function qa(e,t,n,r){var i,a=r.isWebGL2;this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i,1)},this.renderInstances=function(r,o,s){if(0!==s){var l,u;if(a)l=e,u="drawArraysInstanced";else if(u="drawArraysInstancedANGLE",null===(l=t.get("ANGLE_instanced_arrays")))return;l[u](i,r,o,s),n.update(o,i,s)}}}function Ka(e,t,n){var r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==n.precision?n.precision:"highp",s=i(o);s!==o&&(o=s);var l=!0===n.logarithmicDepthBuffer,u=e.getParameter(34930),c=e.getParameter(35660),h=e.getParameter(3379),d=e.getParameter(34076),p=e.getParameter(34921),f=e.getParameter(36347),m=e.getParameter(36348),v=e.getParameter(36349),g=c>0,y=a||!!t.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==r)return r;var n=t.get("EXT_texture_filter_anisotropic");return r=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:g&&y,maxSamples:a?e.getParameter(36183):0}}function Za(e){var t=this,n=null,r=0,i=!1,a=!1,o=new ci,s=new Zn,l={value:null,needsUpdate:!1};function u(){l.value!==n&&(l.value=n,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function c(e,n,r,i){var a=null!==e?e.length:0,u=null;if(0!==a){if(u=l.value,!0!==i||null===u){var c=r+4*a,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===u||u.length<c)&&(u=new Float32Array(c));for(var d=0,p=r;d!==a;++d,p+=4)o.copy(e[d]).applyMatrix4(h,s),o.normal.toArray(u,p),u[p+3]=o.constant}l.value=u,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,a){var o=0!==e.length||t||0!==r||i;return i=t,n=c(e,a,0),r=e.length,o},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1,u()},this.setState=function(t,o,s){var h=t.clippingPlanes,d=t.clipIntersection,p=t.clipShadows,f=e.get(t);if(!i||null===h||0===h.length||a&&!p)a?c(null):u();else{var m=a?0:r,v=4*m,g=f.clippingState||null;l.value=g,g=c(h,o,v,s);for(var y=0;y!==v;++y)g[y]=n[y];f.clippingState=g,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=m}}}function $a(e){var t=new WeakMap;function n(e,t){return t===ve?e.mapping=fe:t===ge&&(e.mapping=me),e}function r(e){var n=e.target;n.removeEventListener("dispose",r);var i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){var a=i.mapping;if(a===ve||a===ge){if(t.has(i))return n(t.get(i).texture,i.mapping);var o=i.image;if(o&&o.height>0){var s=e.getRenderList(),l=e.getRenderTarget(),u=e.getRenderState(),c=new Fa(o.height/2);return c.fromEquirectangularTexture(e,i),t.set(i,c),e.setRenderTarget(l),e.setRenderList(s),e.setRenderState(u),i.addEventListener("dispose",r),n(c.texture,i.mapping)}return null}}return i},dispose:function(){t=new WeakMap}}}function eo(e){var t={};return{has:function(n){if(void 0!==t[n])return null!==t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,null!==r},get:function(e){return this.has(e),t[e]}}}function to(e,t,n,r){var i=new WeakMap,a=new WeakMap;function o(e){var s=e.target,l=i.get(s);for(var u in null!==l.index&&t.remove(l.index),l.attributes)t.remove(l.attributes[u]);s.removeEventListener("dispose",o),i.delete(s);var c=a.get(l);c&&(t.remove(c),a.delete(l)),r.releaseStatesOfGeometry(l),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],r=e.index,i=e.attributes.position,o=0;if(null!==r){var s=r.array;o=r.version;for(var l=0,u=s.length;l<u;l+=3){var c=s[l+0],h=s[l+1],d=s[l+2];n.push(c,h,h,d,d,c)}}else{var p=i.array;o=i.version;for(var f=0,m=p.length/3-1;f<m;f+=3){var v=f+0,g=f+1,y=f+2;n.push(v,g,g,y,y,v)}}var x=new(Yi(n)>65535?ji:Ui)(n,1);x.version=o;var b=a.get(e);b&&t.remove(b),a.set(e,x)}return{get:function(e,t){var r=i.get(t);return r||(t.addEventListener("dispose",o),t.isBufferGeometry?r=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new ra).setFromObject(e)),r=t._bufferGeometry),i.set(t,r),n.memory.geometries++,r)},update:function(e){var n=e.attributes;for(var r in n)t.update(n[r],34962);var i=e.morphAttributes;for(var a in i)for(var o=i[a],s=0,l=o.length;s<l;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var t=a.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function no(e,t,n,r){var i,a,o,s=r.isWebGL2;this.setMode=function(e){i=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,r){e.drawElements(i,r,a,t*o),n.update(r,i,1)},this.renderInstances=function(r,l,u){if(0!==u){var c,h;if(s)c=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return;c[h](i,l,a,r*o,u),n.update(l,i,u)}}}function ro(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e}}}}function io(e,t){return e[0]-t[0]}function ao(e,t){return Math.abs(t[1])-Math.abs(e[1])}function oo(e){for(var t={},n=new Float32Array(8),r=[],i=0;i<8;i++)r[i]=[i,0];return{update:function(i,a,o,s){var l=i.morphTargetInfluences,u=void 0===l?0:l.length,c=t[a.id];if(void 0===c){c=[];for(var h=0;h<u;h++)c[h]=[h,0];t[a.id]=c}for(var d=0;d<u;d++){var p=c[d];p[0]=d,p[1]=l[d]}c.sort(ao);for(var f=0;f<8;f++)f<u&&c[f][1]?(r[f][0]=c[f][0],r[f][1]=c[f][1]):(r[f][0]=Number.MAX_SAFE_INTEGER,r[f][1]=0);r.sort(io);for(var m=o.morphTargets&&a.morphAttributes.position,v=o.morphNormals&&a.morphAttributes.normal,g=0,y=0;y<8;y++){var x=r[y],b=x[0],M=x[1];b!==Number.MAX_SAFE_INTEGER&&M?(m&&a.getAttribute("morphTarget"+y)!==m[b]&&a.setAttribute("morphTarget"+y,m[b]),v&&a.getAttribute("morphNormal"+y)!==v[b]&&a.setAttribute("morphNormal"+y,v[b]),n[y]=M,g+=M):(m&&!0===a.hasAttribute("morphTarget"+y)&&a.deleteAttribute("morphTarget"+y),v&&!0===a.hasAttribute("morphNormal"+y)&&a.deleteAttribute("morphNormal"+y),n[y]=0)}var w=a.morphTargetsRelative?1:1-g;s.getUniforms().setValue(e,"morphTargetBaseInfluence",w),s.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function so(e,t,n,r){var i=new WeakMap;return{update:function(e){var a=r.render.frame,o=e.geometry,s=t.get(e,o);return i.get(s)!==a&&(o.isGeometry&&s.updateFromObject(e),t.update(s),i.set(s,a)),e.isInstancedMesh&&(n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),s},dispose:function(){i=new WeakMap}}}function lo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;tr.call(this,null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=_e,this.minFilter=_e,this.wrapR=Me,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function uo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;tr.call(this,null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=_e,this.minFilter=_e,this.wrapR=Me,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Ya.physical={uniforms:Ta([Ya.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Kn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Ei(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Wa.meshphysical_vert,fragmentShader:Wa.meshphysical_frag},lo.prototype=Object.create(tr.prototype),lo.prototype.constructor=lo,lo.prototype.isDataTexture2DArray=!0,uo.prototype=Object.create(tr.prototype),uo.prototype.constructor=uo,uo.prototype.isDataTexture3D=!0;var co=new tr,ho=new lo,po=new uo,fo=new Ia,mo=[],vo=[],go=new Float32Array(16),yo=new Float32Array(9),xo=new Float32Array(4);function bo(e,t,n){var r=e[0];if(r<=0||r>0)return e;var i=t*n,a=mo[i];if(void 0===a&&(a=new Float32Array(i),mo[i]=a),0!==t){r.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function Mo(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function wo(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function _o(e,t){var n=vo[t];void 0===n&&(n=new Int32Array(t),vo[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Ao(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Co(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Mo(n,t))return;e.uniform2fv(this.addr,t),wo(n,t)}}function To(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Mo(n,t))return;e.uniform3fv(this.addr,t),wo(n,t)}}function So(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Mo(n,t))return;e.uniform4fv(this.addr,t),wo(n,t)}}function Eo(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Mo(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),wo(n,t)}else{if(Mo(n,r))return;xo.set(r),e.uniformMatrix2fv(this.addr,!1,xo),wo(n,r)}}function Lo(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Mo(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),wo(n,t)}else{if(Mo(n,r))return;yo.set(r),e.uniformMatrix3fv(this.addr,!1,yo),wo(n,r)}}function Po(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Mo(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),wo(n,t)}else{if(Mo(n,r))return;go.set(r),e.uniformMatrix4fv(this.addr,!1,go),wo(n,r)}}function Bo(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||co,i)}function Do(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||ho,i)}function ko(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||po,i)}function Ro(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||fo,i)}function Oo(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Io(e,t){var n=this.cache;Mo(n,t)||(e.uniform2iv(this.addr,t),wo(n,t))}function Fo(e,t){var n=this.cache;Mo(n,t)||(e.uniform3iv(this.addr,t),wo(n,t))}function No(e,t){var n=this.cache;Mo(n,t)||(e.uniform4iv(this.addr,t),wo(n,t))}function zo(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Uo(e,t){e.uniform1fv(this.addr,t)}function Ho(e,t){e.uniform1iv(this.addr,t)}function jo(e,t){e.uniform2iv(this.addr,t)}function Go(e,t){e.uniform3iv(this.addr,t)}function Vo(e,t){e.uniform4iv(this.addr,t)}function Wo(e,t){var n=bo(t,this.size,2);e.uniform2fv(this.addr,n)}function Xo(e,t){var n=bo(t,this.size,3);e.uniform3fv(this.addr,n)}function Yo(e,t){var n=bo(t,this.size,4);e.uniform4fv(this.addr,n)}function Jo(e,t){var n=bo(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Qo(e,t){var n=bo(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function qo(e,t){var n=bo(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Ko(e,t,n){var r=t.length,i=_o(n,r);e.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.safeSetTexture2D(t[a]||co,i[a])}function Zo(e,t,n){var r=t.length,i=_o(n,r);e.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.safeSetTextureCube(t[a]||fo,i[a])}function $o(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Ao;case 35664:return Co;case 35665:return To;case 35666:return So;case 35674:return Eo;case 35675:return Lo;case 35676:return Po;case 5124:case 35670:return Oo;case 35667:case 35671:return Io;case 35668:case 35672:return Fo;case 35669:case 35673:return No;case 5125:return zo;case 35678:case 36198:case 36298:case 36306:case 35682:return Bo;case 35679:case 36299:case 36307:return ko;case 35680:case 36300:case 36308:case 36293:return Ro;case 36289:case 36303:case 36311:case 36292:return Do}}(t.type)}function es(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Uo;case 35664:return Wo;case 35665:return Xo;case 35666:return Yo;case 35674:return Jo;case 35675:return Qo;case 35676:return qo;case 5124:case 35670:return Ho;case 35667:case 35671:return jo;case 35668:case 35672:return Go;case 35669:case 35673:return Vo;case 35678:case 36198:case 36298:case 36306:case 35682:return Ko;case 35680:case 36300:case 36308:case 36293:return Zo}}(t.type)}function ts(e){this.id=e,this.seq=[],this.map={}}es.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),wo(t,e)},ts.prototype.setValue=function(e,t,n){for(var r=this.seq,i=0,a=r.length;i!==a;++i){var o=r[i];o.setValue(e,t[o.id],n)}};var ns=/([\w\d_]+)(\])?(\[|\.)?/g;function rs(e,t){e.seq.push(t),e.map[t.id]=t}function is(e,t,n){var r=e.name,i=r.length;for(ns.lastIndex=0;;){var a=ns.exec(r),o=ns.lastIndex,s=a[1],l="]"===a[2],u=a[3];if(l&&(s|=0),void 0===u||"["===u&&o+2===i){rs(n,void 0===u?new $o(s,e,t):new es(s,e,t));break}var c=n.map[s];void 0===c&&rs(n,c=new ts(s)),n=c}}function as(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),r=0;r<n;++r){var i=e.getActiveUniform(t,r);is(i,e.getUniformLocation(t,i.name),this)}}function os(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}as.prototype.setValue=function(e,t,n,r){var i=this.map[t];void 0!==i&&i.setValue(e,n,r)},as.prototype.setOptional=function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)},as.upload=function(e,t,n,r){for(var i=0,a=t.length;i!==a;++i){var o=t[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}},as.seqWithValue=function(e,t){for(var n=[],r=0,i=e.length;r!==i;++r){var a=e[r];a.id in t&&n.push(a)}return n};var ss=0;function ls(e){switch(e){case on:return["Linear","( value )"];case sn:return["sRGB","( value )"];case un:return["RGBE","( value )"];case hn:return["RGBM","( value, 7.0 )"];case dn:return["RGBM","( value, 16.0 )"];case pn:return["RGBD","( value, 256.0 )"];case ln:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case cn:return["LogLuv","( value )"];default:return["Linear","( value )"]}}function us(e,t,n){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function cs(e,t){var n=ls(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function hs(e,t){var n=ls(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function ds(e,t){var n;switch(t){case le:n="Linear";break;case ue:n="Reinhard";break;case ce:n="OptimizedCineon";break;case he:n="ACESFilmic";break;case de:n="Custom";break;default:n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function ps(e){return""!==e}function fs(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ms(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var vs=/^[ \t]*#include +<([\w\d./]+)>/gm;function gs(e){return e.replace(vs,ys)}function ys(e,t){var n=Wa[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return gs(n)}var xs=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,bs=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ms(e){return e.replace(bs,_s).replace(xs,ws)}function ws(e,t,n,r){return _s(e,t,n,r)}function _s(e,t,n,r){for(var i="",a=parseInt(t);a<parseInt(n);a++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function As(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Cs(e,t,n,r){var i,a,o=e.getContext(),s=n.defines,l=n.vertexShader,u=n.fragmentShader,c=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===f?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===x?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===b&&(t="SHADOWMAP_TYPE_VSM"),t}(n),h=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case fe:case me:t="ENVMAP_TYPE_CUBE";break;case ye:case xe:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),d=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case me:case xe:t="ENVMAP_MODE_REFRACTION"}return t}(n),p=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case ie:t="ENVMAP_BLENDING_MULTIPLY";break;case ae:t="ENVMAP_BLENDING_MIX";break;case oe:t="ENVMAP_BLENDING_ADD"}return t}(n),m=e.gammaFactor>0?e.gammaFactor:1,v=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ps).join("\n")}(n),g=function(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(s),y=o.createProgram(),M=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((i=[g].filter(ps).join("\n")).length>0&&(i+="\n"),(a=[v,g].filter(ps).join("\n")).length>0&&(a+="\n")):(i=[As(n),"#define SHADER_NAME "+n.shaderName,g,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ps).join("\n"),a=[v,As(n),"#define SHADER_NAME "+n.shaderName,g,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+d:"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==se?"#define TONE_MAPPING":"",n.toneMapping!==se?Wa.tonemapping_pars_fragment:"",n.toneMapping!==se?ds("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",Wa.encodings_pars_fragment,n.map?cs("mapTexelToLinear",n.mapEncoding):"",n.matcap?cs("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?cs("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?cs("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?cs("lightMapTexelToLinear",n.lightMapEncoding):"",hs("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(ps).join("\n")),l=ms(l=fs(l=gs(l),n),n),u=ms(u=fs(u=gs(u),n),n),l=Ms(l),u=Ms(u),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(M="#version 300 es\n",i=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+i,a=["#define varying in",n.glslVersion===Vn?"":"out highp vec4 pc_fragColor;",n.glslVersion===Vn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);var w,_,A=M+a+u,C=os(o,35633,M+i+l),T=os(o,35632,A);if(o.attachShader(y,C),o.attachShader(y,T),void 0!==n.index0AttributeName?o.bindAttribLocation(y,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(y,0,"position"),o.linkProgram(y),e.debug.checkShaderErrors){var S=o.getProgramInfoLog(y).trim(),E=o.getShaderInfoLog(C).trim(),L=o.getShaderInfoLog(T).trim(),P=!0,B=!0;!1===o.getProgramParameter(y,35714)?(P=!1,us(o,C,"vertex"),us(o,T,"fragment")):""!==S||""!==E&&""!==L||(B=!1),B&&(this.diagnostics={runnable:P,programLog:S,vertexShader:{log:E,prefix:i},fragmentShader:{log:L,prefix:a}})}return o.deleteShader(C),o.deleteShader(T),this.getUniforms=function(){return void 0===w&&(w=new as(o,y)),w},this.getAttributes=function(){return void 0===_&&(_=function(e,t){for(var n={},r=e.getProgramParameter(t,35721),i=0;i<r;i++){var a=e.getActiveAttrib(t,i).name;n[a]=e.getAttribLocation(t,a)}return n}(o,y)),_},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram(y),this.program=void 0},this.name=n.shaderName,this.id=ss++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=C,this.fragmentShader=T,this}function Ts(e,t,n,r,i,a){var o=[],s=r.isWebGL2,l=r.logarithmicDepthBuffer,u=r.floatVertexTextures,c=r.maxVertexUniforms,h=r.vertexTextures,d=r.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function m(e){var t;return e?e.isTexture?t=e.encoding:e.isWebGLRenderTarget&&(t=e.texture.encoding):t=on,t}return{getParameters:function(i,o,f,v,g){var y,x,b=v.fog,M=i.isMeshStandardMaterial?v.environment:null,A=t.get(i.envMap||M),C=p[i.type],T=g.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(u)return 1024;var n=c,r=Math.floor((n-20)/4),i=Math.min(r,t.length);return i<t.length?0:i}(g):0;if(null!==i.precision&&(d=r.getMaxPrecision(i.precision),i.precision),C){var S=Ya[C];y=S.vertexShader,x=S.fragmentShader}else y=i.vertexShader,x=i.fragmentShader;var E=e.getRenderTarget();return{isWebGL2:s,shaderID:C,shaderName:i.type,vertexShader:y,fragmentShader:x,defines:i.defines,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:d,instancing:!0===g.isInstancedMesh,instancingColor:!0===g.isInstancedMesh&&null!==g.instanceColor,supportsVertexTextures:h,outputEncoding:null!==E?m(E.texture):e.outputEncoding,map:!!i.map,mapEncoding:m(i.map),matcap:!!i.matcap,matcapEncoding:m(i.matcap),envMap:!!A,envMapMode:A&&A.mapping,envMapEncoding:m(A),envMapCubeUV:!!A&&(A.mapping===ye||A.mapping===xe),lightMap:!!i.lightMap,lightMapEncoding:m(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:m(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:i.normalMapType===gn,tangentSpaceNormalMap:i.normalMapType===vn,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,transmissionMap:!!i.transmissionMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatMap||i.clearcoatRoughnessMap||i.clearcoatNormalMap||i.displacementMap||i.transmissionMap),uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmissionMap||!i.displacementMap),fog:!!b,useFog:i.fog,fogExp2:b&&b.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:l,skinning:i.skinning&&T>0,maxBones:T,useVertexTexture:u,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&f.length>0,shadowMapType:e.shadowMap.type,toneMapping:i.toneMapped?e.toneMapping:se,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:i.side===_,flipSided:i.side===w,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:s||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:s||n.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);if(!1===t.isRawShaderMaterial){for(var i=0;i<f.length;i++)n.push(t[f[i]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=p[e.type];if(n){var r=Ya[n];t=Sa.clone(r.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var r,a=0,s=o.length;a<s;a++){var l=o[a];if(l.cacheKey===n){++(r=l).usedTimes;break}}return void 0===r&&(r=new Cs(e,n,t,i),o.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){var t=o.indexOf(e);o[t]=o[o.length-1],o.pop(),e.destroy()}},programs:o}}function Ss(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Es(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ls(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ps(e){var t=[],n=0,r=[],i=[],a={id:-1};function o(r,i,o,s,l,u){var c=t[n],h=e.get(o);return void 0===c?(c={id:r.id,object:r,geometry:i,material:o,program:h.program||a,groupOrder:s,renderOrder:r.renderOrder,z:l,group:u},t[n]=c):(c.id=r.id,c.object=r,c.geometry=i,c.material=o,c.program=h.program||a,c.groupOrder=s,c.renderOrder=r.renderOrder,c.z=l,c.group=u),n++,c}return{opaque:r,transparent:i,init:function(){n=0,r.length=0,i.length=0},push:function(e,t,n,a,s,l){var u=o(e,t,n,a,s,l);(!0===n.transparent?i:r).push(u)},unshift:function(e,t,n,a,s,l){var u=o(e,t,n,a,s,l);(!0===n.transparent?i:r).unshift(u)},finish:function(){for(var e=n,r=t.length;e<r;e++){var i=t[e];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(e,t){r.length>1&&r.sort(e||Es),i.length>1&&i.sort(t||Ls)}}}function Bs(e){var t=new WeakMap;return{get:function(n,r){var i,a=t.get(n);return void 0===a?(i=new Ps(e),t.set(n,new WeakMap),t.get(n).set(r,i)):void 0===(i=a.get(r))&&(i=new Ps(e),a.set(r,i)),i},dispose:function(){t=new WeakMap}}}function Ds(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new sr,color:new Ei};break;case"SpotLight":n={position:new sr,direction:new sr,color:new Ei,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new sr,color:new Ei,distance:0,decay:0};break;case"HemisphereLight":n={direction:new sr,skyColor:new Ei,groundColor:new Ei};break;case"RectAreaLight":n={color:new Ei,position:new sr,halfWidth:new sr,halfHeight:new sr}}return e[t.id]=n,n}}}var ks=0;function Rs(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Os(e,t){for(var n=new Ds,r=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Kn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Kn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},a=0;a<9;a++)i.probe.push(new sr);var o=new sr,s=new Or,l=new Or;return{setup:function(a,u,c){for(var h=0,d=0,p=0,f=0;f<9;f++)i.probe[f].set(0,0,0);var m=0,v=0,g=0,y=0,x=0,b=0,M=0,w=0,_=c.matrixWorldInverse;a.sort(Rs);for(var A=0,C=a.length;A<C;A++){var T=a[A],S=T.color,E=T.intensity,L=T.distance,P=T.shadow&&T.shadow.map?T.shadow.map.texture:null;if(T.isAmbientLight)h+=S.r*E,d+=S.g*E,p+=S.b*E;else if(T.isLightProbe)for(var B=0;B<9;B++)i.probe[B].addScaledVector(T.sh.coefficients[B],E);else if(T.isDirectionalLight){var D=n.get(T);if(D.color.copy(T.color).multiplyScalar(T.intensity),D.direction.setFromMatrixPosition(T.matrixWorld),o.setFromMatrixPosition(T.target.matrixWorld),D.direction.sub(o),D.direction.transformDirection(_),T.castShadow){var k=T.shadow,R=r.get(T);R.shadowBias=k.bias,R.shadowNormalBias=k.normalBias,R.shadowRadius=k.radius,R.shadowMapSize=k.mapSize,i.directionalShadow[m]=R,i.directionalShadowMap[m]=P,i.directionalShadowMatrix[m]=T.shadow.matrix,b++}i.directional[m]=D,m++}else if(T.isSpotLight){var O=n.get(T);if(O.position.setFromMatrixPosition(T.matrixWorld),O.position.applyMatrix4(_),O.color.copy(S).multiplyScalar(E),O.distance=L,O.direction.setFromMatrixPosition(T.matrixWorld),o.setFromMatrixPosition(T.target.matrixWorld),O.direction.sub(o),O.direction.transformDirection(_),O.coneCos=Math.cos(T.angle),O.penumbraCos=Math.cos(T.angle*(1-T.penumbra)),O.decay=T.decay,T.castShadow){var I=T.shadow,F=r.get(T);F.shadowBias=I.bias,F.shadowNormalBias=I.normalBias,F.shadowRadius=I.radius,F.shadowMapSize=I.mapSize,i.spotShadow[g]=F,i.spotShadowMap[g]=P,i.spotShadowMatrix[g]=T.shadow.matrix,w++}i.spot[g]=O,g++}else if(T.isRectAreaLight){var N=n.get(T);N.color.copy(S).multiplyScalar(E),N.position.setFromMatrixPosition(T.matrixWorld),N.position.applyMatrix4(_),l.identity(),s.copy(T.matrixWorld),s.premultiply(_),l.extractRotation(s),N.halfWidth.set(.5*T.width,0,0),N.halfHeight.set(0,.5*T.height,0),N.halfWidth.applyMatrix4(l),N.halfHeight.applyMatrix4(l),i.rectArea[y]=N,y++}else if(T.isPointLight){var z=n.get(T);if(z.position.setFromMatrixPosition(T.matrixWorld),z.position.applyMatrix4(_),z.color.copy(T.color).multiplyScalar(T.intensity),z.distance=T.distance,z.decay=T.decay,T.castShadow){var U=T.shadow,H=r.get(T);H.shadowBias=U.bias,H.shadowNormalBias=U.normalBias,H.shadowRadius=U.radius,H.shadowMapSize=U.mapSize,H.shadowCameraNear=U.camera.near,H.shadowCameraFar=U.camera.far,i.pointShadow[v]=H,i.pointShadowMap[v]=P,i.pointShadowMatrix[v]=T.shadow.matrix,M++}i.point[v]=z,v++}else if(T.isHemisphereLight){var j=n.get(T);j.direction.setFromMatrixPosition(T.matrixWorld),j.direction.transformDirection(_),j.direction.normalize(),j.skyColor.copy(T.color).multiplyScalar(E),j.groundColor.copy(T.groundColor).multiplyScalar(E),i.hemi[x]=j,x++}}y>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=Xa.LTC_FLOAT_1,i.rectAreaLTC2=Xa.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")&&(i.rectAreaLTC1=Xa.LTC_HALF_1,i.rectAreaLTC2=Xa.LTC_HALF_2)),i.ambient[0]=h,i.ambient[1]=d,i.ambient[2]=p;var G=i.hash;G.directionalLength===m&&G.pointLength===v&&G.spotLength===g&&G.rectAreaLength===y&&G.hemiLength===x&&G.numDirectionalShadows===b&&G.numPointShadows===M&&G.numSpotShadows===w||(i.directional.length=m,i.spot.length=g,i.rectArea.length=y,i.point.length=v,i.hemi.length=x,i.directionalShadow.length=b,i.directionalShadowMap.length=b,i.pointShadow.length=M,i.pointShadowMap.length=M,i.spotShadow.length=w,i.spotShadowMap.length=w,i.directionalShadowMatrix.length=b,i.pointShadowMatrix.length=M,i.spotShadowMatrix.length=w,G.directionalLength=m,G.pointLength=v,G.spotLength=g,G.rectAreaLength=y,G.hemiLength=x,G.numDirectionalShadows=b,G.numPointShadows=M,G.numSpotShadows=w,i.version=ks++)},state:i}}function Is(e,t){var n=new Os(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(e){n.setup(r,i,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Fs(e,t){var n=new WeakMap;return{get:function(r,i){var a;return!1===n.has(r)?(a=new Is(e,t),n.set(r,new WeakMap),n.get(r).set(i,a)):!1===n.get(r).has(i)?(a=new Is(e,t),n.get(r).set(i,a)):a=n.get(r).get(i),a},dispose:function(){n=new WeakMap}}}function Ns(e){Bi.call(this),this.type="MeshDepthMaterial",this.depthPacking=fn,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function zs(e){Bi.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new sr,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}Ns.prototype=Object.create(Bi.prototype),Ns.prototype.constructor=Ns,Ns.prototype.isMeshDepthMaterial=!0,Ns.prototype.copy=function(e){return Bi.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},zs.prototype=Object.create(Bi.prototype),zs.prototype.constructor=zs,zs.prototype.isMeshDistanceMaterial=!0,zs.prototype.copy=function(e){return Bi.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var Us="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",Hs="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function js(e,t,n){var r=new Ha,i=new Kn,a=new Kn,o=new rr,s=[],l=[],u={},c={0:w,1:M,2:_},h=new Pa({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Kn},radius:{value:4}},vertexShader:Hs,fragmentShader:Us}),d=h.clone();d.defines.HORIZONAL_PASS=1;var p=new ra;p.setAttribute("position",new Oi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var m=new Ma(p,h),v=this;function g(n,r){var i=t.update(m);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,h,m,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,d,m,null)}function y(e,t,n){var r=e|t<<1|n<<2,i=s[r];return void 0===i&&(i=new Ns({depthPacking:mn,morphTargets:e,skinning:t}),s[r]=i),i}function x(e,t,n){var r=e|t<<1|n<<2,i=l[r];return void 0===i&&(i=new zs({morphTargets:e,skinning:t}),l[r]=i),i}function A(t,n,r,i,a,o,s){var l=null,h=y,d=t.customDepthMaterial;if(!0===i.isPointLight&&(h=x,d=t.customDistanceMaterial),void 0===d){var p=!1;!0===r.morphTargets&&(p=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);var f=!1;!0===t.isSkinnedMesh&&!0===r.skinning&&(f=!0),l=h(p,f,!0===t.isInstancedMesh)}else l=d;if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var m=l.uuid,v=r.uuid,g=u[m];void 0===g&&(g={},u[m]=g);var M=g[v];void 0===M&&(M=l.clone(),g[v]=M),l=M}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=s===b?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:c[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,!0===i.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(i.matrixWorld),l.nearDistance=a,l.farDistance=o),l}function C(n,i,a,o,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===b)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var l=t.update(n),u=n.material;if(Array.isArray(u))for(var c=l.groups,h=0,d=c.length;h<d;h++){var p=c[h],f=u[p.materialIndex];if(f&&f.visible){var m=A(n,l,f,o,a.near,a.far,s);e.renderBufferDirect(a,null,l,m,n,p)}}else if(u.visible){var v=A(n,l,u,o,a.near,a.far,s);e.renderBufferDirect(a,null,l,v,n,null)}}for(var g=n.children,y=0,x=g.length;y<x;y++)C(g[y],i,a,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=f,this.render=function(t,s,l){if(!1!==v.enabled&&(!1!==v.autoUpdate||!1!==v.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(E),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var p=0,f=t.length;p<f;p++){var m=t[p],y=m.shadow;if(void 0!==y&&(!1!==y.autoUpdate||!1!==y.needsUpdate)){i.copy(y.mapSize);var x=y.getFrameExtents();if(i.multiply(x),a.copy(y.mapSize),(i.x>n||i.y>n)&&(i.x>n&&(a.x=Math.floor(n/x.x),i.x=a.x*x.x,y.mapSize.x=a.x),i.y>n&&(a.y=Math.floor(n/x.y),i.y=a.y*x.y,y.mapSize.y=a.y)),null===y.map&&!y.isPointLightShadow&&this.type===b){var M={minFilter:Ee,magFilter:Ee,format:Ye};y.map=new ir(i.x,i.y,M),y.map.texture.name=m.name+".shadowMap",y.mapPass=new ir(i.x,i.y,M),y.camera.updateProjectionMatrix()}if(null===y.map){var w={minFilter:_e,magFilter:_e,format:Ye};y.map=new ir(i.x,i.y,w),y.map.texture.name=m.name+".shadowMap",y.camera.updateProjectionMatrix()}e.setRenderTarget(y.map),e.clear();for(var _=y.getViewportCount(),A=0;A<_;A++){var T=y.getViewport(A);o.set(a.x*T.x,a.y*T.y,a.x*T.z,a.y*T.w),d.viewport(o),y.updateMatrices(m,A),r=y.getFrustum(),C(s,l,y.camera,m,this.type)}y.isPointLightShadow||this.type!==b||g(y,l),y.needsUpdate=!1}}v.needsUpdate=!1,e.setRenderTarget(u,c,h)}}}function Gs(e,t,n){var r,i=n.isWebGL2,a=new function(){var t=!1,n=new rr,r=null,i=new rr(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),n.set(t,r,a,o),!1===i.equals(n)&&(e.clearColor(t,r,a,o),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},u=new function(){var t=!1,n=null,r=null,i=null;return{setTest:function(e){e?ve(2929):ge(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case q:e.depthFunc(512);break;case K:e.depthFunc(519);break;case Z:e.depthFunc(513);break;case $:e.depthFunc(515);break;case ee:e.depthFunc(514);break;case te:e.depthFunc(518);break;case ne:e.depthFunc(516);break;case re:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},c=new function(){var t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,u=null;return{setTest:function(e){t||(e?ve(2960):ge(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&i===n&&a===o||(e.stencilFunc(t,n,o),r=t,i=n,a=o)},setOp:function(t,n,r){o===t&&s===n&&l===r||(e.stencilOp(t,n,r),o=t,s=n,l=r)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,u=null}}},h={},p=null,f=null,m=null,v=null,g=null,y=null,x=null,b=null,M=null,A=!1,C=null,T=null,S=null,ie=null,ae=null,oe=e.getParameter(35661),se=!1,le=0,ue=e.getParameter(7938);-1!==ue.indexOf("WebGL")?(le=parseFloat(/^WebGL\ ([0-9])/.exec(ue)[1]),se=le>=1):-1!==ue.indexOf("OpenGL ES")&&(le=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(ue)[1]),se=le>=2);var ce=null,he={},de=new rr,pe=new rr;function fe(t,n,r){var i=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<r;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,i);return a}var me={};function ve(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function ge(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}me[3553]=fe(3553,3553,1),me[34067]=fe(34067,34069,6),a.setClear(0,0,0,1),u.setClear(1),c.setClear(0),ve(2929),u.setFunc($),we(!1),_e(s),ve(2884),Me(E);var ye=(0,d.default)((0,d.default)((0,d.default)({},R,32774),O,32778),I,32779);if(i)ye[F]=32775,ye[N]=32776;else{var xe=t.get("EXT_blend_minmax");null!==xe&&(ye[F]=xe.MIN_EXT,ye[N]=xe.MAX_EXT)}var be=(r={},(0,d.default)((0,d.default)((0,d.default)((0,d.default)((0,d.default)((0,d.default)((0,d.default)((0,d.default)((0,d.default)((0,d.default)(r,z,0),U,1),H,768),G,770),Q,776),Y,774),W,772),j,769),V,771),J,775),(0,d.default)(r,X,773));function Me(t,n,r,i,a,o,s,l){if(t!==E){if(f||(ve(3042),f=!0),t===k)a=a||n,o=o||r,s=s||i,n===v&&a===x||(e.blendEquationSeparate(ye[n],ye[a]),v=n,x=a),r===g&&i===y&&o===b&&s===M||(e.blendFuncSeparate(be[r],be[i],be[o],be[s]),g=r,y=i,b=o,M=s),m=t,A=null;else if(t!==m||l!==A){if(v===R&&x===R||(e.blendEquation(32774),v=R,x=R),l)switch(t){case L:e.blendFuncSeparate(1,771,1,771);break;case P:e.blendFunc(1,1);break;case B:e.blendFuncSeparate(0,0,769,771);break;case D:e.blendFuncSeparate(0,768,0,770)}else switch(t){case L:e.blendFuncSeparate(770,771,1,771);break;case P:e.blendFunc(770,1);break;case B:e.blendFunc(0,769);break;case D:e.blendFunc(0,768)}g=null,y=null,b=null,M=null,m=t,A=l}}else f&&(ge(3042),f=!1)}function we(t){C!==t&&(t?e.frontFace(2304):e.frontFace(2305),C=t)}function _e(t){t!==o?(ve(2884),t!==T&&(t===s?e.cullFace(1029):t===l?e.cullFace(1028):e.cullFace(1032))):ge(2884),T=t}function Ae(t,n,r){t?(ve(32823),ie===n&&ae===r||(e.polygonOffset(n,r),ie=n,ae=r)):ge(32823)}function Ce(t){void 0===t&&(t=33984+oe-1),ce!==t&&(e.activeTexture(t),ce=t)}return{buffers:{color:a,depth:u,stencil:c},enable:ve,disable:ge,useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:Me,setMaterial:function(e,t){e.side===_?ge(2884):ve(2884);var n=e.side===w;t&&(n=!n),we(n),e.blending===L&&!1===e.transparent?Me(E):Me(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),u.setFunc(e.depthFunc),u.setTest(e.depthTest),u.setMask(e.depthWrite),a.setMask(e.colorWrite);var r=e.stencilWrite;c.setTest(r),r&&(c.setMask(e.stencilWriteMask),c.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),c.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Ae(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:we,setCullFace:_e,setLineWidth:function(t){t!==S&&(se&&e.lineWidth(t),S=t)},setPolygonOffset:Ae,setScissorTest:function(e){e?ve(3089):ge(3089)},activeTexture:Ce,bindTexture:function(t,n){null===ce&&Ce();var r=he[ce];void 0===r&&(r={type:void 0,texture:void 0},he[ce]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||me[t]),r.type=t,r.texture=n)},unbindTexture:function(){var t=he[ce];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){}},scissor:function(t){!1===de.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),de.copy(t))},viewport:function(t){!1===pe.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),pe.copy(t))},reset:function(){h={},ce=null,he={},p=null,f=null,m=null,v=null,g=null,y=null,x=null,b=null,M=null,A=!1,C=null,T=null,S=null,ie=null,ae=null,a.reset(),u.reset(),c.reset()}}}function Vs(e,t,n,r,i,a,o){var s,l=i.isWebGL2,u=(i.maxTextures,i.maxCubemapSize),c=i.maxTextureSize,h=i.maxSamples,p=new WeakMap,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,t){return f?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(e,t,n,r){var i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?qn.floorPowerOfTwo:Math.floor,o=a(i*e.width),l=a(i*e.height);void 0===s&&(s=m(o,l));var u=n?m(o,l):s;return u.width=o,u.height=l,u.getContext("2d").drawImage(e,0,0,o,l),u}return e}return e}function g(e){return qn.isPowerOfTwo(e.width)&&qn.isPowerOfTwo(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==_e&&e.minFilter!==Ee}function x(t,n,i,a){e.generateMipmap(t),r.get(n).__maxMipLevel=Math.log(Math.max(i,a))*Math.LOG2E}function b(n,r,i){if(!1===l)return r;if(null!==n&&void 0!==e[n])return e[n];var a=r;return 6403===r&&(5126===i&&(a=33326),5131===i&&(a=33325),5121===i&&(a=33321)),6407===r&&(5126===i&&(a=34837),5131===i&&(a=34843),5121===i&&(a=32849)),6408===r&&(5126===i&&(a=34836),5131===i&&(a=34842),5121===i&&(a=32856)),33325!==a&&33326!==a&&34842!==a&&34836!==a||t.get("EXT_color_buffer_float"),a}function M(e){return e===_e||e===Ae||e===Te?9728:9729}function w(t){var n=t.target;n.removeEventListener("dispose",w),function(t){var n=r.get(t);void 0!==n.__webglInit&&(e.deleteTexture(n.__webglTexture),r.remove(t))}(n),n.isVideoTexture&&p.delete(n),o.memory.textures--}function _(t){var n=t.target;n.removeEventListener("dispose",_),function(t){var n=r.get(t),i=r.get(t.texture);if(t){if(void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(var a=0;a<6;a++)e.deleteFramebuffer(n.__webglFramebuffer[a]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[a]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&e.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer);r.remove(t.texture),r.remove(t)}}(n),o.memory.textures--}var A=0;function C(e,t){var i=r.get(e);if(e.isVideoTexture&&function(e){var t=o.render.frame;p.get(e)!==t&&(p.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){var a=e.image;if(void 0===a);else if(!1!==a.complete)return void B(i,e,t)}n.activeTexture(33984+t),n.bindTexture(3553,i.__webglTexture)}function T(t,i){var o=r.get(t);t.version>0&&o.__version!==t.version?function(t,r,i){if(6===r.image.length){P(t,r),n.activeTexture(33984+i),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,r.flipY);for(var o=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),s=r.image[0]&&r.image[0].isDataTexture,c=[],h=0;h<6;h++)c[h]=o||s?s?r.image[h].image:r.image[h]:v(r.image[h],!1,!0,u);var d,p=c[0],f=g(p)||l,m=a.convert(r.format),M=a.convert(r.type),w=b(r.internalFormat,m,M);if(L(34067,r,f),o){for(var _=0;_<6;_++){d=c[_].mipmaps;for(var A=0;A<d.length;A++){var C=d[A];r.format!==Ye&&r.format!==Xe?null!==m&&n.compressedTexImage2D(34069+_,A,w,C.width,C.height,0,C.data):n.texImage2D(34069+_,A,w,C.width,C.height,0,m,M,C.data)}}t.__maxMipLevel=d.length-1}else{d=r.mipmaps;for(var T=0;T<6;T++)if(s){n.texImage2D(34069+T,0,w,c[T].width,c[T].height,0,m,M,c[T].data);for(var S=0;S<d.length;S++){var E=d[S].image[T].image;n.texImage2D(34069+T,S+1,w,E.width,E.height,0,m,M,E.data)}}else{n.texImage2D(34069+T,0,w,m,M,c[T]);for(var B=0;B<d.length;B++){var D=d[B];n.texImage2D(34069+T,B+1,w,m,M,D.image[T])}}t.__maxMipLevel=d.length}y(r,f)&&x(34067,r,p.width,p.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}}(o,t,i):(n.activeTexture(33984+i),n.bindTexture(34067,o.__webglTexture))}var S=(0,d.default)((0,d.default)((0,d.default)({},be,10497),Me,33071),we,33648),E=(0,d.default)((0,d.default)((0,d.default)((0,d.default)((0,d.default)((0,d.default)({},_e,9728),Ae,9984),Te,9986),Ee,9729),Le,9985),Be,9987);function L(n,a,o){o?(e.texParameteri(n,10242,S[a.wrapS]),e.texParameteri(n,10243,S[a.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,S[a.wrapR]),e.texParameteri(n,10240,E[a.magFilter]),e.texParameteri(n,10241,E[a.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),a.wrapS!==Me||a.wrapT,e.texParameteri(n,10240,M(a.magFilter)),e.texParameteri(n,10241,M(a.minFilter)),a.minFilter!==_e&&a.minFilter);var s=t.get("EXT_texture_filter_anisotropic");if(s){if(a.type===ze&&null===t.get("OES_texture_float_linear"))return;if(a.type===Ue&&null===(l||t.get("OES_texture_half_float_linear")))return;(a.anisotropy>1||r.get(a).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}}function P(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w),t.__webglTexture=e.createTexture(),o.memory.textures++)}function B(t,r,i){var o=3553;r.isDataTexture2DArray&&(o=35866),r.isDataTexture3D&&(o=32879),P(t,r),n.activeTexture(33984+i),n.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);var s,u=function(e){return!l&&(e.wrapS!==Me||e.wrapT!==Me||e.minFilter!==_e&&e.minFilter!==Ee)}(r)&&!1===g(r.image),h=v(r.image,u,!1,c),d=g(h)||l,p=a.convert(r.format),f=a.convert(r.type),m=b(r.internalFormat,p,f);L(o,r,d);var M=r.mipmaps;if(r.isDepthTexture)m=6402,l?m=r.type===ze?36012:r.type===Ne?33190:r.type===Ve?35056:33189:r.type,r.format===Ke&&6402===m&&r.type!==Ie&&r.type!==Ne&&(r.type=Ie,f=a.convert(r.type)),r.format===Ze&&6402===m&&(m=34041,r.type!==Ve&&(r.type=Ve,f=a.convert(r.type))),n.texImage2D(3553,0,m,h.width,h.height,0,p,f,null);else if(r.isDataTexture)if(M.length>0&&d){for(var w=0,_=M.length;w<_;w++)s=M[w],n.texImage2D(3553,w,m,s.width,s.height,0,p,f,s.data);r.generateMipmaps=!1,t.__maxMipLevel=M.length-1}else n.texImage2D(3553,0,m,h.width,h.height,0,p,f,h.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(var A=0,C=M.length;A<C;A++)s=M[A],r.format!==Ye&&r.format!==Xe?null!==p&&n.compressedTexImage2D(3553,A,m,s.width,s.height,0,s.data):n.texImage2D(3553,A,m,s.width,s.height,0,p,f,s.data);t.__maxMipLevel=M.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,m,h.width,h.height,h.depth,0,p,f,h.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,m,h.width,h.height,h.depth,0,p,f,h.data),t.__maxMipLevel=0;else if(M.length>0&&d){for(var T=0,S=M.length;T<S;T++)s=M[T],n.texImage2D(3553,T,m,p,f,s);r.generateMipmaps=!1,t.__maxMipLevel=M.length-1}else n.texImage2D(3553,0,m,p,f,h),t.__maxMipLevel=0;y(r,d)&&x(o,r,h.width,h.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function D(t,i,o,s){var l=a.convert(i.texture.format),u=a.convert(i.texture.type),c=b(i.texture.internalFormat,l,u);n.texImage2D(s,0,c,i.width,i.height,0,l,u,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,o,s,r.get(i.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function k(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){var i=33189;if(r){var o=n.depthTexture;o&&o.isDepthTexture&&(o.type===ze?i=36012:o.type===Ne&&(i=33190));var s=O(n);e.renderbufferStorageMultisample(36161,s,i,n.width,n.height)}else e.renderbufferStorage(36161,i,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(r){var l=O(n);e.renderbufferStorageMultisample(36161,l,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var u=a.convert(n.texture.format),c=a.convert(n.texture.type),h=b(n.texture.internalFormat,u,c);if(r){var d=O(n);e.renderbufferStorageMultisample(36161,d,h,n.width,n.height)}else e.renderbufferStorage(36161,h,n.width,n.height)}e.bindRenderbuffer(36161,null)}function R(t){var n=r.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),C(n.depthTexture,0);var i=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===Ke)e.framebufferTexture2D(36160,36096,3553,i,0);else{if(n.depthTexture.format!==Ze)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,i,0)}}(n.__webglFramebuffer,t)}else if(i){n.__webglDepthbuffer=[];for(var a=0;a<6;a++)e.bindFramebuffer(36160,n.__webglFramebuffer[a]),n.__webglDepthbuffer[a]=e.createRenderbuffer(),k(n.__webglDepthbuffer[a],t,!1)}else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),k(n.__webglDepthbuffer,t,!1);e.bindFramebuffer(36160,null)}function O(e){return l&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}var I=!1,F=!1;this.allocateTextureUnit=function(){var e=A;return A+=1,e},this.resetTextureUnits=function(){A=0},this.setTexture2D=C,this.setTexture2DArray=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?B(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?B(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=T,this.setupRenderTarget=function(t){var i=r.get(t),s=r.get(t.texture);t.addEventListener("dispose",_),s.__webglTexture=e.createTexture(),o.memory.textures++;var u=!0===t.isWebGLCubeRenderTarget,c=!0===t.isWebGLMultisampleRenderTarget,h=g(t)||l;if(!l||t.texture.format!==Xe||t.texture.type!==ze&&t.texture.type!==Ue||(t.texture.format=Ye),u){i.__webglFramebuffer=[];for(var d=0;d<6;d++)i.__webglFramebuffer[d]=e.createFramebuffer()}else if(i.__webglFramebuffer=e.createFramebuffer(),c&&l){i.__webglMultisampledFramebuffer=e.createFramebuffer(),i.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,i.__webglColorRenderbuffer);var p=a.convert(t.texture.format),f=a.convert(t.texture.type),m=b(t.texture.internalFormat,p,f),v=O(t);e.renderbufferStorageMultisample(36161,v,m,t.width,t.height),e.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(i.__webglDepthRenderbuffer=e.createRenderbuffer(),k(i.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}if(u){n.bindTexture(34067,s.__webglTexture),L(34067,t.texture,h);for(var M=0;M<6;M++)D(i.__webglFramebuffer[M],t,36064,34069+M);y(t.texture,h)&&x(34067,t.texture,t.width,t.height),n.bindTexture(34067,null)}else n.bindTexture(3553,s.__webglTexture),L(3553,t.texture,h),D(i.__webglFramebuffer,t,36064,3553),y(t.texture,h)&&x(3553,t.texture,t.width,t.height),n.bindTexture(3553,null);t.depthBuffer&&R(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(y(t,g(e)||l)){var i=e.isWebGLCubeRenderTarget?34067:3553,a=r.get(t).__webglTexture;n.bindTexture(i,a),x(i,t,e.width,e.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget&&l){var n=r.get(t);e.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,n.__webglFramebuffer);var i=t.width,a=t.height,o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024),e.blitFramebuffer(0,0,i,a,0,0,i,a,o,9728),e.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===I&&(I=!0),e=e.texture),C(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===F&&(F=!0),e=e.texture),T(e,t)}}function Ws(e,t,n){var r=n.isWebGL2;return{convert:function(e){var n;if(e===ke)return 5121;if(e===He)return 32819;if(e===je)return 32820;if(e===Ge)return 33635;if(e===Re)return 5120;if(e===Oe)return 5122;if(e===Ie)return 5123;if(e===Fe)return 5124;if(e===Ne)return 5125;if(e===ze)return 5126;if(e===Ue)return r?5131:null!==(n=t.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(e===We)return 6406;if(e===Xe)return 6407;if(e===Ye)return 6408;if(e===Je)return 6409;if(e===Qe)return 6410;if(e===Ke)return 6402;if(e===Ze)return 34041;if(e===$e)return 6403;if(e===et)return 36244;if(e===tt)return 33319;if(e===nt)return 33320;if(e===rt)return 36248;if(e===it)return 36249;if(e===at||e===ot||e===st||e===lt){if(null===(n=t.get("WEBGL_compressed_texture_s3tc")))return null;if(e===at)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===ot)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===st)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===lt)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===ut||e===ct||e===ht||e===dt){if(null===(n=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===ut)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===ct)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===ht)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===dt)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===pt)return null!==(n=t.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===ft||e===mt)&&null!==(n=t.get("WEBGL_compressed_texture_etc"))){if(e===ft)return n.COMPRESSED_RGB8_ETC2;if(e===mt)return n.COMPRESSED_RGBA8_ETC2_EAC}return e===vt||e===gt||e===yt||e===xt||e===bt||e===Mt||e===wt||e===_t||e===At||e===Ct||e===Tt||e===St||e===Et||e===Lt||e===Bt||e===Dt||e===kt||e===Rt||e===Ot||e===It||e===Ft||e===Nt||e===zt||e===Ut||e===Ht||e===jt||e===Gt||e===Vt?null!==(n=t.get("WEBGL_compressed_texture_astc"))?e:null:e===Pt?null!==(n=t.get("EXT_texture_compression_bptc"))?e:null:e===Ve?r?34042:null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function Xs(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Da.call(this),this.cameras=e}function Ys(){oi.call(this),this.type="Group"}function Js(){this._targetRay=null,this._grip=null,this._hand=null}function Qs(e,t){var n=this,r=null,i=1,a=null,o="local-floor",s=null,l=[],u=new Map,c=new Da;c.layers.enable(1),c.viewport=new rr;var h=new Da;h.layers.enable(2),h.viewport=new rr;var d=[c,h],p=new Xs;p.layers.enable(1),p.layers.enable(2);var f=null,m=null;function v(e){var t=u.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function g(){u.forEach((function(e,t){e.disconnect(t)})),u.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),A.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function y(e){a=e,A.setContext(r),A.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function x(e){for(var t=r.inputSources,n=0;n<l.length;n++)u.set(t[n],l[n]);for(var i=0;i<e.removed.length;i++){var a=e.removed[i],o=u.get(a);o&&(o.dispatchEvent({type:"disconnected",data:a}),u.delete(a))}for(var s=0;s<e.added.length;s++){var c=e.added[s],h=u.get(c);h&&h.dispatchEvent({type:"connected",data:c})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){var t=l[e];return void 0===t&&(t=new Js,l[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){var t=l[e];return void 0===t&&(t=new Js,l[e]=t),t.getGripSpace()},this.getHand=function(e){var t=l[e];return void 0===t&&(t=new Js,l[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,n.isPresenting},this.setReferenceSpaceType=function(e){o=e,n.isPresenting},this.getReferenceSpace=function(){return a},this.getSession=function(){return r},this.setSession=function(e){if(null!==(r=e)){r.addEventListener("select",v),r.addEventListener("selectstart",v),r.addEventListener("selectend",v),r.addEventListener("squeeze",v),r.addEventListener("squeezestart",v),r.addEventListener("squeezeend",v),r.addEventListener("end",g);var n=t.getContextAttributes();!0!==n.xrCompatible&&t.makeXRCompatible();var a={antialias:n.antialias,alpha:n.alpha,depth:n.depth,stencil:n.stencil,framebufferScaleFactor:i},s=new XRWebGLLayer(r,t,a);r.updateRenderState({baseLayer:s}),r.requestReferenceSpace(o).then(y),r.addEventListener("inputsourceschange",x)}};var b=new sr,M=new sr;function w(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.getCamera=function(e){p.near=h.near=c.near=e.near,p.far=h.far=c.far=e.far,f===p.near&&m===p.far||(r.updateRenderState({depthNear:p.near,depthFar:p.far}),f=p.near,m=p.far);var t=e.parent,n=p.cameras;w(p,t);for(var i=0;i<n.length;i++)w(n[i],t);e.matrixWorld.copy(p.matrixWorld);for(var a=e.children,o=0,s=a.length;o<s;o++)a[o].updateMatrixWorld(!0);return 2===n.length?function(e,t,n){b.setFromMatrixPosition(t.matrixWorld),M.setFromMatrixPosition(n.matrixWorld);var r=b.distanceTo(M),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=o*c,p=o*h,f=r/(-c+h),m=f*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var v=o+f,g=s+f,y=d-m,x=p+(r-m),w=l*s/g*v,_=u*s/g*v;e.projectionMatrix.makePerspective(y,x,w,_,v,g)}(p,c,h):p.projectionMatrix.copy(c.projectionMatrix),p};var _=null,A=new ja;A.setAnimationLoop((function(t,n){if(null!==(s=n.getViewerPose(a))){var i=s.views,o=r.renderState.baseLayer;e.setFramebuffer(o.framebuffer);var u=!1;i.length!==p.cameras.length&&(p.cameras.length=0,u=!0);for(var c=0;c<i.length;c++){var h=i[c],f=o.getViewport(h),m=d[c];m.matrix.fromArray(h.transform.matrix),m.projectionMatrix.fromArray(h.projectionMatrix),m.viewport.set(f.x,f.y,f.width,f.height),0===c&&p.matrix.copy(m.matrix),!0===u&&p.cameras.push(m)}}for(var v=r.inputSources,g=0;g<l.length;g++){var y=l[g],x=v[g];y.update(x,n,a)}_&&_(t,n)})),this.setAnimationLoop=function(e){_=e},this.dispose=function(){}}function qs(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);var r,i,a=e.get(n).envMap;if(a){t.envMap.value=a,t.flipEnvMap.value=a.isCubeTexture&&a._needsFlipEnvMap?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;var o=e.get(a).__maxMipLevel;void 0!==o&&(t.maxMipLevel.value=o)}n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(r=n.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix)),n.aoMap?i=n.aoMap:n.lightMap&&(i=n.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uv2Transform.value.copy(i.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===w&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===w&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,i,a){r.isMeshBasicMaterial?t(e,r):r.isMeshLambertMaterial?(t(e,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,r)):r.isMeshToonMaterial?(t(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===w&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===w&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshPhongMaterial?(t(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===w&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===w&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshStandardMaterial?(t(e,r),r.isMeshPhysicalMaterial?function(e,t){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen),t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===w&&e.clearcoatNormalScale.value.negate()),e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}(e,r):n(e,r)):r.isMeshMatcapMaterial?(t(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===w&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===w&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDepthMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDistanceMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?(t(e,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===w&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===w&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){var i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r,i,a):r.isSpriteMaterial?function(e,t){var n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Ks(e){var t=void 0!==(e=e||{}).canvas?e.canvas:function(){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,h=null,d=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=on,this.physicallyCorrectLights=!1,this.toneMapping=se,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var p=this,f=!1,m=null,v=0,g=0,y=null,x=null,b=-1,M=null,w=null,_=new rr,A=new rr,C=null,T=t.width,S=t.height,E=1,L=null,P=null,B=new rr(0,0,T,S),D=new rr(0,0,T,S),k=!1,R=new Ha,O=!1,I=!1,F=new Or,N=new sr,z={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function U(){return null===y?E:1}var H,j,G,V,W,X,Y,J,Q,q,K,Z,$,ee,te,ne,re,ie,ae,oe,le,ue=n;function ce(e,n){for(var r=0;r<e.length;r++){var i=e[r],a=t.getContext(i,n);if(null!==a)return a}return null}try{var he={alpha:r,depth:i,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:c};if(t.addEventListener("webglcontextlost",ve,!1),t.addEventListener("webglcontextrestored",ge,!1),null===ue){var de=["webgl2","webgl","experimental-webgl"];if(!0===p.isWebGL1Renderer&&de.shift(),null===(ue=ce(de,he)))throw ce(de)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ue.getShaderPrecisionFormat&&(ue.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw e}function pe(){H=new eo(ue),!1===(j=new Ka(ue,H,e)).isWebGL2&&(H.get("WEBGL_depth_texture"),H.get("OES_texture_float"),H.get("OES_texture_half_float"),H.get("OES_texture_half_float_linear"),H.get("OES_standard_derivatives"),H.get("OES_element_index_uint"),H.get("OES_vertex_array_object"),H.get("ANGLE_instanced_arrays")),H.get("OES_texture_float_linear"),oe=new Ws(ue,H,j),(G=new Gs(ue,H,j)).scissor(A.copy(D).multiplyScalar(E).floor()),G.viewport(_.copy(B).multiplyScalar(E).floor()),V=new ro(ue),W=new Ss,X=new Vs(ue,H,G,W,j,oe,V),Y=new $a(p),J=new Ga(ue,j),le=new Qa(ue,H,J,j),Q=new to(ue,J,V,le),q=new so(ue,Q,J,V),re=new oo(ue),te=new Za(W),K=new Ts(p,Y,H,j,le,te),Z=new qs(W),$=new Bs(W),ee=new Fs(H,j),ne=new Ja(p,Y,G,q,s),ie=new qa(ue,H,V,j),ae=new no(ue,H,V,j),V.programs=K.programs,p.capabilities=j,p.extensions=H,p.properties=W,p.renderLists=$,p.state=G,p.info=V}pe();var fe=new Qs(p,ue);this.xr=fe;var me=new js(p,q,j.maxTextureSize);function ve(e){e.preventDefault(),f=!0}function ge(){f=!1,pe()}function ye(e){var t=e.target;t.removeEventListener("dispose",ye),function(e){xe(e),W.remove(e)}(t)}function xe(e){var t=W.get(e).program;void 0!==t&&K.releaseProgram(t)}this.shadowMap=me,this.getContext=function(){return ue},this.getContextAttributes=function(){return ue.getContextAttributes()},this.forceContextLoss=function(){var e=H.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=H.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return E},this.setPixelRatio=function(e){void 0!==e&&(E=e,this.setSize(T,S,!1))},this.getSize=function(e){return void 0===e&&(e=new Kn),e.set(T,S)},this.setSize=function(e,n,r){fe.isPresenting||(T=e,S=n,t.width=Math.floor(e*E),t.height=Math.floor(n*E),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(e=new Kn),e.set(T*E,S*E).floor()},this.setDrawingBufferSize=function(e,n,r){T=e,S=n,E=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(e=new rr),e.copy(_)},this.getViewport=function(e){return e.copy(B)},this.setViewport=function(e,t,n,r){e.isVector4?B.set(e.x,e.y,e.z,e.w):B.set(e,t,n,r),G.viewport(_.copy(B).multiplyScalar(E).floor())},this.getScissor=function(e){return e.copy(D)},this.setScissor=function(e,t,n,r){e.isVector4?D.set(e.x,e.y,e.z,e.w):D.set(e,t,n,r),G.scissor(A.copy(D).multiplyScalar(E).floor())},this.getScissorTest=function(){return k},this.setScissorTest=function(e){G.setScissorTest(k=e)},this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){P=e},this.getClearColor=function(){return ne.getClearColor()},this.setClearColor=function(){ne.setClearColor.apply(ne,arguments)},this.getClearAlpha=function(){return ne.getClearAlpha()},this.setClearAlpha=function(){ne.setClearAlpha.apply(ne,arguments)},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===n||n)&&(r|=1024),ue.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ve,!1),t.removeEventListener("webglcontextrestored",ge,!1),$.dispose(),ee.dispose(),W.dispose(),Y.dispose(),q.dispose(),le.dispose(),fe.dispose(),Me.stop()},this.renderBufferImmediate=function(e,t){le.initAttributes();var n=W.get(e);e.hasPositions&&!n.position&&(n.position=ue.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=ue.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=ue.createBuffer()),e.hasColors&&!n.color&&(n.color=ue.createBuffer());var r=t.getAttributes();e.hasPositions&&(ue.bindBuffer(34962,n.position),ue.bufferData(34962,e.positionArray,35048),le.enableAttribute(r.position),ue.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(ue.bindBuffer(34962,n.normal),ue.bufferData(34962,e.normalArray,35048),le.enableAttribute(r.normal),ue.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(ue.bindBuffer(34962,n.uv),ue.bufferData(34962,e.uvArray,35048),le.enableAttribute(r.uv),ue.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(ue.bindBuffer(34962,n.color),ue.bufferData(34962,e.colorArray,35048),le.enableAttribute(r.color),ue.vertexAttribPointer(r.color,3,5126,!1,0,0)),le.disableUnusedAttributes(),ue.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=z);var o=i.isMesh&&i.matrixWorld.determinant()<0,s=Te(e,t,r,i);G.setMaterial(r,o);var l=n.index,u=n.attributes.position;if(null===l){if(void 0===u||0===u.count)return}else if(0===l.count)return;var c,h=1;!0===r.wireframe&&(l=Q.getWireframeAttribute(n),h=2),(r.morphTargets||r.morphNormals)&&re.update(i,n,r,s),le.setup(i,r,s,n,l);var d=ie;null!==l&&(c=J.get(l),(d=ae).setIndex(c));var p=null!==l?l.count:u.count,f=n.drawRange.start*h,m=n.drawRange.count*h,v=null!==a?a.start*h:0,g=null!==a?a.count*h:1/0,y=Math.max(f,v),x=Math.min(p,f+m,v+g)-1,b=Math.max(0,x-y+1);if(0!==b){if(i.isMesh)!0===r.wireframe?(G.setLineWidth(r.wireframeLinewidth*U()),d.setMode(1)):d.setMode(4);else if(i.isLine){var M=r.linewidth;void 0===M&&(M=1),G.setLineWidth(M*U()),i.isLineSegments?d.setMode(1):i.isLineLoop?d.setMode(2):d.setMode(3)}else i.isPoints?d.setMode(0):i.isSprite&&d.setMode(4);if(i.isInstancedMesh)d.renderInstances(y,b,i.count);else if(n.isInstancedBufferGeometry){var w=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(y,b,w)}else d.render(y,b)}},this.compile=function(e,t){(d=ee.get(e,t)).init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(t);var n=new WeakMap;e.traverse((function(t){var r=t.material;if(r)if(Array.isArray(r))for(var i=0;i<r.length;i++){var a=r[i];!1===n.has(a)&&(Ce(a,e,t),n.set(a))}else!1===n.has(r)&&(Ce(r,e,t),n.set(r))}))};var be=null,Me=new ja;function we(e,t,n,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||R.intersectsSprite(e)){r&&N.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);var i=q.update(e),a=e.material;a.visible&&h.push(e,i,a,n,N.z,null)}}else if(e.isImmediateRenderObject)r&&N.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F),h.push(e,null,e.material,n,N.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==V.render.frame&&(e.skeleton.update(),e.skeleton.frame=V.render.frame),!e.frustumCulled||R.intersectsObject(e))){r&&N.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);var o=q.update(e),s=e.material;if(Array.isArray(s))for(var l=o.groups,u=0,c=l.length;u<c;u++){var p=l[u],f=s[p.materialIndex];f&&f.visible&&h.push(e,o,f,n,N.z,p)}else s.visible&&h.push(e,o,s,n,N.z,null)}for(var m=e.children,v=0,g=m.length;v<g;v++)we(m[v],t,n,r)}}function _e(e,t,n){for(var r=!0===t.isScene?t.overrideMaterial:null,i=0,a=e.length;i<a;i++){var o=e[i],s=o.object,l=o.geometry,u=null===r?o.material:r,c=o.group;if(n.isArrayCamera){w=n;for(var h=n.cameras,p=0,f=h.length;p<f;p++){var m=h[p];s.layers.test(m.layers)&&(G.viewport(_.copy(m.viewport)),d.setupLights(m),Ae(s,t,m,l,u,c))}}else w=null,Ae(s,t,n,l,u,c)}}function Ae(e,t,n,r,i,a){if(e.onBeforeRender(p,t,n,r,i,a),d=ee.get(t,w||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var o=Te(n,t,i,e);G.setMaterial(i),le.reset(),function(e,t){e.render((function(e){p.renderBufferImmediate(e,t)}))}(e,o)}else p.renderBufferDirect(n,t,r,i,e,a);e.onAfterRender(p,t,n,r,i,a),d=ee.get(t,w||n)}function Ce(e,t,n){!0!==t.isScene&&(t=z);var r=W.get(e),i=d.state.lights,a=d.state.shadowsArray,o=i.state.version,s=K.getParameters(e,i.state,a,t,n),l=K.getProgramCacheKey(s),u=r.program,c=!0;if(void 0===u)e.addEventListener("dispose",ye);else if(u.cacheKey!==l)xe(e);else if(r.lightsStateVersion!==o)c=!1;else{if(void 0!==s.shaderID){var h=e.isMeshStandardMaterial?t.environment:null;return void(r.envMap=Y.get(e.envMap||h))}c=!1}c&&(s.uniforms=K.getUniforms(e),e.onBeforeCompile(s,p),u=K.acquireProgram(s,l),r.program=u,r.uniforms=s.uniforms,r.outputEncoding=s.outputEncoding);var f=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=te.numPlanes,r.numIntersection=te.numIntersection,f.clippingPlanes=te.uniform),r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=Y.get(e.envMap||r.environment),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=o,r.needsLights&&(f.ambientLightColor.value=i.state.ambient,f.lightProbe.value=i.state.probe,f.directionalLights.value=i.state.directional,f.directionalLightShadows.value=i.state.directionalShadow,f.spotLights.value=i.state.spot,f.spotLightShadows.value=i.state.spotShadow,f.rectAreaLights.value=i.state.rectArea,f.ltc_1.value=i.state.rectAreaLTC1,f.ltc_2.value=i.state.rectAreaLTC2,f.pointLights.value=i.state.point,f.pointLightShadows.value=i.state.pointShadow,f.hemisphereLights.value=i.state.hemi,f.directionalShadowMap.value=i.state.directionalShadowMap,f.directionalShadowMatrix.value=i.state.directionalShadowMatrix,f.spotShadowMap.value=i.state.spotShadowMap,f.spotShadowMatrix.value=i.state.spotShadowMatrix,f.pointShadowMap.value=i.state.pointShadowMap,f.pointShadowMatrix.value=i.state.pointShadowMatrix);var m=r.program.getUniforms(),v=as.seqWithValue(m.seq,f);r.uniformsList=v}function Te(e,t,n,r){!0!==t.isScene&&(t=z),X.resetTextureUnits();var i=t.fog,a=n.isMeshStandardMaterial?t.environment:null,o=null===y?p.outputEncoding:y.texture.encoding,s=Y.get(n.envMap||a),l=W.get(n),u=d.state.lights;if(!0===O&&(!0===I||e!==M)){var c=e===M&&n.id===b;te.setState(n,e,c)}n.version===l.__version?n.fog&&l.fog!==i||l.environment!==a||l.needsLights&&l.lightsStateVersion!==u.state.version?Ce(n,t,r):void 0===l.numClippingPlanes||l.numClippingPlanes===te.numPlanes&&l.numIntersection===te.numIntersection?(l.outputEncoding!==o||l.envMap!==s)&&Ce(n,t,r):Ce(n,t,r):(Ce(n,t,r),l.__version=n.version);var h,f,m=!1,v=!1,g=!1,x=l.program,w=x.getUniforms(),_=l.uniforms;if(G.useProgram(x.program)&&(m=!0,v=!0,g=!0),n.id!==b&&(b=n.id,v=!0),m||M!==e){if(w.setValue(ue,"projectionMatrix",e.projectionMatrix),j.logarithmicDepthBuffer&&w.setValue(ue,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),M!==e&&(M=e,v=!0,g=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){var A=w.map.cameraPosition;void 0!==A&&A.setValue(ue,N.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&w.setValue(ue,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&w.setValue(ue,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){w.setOptional(ue,r,"bindMatrix"),w.setOptional(ue,r,"bindMatrixInverse");var C=r.skeleton;if(C){var T=C.bones;if(j.floatVertexTextures){if(null===C.boneTexture){var L=Math.sqrt(4*T.length);L=qn.ceilPowerOfTwo(L),L=Math.max(L,4);var P=new Float32Array(L*L*4);P.set(C.boneMatrices);var B=new Na(P,L,L,Ye,ze);C.boneMatrices=P,C.boneTexture=B,C.boneTextureSize=L}w.setValue(ue,"boneTexture",C.boneTexture,X),w.setValue(ue,"boneTextureSize",C.boneTextureSize)}else w.setOptional(ue,C,"boneMatrices")}}return(v||l.receiveShadow!==r.receiveShadow)&&(l.receiveShadow=r.receiveShadow,w.setValue(ue,"receiveShadow",r.receiveShadow)),v&&(w.setValue(ue,"toneMappingExposure",p.toneMappingExposure),l.needsLights&&(f=g,(h=_).ambientLightColor.needsUpdate=f,h.lightProbe.needsUpdate=f,h.directionalLights.needsUpdate=f,h.directionalLightShadows.needsUpdate=f,h.pointLights.needsUpdate=f,h.pointLightShadows.needsUpdate=f,h.spotLights.needsUpdate=f,h.spotLightShadows.needsUpdate=f,h.rectAreaLights.needsUpdate=f,h.hemisphereLights.needsUpdate=f),i&&n.fog&&Z.refreshFogUniforms(_,i),Z.refreshMaterialUniforms(_,n,E,S),as.upload(ue,l.uniformsList,_,X)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(as.upload(ue,l.uniformsList,_,X),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&w.setValue(ue,"center",r.center),w.setValue(ue,"modelViewMatrix",r.modelViewMatrix),w.setValue(ue,"normalMatrix",r.normalMatrix),w.setValue(ue,"modelMatrix",r.matrixWorld),x}Me.setAnimationLoop((function(e){fe.isPresenting||be&&be(e)})),"undefined"!=typeof window&&Me.setContext(window),this.setAnimationLoop=function(e){be=e,fe.setAnimationLoop(e),null===e?Me.stop():Me.start()},this.render=function(e,t){var n,r;if(void 0!==arguments[2]&&(n=arguments[2]),void 0!==arguments[3]&&(r=arguments[3]),(void 0===t||!0===t.isCamera)&&!0!==f){le.resetDefaultState(),b=-1,M=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===fe.enabled&&!0===fe.isPresenting&&(t=fe.getCamera(t)),!0===e.isScene&&e.onBeforeRender(p,e,t,n||y),(d=ee.get(e,t)).init(),F.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),R.setFromProjectionMatrix(F),I=this.localClippingEnabled,O=te.init(this.clippingPlanes,I,t),(h=$.get(e,t)).init(),we(e,t,0,p.sortObjects),h.finish(),!0===p.sortObjects&&h.sort(L,P),!0===O&&te.beginShadows();var i=d.state.shadowsArray;me.render(i,e,t),d.setupLights(t),!0===O&&te.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),ne.render(h,e,t,r);var a=h.opaque,o=h.transparent;a.length>0&&_e(a,e,t),o.length>0&&_e(o,e,t),!0===e.isScene&&e.onAfterRender(p,e,t),null!==y&&(X.updateRenderTargetMipmap(y),X.updateMultisampleRenderTarget(y)),G.buffers.depth.setTest(!0),G.buffers.depth.setMask(!0),G.buffers.color.setMask(!0),G.setPolygonOffset(!1),h=null,d=null}},this.setFramebuffer=function(e){m!==e&&null===y&&ue.bindFramebuffer(36160,e),m=e},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return g},this.getRenderList=function(){return h},this.setRenderList=function(e){h=e},this.getRenderState=function(){return d},this.setRenderState=function(e){d=e},this.getRenderTarget=function(){return y},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;y=e,v=t,g=n,e&&void 0===W.get(e).__webglFramebuffer&&X.setupRenderTarget(e);var r=m,i=!1;if(e){var a=W.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=a[t],i=!0):r=e.isWebGLMultisampleRenderTarget?W.get(e).__webglMultisampledFramebuffer:a,_.copy(e.viewport),A.copy(e.scissor),C=e.scissorTest}else _.copy(B).multiplyScalar(E).floor(),A.copy(D).multiplyScalar(E).floor(),C=k;if(x!==r&&(ue.bindFramebuffer(36160,r),x=r),G.viewport(_),G.scissor(A),G.setScissorTest(C),i){var o=W.get(e.texture);ue.framebufferTexture2D(36160,36064,34069+t,o.__webglTexture,n)}},this.readRenderTargetPixels=function(e,t,n,r,i,a,o){if(e&&e.isWebGLRenderTarget){var s=W.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){var l=!1;s!==x&&(ue.bindFramebuffer(36160,s),l=!0);try{var u=e.texture,c=u.format,h=u.type;if(c!==Ye&&oe.convert(c)!==ue.getParameter(35739))return;if(!(h===ke||oe.convert(h)===ue.getParameter(35738)||h===ze&&(j.isWebGL2||H.get("OES_texture_float")||H.get("WEBGL_color_buffer_float"))||h===Ue&&(j.isWebGL2?H.get("EXT_color_buffer_float"):H.get("EXT_color_buffer_half_float"))))return;36053===ue.checkFramebufferStatus(36160)&&t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&ue.readPixels(t,n,r,i,oe.convert(c),oe.convert(h),a)}finally{l&&ue.bindFramebuffer(36160,x)}}}},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Math.pow(2,-n),i=Math.floor(t.image.width*r),a=Math.floor(t.image.height*r),o=oe.convert(t.format);X.setTexture2D(t,0),ue.copyTexImage2D(3553,n,o,e.x,e.y,i,a,0),G.unbindTexture()},this.copyTextureToTexture=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=t.image.width,a=t.image.height,o=oe.convert(n.format),s=oe.convert(n.type);X.setTexture2D(n,0),ue.pixelStorei(37440,n.flipY),ue.pixelStorei(37441,n.premultiplyAlpha),ue.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?ue.texSubImage2D(3553,r,e.x,e.y,i,a,o,s,t.image.data):t.isCompressedTexture?ue.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):ue.texSubImage2D(3553,r,e.x,e.y,o,s,t.image),0===r&&n.generateMipmaps&&ue.generateMipmap(3553),G.unbindTexture()},this.initTexture=function(e){X.setTexture2D(e,0),G.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Zs(e){Ks.call(this,e)}Xs.prototype=Object.assign(Object.create(Da.prototype),{constructor:Xs,isArrayCamera:!0}),Ys.prototype=Object.assign(Object.create(oi.prototype),{constructor:Ys,isGroup:!0}),Object.assign(Js.prototype,{constructor:Js,getHandSpace:function(){if(null===this._hand&&(this._hand=new Ys,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(var e=0;e<=window.XRHand.LITTLE_PHALANX_TIP;e++){var t=new Ys;t.matrixAutoUpdate=!1,t.visible=!1,this._hand.joints.push(t),this._hand.add(t)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Ys,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Ys,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(e,t,n){var r=null,i=null,a=null,o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(l&&e.hand){a=!0;for(var u=0;u<=window.XRHand.LITTLE_PHALANX_TIP;u++)if(e.hand[u]){var c=t.getJointPose(e.hand[u],n),h=l.joints[u];null!==c&&(h.matrix.fromArray(c.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),h.jointRadius=c.radius),h.visible=null!==c;var d=l.joints[window.XRHand.INDEX_PHALANX_TIP],p=l.joints[window.XRHand.THUMB_PHALANX_TIP],f=d.position.distanceTo(p.position),m=.02,v=.005;l.inputState.pinching&&f>m+v?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&f<=m-v&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}}else null!==o&&null!==(r=t.getPose(e.targetRaySpace,n))&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale)),null!==s&&e.gripSpace&&null!==(i=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale));return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==i),null!==l&&(l.visible=null!==a),this}}),Object.assign(Qs.prototype,Wn.prototype),Zs.prototype=Object.assign(Object.create(Ks.prototype),{constructor:Zs,isWebGL1Renderer:!0});var $s=function(){function e(t,n){(0,v.default)(this,e),Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new Ei(t),this.density=void 0!==n?n:25e-5}return(0,g.default)(e,[{key:"clone",value:function(){return new e(this.color,this.density)}},{key:"toJSON",value:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}])}(),el=function(){function e(t,n,r){(0,v.default)(this,e),Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new Ei(t),this.near=void 0!==n?n:1,this.far=void 0!==r?r:1e3}return(0,g.default)(e,[{key:"clone",value:function(){return new e(this.color,this.near,this.far)}},{key:"toJSON",value:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}])}(),tl=function(e){function t(){var e;return(0,v.default)(this,t),e=T(this,t),Object.defineProperty((0,c.default)(e),"isScene",{value:!0}),e.type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,e.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:(0,c.default)(e)})),e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"copy",value:function(e,n){return C(t,"copy",this,3)([e,n]),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var n=C(t,"toJSON",this,3)([e]);return null!==this.background&&(n.object.background=this.background.toJSON(e)),null!==this.environment&&(n.object.environment=this.environment.toJSON(e)),null!==this.fog&&(n.object.fog=this.fog.toJSON()),n}}])}(oi);function nl(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Rn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=qn.generateUUID()}Object.defineProperty(nl.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(nl.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=qn.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new nl(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=qn.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});var rl,il=new sr;function al(e,t,n,r){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}function ol(e){Bi.call(this),this.type="SpriteMaterial",this.color=new Ei(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.defineProperties(al.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(e){this.data.needsUpdate=e}}}),Object.assign(al.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,n=this.data.count;t<n;t++)il.x=this.getX(t),il.y=this.getY(t),il.z=this.getZ(t),il.applyMatrix4(e),this.setXYZ(t,il.x,il.y,il.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this},clone:function(e){if(void 0===e){for(var t=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,i=0;i<this.itemSize;i++)t.push(this.data.array[r+i]);return new Oi(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new al(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(e){if(void 0===e){for(var t=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,i=0;i<this.itemSize;i++)t.push(this.data.array[r+i]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),ol.prototype=Object.create(Bi.prototype),ol.prototype.constructor=ol,ol.prototype.isSpriteMaterial=!0,ol.prototype.copy=function(e){return Bi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var sl=new sr,ll=new sr,ul=new sr,cl=new Kn,hl=new Kn,dl=new Or,pl=new sr,fl=new sr,ml=new sr,vl=new Kn,gl=new Kn,yl=new Kn;function xl(e){if(oi.call(this),this.type="Sprite",void 0===rl){rl=new ra;var t=new nl(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);rl.setIndex([0,1,2,0,2,3]),rl.setAttribute("position",new al(t,3,0,!1)),rl.setAttribute("uv",new al(t,2,3,!1))}this.geometry=rl,this.material=void 0!==e?e:new ol,this.center=new Kn(.5,.5)}function bl(e,t,n,r,i,a){cl.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(hl.x=a*cl.x-i*cl.y,hl.y=i*cl.x+a*cl.y):hl.copy(cl),e.copy(t),e.x+=hl.x,e.y+=hl.y,e.applyMatrix4(dl)}xl.prototype=Object.assign(Object.create(oi.prototype),{constructor:xl,isSprite:!0,raycast:function(e,t){if(e.camera,this.visible){var n=!0;if(this.traverseAncestors((function(e){e.visible||(n=!1)})),n){ll.setFromMatrixScale(this.matrixWorld),dl.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ul.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&ll.multiplyScalar(-ul.z);var r,i,a=this.material.rotation;0!==a&&(i=Math.cos(a),r=Math.sin(a));var o=this.center;bl(pl.set(-.5,-.5,0),ul,o,ll,r,i),bl(fl.set(.5,-.5,0),ul,o,ll,r,i),bl(ml.set(.5,.5,0),ul,o,ll,r,i),vl.set(0,0),gl.set(1,0),yl.set(1,1);var s=e.ray.intersectTriangle(pl,fl,ml,!1,sl);if(null!==s||(bl(fl.set(-.5,.5,0),ul,o,ll,r,i),gl.set(0,1),null!==(s=e.ray.intersectTriangle(pl,ml,fl,!1,sl)))){var l=e.ray.origin.distanceTo(sl);l<e.near||l>e.far||t.push({distance:l,point:sl.clone(),uv:Mi.getUV(sl,pl,fl,ml,vl,gl,yl,new Kn),face:null,object:this})}}}},copy:function(e){return oi.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}});var Ml=new sr,wl=new sr;function _l(){oi.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function Al(e,t){e&&e.isGeometry,Ma.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Or,this.bindMatrixInverse=new Or}function Cl(){oi.call(this),this.type="Bone"}_l.prototype=Object.assign(Object.create(oi.prototype),{constructor:_l,isLOD:!0,copy:function(e){oi.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,r=t.length;n<r;n++){var i=t[n];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t=Math.abs(t);var n,r=this.levels;for(n=0;n<r.length&&!(t<r[n].distance);n++);return r.splice(n,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){var n,r;for(n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(this.levels.length>0){Ml.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(Ml);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){Ml.setFromMatrixPosition(e.matrixWorld),wl.setFromMatrixPosition(this.matrixWorld);var n,r,i=Ml.distanceTo(wl)/e.zoom;for(t[0].object.visible=!0,n=1,r=t.length;n<r&&i>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)t[n].object.visible=!1}},toJSON:function(e){var t=oi.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var n=this.levels,r=0,i=n.length;r<i;r++){var a=n[r];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}}),Al.prototype=Object.assign(Object.create(Ma.prototype),{constructor:Al,isSkinnedMesh:!0,copy:function(e){return Ma.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new rr,t=this.geometry.attributes.skinWeight,n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Ma.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode&&this.bindMatrixInverse.copy(this.bindMatrix).invert()},boneTransform:function(){var e=new sr,t=new rr,n=new rr,r=new sr,i=new Or;return function(a,o){var s=this.skeleton,l=this.geometry;t.fromBufferAttribute(l.attributes.skinIndex,a),n.fromBufferAttribute(l.attributes.skinWeight,a),e.fromBufferAttribute(l.attributes.position,a).applyMatrix4(this.bindMatrix),o.set(0,0,0);for(var u=0;u<4;u++){var c=n.getComponent(u);if(0!==c){var h=t.getComponent(u);i.multiplyMatrices(s.bones[h].matrixWorld,s.boneInverses[h]),o.addScaledVector(r.copy(e).applyMatrix4(i),c)}}return o.applyMatrix4(this.bindMatrixInverse)}}()}),Cl.prototype=Object.assign(Object.create(oi.prototype),{constructor:Cl,isBone:!0});var Tl=new Or,Sl=new Or;function El(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=qn.generateUUID(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(El.prototype,{init:function(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Or)}},calculateInverses:function(){this.boneInverses.length=0;for(var e=0,t=this.bones.length;e<t;e++){var n=new Or;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}},pose:function(){for(var e=0,t=this.bones.length;e<t;e++){var n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(var r=0,i=this.bones.length;r<i;r++){var a=this.bones[r];a&&(a.parent&&a.parent.isBone?(a.matrix.copy(a.parent.matrixWorld).invert(),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale))}},update:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,a=e.length;i<a;i++){var o=e[i]?e[i].matrixWorld:Sl;Tl.multiplyMatrices(o,t[i]),Tl.toArray(n,16*i)}null!==r&&(r.needsUpdate=!0)},clone:function(){return new El(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t];if(r.name===e)return r}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(e,t){this.uuid=e.uuid;for(var n=0,r=e.bones.length;n<r;n++){var i=t[e.bones[n]];void 0===i&&(i=new Cl),this.bones.push(i),this.boneInverses.push((new Or).fromArray(e.boneInverses[n]))}return this.init(),this},toJSON:function(){var e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;for(var t=this.bones,n=this.boneInverses,r=0,i=t.length;r<i;r++){var a=t[r];e.bones.push(a.uuid);var o=n[r];e.boneInverses.push(o.toArray())}return e}});var Ll=new Or,Pl=new Or,Bl=[],Dl=new Ma;function kl(e,t,n){Ma.call(this,e,t),this.instanceMatrix=new Oi(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}function Rl(e){Bi.call(this),this.type="LineBasicMaterial",this.color=new Ei(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}kl.prototype=Object.assign(Object.create(Ma.prototype),{constructor:kl,isInstancedMesh:!0,copy:function(e){return Ma.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),this.count=e.count,this},getColorAt:function(e,t){t.fromArray(this.instanceColor.array,3*e)},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){if(this.visible){var n=!0;if(this.traverseAncestors((function(e){e.visible||(n=!1)})),n){var r=this.matrixWorld,i=this.count;if(Dl.geometry=this.geometry,Dl.material=this.material,void 0!==Dl.material)for(var a=0;a<i;a++){this.getMatrixAt(a,Ll),Pl.multiplyMatrices(r,Ll),Dl.matrixWorld=Pl,Dl.raycast(e,Bl);for(var o=0,s=Bl.length;o<s;o++){var l=Bl[o];l.instanceId=a,l.object=this,t.push(l)}Bl.length=0}}}},setColorAt:function(e,t){null===this.instanceColor&&(this.instanceColor=new Oi(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),Rl.prototype=Object.create(Bi.prototype),Rl.prototype.constructor=Rl,Rl.prototype.isLineBasicMaterial=!0,Rl.prototype.copy=function(e){return Bi.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};var Ol=new sr,Il=new sr,Fl=new Or,Nl=new Rr,zl=new Tr;function Ul(e,t,n){oi.call(this),this.type="Line",this.geometry=void 0!==e?e:new ra,this.material=void 0!==t?t:new Rl,this.updateMorphTargets()}Ul.prototype=Object.assign(Object.create(oi.prototype),{constructor:Ul,isLine:!0,copy:function(e){return oi.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry){if(null===e.index){for(var t=e.attributes.position,n=[0],r=1,i=t.count;r<i;r++)Ol.fromBufferAttribute(t,r-1),Il.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=Ol.distanceTo(Il);e.setAttribute("lineDistance",new Vi(n,1))}}else if(e.isGeometry){var a=e.vertices,o=e.lineDistances;o[0]=0;for(var s=1,l=a.length;s<l;s++)o[s]=o[s-1],o[s]+=a[s-1].distanceTo(a[s])}return this},raycast:function(e,t){if(this.visible){var n=!0;if(this.traverseAncestors((function(e){e.visible||(n=!1)})),n){var r=this.geometry,i=this.matrixWorld,a=e.params.Line.threshold;if(null===r.boundingSphere&&r.computeBoundingSphere(),zl.copy(r.boundingSphere),zl.applyMatrix4(i),zl.radius+=a,!1!==e.ray.intersectsSphere(zl)){Fl.copy(i).invert(),Nl.copy(e.ray).applyMatrix4(Fl);var o=a/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=new sr,u=new sr,c=new sr,h=new sr,d=this.isLineSegments?2:1;if(r.isBufferGeometry){var p=r.index,f=r.attributes.position;if(null!==p)for(var m=p.array,v=0,g=m.length-1;v<g;v+=d){var y=m[v],x=m[v+1];if(l.fromBufferAttribute(f,y),u.fromBufferAttribute(f,x),!(Nl.distanceSqToSegment(l,u,h,c)>s)){h.applyMatrix4(this.matrixWorld);var b=e.ray.origin.distanceTo(h);b<e.near||b>e.far||t.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(var M=0,w=f.count-1;M<w;M+=d)if(l.fromBufferAttribute(f,M),u.fromBufferAttribute(f,M+1),!(Nl.distanceSqToSegment(l,u,h,c)>s)){h.applyMatrix4(this.matrixWorld);var _=e.ray.origin.distanceTo(h);_<e.near||_>e.far||t.push({distance:_,point:c.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this})}}else if(r.isGeometry)for(var A=r.vertices,C=A.length,T=0;T<C-1;T+=d)if(!(Nl.distanceSqToSegment(A[T],A[T+1],h,c)>s)){h.applyMatrix4(this.matrixWorld);var S=e.ray.origin.distanceTo(h);S<e.near||S>e.far||t.push({distance:S,point:c.clone().applyMatrix4(this.matrixWorld),index:T,face:null,faceIndex:null,object:this})}}}}},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,a=r.length;i<a;i++){var o=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;void 0!==s&&s.length}}});var Hl=new sr,jl=new sr;function Gl(e,t){Ul.call(this,e,t),this.type="LineSegments"}function Vl(e,t){Ul.call(this,e,t),this.type="LineLoop"}function Wl(e){Bi.call(this),this.type="PointsMaterial",this.color=new Ei(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}Gl.prototype=Object.assign(Object.create(Ul.prototype),{constructor:Gl,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry){if(null===e.index){for(var t=e.attributes.position,n=[],r=0,i=t.count;r<i;r+=2)Hl.fromBufferAttribute(t,r),jl.fromBufferAttribute(t,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+Hl.distanceTo(jl);e.setAttribute("lineDistance",new Vi(n,1))}}else if(e.isGeometry)for(var a=e.vertices,o=e.lineDistances,s=0,l=a.length;s<l;s+=2)Hl.copy(a[s]),jl.copy(a[s+1]),o[s]=0===s?0:o[s-1],o[s+1]=o[s]+Hl.distanceTo(jl);return this}}),Vl.prototype=Object.assign(Object.create(Ul.prototype),{constructor:Vl,isLineLoop:!0}),Wl.prototype=Object.create(Bi.prototype),Wl.prototype.constructor=Wl,Wl.prototype.isPointsMaterial=!0,Wl.prototype.copy=function(e){return Bi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var Xl=new Or,Yl=new Rr,Jl=new Tr,Ql=new sr;function ql(e,t){oi.call(this),this.type="Points",this.geometry=void 0!==e?e:new ra,this.material=void 0!==t?t:new Wl,this.updateMorphTargets()}function Kl(e,t,n,r,i,a,o){var s=Yl.distanceSqToPoint(e);if(s<n){var l=new sr;Yl.closestPointToPoint(e,l),l.applyMatrix4(r);var u=i.ray.origin.distanceTo(l);if(u<i.near||u>i.far)return;a.push({distance:u,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:o})}}function Zl(e,t,n,r,i,a,o,s,l){tr.call(this,e,t,n,r,i,a,o,s,l),this.format=void 0!==o?o:Xe,this.minFilter=void 0!==a?a:Ee,this.magFilter=void 0!==i?i:Ee,this.generateMipmaps=!1;var u=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){u.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}function $l(e,t,n,r,i,a,o,s,l,u,c,h){tr.call(this,null,a,o,s,l,u,r,i,c,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function eu(e,t,n,r,i,a,o,s,l){tr.call(this,e,t,n,r,i,a,o,s,l),this.needsUpdate=!0}function tu(e,t,n,r,i,a,o,s,l,u){if((u=void 0!==u?u:Ke)!==Ke&&u!==Ze)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===Ke&&(n=Ie),void 0===n&&u===Ze&&(n=Ve),tr.call(this,null,r,i,a,o,s,u,n,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:_e,this.minFilter=void 0!==s?s:_e,this.flipY=!1,this.generateMipmaps=!1}ql.prototype=Object.assign(Object.create(oi.prototype),{constructor:ql,isPoints:!0,copy:function(e){return oi.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){if(this.visible){var n=!0;if(this.traverseAncestors((function(e){e.visible||(n=!1)})),n){var r=this.geometry,i=this.matrixWorld,a=e.params.Points.threshold;if(null===r.boundingSphere&&r.computeBoundingSphere(),Jl.copy(r.boundingSphere),Jl.applyMatrix4(i),Jl.radius+=a,!1!==e.ray.intersectsSphere(Jl)){Xl.copy(i).invert(),Yl.copy(e.ray).applyMatrix4(Xl);var o=a/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(r.isBufferGeometry){var l=r.index,u=r.attributes.position;if(null!==l)for(var c=l.array,h=0,d=c.length;h<d;h++){var p=c[h];Ql.fromBufferAttribute(u,p),Kl(Ql,p,s,i,e,t,this)}else for(var f=0,m=u.count;f<m;f++)Ql.fromBufferAttribute(u,f),Kl(Ql,f,s,i,e,t,this)}else for(var v=r.vertices,g=0,y=v.length;g<y;g++)Kl(v[g],g,s,i,e,t,this)}}}},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,a=r.length;i<a;i++){var o=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;void 0!==s&&s.length}}}),Zl.prototype=Object.assign(Object.create(tr.prototype),{constructor:Zl,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){var e=this.image;0=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),$l.prototype=Object.create(tr.prototype),$l.prototype.constructor=$l,$l.prototype.isCompressedTexture=!0,eu.prototype=Object.create(tr.prototype),eu.prototype.constructor=eu,eu.prototype.isCanvasTexture=!0,tu.prototype=Object.create(tr.prototype),tu.prototype.constructor=tu,tu.prototype.isDepthTexture=!0;var nu=0,ru=new Or,iu=new oi,au=new sr;function ou(){Object.defineProperty(this,"id",{value:nu+=2}),this.uuid=qn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}ou.prototype=Object.assign(Object.create(Wn.prototype),{constructor:ou,isGeometry:!0,applyMatrix4:function(e){for(var t=(new Zn).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++)this.vertices[n].applyMatrix4(e);for(var i=0,a=this.faces.length;i<a;i++){var o=this.faces[i];o.normal.applyMatrix3(t).normalize();for(var s=0,l=o.vertexNormals.length;s<l;s++)o.vertexNormals[s].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return ru.makeRotationX(e),this.applyMatrix4(ru),this},rotateY:function(e){return ru.makeRotationY(e),this.applyMatrix4(ru),this},rotateZ:function(e){return ru.makeRotationZ(e),this.applyMatrix4(ru),this},translate:function(e,t,n){return ru.makeTranslation(e,t,n),this.applyMatrix4(ru),this},scale:function(e,t,n){return ru.makeScale(e,t,n),this.applyMatrix4(ru),this},lookAt:function(e){return iu.lookAt(e),iu.updateMatrix(),this.applyMatrix4(iu.matrix),this},fromBufferGeometry:function(e){var t=this,n=null!==e.index?e.index:void 0,r=e.attributes;if(void 0===r.position)return this;var i=r.position,a=r.normal,o=r.color,s=r.uv,l=r.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var u=0;u<i.count;u++)t.vertices.push((new sr).fromBufferAttribute(i,u)),void 0!==o&&t.colors.push((new Ei).fromBufferAttribute(o,u));function c(e,n,r,i){var u=void 0===o?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()],c=void 0===a?[]:[(new sr).fromBufferAttribute(a,e),(new sr).fromBufferAttribute(a,n),(new sr).fromBufferAttribute(a,r)],h=new Li(e,n,r,c,u,i);t.faces.push(h),void 0!==s&&t.faceVertexUvs[0].push([(new Kn).fromBufferAttribute(s,e),(new Kn).fromBufferAttribute(s,n),(new Kn).fromBufferAttribute(s,r)]),void 0!==l&&t.faceVertexUvs[1].push([(new Kn).fromBufferAttribute(l,e),(new Kn).fromBufferAttribute(l,n),(new Kn).fromBufferAttribute(l,r)])}var h=e.groups;if(h.length>0)for(var d=0;d<h.length;d++)for(var p=h[d],f=p.start,m=f,v=f+p.count;m<v;m+=3)void 0!==n?c(n.getX(m),n.getX(m+1),n.getX(m+2),p.materialIndex):c(m,m+1,m+2,p.materialIndex);else if(void 0!==n)for(var g=0;g<n.count;g+=3)c(n.getX(g),n.getX(g+1),n.getX(g+2));else for(var y=0;y<i.count;y+=3)c(y,y+1,y+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(au).negate(),this.translate(au.x,au.y,au.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,r=new Or;return r.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){for(var e=new sr,t=new sr,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=new Array(this.vertices.length),n=0,r=this.vertices.length;n<r;n++)t[n]=new sr;if(e)for(var i=new sr,a=new sr,o=0,s=this.faces.length;o<s;o++){var l=this.faces[o],u=this.vertices[l.a],c=this.vertices[l.b],h=this.vertices[l.c];i.subVectors(h,c),a.subVectors(u,c),i.cross(a),t[l.a].add(i),t[l.b].add(i),t[l.c].add(i)}else{this.computeFaceNormals();for(var d=0,p=this.faces.length;d<p;d++){var f=this.faces[d];t[f.a].add(f.normal),t[f.b].add(f.normal),t[f.c].add(f.normal)}}for(var m=0,v=this.vertices.length;m<v;m++)t[m].normalize();for(var g=0,y=this.faces.length;g<y;g++){var x=this.faces[g],b=x.vertexNormals;3===b.length?(b[0].copy(t[x.a]),b[1].copy(t[x.b]),b[2].copy(t[x.c])):(b[0]=t[x.a].clone(),b[1]=t[x.b].clone(),b[2]=t[x.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(var e=0,t=this.faces.length;e<t;e++){var n=this.faces[e],r=n.vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(var e=0,t=this.faces.length;e<t;e++){var n=this.faces[e];n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]);for(var r=0,i=n.vertexNormals.length;r<i;r++)n.__originalVertexNormals[r]?n.__originalVertexNormals[r].copy(n.vertexNormals[r]):n.__originalVertexNormals[r]=n.vertexNormals[r].clone()}var a=new ou;a.faces=this.faces;for(var o=0,s=this.morphTargets.length;o<s;o++){if(!this.morphNormals[o]){this.morphNormals[o]={},this.morphNormals[o].faceNormals=[],this.morphNormals[o].vertexNormals=[];for(var l=this.morphNormals[o].faceNormals,u=this.morphNormals[o].vertexNormals,c=0,h=this.faces.length;c<h;c++){var d=new sr,p={a:new sr,b:new sr,c:new sr};l.push(d),u.push(p)}}var f=this.morphNormals[o];a.vertices=this.morphTargets[o].vertices,a.computeFaceNormals(),a.computeVertexNormals();for(var m=0,v=this.faces.length;m<v;m++){var g=this.faces[m],y=f.faceNormals[m],x=f.vertexNormals[m];y.copy(g.normal),x.a.copy(g.vertexNormals[0]),x.b.copy(g.vertexNormals[1]),x.c.copy(g.vertexNormals[2])}}for(var b=0,M=this.faces.length;b<M;b++){var w=this.faces[b];w.normal=w.__originalFaceNormal,w.vertexNormals=w.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new cr),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Tr),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e&&e.isGeometry){var r,i=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,l=e.faces,u=this.colors,c=e.colors;void 0!==t&&(r=(new Zn).getNormalMatrix(t));for(var h=0,d=o.length;h<d;h++){var p=o[h].clone();void 0!==t&&p.applyMatrix4(t),a.push(p)}for(var f=0,m=c.length;f<m;f++)u.push(c[f].clone());for(var v=0,g=l.length;v<g;v++){var y=l[v],x=void 0,b=void 0,M=y.vertexNormals,w=y.vertexColors,_=new Li(y.a+i,y.b+i,y.c+i);_.normal.copy(y.normal),void 0!==r&&_.normal.applyMatrix3(r).normalize();for(var A=0,C=M.length;A<C;A++)x=M[A].clone(),void 0!==r&&x.applyMatrix3(r).normalize(),_.vertexNormals.push(x);_.color.copy(y.color);for(var T=0,S=w.length;T<S;T++)b=w[T],_.vertexColors.push(b.clone());_.materialIndex=y.materialIndex+n,s.push(_)}for(var E=0,L=e.faceVertexUvs.length;E<L;E++){var P=e.faceVertexUvs[E];void 0===this.faceVertexUvs[E]&&(this.faceVertexUvs[E]=[]);for(var B=0,D=P.length;B<D;B++){for(var k=P[B],R=[],O=0,I=k.length;O<I;O++)R.push(k[O].clone());this.faceVertexUvs[E].push(R)}}}},mergeMesh:function(e){e&&e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix))},mergeVertices:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t={},n=[],r=[],i=Math.pow(10,e),a=0,o=this.vertices.length;a<o;a++){var s=this.vertices[a],l=Math.round(s.x*i)+"_"+Math.round(s.y*i)+"_"+Math.round(s.z*i);void 0===t[l]?(t[l]=a,n.push(this.vertices[a]),r[a]=n.length-1):r[a]=r[t[l]]}for(var u=[],c=0,h=this.faces.length;c<h;c++){var d=this.faces[c];d.a=r[d.a],d.b=r[d.b],d.c=r[d.c];for(var p=[d.a,d.b,d.c],f=0;f<3;f++)if(p[f]===p[(f+1)%3]){u.push(c);break}}for(var m=u.length-1;m>=0;m--){var v=u[m];this.faces.splice(v,1);for(var g=0,y=this.faceVertexUvs.length;g<y;g++)this.faceVertexUvs[g].splice(v,1)}var x=this.vertices.length-n.length;return this.vertices=n,x},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];this.vertices.push(new sr(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var r,i,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===t&&(r=[]),o&&o.length===t&&(i=[]);for(var s=0;s<t;s++){var l=e[s]._id;r&&r.push(a[l]),i&&i.push(o[l])}r&&(this.faceVertexUvs[0]=r),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var r=[],i=0;i<this.vertices.length;i++){var a=this.vertices[i];r.push(a.x,a.y,a.z)}for(var o=[],s=[],l={},u=[],c={},h=[],d={},p=0;p<this.faces.length;p++){var f=this.faces[p],m=!0,v=!1,g=void 0!==this.faceVertexUvs[0][p],y=f.normal.length()>0,x=f.vertexNormals.length>0,b=1!==f.color.r||1!==f.color.g||1!==f.color.b,M=f.vertexColors.length>0,w=0;if(w=T(w,0,0),w=T(w,1,m),w=T(w,2,v),w=T(w,3,g),w=T(w,4,y),w=T(w,5,x),w=T(w,6,b),w=T(w,7,M),o.push(w),o.push(f.a,f.b,f.c),o.push(f.materialIndex),g){var _=this.faceVertexUvs[0][p];o.push(L(_[0]),L(_[1]),L(_[2]))}if(y&&o.push(S(f.normal)),x){var A=f.vertexNormals;o.push(S(A[0]),S(A[1]),S(A[2]))}if(b&&o.push(E(f.color)),M){var C=f.vertexColors;o.push(E(C[0]),E(C[1]),E(C[2]))}}function T(e,t,n){return n?e|1<<t:e&~(1<<t)}function S(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=s.length/3,s.push(e.x,e.y,e.z)),l[t]}function E(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]||(c[t]=u.length,u.push(e.getHex())),c[t]}function L(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]||(d[t]=h.length/2,h.push(e.x,e.y)),d[t]}return e.data={},e.data.vertices=r,e.data.normals=s,u.length>0&&(e.data.colors=u),h.length>0&&(e.data.uvs=[h]),e.data.faces=o,e},clone:function(){return(new ou).copy(this)},copy:function(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;for(var t=e.vertices,n=0,r=t.length;n<r;n++)this.vertices.push(t[n].clone());for(var i=e.colors,a=0,o=i.length;a<o;a++)this.colors.push(i[a].clone());for(var s=e.faces,l=0,u=s.length;l<u;l++)this.faces.push(s[l].clone());for(var c=0,h=e.faceVertexUvs.length;c<h;c++){var d=e.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var p=0,f=d.length;p<f;p++){for(var m=d[p],v=[],g=0,y=m.length;g<y;g++){var x=m[g];v.push(x.clone())}this.faceVertexUvs[c].push(v)}}for(var b=e.morphTargets,M=0,w=b.length;M<w;M++){var _={};if(_.name=b[M].name,void 0!==b[M].vertices){_.vertices=[];for(var A=0,C=b[M].vertices.length;A<C;A++)_.vertices.push(b[M].vertices[A].clone())}if(void 0!==b[M].normals){_.normals=[];for(var T=0,S=b[M].normals.length;T<S;T++)_.normals.push(b[M].normals[T].clone())}this.morphTargets.push(_)}for(var E=e.morphNormals,L=0,P=E.length;L<P;L++){var B={};if(void 0!==E[L].vertexNormals){B.vertexNormals=[];for(var D=0,k=E[L].vertexNormals.length;D<k;D++){var R=E[L].vertexNormals[D],O={};O.a=R.a.clone(),O.b=R.b.clone(),O.c=R.c.clone(),B.vertexNormals.push(O)}}if(void 0!==E[L].faceNormals){B.faceNormals=[];for(var I=0,F=E[L].faceNormals.length;I<F;I++)B.faceNormals.push(E[L].faceNormals[I].clone())}this.morphNormals.push(B)}for(var N=e.skinWeights,z=0,U=N.length;z<U;z++)this.skinWeights.push(N[z].clone());for(var H=e.skinIndices,j=0,G=H.length;j<G;j++)this.skinIndices.push(H[j].clone());for(var V=e.lineDistances,W=0,X=V.length;W<X;W++)this.lineDistances.push(V[W]);var Y=e.boundingBox;null!==Y&&(this.boundingBox=Y.clone());var J=e.boundingSphere;return null!==J&&(this.boundingSphere=J.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var su=function(e){function t(e,n,r,i,a,o){var s;return(0,v.default)(this,t),(s=T(this,t)).type="BoxGeometry",s.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:a,depthSegments:o},s.fromBufferGeometry(new Aa(e,n,r,i,a,o)),s.mergeVertices(),s}return(0,m.default)(t,e),(0,g.default)(t)}(ou),lu=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;(0,v.default)(this,t),(e=T(this,t)).type="CircleBufferGeometry",e.parameters={radius:n,segments:r,thetaStart:i,thetaLength:a},r=Math.max(3,r);var o=[],s=[],l=[],u=[],c=new sr,h=new Kn;s.push(0,0,0),l.push(0,0,1),u.push(.5,.5);for(var d=0,p=3;d<=r;d++,p+=3){var f=i+d/r*a;c.x=n*Math.cos(f),c.y=n*Math.sin(f),s.push(c.x,c.y,c.z),l.push(0,0,1),h.x=(s[p]/n+1)/2,h.y=(s[p+1]/n+1)/2,u.push(h.x,h.y)}for(var m=1;m<=r;m++)o.push(m,m+1,0);return e.setIndex(o),e.setAttribute("position",new Vi(s,3)),e.setAttribute("normal",new Vi(l,3)),e.setAttribute("uv",new Vi(u,2)),e}return(0,m.default)(t,e),(0,g.default)(t)}(ra),uu=function(e){function t(e,n,r,i){var a;return(0,v.default)(this,t),(a=T(this,t)).type="CircleGeometry",a.parameters={radius:e,segments:n,thetaStart:r,thetaLength:i},a.fromBufferGeometry(new lu(e,n,r,i)),a.mergeVertices(),a}return(0,m.default)(t,e),(0,g.default)(t)}(ou),cu=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;(0,v.default)(this,t),(e=T(this,t)).type="CylinderBufferGeometry",e.parameters={radiusTop:n,radiusBottom:r,height:i,radialSegments:a,heightSegments:o,openEnded:s,thetaStart:l,thetaLength:u};var c=e;a=Math.floor(a),o=Math.floor(o);var h=[],d=[],p=[],f=[],m=0,g=[],y=i/2,x=0;function b(e){for(var t=m,i=new Kn,o=new sr,s=0,v=!0===e?n:r,g=!0===e?1:-1,b=1;b<=a;b++)d.push(0,y*g,0),p.push(0,g,0),f.push(.5,.5),m++;for(var M=m,w=0;w<=a;w++){var _=w/a*u+l,A=Math.cos(_),C=Math.sin(_);o.x=v*C,o.y=y*g,o.z=v*A,d.push(o.x,o.y,o.z),p.push(0,g,0),i.x=.5*A+.5,i.y=.5*C*g+.5,f.push(i.x,i.y),m++}for(var T=0;T<a;T++){var S=t+T,E=M+T;!0===e?h.push(E,E+1,S):h.push(E+1,E,S),s+=3}c.addGroup(x,s,!0===e?1:2),x+=s}return function(){for(var e=new sr,t=new sr,s=0,v=(r-n)/i,b=0;b<=o;b++){for(var M=[],w=b/o,_=w*(r-n)+n,A=0;A<=a;A++){var C=A/a,T=C*u+l,S=Math.sin(T),E=Math.cos(T);t.x=_*S,t.y=-w*i+y,t.z=_*E,d.push(t.x,t.y,t.z),e.set(S,v,E).normalize(),p.push(e.x,e.y,e.z),f.push(C,1-w),M.push(m++)}g.push(M)}for(var L=0;L<a;L++)for(var P=0;P<o;P++){var B=g[P][L],D=g[P+1][L],k=g[P+1][L+1],R=g[P][L+1];h.push(B,D,R),h.push(D,k,R),s+=6}c.addGroup(x,s,0),x+=s}(),!1===s&&(n>0&&b(!0),r>0&&b(!1)),e.setIndex(h),e.setAttribute("position",new Vi(d,3)),e.setAttribute("normal",new Vi(p,3)),e.setAttribute("uv",new Vi(f,2)),e}return(0,m.default)(t,e),(0,g.default)(t)}(ra),hu=function(e){function t(e,n,r,i,a,o,s,l){var u;return(0,v.default)(this,t),(u=T(this,t)).type="CylinderGeometry",u.parameters={radiusTop:e,radiusBottom:n,height:r,radialSegments:i,heightSegments:a,openEnded:o,thetaStart:s,thetaLength:l},u.fromBufferGeometry(new cu(e,n,r,i,a,o,s,l)),u.mergeVertices(),u}return(0,m.default)(t,e),(0,g.default)(t)}(ou),du=function(e){function t(e,n,r,i,a,o,s){var l;return(0,v.default)(this,t),(l=T(this,t,[0,e,n,r,i,a,o,s])).type="ConeGeometry",l.parameters={radius:e,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s},l}return(0,m.default)(t,e),(0,g.default)(t)}(hu),pu=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;return(0,v.default)(this,t),(e=T(this,t,[0,n,r,i,a,o,s,l])).type="ConeBufferGeometry",e.parameters={radius:n,height:r,radialSegments:i,heightSegments:a,openEnded:o,thetaStart:s,thetaLength:l},e}return(0,m.default)(t,e),(0,g.default)(t)}(cu),fu=function(e){function t(e,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(0,v.default)(this,t),(r=T(this,t)).type="PolyhedronBufferGeometry",r.parameters={vertices:e,indices:n,radius:i,detail:a};var o=[],s=[];function l(e,t,n,r){for(var i=r+1,a=[],o=0;o<=i;o++){a[o]=[];for(var s=e.clone().lerp(n,o/i),l=t.clone().lerp(n,o/i),c=i-o,h=0;h<=c;h++)a[o][h]=0===h&&o===i?s:s.clone().lerp(l,h/c)}for(var d=0;d<i;d++)for(var p=0;p<2*(i-d)-1;p++){var f=Math.floor(p/2);p%2==0?(u(a[d][f+1]),u(a[d+1][f]),u(a[d][f])):(u(a[d][f+1]),u(a[d+1][f+1]),u(a[d+1][f]))}}function u(e){o.push(e.x,e.y,e.z)}function c(t,n){var r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function h(e,t,n,r){r<0&&1===e.x&&(s[t]=e.x-1),0===n.x&&0===n.z&&(s[t]=r/2/Math.PI+.5)}function d(e){return Math.atan2(e.z,-e.x)}return function(e){for(var t=new sr,r=new sr,i=new sr,a=0;a<n.length;a+=3)c(n[a+0],t),c(n[a+1],r),c(n[a+2],i),l(t,r,i,e)}(a),function(e){for(var t=new sr,n=0;n<o.length;n+=3)t.x=o[n+0],t.y=o[n+1],t.z=o[n+2],t.normalize().multiplyScalar(e),o[n+0]=t.x,o[n+1]=t.y,o[n+2]=t.z}(i),function(){for(var e,t=new sr,n=0;n<o.length;n+=3){t.x=o[n+0],t.y=o[n+1],t.z=o[n+2];var r=d(t)/2/Math.PI+.5,i=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(r,1-i)}(function(){for(var e=new sr,t=new sr,n=new sr,r=new sr,i=new Kn,a=new Kn,l=new Kn,u=0,c=0;u<o.length;u+=9,c+=6){e.set(o[u+0],o[u+1],o[u+2]),t.set(o[u+3],o[u+4],o[u+5]),n.set(o[u+6],o[u+7],o[u+8]),i.set(s[c+0],s[c+1]),a.set(s[c+2],s[c+3]),l.set(s[c+4],s[c+5]),r.copy(e).add(t).add(n).divideScalar(3);var p=d(r);h(i,c+0,e,p),h(a,c+2,t,p),h(l,c+4,n,p)}})(),function(){for(var e=0;e<s.length;e+=6){var t=s[e+0],n=s[e+2],r=s[e+4],i=Math.max(t,n,r),a=Math.min(t,n,r);i>.9&&a<.1&&(t<.2&&(s[e+0]+=1),n<.2&&(s[e+2]+=1),r<.2&&(s[e+4]+=1))}}()}(),r.setAttribute("position",new Vi(o,3)),r.setAttribute("normal",new Vi(o.slice(),3)),r.setAttribute("uv",new Vi(s,2)),0===a?r.computeVertexNormals():r.normalizeNormals(),r}return(0,m.default)(t,e),(0,g.default)(t)}(ra),mu=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,v.default)(this,t);var i=(1+Math.sqrt(5))/2,a=1/i;return(e=T(this,t,[[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-a,-i,0,-a,i,0,a,-i,0,a,i,-a,-i,0,-a,i,0,a,-i,0,a,i,0,-i,0,-a,i,0,-a,-i,0,a,i,0,a],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],n,r])).type="DodecahedronBufferGeometry",e.parameters={radius:n,detail:r},e}return(0,m.default)(t,e),(0,g.default)(t)}(fu),vu=function(e){function t(e,n){var r;return(0,v.default)(this,t),(r=T(this,t)).type="DodecahedronGeometry",r.parameters={radius:e,detail:n},r.fromBufferGeometry(new mu(e,n)),r.mergeVertices(),r}return(0,m.default)(t,e),(0,g.default)(t)}(ou),gu=new sr,yu=new sr,xu=new sr,bu=new Mi,Mu=function(e){function t(e,n){var r;(0,v.default)(this,t),(r=T(this,t)).type="EdgesGeometry",r.parameters={thresholdAngle:n},n=void 0!==n?n:1,e.isGeometry&&(e=(new ra).fromGeometry(e));for(var i=Math.pow(10,4),a=Math.cos(qn.DEG2RAD*n),o=e.getIndex(),s=e.getAttribute("position"),l=o?o.count:s.count,u=[0,0,0],c=["a","b","c"],h=new Array(3),d={},p=[],f=0;f<l;f+=3){o?(u[0]=o.getX(f),u[1]=o.getX(f+1),u[2]=o.getX(f+2)):(u[0]=f,u[1]=f+1,u[2]=f+2);var m=bu.a,g=bu.b,y=bu.c;if(m.fromBufferAttribute(s,u[0]),g.fromBufferAttribute(s,u[1]),y.fromBufferAttribute(s,u[2]),bu.getNormal(xu),h[0]="".concat(Math.round(m.x*i),",").concat(Math.round(m.y*i),",").concat(Math.round(m.z*i)),h[1]="".concat(Math.round(g.x*i),",").concat(Math.round(g.y*i),",").concat(Math.round(g.z*i)),h[2]="".concat(Math.round(y.x*i),",").concat(Math.round(y.y*i),",").concat(Math.round(y.z*i)),h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(var x=0;x<3;x++){var b=(x+1)%3,M=h[x],w=h[b],_=bu[c[x]],A=bu[c[b]],C="".concat(M,"_").concat(w),S="".concat(w,"_").concat(M);S in d&&d[S]?(xu.dot(d[S].normal)<=a&&(p.push(_.x,_.y,_.z),p.push(A.x,A.y,A.z)),d[S]=null):C in d||(d[C]={index0:u[x],index1:u[b],normal:xu.clone()})}}for(var E in d)if(d[E]){var L=d[E],P=L.index0,B=L.index1;gu.fromBufferAttribute(s,P),yu.fromBufferAttribute(s,B),p.push(gu.x,gu.y,gu.z),p.push(yu.x,yu.y,yu.z)}return r.setAttribute("position",new Vi(p,3)),r}return(0,m.default)(t,e),(0,g.default)(t)}(ra),wu=function(e,t,n){n=n||2;var r,i,a,o,s,l,u,c=t&&t.length,h=c?t[0]*n:e.length,d=_u(e,0,h,n,!0),p=[];if(!d||d.next===d.prev)return p;if(c&&(d=function(e,t,n,r){var i,a,o,s=[];for(i=0,a=t.length;i<a;i++)(o=_u(e,t[i]*r,i<a-1?t[i+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(Ru(o));for(s.sort(Pu),i=0;i<s.length;i++)Bu(s[i],n),n=Au(n,n.next);return n}(e,t,d,n)),e.length>80*n){r=a=e[0],i=o=e[1];for(var f=n;f<h;f+=n)(s=e[f])<r&&(r=s),(l=e[f+1])<i&&(i=l),s>a&&(a=s),l>o&&(o=l);u=0!==(u=Math.max(a-r,o-i))?1/u:0}return Cu(d,p,n,r,i,u),p};function _u(e,t,n,r,i){var a,o;if(i===function(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}(e,t,n,r)>0)for(a=t;a<n;a+=r)o=Vu(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=Vu(a,e[a],e[a+1],o);return o&&Nu(o,o.next)&&(Wu(o),o=o.next),o}function Au(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!Nu(r,r.next)&&0!==Fu(r.prev,r,r.next))r=r.next;else{if(Wu(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function Cu(e,t,n,r,i,a,o){if(e){!o&&a&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=ku(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,l,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<u&&(s++,r=r.nextZ);t++);for(l=u;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,u*=2}while(o>1)}(i)}(e,r,i,a);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?Su(e,r,i,a):Tu(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),Wu(e),e=l.next,u=l.next;else if((e=l)===u){o?1===o?Cu(e=Eu(Au(e),t,n),t,n,r,i,a,2):2===o&&Lu(e,t,n,r,i,a):Cu(Au(e),t,n,r,i,a,1);break}}}function Tu(e){var t=e.prev,n=e,r=e.next;if(Fu(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(Ou(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Fu(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Su(e,t,n,r){var i=e.prev,a=e,o=e.next;if(Fu(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,u=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,c=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=ku(s,l,t,n,r),d=ku(u,c,t,n,r),p=e.prevZ,f=e.nextZ;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&Ou(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Fu(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&Ou(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Fu(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&Ou(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Fu(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&Ou(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Fu(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Eu(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!Nu(i,a)&&zu(i,r,r.next,a)&&ju(i,a)&&ju(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),Wu(r),Wu(r.next),r=e=a),r=r.next}while(r!==e);return Au(r)}function Lu(e,t,n,r,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Iu(o,s)){var l=Gu(o,s);return o=Au(o,o.next),l=Au(l,l.next),Cu(o,t,n,r,i,a),void Cu(l,t,n,r,i,a)}s=s.next}o=o.next}while(o!==e)}function Pu(e,t){return e.x-t.x}function Bu(e,t){if(t=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n;var l,u=n,c=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&Ou(a<h?i:o,a,c,h,a<h?o:i,a,r.x,r.y)&&(l=Math.abs(a-r.y)/(i-r.x),ju(r,e)&&(l<d||l===d&&(r.x>n.x||r.x===n.x&&Du(n,r)))&&(n=r,d=l)),r=r.next}while(r!==u);return n}(e,t),t){var n=Gu(t,e);Au(t,t.next),Au(n,n.next)}}function Du(e,t){return Fu(e.prev,e,t.prev)<0&&Fu(t.next,e,e.next)<0}function ku(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ru(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Ou(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function Iu(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&zu(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(ju(e,t)&&ju(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Fu(e.prev,e,t.prev)||Fu(e,t.prev,t))||Nu(e,t)&&Fu(e.prev,e,e.next)>0&&Fu(t.prev,t,t.next)>0)}function Fu(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Nu(e,t){return e.x===t.x&&e.y===t.y}function zu(e,t,n,r){var i=Hu(Fu(e,t,n)),a=Hu(Fu(e,t,r)),o=Hu(Fu(n,r,e)),s=Hu(Fu(n,r,t));return i!==a&&o!==s||!(0!==i||!Uu(e,n,t))||!(0!==a||!Uu(e,r,t))||!(0!==o||!Uu(n,e,r))||!(0!==s||!Uu(n,t,r))}function Uu(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Hu(e){return e>0?1:e<0?-1:0}function ju(e,t){return Fu(e.prev,e,e.next)<0?Fu(e,t,e.next)>=0&&Fu(e,e.prev,t)>=0:Fu(e,t,e.prev)<0||Fu(e,e.next,t)<0}function Gu(e,t){var n=new Xu(e.i,e.x,e.y),r=new Xu(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function Vu(e,t,n,r){var i=new Xu(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Wu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Xu(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Yu={area:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n},isClockWise:function(e){return Yu.area(e)<0},triangulateShape:function(e,t){var n=[],r=[],i=[];Ju(e),Qu(n,e);var a=e.length;t.forEach(Ju);for(var o=0;o<t.length;o++)r.push(a),a+=t[o].length,Qu(n,t[o]);for(var s=wu(n,r),l=0;l<s.length;l+=3)i.push(s.slice(l,l+3));return i}};function Ju(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Qu(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var qu=function(e){function t(e,n){var r;(0,v.default)(this,t),(r=T(this,t)).type="ExtrudeBufferGeometry",r.parameters={shapes:e,options:n},e=Array.isArray(e)?e:[e];for(var i=r,a=[],o=[],s=0,l=e.length;s<l;s++)u(e[s]);function u(e){var t=[],r=void 0!==n.curveSegments?n.curveSegments:12,s=void 0!==n.steps?n.steps:1,l=void 0!==n.depth?n.depth:100,u=void 0===n.bevelEnabled||n.bevelEnabled,c=void 0!==n.bevelThickness?n.bevelThickness:6,h=void 0!==n.bevelSize?n.bevelSize:c-2,d=void 0!==n.bevelOffset?n.bevelOffset:0,p=void 0!==n.bevelSegments?n.bevelSegments:3,f=n.extrudePath,m=void 0!==n.UVGenerator?n.UVGenerator:Ku;void 0!==n.amount&&(l=n.amount);var v,g,y,x,b,M=!1;f&&(v=f.getSpacedPoints(s),M=!0,u=!1,g=f.computeFrenetFrames(s,!1),y=new sr,x=new sr,b=new sr),u||(p=0,c=0,h=0,d=0);var w=e.extractPoints(r),_=w.shape,A=w.holes;if(!Yu.isClockWise(_)){_=_.reverse();for(var C=0,T=A.length;C<T;C++){var S=A[C];Yu.isClockWise(S)&&(A[C]=S.reverse())}}for(var E=Yu.triangulateShape(_,A),L=_,P=0,B=A.length;P<B;P++){var D=A[P];_=_.concat(D)}function k(e,t,n){return t.clone().multiplyScalar(n).add(e)}var R=_.length,O=E.length;function I(e,t,n){var r,i,a,o=e.x-t.x,s=e.y-t.y,l=n.x-e.x,u=n.y-e.y,c=o*o+s*s,h=o*u-s*l;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(c),p=Math.sqrt(l*l+u*u),f=t.x-s/d,m=t.y+o/d,v=((n.x-u/p-f)*u-(n.y+l/p-m)*l)/(o*u-s*l),g=(r=f+o*v-e.x)*r+(i=m+s*v-e.y)*i;if(g<=2)return new Kn(r,i);a=Math.sqrt(g/2)}else{var y=!1;o>Number.EPSILON?l>Number.EPSILON&&(y=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(u)&&(y=!0),y?(r=-s,i=o,a=Math.sqrt(c)):(r=o,i=s,a=Math.sqrt(c/2))}return new Kn(r/a,i/a)}for(var F=[],N=0,z=L.length,U=z-1,H=N+1;N<z;N++,U++,H++)U===z&&(U=0),H===z&&(H=0),F[N]=I(L[N],L[U],L[H]);for(var j,G=[],V=F.concat(),W=0,X=A.length;W<X;W++){var Y=A[W];j=[];for(var J=0,Q=Y.length,q=Q-1,K=J+1;J<Q;J++,q++,K++)q===Q&&(q=0),K===Q&&(K=0),j[J]=I(Y[J],Y[q],Y[K]);G.push(j),V=V.concat(j)}for(var Z=0;Z<p;Z++){for(var $=Z/p,ee=c*Math.cos($*Math.PI/2),te=h*Math.sin($*Math.PI/2)+d,ne=0,re=L.length;ne<re;ne++){var ie=k(L[ne],F[ne],te);Be(ie.x,ie.y,-ee)}for(var ae=0,oe=A.length;ae<oe;ae++){var se=A[ae];j=G[ae];for(var le=0,ue=se.length;le<ue;le++){var ce=k(se[le],j[le],te);Be(ce.x,ce.y,-ee)}}}for(var he=h+d,de=0;de<R;de++){var pe=u?k(_[de],V[de],he):_[de];M?(x.copy(g.normals[0]).multiplyScalar(pe.x),y.copy(g.binormals[0]).multiplyScalar(pe.y),b.copy(v[0]).add(x).add(y),Be(b.x,b.y,b.z)):Be(pe.x,pe.y,0)}for(var fe=1;fe<=s;fe++)for(var me=0;me<R;me++){var ve=u?k(_[me],V[me],he):_[me];M?(x.copy(g.normals[fe]).multiplyScalar(ve.x),y.copy(g.binormals[fe]).multiplyScalar(ve.y),b.copy(v[fe]).add(x).add(y),Be(b.x,b.y,b.z)):Be(ve.x,ve.y,l/s*fe)}for(var ge=p-1;ge>=0;ge--){for(var ye=ge/p,xe=c*Math.cos(ye*Math.PI/2),be=h*Math.sin(ye*Math.PI/2)+d,Me=0,we=L.length;Me<we;Me++){var _e=k(L[Me],F[Me],be);Be(_e.x,_e.y,l+xe)}for(var Ae=0,Ce=A.length;Ae<Ce;Ae++){var Te=A[Ae];j=G[Ae];for(var Se=0,Ee=Te.length;Se<Ee;Se++){var Le=k(Te[Se],j[Se],be);M?Be(Le.x,Le.y+v[s-1].y,v[s-1].x+xe):Be(Le.x,Le.y,l+xe)}}}function Pe(e,t){for(var n=e.length;--n>=0;){var r=n,i=n-1;i<0&&(i=e.length-1);for(var a=0,o=s+2*p;a<o;a++){var l=R*a,u=R*(a+1);ke(t+r+l,t+i+l,t+i+u,t+r+u)}}}function Be(e,n,r){t.push(e),t.push(n),t.push(r)}function De(e,t,n){Re(e),Re(t),Re(n);var r=a.length/3,o=m.generateTopUV(i,a,r-3,r-2,r-1);Oe(o[0]),Oe(o[1]),Oe(o[2])}function ke(e,t,n,r){Re(e),Re(t),Re(r),Re(t),Re(n),Re(r);var o=a.length/3,s=m.generateSideWallUV(i,a,o-6,o-3,o-2,o-1);Oe(s[0]),Oe(s[1]),Oe(s[3]),Oe(s[1]),Oe(s[2]),Oe(s[3])}function Re(e){a.push(t[3*e+0]),a.push(t[3*e+1]),a.push(t[3*e+2])}function Oe(e){o.push(e.x),o.push(e.y)}!function(){var e=a.length/3;if(u){for(var t=0,n=R*t,r=0;r<O;r++){var o=E[r];De(o[2]+n,o[1]+n,o[0]+n)}n=R*(t=s+2*p);for(var l=0;l<O;l++){var c=E[l];De(c[0]+n,c[1]+n,c[2]+n)}}else{for(var h=0;h<O;h++){var d=E[h];De(d[2],d[1],d[0])}for(var f=0;f<O;f++){var m=E[f];De(m[0]+R*s,m[1]+R*s,m[2]+R*s)}}i.addGroup(e,a.length/3-e,0)}(),function(){var e=a.length/3,t=0;Pe(L,t),t+=L.length;for(var n=0,r=A.length;n<r;n++){var o=A[n];Pe(o,t),t+=o.length}i.addGroup(e,a.length/3-e,1)}()}return r.setAttribute("position",new Vi(a,3)),r.setAttribute("uv",new Vi(o,2)),r.computeVertexNormals(),r}return(0,m.default)(t,e),(0,g.default)(t,[{key:"toJSON",value:function(){var e=ra.prototype.toJSON.call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var a=e[r];n.shapes.push(a.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}}])}(ra),Ku={generateTopUV:function(e,t,n,r,i){var a=t[3*n],o=t[3*n+1],s=t[3*r],l=t[3*r+1],u=t[3*i],c=t[3*i+1];return[new Kn(a,o),new Kn(s,l),new Kn(u,c)]},generateSideWallUV:function(e,t,n,r,i,a){var o=t[3*n],s=t[3*n+1],l=t[3*n+2],u=t[3*r],c=t[3*r+1],h=t[3*r+2],d=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*a],v=t[3*a+1],g=t[3*a+2];return Math.abs(s-c)<.01?[new Kn(o,1-l),new Kn(u,1-h),new Kn(d,1-f),new Kn(m,1-g)]:[new Kn(s,1-l),new Kn(c,1-h),new Kn(p,1-f),new Kn(v,1-g)]}},Zu=function(e){function t(e,n){var r;return(0,v.default)(this,t),(r=T(this,t)).type="ExtrudeGeometry",r.parameters={shapes:e,options:n},r.fromBufferGeometry(new qu(e,n)),r.mergeVertices(),r}return(0,m.default)(t,e),(0,g.default)(t,[{key:"toJSON",value:function(){var e=C(t,"toJSON",this,3)([]);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var a=e[r];n.shapes.push(a.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}}])}(ou),$u=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,v.default)(this,t);var i=(1+Math.sqrt(5))/2;return(e=T(this,t,[[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],n,r])).type="IcosahedronBufferGeometry",e.parameters={radius:n,detail:r},e}return(0,m.default)(t,e),(0,g.default)(t)}(fu),ec=function(e){function t(e,n){var r;return(0,v.default)(this,t),(r=T(this,t)).type="IcosahedronGeometry",r.parameters={radius:e,detail:n},r.fromBufferGeometry(new $u(e,n)),r.mergeVertices(),r}return(0,m.default)(t,e),(0,g.default)(t)}(ou),tc=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;(0,v.default)(this,t),(n=T(this,t)).type="LatheBufferGeometry",n.parameters={points:e,segments:r,phiStart:i,phiLength:a},r=Math.floor(r),a=qn.clamp(a,0,2*Math.PI);for(var o=[],s=[],l=[],u=1/r,c=new sr,h=new Kn,d=0;d<=r;d++)for(var p=i+d*u*a,f=Math.sin(p),m=Math.cos(p),g=0;g<=e.length-1;g++)c.x=e[g].x*f,c.y=e[g].y,c.z=e[g].x*m,s.push(c.x,c.y,c.z),h.x=d/r,h.y=g/(e.length-1),l.push(h.x,h.y);for(var y=0;y<r;y++)for(var x=0;x<e.length-1;x++){var b=x+y*e.length,M=b,w=b+e.length,_=b+e.length+1,A=b+1;o.push(M,w,A),o.push(w,_,A)}if(n.setIndex(o),n.setAttribute("position",new Vi(s,3)),n.setAttribute("uv",new Vi(l,2)),n.computeVertexNormals(),a===2*Math.PI)for(var C=n.attributes.normal.array,S=new sr,E=new sr,L=new sr,P=r*e.length*3,B=0,D=0;B<e.length;B++,D+=3)S.x=C[D+0],S.y=C[D+1],S.z=C[D+2],E.x=C[P+D+0],E.y=C[P+D+1],E.z=C[P+D+2],L.addVectors(S,E).normalize(),C[D+0]=C[P+D+0]=L.x,C[D+1]=C[P+D+1]=L.y,C[D+2]=C[P+D+2]=L.z;return n}return(0,m.default)(t,e),(0,g.default)(t)}(ra),nc=function(e){function t(e,n,r,i){var a;return(0,v.default)(this,t),(a=T(this,t)).type="LatheGeometry",a.parameters={points:e,segments:n,phiStart:r,phiLength:i},a.fromBufferGeometry(new tc(e,n,r,i)),a.mergeVertices(),a}return(0,m.default)(t,e),(0,g.default)(t)}(ou),rc=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,v.default)(this,t),(e=T(this,t,[[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],n,r])).type="OctahedronBufferGeometry",e.parameters={radius:n,detail:r},e}return(0,m.default)(t,e),(0,g.default)(t)}(fu),ic=function(e){function t(e,n){var r;return(0,v.default)(this,t),(r=T(this,t)).type="OctahedronGeometry",r.parameters={radius:e,detail:n},r.fromBufferGeometry(new rc(e,n)),r.mergeVertices(),r}return(0,m.default)(t,e),(0,g.default)(t)}(ou);function ac(e,t,n){ra.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};var r=[],i=[],a=[],o=[],s=1e-5,l=new sr,u=new sr,c=new sr,h=new sr,d=new sr;e.length;for(var p=t+1,f=0;f<=n;f++)for(var m=f/n,v=0;v<=t;v++){var g=v/t;e(g,m,u),i.push(u.x,u.y,u.z),g-s>=0?(e(g-s,m,c),h.subVectors(u,c)):(e(g+s,m,c),h.subVectors(c,u)),m-s>=0?(e(g,m-s,c),d.subVectors(u,c)):(e(g,m+s,c),d.subVectors(c,u)),l.crossVectors(h,d).normalize(),a.push(l.x,l.y,l.z),o.push(g,m)}for(var y=0;y<n;y++)for(var x=0;x<t;x++){var b=y*p+x,M=y*p+x+1,w=(y+1)*p+x+1,_=(y+1)*p+x;r.push(b,M,_),r.push(M,w,_)}this.setIndex(r),this.setAttribute("position",new Vi(i,3)),this.setAttribute("normal",new Vi(a,3)),this.setAttribute("uv",new Vi(o,2))}function oc(e,t,n){ou.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new ac(e,t,n)),this.mergeVertices()}ac.prototype=Object.create(ra.prototype),ac.prototype.constructor=ac,oc.prototype=Object.create(ou.prototype),oc.prototype.constructor=oc;var sc=function(e){function t(e,n,r,i){var a;return(0,v.default)(this,t),(a=T(this,t)).type="PlaneGeometry",a.parameters={width:e,height:n,widthSegments:r,heightSegments:i},a.fromBufferGeometry(new Va(e,n,r,i)),a.mergeVertices(),a}return(0,m.default)(t,e),(0,g.default)(t)}(ou),lc=function(e){function t(e,n,r,i){var a;return(0,v.default)(this,t),(a=T(this,t)).type="PolyhedronGeometry",a.parameters={vertices:e,indices:n,radius:r,detail:i},a.fromBufferGeometry(new fu(e,n,r,i)),a.mergeVertices(),a}return(0,m.default)(t,e),(0,g.default)(t)}(ou),uc=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;(0,v.default)(this,t),(e=T(this,t)).type="RingBufferGeometry",e.parameters={innerRadius:n,outerRadius:r,thetaSegments:i,phiSegments:a,thetaStart:o,thetaLength:s},i=Math.max(3,i);for(var l=[],u=[],c=[],h=[],d=n,p=(r-n)/(a=Math.max(1,a)),f=new sr,m=new Kn,g=0;g<=a;g++){for(var y=0;y<=i;y++){var x=o+y/i*s;f.x=d*Math.cos(x),f.y=d*Math.sin(x),u.push(f.x,f.y,f.z),c.push(0,0,1),m.x=(f.x/r+1)/2,m.y=(f.y/r+1)/2,h.push(m.x,m.y)}d+=p}for(var b=0;b<a;b++)for(var M=b*(i+1),w=0;w<i;w++){var _=w+M,A=_,C=_+i+1,S=_+i+2,E=_+1;l.push(A,C,E),l.push(C,S,E)}return e.setIndex(l),e.setAttribute("position",new Vi(u,3)),e.setAttribute("normal",new Vi(c,3)),e.setAttribute("uv",new Vi(h,2)),e}return(0,m.default)(t,e),(0,g.default)(t)}(ra),cc=function(e){function t(e,n,r,i,a,o){var s;return(0,v.default)(this,t),(s=T(this,t)).type="RingGeometry",s.parameters={innerRadius:e,outerRadius:n,thetaSegments:r,phiSegments:i,thetaStart:a,thetaLength:o},s.fromBufferGeometry(new uc(e,n,r,i,a,o)),s.mergeVertices(),s}return(0,m.default)(t,e),(0,g.default)(t)}(ou),hc=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;(0,v.default)(this,t),(n=T(this,t)).type="ShapeBufferGeometry",n.parameters={shapes:e,curveSegments:r};var i=[],a=[],o=[],s=[],l=0,u=0;if(!1===Array.isArray(e))h(e);else for(var c=0;c<e.length;c++)h(e[c]),n.addGroup(l,u,c),l+=u,u=0;function h(e){var t=a.length/3,n=e.extractPoints(r),l=n.shape,c=n.holes;!1===Yu.isClockWise(l)&&(l=l.reverse());for(var h=0,d=c.length;h<d;h++){var p=c[h];!0===Yu.isClockWise(p)&&(c[h]=p.reverse())}for(var f=Yu.triangulateShape(l,c),m=0,v=c.length;m<v;m++){var g=c[m];l=l.concat(g)}for(var y=0,x=l.length;y<x;y++){var b=l[y];a.push(b.x,b.y,0),o.push(0,0,1),s.push(b.x,b.y)}for(var M=0,w=f.length;M<w;M++){var _=f[M],A=_[0]+t,C=_[1]+t,T=_[2]+t;i.push(A,C,T),u+=3}}return n.setIndex(i),n.setAttribute("position",new Vi(a,3)),n.setAttribute("normal",new Vi(o,3)),n.setAttribute("uv",new Vi(s,2)),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"toJSON",value:function(){var e=ra.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}])}(ra),dc=function(e){function t(e,n){var r;return(0,v.default)(this,t),(r=T(this,t)).type="ShapeGeometry","object"==(0,y.default)(n)&&(n=n.curveSegments),r.parameters={shapes:e,curveSegments:n},r.fromBufferGeometry(new hc(e,n)),r.mergeVertices(),r}return(0,m.default)(t,e),(0,g.default)(t,[{key:"toJSON",value:function(){var e=ou.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}])}(ou),pc=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;(0,v.default)(this,t),(e=T(this,t)).type="SphereBufferGeometry",e.parameters={radius:n,widthSegments:r,heightSegments:i,phiStart:a,phiLength:o,thetaStart:s,thetaLength:l},r=Math.max(3,Math.floor(r)),i=Math.max(2,Math.floor(i));for(var u=Math.min(s+l,Math.PI),c=0,h=[],d=new sr,p=new sr,f=[],m=[],g=[],y=[],x=0;x<=i;x++){var b=[],M=x/i,w=0;0==x&&0==s?w=.5/r:x==i&&u==Math.PI&&(w=-.5/r);for(var _=0;_<=r;_++){var A=_/r;d.x=-n*Math.cos(a+A*o)*Math.sin(s+M*l),d.y=n*Math.cos(s+M*l),d.z=n*Math.sin(a+A*o)*Math.sin(s+M*l),m.push(d.x,d.y,d.z),p.copy(d).normalize(),g.push(p.x,p.y,p.z),y.push(A+w,1-M),b.push(c++)}h.push(b)}for(var C=0;C<i;C++)for(var S=0;S<r;S++){var E=h[C][S+1],L=h[C][S],P=h[C+1][S],B=h[C+1][S+1];(0!==C||s>0)&&f.push(E,L,B),(C!==i-1||u<Math.PI)&&f.push(L,P,B)}return e.setIndex(f),e.setAttribute("position",new Vi(m,3)),e.setAttribute("normal",new Vi(g,3)),e.setAttribute("uv",new Vi(y,2)),e}return(0,m.default)(t,e),(0,g.default)(t)}(ra),fc=function(e){function t(e,n,r,i,a,o,s){var l;return(0,v.default)(this,t),(l=T(this,t)).type="SphereGeometry",l.parameters={radius:e,widthSegments:n,heightSegments:r,phiStart:i,phiLength:a,thetaStart:o,thetaLength:s},l.fromBufferGeometry(new pc(e,n,r,i,a,o,s)),l.mergeVertices(),l}return(0,m.default)(t,e),(0,g.default)(t)}(ou),mc=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,v.default)(this,t),(e=T(this,t,[[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],n,r])).type="TetrahedronBufferGeometry",e.parameters={radius:n,detail:r},e}return(0,m.default)(t,e),(0,g.default)(t)}(fu),vc=function(e){function t(e,n){var r;return(0,v.default)(this,t),(r=T(this,t)).type="TetrahedronGeometry",r.parameters={radius:e,detail:n},r.fromBufferGeometry(new mc(e,n)),r.mergeVertices(),r}return(0,m.default)(t,e),(0,g.default)(t)}(ou),gc=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,v.default)(this,t);var i=r.font;if(!i||!i.isFont)return(0,p.default)(n,new ra);var a=i.generateShapes(e,r.size);return r.depth=void 0!==r.height?r.height:50,void 0===r.bevelThickness&&(r.bevelThickness=10),void 0===r.bevelSize&&(r.bevelSize=8),void 0===r.bevelEnabled&&(r.bevelEnabled=!1),(n=T(this,t,[a,r])).type="TextBufferGeometry",n}return(0,m.default)(t,e),(0,g.default)(t)}(qu),yc=function(e){function t(e,n){var r;return(0,v.default)(this,t),(r=T(this,t)).type="TextGeometry",r.parameters={text:e,parameters:n},r.fromBufferGeometry(new gc(e,n)),r.mergeVertices(),r}return(0,m.default)(t,e),(0,g.default)(t)}(ou),xc=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;(0,v.default)(this,t),(e=T(this,t)).type="TorusBufferGeometry",e.parameters={radius:n,tube:r,radialSegments:i,tubularSegments:a,arc:o},i=Math.floor(i),a=Math.floor(a);for(var s=[],l=[],u=[],c=[],h=new sr,d=new sr,p=new sr,f=0;f<=i;f++)for(var m=0;m<=a;m++){var g=m/a*o,y=f/i*Math.PI*2;d.x=(n+r*Math.cos(y))*Math.cos(g),d.y=(n+r*Math.cos(y))*Math.sin(g),d.z=r*Math.sin(y),l.push(d.x,d.y,d.z),h.x=n*Math.cos(g),h.y=n*Math.sin(g),p.subVectors(d,h).normalize(),u.push(p.x,p.y,p.z),c.push(m/a),c.push(f/i)}for(var x=1;x<=i;x++)for(var b=1;b<=a;b++){var M=(a+1)*x+b-1,w=(a+1)*(x-1)+b-1,_=(a+1)*(x-1)+b,A=(a+1)*x+b;s.push(M,w,A),s.push(w,_,A)}return e.setIndex(s),e.setAttribute("position",new Vi(l,3)),e.setAttribute("normal",new Vi(u,3)),e.setAttribute("uv",new Vi(c,2)),e}return(0,m.default)(t,e),(0,g.default)(t)}(ra),bc=function(e){function t(e,n,r,i,a){var o;return(0,v.default)(this,t),(o=T(this,t)).type="TorusGeometry",o.parameters={radius:e,tube:n,radialSegments:r,tubularSegments:i,arc:a},o.fromBufferGeometry(new xc(e,n,r,i,a)),o.mergeVertices(),o}return(0,m.default)(t,e),(0,g.default)(t)}(ou),Mc=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;(0,v.default)(this,t),(e=T(this,t)).type="TorusKnotBufferGeometry",e.parameters={radius:n,tube:r,tubularSegments:i,radialSegments:a,p:o,q:s},i=Math.floor(i),a=Math.floor(a);for(var l=[],u=[],c=[],h=[],d=new sr,p=new sr,f=new sr,m=new sr,g=new sr,y=new sr,x=new sr,b=0;b<=i;++b){var M=b/i*o*Math.PI*2;k(M,o,s,n,f),k(M+.01,o,s,n,m),y.subVectors(m,f),x.addVectors(m,f),g.crossVectors(y,x),x.crossVectors(g,y),g.normalize(),x.normalize();for(var w=0;w<=a;++w){var _=w/a*Math.PI*2,A=-r*Math.cos(_),C=r*Math.sin(_);d.x=f.x+(A*x.x+C*g.x),d.y=f.y+(A*x.y+C*g.y),d.z=f.z+(A*x.z+C*g.z),u.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),c.push(p.x,p.y,p.z),h.push(b/i),h.push(w/a)}}for(var S=1;S<=i;S++)for(var E=1;E<=a;E++){var L=(a+1)*(S-1)+(E-1),P=(a+1)*S+(E-1),B=(a+1)*S+E,D=(a+1)*(S-1)+E;l.push(L,P,D),l.push(P,B,D)}function k(e,t,n,r,i){var a=Math.cos(e),o=Math.sin(e),s=n/t*e,l=Math.cos(s);i.x=r*(2+l)*.5*a,i.y=r*(2+l)*o*.5,i.z=r*Math.sin(s)*.5}return e.setIndex(l),e.setAttribute("position",new Vi(u,3)),e.setAttribute("normal",new Vi(c,3)),e.setAttribute("uv",new Vi(h,2)),e}return(0,m.default)(t,e),(0,g.default)(t)}(ra),wc=function(e){function t(e,n,r,i,a,o,s){var l;return(0,v.default)(this,t),(l=T(this,t)).type="TorusKnotGeometry",l.parameters={radius:e,tube:n,tubularSegments:r,radialSegments:i,p:a,q:o},l.fromBufferGeometry(new Mc(e,n,r,i,a,o)),l.mergeVertices(),l}return(0,m.default)(t,e),(0,g.default)(t)}(ou),_c=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,v.default)(this,t),(n=T(this,t)).type="TubeBufferGeometry",n.parameters={path:e,tubularSegments:r,radius:i,radialSegments:a,closed:o};var s=e.computeFrenetFrames(r,o);n.tangents=s.tangents,n.normals=s.normals,n.binormals=s.binormals;var l=new sr,u=new sr,c=new Kn,h=new sr,d=[],p=[],f=[],m=[];function g(t){h=e.getPointAt(t/r,h);for(var n=s.normals[t],o=s.binormals[t],c=0;c<=a;c++){var f=c/a*Math.PI*2,m=Math.sin(f),v=-Math.cos(f);u.x=v*n.x+m*o.x,u.y=v*n.y+m*o.y,u.z=v*n.z+m*o.z,u.normalize(),p.push(u.x,u.y,u.z),l.x=h.x+i*u.x,l.y=h.y+i*u.y,l.z=h.z+i*u.z,d.push(l.x,l.y,l.z)}}return function(){for(var e=0;e<r;e++)g(e);g(!1===o?r:0),function(){for(var e=0;e<=r;e++)for(var t=0;t<=a;t++)c.x=e/r,c.y=t/a,f.push(c.x,c.y)}(),function(){for(var e=1;e<=r;e++)for(var t=1;t<=a;t++){var n=(a+1)*(e-1)+(t-1),i=(a+1)*e+(t-1),o=(a+1)*e+t,s=(a+1)*(e-1)+t;m.push(n,i,s),m.push(i,o,s)}}()}(),n.setIndex(m),n.setAttribute("position",new Vi(d,3)),n.setAttribute("normal",new Vi(p,3)),n.setAttribute("uv",new Vi(f,2)),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"toJSON",value:function(){var e=ra.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e}}])}(ra),Ac=function(e){function t(e,n,r,i,a,o){var s;(0,v.default)(this,t),(s=T(this,t)).type="TubeGeometry",s.parameters={path:e,tubularSegments:n,radius:r,radialSegments:i,closed:a};var l=new _c(e,n,r,i,a);return s.tangents=l.tangents,s.normals=l.normals,s.binormals=l.binormals,s.fromBufferGeometry(l),s.mergeVertices(),s}return(0,m.default)(t,e),(0,g.default)(t)}(ou),Cc=function(e){function t(e){var n;(0,v.default)(this,t),(n=T(this,t)).type="WireframeGeometry";var r=[],i=[0,0],a={},o=["a","b","c"];if(e&&e.isGeometry){for(var s=e.faces,l=0,u=s.length;l<u;l++)for(var c=s[l],h=0;h<3;h++){var d=c[o[h]],p=c[o[(h+1)%3]];i[0]=Math.min(d,p),i[1]=Math.max(d,p);var f=i[0]+","+i[1];void 0===a[f]&&(a[f]={index1:i[0],index2:i[1]})}for(var m in a){var g=a[m],y=e.vertices[g.index1];r.push(y.x,y.y,y.z),y=e.vertices[g.index2],r.push(y.x,y.y,y.z)}}else if(e&&e.isBufferGeometry){var x=new sr;if(null!==e.index){var b=e.attributes.position,M=e.index,w=e.groups;0===w.length&&(w=[{start:0,count:M.count,materialIndex:0}]);for(var _=0,A=w.length;_<A;++_)for(var C=w[_],S=C.start,E=S,L=S+C.count;E<L;E+=3)for(var P=0;P<3;P++){var B=M.getX(E+P),D=M.getX(E+(P+1)%3);i[0]=Math.min(B,D),i[1]=Math.max(B,D);var k=i[0]+","+i[1];void 0===a[k]&&(a[k]={index1:i[0],index2:i[1]})}for(var R in a){var O=a[R];x.fromBufferAttribute(b,O.index1),r.push(x.x,x.y,x.z),x.fromBufferAttribute(b,O.index2),r.push(x.x,x.y,x.z)}}else for(var I=e.attributes.position,F=0,N=I.count/3;F<N;F++)for(var z=0;z<3;z++){var U=3*F+z;x.fromBufferAttribute(I,U),r.push(x.x,x.y,x.z);var H=3*F+(z+1)%3;x.fromBufferAttribute(I,H),r.push(x.x,x.y,x.z)}}return n.setAttribute("position",new Vi(r,3)),n}return(0,m.default)(t,e),(0,g.default)(t)}(ra),Tc=Object.freeze({__proto__:null,BoxGeometry:su,BoxBufferGeometry:Aa,CircleGeometry:uu,CircleBufferGeometry:lu,ConeGeometry:du,ConeBufferGeometry:pu,CylinderGeometry:hu,CylinderBufferGeometry:cu,DodecahedronGeometry:vu,DodecahedronBufferGeometry:mu,EdgesGeometry:Mu,ExtrudeGeometry:Zu,ExtrudeBufferGeometry:qu,IcosahedronGeometry:ec,IcosahedronBufferGeometry:$u,LatheGeometry:nc,LatheBufferGeometry:tc,OctahedronGeometry:ic,OctahedronBufferGeometry:rc,ParametricGeometry:oc,ParametricBufferGeometry:ac,PlaneGeometry:sc,PlaneBufferGeometry:Va,PolyhedronGeometry:lc,PolyhedronBufferGeometry:fu,RingGeometry:cc,RingBufferGeometry:uc,ShapeGeometry:dc,ShapeBufferGeometry:hc,SphereGeometry:fc,SphereBufferGeometry:pc,TetrahedronGeometry:vc,TetrahedronBufferGeometry:mc,TextGeometry:yc,TextBufferGeometry:gc,TorusGeometry:bc,TorusBufferGeometry:xc,TorusKnotGeometry:wc,TorusKnotBufferGeometry:Mc,TubeGeometry:Ac,TubeBufferGeometry:_c,WireframeGeometry:Cc});function Sc(e){Bi.call(this),this.type="ShadowMaterial",this.color=new Ei(0),this.transparent=!0,this.setValues(e)}function Ec(e){Pa.call(this,e),this.type="RawShaderMaterial"}function Lc(e){Bi.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ei(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ei(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vn,this.normalScale=new Kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}function Pc(e){Lc.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Kn(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=qn.clamp(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}function Bc(e){Bi.call(this),this.type="MeshPhongMaterial",this.color=new Ei(16777215),this.specular=new Ei(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ei(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vn,this.normalScale=new Kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ie,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Dc(e){Bi.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ei(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ei(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vn,this.normalScale=new Kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function kc(e){Bi.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vn,this.normalScale=new Kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Rc(e){Bi.call(this),this.type="MeshLambertMaterial",this.color=new Ei(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ei(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ie,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Oc(e){Bi.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ei(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vn,this.normalScale=new Kn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ic(e){Rl.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Sc.prototype=Object.create(Bi.prototype),Sc.prototype.constructor=Sc,Sc.prototype.isShadowMaterial=!0,Sc.prototype.copy=function(e){return Bi.prototype.copy.call(this,e),this.color.copy(e.color),this},Ec.prototype=Object.create(Pa.prototype),Ec.prototype.constructor=Ec,Ec.prototype.isRawShaderMaterial=!0,Lc.prototype=Object.create(Bi.prototype),Lc.prototype.constructor=Lc,Lc.prototype.isMeshStandardMaterial=!0,Lc.prototype.copy=function(e){return Bi.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},Pc.prototype=Object.create(Lc.prototype),Pc.prototype.constructor=Pc,Pc.prototype.isMeshPhysicalMaterial=!0,Pc.prototype.copy=function(e){return Lc.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Ei).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this},Bc.prototype=Object.create(Bi.prototype),Bc.prototype.constructor=Bc,Bc.prototype.isMeshPhongMaterial=!0,Bc.prototype.copy=function(e){return Bi.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Dc.prototype=Object.create(Bi.prototype),Dc.prototype.constructor=Dc,Dc.prototype.isMeshToonMaterial=!0,Dc.prototype.copy=function(e){return Bi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},kc.prototype=Object.create(Bi.prototype),kc.prototype.constructor=kc,kc.prototype.isMeshNormalMaterial=!0,kc.prototype.copy=function(e){return Bi.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Rc.prototype=Object.create(Bi.prototype),Rc.prototype.constructor=Rc,Rc.prototype.isMeshLambertMaterial=!0,Rc.prototype.copy=function(e){return Bi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Oc.prototype=Object.create(Bi.prototype),Oc.prototype.constructor=Oc,Oc.prototype.isMeshMatcapMaterial=!0,Oc.prototype.copy=function(e){return Bi.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ic.prototype=Object.create(Rl.prototype),Ic.prototype.constructor=Ic,Ic.prototype.isLineDashedMaterial=!0,Ic.prototype.copy=function(e){return Rl.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Fc=Object.freeze({__proto__:null,ShadowMaterial:Sc,SpriteMaterial:ol,RawShaderMaterial:Ec,ShaderMaterial:Pa,PointsMaterial:Wl,MeshPhysicalMaterial:Pc,MeshStandardMaterial:Lc,MeshPhongMaterial:Bc,MeshToonMaterial:Dc,MeshNormalMaterial:kc,MeshLambertMaterial:Rc,MeshDepthMaterial:Ns,MeshDistanceMaterial:zs,MeshBasicMaterial:Di,MeshMatcapMaterial:Oc,LineDashedMaterial:Ic,LineBasicMaterial:Rl,Material:Bi}),Nc={arraySlice:function(e,t,n){return Nc.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),r=0;r!==t;++r)n[r]=r;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var r=e.length,i=new e.constructor(r),a=0,o=0;o!==r;++a)for(var s=n[a]*t,l=0;l!==t;++l)i[o++]=e[s+l];return i},flattenJSON:function(e,t,n,r){for(var i=1,a=e[0];void 0!==a&&void 0===a[r];)a=e[i++];if(void 0!==a){var o=a[r];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[r])&&(t.push(a.time),n.push.apply(n,o)),a=e[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[r])&&(t.push(a.time),o.toArray(n,n.length)),a=e[i++]}while(void 0!==a);else do{void 0!==(o=a[r])&&(t.push(a.time),n.push(o)),a=e[i++]}while(void 0!==a)}},subclip:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,a=e.clone();a.name=t;for(var o=[],s=0;s<a.tracks.length;++s){for(var l=a.tracks[s],u=l.getValueSize(),c=[],h=[],d=0;d<l.times.length;++d){var p=l.times[d]*i;if(!(p<n||p>=r)){c.push(l.times[d]);for(var f=0;f<u;++f)h.push(l.values[d*u+f])}}0!==c.length&&(l.times=Nc.convertArray(c,l.times.constructor),l.values=Nc.convertArray(h,l.values.constructor),o.push(l))}a.tracks=o;for(var m=1/0,v=0;v<a.tracks.length;++v)m>a.tracks[v].times[0]&&(m=a.tracks[v].times[0]);for(var g=0;g<a.tracks.length;++g)a.tracks[g].shift(-1*m);return a.resetDuration(),a},makeClipAdditive:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;r<=0&&(r=30);for(var i=n.tracks.length,a=t/r,o=function(){var t=n.tracks[s],r=t.ValueTypeName;if("bool"===r||"string"===r)return 0;var i=e.tracks.find((function(e){return e.name===t.name&&e.ValueTypeName===r}));if(void 0===i)return 0;var o=0,l=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);var u=0,c=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=c/3);var h,d=t.times.length-1;if(a<=t.times[0]){var p=o,f=l-o;h=Nc.arraySlice(t.values,p,f)}else if(a>=t.times[d]){var m=d*l+o,v=m+l-o;h=Nc.arraySlice(t.values,m,v)}else{var g=t.createInterpolant(),y=o,x=l-o;g.evaluate(a),h=Nc.arraySlice(g.resultBuffer,y,x)}"quaternion"===r&&(new or).fromArray(h).normalize().conjugate().toArray(h);for(var b=i.times.length,M=0;M<b;++M){var w=M*c+u;if("quaternion"===r)or.multiplyQuaternionsFlat(i.values,w,h,0,i.values,w);else for(var _=c-2*u,A=0;A<_;++A)i.values[w+A]-=h[A]}},s=0;s<i;++s)o();return e.blendMode=tn,e}};function zc(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function Uc(e,t,n,r){zc.call(this,e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Hc(e,t,n,r){zc.call(this,e,t,n,r)}function jc(e,t,n,r){zc.call(this,e,t,n,r)}function Gc(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Nc.convertArray(t,this.TimeBufferType),this.values=Nc.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function Vc(e,t,n){Gc.call(this,e,t,n)}function Wc(e,t,n,r){Gc.call(this,e,t,n,r)}function Xc(e,t,n,r){Gc.call(this,e,t,n,r)}function Yc(e,t,n,r){zc.call(this,e,t,n,r)}function Jc(e,t,n,r){Gc.call(this,e,t,n,r)}function Qc(e,t,n,r){Gc.call(this,e,t,n,r)}function qc(e,t,n,r){Gc.call(this,e,t,n,r)}function Kc(e,t,n,r){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.blendMode=void 0!==r?r:en,this.uuid=qn.generateUUID(),this.duration<0&&this.resetDuration()}function Zc(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Xc;case"vector":case"vector2":case"vector3":case"vector4":return qc;case"color":return Wc;case"quaternion":return Jc;case"bool":case"boolean":return Vc;case"string":return Qc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],r=[];Nc.flattenJSON(e.keys,n,r,"value"),e.times=n,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(zc.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{var a;n:{r:if(!(e<r)){for(var o=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===o)break;if(i=r,e<(r=t[++n]))break t}a=t.length;break n}if(e>=i)break e;var s=t[1];e<s&&(n=2,i=s);for(var l=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===l)break;if(r=i,e>=(i=t[--n-1]))break t}a=n,n=0}for(;n<a;){var u=n+a>>>1;e<t[u]?a=u:n=u+1}if(r=t[n],void 0===(i=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r,a=0;a!==r;++a)t[a]=n[i+a];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(zc.prototype,{beforeStart_:zc.prototype.copySampleValue_,afterEnd_:zc.prototype.copySampleValue_}),Uc.prototype=Object.assign(Object.create(zc.prototype),{constructor:Uc,DefaultSettings_:{endingStart:Kt,endingEnd:Kt},intervalChanged_:function(e,t,n){var r=this.parameterPositions,i=e-2,a=e+1,o=r[i],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case Zt:i=e,o=2*t-n;break;case $t:o=t+r[i=r.length-2]-r[i+1];break;default:i=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Zt:a=e,s=2*n-t;break;case $t:a=1,s=n+r[1]-r[0];break;default:a=e-1,s=t}var l=.5*(n-t),u=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=i*u,this._offsetNext=a*u},interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p,v=-h*m+2*h*f-h*p,g=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f,b=0;b!==o;++b)i[b]=v*a[u+b]+g*a[l+b]+y*a[s+b]+x*a[c+b];return i}}),Hc.prototype=Object.assign(Object.create(zc.prototype),{constructor:Hc,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=(n-t)/(r-t),c=1-u,h=0;h!==o;++h)i[h]=a[l+h]*c+a[s+h]*u;return i}}),jc.prototype=Object.assign(Object.create(zc.prototype),{constructor:jc,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Gc,{toJSON:function(e){var t,n=e.constructor;if(void 0!==n.toJSON)t=n.toJSON(e);else{t={name:e.name,times:Nc.convertArray(e.times,Array),values:Nc.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}),Object.assign(Gc.prototype,{constructor:Gc,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Qt,InterpolantFactoryMethodDiscrete:function(e){return new jc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Hc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Uc(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case Jt:t=this.InterpolantFactoryMethodDiscrete;break;case Qt:t=this.InterpolantFactoryMethodLinear;break;case qt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Jt;case this.InterpolantFactoryMethodLinear:return Qt;case this.InterpolantFactoryMethodSmooth:return qt}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,r=n.length,i=0,a=r-1;i!==r&&n[i]<e;)++i;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==i||a!==r){i>=a&&(i=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=Nc.arraySlice(n,i,a),this.values=Nc.arraySlice(this.values,i*o,a*o)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(e=!1);var n=this.times,r=this.values,i=n.length;0===i&&(e=!1);for(var a=null,o=0;o!==i;o++){var s=n[o];if("number"==typeof s&&isNaN(s)){e=!1;break}if(null!==a&&a>s){e=!1;break}a=s}if(void 0!==r&&Nc.isTypedArray(r))for(var l=0,u=r.length;l!==u;++l){var c=r[l];if(isNaN(c)){e=!1;break}}return e},optimize:function(){for(var e=Nc.arraySlice(this.times),t=Nc.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===qt,i=e.length-1,a=1,o=1;o<i;++o){var s=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==l[0]))if(r)s=!0;else for(var u=o*n,c=u-n,h=u+n,d=0;d!==n;++d){var p=t[u+d];if(p!==t[c+d]||p!==t[h+d]){s=!0;break}}if(s){if(o!==a){e[a]=e[o];for(var f=o*n,m=a*n,v=0;v!==n;++v)t[m+v]=t[f+v]}++a}}if(i>0){e[a]=e[i];for(var g=i*n,y=a*n,x=0;x!==n;++x)t[y+x]=t[g+x];++a}return a!==e.length?(this.times=Nc.arraySlice(e,0,a),this.values=Nc.arraySlice(t,0,a*n)):(this.times=e,this.values=t),this},clone:function(){var e=Nc.arraySlice(this.times,0),t=Nc.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),Vc.prototype=Object.assign(Object.create(Gc.prototype),{constructor:Vc,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Jt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Wc.prototype=Object.assign(Object.create(Gc.prototype),{constructor:Wc,ValueTypeName:"color"}),Xc.prototype=Object.assign(Object.create(Gc.prototype),{constructor:Xc,ValueTypeName:"number"}),Yc.prototype=Object.assign(Object.create(zc.prototype),{constructor:Yc,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t),l=e*o,u=l+o;l!==u;l+=4)or.slerpFlat(i,0,a,l-o,a,l,s);return i}}),Jc.prototype=Object.assign(Object.create(Gc.prototype),{constructor:Jc,ValueTypeName:"quaternion",DefaultInterpolation:Qt,InterpolantFactoryMethodLinear:function(e){return new Yc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Qc.prototype=Object.assign(Object.create(Gc.prototype),{constructor:Qc,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Jt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),qc.prototype=Object.assign(Object.create(Gc.prototype),{constructor:qc,ValueTypeName:"vector"}),Object.assign(Kc,{parse:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),i=0,a=n.length;i!==a;++i)t.push(Zc(n[i]).scale(r));var o=new Kc(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o},toJSON:function(e){for(var t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},i=0,a=n.length;i!==a;++i)t.push(Gc.toJSON(n[i]));return r},CreateFromMorphTargetSequence:function(e,t,n,r){for(var i=t.length,a=[],o=0;o<i;o++){var s=[],l=[];s.push((o+i-1)%i,o,(o+1)%i),l.push(0,1,0);var u=Nc.getKeyframeOrder(s);s=Nc.sortedArray(s,1,u),l=Nc.sortedArray(l,1,u),r||0!==s[0]||(s.push(i),l.push(l[0])),a.push(new Xc(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/n))}return new Kc(e,-1,a)},findByName:function(e,t){var n=e;if(!Array.isArray(e)){var r=e;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],l=s.name.match(i);if(l&&l.length>1){var u=l[1],c=r[u];c||(r[u]=c=[]),c.push(s)}}var h=[];for(var d in r)h.push(Kc.CreateFromMorphTargetSequence(d,r[d],t,n));return h},parseAnimation:function(e,t){if(!e)return null;for(var n=function(e,t,n,r,i){if(0!==n.length){var a=[],o=[];Nc.flattenJSON(n,a,o,r),0!==a.length&&i.push(new e(t,a,o))}},r=[],i=e.name||"default",a=e.fps||30,o=e.blendMode,s=e.length||-1,l=e.hierarchy||[],u=0;u<l.length;u++){var c=l[u].keys;if(c&&0!==c.length)if(c[0].morphTargets){var h={},d=void 0;for(d=0;d<c.length;d++)if(c[d].morphTargets)for(var p=0;p<c[d].morphTargets.length;p++)h[c[d].morphTargets[p]]=-1;for(var f in h){for(var m=[],v=[],g=0;g!==c[d].morphTargets.length;++g){var y=c[d];m.push(y.time),v.push(y.morphTarget===f?1:0)}r.push(new Xc(".morphTargetInfluence["+f+"]",m,v))}s=h.length*(a||1)}else{var x=".bones["+t[u].name+"]";n(qc,x+".position",c,"pos",r),n(Jc,x+".quaternion",c,"rot",r),n(qc,x+".scale",c,"scl",r)}}return 0===r.length?null:new Kc(i,s,r,o)}}),Object.assign(Kc.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new Kc(this.name,this.duration,e,this.blendMode)},toJSON:function(){return Kc.toJSON(this)}});var $c={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function eh(e,t,n){var r,i=this,a=!1,o=0,s=0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++,!1===a&&void 0!==i.onStart&&i.onStart(e,o,s),a=!0},this.itemEnd=function(e){o++,void 0!==i.onProgress&&i.onProgress(e,o,s),o===s&&(a=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=l.length;t<n;t+=2){var r=l[t],i=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null}}var th=new eh;function nh(e){this.manager=void 0!==e?e:th,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(nh.prototype,{load:function(){},loadAsync:function(e,t){var n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});var rh={};function ih(e){nh.call(this,e)}function ah(e){nh.call(this,e)}function oh(e){nh.call(this,e)}function sh(e){nh.call(this,e)}function lh(e){nh.call(this,e)}function uh(e){nh.call(this,e)}function ch(e){nh.call(this,e)}function hh(){this.type="Curve",this.arcLengthDivisions=200}function dh(e,t,n,r,i,a,o,s){hh.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function ph(e,t,n,r,i,a){dh.call(this,e,t,n,n,r,i,a),this.type="ArcCurve"}function fh(){var e=0,t=0,n=0,r=0;function i(i,a,o,s){e=i,t=o,n=-3*i+3*a-2*o-s,r=2*i-2*a+o+s}return{initCatmullRom:function(e,t,n,r,a){i(t,n,a*(n-e),a*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,a,o,s){var l=(t-e)/a-(n-e)/(a+o)+(n-t)/o,u=(n-t)/o-(r-t)/(o+s)+(r-n)/s;i(t,n,l*=o,u*=o)},calc:function(i){var a=i*i;return e+t*i+n*a+r*(a*i)}}}ih.prototype=Object.assign(Object.create(nh.prototype),{constructor:ih,load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=$c.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;if(void 0===rh[e]){var o,s=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var l=s[1],u=!!s[2],c=s[3];c=decodeURIComponent(c),u&&(c=atob(c));try{var h,d=(this.responseType||"").toLowerCase();switch(d){case"arraybuffer":case"blob":for(var p=new Uint8Array(c.length),f=0;f<c.length;f++)p[f]=c.charCodeAt(f);h="blob"===d?new Blob([p.buffer],{type:l}):p.buffer;break;case"document":var m=new DOMParser;h=m.parseFromString(c,l);break;case"json":h=JSON.parse(c);break;default:h=c}setTimeout((function(){t&&t(h),i.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}),0)}}else{for(var v in rh[e]=[],rh[e].push({onLoad:t,onProgress:n,onError:r}),(o=new XMLHttpRequest).open("GET",e,!0),o.addEventListener("load",(function(t){var n=this.response,r=rh[e];if(delete rh[e],200===this.status||0===this.status){this.status,$c.add(e,n);for(var a=0,o=r.length;a<o;a++){var s=r[a];s.onLoad&&s.onLoad(n)}i.manager.itemEnd(e)}else{for(var l=0,u=r.length;l<u;l++){var c=r[l];c.onError&&c.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}}),!1),o.addEventListener("progress",(function(t){for(var n=rh[e],r=0,i=n.length;r<i;r++){var a=n[r];a.onProgress&&a.onProgress(t)}}),!1),o.addEventListener("error",(function(t){var n=rh[e];delete rh[e];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),o.addEventListener("abort",(function(t){var n=rh[e];delete rh[e];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(o.responseType=this.responseType),void 0!==this.withCredentials&&(o.withCredentials=this.withCredentials),o.overrideMimeType&&o.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)o.setRequestHeader(v,this.requestHeader[v]);o.send(null)}return i.manager.itemStart(e),o}rh[e].push({onLoad:t,onProgress:n,onError:r})},setResponseType:function(e){return this.responseType=e,this},setMimeType:function(e){return this.mimeType=e,this}}),ah.prototype=Object.assign(Object.create(nh.prototype),{constructor:ah,load:function(e,t,n,r){var i=this,a=new ih(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r&&r(t),i.manager.itemError(e)}}),n,r)},parse:function(e){for(var t=[],n=0;n<e.length;n++){var r=Kc.parse(e[n]);t.push(r)}return t}}),oh.prototype=Object.assign(Object.create(nh.prototype),{constructor:oh,load:function(e,t,n,r){var i=this,a=[],o=new $l;o.image=a;var s=new ih(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials);var l=0;function u(u){s.load(e[u],(function(e){var n=i.parse(e,!0);a[u]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(l+=1)&&(1===n.mipmapCount&&(o.minFilter=Ee),o.format=n.format,o.needsUpdate=!0,t&&t(o))}),n,r)}if(Array.isArray(e))for(var c=0,h=e.length;c<h;++c)u(c);else s.load(e,(function(e){var n=i.parse(e,!0);if(n.isCubemap)for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){a[s]={mipmaps:[]};for(var l=0;l<n.mipmapCount;l++)a[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+l]),a[s].format=n.format,a[s].width=n.width,a[s].height=n.height}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=Ee),o.format=n.format,o.needsUpdate=!0,t&&t(o)}),n,r);return o}}),sh.prototype=Object.assign(Object.create(nh.prototype),{constructor:sh,load:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=$c.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),$c.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o}}),lh.prototype=Object.assign(Object.create(nh.prototype),{constructor:lh,load:function(e,t,n,r){var i=new Ia,a=new sh(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(n){a.load(e[n],(function(e){i.images[n]=e,6==++o&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(var l=0;l<e.length;++l)s(l);return i}}),uh.prototype=Object.assign(Object.create(nh.prototype),{constructor:uh,load:function(e,t,n,r){var i=this,a=new Na,o=new ih(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(i.withCredentials),o.load(e,(function(e){var n=i.parse(e);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:Me,a.wrapT=void 0!==n.wrapT?n.wrapT:Me,a.magFilter=void 0!==n.magFilter?n.magFilter:Ee,a.minFilter=void 0!==n.minFilter?n.minFilter:Ee,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=Be),1===n.mipmapCount&&(a.minFilter=Ee),a.needsUpdate=!0,t&&t(a,n))}),n,r),a}}),ch.prototype=Object.assign(Object.create(nh.prototype),{constructor:ch,load:function(e,t,n,r){var i=new tr,a=new sh(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(n){i.image=n;var r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?Xe:Ye,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}),Object.assign(hh.prototype,{getPoint:function(){return null},getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],r=this.getPoint(0),i=0;n.push(0);for(var a=1;a<=e;a++)i+=(t=this.getPoint(a/e)).distanceTo(r),n.push(i),r=t;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,r=this.getLengths(),i=0,a=r.length;n=t||e*r[a-1];for(var o,s=0,l=a-1;s<=l;)if((o=r[i=Math.floor(s+(l-s)/2)]-n)<0)s=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(r[i=l]===n)return i/(a-1);var u=r[i];return(i+(n-u)/(r[i+1]-u))/(a-1)},getTangent:function(e,t){var n=1e-4,r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);var a=this.getPoint(r),o=this.getPoint(i),s=t||(a.isVector2?new Kn:new sr);return s.copy(o).sub(a).normalize(),s},getTangentAt:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)},computeFrenetFrames:function(e,t){for(var n=new sr,r=[],i=[],a=[],o=new sr,s=new Or,l=0;l<=e;l++){var u=l/e;r[l]=this.getTangentAt(u,new sr),r[l].normalize()}i[0]=new sr,a[0]=new sr;var c=Number.MAX_VALUE,h=Math.abs(r[0].x),d=Math.abs(r[0].y),p=Math.abs(r[0].z);h<=c&&(c=h,n.set(1,0,0)),d<=c&&(c=d,n.set(0,1,0)),p<=c&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),a[0].crossVectors(r[0],i[0]);for(var f=1;f<=e;f++){if(i[f]=i[f-1].clone(),a[f]=a[f-1].clone(),o.crossVectors(r[f-1],r[f]),o.length()>Number.EPSILON){o.normalize();var m=Math.acos(qn.clamp(r[f-1].dot(r[f]),-1,1));i[f].applyMatrix4(s.makeRotationAxis(o,m))}a[f].crossVectors(r[f],i[f])}if(!0===t){var v=Math.acos(qn.clamp(i[0].dot(i[e]),-1,1));v/=e,r[0].dot(o.crossVectors(i[0],i[e]))>0&&(v=-v);for(var g=1;g<=e;g++)i[g].applyMatrix4(s.makeRotationAxis(r[g],v*g)),a[g].crossVectors(r[g],i[g])}return{tangents:r,normals:i,binormals:a}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),dh.prototype=Object.create(hh.prototype),dh.prototype.constructor=dh,dh.prototype.isEllipseCurve=!0,dh.prototype.getPoint=function(e,t){for(var n=t||new Kn,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=a?0:r),!0!==this.aClockwise||a||(i===r?i=-r:i-=r);var o=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var u=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,d=l-this.aY;s=h*u-d*c+this.aX,l=h*c+d*u+this.aY}return n.set(s,l)},dh.prototype.copy=function(e){return hh.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},dh.prototype.toJSON=function(){var e=hh.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},dh.prototype.fromJSON=function(e){return hh.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},ph.prototype=Object.create(dh.prototype),ph.prototype.constructor=ph,ph.prototype.isArcCurve=!0;var mh=new sr,vh=new fh,gh=new fh,yh=new fh;function xh(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;hh.call(this),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}function bh(e,t,n,r,i){var a=.5*(r-t),o=.5*(i-n),s=e*e;return(2*n-2*r+a+o)*(e*s)+(-3*n+3*r-2*a-o)*s+a*e+n}function Mh(e,t,n,r){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function wh(e,t,n,r,i){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}function _h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Kn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kn,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Kn,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Kn;hh.call(this),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}function Ah(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new sr,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sr,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new sr,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new sr;hh.call(this),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}function Ch(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Kn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kn;hh.call(this),this.type="LineCurve",this.v1=e,this.v2=t}function Th(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new sr,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sr;hh.call(this),this.type="LineCurve3",this.v1=e,this.v2=t}function Sh(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Kn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kn,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Kn;hh.call(this),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}function Eh(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new sr,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sr,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new sr;hh.call(this),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}function Lh(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];hh.call(this),this.type="SplineCurve",this.points=e}xh.prototype=Object.create(hh.prototype),xh.prototype.constructor=xh,xh.prototype.isCatmullRomCurve3=!0,xh.prototype.getPoint=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sr,i=this.points,a=i.length,o=(a-(this.closed?0:1))*e,s=Math.floor(o),l=o-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/a)+1)*a:0===l&&s===a-1&&(s=a-2,l=1),this.closed||s>0?t=i[(s-1)%a]:(mh.subVectors(i[0],i[1]).add(i[0]),t=mh);var u=i[s%a],c=i[(s+1)%a];if(this.closed||s+2<a?n=i[(s+2)%a]:(mh.subVectors(i[a-1],i[a-2]).add(i[a-1]),n=mh),"centripetal"===this.curveType||"chordal"===this.curveType){var h="chordal"===this.curveType?.5:.25,d=Math.pow(t.distanceToSquared(u),h),p=Math.pow(u.distanceToSquared(c),h),f=Math.pow(c.distanceToSquared(n),h);p<1e-4&&(p=1),d<1e-4&&(d=p),f<1e-4&&(f=p),vh.initNonuniformCatmullRom(t.x,u.x,c.x,n.x,d,p,f),gh.initNonuniformCatmullRom(t.y,u.y,c.y,n.y,d,p,f),yh.initNonuniformCatmullRom(t.z,u.z,c.z,n.z,d,p,f)}else"catmullrom"===this.curveType&&(vh.initCatmullRom(t.x,u.x,c.x,n.x,this.tension),gh.initCatmullRom(t.y,u.y,c.y,n.y,this.tension),yh.initCatmullRom(t.z,u.z,c.z,n.z,this.tension));return r.set(vh.calc(l),gh.calc(l),yh.calc(l)),r},xh.prototype.copy=function(e){hh.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},xh.prototype.toJSON=function(){var e=hh.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},xh.prototype.fromJSON=function(e){hh.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new sr).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},_h.prototype=Object.create(hh.prototype),_h.prototype.constructor=_h,_h.prototype.isCubicBezierCurve=!0,_h.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kn,n=this.v0,r=this.v1,i=this.v2,a=this.v3;return t.set(wh(e,n.x,r.x,i.x,a.x),wh(e,n.y,r.y,i.y,a.y)),t},_h.prototype.copy=function(e){return hh.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},_h.prototype.toJSON=function(){var e=hh.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},_h.prototype.fromJSON=function(e){return hh.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Ah.prototype=Object.create(hh.prototype),Ah.prototype.constructor=Ah,Ah.prototype.isCubicBezierCurve3=!0,Ah.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sr,n=this.v0,r=this.v1,i=this.v2,a=this.v3;return t.set(wh(e,n.x,r.x,i.x,a.x),wh(e,n.y,r.y,i.y,a.y),wh(e,n.z,r.z,i.z,a.z)),t},Ah.prototype.copy=function(e){return hh.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Ah.prototype.toJSON=function(){var e=hh.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Ah.prototype.fromJSON=function(e){return hh.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Ch.prototype=Object.create(hh.prototype),Ch.prototype.constructor=Ch,Ch.prototype.isLineCurve=!0,Ch.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kn;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},Ch.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Ch.prototype.getTangent=function(e,t){var n=t||new Kn;return n.copy(this.v2).sub(this.v1).normalize(),n},Ch.prototype.copy=function(e){return hh.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ch.prototype.toJSON=function(){var e=hh.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ch.prototype.fromJSON=function(e){return hh.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Th.prototype=Object.create(hh.prototype),Th.prototype.constructor=Th,Th.prototype.isLineCurve3=!0,Th.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sr;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},Th.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Th.prototype.copy=function(e){return hh.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Th.prototype.toJSON=function(){var e=hh.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Th.prototype.fromJSON=function(e){return hh.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Sh.prototype=Object.create(hh.prototype),Sh.prototype.constructor=Sh,Sh.prototype.isQuadraticBezierCurve=!0,Sh.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kn,n=this.v0,r=this.v1,i=this.v2;return t.set(Mh(e,n.x,r.x,i.x),Mh(e,n.y,r.y,i.y)),t},Sh.prototype.copy=function(e){return hh.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Sh.prototype.toJSON=function(){var e=hh.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Sh.prototype.fromJSON=function(e){return hh.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Eh.prototype=Object.create(hh.prototype),Eh.prototype.constructor=Eh,Eh.prototype.isQuadraticBezierCurve3=!0,Eh.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sr,n=this.v0,r=this.v1,i=this.v2;return t.set(Mh(e,n.x,r.x,i.x),Mh(e,n.y,r.y,i.y),Mh(e,n.z,r.z,i.z)),t},Eh.prototype.copy=function(e){return hh.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Eh.prototype.toJSON=function(){var e=hh.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Eh.prototype.fromJSON=function(e){return hh.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Lh.prototype=Object.create(hh.prototype),Lh.prototype.constructor=Lh,Lh.prototype.isSplineCurve=!0,Lh.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Kn,n=this.points,r=(n.length-1)*e,i=Math.floor(r),a=r-i,o=n[0===i?i:i-1],s=n[i],l=n[i>n.length-2?n.length-1:i+1],u=n[i>n.length-3?n.length-1:i+2];return t.set(bh(a,o.x,s.x,l.x,u.x),bh(a,o.y,s.y,l.y,u.y)),t},Lh.prototype.copy=function(e){hh.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this},Lh.prototype.toJSON=function(){var e=hh.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e},Lh.prototype.fromJSON=function(e){hh.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new Kn).fromArray(r))}return this};var Ph=Object.freeze({__proto__:null,ArcCurve:ph,CatmullRomCurve3:xh,CubicBezierCurve:_h,CubicBezierCurve3:Ah,EllipseCurve:dh,LineCurve:Ch,LineCurve3:Th,QuadraticBezierCurve:Sh,QuadraticBezierCurve3:Eh,SplineCurve:Lh});function Bh(){hh.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Dh(e){Bh.call(this),this.type="Path",this.currentPoint=new Kn,e&&this.setFromPoints(e)}function kh(e){Dh.call(this,e),this.uuid=qn.generateUUID(),this.type="Shape",this.holes=[]}function Rh(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;oi.call(this),this.type="Light",this.color=new Ei(e),this.intensity=t}function Oh(e,t,n){Rh.call(this,e,n),this.type="HemisphereLight",this.position.copy(oi.DefaultUp),this.updateMatrix(),this.groundColor=new Ei(t)}function Ih(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Kn(512,512),this.map=null,this.mapPass=null,this.matrix=new Or,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ha,this._frameExtents=new Kn(1,1),this._viewportCount=1,this._viewports=[new rr(0,0,1,1)]}function Fh(){Ih.call(this,new Da(50,1,.5,500)),this.focus=1}function Nh(e,t,n,r,i,a){Rh.call(this,e,t),this.type="SpotLight",this.position.copy(oi.DefaultUp),this.updateMatrix(),this.target=new oi,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==a?a:1,this.shadow=new Fh}function zh(){Ih.call(this,new Da(90,1,.5,500)),this._frameExtents=new Kn(4,2),this._viewportCount=6,this._viewports=[new rr(2,1,1,1),new rr(0,1,1,1),new rr(3,1,1,1),new rr(1,1,1,1),new rr(3,0,1,1),new rr(1,0,1,1)],this._cubeDirections=[new sr(1,0,0),new sr(-1,0,0),new sr(0,0,1),new sr(0,0,-1),new sr(0,1,0),new sr(0,-1,0)],this._cubeUps=[new sr(0,1,0),new sr(0,1,0),new sr(0,1,0),new sr(0,1,0),new sr(0,0,1),new sr(0,0,-1)]}function Uh(e,t,n,r){Rh.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new zh}function Hh(e,t,n,r,i,a){Ba.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==n?n:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==i?i:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function jh(){Ih.call(this,new Hh(-5,5,5,-5,.5,500))}function Gh(e,t){Rh.call(this,e,t),this.type="DirectionalLight",this.position.copy(oi.DefaultUp),this.updateMatrix(),this.target=new oi,this.shadow=new jh}function Vh(e,t){Rh.call(this,e,t),this.type="AmbientLight"}function Wh(e,t,n,r){Rh.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}Bh.prototype=Object.assign(Object.create(hh.prototype),{constructor:Bh,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ch(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=t){var i=n[r]-t,a=this.curves[r],o=a.getLength(),s=0===o?0:1-i/o;return a.getPointAt(s)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],r=0,i=this.curves;r<i.length;r++)for(var a=i[r],o=a&&a.isEllipseCurve?2*t:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o),l=0;l<s.length;l++){var u=s[l];e&&e.equals(u)||(n.push(u),e=u)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){hh.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=hh.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){hh.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push((new Ph[r.type]).fromJSON(r))}return this}}),Dh.prototype=Object.assign(Object.create(Bh.prototype),{constructor:Dh,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var n=new Ch(this.currentPoint.clone(),new Kn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,r){var i=new Sh(this.currentPoint.clone(),new Kn(e,t),new Kn(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(e,t,n,r,i,a){var o=new _h(this.currentPoint.clone(),new Kn(e,t),new Kn(n,r),new Kn(i,a));return this.curves.push(o),this.currentPoint.set(i,a),this},splineThru:function(e){var t=new Lh([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,r,i,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,r,i,a),this},absarc:function(e,t,n,r,i,a){return this.absellipse(e,t,n,n,r,i,a),this},ellipse:function(e,t,n,r,i,a,o,s){var l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,n,r,i,a,o,s),this},absellipse:function(e,t,n,r,i,a,o,s){var l=new dh(e,t,n,r,i,a,o,s);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(e){return Bh.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Bh.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Bh.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),kh.prototype=Object.assign(Object.create(Dh.prototype),{constructor:kh,getPointsHoles:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Dh.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=Dh.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){Dh.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push((new Dh).fromJSON(r))}return this}}),Rh.prototype=Object.assign(Object.create(oi.prototype),{constructor:Rh,isLight:!0,copy:function(e){return oi.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=oi.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Oh.prototype=Object.assign(Object.create(Rh.prototype),{constructor:Oh,isHemisphereLight:!0,copy:function(e){return Rh.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Ih.prototype,{_projScreenMatrix:new Or,_lightPositionWorld:new sr,_lookTarget:new sr,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,a=this._lightPositionWorld;a.setFromMatrixPosition(e.matrixWorld),t.position.copy(a),i.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(i),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Fh.prototype=Object.assign(Object.create(Ih.prototype),{constructor:Fh,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,n=2*qn.RAD2DEG*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),Ih.prototype.updateMatrices.call(this,e)}}),Nh.prototype=Object.assign(Object.create(Rh.prototype),{constructor:Nh,isSpotLight:!0,copy:function(e){return Rh.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),zh.prototype=Object.assign(Object.create(Ih.prototype),{constructor:zh,isPointLightShadow:!0,updateMatrices:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,r=this.matrix,i=this._lightPositionWorld,a=this._lookTarget,o=this._projScreenMatrix;i.setFromMatrixPosition(e.matrixWorld),n.position.copy(i),a.copy(n.position),a.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(a),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),o.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}}),Uh.prototype=Object.assign(Object.create(Rh.prototype),{constructor:Uh,isPointLight:!0,copy:function(e){return Rh.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Hh.prototype=Object.assign(Object.create(Ba.prototype),{constructor:Hh,isOrthographicCamera:!0,copy:function(e,t){return Ba.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-e,a=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(i+=l*this.view.offsetX)+l*this.view.width,s=(o-=u*this.view.offsetY)-u*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){var t=oi.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),jh.prototype=Object.assign(Object.create(Ih.prototype),{constructor:jh,isDirectionalLightShadow:!0,updateMatrices:function(e){Ih.prototype.updateMatrices.call(this,e)}}),Gh.prototype=Object.assign(Object.create(Rh.prototype),{constructor:Gh,isDirectionalLight:!0,copy:function(e){return Rh.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Vh.prototype=Object.assign(Object.create(Rh.prototype),{constructor:Vh,isAmbientLight:!0}),Wh.prototype=Object.assign(Object.create(Rh.prototype),{constructor:Wh,isRectAreaLight:!0,copy:function(e){return Rh.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Rh.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});var Xh=function(){function e(){(0,v.default)(this,e),Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new sr)}return(0,g.default)(e,[{key:"set",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}},{key:"zero",value:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}},{key:"getAt",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*i),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*r*1.092548),t.addScaledVector(a[5],r*i*1.092548),t.addScaledVector(a[6],.315392*(3*i*i-1)),t.addScaledVector(a[7],n*i*1.092548),t.addScaledVector(a[8],.546274*(n*n-r*r)),t}},{key:"getIrradianceAt",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*r),t.addScaledVector(a[2],1.023328*i),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*r),t.addScaledVector(a[5],.858086*r*i),t.addScaledVector(a[6],.743125*i*i-.247708),t.addScaledVector(a[7],.858086*n*i),t.addScaledVector(a[8],.429043*(n*n-r*r)),t}},{key:"add",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}},{key:"addScaledSH",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}},{key:"scale",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}},{key:"lerp",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}},{key:"equals",value:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}},{key:"copy",value:function(e){return this.set(e.coefficients)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}}],[{key:"getBasisAt",value:function(e,t){var n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}])}();function Yh(e,t){Rh.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==e?e:new Xh}function Jh(e){nh.call(this,e),this.textures={}}Yh.prototype=Object.assign(Object.create(Rh.prototype),{constructor:Yh,isLightProbe:!0,copy:function(e){return Rh.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){var t=Rh.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}}),Jh.prototype=Object.assign(Object.create(nh.prototype),{constructor:Jh,load:function(e,t,n,r){var i=this,a=new ih(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r&&r(t),i.manager.itemError(e)}}),n,r)},parse:function(e){var t=this.textures;function n(e){return t[e],t[e]}var r=new Fc[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=(new Ei).setHex(e.sheen)),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(r.morphNormals=e.morphNormals),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.vertexTangents&&(r.vertexTangents=e.vertexTangents),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(var i in e.uniforms){var a=e.uniforms[i];switch(r.uniforms[i]={},a.type){case"t":r.uniforms[i].value=n(a.value);break;case"c":r.uniforms[i].value=(new Ei).setHex(a.value);break;case"v2":r.uniforms[i].value=(new Kn).fromArray(a.value);break;case"v3":r.uniforms[i].value=(new sr).fromArray(a.value);break;case"v4":r.uniforms[i].value=(new rr).fromArray(a.value);break;case"m3":r.uniforms[i].value=(new Zn).fromArray(a.value);break;case"m4":r.uniforms[i].value=(new Or).fromArray(a.value);break;default:r.uniforms[i].value=a.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var o in e.extensions)r.extensions[o]=e.extensions[o];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),r.normalScale=(new Kn).fromArray(s)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Kn).fromArray(e.clearcoatNormalScale)),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),r},setTextures:function(e){return this.textures=e,this}});var Qh={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function qh(){ra.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function Kh(e,t,n,r){"number"==typeof n&&(r=n,n=!1),Oi.call(this,e,t,n),this.meshPerAttribute=r||1}function Zh(e){nh.call(this,e)}qh.prototype=Object.assign(Object.create(ra.prototype),{constructor:qh,isInstancedBufferGeometry:!0,copy:function(e){return ra.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=ra.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),Kh.prototype=Object.assign(Object.create(Oi.prototype),{constructor:Kh,isInstancedBufferAttribute:!0,copy:function(e){return Oi.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=Oi.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Zh.prototype=Object.assign(Object.create(nh.prototype),{constructor:Zh,load:function(e,t,n,r){var i=this,a=new ih(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r&&r(t),i.manager.itemError(e)}}),n,r)},parse:function(e){var t={},n={};function r(e,r){if(void 0!==t[r])return t[r];var i=e.interleavedBuffers[r],a=function(e,t){if(void 0!==n[t])return n[t];var r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}(e,i.buffer),o=new nl(Qi(i.type,a),i.stride);return o.uuid=i.uuid,t[r]=o,o}var i=e.isInstancedBufferGeometry?new qh:new ra,a=e.data.index;if(void 0!==a){var o=Qi(a.type,a.array);i.setIndex(new Oi(o,1))}var s=e.data.attributes;for(var l in s){var u=s[l],c=void 0;if(u.isInterleavedBufferAttribute)c=new al(r(e.data,u.data),u.itemSize,u.offset,u.normalized);else{var h=Qi(u.type,u.array);c=new(u.isInstancedBufferAttribute?Kh:Oi)(h,u.itemSize,u.normalized)}void 0!==u.name&&(c.name=u.name),i.setAttribute(l,c)}var d=e.data.morphAttributes;if(d)for(var p in d){for(var f=d[p],m=[],v=0,g=f.length;v<g;v++){var y=f[v],x=void 0;x=y.isInterleavedBufferAttribute?new al(r(e.data,y.data),y.itemSize,y.offset,y.normalized):new Oi(Qi(y.type,y.array),y.itemSize,y.normalized),void 0!==y.name&&(x.name=y.name),m.push(x)}i.morphAttributes[p]=m}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);var b=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==b)for(var M=0,w=b.length;M!==w;++M){var _=b[M];i.addGroup(_.start,_.count,_.materialIndex)}var A=e.data.boundingSphere;if(void 0!==A){var C=new sr;void 0!==A.center&&C.fromArray(A.center),i.boundingSphere=new Tr(C,A.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}});var $h,ed=function(e){function t(e){return(0,v.default)(this,t),T(this,t,[e])}return(0,m.default)(t,e),(0,g.default)(t,[{key:"load",value:function(e,t,n,r){var i=this,a=""===this.path?Qh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;var o=new ih(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(e){var n=null;try{n=JSON.parse(e)}catch(e){return void(void 0!==r&&r(e))}var a=n.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()&&i.parse(n,t)}),n,r)}},{key:"parse",value:function(e,t){var n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),a=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),o=this.parseTextures(e.textures,a),s=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,i,s,n),u=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,u),void 0!==t){var c=!1;for(var h in a)if(a[h]instanceof HTMLImageElement){c=!0;break}!1===c&&t(l)}return l}},{key:"parseShapes",value:function(e){var t={};if(void 0!==e)for(var n=0,r=e.length;n<r;n++){var i=(new kh).fromJSON(e[n]);t[i.uuid]=i}return t}},{key:"parseSkeletons",value:function(e,t){var n={},r={};if(t.traverse((function(e){e.isBone&&(r[e.uuid]=e)})),void 0!==e)for(var i=0,a=e.length;i<a;i++){var o=(new El).fromJSON(e[i],r);n[o.uuid]=o}return n}},{key:"parseGeometries",value:function(e,t){var n,r={};if(void 0!==e)for(var i=new Zh,a=0,o=e.length;a<o;a++){var s=void 0,l=e[a];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new Tc[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new Tc[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new Tc[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new Tc[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new Tc[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new Tc[l.type](l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new Tc[l.type](l.radius,l.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new Tc[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new Tc[l.type](l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new Tc[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case"TubeGeometry":case"TubeBufferGeometry":s=new Tc[l.type]((new Ph[l.path.type]).fromJSON(l.path),l.tubularSegments,l.radius,l.radialSegments,l.closed);break;case"LatheGeometry":case"LatheBufferGeometry":s=new Tc[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new Tc[l.type](l.vertices,l.indices,l.radius,l.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":n=[];for(var u=0,c=l.shapes.length;u<c;u++){var h=t[l.shapes[u]];n.push(h)}s=new Tc[l.type](n,l.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":n=[];for(var d=0,p=l.shapes.length;d<p;d++){var f=t[l.shapes[d]];n.push(f)}var m=l.options.extrudePath;void 0!==m&&(l.options.extrudePath=(new Ph[m.type]).fromJSON(m)),s=new Tc[l.type](n,l.options);break;case"BufferGeometry":case"InstancedBufferGeometry":s=i.parse(l);break;case"Geometry":break;default:continue}s.uuid=l.uuid,void 0!==l.name&&(s.name=l.name),!0===s.isBufferGeometry&&void 0!==l.userData&&(s.userData=l.userData),r[l.uuid]=s}return r}},{key:"parseMaterials",value:function(e,t){var n={},r={};if(void 0!==e){var i=new Jh;i.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=e[a];if("MultiMaterial"===s.type){for(var l=[],u=0;u<s.materials.length;u++){var c=s.materials[u];void 0===n[c.uuid]&&(n[c.uuid]=i.parse(c)),l.push(n[c.uuid])}r[s.uuid]=l}else void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r}},{key:"parseAnimations",value:function(e){var t={};if(void 0!==e)for(var n=0;n<e.length;n++){var r=e[n],i=Kc.parse(r);t[i.uuid]=i}return t}},{key:"parseImages",value:function(e,t){var n,r=this,i={};function a(e){if("string"==typeof e){var t=e;return function(e){return r.manager.itemStart(e),n.load(e,(function(){r.manager.itemEnd(e)}),void 0,(function(){r.manager.itemError(e),r.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:r.resourcePath+t)}return e.data?{data:Qi(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){var o=new eh(t);(n=new sh(o)).setCrossOrigin(this.crossOrigin);for(var s=0,l=e.length;s<l;s++){var u=e[s],c=u.url;if(Array.isArray(c)){i[u.uuid]=[];for(var h=0,d=c.length;h<d;h++){var p=a(c[h]);null!==p&&(p instanceof HTMLImageElement?i[u.uuid].push(p):i[u.uuid].push(new Na(p.data,p.width,p.height)))}}else{var f=a(u.url);null!==f&&(i[u.uuid]=f)}}}return i}},{key:"parseTextures",value:function(e,t){function n(e,t){return"number"==typeof e?e:t[e]}var r={};if(void 0!==e)for(var i=0,a=e.length;i<a;i++){var o=e[i],s=void 0;o.image,t[o.image];var l=t[o.image];Array.isArray(l)?(s=new Ia(l),6===l.length&&(s.needsUpdate=!0)):(s=l&&l.data?new Na(l.data,l.width,l.height):new tr(l),l&&(s.needsUpdate=!0)),s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.mapping&&(s.mapping=n(o.mapping,td)),void 0!==o.offset&&s.offset.fromArray(o.offset),void 0!==o.repeat&&s.repeat.fromArray(o.repeat),void 0!==o.center&&s.center.fromArray(o.center),void 0!==o.rotation&&(s.rotation=o.rotation),void 0!==o.wrap&&(s.wrapS=n(o.wrap[0],nd),s.wrapT=n(o.wrap[1],nd)),void 0!==o.format&&(s.format=o.format),void 0!==o.type&&(s.type=o.type),void 0!==o.encoding&&(s.encoding=o.encoding),void 0!==o.minFilter&&(s.minFilter=n(o.minFilter,rd)),void 0!==o.magFilter&&(s.magFilter=n(o.magFilter,rd)),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),void 0!==o.flipY&&(s.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(s.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(s.unpackAlignment=o.unpackAlignment),r[o.uuid]=s}return r}},{key:"parseObject",value:function(e,t,n,r){var i,a,o;function s(e){return t[e],t[e]}function l(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,i=e.length;r<i;r++){var a=e[r];n[a],t.push(n[a])}return t}return n[e],n[e]}}switch(e.type){case"Scene":i=new tl,void 0!==e.background&&Number.isInteger(e.background)&&(i.background=new Ei(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new el(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new $s(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new Da(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new Hh(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new Vh(e.color,e.intensity);break;case"DirectionalLight":i=new Gh(e.color,e.intensity);break;case"PointLight":i=new Uh(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new Wh(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new Nh(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new Oh(e.color,e.groundColor,e.intensity);break;case"LightProbe":i=(new Yh).fromJSON(e);break;case"SkinnedMesh":i=new Al(a=s(e.geometry),o=l(e.material)),void 0!==e.bindMode&&(i.bindMode=e.bindMode),void 0!==e.bindMatrix&&i.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(i.skeleton=e.skeleton);break;case"Mesh":i=new Ma(a=s(e.geometry),o=l(e.material));break;case"InstancedMesh":a=s(e.geometry),o=l(e.material);var u=e.count,c=e.instanceMatrix;(i=new kl(a,o,u)).instanceMatrix=new Oi(new Float32Array(c.array),16);break;case"LOD":i=new _l;break;case"Line":i=new Ul(s(e.geometry),l(e.material),e.mode);break;case"LineLoop":i=new Vl(s(e.geometry),l(e.material));break;case"LineSegments":i=new Gl(s(e.geometry),l(e.material));break;case"PointCloud":case"Points":i=new ql(s(e.geometry),l(e.material));break;case"Sprite":i=new xl(l(e.material));break;case"Group":i=new Ys;break;case"Bone":i=new Cl;break;default:i=new oi}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(i.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children)for(var h=e.children,d=0;d<h.length;d++)i.add(this.parseObject(h[d],t,n,r));if(void 0!==e.animations)for(var p=e.animations,f=0;f<p.length;f++){var m=p[f];i.animations.push(r[m])}if("LOD"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);for(var v=e.levels,g=0;g<v.length;g++){var y=v[g],x=i.getObjectByProperty("uuid",y.object);void 0!==x&&i.addLevel(x,y.distance)}}return i}},{key:"bindSkeletons",value:function(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){var n=t[e.skeleton];void 0===n||e.bind(n,e.bindMatrix)}}))}},{key:"setTexturePath",value:function(e){return this.setResourcePath(e)}}])}(nh),td={UVMapping:pe,CubeReflectionMapping:fe,CubeRefractionMapping:me,EquirectangularReflectionMapping:ve,EquirectangularRefractionMapping:ge,CubeUVReflectionMapping:ye,CubeUVRefractionMapping:xe},nd={RepeatWrapping:be,ClampToEdgeWrapping:Me,MirroredRepeatWrapping:we},rd={NearestFilter:_e,NearestMipmapNearestFilter:Ae,NearestMipmapLinearFilter:Te,LinearFilter:Ee,LinearMipmapNearestFilter:Le,LinearMipmapLinearFilter:Be};function id(e){nh.call(this,e),this.options={premultiplyAlpha:"none"}}function ad(){this.type="ShapePath",this.color=new Ei,this.subPaths=[],this.currentPath=null}function od(e){this.type="Font",this.data=e}function sd(e,t,n,r,i){var a=i.glyphs[e]||i.glyphs["?"];if(a){var o,s,l,u,c,h,d,p,f=new ad;if(a.o)for(var m=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),v=0,g=m.length;v<g;)switch(m[v++]){case"m":o=m[v++]*t+n,s=m[v++]*t+r,f.moveTo(o,s);break;case"l":o=m[v++]*t+n,s=m[v++]*t+r,f.lineTo(o,s);break;case"q":l=m[v++]*t+n,u=m[v++]*t+r,c=m[v++]*t+n,h=m[v++]*t+r,f.quadraticCurveTo(c,h,l,u);break;case"b":l=m[v++]*t+n,u=m[v++]*t+r,c=m[v++]*t+n,h=m[v++]*t+r,d=m[v++]*t+n,p=m[v++]*t+r,f.bezierCurveTo(c,h,d,p,l,u)}return{offsetX:a.ha*t,path:f}}}function ld(e){nh.call(this,e)}id.prototype=Object.assign(Object.create(nh.prototype),{constructor:id,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=$c.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;var o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,i.options)})).then((function(n){$c.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}),Object.assign(ad.prototype,{moveTo:function(e,t){return this.currentPath=new Dh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this},bezierCurveTo:function(e,t,n,r,i,a){return this.currentPath.bezierCurveTo(e,t,n,r,i,a),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n],a=new kh;a.curves=i.curves,t.push(a)}return t}function r(e,t){for(var n=t.length,r=!1,i=n-1,a=0;a<n;i=a++){var o=t[i],s=t[a],l=s.x-o.x,u=s.y-o.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(o=t[a],l=-l,s=t[i],u=-u),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var c=u*(e.x-o.x)-l*(e.y-o.y);if(0===c)return!0;if(c<0)continue;r=!r}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return r}var i,a,o,s=Yu.isClockWise,l=this.subPaths;if(0===l.length)return[];if(!0===t)return n(l);var u=[];if(1===l.length)return a=l[0],(o=new kh).curves=a.curves,u.push(o),u;var c=!s(l[0].getPoints());c=e?!c:c;var h,d,p=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=l.length;g<y;g++)i=s(h=(a=l[g]).getPoints()),(i=e?!i:i)?(!c&&f[v]&&v++,f[v]={s:new kh,p:h},f[v].s.curves=a.curves,c&&v++,m[v]=[]):m[v].push({h:a,p:h[0]});if(!f[0])return n(l);if(f.length>1){for(var x=!1,b=[],M=0,w=f.length;M<w;M++)p[M]=[];for(var _=0,A=f.length;_<A;_++)for(var C=m[_],T=0;T<C.length;T++){for(var S=C[T],E=!0,L=0;L<f.length;L++)r(S.p,f[L].p)&&(_!==L&&b.push({froms:_,tos:L,hole:T}),E?(E=!1,p[L].push(S)):x=!0);E&&p[_].push(S)}b.length>0&&(x||(m=p))}for(var P=0,B=f.length;P<B;P++){o=f[P].s,u.push(o);for(var D=0,k=(d=m[P]).length;D<k;D++)o.holes.push(d[D].h)}return u}}),Object.assign(od.prototype,{isFont:!0,generateShapes:function(e){for(var t=[],n=function(e,t,n){for(var r=Array.from?Array.from(e):String(e).split(""),i=t/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,o=[],s=0,l=0,u=0;u<r.length;u++){var c=r[u];if("\n"===c)s=0,l-=a;else{var h=sd(c,i,s,l,n);s+=h.offsetX,o.push(h.path)}}return o}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,this.data),r=0,i=n.length;r<i;r++)Array.prototype.push.apply(t,n[r].toShapes());return t}}),ld.prototype=Object.assign(Object.create(nh.prototype),{constructor:ld,load:function(e,t,n,r){var i=this,a=new ih(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(e){var n;try{n=JSON.parse(e)}catch(t){n=JSON.parse(e.substring(65,e.length-2))}var r=i.parse(n);t&&t(r)}),n,r)},parse:function(e){return new od(e)}});var ud={getContext:function(){return void 0===$h&&($h=new(window.AudioContext||window.webkitAudioContext)),$h},setContext:function(e){$h=e}};function cd(e){nh.call(this,e)}function hd(e,t,n){Yh.call(this,void 0,n);var r=(new Ei).set(e),i=(new Ei).set(t),a=new sr(r.r,r.g,r.b),o=new sr(i.r,i.g,i.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}function dd(e,t){Yh.call(this,void 0,t);var n=(new Ei).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}cd.prototype=Object.assign(Object.create(nh.prototype),{constructor:cd,load:function(e,t,n,r){var i=this,a=new ih(i.manager);a.setResponseType("arraybuffer"),a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{var a=n.slice(0);ud.getContext().decodeAudioData(a,(function(e){t(e)}))}catch(t){r&&r(t),i.manager.itemError(e)}}),n,r)}}),hd.prototype=Object.assign(Object.create(Yh.prototype),{constructor:hd,isHemisphereLightProbe:!0,copy:function(e){return Yh.prototype.copy.call(this,e),this},toJSON:function(e){return Yh.prototype.toJSON.call(this,e)}}),dd.prototype=Object.assign(Object.create(Yh.prototype),{constructor:dd,isAmbientLightProbe:!0,copy:function(e){return Yh.prototype.copy.call(this,e),this},toJSON:function(e){return Yh.prototype.toJSON.call(this,e)}});var pd=new Or,fd=new Or;function md(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Da,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Da,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(md.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var n,r,i=e.projectionMatrix.clone(),a=t.eyeSep/2,o=a*t.near/t.focus,s=t.near*Math.tan(qn.DEG2RAD*t.fov*.5)/t.zoom;fd.elements[12]=-a,pd.elements[12]=a,n=-s*t.aspect+o,r=s*t.aspect+o,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraL.projectionMatrix.copy(i),n=-s*t.aspect-o,r=s*t.aspect-o,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(fd),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(pd)}});var vd=function(){function e(t){(0,v.default)(this,e),this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return(0,g.default)(e,[{key:"start",value:function(){this.startTime=gd(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=gd();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}])}();function gd(){return("undefined"==typeof performance?Date:performance).now()}var yd=new sr,xd=new or,bd=new sr,Md=new sr,wd=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).type="AudioListener",e.context=ud.getContext(),e.gain=e.context.createGain(),e.gain.connect(e.context.destination),e.filter=null,e.timeDelta=0,e._clock=new vd,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"getInput",value:function(){return this.gain}},{key:"removeFilter",value:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}},{key:"getFilter",value:function(){return this.filter}},{key:"setFilter",value:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}},{key:"getMasterVolume",value:function(){return this.gain.gain.value}},{key:"setMasterVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}},{key:"updateMatrixWorld",value:function(e){C(t,"updateMatrixWorld",this,3)([e]);var n=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(yd,xd,bd),Md.set(0,0,-1).applyQuaternion(xd),n.positionX){var i=this.context.currentTime+this.timeDelta;n.positionX.linearRampToValueAtTime(yd.x,i),n.positionY.linearRampToValueAtTime(yd.y,i),n.positionZ.linearRampToValueAtTime(yd.z,i),n.forwardX.linearRampToValueAtTime(Md.x,i),n.forwardY.linearRampToValueAtTime(Md.y,i),n.forwardZ.linearRampToValueAtTime(Md.z,i),n.upX.linearRampToValueAtTime(r.x,i),n.upY.linearRampToValueAtTime(r.y,i),n.upZ.linearRampToValueAtTime(r.z,i)}else n.setPosition(yd.x,yd.y,yd.z),n.setOrientation(Md.x,Md.y,Md.z,r.x,r.y,r.z)}}])}(oi),_d=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t)).type="Audio",n.listener=e,n.context=e.context,n.gain=n.context.createGain(),n.gain.connect(e.getInput()),n.autoplay=!1,n.buffer=null,n.detune=0,n.loop=!1,n.loopStart=0,n.loopEnd=0,n.offset=0,n.duration=void 0,n.playbackRate=1,n.isPlaying=!1,n.hasPlaybackControl=!0,n.source=null,n.sourceType="empty",n._startedAt=0,n._progress=0,n._connected=!1,n.filters=[],n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"getOutput",value:function(){return this.gain}},{key:"setNodeSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}},{key:"setMediaElementSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}},{key:"setMediaStreamSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}},{key:"setBuffer",value:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0!==this.isPlaying&&!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}}},{key:"pause",value:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}},{key:"stop",value:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}},{key:"connect",value:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}},{key:"disconnect",value:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}},{key:"getFilters",value:function(){return this.filters}},{key:"setFilters",value:function(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}},{key:"setDetune",value:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}},{key:"getDetune",value:function(){return this.detune}},{key:"getFilter",value:function(){return this.getFilters()[0]}},{key:"setFilter",value:function(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"onEnded",value:function(){this.isPlaying=!1}},{key:"getLoop",value:function(){return!1!==this.hasPlaybackControl&&this.loop}},{key:"setLoop",value:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this}},{key:"setLoopStart",value:function(e){return this.loopStart=e,this}},{key:"setLoopEnd",value:function(e){return this.loopEnd=e,this}},{key:"getVolume",value:function(){return this.gain.gain.value}},{key:"setVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}])}(oi),Ad=new sr,Cd=new or,Td=new sr,Sd=new sr,Ed=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t,[e])).panner=n.context.createPanner(),n.panner.panningModel="HRTF",n.panner.connect(n.gain),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"getOutput",value:function(){return this.panner}},{key:"getRefDistance",value:function(){return this.panner.refDistance}},{key:"setRefDistance",value:function(e){return this.panner.refDistance=e,this}},{key:"getRolloffFactor",value:function(){return this.panner.rolloffFactor}},{key:"setRolloffFactor",value:function(e){return this.panner.rolloffFactor=e,this}},{key:"getDistanceModel",value:function(){return this.panner.distanceModel}},{key:"setDistanceModel",value:function(e){return this.panner.distanceModel=e,this}},{key:"getMaxDistance",value:function(){return this.panner.maxDistance}},{key:"setMaxDistance",value:function(e){return this.panner.maxDistance=e,this}},{key:"setDirectionalCone",value:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}},{key:"updateMatrixWorld",value:function(e){if(C(t,"updateMatrixWorld",this,3)([e]),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Ad,Cd,Td),Sd.set(0,0,1).applyQuaternion(Cd);var n=this.panner;if(n.positionX){var r=this.context.currentTime+this.listener.timeDelta;n.positionX.linearRampToValueAtTime(Ad.x,r),n.positionY.linearRampToValueAtTime(Ad.y,r),n.positionZ.linearRampToValueAtTime(Ad.z,r),n.orientationX.linearRampToValueAtTime(Sd.x,r),n.orientationY.linearRampToValueAtTime(Sd.y,r),n.orientationZ.linearRampToValueAtTime(Sd.z,r)}else n.setPosition(Ad.x,Ad.y,Ad.z),n.setOrientation(Sd.x,Sd.y,Sd.z)}}}])}(_d),Ld=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;(0,v.default)(this,e),this.analyser=t.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}return(0,g.default)(e,[{key:"getFrequencyData",value:function(){return this.analyser.getByteFrequencyData(this.data),this.data}},{key:"getAverageFrequency",value:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}])}();function Pd(e,t,n){var r,i,a;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(Pd.prototype,{accumulate:function(e,t){var n=this.buffer,r=this.valueSize,i=e*r+r,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==r;++o)n[i+o]=n[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(n,i,0,s,r)}this.cumulativeWeight=a},accumulateAdditive:function(e){var t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e},apply:function(e){var t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){var s=t*this._origIndex;this._mixBufferRegion(n,r,s,1-i,t)}a>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(var l=t,u=t+t;l!==u;++l)if(n[l]!==n[l+t]){o.setValue(n,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(var i=n,a=r;i!==a;++i)t[i]=t[r+i%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,n=e;n<t;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]},_select:function(e,t,n,r,i){if(r>=.5)for(var a=0;a!==i;++a)e[t+a]=e[n+a]},_slerp:function(e,t,n,r){or.slerpFlat(e,t,e,t,e,n,r)},_slerpAdditive:function(e,t,n,r,i){var a=this._workIndex*i;or.multiplyQuaternionsFlat(e,a,e,t,e,n),or.slerpFlat(e,t,e,t,e,a,r)},_lerp:function(e,t,n,r,i){for(var a=1-r,o=0;o!==i;++o){var s=t+o;e[s]=e[s]*a+e[n+o]*r}},_lerpAdditive:function(e,t,n,r,i){for(var a=0;a!==i;++a){var o=t+a;e[o]=e[o]+e[n+a]*r}}});var Bd="\\[\\]\\.:\\/",Dd=new RegExp("["+Bd+"]","g"),kd="[^"+Bd+"]",Rd="[^"+Bd.replace("\\.","")+"]",Od=/((?:WC+[\/:])*)/.source.replace("WC",kd),Id=/(WCOD+)?/.source.replace("WCOD",Rd),Fd=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",kd),Nd=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",kd),zd=new RegExp("^"+Od+Id+Fd+Nd+"$"),Ud=["material","materials","bones"];function Hd(e,t,n){var r=n||jd.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function jd(e,t,n){this.path=t,this.parsedPath=n||jd.parseTrackName(t),this.node=jd.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Gd(){this.uuid=qn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}Object.assign(Hd.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(jd,{Composite:Hd,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new jd.Composite(e,t,n):new jd(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Dd,"")},parseTrackName:function(e){var t=zd.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==Ud.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function(e){for(var n=0;n<e.length;n++){var i=e[n];if(i.name===t||i.uuid===t)return i;var a=r(i.children);if(a)return a}return null},i=r(e.children);if(i)return i}return null}}),Object.assign(jd.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)e[t++]=n[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,r=t.propertyName,i=t.propertyIndex;if(e||(e=jd.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var a=t.objectIndex;switch(n){case"materials":if(!e.material)return;if(!e.material.materials)return;e=e.material.materials;break;case"bones":if(!e.skeleton)return;e=e.skeleton.bones;for(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[n])return;e=e[n]}if(void 0!==a){if(void 0===e[a])return;e=e[a]}}var s=e[r];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return;if(!e.geometry.isBufferGeometry)return;if(!e.geometry.morphAttributes)return;void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}else t.nodeName}},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(jd.prototype,{_getValue_unbound:jd.prototype.getValue,_setValue_unbound:jd.prototype.setValue}),Object.assign(Gd.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,a=i.length,o=e.length,s=this.nCachedObjects_,l=0,u=arguments.length;l!==u;++l){var c=arguments[l],h=c.uuid,d=t[h];if(void 0===d){d=o++,t[h]=d,e.push(c);for(var p=0,f=a;p!==f;++p)i[p].push(new jd(c,n[p],r[p]))}else if(d<s){e[d];var m=--s,v=e[m];t[v.uuid]=d,e[d]=v,t[h]=m,e[m]=c;for(var g=0,y=a;g!==y;++g){var x=i[g],b=x[m],M=x[d];x[d]=b,void 0===M&&(M=new jd(c,n[g],r[g])),x[m]=M}}else e[d]}this.nCachedObjects_=s},remove:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length,i=this.nCachedObjects_,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,u=t[l];if(void 0!==u&&u>=i){var c=i++,h=e[c];t[h.uuid]=u,e[u]=h,t[l]=c,e[c]=s;for(var d=0,p=r;d!==p;++d){var f=n[d],m=f[c],v=f[u];f[u]=m,f[c]=v}}}this.nCachedObjects_=i},uncache:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length,i=this.nCachedObjects_,a=e.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o].uuid,u=t[l];if(void 0!==u)if(delete t[l],u<i){var c=--i,h=e[c],d=--a,p=e[d];t[h.uuid]=u,e[u]=h,t[p.uuid]=c,e[c]=p,e.pop();for(var f=0,m=r;f!==m;++f){var v=n[f],g=v[c],y=v[d];v[u]=g,v[c]=y,v.pop()}}else{var x=--a,b=e[x];x>0&&(t[b.uuid]=u),e[u]=b,e.pop();for(var M=0,w=r;M!==w;++M){var _=n[M];_[u]=_[x],_.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,r=n[e],i=this._bindings;if(void 0!==r)return i[r];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,u=this.nCachedObjects_,c=new Array(l);r=i.length,n[e]=r,a.push(e),o.push(t),i.push(c);for(var h=u,d=s.length;h!==d;++h){var p=s[h];c[h]=new jd(p,e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var r=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=n,a[n]=s,a.pop(),i[n]=i[o],i.pop(),r[n]=r[o],r.pop()}}});var Vd=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.blendMode;(0,v.default)(this,e),this._mixer=t,this._clip=n,this._localRoot=r,this.blendMode=i;for(var a=n.tracks,o=a.length,s=new Array(o),l={endingStart:Kt,endingEnd:Kt},u=0;u!==o;++u){var c=a[u].createInterpolant(null);s[u]=c,c.settings=l}this._interpolantSettings=l,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Xt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}return(0,g.default)(e,[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(e){return this._startTime=e,this}},{key:"setLoop",value:function(e,t){return this.loop=e,this.repetitions=t,this}},{key:"setEffectiveWeight",value:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var r=this._clip.duration,i=e._clip.duration,a=i/r,o=r/i;e.warp(1,a,t),this.warp(o,1,t)}return this}},{key:"crossFadeTo",value:function(e,t,n){return e.crossFadeFrom(this,t,n)}},{key:"stopFading",value:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"setEffectiveTimeScale",value:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}},{key:"syncWith",value:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}},{key:"halt",value:function(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function(e,t,n){var r=this._mixer,i=r.time,a=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=i,s[1]=i+n,l[0]=e/a,l[1]=t/a,this}},{key:"stopWarping",value:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(e,t,n,r){if(this.enabled){var i=this._startTime;if(null!==i){var a=(e-i)*n;if(a<0||0===n)return;this._startTime=null,t=n*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0){var l=this._interpolants,u=this._propertyBindings;if(this.blendMode===tn)for(var c=0,h=l.length;c!==h;++c)l[c].evaluate(o),u[c].accumulateAdditive(s);else for(var d=0,p=l.length;d!==p;++d)l[d].evaluate(o),u[d].accumulate(r,s)}}else this._updateWeight(e)}},{key:"_updateWeight",value:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}},{key:"_updateTimeScale",value:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}},{key:"_updateTime",value:function(e){var t=this._clip.duration,n=this.loop,r=this.time+e,i=this._loopCount,a=n===Yt;if(0===e)return-1===i||!a||1&~i?r:t-r;if(n===Wt){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),r>=t||r<0){var o=Math.floor(r/t);r-=t*o,i+=Math.abs(o);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=r;if(a&&!(1&~i))return t-r}return r}},{key:"_setEndings",value:function(e,t,n){var r=this._interpolantSettings;n?(r.endingStart=Zt,r.endingEnd=Zt):(r.endingStart=e?this.zeroSlopeAtStart?Zt:Kt:$t,r.endingEnd=t?this.zeroSlopeAtEnd?Zt:Kt:$t)}},{key:"_scheduleFading",value:function(e,t,n){var r=this._mixer,i=r.time,a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=t,o[1]=i+e,s[1]=n,this}}])}();function Wd(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Wd.prototype=Object.assign(Object.create(Wn.prototype),{constructor:Wd,_bindAction:function(e,t){var n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName,u=l[s];void 0===u&&(u={},l[s]=u);for(var c=0;c!==i;++c){var h=r[c],d=h.name,p=u[d];if(void 0!==p)a[c]=p;else{if(void 0!==(p=a[c])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,d));continue}var f=t&&t._propertyBindings[c].binding.parsedPath;++(p=new Pd(jd.create(n,d,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,s,d),a[c]=p}o[c].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}for(var i=e._propertyBindings,a=0,o=i.length;a!==o;++a){var s=i[a];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var r=this._actions,i=this._actionsByClip,a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,l=s[s.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_addInactiveBinding:function(e,t,n){var r=this._bindingsByRootAndName,i=this._bindings,a=r[t];void 0===a&&(a={},r[t]=a),a[n]=e,e._cacheIndex=i.length,i.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,a=this._bindingsByRootAndName,o=a[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[i],0===Object.keys(o).length&&delete a[r]},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new Hc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,n){var r=t||this._root,i=r.uuid,a="string"==typeof e?Kc.findByName(r,e):e,o=null!==a?a.uuid:e,s=this._actionsByClip[o],l=null;if(void 0===n&&(n=null!==a?a.blendMode:en),void 0!==s){var u=s.actionByRoot[i];if(void 0!==u&&u.blendMode===n)return u;l=s.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;var c=new Vd(this,a,t,n);return this._bindAction(c,l),this._addInactiveAction(c,o,i),c},existingAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"==typeof e?Kc.findByName(n,e):e,a=i?i.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[r]||null},stopAllAction:function(){for(var e=this._actions,t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1,o=0;o!==n;++o)t[o]._update(r,e,i,a);for(var s=this._bindings,l=this._nActiveBindings,u=0;u!==l;++u)s[u].apply(a);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(var a=i.knownActions,o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var u=l._cacheIndex,c=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,t[u]=c,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[n]}},uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}});var Xd=function(){function e(t){(0,v.default)(this,e),"string"==typeof t&&(t=arguments[1]),this.value=t}return(0,g.default)(e,[{key:"clone",value:function(){return new e(void 0===this.value.clone?this.value:this.value.clone())}}])}();function Yd(e,t,n){nl.call(this,e,t),this.meshPerAttribute=n||1}function Jd(e,t,n,r,i){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}function Qd(e,t,n,r){this.ray=new Rr(e,t),this.near=n||0,this.far=r||1/0,this.camera=null,this.layers=new Xr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return this.Points}}})}function qd(e,t){return e.distance-t.distance}function Kd(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r)for(var i=e.children,a=0,o=i.length;a<o;a++)Kd(i[a],t,n,!0)}Yd.prototype=Object.assign(Object.create(nl.prototype),{constructor:Yd,isInstancedInterleavedBuffer:!0,copy:function(e){return nl.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){var t=nl.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){var t=nl.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(Jd.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Jd.prototype,{isGLBufferAttribute:!0,setBuffer:function(e){return this.buffer=e,this},setType:function(e,t){return this.type=e,this.elementSize=t,this},setItemSize:function(e){return this.itemSize=e,this},setCount:function(e){return this.count=e,this}}),Object.assign(Qd.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera&&(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t)},intersectObject:function(e,t,n){var r=n||[];return Kd(e,this,r,t),r.sort(qd),r},intersectObjects:function(e,t,n){var r=n||[];if(!1===Array.isArray(e))return r;for(var i=0,a=e.length;i<a;i++)Kd(e[i],this,r,t);return r.sort(qd),r}});var Zd=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,v.default)(this,e),this.radius=t,this.phi=n,this.theta=r,this}return(0,g.default)(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"makeSafe",value:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(qn.clamp(t/this.radius,-1,1))),this}}])}(),$d=function(){function e(t,n,r){return(0,v.default)(this,e),this.radius=void 0!==t?t:1,this.theta=void 0!==n?n:0,this.y=void 0!==r?r:0,this}return(0,g.default)(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}}])}(),ep=new Kn,tp=function(){function e(t,n){(0,v.default)(this,e),Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==t?t:new Kn(1/0,1/0),this.max=void 0!==n?n:new Kn(-1/0,-1/0)}return(0,g.default)(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=ep.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(e){return void 0===e&&(e=new Kn),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return void 0===e&&(e=new Kn),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}},{key:"getParameter",value:function(e,t){return void 0===t&&(t=new Kn),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}},{key:"clampPoint",value:function(e,t){return void 0===t&&(t=new Kn),t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return ep.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}])}(),np=new sr,rp=new sr,ip=function(){function e(t,n){(0,v.default)(this,e),this.start=void 0!==t?t:new sr,this.end=void 0!==n?n:new sr}return(0,g.default)(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"getCenter",value:function(e){return void 0===e&&(e=new sr),e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return void 0===e&&(e=new sr),e.subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return void 0===t&&(t=new sr),this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){np.subVectors(e,this.start),rp.subVectors(this.end,this.start);var n=rp.dot(rp),r=rp.dot(np)/n;return t&&(r=qn.clamp(r,0,1)),r}},{key:"closestPointToPoint",value:function(e,t,n){var r=this.closestPointToPointParameter(e,t);return void 0===n&&(n=new sr),this.delta(n).multiplyScalar(r).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}])}();function ap(e){oi.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}ap.prototype=Object.create(oi.prototype),ap.prototype.constructor=ap,ap.prototype.isImmediateRenderObject=!0;var op=new sr,sp=function(e){function t(e,n){var r;(0,v.default)(this,t),(r=T(this,t)).light=e,r.light.updateMatrixWorld(),r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r.color=n;for(var i=new ra,a=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],o=0,s=1,l=32;o<l;o++,s++){var u=o/l*Math.PI*2,c=s/l*Math.PI*2;a.push(Math.cos(u),Math.sin(u),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new Vi(a,3));var h=new Rl({fog:!1,toneMapped:!1});return r.cone=new Gl(i,h),r.add(r.cone),r.update(),r}return(0,m.default)(t,e),(0,g.default)(t,[{key:"dispose",value:function(){this.cone.geometry.dispose(),this.cone.material.dispose()}},{key:"update",value:function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),op.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(op),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}])}(oi),lp=new sr,up=new Or,cp=new Or,hp=function(e){function t(e){var n;(0,v.default)(this,t);for(var r=dp(e),i=new ra,a=[],o=[],s=new Ei(0,0,1),l=new Ei(0,1,0),u=0;u<r.length;u++){var c=r[u];c.parent&&c.parent.isBone&&(a.push(0,0,0),a.push(0,0,0),o.push(s.r,s.g,s.b),o.push(l.r,l.g,l.b))}return i.setAttribute("position",new Vi(a,3)),i.setAttribute("color",new Vi(o,3)),(n=T(this,t,[i,new Rl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})])).type="SkeletonHelper",n.isSkeletonHelper=!0,n.root=e,n.bones=r,n.matrix=e.matrixWorld,n.matrixAutoUpdate=!1,n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"updateMatrixWorld",value:function(e){var n=this.bones,r=this.geometry,i=r.getAttribute("position");cp.copy(this.root.matrixWorld).invert();for(var a=0,o=0;a<n.length;a++){var s=n[a];s.parent&&s.parent.isBone&&(up.multiplyMatrices(cp,s.matrixWorld),lp.setFromMatrixPosition(up),i.setXYZ(o,lp.x,lp.y,lp.z),up.multiplyMatrices(cp,s.parent.matrixWorld),lp.setFromMatrixPosition(up),i.setXYZ(o+1,lp.x,lp.y,lp.z),o+=2)}r.getAttribute("position").needsUpdate=!0,C(t,"updateMatrixWorld",this,3)([e])}}])}(Gl);function dp(e){var t=[];e&&e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,dp(e.children[n]));return t}var pp=function(e){function t(e,n,r){var i;return(0,v.default)(this,t),(i=T(this,t,[new pc(n,4,2),new Di({wireframe:!0,fog:!1,toneMapped:!1})])).light=e,i.light.updateMatrixWorld(),i.color=r,i.type="PointLightHelper",i.matrix=i.light.matrixWorld,i.matrixAutoUpdate=!1,i.update(),i}return(0,m.default)(t,e),(0,g.default)(t,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"update",value:function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}])}(Ma),fp=new sr,mp=new Ei,vp=new Ei,gp=function(e){function t(e,n,r){var i;(0,v.default)(this,t),(i=T(this,t)).light=e,i.light.updateMatrixWorld(),i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i.color=r;var a=new rc(n);a.rotateY(.5*Math.PI),i.material=new Di({wireframe:!0,fog:!1,toneMapped:!1}),void 0===i.color&&(i.material.vertexColors=!0);var o=a.getAttribute("position"),s=new Float32Array(3*o.count);return a.setAttribute("color",new Oi(s,3)),i.add(new Ma(a,i.material)),i.update(),i}return(0,m.default)(t,e),(0,g.default)(t,[{key:"dispose",value:function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}},{key:"update",value:function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");mp.copy(this.light.color),vp.copy(this.light.groundColor);for(var n=0,r=t.count;n<r;n++){var i=n<r/2?mp:vp;t.setXYZ(n,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(fp.setFromMatrixPosition(this.light.matrixWorld).negate())}}])}(oi),yp=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;(0,v.default)(this,t),i=new Ei(i),a=new Ei(a);for(var o=r/2,s=n/r,l=n/2,u=[],c=[],h=0,d=0,p=-l;h<=r;h++,p+=s){u.push(-l,0,p,l,0,p),u.push(p,0,-l,p,0,l);var f=h===o?i:a;f.toArray(c,d),d+=3,f.toArray(c,d),d+=3,f.toArray(c,d),d+=3,f.toArray(c,d),d+=3}var m=new ra;return m.setAttribute("position",new Vi(u,3)),m.setAttribute("color",new Vi(c,3)),(e=T(this,t,[m,new Rl({vertexColors:!0,toneMapped:!1})])).type="GridHelper",e}return(0,m.default)(t,e),(0,g.default)(t)}(Gl),xp=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;(0,v.default)(this,t),o=new Ei(o),s=new Ei(s);for(var l=[],u=[],c=0;c<=r;c++){var h=c/r*(2*Math.PI),d=Math.sin(h)*n,p=Math.cos(h)*n;l.push(0,0,0),l.push(d,0,p);var f=1&c?o:s;u.push(f.r,f.g,f.b),u.push(f.r,f.g,f.b)}for(var m=0;m<=i;m++)for(var g=1&m?o:s,y=n-n/i*m,x=0;x<a;x++){var b=x/a*(2*Math.PI),M=Math.sin(b)*y,w=Math.cos(b)*y;l.push(M,0,w),u.push(g.r,g.g,g.b),b=(x+1)/a*(2*Math.PI),M=Math.sin(b)*y,w=Math.cos(b)*y,l.push(M,0,w),u.push(g.r,g.g,g.b)}var _=new ra;return _.setAttribute("position",new Vi(l,3)),_.setAttribute("color",new Vi(u,3)),(e=T(this,t,[_,new Rl({vertexColors:!0,toneMapped:!1})])).type="PolarGridHelper",e}return(0,m.default)(t,e),(0,g.default)(t)}(Gl),bp=new sr,Mp=new sr,wp=new sr,_p=function(e){function t(e,n,r){var i;(0,v.default)(this,t),(i=T(this,t)).light=e,i.light.updateMatrixWorld(),i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i.color=r,void 0===n&&(n=1);var a=new ra;a.setAttribute("position",new Vi([-n,n,0,n,n,0,n,-n,0,-n,-n,0,-n,n,0],3));var o=new Rl({fog:!1,toneMapped:!1});return i.lightPlane=new Ul(a,o),i.add(i.lightPlane),(a=new ra).setAttribute("position",new Vi([0,0,0,0,0,1],3)),i.targetLine=new Ul(a,o),i.add(i.targetLine),i.update(),i}return(0,m.default)(t,e),(0,g.default)(t,[{key:"dispose",value:function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}},{key:"update",value:function(){bp.setFromMatrixPosition(this.light.matrixWorld),Mp.setFromMatrixPosition(this.light.target.matrixWorld),wp.subVectors(Mp,bp),this.lightPlane.lookAt(Mp),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Mp),this.targetLine.scale.z=wp.length()}}])}(oi),Ap=new sr,Cp=new Ba,Tp=function(e){function t(e){var n;(0,v.default)(this,t);var r=new ra,i=new Rl({color:16777215,vertexColors:!0,toneMapped:!1}),a=[],o=[],s={},l=new Ei(16755200),u=new Ei(16711680),c=new Ei(43775),h=new Ei(16777215),d=new Ei(3355443);function p(e,t,n){f(e,n),f(t,n)}function f(e,t){a.push(0,0,0),o.push(t.r,t.g,t.b),void 0===s[e]&&(s[e]=[]),s[e].push(a.length/3-1)}return p("n1","n2",l),p("n2","n4",l),p("n4","n3",l),p("n3","n1",l),p("f1","f2",l),p("f2","f4",l),p("f4","f3",l),p("f3","f1",l),p("n1","f1",l),p("n2","f2",l),p("n3","f3",l),p("n4","f4",l),p("p","n1",u),p("p","n2",u),p("p","n3",u),p("p","n4",u),p("u1","u2",c),p("u2","u3",c),p("u3","u1",c),p("c","t",h),p("p","c",d),p("cn1","cn2",d),p("cn3","cn4",d),p("cf1","cf2",d),p("cf3","cf4",d),r.setAttribute("position",new Vi(a,3)),r.setAttribute("color",new Vi(o,3)),(n=T(this,t,[r,i])).type="CameraHelper",n.camera=e,n.camera.updateProjectionMatrix&&n.camera.updateProjectionMatrix(),n.matrix=e.matrixWorld,n.matrixAutoUpdate=!1,n.pointMap=s,n.update(),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"update",value:function(){var e=this.geometry,t=this.pointMap;Cp.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Sp("c",t,e,Cp,0,0,-1),Sp("t",t,e,Cp,0,0,1),Sp("n1",t,e,Cp,-1,-1,-1),Sp("n2",t,e,Cp,1,-1,-1),Sp("n3",t,e,Cp,-1,1,-1),Sp("n4",t,e,Cp,1,1,-1),Sp("f1",t,e,Cp,-1,-1,1),Sp("f2",t,e,Cp,1,-1,1),Sp("f3",t,e,Cp,-1,1,1),Sp("f4",t,e,Cp,1,1,1),Sp("u1",t,e,Cp,.7,1.1,-1),Sp("u2",t,e,Cp,-.7,1.1,-1),Sp("u3",t,e,Cp,0,2,-1),Sp("cf1",t,e,Cp,-1,0,1),Sp("cf2",t,e,Cp,1,0,1),Sp("cf3",t,e,Cp,0,-1,1),Sp("cf4",t,e,Cp,0,1,1),Sp("cn1",t,e,Cp,-1,0,-1),Sp("cn2",t,e,Cp,1,0,-1),Sp("cn3",t,e,Cp,0,-1,-1),Sp("cn4",t,e,Cp,0,1,-1),e.getAttribute("position").needsUpdate=!0}}])}(Gl);function Sp(e,t,n,r,i,a,o){Ap.set(i,a,o).unproject(r);var s=t[e];if(void 0!==s)for(var l=n.getAttribute("position"),u=0,c=s.length;u<c;u++)l.setXYZ(s[u],Ap.x,Ap.y,Ap.z)}var Ep,Lp,Pp=new cr,Bp=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;(0,v.default)(this,t);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),a=new Float32Array(24),o=new ra;return o.setIndex(new Oi(i,1)),o.setAttribute("position",new Oi(a,3)),(n=T(this,t,[o,new Rl({color:r,toneMapped:!1})])).object=e,n.type="BoxHelper",n.matrixAutoUpdate=!1,n.update(),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"update",value:function(e){if(void 0!==this.object&&Pp.setFromObject(this.object),!Pp.isEmpty()){var t=Pp.min,n=Pp.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}},{key:"setFromObject",value:function(e){return this.object=e,this.update(),this}},{key:"copy",value:function(e){return Gl.prototype.copy.call(this,e),this.object=e.object,this}}])}(Gl),Dp=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;(0,v.default)(this,t);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),a=new ra;return a.setIndex(new Oi(i,1)),a.setAttribute("position",new Vi([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),(n=T(this,t,[a,new Rl({color:r,toneMapped:!1})])).box=e,n.type="Box3Helper",n.geometry.computeBoundingSphere(),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"updateMatrixWorld",value:function(e){var n=this.box;n.isEmpty()||(n.getCenter(this.position),n.getSize(this.scale),this.scale.multiplyScalar(.5),C(t,"updateMatrixWorld",this,3)([e]))}}])}(Gl),kp=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960;(0,v.default)(this,t);var a=i,o=new ra;o.setAttribute("position",new Vi([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),o.computeBoundingSphere(),(n=T(this,t,[o,new Rl({color:a,toneMapped:!1})])).type="PlaneHelper",n.plane=e,n.size=r;var s=new ra;return s.setAttribute("position",new Vi([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),n.add(new Ma(s,new Di({color:a,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1}))),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"updateMatrixWorld",value:function(e){var n=-this.plane.constant;Math.abs(n)<1e-8&&(n=1e-8),this.scale.set(.5*this.size,.5*this.size,n),this.children[0].material.side=n<0?w:M,this.lookAt(this.plane.normal),C(t,"updateMatrixWorld",this,3)([e])}}])}(Ul),Rp=new sr,Op=function(e){function t(e,n,r,i,a,o){var s;return(0,v.default)(this,t),(s=T(this,t)).type="ArrowHelper",void 0===e&&(e=new sr(0,0,1)),void 0===n&&(n=new sr(0,0,0)),void 0===r&&(r=1),void 0===i&&(i=16776960),void 0===a&&(a=.2*r),void 0===o&&(o=.2*a),void 0===Ep&&((Ep=new ra).setAttribute("position",new Vi([0,0,0,0,1,0],3)),(Lp=new cu(0,.5,1,5,1)).translate(0,-.5,0)),s.position.copy(n),s.line=new Ul(Ep,new Rl({color:i,toneMapped:!1})),s.line.matrixAutoUpdate=!1,s.add(s.line),s.cone=new Ma(Lp,new Di({color:i,toneMapped:!1})),s.cone.matrixAutoUpdate=!1,s.add(s.cone),s.setDirection(e),s.setLength(r,a,o),s}return(0,m.default)(t,e),(0,g.default)(t,[{key:"setDirection",value:function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Rp.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Rp,t)}}},{key:"setLength",value:function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}},{key:"setColor",value:function(e){this.line.material.color.set(e),this.cone.material.color.set(e)}},{key:"copy",value:function(e){return C(t,"copy",this,3)([e,!1]),this.line.copy(e.line),this.cone.copy(e.cone),this}}])}(oi),Ip=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;(0,v.default)(this,t);var r=[0,0,0,n,0,0,0,0,0,0,n,0,0,0,0,0,0,n],i=new ra;return i.setAttribute("position",new Vi(r,3)),i.setAttribute("color",new Vi([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),(e=T(this,t,[i,new Rl({vertexColors:!0,toneMapped:!1})])).type="AxesHelper",e}return(0,m.default)(t,e),(0,g.default)(t)}(Gl),Fp=new Float32Array(1),Np=new Int32Array(Fp.buffer),zp={toHalfFloat:function(e){Fp[0]=e;var t=Np[0],n=t>>16&32768,r=t>>12&2047,i=t>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&t):i<113?n|=((r|=2048)>>114-i)+(r>>113-i&1):(n|=i-112<<10|r>>1,n+=1&r)}},Up=Math.pow(2,8),Hp=[.125,.215,.35,.446,.526,.582],jp=5+Hp.length,Gp=(0,d.default)((0,d.default)((0,d.default)((0,d.default)((0,d.default)((0,d.default)((0,d.default)({},on,0),sn,1),un,2),hn,3),dn,4),pn,5),ln,6),Vp=new Hh,Wp=tf(),Xp=Wp._lodPlanes,Yp=Wp._sizeLods,Jp=Wp._sigmas,Qp=null,qp=(1+Math.sqrt(5))/2,Kp=1/qp,Zp=[new sr(1,1,1),new sr(-1,1,1),new sr(1,1,-1),new sr(-1,1,-1),new sr(0,qp,Kp),new sr(0,qp,-Kp),new sr(Kp,0,qp),new sr(-Kp,0,qp),new sr(qp,Kp,0),new sr(-qp,Kp,0)],$p=function(){function e(t){(0,v.default)(this,e),this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(e){return new Ec({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(e)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new sr(0,1,0)},inputEncoding:{value:Gp[on]},outputEncoding:{value:Gp[on]}},vertexShader:sf(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t".concat(lf(),"\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:E,depthTest:!1,depthWrite:!1})}(20),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}return(0,g.default)(e,[{key:"fromScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;Qp=this._renderer.getRenderTarget();var i=this._allocateTargets();return this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}},{key:"fromEquirectangular",value:function(e){return this._fromTexture(e)}},{key:"fromCubemap",value:function(e){return this._fromTexture(e)}},{key:"compileCubemapShader",value:function(){null===this._cubemapShader&&(this._cubemapShader=of(),this._compileMaterial(this._cubemapShader))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectShader&&(this._equirectShader=af(),this._compileMaterial(this._equirectShader))}},{key:"dispose",value:function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var e=0;e<Xp.length;e++)Xp[e].dispose()}},{key:"_cleanup",value:function(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Qp),e.scissorTest=!1,rf(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function(e){Qp=this._renderer.getRenderTarget();var t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}},{key:"_allocateTargets",value:function(e){var t={magFilter:_e,minFilter:_e,generateMipmaps:!1,type:ke,format:qe,encoding:ef(e)?e.encoding:un,depthBuffer:!1},n=nf(t);return n.depthBuffer=!e,this._pingPongRenderTarget=nf(t),n}},{key:"_compileMaterial",value:function(e){var t=new Ma(Xp[0],e);this._renderer.compile(t,Vp)}},{key:"_sceneToCubeUV",value:function(e,t,n,r){var i=new Da(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.outputEncoding,u=s.toneMapping,c=s.getClearColor(),h=s.getClearAlpha();s.toneMapping=se,s.outputEncoding=on;var d=e.background;if(d&&d.isColor){d.convertSRGBToLinear();var p=Math.max(d.r,d.g,d.b),f=Math.min(Math.max(Math.ceil(Math.log2(p)),-128),127);d=d.multiplyScalar(Math.pow(2,-f));var m=(f+128)/255;s.setClearColor(d,m),e.background=null}for(var v=0;v<6;v++){var g=v%3;0==g?(i.up.set(0,a[v],0),i.lookAt(o[v],0,0)):1==g?(i.up.set(0,0,a[v]),i.lookAt(0,o[v],0)):(i.up.set(0,a[v],0),i.lookAt(0,0,o[v])),rf(r,g*Up,v>2?Up:0,Up,Up),s.setRenderTarget(r),s.render(e,i)}s.toneMapping=u,s.outputEncoding=l,s.setClearColor(c,h)}},{key:"_textureToCubeUV",value:function(e,t){var n=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=of()):null==this._equirectShader&&(this._equirectShader=af());var r=e.isCubeTexture?this._cubemapShader:this._equirectShader,i=new Ma(Xp[0],r),a=r.uniforms;a.envMap.value=e,e.isCubeTexture||a.texelSize.value.set(1/e.image.width,1/e.image.height),a.inputEncoding.value=Gp[e.encoding],a.outputEncoding.value=Gp[t.texture.encoding],rf(t,0,0,3*Up,2*Up),n.setRenderTarget(t),n.render(i,Vp)}},{key:"_applyPMREM",value:function(e){var t=this._renderer,n=t.autoClear;t.autoClear=!1;for(var r=1;r<jp;r++){var i=Math.sqrt(Jp[r]*Jp[r]-Jp[r-1]*Jp[r-1]),a=Zp[(r-1)%Zp.length];this._blur(e,r-1,r,i,a)}t.autoClear=n}},{key:"_blur",value:function(e,t,n,r,i){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),this._halfBlur(a,e,n,n,r,"longitudinal",i)}},{key:"_halfBlur",value:function(e,t,n,r,i,a,o){for(var s=this._renderer,l=this._blurMaterial,u=new Ma(Xp[r],l),c=l.uniforms,h=Yp[n]-1,d=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,p=i/d,f=isFinite(i)?1+Math.floor(3*p):20,m=[],v=0,g=0;g<20;++g){var y=g/p,x=Math.exp(-y*y/2);m.push(x),0==g?v+=x:g<f&&(v+=2*x)}for(var b=0;b<m.length;b++)m[b]=m[b]/v;c.envMap.value=e.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o),c.dTheta.value=d,c.mipInt.value=8-n,c.inputEncoding.value=Gp[e.texture.encoding],c.outputEncoding.value=Gp[e.texture.encoding];var M=Yp[r];rf(t,3*Math.max(0,Up-2*M),(0===r?0:2*Up)+2*M*(r>4?r-8+4:0),3*M,2*M),s.setRenderTarget(t),s.render(u,Vp)}}])}();function ef(e){return void 0!==e&&e.type===ke&&(e.encoding===on||e.encoding===sn||e.encoding===ln)}function tf(){for(var e=[],t=[],n=[],r=8,i=0;i<jp;i++){var a=Math.pow(2,r);t.push(a);var o=1/a;i>4?o=Hp[i-8+4-1]:0==i&&(o=0),n.push(o);for(var s=1/(a-1),l=-s/2,u=1+s/2,c=[l,l,u,l,u,u,l,l,u,u,l,u],h=6,d=6,p=3,f=2,m=1,v=new Float32Array(p*d*h),g=new Float32Array(f*d*h),y=new Float32Array(m*d*h),x=0;x<h;x++){var b=x%3*2/3-1,M=x>2?0:-1,w=[b,M,0,b+2/3,M,0,b+2/3,M+1,0,b,M,0,b+2/3,M+1,0,b,M+1,0];v.set(w,p*d*x),g.set(c,f*d*x);var _=[x,x,x,x,x,x];y.set(_,m*d*x)}var A=new ra;A.setAttribute("position",new Oi(v,p)),A.setAttribute("uv",new Oi(g,f)),A.setAttribute("faceIndex",new Oi(y,m)),e.push(A),r>4&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function nf(e){var t=new ir(3*Up,3*Up,e);return t.texture.mapping=ye,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function rf(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function af(){return new Ec({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new Kn(1,1)},inputEncoding:{value:Gp[on]},outputEncoding:{value:Gp[on]}},vertexShader:sf(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t".concat(lf(),"\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:E,depthTest:!1,depthWrite:!1})}function of(){return new Ec({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Gp[on]},outputEncoding:{value:Gp[on]}},vertexShader:sf(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t".concat(lf(),"\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t"),blending:E,depthTest:!1,depthWrite:!1})}function sf(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function lf(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function uf(e,t,n,r,i,a,o){return new Li(e,t,n,i,a,o)}var cf=0,hf=1,df=0,pf=1,ff=2;function mf(e){return e}function vf(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function gf(e,t){return new ql(e,t)}function yf(e){return new xl(e)}function xf(e,t){return new ql(e,t)}function bf(e){return new Wl(e)}function Mf(e){return new Wl(e)}function wf(e){return new Wl(e)}function _f(e,t,n){return new sr(e,t,n)}function Af(e,t){return new Oi(e,t).setUsage(On)}function Cf(e,t){return new Ii(e,t)}function Tf(e,t){return new Fi(e,t)}function Sf(e,t){return new Ni(e,t)}function Ef(e,t){return new zi(e,t)}function Lf(e,t){return new Ui(e,t)}function Pf(e,t){return new Hi(e,t)}function Bf(e,t){return new ji(e,t)}function Df(e,t){return new Vi(e,t)}function kf(e,t){return new Wi(e,t)}function Rf(e){xh.call(this,e),this.type="catmullrom",this.closed=!0}function Of(e){xh.call(this,e),this.type="catmullrom"}function If(e){xh.call(this,e),this.type="catmullrom"}function Ff(e){return new Ip(e)}function Nf(e,t){return new Bp(e,t)}function zf(e,t){return new Gl(new Mu(e.geometry),new Rl({color:void 0!==t?t:16777215}))}function Uf(e,t){return new Gl(new Cc(e.geometry),new Rl({color:void 0!==t?t:16777215}))}function Hf(e){return new ih(e)}function jf(e){return new uh(e)}function Gf(e,t,n){return new Fa(e,n)}hh.create=function(e,t){return e.prototype=Object.create(hh.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Bh.prototype,{createPointsGeometry:function(e){var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){for(var t=new ou,n=0,r=e.length;n<r;n++){var i=e[n];t.vertices.push(new sr(i.x,i.y,i.z||0))}return t}}),Object.assign(Dh.prototype,{fromPoints:function(e){return this.setFromPoints(e)}}),Rf.prototype=Object.create(xh.prototype),Of.prototype=Object.create(xh.prototype),If.prototype=Object.create(xh.prototype),Object.assign(If.prototype,{initFromArray:function(){},getControlPointsArray:function(){},reparametrizeByArcLength:function(){}}),yp.prototype.setColors=function(){},hp.prototype.update=function(){},Object.assign(nh.prototype,{extractUrlBase:function(e){return Qh.extractUrlBase(e)}}),nh.Handlers={add:function(){},get:function(){}},Object.assign(tp.prototype,{center:function(e){return this.getCenter(e)},empty:function(){return this.isEmpty()},isIntersectionBox:function(e){return this.intersectsBox(e)},size:function(e){return this.getSize(e)}}),Object.assign(cr.prototype,{center:function(e){return this.getCenter(e)},empty:function(){return this.isEmpty()},isIntersectionBox:function(e){return this.intersectsBox(e)},isIntersectionSphere:function(e){return this.intersectsSphere(e)},size:function(e){return this.getSize(e)}}),Object.assign(Tr.prototype,{empty:function(){return this.isEmpty()}}),Ha.prototype.setFromMatrix=function(e){return this.setFromProjectionMatrix(e)},ip.prototype.center=function(e){return this.getCenter(e)},Object.assign(qn,{random16:function(){return Math.random()},nearestPowerOfTwo:function(e){return qn.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return qn.ceilPowerOfTwo(e)}}),Object.assign(Zn.prototype,{flattenToArrayOffset:function(e,t){return this.toArray(e,t)},multiplyVector3:function(e){return e.applyMatrix3(this)},multiplyVector3Array:function(){},applyToBufferAttribute:function(e){return e.applyMatrix3(this)},applyToVector3Array:function(){},getInverse:function(e){return this.copy(e).invert()}}),Object.assign(Or.prototype,{extractPosition:function(e){return this.copyPosition(e)},flattenToArrayOffset:function(e,t){return this.toArray(e,t)},getPosition:function(){return(new sr).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return this.makeRotationFromQuaternion(e)},multiplyToArray:function(){},multiplyVector3:function(e){return e.applyMatrix4(this)},multiplyVector4:function(e){return e.applyMatrix4(this)},multiplyVector3Array:function(){},rotateAxis:function(e){e.transformDirection(this)},crossVector:function(e){return e.applyMatrix4(this)},translate:function(){},rotateX:function(){},rotateY:function(){},rotateZ:function(){},rotateByAxis:function(){},applyToBufferAttribute:function(e){return e.applyMatrix4(this)},applyToVector3Array:function(){},makeFrustum:function(e,t,n,r,i,a){return this.makePerspective(e,t,r,n,i,a)},getInverse:function(e){return this.copy(e).invert()}}),ci.prototype.isIntersectionLine=function(e){return this.intersectsLine(e)},Object.assign(or.prototype,{multiplyVector3:function(e){return e.applyQuaternion(this)},inverse:function(){return this.invert()}}),Object.assign(Rr.prototype,{isIntersectionBox:function(e){return this.intersectsBox(e)},isIntersectionPlane:function(e){return this.intersectsPlane(e)},isIntersectionSphere:function(e){return this.intersectsSphere(e)}}),Object.assign(Mi.prototype,{area:function(){return this.getArea()},barycoordFromPoint:function(e,t){return this.getBarycoord(e,t)},midpoint:function(e){return this.getMidpoint(e)},normal:function(e){return this.getNormal(e)},plane:function(e){return this.getPlane(e)}}),Object.assign(Mi,{barycoordFromPoint:function(e,t,n,r,i){return Mi.getBarycoord(e,t,n,r,i)},normal:function(e,t,n,r){return Mi.getNormal(e,t,n,r)}}),Object.assign(kh.prototype,{extractAllPoints:function(e){return this.extractPoints(e)},extrude:function(e){return new Zu(this,e)},makeGeometry:function(e){return new dc(this,e)}}),Object.assign(Kn.prototype,{fromAttribute:function(e,t,n){return this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return this.manhattanDistanceTo(e)},lengthManhattan:function(){return this.manhattanLength()}}),Object.assign(sr.prototype,{setEulerFromRotationMatrix:function(){},setEulerFromQuaternion:function(){},getPositionFromMatrix:function(e){return this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return this.setFromMatrixColumn(t,e)},applyProjection:function(e){return this.applyMatrix4(e)},fromAttribute:function(e,t,n){return this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return this.manhattanDistanceTo(e)},lengthManhattan:function(){return this.manhattanLength()}}),Object.assign(rr.prototype,{fromAttribute:function(e,t,n){return this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return this.manhattanLength()}}),Object.assign(ou.prototype,{computeTangents:function(){},computeLineDistances:function(){},applyMatrix:function(e){return this.applyMatrix4(e)}}),Object.assign(oi.prototype,{getChildByName:function(e){return this.getObjectByName(e)},renderDepth:function(){},translate:function(e,t){return this.translateOnAxis(t,e)},getWorldRotation:function(){},applyMatrix:function(e){return this.applyMatrix4(e)}}),Object.defineProperties(oi.prototype,{eulerOrder:{get:function(){return this.rotation.order},set:function(e){this.rotation.order=e}},useQuaternion:{get:function(){},set:function(){}}}),Object.assign(Ma.prototype,{setDrawMode:function(){}}),Object.defineProperties(Ma.prototype,{drawMode:{get:function(){return nn},set:function(){}}}),Object.defineProperties(_l.prototype,{objects:{get:function(){return this.levels}}}),Object.defineProperty(El.prototype,"useVertexTexture",{get:function(){},set:function(){}}),Al.prototype.initBones=function(){},Object.defineProperty(hh.prototype,"__arcLengthDivisions",{get:function(){return this.arcLengthDivisions},set:function(e){this.arcLengthDivisions=e}}),Da.prototype.setLens=function(e,t){void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Rh.prototype,{onlyShadow:{set:function(){}},shadowCameraFov:{set:function(e){this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){}},shadowBias:{set:function(e){this.shadow.bias=e}},shadowDarkness:{set:function(){}},shadowMapWidth:{set:function(e){this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){this.shadow.mapSize.height=e}}}),Object.defineProperties(Oi.prototype,{length:{get:function(){return this.array.length}},dynamic:{get:function(){return this.usage===On},set:function(){this.setUsage(On)}}}),Object.assign(Oi.prototype,{setDynamic:function(e){return this.setUsage(!0===e?On:Rn),this},copyIndicesArray:function(){},setArray:function(){}}),Object.assign(ra.prototype,{addIndex:function(e){this.setIndex(e)},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(this.setIndex(t),this):this.setAttribute(e,t):this.setAttribute(e,new Oi(arguments[1],arguments[2]))},addDrawCall:function(e,t,n){this.addGroup(e,t)},clearDrawCalls:function(){this.clearGroups()},computeTangents:function(){},computeOffsets:function(){},removeAttribute:function(e){return this.deleteAttribute(e)},applyMatrix:function(e){return this.applyMatrix4(e)}}),Object.defineProperties(ra.prototype,{drawcalls:{get:function(){return this.groups}},offsets:{get:function(){return this.groups}}}),Object.defineProperties(qh.prototype,{maxInstancedCount:{get:function(){return this.instanceCount},set:function(e){this.instanceCount=e}}}),Object.defineProperties(Qd.prototype,{linePrecision:{get:function(){return this.params.Line.threshold},set:function(e){this.params.Line.threshold=e}}}),Object.defineProperties(nl.prototype,{dynamic:{get:function(){return this.usage===On},set:function(e){this.setUsage(e)}}}),Object.assign(nl.prototype,{setDynamic:function(e){return this.setUsage(!0===e?On:Rn),this},setArray:function(){}}),Object.assign(qu.prototype,{getArrays:function(){},addShapeList:function(){},addShape:function(){}}),Object.assign(tl.prototype,{dispose:function(){}}),Object.defineProperties(Xd.prototype,{dynamic:{set:function(){}},onUpdate:{value:function(){return this}}}),Object.defineProperties(Bi.prototype,{wrapAround:{get:function(){},set:function(){}},overdraw:{get:function(){},set:function(){}},wrapRGB:{get:function(){return new Ei}},shading:{get:function(){},set:function(e){this.flatShading=e===A}},stencilMask:{get:function(){return this.stencilFuncMask},set:function(e){this.stencilFuncMask=e}}}),Object.defineProperties(Bc.prototype,{metal:{get:function(){return!1},set:function(){}}}),Object.defineProperties(Pc.prototype,{transparency:{get:function(){return this.transmission},set:function(e){this.transmission=e}}}),Object.defineProperties(Pa.prototype,{derivatives:{get:function(){return this.extensions.derivatives},set:function(e){this.extensions.derivatives=e}}}),Object.assign(Ks.prototype,{clearTarget:function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},animate:function(e){this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return this.getRenderTarget()},getMaxAnisotropy:function(){return this.capabilities.getMaxAnisotropy()},getPrecision:function(){return this.capabilities.precision},resetGLState:function(){return this.state.reset()},supportsFloatTextures:function(){return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return this.capabilities.vertexTextures},supportsInstancedArrays:function(){return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){this.setScissorTest(e)},initMaterial:function(){},addPrePlugin:function(){},addPostPlugin:function(){},updateShadowMap:function(){},setFaceCulling:function(){},allocTextureUnit:function(){},setTexture:function(){},setTexture2D:function(){},setTextureCube:function(){},getActiveMipMapLevel:function(){return this.getActiveMipmapLevel()}}),Object.defineProperties(Ks.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){this.shadowMap.type=e}},shadowMapCullFace:{get:function(){},set:function(){}},context:{get:function(){return this.getContext()}},vr:{get:function(){return this.xr}},gammaInput:{get:function(){return!1},set:function(){}},gammaOutput:{get:function(){return!1},set:function(e){this.outputEncoding=!0===e?sn:on}},toneMappingWhitePoint:{get:function(){return 1},set:function(){}}}),Object.defineProperties(js.prototype,{cullFace:{get:function(){},set:function(){}},renderReverseSided:{get:function(){},set:function(){}},renderSingleSided:{get:function(){},set:function(){}}}),Object.defineProperties(ir.prototype,{wrapS:{get:function(){return this.texture.wrapS},set:function(e){this.texture.wrapS=e}},wrapT:{get:function(){return this.texture.wrapT},set:function(e){this.texture.wrapT=e}},magFilter:{get:function(){return this.texture.magFilter},set:function(e){this.texture.magFilter=e}},minFilter:{get:function(){return this.texture.minFilter},set:function(e){this.texture.minFilter=e}},anisotropy:{get:function(){return this.texture.anisotropy},set:function(e){this.texture.anisotropy=e}},offset:{get:function(){return this.texture.offset},set:function(e){this.texture.offset=e}},repeat:{get:function(){return this.texture.repeat},set:function(e){this.texture.repeat=e}},format:{get:function(){return this.texture.format},set:function(e){this.texture.format=e}},type:{get:function(){return this.texture.type},set:function(e){this.texture.type=e}},generateMipmaps:{get:function(){return this.texture.generateMipmaps},set:function(e){this.texture.generateMipmaps=e}}}),Object.defineProperties(_d.prototype,{load:{value:function(e){var t=this;return(new cd).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){}}}),Ld.prototype.getData=function(){return this.getFrequencyData()},Oa.prototype.updateCubeMap=function(e,t){return this.update(e,t)},Oa.prototype.clear=function(e,t,n,r){return this.renderTarget.clear(e,t,n,r)};var Vf={merge:function(e,t,n){var r;t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,n)},center:function(e){return e.center()}};function Wf(){}function Xf(){}$n.crossOrigin=void 0,$n.loadTexture=function(e,t,n,r){var i=new ch;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,n,void 0,r);return t&&(a.mapping=t),a},$n.loadTextureCube=function(e,t,n,r){var i=new lh;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,n,void 0,r);return t&&(a.mapping=t),a},$n.loadCompressedTexture=function(){},$n.loadCompressedTextureCube=function(){};var Yf={createMultiMaterialObject:function(){},detach:function(){},attach:function(){}};function Jf(){}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:r}}))},139:function(){THREE.FirstPersonControls=function(e,t){void 0===t&&(t=document),this.object=e,this.domElement=t,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.viewHalfX=0,this.viewHalfY=0;var n,r=0,i=0,a=new THREE.Vector3,o=new THREE.Spherical,s=new THREE.Vector3;function l(e){e.preventDefault()}this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.lookAt=function(e,t,n){return e.isVector3?s.copy(e):s.set(e,t,n),this.object.lookAt(s),m(this),this},this.update=(n=new THREE.Vector3,function(e){if(!1!==this.enabled){if(this.heightSpeed){var t=THREE.MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;var a=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(a+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(a),this.moveLeft&&this.object.translateX(-a),this.moveRight&&this.object.translateX(a),this.moveUp&&this.object.translateY(a),this.moveDown&&this.object.translateY(-a);var o=e*this.lookSpeed;this.activeLook||(o=0);var s=1;this.constrainVertical&&(s=Math.PI/(this.verticalMax-this.verticalMin)),i-=this.mouseX*o,this.lookVertical&&(r-=this.mouseY*o*s),r=Math.max(-85,Math.min(85,r));var l=THREE.MathUtils.degToRad(90-r),u=THREE.MathUtils.degToRad(i);this.constrainVertical&&(l=THREE.MathUtils.mapLinear(l,0,Math.PI,this.verticalMin,this.verticalMax));var c=this.object.position;n.setFromSphericalCoords(1,l,u).add(c),this.object.lookAt(n)}}),this.dispose=function(){this.domElement.removeEventListener("contextmenu",l,!1),this.domElement.removeEventListener("mousedown",c,!1),this.domElement.removeEventListener("mousemove",u,!1),this.domElement.removeEventListener("mouseup",h,!1),window.removeEventListener("keydown",d,!1),window.removeEventListener("keyup",p,!1)};var u=f(this,this.onMouseMove),c=f(this,this.onMouseDown),h=f(this,this.onMouseUp),d=f(this,this.onKeyDown),p=f(this,this.onKeyUp);function f(e,t){return function(){t.apply(e,arguments)}}function m(e){var t=e.object.quaternion;a.set(0,0,-1).applyQuaternion(t),o.setFromVector3(a),r=90-THREE.MathUtils.radToDeg(o.phi),i=THREE.MathUtils.radToDeg(o.theta)}this.domElement.addEventListener("contextmenu",l,!1),this.domElement.addEventListener("mousemove",u,!1),this.domElement.addEventListener("mousedown",c,!1),this.domElement.addEventListener("mouseup",h,!1),window.addEventListener("keydown",d,!1),window.addEventListener("keyup",p,!1),this.handleResize(),m(this)}},324:function(){THREE.OrbitControls=function(e,t){var n,r,i,a,o,s;document,this.object=e,this.domElement=t,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.DOLLY,RIGHT:THREE.MOUSE.PAN},this.touches={ONE:THREE.TOUCH.ROTATE,TWO:THREE.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return m.phi},this.getAzimuthalAngle=function(){return m.theta},this.saveState=function(){l.target0.copy(l.target),l.position0.copy(l.object.position),l.zoom0=l.object.zoom},this.reset=function(){l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.zoom=l.zoom0,l.object.updateProjectionMatrix(),l.dispatchEvent(u),l.update(),p=d.NONE},this.update=(n=new THREE.Vector3,r=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),i=r.clone().invert(),a=new THREE.Vector3,o=new THREE.Quaternion,s=2*Math.PI,function(){var e=l.object.position;n.copy(e).sub(l.target),n.applyQuaternion(r),m.setFromVector3(n),l.autoRotate&&p===d.NONE&&P(2*Math.PI/60/60*l.autoRotateSpeed),l.enableDamping?(m.theta+=v.theta*l.dampingFactor,m.phi+=v.phi*l.dampingFactor):(m.theta+=v.theta,m.phi+=v.phi);var t=l.minAzimuthAngle,c=l.maxAzimuthAngle;return isFinite(t)&&isFinite(c)&&(t<-Math.PI?t+=s:t>Math.PI&&(t-=s),c<-Math.PI?c+=s:c>Math.PI&&(c-=s),m.theta=t<=c?Math.max(t,Math.min(c,m.theta)):m.theta>(t+c)/2?Math.max(t,m.theta):Math.min(c,m.theta)),m.phi=Math.max(l.minPolarAngle,Math.min(l.maxPolarAngle,m.phi)),m.makeSafe(),m.radius*=g,m.radius=Math.max(l.minDistance,Math.min(l.maxDistance,m.radius)),!0===l.enableDamping?l.target.addScaledVector(y,l.dampingFactor):l.target.add(y),n.setFromSpherical(m),n.applyQuaternion(i),e.copy(l.target).add(n),l.object.lookAt(l.target),!0===l.enableDamping?(v.theta*=1-l.dampingFactor,v.phi*=1-l.dampingFactor,y.multiplyScalar(1-l.dampingFactor)):(v.set(0,0,0),y.set(0,0,0)),g=1,!!(x||a.distanceToSquared(l.object.position)>f||8*(1-o.dot(l.object.quaternion))>f)&&(l.dispatchEvent(u),a.copy(l.object.position),o.copy(l.object.quaternion),x=!1,!0)}),this.dispose=function(){l.domElement.removeEventListener("contextmenu",ee,!1),l.domElement.removeEventListener("pointerdown",X,!1),l.domElement.removeEventListener("wheel",Q,!1),l.domElement.removeEventListener("touchstart",K,!1),l.domElement.removeEventListener("touchend",$,!1),l.domElement.removeEventListener("touchmove",Z,!1),l.domElement.ownerDocument.removeEventListener("pointermove",Y,!1),l.domElement.ownerDocument.removeEventListener("pointerup",J,!1),l.domElement.removeEventListener("keydown",q,!1)};var l=this,u={type:"change"},c={type:"start"},h={type:"end"},d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},p=d.NONE,f=1e-6,m=new THREE.Spherical,v=new THREE.Spherical,g=1,y=new THREE.Vector3,x=!1,b=new THREE.Vector2,M=new THREE.Vector2,w=new THREE.Vector2,_=new THREE.Vector2,A=new THREE.Vector2,C=new THREE.Vector2,T=new THREE.Vector2,S=new THREE.Vector2,E=new THREE.Vector2;function L(){return Math.pow(.95,l.zoomSpeed)}function P(e){v.theta-=e}function B(e){v.phi-=e}var D,k=(D=new THREE.Vector3,function(e,t){D.setFromMatrixColumn(t,0),D.multiplyScalar(-e),y.add(D)}),R=function(){var e=new THREE.Vector3;return function(t,n){!0===l.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(l.object.up,e)),e.multiplyScalar(t),y.add(e)}}(),O=function(){var e=new THREE.Vector3;return function(t,n){var r=l.domElement;if(l.object.isPerspectiveCamera){var i=l.object.position;e.copy(i).sub(l.target);var a=e.length();a*=Math.tan(l.object.fov/2*Math.PI/180),k(2*t*a/r.clientHeight,l.object.matrix),R(2*n*a/r.clientHeight,l.object.matrix)}else l.object.isOrthographicCamera?(k(t*(l.object.right-l.object.left)/l.object.zoom/r.clientWidth,l.object.matrix),R(n*(l.object.top-l.object.bottom)/l.object.zoom/r.clientHeight,l.object.matrix)):l.enablePan=!1}}();function I(e){l.object.isPerspectiveCamera?g/=e:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom*e)),l.object.updateProjectionMatrix(),x=!0):l.enableZoom=!1}function F(e){l.object.isPerspectiveCamera?g*=e:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/e)),l.object.updateProjectionMatrix(),x=!0):l.enableZoom=!1}function N(e){b.set(e.clientX,e.clientY)}function z(e){_.set(e.clientX,e.clientY)}function U(e){if(1==e.touches.length)b.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(t,n)}}function H(e){if(1==e.touches.length)_.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);_.set(t,n)}}function j(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);T.set(0,r)}function G(e){if(1==e.touches.length)M.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);M.set(t,n)}w.subVectors(M,b).multiplyScalar(l.rotateSpeed);var r=l.domElement;P(2*Math.PI*w.x/r.clientHeight),B(2*Math.PI*w.y/r.clientHeight),b.copy(M)}function V(e){if(1==e.touches.length)A.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);A.set(t,n)}C.subVectors(A,_).multiplyScalar(l.panSpeed),O(C.x,C.y),_.copy(A)}function W(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);S.set(0,r),E.set(0,Math.pow(S.y/T.y,l.zoomSpeed)),I(E.y),T.copy(S)}function X(e){if(!1!==l.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){var t;switch(e.preventDefault(),l.domElement.focus?l.domElement.focus():window.focus(),e.button){case 0:t=l.mouseButtons.LEFT;break;case 1:t=l.mouseButtons.MIDDLE;break;case 2:t=l.mouseButtons.RIGHT;break;default:t=-1}switch(t){case THREE.MOUSE.DOLLY:if(!1===l.enableZoom)return;!function(e){T.set(e.clientX,e.clientY)}(e),p=d.DOLLY;break;case THREE.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===l.enablePan)return;z(e),p=d.PAN}else{if(!1===l.enableRotate)return;N(e),p=d.ROTATE}break;case THREE.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===l.enableRotate)return;N(e),p=d.ROTATE}else{if(!1===l.enablePan)return;z(e),p=d.PAN}break;default:p=d.NONE}p!==d.NONE&&(l.domElement.ownerDocument.addEventListener("pointermove",Y,!1),l.domElement.ownerDocument.addEventListener("pointerup",J,!1),l.dispatchEvent(c))}(e)}}function Y(e){if(!1!==l.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1!==l.enabled)switch(e.preventDefault(),p){case d.ROTATE:if(!1===l.enableRotate)return;!function(e){M.set(e.clientX,e.clientY),w.subVectors(M,b).multiplyScalar(l.rotateSpeed);var t=l.domElement;P(2*Math.PI*w.x/t.clientHeight),B(2*Math.PI*w.y/t.clientHeight),b.copy(M),l.update()}(e);break;case d.DOLLY:if(!1===l.enableZoom)return;!function(e){S.set(e.clientX,e.clientY),E.subVectors(S,T),E.y>0?I(L()):E.y<0&&F(L()),T.copy(S),l.update()}(e);break;case d.PAN:if(!1===l.enablePan)return;!function(e){A.set(e.clientX,e.clientY),C.subVectors(A,_).multiplyScalar(l.panSpeed),O(C.x,C.y),_.copy(A),l.update()}(e)}}(e)}}function J(e){switch(e.pointerType){case"mouse":case"pen":l.domElement.ownerDocument.removeEventListener("pointermove",Y,!1),l.domElement.ownerDocument.removeEventListener("pointerup",J,!1),!1!==l.enabled&&(l.dispatchEvent(h),p=d.NONE)}}function Q(e){!1===l.enabled||!1===l.enableZoom||p!==d.NONE&&p!==d.ROTATE||(e.preventDefault(),e.stopPropagation(),l.dispatchEvent(c),function(e){e.deltaY<0?F(L()):e.deltaY>0&&I(L()),l.update()}(e),l.dispatchEvent(h))}function q(e){!1!==l.enabled&&!1!==l.enableKeys&&!1!==l.enablePan&&function(e){var t=!1;switch(e.keyCode){case l.keys.UP:O(0,l.keyPanSpeed),t=!0;break;case l.keys.BOTTOM:O(0,-l.keyPanSpeed),t=!0;break;case l.keys.LEFT:O(l.keyPanSpeed,0),t=!0;break;case l.keys.RIGHT:O(-l.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),l.update())}(e)}function K(e){if(!1!==l.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(l.touches.ONE){case THREE.TOUCH.ROTATE:if(!1===l.enableRotate)return;U(e),p=d.TOUCH_ROTATE;break;case THREE.TOUCH.PAN:if(!1===l.enablePan)return;H(e),p=d.TOUCH_PAN;break;default:p=d.NONE}break;case 2:switch(l.touches.TWO){case THREE.TOUCH.DOLLY_PAN:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(e){l.enableZoom&&j(e),l.enablePan&&H(e)}(e),p=d.TOUCH_DOLLY_PAN;break;case THREE.TOUCH.DOLLY_ROTATE:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(e){l.enableZoom&&j(e),l.enableRotate&&U(e)}(e),p=d.TOUCH_DOLLY_ROTATE;break;default:p=d.NONE}break;default:p=d.NONE}p!==d.NONE&&l.dispatchEvent(c)}}function Z(e){if(!1!==l.enabled)switch(e.preventDefault(),e.stopPropagation(),p){case d.TOUCH_ROTATE:if(!1===l.enableRotate)return;G(e),l.update();break;case d.TOUCH_PAN:if(!1===l.enablePan)return;V(e),l.update();break;case d.TOUCH_DOLLY_PAN:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(e){l.enableZoom&&W(e),l.enablePan&&V(e)}(e),l.update();break;case d.TOUCH_DOLLY_ROTATE:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(e){l.enableZoom&&W(e),l.enableRotate&&G(e)}(e),l.update();break;default:p=d.NONE}}function $(e){!1!==l.enabled&&(l.dispatchEvent(h),p=d.NONE)}function ee(e){!1!==l.enabled&&e.preventDefault()}l.domElement.addEventListener("contextmenu",ee,!1),l.domElement.addEventListener("pointerdown",X,!1),l.domElement.addEventListener("wheel",Q,!1),l.domElement.addEventListener("touchstart",K,!1),l.domElement.addEventListener("touchend",$,!1),l.domElement.addEventListener("touchmove",Z,!1),l.domElement.addEventListener("keydown",q,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,THREE.MapControls=function(e,t){THREE.OrbitControls.call(this,e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=THREE.MOUSE.PAN,this.mouseButtons.RIGHT=THREE.MOUSE.ROTATE,this.touches.ONE=THREE.TOUCH.PAN,this.touches.TWO=THREE.TOUCH.DOLLY_ROTATE},THREE.MapControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.MapControls.prototype.constructor=THREE.MapControls},818:function(){THREE.DDSLoader=function(e){THREE.CompressedTextureLoader.call(this,e)},THREE.DDSLoader.prototype=Object.assign(Object.create(THREE.CompressedTextureLoader.prototype),{constructor:THREE.DDSLoader,parse:function(e,t){var n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function i(e,t,n,r){for(var i=n*r*4,a=new Uint8Array(e,t,i),o=new Uint8Array(i),s=0,l=0,u=0;u<r;u++)for(var c=0;c<n;c++){var h=a[l],d=a[++l],p=a[++l],f=a[++l];l++,o[s]=p,o[++s]=d,o[++s]=h,o[++s]=f,s++}return o}var a,o=r("DXT1"),s=r("DXT3"),l=r("DXT5"),u=r("ETC1"),c=new Int32Array(e,0,31);if(542327876!==c[0])return n;if(4&!c[20])return n;var h=!1;switch(c[21]){case o:a=8,n.format=THREE.RGB_S3TC_DXT1_Format;break;case s:a=16,n.format=THREE.RGBA_S3TC_DXT3_Format;break;case l:a=16,n.format=THREE.RGBA_S3TC_DXT5_Format;break;case u:a=8,n.format=THREE.RGB_ETC1_Format;break;default:if(!(32===c[22]&&16711680&c[23]&&65280&c[24]&&255&c[25]&&4278190080&c[26]))return n;h=!0,a=64,n.format=THREE.RGBAFormat}n.mipmapCount=1,131072&c[2]&&!1!==t&&(n.mipmapCount=Math.max(1,c[7]));var d=c[28];if(n.isCubemap=!!(512&d),n.isCubemap&&(!(1024&d)||!(2048&d)||!(4096&d)||!(8192&d)||!(16384&d)||!(32768&d)))return n;n.width=c[4],n.height=c[3];for(var p=c[1]+4,f=n.isCubemap?6:1,m=0;m<f;m++)for(var v=n.width,g=n.height,y=0;y<n.mipmapCount;y++){if(h)var x=(b=i(e,p,v,g)).length;else{x=Math.max(4,v)/4*Math.max(4,g)/4*a;var b=new Uint8Array(e,p,x)}var M={data:b,width:v,height:g};n.mipmaps.push(M),p+=x,v=Math.max(v>>1,1),g=Math.max(g>>1,1)}return n}})},548:function(){THREE.DRACOLoader=function(e){THREE.Loader.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}},THREE.DRACOLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.DRACOLoader,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){},setDrawMode:function(){},setSkipDequantization:function(){},load:function(e,t,n,r){var i=this,a=new THREE.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){var n={attributeIDs:i.defaultAttributeIDs,attributeTypes:i.defaultAttributeTypes,useUniqueIDs:!1};i.decodeGeometry(e,n).then(t).catch(r)}),n,r)},decodeDracoFile:function(e,t,n,r){var i={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,i).then(t)},decodeGeometry:function(e,t){var n=this;for(var r in t.attributeTypes){var i=t.attributeTypes[r];void 0!==i.BYTES_PER_ELEMENT&&(t.attributeTypes[r]=i.name)}var a,o=JSON.stringify(t);if(THREE.DRACOLoader.taskCache.has(e)){var s=THREE.DRACOLoader.taskCache.get(e);if(s.key===o)return s.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var l=this.workerNextTaskID++,u=e.byteLength,c=this._getWorker(l,u).then((function(n){return a=n,new Promise((function(n,r){a._callbacks[l]={resolve:n,reject:r},a.postMessage({type:"decode",id:l,taskConfig:t,buffer:e},[e])}))})).then((function(e){return n._createGeometry(e.geometry)}));return c.catch((function(){return!0})).then((function(){a&&l&&n._releaseTask(a,l)})),THREE.DRACOLoader.taskCache.set(e,{key:o,promise:c}),c},_createGeometry:function(e){var t=new THREE.BufferGeometry;e.index&&t.setIndex(new THREE.BufferAttribute(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var r=e.attributes[n],i=r.name,a=r.array,o=r.itemSize;t.setAttribute(i,new THREE.BufferAttribute(a,o))}return t},_loadLibrary:function(e,t){var n=new THREE.FileLoader(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((function(t,r){n.load(e,t,void 0,r)}))},preload:function(){return this._initDecoder(),this},_initDecoder:function(){var e=this;if(this.decoderPending)return this.decoderPending;var t="object"!=("undefined"==typeof WebAssembly?"undefined":(0,y.default)(WebAssembly))||"js"===this.decoderConfig.type,n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then((function(n){var r=n[0];t||(e.decoderConfig.wasmBinary=n[1]);var i=THREE.DRACOLoader.DRACOWorker.toString(),a=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([a]))})),this.decoderPending},_getWorker:function(e,t){var n=this;return this._initDecoder().then((function(){var r;return n.workerPool.length<n.workerLimit?((r=new Worker(n.workerSourceURL))._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:n.decoderConfig}),r.onmessage=function(e){var t=e.data;switch(t.type){case"decode":r._callbacks[t.id].resolve(t);break;case"error":r._callbacks[t.id].reject(t)}},n.workerPool.push(r)):n.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1})),(r=n.workerPool[n.workerPool.length-1])._taskCosts[e]=t,r._taskLoad+=t,r}))},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),THREE.DRACOLoader.DRACOWorker=function(){var e,t;function n(e,t,n,r,i,a){var o=a.num_components(),s=n.num_points()*o,l=s*i.BYTES_PER_ELEMENT,u=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),c=e._malloc(l);t.GetAttributeDataArrayForAllPoints(n,a,u,l,c);var h=new i(e.HEAPF32.buffer,c,s).slice();return e._free(c),{name:r,array:h,itemSize:o}}onmessage=function(r){var i=r.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var a=i.buffer,o=i.taskConfig;t.then((function(e){var t=e.draco,r=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(a),a.byteLength);try{var l=function(e,t,r,i){var a,o,s=i.attributeIDs,l=i.attributeTypes,u=t.GetEncodedGeometryType(r);if(u===e.TRIANGULAR_MESH)a=new e.Mesh,o=t.DecodeBufferToMesh(r,a);else{if(u!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,o=t.DecodeBufferToPointCloud(r,a)}if(!o.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+o.error_msg());var c={index:null,attributes:[]};for(var h in s){var d,p,f=self[l[h]];if(i.useUniqueIDs)p=s[h],d=t.GetAttributeByUniqueId(a,p);else{if(-1===(p=t.GetAttributeId(a,e[s[h]])))continue;d=t.GetAttribute(a,p)}c.attributes.push(n(e,t,a,h,f,d))}return u===e.TRIANGULAR_MESH&&(c.index=function(e,t,n){var r=3*n.num_faces(),i=4*r,a=e._malloc(i);t.GetTrianglesUInt32Array(n,i,a);var o=new Uint32Array(e.HEAPF32.buffer,a,r).slice();return e._free(a),{array:o,itemSize:1}}(e,t,a)),e.destroy(a),c}(t,r,s,o),u=l.attributes.map((function(e){return e.array.buffer}));l.index&&u.push(l.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:l},u)}catch(e){self.postMessage({type:"error",id:i.id,error:e.message})}finally{t.destroy(s),t.destroy(r)}}))}}},THREE.DRACOLoader.taskCache=new WeakMap,THREE.DRACOLoader.setDecoderPath=function(){},THREE.DRACOLoader.setDecoderConfig=function(){},THREE.DRACOLoader.releaseDecoderModule=function(){},THREE.DRACOLoader.getDecoderModule=function(){}},595:function(){THREE.FBXLoader=function(){var e,t,n;function r(e){THREE.Loader.call(this,e)}function i(e,t){this.textureLoader=e,this.manager=t}function a(){}function o(){}function s(){}function l(){}function u(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function c(){}function h(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function d(e){return e/46186158e3}r.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:r,load:function(e,t,n,r){var i=this,a=""===i.path?THREE.LoaderUtils.extractUrlBase(e):i.path,o=new THREE.FileLoader(this.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(n,a))}catch(t){r&&r(t),i.manager.itemError(e)}}),n,r)},parse:function(t,n){if(o="Kaydara FBX Binary  \0",(a=t).byteLength>=o.length&&o===M(a,0,o.length))e=(new l).parse(t);else{var r=M(t);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0;function r(t){var r=e[t-1];return e=e.slice(n+t),n++,r}for(var i=0;i<t.length;++i)if(r(1)===t[i])return!1;return!0}(r))throw new Error("THREE.FBXLoader: Unknown format.");if(h(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+h(r));e=(new s).parse(r)}var a,o;return new i(new THREE.TextureLoader(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin),this.manager).parse(e)}}),i.prototype={constructor:i,parse:function(){t=this.parseConnections();var e=this.parseImages(),r=this.parseTextures(e),i=this.parseMaterials(r),o=this.parseDeformers(),s=(new a).parse(o);return this.parseScene(o,s,i),n},parseConnections:function(){var t=new Map;return"Connections"in e&&e.Connections.connections.forEach((function(e){var n=e[0],r=e[1],i=e[2];t.has(n)||t.set(n,{parents:[],children:[]});var a={ID:r,relationship:i};t.get(n).parents.push(a),t.has(r)||t.set(r,{parents:[],children:[]});var o={ID:n,relationship:i};t.get(r).children.push(o)})),t},parseImages:function(){var t={},n={};if("Video"in e.Objects){var r=e.Objects.Video;for(var i in r){var a=r[i];if(t[u=parseInt(i)]=a.RelativeFilename||a.Filename,"Content"in a){var o=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,s="string"==typeof a.Content&&""!==a.Content;if(o||s){var l=this.parseImage(r[i]);n[a.RelativeFilename||a.Filename]=l}}}}for(var u in t){var c=t[u];void 0!==n[c]?t[u]=n[c]:t[u]=t[u].split("\\").pop()}return t},parseImage:function(e){var t,n=e.Content,r=e.RelativeFilename||e.Filename;switch(r.slice(r.lastIndexOf(".")+1).toLowerCase()){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":this.manager.getHandler(".tga"),t="image/tga";break;default:return}if("string"==typeof n)return"data:"+t+";base64,"+n;var i=new Uint8Array(n);return window.URL.createObjectURL(new Blob([i],{type:t}))},parseTextures:function(t){var n=new Map;if("Texture"in e.Objects){var r=e.Objects.Texture;for(var i in r){var a=this.parseTexture(r[i],t);n.set(parseInt(i),a)}}return n},parseTexture:function(e,t){var n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;var r=e.WrapModeU,i=e.WrapModeV,a=void 0!==r?r.value:0,o=void 0!==i?i.value:0;if(n.wrapS=0===a?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.wrapT=0===o?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e){var s=e.Scaling.value;n.repeat.x=s[0],n.repeat.y=s[1]}return n},loadTexture:function(e,n){var r,i,a=this.textureLoader.path,o=t.get(e.id).children;void 0!==o&&o.length>0&&void 0!==n[o[0].ID]&&(0!==(r=n[o[0].ID]).indexOf("blob:")&&0!==r.indexOf("data:")||this.textureLoader.setPath(void 0));var s=e.FileName.slice(-3).toLowerCase();if("tga"===s){var l=this.manager.getHandler(".tga");i=null===l?new THREE.Texture:l.load(r)}else i="psd"===s?new THREE.Texture:this.textureLoader.load(r);return this.textureLoader.setPath(a),i},parseMaterials:function(t){var n=new Map;if("Material"in e.Objects){var r=e.Objects.Material;for(var i in r){var a=this.parseMaterial(r[i],t);null!==a&&n.set(parseInt(i),a)}}return n},parseMaterial:function(e,n){var r=e.id,i=e.attrName,a=e.ShadingModel;if("object"==(0,y.default)(a)&&(a=a.value),!t.has(r))return null;var o,s=this.parseParameters(e,n,r);switch(a.toLowerCase()){case"phong":default:o=new THREE.MeshPhongMaterial;break;case"lambert":o=new THREE.MeshLambertMaterial}return o.setValues(s),o.name=i,o},parseParameters:function(e,n,r){var i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new THREE.Color).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(i.color=(new THREE.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new THREE.Color).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(i.emissive=(new THREE.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new THREE.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new THREE.Color).fromArray(e.SpecularColor.value));var a=this;return t.get(r).children.forEach((function(e){switch(e.relationship){case"Bump":i.bumpMap=a.getTexture(n,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=a.getTexture(n,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=a.getTexture(n,e.ID),i.map.encoding=THREE.sRGBEncoding;break;case"DisplacementColor":i.displacementMap=a.getTexture(n,e.ID);break;case"EmissiveColor":i.emissiveMap=a.getTexture(n,e.ID),i.emissiveMap.encoding=THREE.sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=a.getTexture(n,e.ID);break;case"ReflectionColor":i.envMap=a.getTexture(n,e.ID),i.envMap.mapping=THREE.EquirectangularReflectionMapping,i.envMap.encoding=THREE.sRGBEncoding;break;case"SpecularColor":i.specularMap=a.getTexture(n,e.ID),i.specularMap.encoding=THREE.sRGBEncoding;break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=a.getTexture(n,e.ID),i.transparent=!0}})),i},getTexture:function(n,r){return"LayeredTexture"in e.Objects&&r in e.Objects.LayeredTexture&&(r=t.get(r).children[0].ID),n.get(r)},parseDeformers:function(){var n={},r={};if("Deformer"in e.Objects){var i=e.Objects.Deformer;for(var a in i){var o=i[a],s=t.get(parseInt(a));if("Skin"===o.attrType){var l=this.parseSkeleton(s,i);l.ID=a,s.parents.length,l.geometryID=s.parents[0].ID,n[a]=l}else if("BlendShape"===o.attrType){var u={id:a};u.rawTargets=this.parseMorphTargets(s,i),u.id=a,s.parents.length,r[a]=u}}}return{skeletons:n,morphTargets:r}},parseSkeleton:function(e,t){var n=[];return e.children.forEach((function(e){var r=t[e.ID];if("Cluster"===r.attrType){var i={ID:e.ID,indices:[],weights:[],transformLink:(new THREE.Matrix4).fromArray(r.TransformLink.a)};"Indexes"in r&&(i.indices=r.Indexes.a,i.weights=r.Weights.a),n.push(i)}})),{rawBones:n,bones:[]}},parseMorphTargets:function(e,n){for(var r=[],i=0;i<e.children.length;i++){var a=e.children[i],o=n[a.ID],s={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;s.geoID=t.get(parseInt(a.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,r.push(s)}return r},parseScene:function(r,i,a){n=new THREE.Group;var s=this.parseModels(r.skeletons,i,a),l=e.Objects.Model,u=this;s.forEach((function(e){var r=l[e.ID];u.setLookAtProperties(e,r),t.get(e.ID).parents.forEach((function(t){var n=s.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&n.add(e)})),this.bindSkeleton(r.skeletons,i,s),this.createAmbientLight(),this.setupMorphMaterials(),n.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=g(e.userData.transformData);e.applyMatrix4(t)}}));var c=(new o).parse();1===n.children.length&&n.children[0].isGroup&&(n.children[0].animations=c,n=n.children[0]),n.animations=c},parseModels:function(n,r,i){var a=new Map,o=e.Objects.Model;for(var s in o){var l=parseInt(s),u=o[s],c=t.get(l),h=this.buildSkeleton(c,n,l,u.attrName);if(!h){switch(u.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,r,i);break;case"NurbsCurve":h=this.createCurve(c,r);break;case"LimbNode":case"Root":h=new THREE.Bone;break;default:h=new THREE.Group}h.name=u.attrName?THREE.PropertyBinding.sanitizeNodeName(u.attrName):"",h.ID=l}this.getTransformData(h,u),a.set(l,h)}return a},buildSkeleton:function(e,t,n,r){var i=null;return e.parents.forEach((function(e){for(var a in t){var o=t[a];o.rawBones.forEach((function(t,a){if(t.ID===e.ID){var s=i;(i=new THREE.Bone).matrixWorld.copy(t.transformLink),i.name=r?THREE.PropertyBinding.sanitizeNodeName(r):"",i.ID=n,o.bones[a]=i,null!==s&&i.add(s)}}))}})),i},createCamera:function(t){var n,r;if(t.children.forEach((function(t){var n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(r=n)})),void 0===r)n=new THREE.Object3D;else{var i=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(i=1);var a=1;void 0!==r.NearPlane&&(a=r.NearPlane.value/1e3);var o=1e3;void 0!==r.FarPlane&&(o=r.FarPlane.value/1e3);var s=window.innerWidth,l=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(s=r.AspectWidth.value,l=r.AspectHeight.value);var u=s/l,c=45;void 0!==r.FieldOfView&&(c=r.FieldOfView.value);var h=r.FocalLength?r.FocalLength.value:null;switch(i){case 0:n=new THREE.PerspectiveCamera(c,u,a,o),null!==h&&n.setFocalLength(h);break;case 1:n=new THREE.OrthographicCamera(-s/2,s/2,l/2,-l/2,a,o);break;default:n=new THREE.Object3D}}return n},createLight:function(t){var n,r;if(t.children.forEach((function(t){var n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(r=n)})),void 0===r)n=new THREE.Object3D;else{var i;i=void 0===r.LightType?0:r.LightType.value;var a=16777215;void 0!==r.Color&&(a=(new THREE.Color).fromArray(r.Color.value));var o=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(o=0);var s=0;switch(void 0!==r.FarAttenuationEnd&&(s=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value),i){case 0:n=new THREE.PointLight(a,o,s,1);break;case 1:n=new THREE.DirectionalLight(a,o);break;case 2:var l=Math.PI/3;void 0!==r.InnerAngle&&(l=THREE.MathUtils.degToRad(r.InnerAngle.value));var u=0;void 0!==r.OuterAngle&&(u=THREE.MathUtils.degToRad(r.OuterAngle.value),u=Math.max(u,1)),n=new THREE.SpotLight(a,o,s,l,u,1);break;default:n=new THREE.PointLight(a,o)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(n.castShadow=!0)}return n},createMesh:function(e,t,n){var r,i=null,a=null,o=[];return e.children.forEach((function(e){t.has(e.ID)&&(i=t.get(e.ID)),n.has(e.ID)&&o.push(n.get(e.ID))})),o.length>1?a=o:o.length>0?a=o[0]:(a=new THREE.MeshPhongMaterial({color:13421772}),o.push(a)),"color"in i.attributes&&o.forEach((function(e){e.vertexColors=!0})),i.FBX_Deformer?(o.forEach((function(e){e.skinning=!0})),(r=new THREE.SkinnedMesh(i,a)).normalizeSkinWeights()):r=new THREE.Mesh(i,a),r},createCurve:function(e,t){var n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),r=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(n,r)},getTransformData:function(e,t){var n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?x(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n},setLookAtProperties:function(r,i){"LookAtProperty"in i&&t.get(r.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var i=e.Objects.Model[t.ID];if("Lcl_Translation"in i){var a=i.Lcl_Translation.value;void 0!==r.target?(r.target.position.fromArray(a),n.add(r.target)):r.lookAt((new THREE.Vector3).fromArray(a))}}}))},bindSkeleton:function(e,n,r){var i=this.parsePoseNodes();for(var a in e){var o=e[a];t.get(parseInt(o.ID)).parents.forEach((function(e){if(n.has(e.ID)){var a=e.ID;t.get(a).parents.forEach((function(e){r.has(e.ID)&&r.get(e.ID).bind(new THREE.Skeleton(o.bones),i[e.ID])}))}}))}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var n=e.Objects.Pose;for(var r in n)if("BindPose"===n[r].attrType){var i=n[r].PoseNode;Array.isArray(i)?i.forEach((function(e){t[e.Node]=(new THREE.Matrix4).fromArray(e.Matrix.a)})):t[i.Node]=(new THREE.Matrix4).fromArray(i.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,r=t[0],i=t[1],a=t[2];if(0!==r||0!==i||0!==a){var o=new THREE.Color(r,i,a);n.add(new THREE.AmbientLight(o,1))}}},setupMorphMaterials:function(){var e=this;n.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(n,r){e.setupMorphMaterial(t,n,r)})):e.setupMorphMaterial(t,t.material))}))},setupMorphMaterial:function(e,t,r){var i=e.uuid,a=t.uuid,o=!1;if(n.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===a&&e.uuid!==i&&(o=!0)})):e.material.uuid===a&&e.uuid!==i&&(o=!0))})),!0===o){var s=t.clone();s.morphTargets=!0,void 0===r?e.material=s:e.material[r]=s}else t.morphTargets=!0}},a.prototype={constructor:a,parse:function(n){var r=new Map;if("Geometry"in e.Objects){var i=e.Objects.Geometry;for(var a in i){var o=t.get(parseInt(a)),s=this.parseGeometry(o,i[a],n);r.set(parseInt(a),s)}}return r},parseGeometry:function(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,n,r){var i=r.skeletons,a=[],o=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0!==o.length){var s=t.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null);t.children.forEach((function(e){void 0!==r.morphTargets[e.ID]&&a.push(r.morphTargets[e.ID])}));var l=o[0],u={};"RotationOrder"in l&&(u.eulerOrder=x(l.RotationOrder.value)),"InheritType"in l&&(u.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(u.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(u.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(u.scale=l.GeometricScaling.value);var c=g(u);return this.genGeometry(n,s,a,c)}},genGeometry:function(e,t,n,r){var i=new THREE.BufferGeometry;e.attrName&&(i.name=e.attrName);var a=this.parseGeoNode(e,t),o=this.genBuffers(a),s=new THREE.Float32BufferAttribute(o.vertex,3);if(s.applyMatrix4(r),i.setAttribute("position",s),o.colors.length>0&&i.setAttribute("color",new THREE.Float32BufferAttribute(o.colors,3)),t&&(i.setAttribute("skinIndex",new THREE.Uint16BufferAttribute(o.weightsIndices,4)),i.setAttribute("skinWeight",new THREE.Float32BufferAttribute(o.vertexWeights,4)),i.FBX_Deformer=t),o.normal.length>0){var l=(new THREE.Matrix3).getNormalMatrix(r),u=new THREE.Float32BufferAttribute(o.normal,3);u.applyNormalMatrix(l),i.setAttribute("normal",u)}if(o.uvs.forEach((function(e,t){var n="uv"+(t+1).toString();0===t&&(n="uv"),i.setAttribute(n,new THREE.Float32BufferAttribute(o.uvs[t],2))})),a.material&&"AllSame"!==a.material.mappingType){var c=o.materialIndex[0],h=0;if(o.materialIndex.forEach((function(e,t){e!==c&&(i.addGroup(h,t-h,c),c=e,h=t)})),i.groups.length>0){var d=i.groups[i.groups.length-1],p=d.start+d.count;p!==o.materialIndex.length&&i.addGroup(p,o.materialIndex.length-p,c)}0===i.groups.length&&i.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(i,e,n,r),i},parseGeoNode:function(e,t){var n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];for(var r=0;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:t,weight:e.weights[i]})}))}))),n},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,r=0,i=!1,a=[],o=[],s=[],l=[],u=[],c=[],h=this;return e.vertexIndices.forEach((function(d,p){var m=!1;d<0&&(d=~d,m=!0);var v=[],g=[];if(a.push(3*d,3*d+1,3*d+2),e.color){var y=f(p,n,d,e.color);s.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){g.push(e.weight),v.push(e.id)})),g.length>4){i||(i=!0);var x=[0,0,0,0],b=[0,0,0,0];g.forEach((function(e,t){var n=e,r=v[t];b.forEach((function(e,t,i){if(n>e){i[t]=n,n=e;var a=x[t];x[t]=r,r=a}}))})),v=x,g=b}for(;g.length<4;)g.push(0),v.push(0);for(var M=0;M<4;++M)u.push(g[M]),c.push(v[M])}if(e.normal&&(y=f(p,n,d,e.normal),o.push(y[0],y[1],y[2])),e.material&&"AllSame"!==e.material.mappingType)var w=f(p,n,d,e.material)[0];e.uv&&e.uv.forEach((function(e,t){var r=f(p,n,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(r[0]),l[t].push(r[1])})),r++,m&&(h.genFace(t,e,a,w,o,s,l,u,c,r),n++,r=0,a=[],o=[],s=[],l=[],u=[],c=[])})),t},genFace:function(e,t,n,r,i,a,o,s,l,u){for(var c=2;c<u;c++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(c-1)]]),e.vertex.push(t.vertexPositions[n[3*(c-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(c-1)+2]]),e.vertex.push(t.vertexPositions[n[3*c]]),e.vertex.push(t.vertexPositions[n[3*c+1]]),e.vertex.push(t.vertexPositions[n[3*c+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(c-1)]),e.vertexWeights.push(s[4*(c-1)+1]),e.vertexWeights.push(s[4*(c-1)+2]),e.vertexWeights.push(s[4*(c-1)+3]),e.vertexWeights.push(s[4*c]),e.vertexWeights.push(s[4*c+1]),e.vertexWeights.push(s[4*c+2]),e.vertexWeights.push(s[4*c+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[4*(c-1)]),e.weightsIndices.push(l[4*(c-1)+1]),e.weightsIndices.push(l[4*(c-1)+2]),e.weightsIndices.push(l[4*(c-1)+3]),e.weightsIndices.push(l[4*c]),e.weightsIndices.push(l[4*c+1]),e.weightsIndices.push(l[4*c+2]),e.weightsIndices.push(l[4*c+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(c-1)]),e.colors.push(a[3*(c-1)+1]),e.colors.push(a[3*(c-1)+2]),e.colors.push(a[3*c]),e.colors.push(a[3*c+1]),e.colors.push(a[3*c+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(c-1)]),e.normal.push(i[3*(c-1)+1]),e.normal.push(i[3*(c-1)+2]),e.normal.push(i[3*c]),e.normal.push(i[3*c+1]),e.normal.push(i[3*c+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(o[n][0]),e.uvs[n].push(o[n][1]),e.uvs[n].push(o[n][2*(c-1)]),e.uvs[n].push(o[n][2*(c-1)+1]),e.uvs[n].push(o[n][2*c]),e.uvs[n].push(o[n][2*c+1])}))},addMorphTargets:function(t,n,r,i){if(0!==r.length){t.morphTargetsRelative=!0,t.morphAttributes.position=[];var a=this;r.forEach((function(r){r.rawTargets.forEach((function(r){var o=e.Objects.Geometry[r.geoID];void 0!==o&&a.genMorphGeometry(t,n,o,i,r.name)}))}))}},genMorphGeometry:function(e,t,n,r,i){for(var a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],o=void 0!==n.Vertices?n.Vertices.a:[],s=void 0!==n.Indexes?n.Indexes.a:[],l=3*e.attributes.position.count,u=new Float32Array(l),c=0;c<s.length;c++){var h=3*s[c];u[h]=o[3*c],u[h+1]=o[3*c+1],u[h+2]=o[3*c+2]}var d={vertexIndices:a,vertexPositions:u},p=this.genBuffers(d),f=new THREE.Float32BufferAttribute(p.vertex,3);f.name=i||n.attrName,f.applyMatrix4(r),e.morphAttributes.position.push(f)},parseNormals:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a,i=[];return"IndexToDirect"===n&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:t,referenceType:n}},parseUVs:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a,i=[];return"IndexToDirect"===n&&(i=e.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:t,referenceType:n}},parseVertexColors:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a,i=[];return"IndexToDirect"===n&&(i=e.ColorIndex.a),{dataSize:4,buffer:r,indices:i,mappingType:t,referenceType:n}},parseMaterialIndices:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var r=e.Materials.a,i=[],a=0;a<r.length;++a)i.push(a);return{dataSize:1,buffer:r,indices:i,mappingType:t,referenceType:n}},parseNurbsGeometry:function(e){if(void 0===THREE.NURBSCurve)return new THREE.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return new THREE.BufferGeometry;for(var n,r,i=t-1,a=e.KnotVector.a,o=[],s=e.Points.a,l=0,u=s.length;l<u;l+=4)o.push((new THREE.Vector4).fromArray(s,l));if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form)for(n=i,r=a.length-1-n,l=0;l<i;++l)o.push(o[l]);var c=new THREE.NURBSCurve(i,a,o,n,r).getPoints(7*o.length),h=new Float32Array(3*c.length);c.forEach((function(e,t){e.toArray(h,3*t)}));var d=new THREE.BufferGeometry;return d.setAttribute("position",new THREE.BufferAttribute(h,3)),d}},o.prototype={constructor:o,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var n in t){var r=t[n],i=this.addClip(r);e.push(i)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var n=this.parseAnimationLayers(t);return this.parseAnimStacks(n)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,n=new Map;for(var r in t){var i=t[r];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){var a={id:i.id,attr:i.attrName,curves:{}};n.set(a.id,a)}}return n},parseAnimationCurves:function(n){var r=e.Objects.AnimationCurve;for(var i in r){var a={id:r[i].id,times:r[i].KeyTime.a.map(d),values:r[i].KeyValueFloat.a},o=t.get(a.id);if(void 0!==o){var s=o.parents[0].ID,l=o.parents[0].relationship;l.match(/X/)?n.get(s).curves.x=a:l.match(/Y/)?n.get(s).curves.y=a:l.match(/Z/)?n.get(s).curves.z=a:l.match(/d|DeformPercent/)&&n.has(s)&&(n.get(s).curves.morph=a)}}},parseAnimationLayers:function(r){var i=e.Objects.AnimationLayer,a=new Map;for(var o in i){var s=[],l=t.get(parseInt(o));void 0!==l&&(l.children.forEach((function(i,a){if(r.has(i.ID)){var o=r.get(i.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===s[a]&&void 0!==(p=t.get(i.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID)){if(void 0===(u=e.Objects.Model[p.toString()]))return;var l={modelName:u.attrName?THREE.PropertyBinding.sanitizeNodeName(u.attrName):"",ID:u.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};n.traverse((function(e){e.ID===u.id&&(l.transform=e.matrix,e.userData.transformData&&(l.eulerOrder=e.userData.transformData.eulerOrder))})),l.transform||(l.transform=new THREE.Matrix4),"PreRotation"in u&&(l.preRotation=u.PreRotation.value),"PostRotation"in u&&(l.postRotation=u.PostRotation.value),s[a]=l}s[a]&&(s[a][o.attr]=o)}else if(void 0!==o.curves.morph){if(void 0===s[a]){var u,c=t.get(i.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,h=t.get(c).parents[0].ID,d=t.get(h).parents[0].ID,p=t.get(d).parents[0].ID;l={modelName:(u=e.Objects.Model[p]).attrName?THREE.PropertyBinding.sanitizeNodeName(u.attrName):"",morphName:e.Objects.Deformer[c].attrName},s[a]=l}s[a][o.attr]=o}}})),a.set(parseInt(o),s))}return a},parseAnimStacks:function(n){var r=e.Objects.AnimationStack,i={};for(var a in r){var o=t.get(parseInt(a)).children;o.length;var s=n.get(o[0].ID);i[a]={name:r[a].attrName,layer:s}}return i},addClip:function(e){var t=[],n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new THREE.AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],n=new THREE.Vector3,r=new THREE.Quaternion,i=new THREE.Vector3;if(e.transform&&e.transform.decompose(n,r,i),n=n.toArray(),r=(new THREE.Euler).setFromQuaternion(r,e.eulerOrder).toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var a=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==a&&t.push(a)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var o=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);void 0!==o&&t.push(o)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var l=this.generateMorphTrack(e);void 0!==l&&t.push(l)}return t},generateVectorTrack:function(e,t,n,r){var i=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(i,t,n);return new THREE.VectorKeyframeTrack(e+"."+r,i,a)},generateRotationTrack:function(e,t,n,r,i,a){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(THREE.MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(THREE.MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(THREE.MathUtils.degToRad));var o=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(o,t,n);void 0!==r&&((r=r.map(THREE.MathUtils.degToRad)).push(a),r=(new THREE.Euler).fromArray(r),r=(new THREE.Quaternion).setFromEuler(r)),void 0!==i&&((i=i.map(THREE.MathUtils.degToRad)).push(a),i=(new THREE.Euler).fromArray(i),i=(new THREE.Quaternion).setFromEuler(i).invert());for(var l=new THREE.Quaternion,u=new THREE.Euler,c=[],h=0;h<s.length;h+=3)u.set(s[h],s[h+1],s[h+2],a),l.setFromEuler(u),void 0!==r&&l.premultiply(r),void 0!==i&&l.multiply(i),l.toArray(c,h/3*4);return new THREE.QuaternionKeyframeTrack(e+".quaternion",o,c)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,r=t.values.map((function(e){return e/100})),i=n.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new THREE.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+i+"]",t.times,r)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t.sort((function(e,t){return e-t})).filter((function(e,t,n){return n.indexOf(e)==t}))},getKeyframeTrackValues:function(e,t,n){var r=n,i=[],a=-1,o=-1,s=-1;return e.forEach((function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==a){var n=t.x.values[a];i.push(n),r[0]=n}else i.push(r[0]);if(-1!==o){var l=t.y.values[o];i.push(l),r[1]=l}else i.push(r[1]);if(-1!==s){var u=t.z.values[s];i.push(u),r[2]=u}else i.push(r[2])})),i},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var n=e.values[t-1],r=e.values[t]-n,i=Math.abs(r);if(i>=180){for(var a=i/180,o=r/a,s=n+o,l=e.times[t-1],u=(e.times[t]-l)/a,c=l+u,h=[],d=[];c<e.times[t];)h.push(c),c+=u,d.push(s),s+=o;e.times=w(e.times,t,h),e.values=w(e.values,t,d)}}}},s.prototype={constructor:s,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new c,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,r){var i=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(!i&&!a){var o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,n[++r]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes},parseNodeBegin:function(e,t){var n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:n},a=this.parseNodeAttr(r),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in o?("PoseNode"===n?o.PoseNode.push(i):void 0!==o[n].id&&(o[n]={},o[n][o[n].id]=o[n]),""!==a.id&&(o[n][a.id]=i)):"number"==typeof a.id?(o[n]={},o[n][a.id]=i):"Properties70"!==n&&(o[n]="PoseNode"===n?[i]:i),"number"==typeof a.id&&(i.id=a.id),""!==a.name&&(i.attrName=a.name),""!==a.type&&(i.attrType=a.type),this.pushStack(i)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}},parseNodeProperty:function(e,t,n){var r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());var a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===r){var o=i.split(",").slice(1),s=parseInt(o[0]),l=parseInt(o[1]),u=i.split(",").slice(3);r="connections",function(e,t){for(var n=0,r=e.length,i=t.length;n<i;n++,r++)e[r]=t[n]}(i=[s,l],u=u.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===a[r]&&(a[r]=[])}"Node"===r&&(a.id=i),r in a&&Array.isArray(a[r])?a[r].push(i):"a"!==r?a[r]=i:a.a=i,this.setCurrentProp(a,r),"a"===r&&","!==i.slice(-1)&&(a.a=b(i))}else this.parseNodeSpecialProperty(e,r,i)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=b(t.a))},parseNodeSpecialProperty:function(e,t,n){var r=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=r[0],a=r[1],o=r[2],s=r[3],l=r[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=b(l)}this.getPrevNode()[i]={type:a,type2:o,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),i)}},l.prototype={constructor:l,parse:function(e){var t=new u(e);t.skip(23);var n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);for(var r=new c;!this.endOfContent(t);){var i=this.parseNode(t,n);null!==i&&r.add(i.name,i)}return r},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var n={},r=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();var a=e.getUint8(),o=e.getString(a);if(0===r)return null;for(var s=[],l=0;l<i;l++)s.push(this.parseProperty(e));var u=s.length>0?s[0]:"",c=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(n.singleProperty=1===i&&e.getOffset()===r;r>e.getOffset();){var d=this.parseNode(e,t);null!==d&&this.parseSubNode(o,n,d)}return n.propertyList=s,"number"==typeof u&&(n.id=u),""!==c&&(n.attrName=c),""!==h&&(n.attrType=h),""!==o&&(n.name=o),n},parseSubNode:function(e,t,n){if(!0===n.singleProperty){var r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if("Connections"===e&&"C"===n.name){var i=[];n.propertyList.forEach((function(e,t){0!==t&&i.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(i)}else if("Properties70"===n.name)Object.keys(n).forEach((function(e){t[e]=n[e]}));else if("Properties70"===e&&"P"===n.name){var a,o=n.propertyList[0],s=n.propertyList[1],l=n.propertyList[2],u=n.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),a="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[o]={type:s,type2:l,flag:u,value:a}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var n=e.getUint32();return e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r=e.getUint32(),i=e.getUint32(),a=e.getUint32();if(0===i)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}var o=new u(new Inflate(new Uint8Array(e.getArrayBuffer(a))).decompress().buffer);switch(t){case"b":case"c":return o.getBooleanArray(r);case"d":return o.getFloat64Array(r);case"f":return o.getFloat32Array(r);case"i":return o.getInt32Array(r);case"l":return o.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},u.prototype={constructor:u,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return!(1&~this.getUint8())},getBooleanArray:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295==(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],n=0;n<e;n++)t[n]=this.getUint8();var r=t.indexOf(0);return r>=0&&(t=t.slice(0,r)),THREE.LoaderUtils.decodeText(new Uint8Array(t))}},c.prototype={constructor:c,add:function(e,t){this[e]=t}};var p=[];function f(e,t,n,r){var i;switch(r.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0]}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);var a=i*r.dataSize,o=a+r.dataSize;return function(e,t,n,r){for(var i=n,a=0;i<r;i++,a++)e[a]=t[i];return e}(p,r.buffer,a,o)}var m=new THREE.Euler,v=new THREE.Vector3;function g(e){var t,n=new THREE.Matrix4,r=new THREE.Matrix4,i=new THREE.Matrix4,a=new THREE.Matrix4,o=new THREE.Matrix4,s=new THREE.Matrix4,l=new THREE.Matrix4,u=new THREE.Matrix4,c=new THREE.Matrix4,h=new THREE.Matrix4,d=new THREE.Matrix4,p=e.inheritType?e.inheritType:0;e.translation&&n.setPosition(v.fromArray(e.translation)),e.preRotation&&((t=e.preRotation.map(THREE.MathUtils.degToRad)).push(e.eulerOrder),r.makeRotationFromEuler(m.fromArray(t))),e.rotation&&((t=e.rotation.map(THREE.MathUtils.degToRad)).push(e.eulerOrder),i.makeRotationFromEuler(m.fromArray(t))),e.postRotation&&((t=e.postRotation.map(THREE.MathUtils.degToRad)).push(e.eulerOrder),a.makeRotationFromEuler(m.fromArray(t))),e.scale&&o.scale(v.fromArray(e.scale)),e.scalingOffset&&l.setPosition(v.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(v.fromArray(e.scalingPivot)),e.rotationOffset&&u.setPosition(v.fromArray(e.rotationOffset)),e.rotationPivot&&c.setPosition(v.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h=e.parentMatrixWorld);var f=r.multiply(i).multiply(a),g=new THREE.Matrix4;h.extractRotation(g),(new THREE.Matrix4).copyPosition(h);var y=new THREE.Matrix4;y.copy(g).invert().multiply(h);var x=new THREE.Matrix4;if(0===p)x.copy(g).multiply(f).multiply(y).multiply(o);else if(1===p)x.copy(g).multiply(y).multiply(f).multiply(o);else{var b=new THREE.Matrix4;b.copy(o).invert();var M=(new THREE.Matrix4).multiply(y).multiply(b);x.copy(g).multiply(f).multiply(M).multiply(o)}var w=new THREE.Matrix4;w.copy(c).invert();var _=new THREE.Matrix4;_.copy(s).invert();var A=new THREE.Matrix4;A.copy(n).multiply(u).multiply(c).multiply(r).multiply(i).multiply(a).multiply(w).multiply(l).multiply(s).multiply(o).multiply(_);var C=(new THREE.Matrix4).copyPosition(A),T=(new THREE.Matrix4).copy(h).multiply(C);return d.copyPosition(T),(new THREE.Matrix4).multiply(d).multiply(x)}function x(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?t[0]:t[e]}function b(e){return e.split(",").map((function(e){return parseFloat(e)}))}function M(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(e,t,n))}function w(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}return r}()},403:function(){THREE.RGBELoader=function(e){THREE.DataTextureLoader.call(this,e),this.type=THREE.UnsignedByteType},THREE.RGBELoader.prototype=Object.assign(Object.create(THREE.DataTextureLoader.prototype),{constructor:THREE.RGBELoader,parse:function(e){var t=function(e,t,n){t=t||1024;for(var r=e.pos,i=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));0>(i=s.indexOf("\n"))&&a<t&&r<e.byteLength;)o+=s,a+=s.length,r+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return-1<i&&(!1!==n&&(e.pos+=a+i+1),o+s.slice(0,i))},n=function(e,t,n,r){var i=e[t+3],a=Math.pow(2,i-128)/255;n[r+0]=THREE.DataUtils.toHalfFloat(e[t+0]*a),n[r+1]=THREE.DataUtils.toHalfFloat(e[t+1]*a),n[r+2]=THREE.DataUtils.toHalfFloat(e[t+2]*a)},r=new Uint8Array(e);r.pos=0;var i,a,o,s,l,u,c=function(e){var n,r,i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,s=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,l={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(n=t(e)))return-1;if(!(r=n.match(/^#\?(\S+)$/)))return-1;for(l.valid|=1,l.programtype=r[1],l.string+=n+"\n";!1!==(n=t(e));)if(l.string+=n+"\n","#"!==n.charAt(0)){if((r=n.match(i))&&(l.gamma=parseFloat(r[1],10)),(r=n.match(a))&&(l.exposure=parseFloat(r[1],10)),(r=n.match(o))&&(l.valid|=2,l.format=r[1]),(r=n.match(s))&&(l.valid|=4,l.height=parseInt(r[1],10),l.width=parseInt(r[2],10)),2&l.valid&&4&l.valid)break}else l.comments+=n+"\n";return 2&l.valid&&4&l.valid?l:-1}(r);if(-1!==c){var h=c.width,d=c.height,p=function(e,t,n){var r,i,a,o,s,l,u,c,h,d,p,f,m,v=t,g=n;if(v<8||v>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(v!==(e[2]<<8|e[3]))return-1;if(!(r=new Uint8Array(4*t*n)).length)return-1;for(i=0,a=0,c=4*v,m=new Uint8Array(4),l=new Uint8Array(c);g>0&&a<e.byteLength;){if(a+4>e.byteLength)return-1;if(m[0]=e[a++],m[1]=e[a++],m[2]=e[a++],m[3]=e[a++],2!=m[0]||2!=m[1]||(m[2]<<8|m[3])!=v)return-1;for(u=0;u<c&&a<e.byteLength;){if((f=(o=e[a++])>128)&&(o-=128),0===o||u+o>c)return-1;if(f)for(s=e[a++],h=0;h<o;h++)l[u++]=s;else l.set(e.subarray(a,a+o),u),u+=o,a+=o}for(d=v,h=0;h<d;h++)p=0,r[i]=l[h+p],p+=v,r[i+1]=l[h+p],p+=v,r[i+2]=l[h+p],p+=v,r[i+3]=l[h+p],i+=4;g--}return r}(r.subarray(r.pos),h,d);if(-1!==p){switch(this.type){case THREE.UnsignedByteType:var f=p,m=THREE.RGBEFormat,v=THREE.UnsignedByteType;break;case THREE.FloatType:for(var g=p.length/4*3,y=new Float32Array(g),x=0;x<g;x++)o=y,s=3*x,l=void 0,u=void 0,l=(i=p)[3+(a=4*x)],u=Math.pow(2,l-128)/255,o[s+0]=i[a+0]*u,o[s+1]=i[a+1]*u,o[s+2]=i[a+2]*u;f=y,m=THREE.RGBFormat,v=THREE.FloatType;break;case THREE.HalfFloatType:g=p.length/4*3;var b=new Uint16Array(g);for(x=0;x<g;x++)n(p,4*x,b,3*x);f=b,m=THREE.RGBFormat,v=THREE.HalfFloatType}return{width:h,height:d,data:f,header:c.string,gamma:c.gamma,exposure:c.exposure,format:m,type:v}}}return null},setDataType:function(e){return this.type=e,this},load:function(e,t,n,r){return THREE.DataTextureLoader.prototype.load.call(this,e,(function(e,n){switch(e.type){case THREE.UnsignedByteType:e.encoding=THREE.RGBEEncoding,e.minFilter=THREE.NearestFilter,e.magFilter=THREE.NearestFilter,e.generateMipmaps=!1,e.flipY=!0;break;case THREE.FloatType:case THREE.HalfFloatType:e.encoding=THREE.LinearEncoding,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)}),n,r)}})},90:function(){THREE.TTFLoader=function(e){THREE.Loader.call(this,e),this.reversed=!1},THREE.TTFLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:THREE.TTFLoader,load:function(e,t,n,r){var i=this,a=new THREE.FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(i.parse(n))}catch(t){r&&r(t),i.manager.itemError(e)}}),n,r)},parse:function(e){function t(e){var t,n=[];e.forEach((function(e){"m"===e.type.toLowerCase()?(t=[e],n.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)}));var r=[];return n.forEach((function(e){var t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};r.push(t);for(var n=e.length-1;n>0;n--){var i=e[n];t={type:i.type},void 0!==i.x2&&void 0!==i.y2?(t.x1=i.x2,t.y1=i.y2,t.x2=i.x1,t.y2=i.y1):void 0!==i.x1&&void 0!==i.y1&&(t.x1=i.x1,t.y1=i.y1),t.x=e[n-1].x,t.y=e[n-1].y,r.push(t)}})),r}return"undefined"==typeof opentype?null:function(e,n){for(var r=Math.round,i={},a=1e5/(72*(e.unitsPerEm||2048)),o=e.encoding.cmap.glyphIndexMap,s=Object.keys(o),l=0;l<s.length;l++){var u=s[l],c=e.glyphs.glyphs[o[u]];if(void 0!==u){var h={ha:r(c.advanceWidth*a),x_min:r(c.xMin*a),x_max:r(c.xMax*a),o:""};n&&(c.path.commands=t(c.path.commands)),c.path.commands.forEach((function(e){"c"===e.type.toLowerCase()&&(e.type="b"),h.o+=e.type.toLowerCase()+" ",void 0!==e.x&&void 0!==e.y&&(h.o+=r(e.x*a)+" "+r(e.y*a)+" "),void 0!==e.x1&&void 0!==e.y1&&(h.o+=r(e.x1*a)+" "+r(e.y1*a)+" "),void 0!==e.x2&&void 0!==e.y2&&(h.o+=r(e.x2*a)+" "+r(e.y2*a)+" ")})),i[String.fromCodePoint(c.unicode)]=h}}return{glyphs:i,familyName:e.getEnglishName("fullName"),ascender:r(e.ascender*a),descender:r(e.descender*a),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(opentype.parse(e),this.reversed)}})},111:function(){THREE.Lut=function(e,t){return this.lut=[],this.setColorMap(e,t),this},THREE.Lut.prototype={constructor:THREE.Lut,lut:[],map:[],n:256,minV:0,maxV:1,set:function(e){return e instanceof THREE.Lut&&this.copy(e),this},setMin:function(e){return this.minV=e,this},setMax:function(e){return this.maxV=e,this},setColorMap:function(e,t){this.map=THREE.ColorMapKeywords[e]||THREE.ColorMapKeywords.rainbow,this.n=t||32;var n=1/this.n;this.lut.length=0;for(var r=0;r<=1;r+=n)for(var i=0;i<this.map.length-1;i++)if(r>=this.map[i][0]&&r<this.map[i+1][0]){var a=this.map[i][0],o=this.map[i+1][0],s=new THREE.Color(this.map[i][1]),l=new THREE.Color(this.map[i+1][1]),u=s.lerp(l,(r-a)/(o-a));this.lut.push(u)}return this},copy:function(e){return this.lut=e.lut,this.map=e.map,this.n=e.n,this.minV=e.minV,this.maxV=e.maxV,this},getColor:function(e){e<=this.minV?e=this.minV:e>=this.maxV&&(e=this.maxV),e=(e-this.minV)/(this.maxV-this.minV);var t=Math.round(e*this.n);return t==this.n&&(t-=1),this.lut[t]},addColorMap:function(e,t){THREE.ColorMapKeywords[e]=t},createCanvas:function(){var e=document.createElement("canvas");return e.width=1,e.height=this.n,this.updateCanvas(e),e},updateCanvas:function(e){for(var t=e.getContext("2d",{alpha:!1}),n=t.getImageData(0,0,1,this.n),r=n.data,i=0,a=1/this.n,o=1;o>=0;o-=a)for(var s=this.map.length-1;s>=0;s--)if(o<this.map[s][0]&&o>=this.map[s-1][0]){var l=this.map[s-1][0],u=this.map[s][0],c=new THREE.Color(this.map[s-1][1]),h=new THREE.Color(this.map[s][1]),d=c.lerp(h,(o-l)/(u-l));r[4*i]=Math.round(255*d.r),r[4*i+1]=Math.round(255*d.g),r[4*i+2]=Math.round(255*d.b),r[4*i+3]=255,i+=1}return t.putImageData(n,0,0),e}},THREE.ColorMapKeywords={rainbow:[[0,255],[.2,65535],[.5,65280],[.8,16776960],[1,16711680]],cooltowarm:[[0,3952322],[.2,10206463],[.5,14474460],[.8,16163717],[1,11797542]],blackbody:[[0,0],[.2,7864320],[.5,15086080],[.8,16776960],[1,16777215]],grayscale:[[0,0],[.2,4210752],[.5,8355712],[.8,12566463],[1,16777215]]}},948:function(){var e,t,n;THREE.Lensflare=function(){THREE.Mesh.call(this,THREE.Lensflare.Geometry,new THREE.MeshBasicMaterial({opacity:0,transparent:!0})),this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);n.minFilter=THREE.NearestFilter,n.magFilter=THREE.NearestFilter,n.wrapS=THREE.ClampToEdgeWrapping,n.wrapT=THREE.ClampToEdgeWrapping;var r=new THREE.DataTexture(new Uint8Array(768),16,16,THREE.RGBFormat);r.minFilter=THREE.NearestFilter,r.magFilter=THREE.NearestFilter,r.wrapS=THREE.ClampToEdgeWrapping,r.wrapT=THREE.ClampToEdgeWrapping;var i=THREE.Lensflare.Geometry,a=new THREE.RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","void main() {","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","void main() {","\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );","}"].join("\n"),depthTest:!0,depthWrite:!1,transparent:!1}),o=new THREE.RawShaderMaterial({uniforms:{map:{value:n},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","\tvUV = uv;","\tgl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","varying vec2 vUV;","void main() {","\tgl_FragColor = texture2D( map, vUV );","}"].join("\n"),depthTest:!1,depthWrite:!1,transparent:!1}),s=new THREE.Mesh(i,a),l=[],u=THREE.LensflareElement.Shader,c=new THREE.RawShaderMaterial({uniforms:{map:{value:null},occlusionMap:{value:r},color:{value:new THREE.Color(16777215)},scale:{value:new THREE.Vector2},screenPosition:{value:new THREE.Vector3}},vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1}),h=new THREE.Mesh(i,c);this.addElement=function(e){l.push(e)};var d=new THREE.Vector2,p=new THREE.Vector2,f=new THREE.Box2,m=new THREE.Vector4;this.onBeforeRender=function(u,v,g){u.getCurrentViewport(m);var y=m.w/m.z,x=m.z/2,b=m.w/2,M=16/m.w;if(d.set(M*y,M),f.min.set(m.x,m.y),f.max.set(m.x+(m.z-16),m.y+(m.w-16)),t.setFromMatrixPosition(this.matrixWorld),t.applyMatrix4(g.matrixWorldInverse),!(t.z>0)&&(e.copy(t).applyMatrix4(g.projectionMatrix),p.x=m.x+e.x*x+x-8,p.y=m.y+e.y*b+b-8,f.containsPoint(p))){u.copyFramebufferToTexture(p,n),(T=a.uniforms).scale.value=d,T.screenPosition.value=e,u.renderBufferDirect(g,null,i,a,s,null),u.copyFramebufferToTexture(p,r),(T=o.uniforms).scale.value=d,T.screenPosition.value=e,u.renderBufferDirect(g,null,i,o,s,null);for(var w=2*-e.x,_=2*-e.y,A=0,C=l.length;A<C;A++){var T,S=l[A];(T=c.uniforms).color.value.copy(S.color),T.map.value=S.texture,T.screenPosition.value.x=e.x+w*S.distance,T.screenPosition.value.y=e.y+_*S.distance,M=S.size/m.w,y=m.w/m.z,T.scale.value.set(M*y,M),c.uniformsNeedUpdate=!0,u.renderBufferDirect(g,null,i,c,h,null)}}},this.dispose=function(){a.dispose(),o.dispose(),c.dispose(),n.dispose(),r.dispose();for(var e=0,t=l.length;e<t;e++)l[e].texture.dispose()}},THREE.Lensflare.prototype=Object.create(THREE.Mesh.prototype),THREE.Lensflare.prototype.constructor=THREE.Lensflare,THREE.Lensflare.prototype.isLensflare=!0,THREE.LensflareElement=function(e,t,n,r){this.texture=e,this.size=t||1,this.distance=n||0,this.color=r||new THREE.Color(16777215)},THREE.LensflareElement.Shader={uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:["precision highp float;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform sampler2D occlusionMap;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position.xy;","\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\tvVisibility =        visibility.r / 9.0;","\tvVisibility *= 1.0 - visibility.g / 9.0;","\tvVisibility *=       visibility.b / 9.0;","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D map;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvec4 texture = texture2D( map, vUV );","\ttexture.a *= vVisibility;","\tgl_FragColor = texture;","\tgl_FragColor.rgb *= color;","}"].join("\n")},THREE.Lensflare.Geometry=(e=new THREE.BufferGeometry,t=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),n=new THREE.InterleavedBuffer(t,5),e.setIndex([0,1,2,0,2,3]),e.setAttribute("position",new THREE.InterleavedBufferAttribute(n,3,0,!1)),e.setAttribute("uv",new THREE.InterleavedBufferAttribute(n,2,3,!1)),e)},662:function(){var e,t,n;THREE.EffectComposer=function(e,t){if(this.renderer=e,void 0===t){var n={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},r=e.getSize(new THREE.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,(t=new THREE.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],THREE.CopyShader,THREE.ShaderPass,this.copyPass=new THREE.ShaderPass(THREE.CopyShader),this.clock=new THREE.Clock},Object.assign(THREE.EffectComposer.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},removePass:function(e){var t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)},isLastEnabledPass:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0},render:function(e){void 0===e&&(e=this.clock.getDelta());var t,n,r=this.renderer.getRenderTarget(),i=!1,a=this.passes.length;for(n=0;n<a;n++)if(!1!==(t=this.passes[n]).enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),t.needsSwap){if(i){var o=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),s.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(t instanceof THREE.MaskPass?i=!0:t instanceof THREE.ClearMaskPass&&(i=!1))}this.renderer.setRenderTarget(r)},reset:function(e){if(void 0===e){var t=this.renderer.getSize(new THREE.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this._width=e,this._height=t;var n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(n,r)},setPixelRatio:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}),THREE.Pass=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1},Object.assign(THREE.Pass.prototype,{setSize:function(){},render:function(){}}),THREE.Pass.FullScreenQuad=(e=new THREE.OrthographicCamera(-1,1,1,-1,0,1),t=new THREE.PlaneBufferGeometry(2,2),n=function(e){this._mesh=new THREE.Mesh(t,e)},Object.defineProperty(n.prototype,"material",{get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}),Object.assign(n.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(t){t.render(this._mesh,e)}}),n)},186:function(){THREE.OutlinePass=function(e,t,n,r){this.renderScene=t,this.renderCamera=n,this.selectedObjects=void 0!==r?r:[],this.visibleEdgeColor=new THREE.Color(1,1,1),this.hiddenEdgeColor=new THREE.Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,THREE.Pass.call(this),this.resolution=void 0!==e?new THREE.Vector2(e.x,e.y):new THREE.Vector2(256,256);var i={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},a=Math.round(this.resolution.x/this.downSampleRatio),o=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new THREE.MeshBasicMaterial({color:16777215}),this.maskBufferMaterial.side=THREE.DoubleSide,this.renderTargetMaskBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new THREE.MeshDepthMaterial,this.depthMaterial.side=THREE.DoubleSide,this.depthMaterial.depthPacking=THREE.RGBADepthPacking,this.depthMaterial.blending=THREE.NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=THREE.DoubleSide,this.prepareMaskMaterial.fragmentShader=function(e,t){var n=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,n+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new THREE.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new THREE.WebGLRenderTarget(Math.round(a/2),Math.round(o/2),i),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new THREE.WebGLRenderTarget(a,o,i),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new THREE.WebGLRenderTarget(Math.round(a/2),Math.round(o/2),i),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(a,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(a/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial(),THREE.CopyShader;var s=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(s.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:THREE.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.fsQuad=new THREE.Pass.FullScreenQuad(null),this.tempPulseColor1=new THREE.Color,this.tempPulseColor2=new THREE.Color,this.textureMatrix=new THREE.Matrix4},THREE.OutlinePass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.OutlinePass,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(e,t){this.renderTargetMaskBuffer.setSize(e,t);var n=Math.round(e/this.downSampleRatio),r=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(n,r),this.renderTargetBlurBuffer1.setSize(n,r),this.renderTargetEdgeBuffer1.setSize(n,r),this.separableBlurMaterial1.uniforms.texSize.value.set(n,r),n=Math.round(n/2),r=Math.round(r/2),this.renderTargetBlurBuffer2.setSize(n,r),this.renderTargetEdgeBuffer2.setSize(n,r),this.separableBlurMaterial2.uniforms.texSize.value.set(n,r)},changeVisibilityOfSelectedObjects:function(e){var t=this._visibilityCache;function n(n){n.isMesh&&(!0===e?n.visible=t.get(n):(t.set(n,n.visible),n.visible=e))}for(var r=0;r<this.selectedObjects.length;r++)this.selectedObjects[r].traverse(n)},changeVisibilityOfNonSelectedObjects:function(e){var t=this._visibilityCache,n=[];function r(e){e.isMesh&&n.push(e)}for(var i=0;i<this.selectedObjects.length;i++)this.selectedObjects[i].traverse(r);this.renderScene.traverse((function(r){if(r.isMesh||r.isSprite){for(var i=!1,a=0;a<n.length;a++)if(n[a].id===r.id){i=!0;break}if(!1===i){var o=r.visible;!1!==e&&!0!==t.get(r)||(r.visible=e),t.set(r,o)}}else(r.isPoints||r.isLine)&&(!0===e?r.visible=t.get(r):(t.set(r,r.visible),r.visible=e))}))},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(e,t,n,r,i){if(this.selectedObjects.length>0){this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();var a=e.autoClear;e.autoClear=!1,i&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var o=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=o,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var s=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(s),this.tempPulseColor2.multiplyScalar(s)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=THREE.OutlinePass.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=THREE.OutlinePass.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=THREE.OutlinePass.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=THREE.OutlinePass.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,i&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(n),this.fsQuad.render(e),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=n.texture,e.setRenderTarget(null),this.fsQuad.render(e))},getPrepareMaskMaterial:function(){return new THREE.ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new THREE.Vector2(.5,.5)},textureMatrix:{value:null}},vertexShader:["#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\t#include <skinbase_vertex>","\t#include <begin_vertex>","\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\tvPosition = mvPosition;","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},visibleEdgeColor:{value:new THREE.Vector3(1,1,1)},hiddenEdgeColor:{value:new THREE.Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(e){return new THREE.ShaderMaterial({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\t\t\t\t}"})},getOverlayMaterial:function(){return new THREE.ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}),THREE.OutlinePass.BlurDirectionX=new THREE.Vector2(1,0),THREE.OutlinePass.BlurDirectionY=new THREE.Vector2(0,1)},664:function(){THREE.RenderPass=function(e,t,n,r,i){THREE.Pass.call(this),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1},THREE.RenderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.RenderPass,render:function(e,t,n){var r,i,a,o=e.autoClear;e.autoClear=!1,void 0!==this.overrideMaterial&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(r=e.getClearColor().getHex(),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(r,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=a),e.autoClear=o}})},132:function(){THREE.SSAARenderPass=function(e,t,n,r){THREE.Pass.call(this),this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==n?n:0,this.clearAlpha=void 0!==r?r:0,THREE.CopyShader;var i=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(i.uniforms),this.copyMaterial=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1}),this.fsQuad=new THREE.Pass.FullScreenQuad(this.copyMaterial)},THREE.SSAARenderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.SSAARenderPass,dispose:function(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)},setSize:function(e,t){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(e,t)},render:function(e,t,n){this.sampleRenderTarget||(this.sampleRenderTarget=new THREE.WebGLRenderTarget(n.width,n.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");var r=THREE.SSAARenderPass.JitterVectors[Math.max(0,Math.min(this.sampleLevel,5))],i=e.autoClear;e.autoClear=!1;var a=e.getClearColor().getHex(),o=e.getClearAlpha(),s=1/r.length;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;for(var l=n.width,u=n.height,c=0;c<r.length;c++){var h=r[c];this.camera.setViewOffset&&this.camera.setViewOffset(l,u,.0625*h[0],.0625*h[1],l,u);var d=s;this.unbiased&&(d+=.03125*((c+.5)/r.length-.5)),this.copyUniforms.opacity.value=d,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.renderToScreen?null:t),0===c&&(e.setClearColor(0,0),e.clear()),this.fsQuad.render(e)}this.camera.clearViewOffset&&this.camera.clearViewOffset(),e.autoClear=i,e.setClearColor(a,o)}}),THREE.SSAARenderPass.JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]]},133:function(){THREE.ShaderPass=function(e,t){THREE.Pass.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof THREE.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new THREE.Pass.FullScreenQuad(this.material)},THREE.ShaderPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.ShaderPass,render:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}})},710:function(){THREE.CSS2DObject=function(e){THREE.Object3D.call(this),this.element=e||document.createElement("div"),this.element.style.position="absolute",this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}))},THREE.CSS2DObject.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.CSS2DObject,copy:function(e,t){return THREE.Object3D.prototype.copy.call(this,e,t),this.element=e.element.cloneNode(!0),this}}),THREE.CSS2DRenderer=function(){var e,t,n,r,i=this,a=new THREE.Vector3,o=new THREE.Matrix4,s=new THREE.Matrix4,l={objects:new WeakMap},u=document.createElement("div");u.style.overflow="hidden",this.domElement=u,this.getSize=function(){return{width:e,height:t}},this.setSize=function(i,a){n=(e=i)/2,r=(t=a)/2,u.style.width=i+"px",u.style.height=a+"px"};var c,h,d=function(e,t,o){if(e instanceof THREE.CSS2DObject){e.onBeforeRender(i,t,o),a.setFromMatrixPosition(e.matrixWorld),a.applyMatrix4(s);var c=e.element,h="translate(-50%,-50%) translate("+(a.x*n+n)+"px,"+(-a.y*r+r)+"px)";c.style.WebkitTransform=h,c.style.MozTransform=h,c.style.oTransform=h,c.style.transform=h,c.style.display=e.visible&&a.z>=-1&&a.z<=1?"":"none";var f={distanceToCameraSquared:p(o,e)};l.objects.set(e,f),c.parentNode!==u&&u.appendChild(c),e.onAfterRender(i,t,o)}for(var m=0,v=e.children.length;m<v;m++)d(e.children[m],t,o)},p=(c=new THREE.Vector3,h=new THREE.Vector3,function(e,t){return c.setFromMatrixPosition(e.matrixWorld),h.setFromMatrixPosition(t.matrixWorld),c.distanceToSquared(h)}),f=function(e){for(var t=function(e){var t=[];return e.traverse((function(e){e instanceof THREE.CSS2DObject&&t.push(e)})),t}(e).sort((function(e,t){return l.objects.get(e).distanceToCameraSquared-l.objects.get(t).distanceToCameraSquared})),n=t.length,r=0,i=t.length;r<i;r++)t[r].element.style.zIndex=n-r};this.render=function(e,t){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),o.copy(t.matrixWorldInverse),s.multiplyMatrices(t.projectionMatrix,o),d(e,e,t),f(e)}}},516:function(){THREE.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")}},521:function(){THREE.FXAAShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immediates.","    // Immediates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")}},377:function(){THREE.LuminosityHighPassShader={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new THREE.Color(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","\tgl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")}},811:function(e,t,n){n.d(t,{A:function(){return r}});var r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAdaVRYdENvbW1lbnQAAAAAAENyZWF0ZWQgd2l0aCBHSU1QZC5lBwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAnZQTFRFR3BMfHx8fn5+enp6fX19fn5+fHx8e3t7enp6f39/e3t7fHx8fn5+e3t7fHx8fHx8fHx8fHx8fHx8enp6e3t7e3t7e3t7e3t7fHx8fHx8e3t7fHx8fHx8fHx8fX19fX19fX19eXl5eHh4fHx8enp6fX19fHx8fHx8fX19fHx8fHx8fHx8fHx8e3t7fHx8e3t7fX19fX19fHx8fHx8fHx8fHx8fHx8fX19fHx8fX19fX19fHx8fHx8fX19fX19fX19fX19fX19eXl5d3d3eXl5fHx8fHx8eXl5fHx8eHh4fX19e3t7fHx8e3t7enp6fX19fHx8fX19fHx8e3t7enp6e3t7f39/fX19fHx8fX19fHx8eXl5e3t7e3t7e3t7enp6fHx8fX19fHx8fHx8fn5+fHx8fHx8enp6e3t7fHx8enp6e3t7e3t7fHx8fHx8fX19enp6fHx8e3t7fX19fX19enp6fHx8fHx8e3t7fHx8e3t7fX19fX19fHx8f39/fn5+fHx8fHx8e3t7fHx8fX19fHx8e3t7fX19fHx8fHx8goKCf39/gYGBfX19fX19fHx8goKCfX19e3t7hoaGgYGBfX19fn5+gYGBfX19fn5+f39/fn5+fn5+iIiIfX19g4ODfX19h4eHlZWVm5ubh4eHkpKShYWFioqKo6OjhYWFf39/kJCQfn5+gYGBkJCQoKCgj4+PmZmZi4uLiIiIgoKCg4ODn5+fgICAioqKkZGRiIiIkJCQf39/kpKSgICAwMDApqamtbW1jo6Otra2m5ubs7Ozurq6pKSkqKiompqan5+fubm5rq6utLS0q6urv7+/nZ2dsLCwngGT5QAAAL90Uk5TAAQEDAQIjhsEBAxxDBQzNx8+VxQQRRcjVDBQOmp5k6sICAgMCB9NbRcqXFl3SnxNjHdudJiQf5itnsqboa2Qpra1DAQECBAfGwQMMyMIH18UGyw3JioIOiY+jyNyMIYbRmoXShRiZEo+pTcsWbSaSjN1ZyMQKoCZZKNBWYew2tGDlGKKjrief4eG2cnnbp297qKc8N+zus6wnrWypPy92an6/P3o/uPy/uHR9bbZ/f70/fbt2t/+1vT58/vK+9g+tO6mAAABkElEQVQ4y2NgGIHAhUNFUYWDA5c0h4IIb7yfuwcvMyNWeRYeMU3+SFFRQb4IMWYWLPLMAt5q/onq6jJaCZLsXhiGMHEJhGvHxEWZshmUGUnwsyuiK/BlD87RM8m0qLWtNGfTEeLj9UQzQCRISicv16puSlf3DBs2bv0QZlTPsLJnpLHJ109YuG7RhvmzLDsqsgJQ3ckqnl9Y3toz99DJAytWT18gx13FroSiQLlUQq+tf/LSIycOH1y8craJrK4AK4oCrmyh9knzll84d3r/sfVL1lib6ReHoShg1pQws3bcvO3o+f1nNy6bai6brIpqAk+0rnGj/Jadx89cPLVplbwctyi7K5ovBIuabaZt3bF39661DpY1qXy8qGHJ5BYqZWg3x2HP9n1WjhNbuNV8lNFCklWDv1pWbqa9rYV9H5uhEJ+wM5oCTh5VaW3jTjZTO4MGbiF+tFCAqBAokGqSMeqV0UqPDXTCEt9MXMLiktKCgtKS4sIKnNiTFFeJhlhSiggXI85EycTJyMLJOdiyCgBELGHsripAggAAAABJRU5ErkJggg=="}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==("undefined"==typeof globalThis?"undefined":(0,y.default)(globalThis)))return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==("undefined"==typeof window?"undefined":(0,y.default)(window)))return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e};var r={};return function(){n.r(r),n.d(r,{Bustard:function(){return ni}});var e,t,i=n(543),a=n.n(i),s=n(964),h=function(){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if("object"!=("undefined"==typeof WebAssembly?"undefined":(0,y.default)(WebAssembly)))return{supported:!1};var n,r="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB";WebAssembly.validate(e)&&(r="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB");var i=WebAssembly.instantiate(function(e){for(var n=new Uint8Array(e.length),r=0;r<e.length;++r){var i=e.charCodeAt(r);n[r]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}var a=0;for(r=0;r<e.length;++r)n[a++]=n[r]<60?t[n[r]]:64*(n[r]-60)+n[++r];return n.buffer.slice(0,a)}(r),{}).then((function(e){(n=e.instance).exports.__wasm_call_ctors()}));function a(e,t,r,i,a,o){var s=n.exports.sbrk,l=r+3&-4,u=s(l*i),c=s(a.length),h=new Uint8Array(n.exports.memory.buffer);h.set(a,c);var d=e(u,r,i,c,a.length);if(0==d&&o&&o(u,l,i),t.set(h.subarray(u,u+r*i)),s(u-s(0)),0!=d)throw new Error("Malformed buffer data: "+d)}var o={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},s={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:i,supported:!0,decodeVertexBuffer:function(e,t,r,i,s){a(n.exports.meshopt_decodeVertexBuffer,e,t,r,i,n.exports[o[s]])},decodeIndexBuffer:function(e,t,r,i){a(n.exports.meshopt_decodeIndexBuffer,e,t,r,i)},decodeIndexSequence:function(e,t,r,i){a(n.exports.meshopt_decodeIndexSequence,e,t,r,i)},decodeGltfBuffer:function(e,t,r,i,l,u){a(n.exports[s[l]],e,t,r,i,n.exports[o[u]])}}}(),d=function(){s.InstancedBufferGeometry.call(this),this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new s.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new s.Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))};d.prototype=Object.assign(Object.create(s.InstancedBufferGeometry.prototype),{constructor:d,isLineSegmentsGeometry:!0,applyMatrix4:function(e){var t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var n=new s.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceStart",new s.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceEnd",new s.InterleavedBufferAttribute(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(e){var t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));var n=new s.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceColorStart",new s.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceColorEnd",new s.InterleavedBufferAttribute(n,3,3)),this},fromWireframeGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromEdgesGeometry:function(e){return this.setPositions(e.attributes.position.array),this},fromMesh:function(e){return this.fromWireframeGeometry(new s.WireframeGeometry(e.geometry)),this},fromLineSegments:function(e){var t=e.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.attributes.position.array),this},computeBoundingBox:(t=new s.Box3,function(){null===this.boundingBox&&(this.boundingBox=new s.Box3);var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;void 0!==e&&void 0!==n&&(this.boundingBox.setFromBufferAttribute(e),t.setFromBufferAttribute(n),this.boundingBox.union(t))}),computeBoundingSphere:(e=new s.Vector3,function(){null===this.boundingSphere&&(this.boundingSphere=new s.Sphere),null===this.boundingBox&&this.computeBoundingBox();var t=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(void 0!==t&&void 0!==n){var r=this.boundingSphere.center;this.boundingBox.getCenter(r);for(var i=0,a=0,o=t.count;a<o;a++)e.fromBufferAttribute(t,a),i=Math.max(i,r.distanceToSquared(e)),e.fromBufferAttribute(n,a),i=Math.max(i,r.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)}}),toJSON:function(){},applyMatrix:function(e){return this.applyMatrix4(e)}}),s.UniformsLib.line={linewidth:{value:1},resolution:{value:new s.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},dashOffset:{value:0},gapSize:{value:1},opacity:{value:1}},s.ShaderLib.line={uniforms:s.UniformsUtils.merge([s.UniformsLib.common,s.UniformsLib.fog,s.UniformsLib.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};var p=function(e){s.ShaderMaterial.call(this,{type:"LineMaterial",uniforms:s.UniformsUtils.clone(s.ShaderLib.line.uniforms),vertexShader:s.ShaderLib.line.vertexShader,fragmentShader:s.ShaderLib.line.fragmentShader,clipping:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}}}),this.setValues(e)};(p.prototype=Object.create(s.ShaderMaterial.prototype)).constructor=p,p.prototype.isLineMaterial=!0;var f,x,b=function(e,t){void 0===e&&(e=new d),void 0===t&&(t=new p({color:16777215*Math.random()})),s.Mesh.call(this,e,t),this.type="LineSegments2"};b.prototype=Object.assign(Object.create(s.Mesh.prototype),{constructor:b,isLineSegments2:!0,computeLineDistances:(f=new s.Vector3,x=new s.Vector3,function(){for(var e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,r=new Float32Array(2*t.data.count),i=0,a=0,o=t.data.count;i<o;i++,a+=2)f.fromBufferAttribute(t,i),x.fromBufferAttribute(n,i),r[a]=0===a?0:r[a-1],r[a+1]=r[a]+f.distanceTo(x);var l=new s.InstancedInterleavedBuffer(r,2,1);return e.setAttribute("instanceDistanceStart",new s.InterleavedBufferAttribute(l,1,0)),e.setAttribute("instanceDistanceEnd",new s.InterleavedBufferAttribute(l,1,1)),this}),raycast:function(){var e=new s.Vector4,t=new s.Vector4,n=new s.Vector4,r=new s.Vector3,i=new s.Matrix4,a=new s.Line3,o=new s.Vector3;return function(l,u){l.camera;var c=void 0!==l.params.Line2&&l.params.Line2.threshold||0,h=l.ray,d=l.camera,p=d.projectionMatrix,f=this.geometry,m=this.material,v=m.resolution,g=m.linewidth+c,y=f.attributes.instanceStart,x=f.attributes.instanceEnd;h.at(1,n),n.w=1,n.applyMatrix4(d.matrixWorldInverse),n.applyMatrix4(p),n.multiplyScalar(1/n.w),n.x*=v.x/2,n.y*=v.y/2,n.z=0,r.copy(n);var b=this.matrixWorld;i.multiplyMatrices(d.matrixWorldInverse,b);for(var M=0,w=y.count;M<w;M++){e.fromBufferAttribute(y,M),t.fromBufferAttribute(x,M),e.w=1,t.w=1,e.applyMatrix4(i),t.applyMatrix4(i),e.applyMatrix4(p),t.applyMatrix4(p),e.multiplyScalar(1/e.w),t.multiplyScalar(1/t.w);var _=e.z<-1&&t.z<-1,A=e.z>1&&t.z>1;if(!_&&!A){e.x*=v.x/2,e.y*=v.y/2,t.x*=v.x/2,t.y*=v.y/2,a.start.copy(e),a.start.z=0,a.end.copy(t),a.end.z=0;var C=a.closestPointToPointParameter(r,!0);a.at(C,o);var T=s.MathUtils.lerp(e.z,t.z,C),S=T>=-1&&T<=1,E=r.distanceTo(o)<.5*g;if(S&&E){a.start.fromBufferAttribute(y,M),a.end.fromBufferAttribute(x,M),a.start.applyMatrix4(b),a.end.applyMatrix4(b);var L=new s.Vector3,P=new s.Vector3;h.distanceSqToSegment(a.start,a.end,P,L),u.push({point:P,pointOnLine:L,distance:h.origin.distanceTo(P),object:this,face:null,faceIndex:M,uv:null,uv2:null})}}}}}()});var _=function(){d.call(this),this.type="LineGeometry"};_.prototype=Object.assign(Object.create(d.prototype),{constructor:_,isLineGeometry:!0,setPositions:function(e){for(var t=e.length-3,n=new Float32Array(2*t),r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return d.prototype.setPositions.call(this,n),this},setColors:function(e){for(var t=e.length-3,n=new Float32Array(2*t),r=0;r<t;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return d.prototype.setColors.call(this,n),this},fromLine:function(e){var t=e.geometry;return t.isGeometry?this.setPositions(t.vertices):t.isBufferGeometry&&this.setPositions(t.attributes.position.array),this},copy:function(){return this}});var A=function(e,t){void 0===e&&(e=new _),void 0===t&&(t=new p({color:16777215*Math.random()})),b.call(this,e,t),this.type="Line2"};A.prototype=Object.assign(Object.create(b.prototype),{constructor:A,isLine2:!0}),n.g.THREE=s,s.MeshoptDecoder=h,s.Line2=A,s.LineMaterial=p,s.LineGeometry=_,n(324),n(139),n(710),n(149),n(446),n(595),n(548),n(818),n(403),n(90),n(516),n(521),n(377),n(948),n(662),n(132),n(664),n(133),n(186),n(395),n(111);var S,E=n.g.THREE,L=function(e,t){return L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},L(e,t)};function P(e){return e.isPerspectiveCamera}function B(e){return e.isOrthographicCamera}!function(e){e[e.NONE=0]="NONE",e[e.ROTATE=1]="ROTATE",e[e.TRUCK=2]="TRUCK",e[e.OFFSET=3]="OFFSET",e[e.DOLLY=4]="DOLLY",e[e.ZOOM=5]="ZOOM",e[e.TOUCH_ROTATE=6]="TOUCH_ROTATE",e[e.TOUCH_TRUCK=7]="TOUCH_TRUCK",e[e.TOUCH_OFFSET=8]="TOUCH_OFFSET",e[e.TOUCH_DOLLY=9]="TOUCH_DOLLY",e[e.TOUCH_ZOOM=10]="TOUCH_ZOOM",e[e.TOUCH_DOLLY_TRUCK=11]="TOUCH_DOLLY_TRUCK",e[e.TOUCH_DOLLY_OFFSET=12]="TOUCH_DOLLY_OFFSET",e[e.TOUCH_ZOOM_TRUCK=13]="TOUCH_ZOOM_TRUCK",e[e.TOUCH_ZOOM_OFFSET=14]="TOUCH_ZOOM_OFFSET"}(S||(S={}));var D=2*Math.PI,k=Math.PI/2,R=1e-5;function O(e,t){return void 0===t&&(t=R),Math.abs(e)<t}function I(e,t,n){return void 0===n&&(n=R),O(e-t,n)}function F(e,t){return Math.round(e/t)*t}function N(e){return isFinite(e)?e:e<0?-Number.MAX_VALUE:Number.MAX_VALUE}function z(e){return Math.abs(e)<Number.MAX_VALUE?e:e*(1/0)}function U(e,t){t.set(0,0),e.forEach((function(e){t.x+=e.clientX,t.y+=e.clientY})),t.x/=e.length,t.y/=e.length}function H(e,t){return!!B(e)}function j(e){return e.invert?e.invert():e.inverse(),e}var G,V,W,X,Y,J,Q,q,K,Z,$,ee,te,ne,re,ie,ae,oe,se,le,ue=function(){function e(){this._listeners={}}return e.prototype.addEventListener=function(e,t){var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},e.prototype.removeEventListener=function(e,t){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}},e.prototype.removeAllEventListeners=function(e){e?Array.isArray(this._listeners[e])&&(this._listeners[e].length=0):this._listeners={}},e.prototype.dispatchEvent=function(e){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e)}},e}(),ce="undefined"!=typeof window,he=ce&&/Mac/.test(navigator.platform),de=!(ce&&"PointerEvent"in window),pe=Object.freeze(S),fe=1/8,me=function(e){function t(t,n){var r=e.call(this)||this;if(r.minPolarAngle=0,r.maxPolarAngle=Math.PI,r.minAzimuthAngle=-1/0,r.maxAzimuthAngle=1/0,r.minDistance=0,r.maxDistance=1/0,r.infinityDolly=!1,r.minZoom=.01,r.maxZoom=1/0,r.dampingFactor=.05,r.draggingDampingFactor=.25,r.azimuthRotateSpeed=1,r.polarRotateSpeed=1,r.dollySpeed=1,r.truckSpeed=2,r.dollyToCursor=!1,r.dragToOffset=!1,r.verticalDragToForward=!1,r.boundaryFriction=0,r.restThreshold=.01,r.colliderMeshes=[],r.cancel=function(){},r._enabled=!0,r._state=S.NONE,r._viewport=null,r._dollyControlAmount=0,r._hasRested=!0,r._boundaryEnclosesCamera=!1,r._needsUpdate=!0,r._updatedLastTime=!1,r._elementRect=new DOMRect,r._activePointers=[],r._truckInternal=function(e,t,n){if(P(r._camera)){var i=J.copy(r._camera.position).sub(r._target),a=r._camera.getEffectiveFOV()*G.MathUtils.DEG2RAD,o=i.length()*Math.tan(.5*a),s=r.truckSpeed*e*o/r._elementRect.height,l=r.truckSpeed*t*o/r._elementRect.height;r.verticalDragToForward?(n?r.setFocalOffset(r._focalOffsetEnd.x+s,r._focalOffsetEnd.y,r._focalOffsetEnd.z,!0):r.truck(s,0,!0),r.forward(-l,!0)):n?r.setFocalOffset(r._focalOffsetEnd.x+s,r._focalOffsetEnd.y+l,r._focalOffsetEnd.z,!0):r.truck(s,l,!0)}else if(B(r._camera)){var u=r._camera;s=e*(u.right-u.left)/u.zoom/r._elementRect.width,l=t*(u.top-u.bottom)/u.zoom/r._elementRect.height,n?r.setFocalOffset(r._focalOffsetEnd.x+s,r._focalOffsetEnd.y+l,r._focalOffsetEnd.z,!0):r.truck(s,l,!0)}},r._rotateInternal=function(e,t){var n=D*r.azimuthRotateSpeed*e/r._elementRect.height,i=D*r.polarRotateSpeed*t/r._elementRect.height;r.rotate(n,i,!0)},r._dollyInternal=function(e,t,n){var i=Math.pow(.95,-e*r.dollySpeed),a=r._sphericalEnd.radius*i,o=r._sphericalEnd.radius,s=o*(e>=0?-1:1);r.dollyTo(a),r.infinityDolly&&(a<r.minDistance||r.maxDistance===r.minDistance)&&(r._camera.getWorldDirection(J),r._targetEnd.add(J.normalize().multiplyScalar(s)),r._target.add(J.normalize().multiplyScalar(s))),r.dollyToCursor&&(r._dollyControlAmount+=r._sphericalEnd.radius-o,r.infinityDolly&&(a<r.minDistance||r.maxDistance===r.minDistance)&&(r._dollyControlAmount-=s),r._dollyControlCoord.set(t,n))},r._zoomInternal=function(e,t,n){var i=Math.pow(.95,e*r.dollySpeed);r.zoomTo(r._zoom*i),r.dollyToCursor&&(r._dollyControlAmount=r._zoomEnd,r._dollyControlCoord.set(t,n))},r._camera=t,r._yAxisUpSpace=(new G.Quaternion).setFromUnitVectors(r._camera.up,W),r._yAxisUpSpaceInverse=j(r._yAxisUpSpace.clone()),r._state=S.NONE,r._domElement=n,r._domElement.style.touchAction="none",r._target=new G.Vector3,r._targetEnd=r._target.clone(),r._focalOffset=new G.Vector3,r._focalOffsetEnd=r._focalOffset.clone(),r._spherical=(new G.Spherical).setFromVector3(J.copy(r._camera.position).applyQuaternion(r._yAxisUpSpace)),r._sphericalEnd=r._spherical.clone(),r._zoom=r._camera.zoom,r._zoomEnd=r._zoom,r._nearPlaneCorners=[new G.Vector3,new G.Vector3,new G.Vector3,new G.Vector3],r._updateNearPlaneCorners(),r._boundary=new G.Box3(new G.Vector3(-1/0,-1/0,-1/0),new G.Vector3(1/0,1/0,1/0)),r._target0=r._target.clone(),r._position0=r._camera.position.clone(),r._zoom0=r._zoom,r._focalOffset0=r._focalOffset.clone(),r._dollyControlAmount=0,r._dollyControlCoord=new G.Vector2,r.mouseButtons={left:S.ROTATE,middle:S.DOLLY,right:S.TRUCK,wheel:P(r._camera)?S.DOLLY:B(r._camera)?S.ZOOM:S.NONE,shiftLeft:S.NONE},r.touches={one:S.TOUCH_ROTATE,two:P(r._camera)?S.TOUCH_DOLLY_TRUCK:B(r._camera)?S.TOUCH_ZOOM_TRUCK:S.NONE,three:S.TOUCH_TRUCK},r._domElement){var i=new G.Vector2,a=new G.Vector2,o=new G.Vector2,s=function(e){if(r._enabled){var t={pointerId:e.pointerId,clientX:e.clientX,clientY:e.clientY};switch(r._activePointers.push(t),e.button){case G.MOUSE.LEFT:r._state=e.shiftKey?r.mouseButtons.shiftLeft:r.mouseButtons.left;break;case G.MOUSE.MIDDLE:r._state=r.mouseButtons.middle;break;case G.MOUSE.RIGHT:r._state=r.mouseButtons.right}if("touch"===e.pointerType)switch(r._activePointers.length){case 1:r._state=r.touches.one;break;case 2:r._state=r.touches.two;break;case 3:r._state=r.touches.three}r._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),r._domElement.ownerDocument.removeEventListener("pointerup",p),r._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),r._domElement.ownerDocument.addEventListener("pointerup",p),x()}},l=function(e){if(r._enabled){var t={pointerId:0,clientX:e.clientX,clientY:e.clientY};switch(r._activePointers.push(t),e.button){case G.MOUSE.LEFT:r._state=e.shiftKey?r.mouseButtons.shiftLeft:r.mouseButtons.left;break;case G.MOUSE.MIDDLE:r._state=r.mouseButtons.middle;break;case G.MOUSE.RIGHT:r._state=r.mouseButtons.right}r._domElement.ownerDocument.removeEventListener("mousemove",h),r._domElement.ownerDocument.removeEventListener("mouseup",f),r._domElement.ownerDocument.addEventListener("mousemove",h),r._domElement.ownerDocument.addEventListener("mouseup",f),x()}},u=function(e){if(r._enabled){switch(e.preventDefault(),Array.prototype.forEach.call(e.changedTouches,(function(e){var t={pointerId:e.identifier,clientX:e.clientX,clientY:e.clientY};r._activePointers.push(t)})),r._activePointers.length){case 1:r._state=r.touches.one;break;case 2:r._state=r.touches.two;break;case 3:r._state=r.touches.three}r._domElement.ownerDocument.removeEventListener("touchmove",d,{passive:!1}),r._domElement.ownerDocument.removeEventListener("touchend",m),r._domElement.ownerDocument.addEventListener("touchmove",d,{passive:!1}),r._domElement.ownerDocument.addEventListener("touchend",m),x()}},c=function(e){e.cancelable&&e.preventDefault();var t=e.pointerId,n=r._findPointerById(t);n&&(n.clientX=e.clientX,n.clientY=e.clientY,b())},h=function(e){var t=r._findPointerById(0);t&&(t.clientX=e.clientX,t.clientY=e.clientY,b())},d=function(e){e.cancelable&&e.preventDefault(),Array.prototype.forEach.call(e.changedTouches,(function(e){var t=e.identifier,n=r._findPointerById(t);n&&(n.clientX=e.clientX,n.clientY=e.clientY)})),b()},p=function(e){var t=e.pointerId,n=r._findPointerById(t);if(n&&r._activePointers.splice(r._activePointers.indexOf(n),1),"touch"===e.pointerType)switch(r._activePointers.length){case 0:r._state=S.NONE;break;case 1:r._state=r.touches.one;break;case 2:r._state=r.touches.two;break;case 3:r._state=r.touches.three}else r._state=S.NONE;M()},f=function(){var e=r._findPointerById(0);e&&r._activePointers.splice(r._activePointers.indexOf(e),1),r._state=S.NONE,M()},m=function(e){switch(Array.prototype.forEach.call(e.changedTouches,(function(e){var t=e.identifier,n=r._findPointerById(t);n&&r._activePointers.splice(r._activePointers.indexOf(n),1)})),r._activePointers.length){case 0:r._state=S.NONE;break;case 1:r._state=r.touches.one;break;case 2:r._state=r.touches.two;break;case 3:r._state=r.touches.three}M()},v=-1,g=function(e){if(r._enabled&&r.mouseButtons.wheel!==S.NONE){if(e.preventDefault(),r.dollyToCursor||r.mouseButtons.wheel===S.ROTATE||r.mouseButtons.wheel===S.TRUCK){var t=performance.now();v-t<1e3&&r._getClientRect(r._elementRect),v=t}var n=he?-1:-3,i=1===e.deltaMode?e.deltaY/n:e.deltaY/(10*n),a=r.dollyToCursor?(e.clientX-r._elementRect.x)/r._elementRect.width*2-1:0,o=r.dollyToCursor?(e.clientY-r._elementRect.y)/r._elementRect.height*-2+1:0;switch(r.mouseButtons.wheel){case S.ROTATE:r._rotateInternal(e.deltaX,e.deltaY);break;case S.TRUCK:r._truckInternal(e.deltaX,e.deltaY,!1);break;case S.OFFSET:r._truckInternal(e.deltaX,e.deltaY,!0);break;case S.DOLLY:r._dollyInternal(-i,a,o);break;case S.ZOOM:r._zoomInternal(-i,a,o)}r.dispatchEvent({type:"control"})}},y=function(e){r._enabled&&e.preventDefault()},x=function(){if(r._enabled){if(U(r._activePointers,Y),r._getClientRect(r._elementRect),i.copy(Y),a.copy(Y),r._activePointers.length>=2){var e=Y.x-r._activePointers[1].clientX,t=Y.y-r._activePointers[1].clientY,n=Math.sqrt(e*e+t*t);o.set(0,n);var s=.5*(r._activePointers[0].clientX+r._activePointers[1].clientX),l=.5*(r._activePointers[0].clientY+r._activePointers[1].clientY);a.set(s,l)}r.dispatchEvent({type:"controlstart"})}},b=function(){if(r._enabled){U(r._activePointers,Y);var e=a.x-Y.x,t=a.y-Y.y;switch(a.copy(Y),r._state){case S.ROTATE:case S.TOUCH_ROTATE:r._rotateInternal(e,t);break;case S.DOLLY:case S.ZOOM:var n=r.dollyToCursor?(i.x-r._elementRect.x)/r._elementRect.width*2-1:0,s=r.dollyToCursor?(i.y-r._elementRect.y)/r._elementRect.height*-2+1:0;r._state===S.DOLLY?r._dollyInternal(t*fe,n,s):r._zoomInternal(t*fe,n,s);break;case S.TOUCH_DOLLY:case S.TOUCH_ZOOM:case S.TOUCH_DOLLY_TRUCK:case S.TOUCH_ZOOM_TRUCK:case S.TOUCH_DOLLY_OFFSET:case S.TOUCH_ZOOM_OFFSET:var l=Y.x-r._activePointers[1].clientX,u=Y.y-r._activePointers[1].clientY,c=Math.sqrt(l*l+u*u),h=o.y-c;o.set(0,c),n=r.dollyToCursor?(a.x-r._elementRect.x)/r._elementRect.width*2-1:0,s=r.dollyToCursor?(a.y-r._elementRect.y)/r._elementRect.height*-2+1:0,r._state===S.TOUCH_DOLLY||r._state===S.TOUCH_DOLLY_TRUCK||r._state===S.TOUCH_DOLLY_OFFSET?r._dollyInternal(h*fe,n,s):r._zoomInternal(h*fe,n,s),r._state===S.TOUCH_DOLLY_TRUCK||r._state===S.TOUCH_ZOOM_TRUCK?r._truckInternal(e,t,!1):r._state!==S.TOUCH_DOLLY_OFFSET&&r._state!==S.TOUCH_ZOOM_OFFSET||r._truckInternal(e,t,!0);break;case S.TRUCK:case S.TOUCH_TRUCK:r._truckInternal(e,t,!1);break;case S.OFFSET:case S.TOUCH_OFFSET:r._truckInternal(e,t,!0)}r.dispatchEvent({type:"control"})}},M=function(){U(r._activePointers,Y),a.copy(Y),0===r._activePointers.length&&(r._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),r._domElement.ownerDocument.removeEventListener("pointerup",p),r._domElement.ownerDocument.removeEventListener("touchmove",d,{passive:!1}),r._domElement.ownerDocument.removeEventListener("touchend",m),r.dispatchEvent({type:"controlend"}))};r._domElement.addEventListener("pointerdown",s),de&&r._domElement.addEventListener("mousedown",l),de&&r._domElement.addEventListener("touchstart",u),r._domElement.addEventListener("pointercancel",p),r._domElement.addEventListener("wheel",g,{passive:!1}),r._domElement.addEventListener("contextmenu",y),r._removeAllEventListeners=function(){r._domElement.removeEventListener("pointerdown",s),r._domElement.removeEventListener("mousedown",l),r._domElement.removeEventListener("touchstart",u),r._domElement.removeEventListener("pointercancel",p),r._domElement.removeEventListener("wheel",g,{passive:!1}),r._domElement.removeEventListener("contextmenu",y),r._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),r._domElement.ownerDocument.removeEventListener("mousemove",h),r._domElement.ownerDocument.removeEventListener("touchmove",d,{passive:!1}),r._domElement.ownerDocument.removeEventListener("pointerup",p),r._domElement.ownerDocument.removeEventListener("mouseup",f),r._domElement.ownerDocument.removeEventListener("touchend",m)},r.cancel=function(){r._state!==S.NONE&&(r._state=S.NONE,r._activePointers.length=0,M())}}return r.update(0),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}L(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.install=function(e){G=e.THREE,V=Object.freeze(new G.Vector3(0,0,0)),W=Object.freeze(new G.Vector3(0,1,0)),X=Object.freeze(new G.Vector3(0,0,1)),Y=new G.Vector2,J=new G.Vector3,Q=new G.Vector3,q=new G.Vector3,K=new G.Vector3,Z=new G.Vector3,$=new G.Vector3,ee=new G.Spherical,te=new G.Spherical,ne=new G.Box3,re=new G.Box3,ie=new G.Sphere,ae=new G.Quaternion,oe=new G.Quaternion,se=new G.Matrix4,le=new G.Raycaster},Object.defineProperty(t,"ACTION",{get:function(){return pe},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},set:function(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e,e||this.cancel()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"active",{get:function(){return!this._hasRested},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentAction",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._spherical.radius},set:function(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"azimuthAngle",{get:function(){return this._spherical.theta},set:function(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"polarAngle",{get:function(){return this._spherical.phi},set:function(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"boundaryEnclosesCamera",{get:function(){return this._boundaryEnclosesCamera},set:function(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0},enumerable:!1,configurable:!0}),t.prototype.addEventListener=function(t,n){e.prototype.addEventListener.call(this,t,n)},t.prototype.removeEventListener=function(t,n){e.prototype.removeEventListener.call(this,t,n)},t.prototype.rotate=function(e,t,n){return void 0===n&&(n=!1),this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,n)},t.prototype.rotateAzimuthTo=function(e,t){return void 0===t&&(t=!1),this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi,t)},t.prototype.rotatePolarTo=function(e,t){return void 0===t&&(t=!1),this.rotateTo(this._sphericalEnd.theta,this._sphericalEnd.phi+e,t)},t.prototype.rotateTo=function(e,t,n){void 0===n&&(n=!1);var r=G.MathUtils.clamp(e,this.minAzimuthAngle,this.maxAzimuthAngle),i=G.MathUtils.clamp(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=i,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);var a=!n||I(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&I(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(a)},t.prototype.dolly=function(e,t){return void 0===t&&(t=!1),this.dollyTo(this._sphericalEnd.radius-e,t)},t.prototype.dollyTo=function(e,t){void 0===t&&(t=!1);var n=this._sphericalEnd.radius,r=G.MathUtils.clamp(e,this.minDistance,this.maxDistance);if(this.colliderMeshes.length>=1){var i=this._collisionTest(),a=I(i,this._spherical.radius);if(!(n>r)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(r,i)}else this._sphericalEnd.radius=r;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);var o=!t||I(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(o)},t.prototype.zoom=function(e,t){return void 0===t&&(t=!1),this.zoomTo(this._zoomEnd+e,t)},t.prototype.zoomTo=function(e,t){void 0===t&&(t=!1),this._zoomEnd=G.MathUtils.clamp(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);var n=!t||I(this._zoom,this._zoomEnd,this.restThreshold);return this._createOnRestPromise(n)},t.prototype.pan=function(e,t,n){return void 0===n&&(n=!1),this.truck(e,t,n)},t.prototype.truck=function(e,t,n){void 0===n&&(n=!1),this._camera.updateMatrix(),K.setFromMatrixColumn(this._camera.matrix,0),Z.setFromMatrixColumn(this._camera.matrix,1),K.multiplyScalar(e),Z.multiplyScalar(-t);var r=J.copy(K).add(Z),i=Q.copy(this._targetEnd).add(r);return this.moveTo(i.x,i.y,i.z,n)},t.prototype.forward=function(e,t){void 0===t&&(t=!1),J.setFromMatrixColumn(this._camera.matrix,0),J.crossVectors(this._camera.up,J),J.multiplyScalar(e);var n=Q.copy(this._targetEnd).add(J);return this.moveTo(n.x,n.y,n.z,t)},t.prototype.moveTo=function(e,t,n,r){void 0===r&&(r=!1);var i=J.set(e,t,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,i,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);var a=!r||I(this._target.x,this._targetEnd.x,this.restThreshold)&&I(this._target.y,this._targetEnd.y,this.restThreshold)&&I(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(a)},t.prototype.fitToBox=function(e,t,n){var r=void 0===n?{}:n,i=r.paddingLeft,a=void 0===i?0:i,o=r.paddingRight,s=void 0===o?0:o,l=r.paddingBottom,u=void 0===l?0:l,c=r.paddingTop,h=void 0===c?0:c,d=[],p=e.isBox3?ne.copy(e):ne.setFromObject(e);p.isEmpty()&&Promise.resolve();var f=F(this._sphericalEnd.theta,k),m=F(this._sphericalEnd.phi,k);d.push(this.rotateTo(f,m,t));var v=J.setFromSpherical(this._sphericalEnd).normalize(),g=ae.setFromUnitVectors(v,X);I(Math.abs(v.y),1)&&g.multiply(oe.setFromAxisAngle(W,f));var y=re.makeEmpty();Q.copy(p.min).applyQuaternion(g),y.expandByPoint(Q),Q.copy(p.min).setX(p.max.x).applyQuaternion(g),y.expandByPoint(Q),Q.copy(p.min).setY(p.max.y).applyQuaternion(g),y.expandByPoint(Q),Q.copy(p.max).setZ(p.min.z).applyQuaternion(g),y.expandByPoint(Q),Q.copy(p.min).setZ(p.max.z).applyQuaternion(g),y.expandByPoint(Q),Q.copy(p.max).setY(p.min.y).applyQuaternion(g),y.expandByPoint(Q),Q.copy(p.max).setX(p.min.x).applyQuaternion(g),y.expandByPoint(Q),Q.copy(p.max).applyQuaternion(g),y.expandByPoint(Q),g.setFromUnitVectors(X,v),y.min.x-=a,y.min.y-=u,y.max.x+=s,y.max.y+=h;var x=y.getSize(J),b=y.getCenter(Q).applyQuaternion(g);if(P(this._camera)){var M=this.getDistanceToFitBox(x.x,x.y,x.z);d.push(this.moveTo(b.x,b.y,b.z,t)),d.push(this.dollyTo(M,t)),d.push(this.setFocalOffset(0,0,0,t))}else if(B(this._camera)){var w=this._camera,_=w.right-w.left,A=w.top-w.bottom,C=Math.min(_/x.x,A/x.y);d.push(this.moveTo(b.x,b.y,b.z,t)),d.push(this.zoomTo(C,t)),d.push(this.setFocalOffset(0,0,0,t))}return Promise.all(d)},t.prototype.fitTo=function(e,t,n){return void 0===n&&(n={}),this.fitToBox(e,t,n)},t.prototype.fitToSphere=function(e,t){var n=[],r=e instanceof G.Sphere?ie.copy(e):function(e,t){var n=t,r=n.center;e.traverse((function(e){e.isMesh&&ne.expandByObject(e)})),ne.getCenter(r);var i=0;return e.traverse((function(e){if(e.isMesh){var t=e,n=t.geometry.clone();if(n.applyMatrix4(t.matrixWorld),n.isBufferGeometry)for(var a=0,o=(s=n.attributes.position).count;a<o;a++)J.fromBufferAttribute(s,a),i=Math.max(i,r.distanceToSquared(J));else{var s=n.attributes.position,l=new G.Vector3;for(a=0,o=s.count;a<o;a++)l.fromBufferAttribute(s,a),i=Math.max(i,r.distanceToSquared(l))}}})),n.radius=Math.sqrt(i),n}(e,ie);if(n.push(this.moveTo(r.center.x,r.center.y,r.center.z,t)),P(this._camera)){var i=this.getDistanceToFitSphere(r.radius);n.push(this.dollyTo(i,t))}else if(B(this._camera)){var a=this._camera.right-this._camera.left,o=this._camera.top-this._camera.bottom,s=2*r.radius,l=Math.min(a/s,o/s);n.push(this.zoomTo(l,t))}return n.push(this.setFocalOffset(0,0,0,t)),Promise.all(n)},t.prototype.setLookAt=function(e,t,n,r,i,a,o){void 0===o&&(o=!1);var s=Q.set(r,i,a),l=J.set(e,t,n);this._targetEnd.copy(s),this._sphericalEnd.setFromVector3(l.sub(s).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));var u=!o||I(this._target.x,this._targetEnd.x,this.restThreshold)&&I(this._target.y,this._targetEnd.y,this.restThreshold)&&I(this._target.z,this._targetEnd.z,this.restThreshold)&&I(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&I(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&I(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(u)},t.prototype.lerpLookAt=function(e,t,n,r,i,a,o,s,l,u,c,h,d,p){void 0===p&&(p=!1);var f=J.set(r,i,a),m=Q.set(e,t,n);ee.setFromVector3(m.sub(f).applyQuaternion(this._yAxisUpSpace));var v=q.set(u,c,h),g=Q.set(o,s,l);te.setFromVector3(g.sub(v).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(f.lerp(v,d));var y=te.theta-ee.theta,x=te.phi-ee.phi,b=te.radius-ee.radius;this._sphericalEnd.set(ee.radius+b*d,ee.phi+x*d,ee.theta+y*d),this.normalizeRotations(),this._needsUpdate=!0,p||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));var M=!p||I(this._target.x,this._targetEnd.x,this.restThreshold)&&I(this._target.y,this._targetEnd.y,this.restThreshold)&&I(this._target.z,this._targetEnd.z,this.restThreshold)&&I(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&I(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&I(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(M)},t.prototype.setPosition=function(e,t,n,r){return void 0===r&&(r=!1),this.setLookAt(e,t,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)},t.prototype.setTarget=function(e,t,n,r){void 0===r&&(r=!1);var i=this.getPosition(J);return this.setLookAt(i.x,i.y,i.z,e,t,n,r)},t.prototype.setFocalOffset=function(e,t,n,r){void 0===r&&(r=!1),this._focalOffsetEnd.set(e,t,n),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);var i=!r||I(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&I(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&I(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(i)},t.prototype.setOrbitPoint=function(e,t,n){K.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Z.setFromMatrixColumn(this._camera.matrixWorldInverse,1),$.setFromMatrixColumn(this._camera.matrixWorldInverse,2);var r=J.set(e,t,n),i=r.distanceTo(this._camera.position),a=r.sub(this._camera.position);K.multiplyScalar(a.x),Z.multiplyScalar(a.y),$.multiplyScalar(a.z),J.copy(K).add(Z).add($),J.z=J.z+i,this.dollyTo(i,!1),this.setFocalOffset(-J.x,J.y,-J.z,!1),this.moveTo(e,t,n,!1)},t.prototype.setBoundary=function(e){if(!e)return this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),void(this._needsUpdate=!0);this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0},t.prototype.setViewport=function(e,t,n,r){null!==e?(this._viewport=this._viewport||new G.Vector4,"number"==typeof e?this._viewport.set(e,t,n,r):this._viewport.copy(e)):this._viewport=null},t.prototype.getDistanceToFitBox=function(e,t,n){if(H(this._camera))return this._spherical.radius;var r=e/t,i=this._camera.getEffectiveFOV()*G.MathUtils.DEG2RAD,a=this._camera.aspect;return.5*(r<a?t:e/a)/Math.tan(.5*i)+.5*n},t.prototype.getDistanceToFit=function(e,t,n){return this.getDistanceToFitBox(e,t,n)},t.prototype.getDistanceToFitSphere=function(e){if(H(this._camera))return this._spherical.radius;var t=this._camera.getEffectiveFOV()*G.MathUtils.DEG2RAD,n=2*Math.atan(Math.tan(.5*t)*this._camera.aspect),r=1<this._camera.aspect?t:n;return e/Math.sin(.5*r)},t.prototype.getTarget=function(e){return(e&&e.isVector3?e:new G.Vector3).copy(this._targetEnd)},t.prototype.getPosition=function(e){return(e&&e.isVector3?e:new G.Vector3).setFromSpherical(this._sphericalEnd).applyQuaternion(this._yAxisUpSpaceInverse).add(this._targetEnd)},t.prototype.getFocalOffset=function(e){return(e&&e.isVector3?e:new G.Vector3).copy(this._focalOffsetEnd)},t.prototype.normalizeRotations=function(){this._sphericalEnd.theta=this._sphericalEnd.theta%D,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=D),this._spherical.theta+=D*Math.round((this._sphericalEnd.theta-this._spherical.theta)/D)},t.prototype.reset=function(e){void 0===e&&(e=!1);var t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)},t.prototype.saveState=function(){this._target0.copy(this._target),this._position0.copy(this._camera.position),this._zoom0=this._zoom},t.prototype.updateCameraUp=function(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,W),j(this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace))},t.prototype.update=function(e){var t=this._state===S.NONE?this.dampingFactor:this.draggingDampingFactor,n=Math.min(t*e*60,1),r=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,a=this._sphericalEnd.radius-this._spherical.radius,o=J.subVectors(this._targetEnd,this._target),s=Q.subVectors(this._focalOffsetEnd,this._focalOffset);if(O(r)&&O(i)&&O(a)&&O(o.x)&&O(o.y)&&O(o.z)&&O(s.x)&&O(s.y)&&O(s.z)?(this._spherical.copy(this._sphericalEnd),this._target.copy(this._targetEnd),this._focalOffset.copy(this._focalOffsetEnd)):(this._spherical.set(this._spherical.radius+a*n,this._spherical.phi+i*n,this._spherical.theta+r*n),this._target.add(o.multiplyScalar(n)),this._focalOffset.add(s.multiplyScalar(n)),this._needsUpdate=!0),0!==this._dollyControlAmount){if(P(this._camera)){var l=this._camera,u=J.setFromSpherical(this._sphericalEnd).applyQuaternion(this._yAxisUpSpaceInverse).normalize().negate(),c=Q.copy(u).cross(l.up).normalize();0===c.lengthSq()&&(c.x=1);var h=q.crossVectors(c,u),d=this._sphericalEnd.radius*Math.tan(l.getEffectiveFOV()*G.MathUtils.DEG2RAD*.5),p=(this._sphericalEnd.radius-this._dollyControlAmount-this._sphericalEnd.radius)/this._sphericalEnd.radius,f=J.copy(this._targetEnd).add(c.multiplyScalar(this._dollyControlCoord.x*d*l.aspect)).add(h.multiplyScalar(this._dollyControlCoord.y*d));this._targetEnd.lerp(f,p),this._target.copy(this._targetEnd)}else if(B(this._camera)){l=this._camera;var m=J.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(l.near+l.far)/(l.near-l.far)).unproject(l),v=Q.set(0,0,-1).applyQuaternion(l.quaternion),g=v.dot(l.up),y=O(g)?-m.dot(l.up):-m.dot(l.up)/g;f=q.copy(m).add(v.multiplyScalar(y)),this._targetEnd.lerp(f,1-l.zoom/this._dollyControlAmount),this._target.copy(this._targetEnd)}this._dollyControlAmount=0}var x=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,x),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!O(this._focalOffset.x)||!O(this._focalOffset.y)||!O(this._focalOffset.z))&&(this._camera.updateMatrix(),K.setFromMatrixColumn(this._camera.matrix,0),Z.setFromMatrixColumn(this._camera.matrix,1),$.setFromMatrixColumn(this._camera.matrix,2),K.multiplyScalar(this._focalOffset.x),Z.multiplyScalar(-this._focalOffset.y),$.multiplyScalar(this._focalOffset.z),J.copy(K).add(Z).add($),this._camera.position.add(J)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),J.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);var b=this._zoomEnd-this._zoom;this._zoom+=b*n,this._camera.zoom!==this._zoom&&(O(b)&&(this._zoom=this._zoomEnd),this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0);var M=this._needsUpdate;return M&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):M?(this.dispatchEvent({type:"update"}),O(r,this.restThreshold)&&O(i,this.restThreshold)&&O(a,this.restThreshold)&&O(o.x,this.restThreshold)&&O(o.y,this.restThreshold)&&O(o.z,this.restThreshold)&&O(s.x,this.restThreshold)&&O(s.y,this.restThreshold)&&O(s.z,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!M&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._updatedLastTime=M,this._needsUpdate=!1,M},t.prototype.toJSON=function(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:N(this.maxDistance),minZoom:this.minZoom,maxZoom:N(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:N(this.maxPolarAngle),minAzimuthAngle:N(this.minAzimuthAngle),maxAzimuthAngle:N(this.maxAzimuthAngle),dampingFactor:this.dampingFactor,draggingDampingFactor:this.draggingDampingFactor,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:J.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})},t.prototype.fromJSON=function(e,t){void 0===t&&(t=!1);var n=JSON.parse(e),r=J.fromArray(n.position);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=z(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=z(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=z(n.maxPolarAngle),this.minAzimuthAngle=z(n.minAzimuthAngle),this.maxAzimuthAngle=z(n.maxAzimuthAngle),this.dampingFactor=n.dampingFactor,this.draggingDampingFactor=n.draggingDampingFactor,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this.verticalDragToForward=n.verticalDragToForward,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],t),ee.setFromVector3(r.sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(ee.theta,ee.phi,t),this.zoomTo(n.zoom,t),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],t),this._needsUpdate=!0},t.prototype.dispose=function(){this._removeAllEventListeners()},t.prototype._findPointerById=function(e){var t=null;return this._activePointers.some((function(n){return n.pointerId===e&&(t=n,!0)})),t},t.prototype._encloseToBoundary=function(e,t,n){var r=t.lengthSq();if(0===r)return e;var i=Q.copy(t).add(e),a=this._boundary.clampPoint(i,q).sub(i),o=a.lengthSq();if(0===o)return e.add(t);if(o===r)return e;if(0===n)return e.add(t).add(a);var s=1+n*o/t.dot(a);return e.add(Q.copy(t).multiplyScalar(s)).add(a.multiplyScalar(1-n))},t.prototype._updateNearPlaneCorners=function(){if(P(this._camera)){var e=(i=this._camera).near,t=i.getEffectiveFOV()*G.MathUtils.DEG2RAD,n=Math.tan(.5*t)*e,r=n*i.aspect;this._nearPlaneCorners[0].set(-r,-n,0),this._nearPlaneCorners[1].set(r,-n,0),this._nearPlaneCorners[2].set(r,n,0),this._nearPlaneCorners[3].set(-r,n,0)}else if(B(this._camera)){var i,a=1/(i=this._camera).zoom,o=i.left*a,s=i.right*a,l=i.top*a,u=i.bottom*a;this._nearPlaneCorners[0].set(o,l,0),this._nearPlaneCorners[1].set(s,l,0),this._nearPlaneCorners[2].set(s,u,0),this._nearPlaneCorners[3].set(o,u,0)}},t.prototype._collisionTest=function(){var e=1/0;if(!(this.colliderMeshes.length>=1))return e;if(H(this._camera))return e;var t=J.setFromSpherical(this._spherical).divideScalar(this._spherical.radius);se.lookAt(V,t,this._camera.up);for(var n=0;n<4;n++){var r=Q.copy(this._nearPlaneCorners[n]);r.applyMatrix4(se);var i=q.addVectors(this._target,r);le.set(i,t),le.far=this._spherical.radius+1;var a=le.intersectObjects(this.colliderMeshes);0!==a.length&&a[0].distance<e&&(e=a[0].distance)}return e},t.prototype._getClientRect=function(e){var t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e},t.prototype._createOnRestPromise=function(e){var t=this;return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise((function(e){var n=function(){t.removeEventListener("rest",n),e()};t.addEventListener("rest",n)})))},t.prototype._removeAllEventListeners=function(){},t}(ue),ve=function(e,t){void 0===t&&(t=document),s.Object3D.call(this),this.visible=!1,this.domElement=t;var n=new ge;this.add(n);var r=new ye;this.add(r);var i=this;H("camera",e),H("object",void 0),H("enabled",!0),H("axis",null),H("mode","translate"),H("translationSnap",null),H("rotationSnap",null),H("scaleSnap",null),H("space","world"),H("size",1),H("dragging",!1),H("showX",!0),H("showY",!0),H("showZ",!0);var a={type:"change"},o={type:"mouseDown"},l={type:"mouseUp",mode:i.mode},u={type:"objectChange"},c=new s.Raycaster;function h(e,t,n){for(var r=t.intersectObject(e,!0),i=0;i<r.length;i++)if(r[i].object.visible||n)return r[i];return!1}var d=new s.Vector3,p=new s.Vector3,f=new s.Quaternion,m={X:new s.Vector3(1,0,0),Y:new s.Vector3(0,1,0),Z:new s.Vector3(0,0,1)},v=new s.Vector3,g=new s.Vector3,y=new s.Vector3,x=new s.Vector3,b=new s.Vector3,M=new s.Vector3,w=0,_=new s.Vector3,A=new s.Quaternion,C=new s.Vector3,T=new s.Vector3,S=new s.Quaternion,E=new s.Quaternion,L=new s.Vector3,P=new s.Vector3,B=new s.Quaternion,D=new s.Vector3,k=new s.Vector3,R=new s.Quaternion,O=new s.Quaternion,I=new s.Vector3,F=new s.Vector3,N=new s.Vector3,z=new s.Quaternion,U=new s.Vector3;function H(e,t){var o=t;Object.defineProperty(i,e,{get:function(){return void 0!==o?o:t},set:function(t){o!==t&&(o=t,r[e]=t,n[e]=t,i.dispatchEvent({type:e+"-changed",value:t}),i.dispatchEvent(a))}}),i[e]=t,r[e]=t,n[e]=t}function j(e){if(i.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};var n=e.changedTouches?e.changedTouches[0]:e,r=t.getBoundingClientRect();return{x:(n.clientX-r.left)/r.width*2-1,y:-(n.clientY-r.top)/r.height*2+1,button:e.button}}function G(e){if(i.enabled)switch(e.pointerType){case"mouse":case"pen":i.pointerHover(j(e))}}function V(e){i.enabled&&(i.domElement.style.touchAction="none",i.domElement.ownerDocument.addEventListener("pointermove",W,!1),i.pointerHover(j(e)),i.pointerDown(j(e)))}function W(e){i.enabled&&i.pointerMove(j(e))}function X(e){i.enabled&&(i.domElement.style.touchAction="",i.domElement.ownerDocument.removeEventListener("pointermove",W,!1),i.pointerUp(j(e)))}H("worldPosition",k),H("worldPositionStart",P),H("worldQuaternion",R),H("worldQuaternionStart",B),H("cameraPosition",_),H("cameraQuaternion",A),H("pointStart",v),H("pointEnd",g),H("rotationAxis",x),H("rotationAngle",w),H("eye",F),t.addEventListener("pointerdown",V,!1),t.addEventListener("pointermove",G,!1),i.domElement.ownerDocument.addEventListener("pointerup",X,!1),this.dispose=function(){t.removeEventListener("pointerdown",V),t.removeEventListener("pointermove",G),i.domElement.ownerDocument.removeEventListener("pointermove",W),i.domElement.ownerDocument.removeEventListener("pointerup",X),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))},this.attach=function(e){return this.object=e,this.visible=!0,this},this.detach=function(){return this.object=void 0,this.visible=!1,this.axis=null,this},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent||this.object.parent.matrixWorld.decompose(T,S,L),this.object.matrixWorld.decompose(k,R,I),E.copy(S).invert(),O.copy(R).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(_,A,C),F.copy(_).sub(k).normalize(),s.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging){c.setFromCamera(e,this.camera);var t=h(n.picker[this.mode],c);this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){c.setFromCamera(e,this.camera);var t=h(r,c,!0);if(t){var n=this.space;if("scale"===this.mode?n="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(n="world"),"local"===n&&"rotate"===this.mode){var i=this.rotationSnap;"X"===this.axis&&i&&(this.object.rotation.x=Math.round(this.object.rotation.x/i)*i),"Y"===this.axis&&i&&(this.object.rotation.y=Math.round(this.object.rotation.y/i)*i),"Z"===this.axis&&i&&(this.object.rotation.z=Math.round(this.object.rotation.z/i)*i)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),N.copy(this.object.position),z.copy(this.object.quaternion),U.copy(this.object.scale),this.object.matrixWorld.decompose(P,B,D),v.copy(t.point).sub(P)}this.dragging=!0,o.mode=this.mode,this.dispatchEvent(o)}},this.pointerMove=function(e){var t=this.axis,n=this.mode,i=this.object,o=this.space;if("scale"===n?o="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(o="world"),void 0!==i&&null!==t&&!1!==this.dragging&&-1===e.button){c.setFromCamera(e,this.camera);var s=h(r,c,!0);if(s){if(g.copy(s.point).sub(P),"translate"===n)y.copy(g).sub(v),"local"===o&&"XYZ"!==t&&y.applyQuaternion(O),-1===t.indexOf("X")&&(y.x=0),-1===t.indexOf("Y")&&(y.y=0),-1===t.indexOf("Z")&&(y.z=0),"local"===o&&"XYZ"!==t?y.applyQuaternion(z).divide(L):y.applyQuaternion(E).divide(L),i.position.copy(y).add(N),this.translationSnap&&("local"===o&&(i.position.applyQuaternion(f.copy(z).invert()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(z)),"world"===o&&(i.parent&&i.position.add(d.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(d.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){var l=g.length()/v.length();g.dot(v)<0&&(l*=-1),p.set(l,l,l)}else d.copy(v),p.copy(g),d.applyQuaternion(O),p.applyQuaternion(O),p.divide(d),-1===t.search("X")&&(p.x=1),-1===t.search("Y")&&(p.y=1),-1===t.search("Z")&&(p.z=1);i.scale.copy(U).multiply(p),this.scaleSnap&&(-1!==t.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){y.copy(g).sub(v);var _=20/k.distanceTo(d.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(x.copy(F),w=g.angleTo(v),b.copy(v).normalize(),M.copy(g).normalize(),w*=M.cross(b).dot(F)<0?1:-1):"XYZE"===t?(x.copy(y).cross(F).normalize(),w=y.dot(d.copy(x).cross(this.eye))*_):"X"!==t&&"Y"!==t&&"Z"!==t||(x.copy(m[t]),d.copy(m[t]),"local"===o&&d.applyQuaternion(R),w=y.dot(d.cross(F).normalize())*_),this.rotationSnap&&(w=Math.round(w/this.rotationSnap)*this.rotationSnap),this.rotationAngle=w,"local"===o&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(z),i.quaternion.multiply(f.setFromAxisAngle(x,w)).normalize()):(x.applyQuaternion(E),i.quaternion.copy(f.setFromAxisAngle(x,w)),i.quaternion.multiply(z).normalize())}this.dispatchEvent(a),this.dispatchEvent(u)}}},this.pointerUp=function(e){0===e.button&&(this.dragging&&null!==this.axis&&(l.mode=this.mode,this.dispatchEvent(l)),this.dragging=!1,this.axis=null)},this.getMode=function(){return i.mode},this.setMode=function(e){i.mode=e},this.setTranslationSnap=function(e){i.translationSnap=e},this.setRotationSnap=function(e){i.rotationSnap=e},this.setScaleSnap=function(e){i.scaleSnap=e},this.setSize=function(e){i.size=e},this.setSpace=function(e){i.space=e},this.update=function(){}};ve.prototype=Object.assign(Object.create(s.Object3D.prototype),{constructor:ve,isTransformControls:!0});var ge=function(){s.Object3D.call(this),this.type="TransformControlsGizmo";var e=new s.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:s.DoubleSide,fog:!1,toneMapped:!1}),t=new s.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),n=e.clone();n.opacity=.15;var r=e.clone();r.opacity=.33;var i=e.clone();i.color.set(16711680);var a=e.clone();a.color.set(65280);var o=e.clone();o.color.set(255);var l=e.clone();l.opacity=.25;var u=l.clone();u.color.set(16776960);var c=l.clone();c.color.set(65535);var h=l.clone();h.color.set(16711935),e.clone().color.set(16776960);var d=t.clone();d.color.set(16711680);var p=t.clone();p.color.set(65280);var f=t.clone();f.color.set(255);var m=t.clone();m.color.set(65535);var v=t.clone();v.color.set(16711935);var g=t.clone();g.color.set(16776960);var y=t.clone();y.color.set(7895160);var x=g.clone();x.opacity=.25;var b=new s.CylinderBufferGeometry(0,.05,.2,12,1,!1),M=new s.BoxBufferGeometry(.125,.125,.125),w=new s.BufferGeometry;w.setAttribute("position",new s.Float32BufferAttribute([0,0,0,1,0,0],3));var _,A=function(e,t){for(var n=new s.BufferGeometry,r=[],i=0;i<=64*t;++i)r.push(0,Math.cos(i/32*Math.PI)*e,Math.sin(i/32*Math.PI)*e);return n.setAttribute("position",new s.Float32BufferAttribute(r,3)),n},C={X:[[new s.Mesh(b,i),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new s.Mesh(b,i),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new s.Line(w,d)]],Y:[[new s.Mesh(b,a),[0,1,0],null,null,"fwd"],[new s.Mesh(b,a),[0,1,0],[Math.PI,0,0],null,"bwd"],[new s.Line(w,p),null,[0,0,Math.PI/2]]],Z:[[new s.Mesh(b,o),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new s.Mesh(b,o),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new s.Line(w,f),null,[0,-Math.PI/2,0]]],XYZ:[[new s.Mesh(new s.OctahedronBufferGeometry(.1,0),l.clone()),[0,0,0],[0,0,0]]],XY:[[new s.Mesh(new s.PlaneBufferGeometry(.295,.295),u.clone()),[.15,.15,0]],[new s.Line(w,g),[.18,.3,0],null,[.125,1,1]],[new s.Line(w,g),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new s.Mesh(new s.PlaneBufferGeometry(.295,.295),c.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new s.Line(w,m),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new s.Line(w,m),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new s.Mesh(new s.PlaneBufferGeometry(.295,.295),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new s.Line(w,v),[.18,0,.3],null,[.125,1,1]],[new s.Line(w,v),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},T={X:[[new s.Mesh(new s.CylinderBufferGeometry(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new s.Mesh(new s.CylinderBufferGeometry(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new s.Mesh(new s.CylinderBufferGeometry(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new s.Mesh(new s.OctahedronBufferGeometry(.2,0),n)]],XY:[[new s.Mesh(new s.PlaneBufferGeometry(.4,.4),n),[.2,.2,0]]],YZ:[[new s.Mesh(new s.PlaneBufferGeometry(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new s.Mesh(new s.PlaneBufferGeometry(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},S={START:[[new s.Mesh(new s.OctahedronBufferGeometry(.01,2),r),null,null,null,"helper"]],END:[[new s.Mesh(new s.OctahedronBufferGeometry(.01,2),r),null,null,null,"helper"]],DELTA:[[new s.Line((_=new s.BufferGeometry,_.setAttribute("position",new s.Float32BufferAttribute([0,0,0,1,1,1],3)),_),r),null,null,null,"helper"]],X:[[new s.Line(w,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new s.Line(w,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new s.Line(w,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},E={X:[[new s.Line(A(1,.5),d)],[new s.Mesh(new s.OctahedronBufferGeometry(.04,0),i),[0,0,.99],null,[1,3,1]]],Y:[[new s.Line(A(1,.5),p),null,[0,0,-Math.PI/2]],[new s.Mesh(new s.OctahedronBufferGeometry(.04,0),a),[0,0,.99],null,[3,1,1]]],Z:[[new s.Line(A(1,.5),f),null,[0,Math.PI/2,0]],[new s.Mesh(new s.OctahedronBufferGeometry(.04,0),o),[.99,0,0],null,[1,3,1]]],E:[[new s.Line(A(1.25,1),x),null,[0,Math.PI/2,0]],[new s.Mesh(new s.CylinderBufferGeometry(.03,0,.15,4,1,!1),x),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new s.Mesh(new s.CylinderBufferGeometry(.03,0,.15,4,1,!1),x),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new s.Mesh(new s.CylinderBufferGeometry(.03,0,.15,4,1,!1),x),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new s.Mesh(new s.CylinderBufferGeometry(.03,0,.15,4,1,!1),x),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new s.Line(A(1,1),y),null,[0,Math.PI/2,0]]]},L={AXIS:[[new s.Line(w,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},P={X:[[new s.Mesh(new s.TorusBufferGeometry(1,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new s.Mesh(new s.TorusBufferGeometry(1,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new s.Mesh(new s.TorusBufferGeometry(1,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new s.Mesh(new s.TorusBufferGeometry(1.25,.1,2,24),n)]],XYZE:[[new s.Mesh(new s.SphereBufferGeometry(.7,10,8),n)]]},B={X:[[new s.Mesh(M,i),[.8,0,0],[0,0,-Math.PI/2]],[new s.Line(w,d),null,null,[.8,1,1]]],Y:[[new s.Mesh(M,a),[0,.8,0]],[new s.Line(w,p),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new s.Mesh(M,o),[0,0,.8],[Math.PI/2,0,0]],[new s.Line(w,f),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new s.Mesh(M,u),[.85,.85,0],null,[2,2,.2]],[new s.Line(w,g),[.855,.98,0],null,[.125,1,1]],[new s.Line(w,g),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new s.Mesh(M,c),[0,.85,.85],null,[.2,2,2]],[new s.Line(w,m),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new s.Line(w,m),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new s.Mesh(M,h),[.85,0,.85],null,[2,.2,2]],[new s.Line(w,v),[.855,0,.98],null,[.125,1,1]],[new s.Line(w,v),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new s.Mesh(new s.BoxBufferGeometry(.125,.125,.125),l.clone()),[1.1,0,0]]],XYZY:[[new s.Mesh(new s.BoxBufferGeometry(.125,.125,.125),l.clone()),[0,1.1,0]]],XYZZ:[[new s.Mesh(new s.BoxBufferGeometry(.125,.125,.125),l.clone()),[0,0,1.1]]]},D={X:[[new s.Mesh(new s.CylinderBufferGeometry(.2,0,.8,4,1,!1),n),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new s.Mesh(new s.CylinderBufferGeometry(.2,0,.8,4,1,!1),n),[0,.5,0]]],Z:[[new s.Mesh(new s.CylinderBufferGeometry(.2,0,.8,4,1,!1),n),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new s.Mesh(M,n),[.85,.85,0],null,[3,3,.2]]],YZ:[[new s.Mesh(M,n),[0,.85,.85],null,[.2,3,3]]],XZ:[[new s.Mesh(M,n),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new s.Mesh(new s.BoxBufferGeometry(.2,.2,.2),n),[1.1,0,0]]],XYZY:[[new s.Mesh(new s.BoxBufferGeometry(.2,.2,.2),n),[0,1.1,0]]],XYZZ:[[new s.Mesh(new s.BoxBufferGeometry(.2,.2,.2),n),[0,0,1.1]]]},k={X:[[new s.Line(w,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new s.Line(w,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new s.Line(w,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},R=function(e){var t=new s.Object3D;for(var n in e)for(var r=e[n].length;r--;){var i=e[n][r][0].clone(),a=e[n][r][1],o=e[n][r][2],l=e[n][r][3],u=e[n][r][4];i.name=n,i.tag=u,a&&i.position.set(a[0],a[1],a[2]),o&&i.rotation.set(o[0],o[1],o[2]),l&&i.scale.set(l[0],l[1],l[2]),i.updateMatrix();var c=i.geometry.clone();c.applyMatrix4(i.matrix),i.geometry=c,i.renderOrder=1/0,i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),t.add(i)}return t},O=new s.Vector3(0,0,0),I=new s.Euler,F=new s.Vector3(0,1,0),N=new s.Vector3(0,0,0),z=new s.Matrix4,U=new s.Quaternion,H=new s.Quaternion,j=new s.Quaternion,G=new s.Vector3(1,0,0),V=new s.Vector3(0,1,0),W=new s.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=R(C)),this.add(this.gizmo.rotate=R(E)),this.add(this.gizmo.scale=R(B)),this.add(this.picker.translate=R(T)),this.add(this.picker.rotate=R(P)),this.add(this.picker.scale=R(D)),this.add(this.helper.translate=R(S)),this.add(this.helper.rotate=R(L)),this.add(this.helper.scale=R(k)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:j;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var n=[];n=(n=(n=n.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var r=0;r<n.length;r++){var i,a=n[r];if(a.visible=!0,a.rotation.set(0,0,0),a.position.copy(this.worldPosition),i=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),a.scale.set(1,1,1).multiplyScalar(i*this.size/7),"helper"!==a.tag){if(a.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){var o=.99;"X"!==a.name&&"XYZX"!==a.name||Math.abs(F.copy(G).applyQuaternion(t).dot(this.eye))>o&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"Y"!==a.name&&"XYZY"!==a.name||Math.abs(F.copy(V).applyQuaternion(t).dot(this.eye))>o&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"Z"!==a.name&&"XYZZ"!==a.name||Math.abs(F.copy(W).applyQuaternion(t).dot(this.eye))>o&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"XY"===a.name&&Math.abs(F.copy(W).applyQuaternion(t).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"YZ"===a.name&&Math.abs(F.copy(G).applyQuaternion(t).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),"XZ"===a.name&&Math.abs(F.copy(V).applyQuaternion(t).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),-1!==a.name.search("X")&&(F.copy(G).applyQuaternion(t).dot(this.eye)<0?"fwd"===a.tag?a.visible=!1:a.scale.x*=-1:"bwd"===a.tag&&(a.visible=!1)),-1!==a.name.search("Y")&&(F.copy(V).applyQuaternion(t).dot(this.eye)<0?"fwd"===a.tag?a.visible=!1:a.scale.y*=-1:"bwd"===a.tag&&(a.visible=!1)),-1!==a.name.search("Z")&&(F.copy(W).applyQuaternion(t).dot(this.eye)<0?"fwd"===a.tag?a.visible=!1:a.scale.z*=-1:"bwd"===a.tag&&(a.visible=!1))}else"rotate"===this.mode&&(H.copy(t),F.copy(this.eye).applyQuaternion(U.copy(t).invert()),-1!==a.name.search("E")&&a.quaternion.setFromRotationMatrix(z.lookAt(this.eye,N,V)),"X"===a.name&&(U.setFromAxisAngle(G,Math.atan2(-F.y,F.z)),U.multiplyQuaternions(H,U),a.quaternion.copy(U)),"Y"===a.name&&(U.setFromAxisAngle(V,Math.atan2(F.x,F.z)),U.multiplyQuaternions(H,U),a.quaternion.copy(U)),"Z"===a.name&&(U.setFromAxisAngle(W,Math.atan2(F.y,F.x)),U.multiplyQuaternions(H,U),a.quaternion.copy(U)));a.visible=a.visible&&(-1===a.name.indexOf("X")||this.showX),a.visible=a.visible&&(-1===a.name.indexOf("Y")||this.showY),a.visible=a.visible&&(-1===a.name.indexOf("Z")||this.showZ),a.visible=a.visible&&(-1===a.name.indexOf("E")||this.showX&&this.showY&&this.showZ),a.material._opacity=a.material._opacity||a.material.opacity,a.material._color=a.material._color||a.material.color.clone(),a.material.color.copy(a.material._color),a.material.opacity=a.material._opacity,this.enabled?this.axis&&(a.name===this.axis||this.axis.split("").some((function(e){return a.name===e}))?(a.material.opacity=1,a.material.color.lerp(new s.Color(1,1,1),.5)):(a.material.opacity*=.25,a.material.color.lerp(new s.Color(1,1,1),.5))):(a.material.opacity*=.5,a.material.color.lerp(new s.Color(1,1,1),.5))}else a.visible=!1,"AXIS"===a.name?(a.position.copy(this.worldPositionStart),a.visible=!!this.axis,"X"===this.axis&&(U.setFromEuler(I.set(0,0,0)),a.quaternion.copy(t).multiply(U),Math.abs(F.copy(G).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),"Y"===this.axis&&(U.setFromEuler(I.set(0,0,Math.PI/2)),a.quaternion.copy(t).multiply(U),Math.abs(F.copy(V).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),"Z"===this.axis&&(U.setFromEuler(I.set(0,Math.PI/2,0)),a.quaternion.copy(t).multiply(U),Math.abs(F.copy(W).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),"XYZE"===this.axis&&(U.setFromEuler(I.set(0,Math.PI/2,0)),F.copy(this.rotationAxis),a.quaternion.setFromRotationMatrix(z.lookAt(N,F,V)),a.quaternion.multiply(U),a.visible=this.dragging),"E"===this.axis&&(a.visible=!1)):"START"===a.name?(a.position.copy(this.worldPositionStart),a.visible=this.dragging):"END"===a.name?(a.position.copy(this.worldPosition),a.visible=this.dragging):"DELTA"===a.name?(a.position.copy(this.worldPositionStart),a.quaternion.copy(this.worldQuaternionStart),O.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),O.applyQuaternion(this.worldQuaternionStart.clone().invert()),a.scale.copy(O),a.visible=this.dragging):(a.quaternion.copy(t),this.dragging?a.position.copy(this.worldPositionStart):a.position.copy(this.worldPosition),this.axis&&(a.visible=-1!==this.axis.search(a.name)))}s.Object3D.prototype.updateMatrixWorld.call(this)}};ge.prototype=Object.assign(Object.create(s.Object3D.prototype),{constructor:ge,isTransformControlsGizmo:!0});var ye=function(){s.Mesh.call(this,new s.PlaneBufferGeometry(1e5,1e5,2,2),new s.MeshBasicMaterial({visible:!1,wireframe:!0,side:s.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.type="TransformControlsPlane";var e=new s.Vector3(1,0,0),t=new s.Vector3(0,1,0),n=new s.Vector3(0,0,1),r=new s.Vector3,i=new s.Vector3,a=new s.Vector3,o=new s.Matrix4,l=new s.Quaternion;this.updateMatrixWorld=function(){var u=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(u="local"),e.set(1,0,0).applyQuaternion("local"===u?this.worldQuaternion:l),t.set(0,1,0).applyQuaternion("local"===u?this.worldQuaternion:l),n.set(0,0,1).applyQuaternion("local"===u?this.worldQuaternion:l),a.copy(t),this.mode){case"translate":case"scale":switch(this.axis){case"X":a.copy(this.eye).cross(e),i.copy(e).cross(a);break;case"Y":a.copy(this.eye).cross(t),i.copy(t).cross(a);break;case"Z":a.copy(this.eye).cross(n),i.copy(n).cross(a);break;case"XY":i.copy(n);break;case"YZ":i.copy(e);break;case"XZ":a.copy(n),i.copy(t);break;case"XYZ":case"E":i.set(0,0,0)}break;default:i.set(0,0,0)}0===i.length()?this.quaternion.copy(this.cameraQuaternion):(o.lookAt(r.set(0,0,0),i,a),this.quaternion.setFromRotationMatrix(o)),s.Object3D.prototype.updateMatrixWorld.call(this)}};ye.prototype=Object.assign(Object.create(s.Mesh.prototype),{constructor:ye,isTransformControlsPlane:!0});var xe=function(e){function t(e,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,v.default)(this,t),(r=T(this,t)).type="RailGeometry";for(var a=[],o=[],l=[],u=0,c=0,h=e.length;c<h;c++){var d=e[c],p=e[c+1>h-1?0:c+1];a.push(d.x),a.push(d.y+i),a.push(d.z),a.push(d.x),a.push(d.y+i+n),a.push(d.z);var f=p.x-d.x,m=p.y-d.y,g=p.z-d.z,y=Math.sqrt(f*f+m*m+g*g);o.push(u,0,u,1),u+=y}for(var x=0,b=o.length;x<b;x++)x%2==0&&(o[x]/=u);r.setAttribute("position",new s.Float32BufferAttribute(a,3)),r.setAttribute("uv",new s.Float32BufferAttribute(o,2));for(var M=0,w=a.length/3;M<w;M++)M+2<w&&l.push(M+1),M%2==0?(l.push(M),l.push(M+2)):(l.push(M+2),l.push(M));return r.setIndex(l),r}return(0,m.default)(t,e),(0,g.default)(t)}(s.BufferGeometry),be={computeTangents:function(e){var t=e.index,n=e.attributes;if(null!==t&&void 0!==n.position&&void 0!==n.normal&&void 0!==n.uv){var r=t.array,i=n.position.array,a=n.normal.array,o=n.uv.array,l=i.length/3;void 0===n.tangent&&e.setAttribute("tangent",new s.BufferAttribute(new Float32Array(4*l),4));for(var u=n.tangent.array,c=[],h=[],d=0;d<l;d++)c[d]=new s.Vector3,h[d]=new s.Vector3;var p=new s.Vector3,f=new s.Vector3,m=new s.Vector3,v=new s.Vector2,g=new s.Vector2,y=new s.Vector2,x=new s.Vector3,b=new s.Vector3,M=e.groups;0===M.length&&(M=[{start:0,count:r.length}]),d=0;for(var w=M.length;d<w;++d)for(var _=k=(D=M[d]).start,A=k+D.count;_<A;_+=3)R(r[_+0],r[_+1],r[_+2]);var C,T,S,E=new s.Vector3,L=new s.Vector3,P=new s.Vector3,B=new s.Vector3;for(d=0,w=M.length;d<w;++d){var D,k;for(_=k=(D=M[d]).start,A=k+D.count;_<A;_+=3)O(r[_+0]),O(r[_+1]),O(r[_+2])}}function R(e,t,n){p.fromArray(i,3*e),f.fromArray(i,3*t),m.fromArray(i,3*n),v.fromArray(o,2*e),g.fromArray(o,2*t),y.fromArray(o,2*n),f.sub(p),m.sub(p),g.sub(v),y.sub(v);var r=1/(g.x*y.y-y.x*g.y);isFinite(r)&&(x.copy(f).multiplyScalar(y.y).addScaledVector(m,-g.y).multiplyScalar(r),b.copy(m).multiplyScalar(g.x).addScaledVector(f,-y.x).multiplyScalar(r),c[e].add(x),c[t].add(x),c[n].add(x),h[e].add(b),h[t].add(b),h[n].add(b))}function O(e){P.fromArray(a,3*e),B.copy(P),T=c[e],E.copy(T),E.sub(P.multiplyScalar(P.dot(T))).normalize(),L.crossVectors(B,T),S=L.dot(h[e]),C=S<0?-1:1,u[4*e]=E.x,u[4*e+1]=E.y,u[4*e+2]=E.z,u[4*e+3]=C}},mergeBufferGeometries:function(e,t){for(var n=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),a={},o={},l=e[0].morphTargetsRelative,u=new s.BufferGeometry,c=0,h=0;h<e.length;++h){var d=e[h],p=0;if(n!==(null!==d.index))return null;for(var f in d.attributes){if(!r.has(f))return null;void 0===a[f]&&(a[f]=[]),a[f].push(d.attributes[f]),p++}if(p!==r.size)return null;if(l!==d.morphTargetsRelative)return null;for(var f in d.morphAttributes){if(!i.has(f))return null;void 0===o[f]&&(o[f]=[]),o[f].push(d.morphAttributes[f])}if(u.userData.mergedUserData=u.userData.mergedUserData||[],u.userData.mergedUserData.push(d.userData),t){var m;if(n)m=d.index.count;else{if(void 0===d.attributes.position)return null;m=d.attributes.position.count}u.addGroup(c,m,h),c+=m}}if(n){var v=0,g=[];for(h=0;h<e.length;++h){for(var y=e[h].index,x=0;x<y.count;++x)g.push(y.getX(x)+v);v+=e[h].attributes.position.count}u.setIndex(g)}for(var f in a){var b=this.mergeBufferAttributes(a[f]);if(!b)return null;u.setAttribute(f,b)}for(var f in o){var M=o[f][0].length;if(0===M)break;for(u.morphAttributes=u.morphAttributes||{},u.morphAttributes[f]=[],h=0;h<M;++h){var w=[];for(x=0;x<o[f].length;++x)w.push(o[f][x][h]);var _=this.mergeBufferAttributes(w);if(!_)return null;u.morphAttributes[f].push(_)}}return u},mergeBufferAttributes:function(e){for(var t,n,r,i=0,a=0;a<e.length;++a){var o=e[a];if(o.isInterleavedBufferAttribute)return null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return null;if(void 0===n&&(n=o.itemSize),n!==o.itemSize)return null;if(void 0===r&&(r=o.normalized),r!==o.normalized)return null;i+=o.array.length}var l=new t(i),u=0;for(a=0;a<e.length;++a)l.set(e[a].array,u),u+=e[a].array.length;return new s.BufferAttribute(l,n,r)},interleaveAttributes:function(e){for(var t,n=0,r=0,i=0,a=e.length;i<a;++i){var o=e[i];if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return null;n+=o.array.length,r+=o.itemSize}var l=new s.InterleavedBuffer(new t(n),r),u=0,c=[],h=["getX","getY","getZ","getW"],d=["setX","setY","setZ","setW"],p=0;for(a=e.length;p<a;p++){var f=(o=e[p]).itemSize,m=o.count,v=new s.InterleavedBufferAttribute(l,f,u,o.normalized);c.push(v),u+=f;for(var g=0;g<m;g++)for(var y=0;y<f;y++)v[d[y]](g,o[h[y]](g))}return c},estimateBytesUsed:function(e){var t=0;for(var n in e.attributes){var r=e.getAttribute(n);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}var i=e.getIndex();return t+(i?i.count*i.itemSize*i.array.BYTES_PER_ELEMENT:0)},mergeVertices:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-4;t=Math.max(t,Number.EPSILON);for(var n={},r=e.getIndex(),i=e.getAttribute("position"),a=r?r.count:i.count,o=0,l=Object.keys(e.attributes),u={},c={},h=[],d=["getX","getY","getZ","getW"],p=0,f=l.length;p<f;p++)u[b=l[p]]=[],(A=e.morphAttributes[b])&&(c[b]=new Array(A.length).fill().map((function(){return[]})));var m=Math.log10(1/t),v=Math.pow(10,m);for(p=0;p<a;p++){var g=r?r.getX(p):p,y="",x=0;for(f=l.length;x<f;x++)for(var b=l[x],M=(_=e.getAttribute(b)).itemSize,w=0;w<M;w++)y+=~~(_[d[w]](g)*v)+",";if(y in n)h.push(n[y]);else{for(x=0,f=l.length;x<f;x++){b=l[x];var _=e.getAttribute(b),A=e.morphAttributes[b],C=(M=_.itemSize,u[b]),T=c[b];for(w=0;w<M;w++){var S=d[w];if(C.push(_[S](g)),A)for(var E=0,L=A.length;E<L;E++)T[E].push(A[E][S](g))}}n[y]=o,h.push(o),o++}}var P=e.clone();for(p=0,f=l.length;p<f;p++){b=l[p];var B=e.getAttribute(b),D=new B.array.constructor(u[b]);if(_=new s.BufferAttribute(D,B.itemSize,B.normalized),P.setAttribute(b,_),b in c)for(x=0;x<c[b].length;x++){var k=e.morphAttributes[b][x],R=(D=new k.array.constructor(c[b][x]),new s.BufferAttribute(D,k.itemSize,k.normalized));P.morphAttributes[b][x]=R}}return P.setIndex(h),P},toTrianglesDrawMode:function(e,t){if(t===s.TrianglesDrawMode)return e;if(t===s.TriangleFanDrawMode||t===s.TriangleStripDrawMode){var n=e.getIndex();if(null===n){var r=[],i=e.getAttribute("position");if(void 0===i)return e;for(var a=0;a<i.count;a++)r.push(a);e.setIndex(r),n=e.getIndex()}var o=n.count-2,l=[];if(t===s.TriangleFanDrawMode)for(a=1;a<=o;a++)l.push(n.getX(0)),l.push(n.getX(a)),l.push(n.getX(a+1));else for(a=0;a<o;a++)a%2==0?(l.push(n.getX(a)),l.push(n.getX(a+1)),l.push(n.getX(a+2))):(l.push(n.getX(a+2)),l.push(n.getX(a+1)),l.push(n.getX(a)));l.length;var u=e.clone();return u.setIndex(l),u.clearGroups(),u}return e}};function Me(e){var t=new Map;e.traverse((function(e){(function(e){return"Mesh"===e.type&&0===e.children.length&&!e.instanceColor&&we(e)&&!e.name.includes("路名")&&!e.name.includes("水面")&&!e.name.includes("国旗")})(e)&&function(e,t){var n=e.geometry.uuid,r=e.material.uuid;if(t.has(n)){var i=t.get(n);if(i.has(r))i.get(r).push(e);else{var a=[e];i.set(r,a)}}else{var o=new Map,s=[e];o.set(r,s),t.set(n,o)}}(e,t)}));var n=new E.Group,r=new E.Color;n.name="InstanceGroup_".concat(e.name);var i,a=w(t.values());try{for(a.s();!(i=a.n()).done;){var o,s=w(i.value.values());try{for(s.s();!(o=s.n()).done;){var l=o.value;if(!(l.length<=1)){for(var c=new Map,h=[],d=[],p=[],f=[],m=[],v=[],g=new E.InstancedMesh(l[0].geometry,l[0].material.clone(),l.length),y=[],x=0;x<l.length;x++)y.push(1);g.geometry.setAttribute("customOpacity",new E.InstancedBufferAttribute(new Float32Array(y),1)),g.userData.oldTransparent=g.material.transparent,g.userData.oldDepthWrite=g.material.depthWrite,g.material.onBeforeCompile=Se;for(var b=0;b<l.length;b++){var M=l[b];M.userData.name=M.name;var _=M.matrixWorld.clone();g.setMatrixAt(b,M.matrixWorld),p[b]=_,g.setColorAt(b,r);var A={mesh:g,id:b};M.parent.userData.instancedMeshes?M.parent.userData.instancedMeshes.push(A):M.parent.userData.instancedMeshes=[A];var C=M.userData,T=Object.keys(C);if(T.length>0){var S,L=w(T);try{for(L.s();!(S=L.n()).done;){var P=S.value;if(c.has(P))c.get(P)[b]=C[P];else{var B=[];B[b]=C[P],c.set(P,B)}}}catch(e){L.e(e)}finally{L.f()}}h[b]=M.parent,d[b]=M.matrix.clone(),f[b]=!0,m[b]=!0,v[b]=!1,M.material&&M.material.dispose(),0!==b&&M.geometry&&M.geometry.dispose(),M.clear(),M.parent.remove(M)}h.length>0&&c.set("parent",h),d.length>0&&c.set("meshMatrix",d),p.length>0&&c.set("matrix",p),f.length>0&&c.set("meshVisible",f),m.length>0&&c.set("isShowArr",m),v.length>0&&c.set("isStatusArr",v);var D,k=w(c);try{for(k.s();!(D=k.n()).done;){var R=(0,u.default)(D.value,2),O=R[0],I=R[1];g.userData[O]=I}}catch(e){k.e(e)}finally{k.f()}g.castShadow=!0,g.receiveShadow=!0,n.add(g)}}}catch(e){s.e(e)}finally{s.f()}}}catch(e){a.e(e)}finally{a.f()}return n}function we(e){if(e.scale.x<0||e.scale.y<0||e.scale.z<0)return!1;var t=!0;return e.parent&&(t=we(e.parent)),t}var _e=["attribute float customOpacity;","varying float vcustomOpacity;","#include <common>"].join("\n"),Ae=["#include <begin_vertex>","vcustomOpacity = 1.0;","if (customOpacity>=0.0) {","vcustomOpacity = customOpacity;","};"].join("\n"),Ce=["varying float vcustomOpacity;","#include <common>"].join("\n"),Te=["vec4 diffuseColor = vec4( diffuse, opacity*vcustomOpacity );"].join("\n");function Se(e){e.vertexShader=e.vertexShader.replace("#include <common>",_e).replace("#include <begin_vertex>",Ae),e.fragmentShader=e.fragmentShader.replace("#include <common>",Ce).replace("vec4 diffuseColor = vec4( diffuse, opacity );",Te)}function Ee(e){var t,n=w(e);try{for(n.s();!(t=n.n()).done;)(0,t.value)()}catch(e){n.e(e)}finally{n.f()}}function Le(e){if(e instanceof s.BufferAttribute)return new s.BufferAttribute(Pe(e.array,e.array),e.itemSize,!1);if(e instanceof s.InterleavedBufferAttribute){for(var t=[],n=0;n<e.count;n++)for(var r=n*e.data.stride+e.offset,i=0;i<e.itemSize;i++)t.push(e.data.array[r+i]);return new s.BufferAttribute(Pe(t,e.data.array),e.itemSize,!1)}throw new Error("THREE.BufferGeometryUtils: unNormalizedAttribute() encountered an unknown buffer attribute type.")}function Pe(e,t){return t instanceof Int16Array?new Float32Array(e.map((function(e){return Math.max(e/32767,-1)}))):t instanceof Uint16Array?new Float32Array(e.map((function(e){return e/65535}))):t instanceof Int8Array?new Float32Array(e.map((function(e){return Math.max(e/127,-1)}))):t instanceof Uint8Array?new Float32Array(e.map((function(e){return e/255}))):Array.isArray(e)?new Float32Array(e):e}var Be,De=function(){function e(t){var n=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,speed:.01,keys:{FORWARD:"KeyW",BACK:"KeyS",LEFT:"KeyA",RIGHT:"KeyD"}};if((0,v.default)(this,e),this.doInstance=Me,this.isTransformKeyDown=!0,this.hasAnimation=!1,this.needUpdate=!1,this.currentTime=0,this.delta=0,this.interval=1/30,this.animateMoves=new Array,this.CSS2DRenderer=E.CSS2DRenderer,this.afterInitTransformControlsCallbackList=[],this.highPerformance=!1,this.isComposerRender=!1,this.isGlow=!1,this.darkMaterial=new E.MeshBasicMaterial({color:"black"}),this.materials={},this.modelMoving=!1,this.cubeTexture=null,this.cameraProperty={near:null,far:null,fov:null},this.isRotate=!1,this.isUpdateLod=!1,this.isSimulateMotion=!1,this.isCSS2DRender=!1,this.adjustCameraState=!0,this.isSelectTransparentObj=!0,this.simulateMotionProgress=0,this.triggerPoints=[],this.persona=null,this.surroundMeshMap=new Map,this.boxMeshMap=new Map,this.materialMap=new Map,this.addAnimation=!0,this.transparentState=!1,this.isMovingLight=!1,this.movingXmax=200,this.movingXmix=-10,this.movingSpeed=1,this.needMovingLights=[],this.touchTargetObjs=[],this.touchTargetIDs=[],this.touchRaycaster=new s.Raycaster,this.touchEnableLayers=[],this.pickEnableLayers=[],this.mixers=new Map,this.lightningStrikes=[],this.tilesRenderers=[],this.animationFrequency=1,this.animationCount=0,this.beforeRenderCallbackList=[],this.afterRenderCallbackList=[],this.experimentFlag={changeOrbitTarget:!1},this.animation=function(){0!=n.triggerPoints.length&&n.cameraTrigger(),null!=n.persona&&n.followCamera();var e=n.clock.getDelta(),t=n.cameraControls.update(e);n.mixers.forEach((function(t,n){return t.update(e)})),n.delta+=e,n.delta>n.interval&&((t||n.hasAnimation||n.needUpdate||n.mixers.size>0)&&(n.cameraControls.distance<1?(n.camera.near=.05,n.camera.far=5e3,n.camera.updateProjectionMatrix()):n.cameraControls.distance<10?(n.camera.near=.1,n.camera.far=1e4,n.camera.updateProjectionMatrix()):n.cameraControls.distance<3e3?(n.camera.near=1,n.camera.far=1e5,n.camera.updateProjectionMatrix()):(n.camera.near=10,n.camera.far=1e6,n.camera.updateProjectionMatrix()),Ee(n.beforeRenderCallbackList),n.render(),Ee(n.afterRenderCallbackList)),n.delta=n.delta%n.interval),n.isComposerRender&&!n.isGlow&&n.composer.render(),n.isGlow&&(n.cubeTexture&&(n.scene.background=null),n.traverseNodes(n.scene,(function(e){e.isMesh&&!1===n.bloomLayer.test(e.layers)&&(n.materials[e.uuid]=e.material,e.material=n.darkMaterial)})),n.composer.render(),n.cubeTexture&&(n.scene.background=n.cubeTexture),n.traverseNodes(n.scene,(function(e){e.isMesh&&n.materials[e.uuid]&&(e.material=n.materials[e.uuid],delete n.materials[e.uuid])})),n.finalComposer.render()),n.isMovingLight&&n.needMovingLights.forEach((function(e){e.position.x<n.movingXmax?e.position.set(e.position.x+n.movingSpeed,e.position.y,e.position.z):e.position.set(n.movingXmix,e.position.y,e.position.z)})),n.animateMoves.length>0&&n.animateMoves.shift()();var r=performance.now();if(n.isRotate&&(n.scene.rotation.y=1e-4*r),n.isUpdateLod&&n.updateMeshVisible(),n.isSimulateMotion&&(n.simulateMotionProgress>1&&(n.simulateMotionProgress=0),n.simulateMotionProgress+=.002,n.simulateMotionPath)){var i=n.simulateMotionPath.getPoint(n.simulateMotionProgress);i&&i.x&&n.simulateMotionModel.position.set(i.x,i.y,i.z)}n.animationFrame=requestAnimationFrame(n.animation)},this.triggerAction=function(){},this.setMeshLOD=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n.isUpdateLod=e},this.setRotate=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n.isRotate=e},this.setModelMoving=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n.modelMoving=e},this.setSimulateMotion=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;n.isSimulateMotion=e,n.simulateMotionPath=t,n.simulateMotionModel=r},this.setCameraValues=function(e){n.cameraControls.maxPolarAngle=.48*Math.PI,n.cameraControls.minDistance=0,n.cameraControls.maxDistance=e},this.setCameraMoveValues=function(e){n.cameraControls.setBoundary(new s.Box3(e[0],e[1]))},this.render=function(){n.renderer.render(n.scene,n.camera),n.isCSS2DRender&&n.CSS2DRenderer.render(n.scene,n.camera),n.needUpdate=!1},this.keydownFn=function(e){if(n.transformControls.visible){if(!n.isTransformKeyDown)return;switch(e.keyCode){case 87:n.transformControls.setMode("translate");break;case 69:n.transformControls.setMode("rotate");break;case 82:n.transformControls.setMode("scale");break;case 70:var t=n.transformControls.object;if(t){t.updateWorldMatrix(!0,!0);var r=(new s.Box3).setFromObject(t),i=new s.Sphere;i=r.getBoundingSphere(i),n.cameraControls.fitToSphere(i,!0)}}}else if(n.enablekey.enable){var a=n.cameraControls.getPosition(new E.Vector3),o=n.cameraControls.getTarget(new E.Vector3),l=a.distanceTo(o),u=Math.sqrt(Math.pow(o.z-a.z,2)+Math.pow(o.x-a.x,2));l<10&&(l=10);var c=n.getFirstIntersectionObjectByPositions({x:a.x-.5*(o.x-a.x)/n.cameraControls.distance,y:a.y-.5*(o.y-a.y)/n.cameraControls.distance,z:a.z-.5*(o.z-a.z)/n.cameraControls.distance},{x:a.x+.5*(o.x-a.x)/n.cameraControls.distance,y:a.y+.5*(o.y-a.y)/n.cameraControls.distance,z:a.z+.5*(o.z-a.z)/n.cameraControls.distance},1),h=!1,d=!1;switch(c.forEach((function(e){e.distance>.5&&(h=!0),e.distance<.5&&(d=!0)})),e.code){case n.enablekey.keys.LEFT:c.length>0?n.cameraControls.setTarget(a.x+u*Math.cos(Math.atan2(o.z-a.z,o.x-a.x)+Math.PI/30),o.y,a.z+u*Math.sin(Math.atan2(o.z-a.z,o.x-a.x)+Math.PI/30),!0):n.cameraControls.setTarget(a.x+u*Math.cos(Math.atan2(o.z-a.z,o.x-a.x)-Math.PI/90),o.y,a.z+u*Math.sin(Math.atan2(o.z-a.z,o.x-a.x)-Math.PI/90),!0);break;case n.enablekey.keys.RIGHT:c.length>0?n.cameraControls.setTarget(a.x+u*Math.cos(Math.atan2(o.z-a.z,o.x-a.x)-Math.PI/30),o.y,a.z+u*Math.sin(Math.atan2(o.z-a.z,o.x-a.x)-Math.PI/30),!0):n.cameraControls.setTarget(a.x+u*Math.cos(Math.atan2(o.z-a.z,o.x-a.x)+Math.PI/90),o.y,a.z+u*Math.sin(Math.atan2(o.z-a.z,o.x-a.x)+Math.PI/90),!0);break;case n.enablekey.keys.FORWARD:h?n.cameraControls.forward(-l*n.enablekey.speed*5,!0):n.cameraControls.forward(l*n.enablekey.speed,!0);break;case n.enablekey.keys.BACK:d?n.cameraControls.forward(l*n.enablekey.speed*5,!0):n.cameraControls.forward(-l*n.enablekey.speed,!0)}}},this.resetKeydownFn=function(e){n.keydownFn(e)},this.itemRender=function(){var e=n.clock.getDelta();n.cameraControls.update(e)&&(n.renderer.render(n.scene,n.camera),n.isCSS2DRender&&n.CSS2DRenderer.render(n.scene,n.camera))},this.bbox=function(e){var t=new E.Box3;return a().isNil(e)?t.setFromObject(n.scene):(e.forEach((function(e){var n=new E.Box3;n.setFromObject(e),t.union(n)})),t)},this.bbox3=function(e){var t=new E.Box3;return a().isNil(e)?t.setFromObject2(n.scene):(e.forEach((function(e){var n=new E.Box3;n.setFromObject2(e),t.union(n)})),t)},this.setFromInstanceMesh=function(e,t,n){var r=null;e.updateWorldMatrix(!1,!1);var i=e.geometry;return void 0!==i&&(null===i.boundingBox&&i.computeBoundingBox(),(r=new E.Box3).copy(i.boundingBox),n?r.applyMatrix4(n.clone().multiply(e.userData.matrix[t])).applyMatrix4(e.matrixWorld):r.applyMatrix4(e.userData.matrix[t]).applyMatrix4(e.matrixWorld)),r},this.getObjectBox=function(e){if(!a().isNil(e)){var t=new E.Box3;return t.setFromObject(e),t}},this.getObjectBox3=function(e,t){if(!a().isNil(e)){var n=new E.Box3;return n.setFromObject3(e,t),n}},this.getObjectBox4=function(e,t){if(!a().isNil(e)){var n=new E.Box3;return n.setFromObject4(e,t),n}},this.addSurroundMesh=function(e,t){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:11185691,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.8,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;r=(arguments.length>6?arguments[6]:void 0)||new E.Color(i);for(var s=[{x:t.min.x,y:t.min.y,z:t.min.z},{x:t.max.x,y:t.min.y,z:t.min.z},{x:t.max.x,y:t.min.y,z:t.max.z},{x:t.min.x,y:t.min.y,z:t.max.z}],l=[{x:t.max.x,y:t.max.y,z:t.min.z},{x:t.max.x,y:t.max.y,z:t.max.z},{x:t.min.x,y:t.max.y,z:t.max.z},{x:t.min.x,y:t.max.y,z:t.min.z}],u=0;u<4;u++){var c={max:{x:l[u].x,y:l[u].y,z:l[u].z},min:{x:s[u].x,y:s[u].y,z:s[u].z}},h=c.max.x-c.min.x+o,d=c.max.y-c.min.y+.5,p=c.max.z-c.min.z+o,f=new E.BoxGeometry(h,d,p),m=new E.MeshBasicMaterial;m.color=r,m.transparent=!0,m.depthWrite=!1,m.opacity=a;for(var v=0;v<f.faces.length;v++)f.faces[v].materialIndex=0;var g=new E.Mesh(f,m);g.position.set((c.max.x-c.min.x)/2+c.min.x,(c.max.y-c.min.y)/2+c.min.y,(c.max.z-c.min.z)/2+c.min.z),g.name="shell",g.userData.shellName=e,n.surroundMeshMap.set(e+u,g),n.scene.add(g)}},this.addSurroundMesh2=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:11185691,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=[{x:t.min.x,y:t.min.y,z:t.min.z},{x:t.max.x,y:t.min.y,z:t.min.z},{x:t.max.x,y:t.min.y,z:t.max.z},{x:t.min.x,y:t.min.y,z:t.max.z}],o=[{x:t.max.x,y:t.max.y,z:t.min.z},{x:t.max.x,y:t.max.y,z:t.max.z},{x:t.min.x,y:t.max.y,z:t.max.z},{x:t.min.x,y:t.max.y,z:t.min.z}],s=new E.MeshBasicMaterial;s.color=new E.Color(r),s.transparent=!0,s.opacity=.5;for(var l=0;l<4;l++){for(var u={max:{x:o[l].x,y:o[l].y,z:o[l].z},min:{x:a[l].x,y:a[l].y,z:a[l].z}},c=u.max.x-u.min.x+i,h=u.max.y-u.min.y+.5,d=u.max.z-u.min.z+i,p=new E.BoxGeometry(c,h,d),f=0;f<p.faces.length;f++)p.faces[f].materialIndex=0;var m=new E.Mesh(p,s);m.position.set((u.max.x-u.min.x)/2+u.min.x,(u.max.y-u.min.y)/2+u.min.y,(u.max.z-u.min.z)/2+u.min.z),m.name="shell",m.userData.shellName=e,n.surroundMeshMap.set(e+l,m),n.scene.add(m)}},this.addSUrroundMesh3=function(e,t,r,i,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6?arguments[6]:void 0;if(!n.surroundMeshMap.has(e)){var u=new xe(i,a,o),c=new s.MeshBasicMaterial({side:2,transparent:!0,opacity:r,color:t}),h=new s.Mesh(u,c);h.name="shell",l&&l.value&&(h.userData.value=l.value),h.userData.shellName=e,n.surroundMeshMap.set(e,h),n.scene.add(h);var d=(new s.Box3).setFromObject(h),p=new s.Vector3;return p=d.getCenter(p),h.userData.center=p,n.meshToCenter(h,p,"origin"),h}},this.removeSurroundMesh=function(e){var t=n.surroundMeshMap.get(e);if(void 0!==t||null!==t)t.geometry.dispose(),t.geometry=null,t.material.dispose(),t.material=null,n.scene.remove(t),n.surroundMeshMap.delete(e);else for(var r=0;r<4;r++){var i=n.surroundMeshMap.get(e+r);a().isNil(t)||(i.geometry.dispose(),i.geometry=null,i.material.dispose(),i.material=null,n.scene.remove(i),n.surroundMeshMap.delete(e))}},this.removeAllSurroundMesh=function(){n.surroundMeshMap.forEach((function(e,t){e.geometry.dispose(),e.geometry=null,e.material.dispose(),e.material=null,n.scene.remove(e)})),n.surroundMeshMap=new Map},this.getBoxVertex2=function(e){return[[{x:e.min.x,y:e.min.y,z:e.min.z},{x:e.max.x,y:e.min.y,z:e.min.z},{x:e.max.x,y:e.min.y,z:e.max.z},{x:e.min.x,y:e.min.y,z:e.max.z}],[{x:e.min.x,y:e.max.y,z:e.min.z},{x:e.max.x,y:e.max.y,z:e.min.z},{x:e.max.x,y:e.max.y,z:e.max.z},{x:e.min.x,y:e.max.y,z:e.max.z}]]},this.resetSize=function(e,t){n.width=e,n.height=t,n.camera.aspect=n.width/n.height,n.adjustCameraState&&n.adjustCamera(n.scene),n.CSS2DRenderer.setSize(n.width,n.height),n.renderer.setSize(n.width,n.height)},this.adjustCamera=function(e){e.updateMatrixWorld();var t=(new E.Box3).setFromObject(e).getSize(new E.Vector3).length();n.camera=n.camera,null!==n.cameraProperty.near?n.camera.near=n.cameraProperty.near:n.camera.near=t/1e3,null!==n.cameraProperty.far?n.camera.far=n.cameraProperty.far:n.camera.far=100*t,null!==n.cameraProperty.fov&&(n.camera.fov=n.cameraProperty.fov),n.camera.updateProjectionMatrix()},this.initCameraProperty=function(e,t,r){n.cameraProperty.near=void 0===e||"number"!=typeof e||e<0||null===e?null:e,n.cameraProperty.far=void 0===t||"number"!=typeof t||t<0||null===t?null:t,n.cameraProperty.fov=void 0===r||"number"!=typeof r||r<0||null===r?null:r},this.setCamera=function(e){n.camera=e;var t=n.getModelCenter(),r=n.getModelSize();n.camera.position.set(t.x,t.y,t.z+r),n.camera.lookAt(t.x,t.y,t.z)},this.setAnimateMoves=function(e){n.animateMoves=e},this.setHighPerformance=function(e){n.highPerformance=e},this.traverseMaterials=function(e,t,n){var r=function(e){if(e.isMesh){var n=a().isArray(e.material)?e.material:[e.material];a().forEach(n,t)}};n?e.traverseVisible(r):e.traverse(r)},this.getNodeByName=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=null;return n.traverseNodesAll(n.scene,(function(i){i.name===e&&(t&&"instancedMeshes"in i.userData&&!i.userData.isReset&&n.resetObject3DFromAllInstances(i),(i.children.length>0||!a().isNil(i.userData.instancedMeshes)&&i.userData.instancedMeshes.length>0)&&(r=i))})),r},this.getModelNodeByName=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=null;return n.traverseNodesAll(e,(function(e){e.name===t&&(r&&n.resetObject3DFromAllInstances(e),e.children.length>0||!a().isNil(e.userData.instancedMeshes)&&e.userData.instancedMeshes.length>0)&&(i=e)})),i},this.getModelNodeByQueryName=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=null;return n.traverseNodesAll(e,(function(e){e.name.indexOf(t)>-1&&(r&&n.resetObject3DFromAllInstances(e),e.children.length>0||!a().isNil(e.userData.instancedMeshes)&&e.userData.instancedMeshes.length>0)&&(i=e)})),i},this.getPerformTargets=function(e,t){var r=[];n.traverseNodesAll(e,(function(e){for(var i=0,o=t.length;i<o;i++)if(e.name===t[i].name&&(t[i].needReset&&n.resetObject3DFromAllInstances(e),e.children.length>0||!a().isNil(e.userData.instancedMeshes)&&e.userData.instancedMeshes.length>0)){r.push(e),t.splice(i,1);break}}));var i=t.map((function(e){return e.name}));return e.traverse((function(e){if("Mesh"===e.type)if(void 0!==e.count&&e.userData.name){var t=e.userData.name;i=i.filter((function(i){var a=t.indexOf(i);if(-1!==a&&e.userData.meshVisible[a]){var o=n.extractMeshFromInstance(e,a,!0);return r.push(o),!1}}))}else i=i.filter((function(t){return e.name!==t||(r.push(e),!1)}));else i=i.filter((function(t){var i=n.getModelMeshByChildren(e,t);return!i||(r.push(i),!1)}))})),r},this.getModelNodeByPathNames=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t==e.name)return e;var i=t.split("/");if(1==i.length&&t!=e.name)return null;var a=e;i.splice(1,0,"RootNode");for(var o=1,s=i.length;o<s;o++)if(o<s-1){if(!(a=n.getModelNodeByChildren(a,i[o],!1)))break}else{var l=n.getModelNodeByChildren(a,i[o],r);l||(l=n.getModelMeshByChildren(a,i[o])),a=l}return a},this.getModelNodeByPathNames2=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t==e.name)return e;var i=t.split("/");if(1==i.length&&t!=e.name)return null;var a=e;i.splice(1,0,"RootNode");for(var o=1,s=i.length;o<s;o++)if(o<s-1){if(!(a=n.getModelNodeByChildren(a,i[o],!1)))break}else{var l=n.getModelNodeByChildren(a,i[o],r);l||(l=n.getModelMeshByChildren2(a,i[o])),a=l}return a},this.getModelMeshByName2=function(e,t){var r;return e.traverse((function(e){if("Mesh"===e.type)if(void 0!==e.count&&e.userData.name){for(var i=e.userData.name,a=!1,o=0;o<i.length;o++)if(i[o]===t&&e.userData.meshVisible[o]){r={instanceId:o,mesh:e},a=!0;break}if(a)return}else if(e.name===t)return void(r=e);var s=n.getModelMeshByChildren2(e,t);s&&(r=s)})),r},this.getModelMeshByQueryName=function(e,t){var r;return e.traverse((function(e){if("Mesh"===e.type)if(void 0!==e.count&&e.userData.name){for(var i=e.userData.name,a=!1,o=0;o<i.length;o++)if(i[o].indexOf(t)>-1&&e.userData.meshVisible[o]){r={instanceId:o,mesh:e},a=!0;break}if(a)return}else if(e.name.indexOf(t)>-1)return void(r=e);var s=n.getModelMeshByChildrenAndQueryName(e,t);s&&(r=s)})),r},this.getModelMeshByName=function(e,t){var r;return e.traverse((function(e){if("Mesh"===e.type)if(void 0!==e.count&&e.userData.name){for(var i=e.userData.name,a=!1,o=0;o<i.length;o++)if(i[o]===t&&e.userData.meshVisible[o]){r=n.extractMeshFromInstance(e,o,!0),a=!0;break}if(a)return}else if(e.name===t)return void(r=e);var s=n.getModelMeshByChildren(e,t);s&&(r=s)})),r},this.getNodeById=function(e){var t=null;return n.traverseNodesAll(n.scene,(function(r){r.userData.uniqId===e&&("instancedMeshes"in r.userData&&!r.userData.isReset&&n.resetObject3DFromAllInstances(r),(r.children.length>0||!a().isNil(r.userData.instancedMeshes)&&r.userData.instancedMeshes.length>0)&&(t=r))})),t},this.getNodeByNodeId=function(e){var t=null;return n.traverseNodes(n.scene,(function(n){n.parent&&n.parent.userData.nodeId===e&&(t=n.parent)})),t},this.getMeshByName=function(e){var t;return n.scene.traverse((function(r){if("Mesh"===r.type)if(void 0!==r.count)for(var i=r.userData.name,a=0;a<i.length;a++)i[a]===e&&r.userData.meshVisible[a]&&(t=n.extractMeshFromInstance(r,a,!0));else r.name===e&&(t=r)})),t},this.getMeshById=function(e){var t=null;return n.traverseNodes(n.scene,(function(n){n.userData.uniqId===e&&(t=n.parent)})),t},this.getNodeByUserDataType=function(e,t){var r;return n.traverseNodes(n.scene,(function(n){n.parent.userData[t]==e&&(r=n.parent)})),r},this.getMeshByUserDataType=function(e,t){var r;return n.traverseNodes(n.scene,(function(n){a().isNil(n.userData[t])||n.userData[t]!=e||(r=n)})),r},this.getMeshArrayByUserDataType=function(e,t){var r=[];return n.traverseNodes(n.scene,(function(n){a().isNil(n.userData[t])||n.userData[t]!=e||r.push(n)})),r},this.traverseNodes=function(e,t,n){var r=function(e){if(e.isMesh){var n=e,r=a().isArray(n)?n:[n];a().forEach(r,t)}};n?e.traverseVisible(r):e.traverse(r)},this.traverseNodesAll=function(e,t,n){var r=function(e){if("Object3D"===e.type||"Group"===e.type){var n=e,r=a().isArray(n)?n:[n];a().forEach(r,t)}};n?e.traverseVisible(r):e.traverse(r)},this.clearModel=function(){a().forEach(n.scene.children,(function(e){"Scene"===e.type&&(n.traverseNodes(e,(function(e){e.geometry.dispose()})),n.scene.remove(e))}))},this.getModelScene=function(e){if(a().isUndefined(e))return n.scene;var t=null;return a().forEach(n.scene.children,(function(n){n.name===e&&(t=n)})),t},this.fbxAddScene=function(e){n.scene.add(e)},this.getModelCenter=function(){var e=new E.Vector3;return n.bbox().getCenter(e),e},this.getModelSize=function(){return n.bbox().getSize(new E.Vector3).length()},this.getSceneByModelName=function(e){var t,r=w(n.scene.children);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.name===e)return i}}catch(e){r.e(e)}finally{r.f()}var a=new E.Scene;return a.name=e,n.scene.add(a),a},this.gltfAddScene=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=a().isUndefined(t)?n.scene:n.getSceneByModelName(t);e.updateMatrixWorld(),i.add(e),n.traverseNodes(e,(function(e){if(e.userData.name=e.name,a().isArray(e.material)?e.material[0]:e.material,e.geometry.getAttribute("normal")||e.geometry.computeVertexNormals(),r&&(e.castShadow=!0,e.receiveShadow=!0),e.material.shadowSide=1,e.isMesh&&null!==e.material&&e.material.opacity<1&&(e.material.transparent=!0,e.material.depthWrite=!1),e.parent){e.parent.userData.modelName=t,e.parent.userData.uniqId="".concat(t,"|").concat(e.parent.name);var n=e.parent.name.indexOf("_");if(n>0){e.parent.userData.nodeId=e.parent.name.slice(0,n),e.parent.userData.nodeNote=e.parent.name.slice(n+1);var i=e.parent.userData.nodeNote.split("-");e.parent.userData.professionalId=i[0].slice(4),null!=i[1]&&(i[1].indexOf(","),e.parent.userData.roomId=i[1].split(",")),e.parent.userData.embeddedId=i[2]}}})),n.needUpdate=!0,n.adjustCameraState&&n.adjustCamera(n.scene)},this.getIntersections=function(e,t){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=new E.Vector2;o.x=(e-n.el.getBoundingClientRect().left)/n.el.clientWidth*2-1,o.y=-(t-n.el.getBoundingClientRect().top)/n.el.clientHeight*2+1;var s=new E.Raycaster;0!==i.length?(s.layers.disableAll(),i.map((function(e){var t=Math.floor(e);s.layers.enable(t)}))):0!==n.pickEnableLayers.length&&(s.layers.disableAll(),n.pickEnableLayers.map((function(e){var t=Math.floor(e);s.layers.enable(t)}))),n.experimentFlag.changeOrbitTarget&&n.camera.updateMatrixWorld(),s.setFromCamera(o,n.camera);var l=s.intersectObjects(n.scene.children,!0),u=a().filter(l,(function(e){return!e.object.isLine}));if(null===u||0===u.length)return null;for(var c=function(e){if(u[e].object.material.opacity>=0&&!0===u[e].object.visible){if(!(null===(r=u[e].object.material.clippingPlanes)||void 0===r?void 0:r.length))return 1;u[e].object.material.clippingPlanes.length>1?(u[e].point.x>u[e].object.material.clippingPlanes[0].constant||u[e].point.x<-u[e].object.material.clippingPlanes[1].constant||u[e].point.y>u[e].object.material.clippingPlanes[2].constant||u[e].point.y<-u[e].object.material.clippingPlanes[3].constant||u[e].point.z>u[e].object.material.clippingPlanes[4].constant||u[e].point.z<-u[e].object.material.clippingPlanes[5].constant)&&u.splice(e,1):u[e].object.material.clippingPlanes.every((function(t){return t.distanceToPoint(u[e].point)<0}))&&u.splice(e,1)}else u.splice(e,1)},h=u.length-1;h>=0;h--)c(h);return u},this.getFirstIntersection=function(e,t){var r=n.getIntersections(e,t),i=a().filter(r,(function(e){return!e.object.isLine}));if(null===i||0===i.length)return null;if(n.isSelectTransparentObj)return i[0];for(var o=0;o<i.length;o++)if((!1===i[o].object.material.transparent||i[o].object.material.opacity>=1)&&!0===i[o].object.visible)return i[o]},this.getFirstIntersectionObject=function(e,t){var r=n.getFirstIntersection(e,t);return a().isNull(r)?null:r.object.parent},this.getFirstIntersectionObjectByPosition=function(e,t){e=new E.Vector3(e.x,e.y,e.z);var r=new E.Vector3;n.cameraControls.getPosition(r);var i=new E.Vector3(r.x-e.x,r.y-e.y,r.z-e.z);return i.normalize(),new E.Raycaster(e,i,.1,e.distanceTo(r)).intersectObjects(t,!0)},this.getFirstIntersectionObjectByPositions=function(e,t,r){var i=new E.Vector3(t.x-e.x,t.y-e.y,t.z-e.z);i.normalize();var o=new E.Raycaster(new E.Vector3(e.x,e.y,e.z),i,0,r);o.layers.disableAll(),n.pickEnableLayers.map((function(e){var t=Math.floor(e);o.layers.enable(t)})),o.camera=n.camera;var s=o.intersectObjects(n.scene.children,!0),l=a().filter(s,(function(e){return"point"!=e.object.userData.type&&"label"!=e.object.userData.type}));if(l&&l.length>0&&l[0].face&&l[0].face.normal){var u=new E.Matrix4;u.extractRotation(l[0].object.matrixWorld);var c=new E.Vector3(l[0].face.normal.x,l[0].face.normal.y,l[0].face.normal.z).applyMatrix4(u);l[0].normal=c}return o=null,l},this.getIntersectionObjectsByPositions=function(e,t,r){var i=new E.Vector3(t.x-e.x,t.y-e.y,t.z-e.z);i.normalize();var o=new E.Raycaster(new E.Vector3(e.x,e.y,e.z),i);o.layers.disableAll(),n.pickEnableLayers.map((function(e){var t=Math.floor(e);o.layers.enable(t)})),o.camera=n.camera;var s=o.intersectObjects(r,!0),l=a().filter(s,(function(e){return"point"!=e.object.userData.type&&"label"!=e.object.userData.type}));if(l&&l.length>0&&l[0].face&&l[0].face.normal){var u=new E.Matrix4;u.extractRotation(l[0].object.matrixWorld);var c=new E.Vector3(l[0].face.normal.x,l[0].face.normal.y,l[0].face.normal.z).applyMatrix4(u);l[0].normal=c}return o=null,l},this.getPixelDistance=function(e,t,r){(void 0===t||t>1||t<=0)&&(t=.5),void 0===r&&(r=0);var i=n.getCamera().fov,a=Math.PI/180*i;return e/Math.tan(a/2)/t},this.automatedComputingObjectView=function(e,t){var r=n.getNodeByName(e,!1);if(r)for(var i=n.getObjectBox(r).getBoundingSphere(new E.Sphere),a=i.center,o=i.radius,s=n.getPixelDistance(o,t),l=0;l<360;l++){var u=Math.sin(Math.PI/180*l)*s,c=Math.cos(Math.PI/180*l)*s,h=new E.Vector3(a.x+u,a.y+s,a.z+c),d=new E.Vector3(-u,-s,-c);d.normalize();var p=new E.Raycaster(h,d,0,1.4142135623730951*s).intersectObjects(n.scene.children,!0);if(p){if(1==p.length)return{intersects:p,position:h,target:a};for(var f=void 0,m=0,v=p.length;m<v;m++)if(!1!==p[m].object.visible){var g=p[m],y=g.object,x=y.material,b=g.point;if(!x.transparent&&0!=x.opacity){var M=!1;if(null!==x.clippingPlanes&&6===x.clippingPlanes.length){var w=x.clippingPlanes;(b.x>w[0].constant||b.x<-w[1].constant||b.y>w[2].constant||b.y<-w[3].constant||b.z>w[4].constant||b.z<-w[5].constant)&&(M=!0)}if(!M){f="instanceId"in g?y.userData.parent[g.instanceId].name:y.parent.name;break}}}if(f==e)return{intersects:p,position:h,target:a}}}},this.getAllIntersectionObj=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=n.getIntersections(e,t,r);if(a().isNull(i))return null;var o=a().filter(i,(function(e){return!e.object.isLine}));return{intersect:o[0]?o[0].object:null,intersection:o[0]?o[0]:null,intersections:i}},this.getTouchIntersectionObj=function(e,t){var r,i=new E.Vector2;i.x=(e-n.el.getBoundingClientRect().left)/n.el.clientWidth*2-1,i.y=-(t-n.el.getBoundingClientRect().top)/n.el.clientHeight*2+1;var o=!1;n.touchEnableLayers.length>0&&(n.touchRaycaster.layers.disableAll(),n.touchEnableLayers.map((function(e){var t=Math.floor(e);n.touchRaycaster.layers.enable(t)}))),n.experimentFlag.changeOrbitTarget&&n.camera.updateMatrixWorld(),n.touchRaycaster.setFromCamera(i,n.camera);var s=n.touchRaycaster.intersectObjects(n.touchTargetObjs,o);if(a().isNull(s))return null;var l=a().filter(s,(function(e){return!e.object.isLine}));if(null===l||0===l.length)return null;for(var u=function(e){if(!0===l[e].object.visible){if(!(null===(r=l[e].object.material.clippingPlanes)||void 0===r?void 0:r.length))return 1;l[e].object.material.clippingPlanes.length>1?(l[e].point.x>l[e].object.material.clippingPlanes[0].constant||l[e].point.x<-l[e].object.material.clippingPlanes[1].constant||l[e].point.y>l[e].object.material.clippingPlanes[2].constant||l[e].point.y<-l[e].object.material.clippingPlanes[3].constant||l[e].point.z>l[e].object.material.clippingPlanes[4].constant||l[e].point.z<-l[e].object.material.clippingPlanes[5].constant)&&l.splice(e,1):l[e].object.material.clippingPlanes.every((function(t){return t.distanceToPoint(l[e].point)<0}))&&l.splice(e,1)}else l.splice(e,1)},c=l.length-1;c>=0;c--)u(c);return{intersection:l[0]?l[0]:null}},this.getNodesByCodeAndType=function(e,t){var r,i=[];return n.traverseNodes(n.scene,(function(n){var a=n.parent.userData[t];if(null!=a)if("roomId"==t){if("Object3D"==n.parent.type&&n.parent&&a.length>=0&&r!=n.parent){r=n.parent;for(var o=0;o<a.length;o++)if(n.parent&&a[o]==e){i.push(n.parent);break}}}else"Object3D"==n.parent.type&&n.parent&&a.length>=0&&r!=n.parent&&(r=n.parent,n.parent&&a==e&&i.push(n.parent))})),i},this.getObject3dPosition=function(e){var t=new E.Box3;t.setFromObject(e);var n=new s.Vector3;return t.getCenter(n),{x:Math.round(1e3*n.x)/1e3,y:Math.round(1e3*n.y)/1e3,z:Math.round(1e3*n.z)/1e3}},this.enabledcameraControls=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];n.cameraControls.enabled=e},this.removeAllListenerEventsFromCameraControls=function(){n.cameraControls.dispose(),n.cameraControls.removeEventListener("update",n.render)},this.addListenerEventsFromCameraControls=function(){n.cameraControls=new E.OrbitControls(n.camera,n.renderer.domElement),n.cameraControls.maxPolarAngle=.48*Math.PI,n.cameraControls.minDistance=0,n.cameraControls.maxDistance=1e4,n.cameraControls.addEventListener("update",n.render)},this.addCSS2DRenderForCameraControls=function(e){n.cameraControls=new E.OrbitControls(n.camera,e.domElement),n.cameraControls.maxPolarAngle=.48*Math.PI,n.cameraControls.minDistance=0,n.cameraControls.maxDistance=2e3,n.cameraControls.addEventListener("update",n.render)},this.addAllListenerEventsFromCameraControls=function(){me.install({THREE:E}),n.cameraControls=new me(n.camera,n.renderer.domElement)},this.adjustLight=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=n;i.scene.traverse((function(n){if("SpotLight"==n.type){var a=i.getObject3dPosition(n);n.castShadow=r,n.angle=t,n.intensity=e,n.target.position.set(a.x,a.y-3,a.z)}else"PointLight"==n.type&&(n.castShadow=r,n.intensity=e)}))},this.createScene=function(e){var t=new E.Scene;return t.name=e,t},this.createV3=function(e,t,n){return new E.Vector3(e,t,n)},this.updateMeshVisible=function(e){void 0===e&&(e=!1);var t=new E.Vector3;new E.Vector3,t=n.camera.getWorldPosition(t),n.scene.traverse((function(e){"Mesh"===e.type&&(t.distanceToSquared(e.geometry.boundingSphere.center)>e.userData.distance2?e.visible=!1:e.visible=!0)}))},this.addMinMap=function(e){throw new Error("add min map is deprecated")},this.computeScreenCoord=function(e){var t=new E.Vector3(e.x,e.y,e.z).project(n.camera),r=n.width/2,i=n.height/2;return{x:t.x*r+r,y:-t.y*i+i}},this.dispose=function(e){n.mixers.delete(e.uuid),e.userData.intervals&&e.userData.intervals.forEach((function(e){clearInterval(e)})),e.children.length&&e.children.filter((function(e){return e})).forEach((function(e){n.dispose(e)})),e instanceof E.Mesh||e instanceof E.Line?(n.touchTargetObjs.indexOf(e)>-1&&n.touchTargetObjs.splice(n.touchTargetObjs.indexOf(e),1),e.material.map&&(e.material.map.dispose(),e.material.map=null),e.material.emissiveMap&&(e.material.emissiveMap.dispose(),e.material.emissiveMap=null),e.material.dispose(),e.material=null,e.geometry.dispose(),e.geometry.attributes=null,e.geometry=null):e.material&&(e.material.dispose(),e.material=null),e.userData=null,e.clear(),e.remove(),e.parent&&e.parent.remove(e)},this._getMeshMaterial=function(e){if(Array.isArray(e.material))return e.material[0]=e.material[0].clone(),e.material[0];var t=e.material.clippingPlanes;return e.material=e.material.clone(),e.material.clippingPlanes=t,e.material},this.restore=function(){n.materialMap.forEach((function(e,t){e.mesh.material=e.material})),n.materialMap=new Map},this.restoreExceptScene=function(e){n.materialMap.forEach((function(t,n){t.sceneName!=e&&(t.mesh.material=t.material)}))},this.setMaterialSide=function(e){e.material.side=E.DoubleSide,e.material.shadowSide=E.BackSide},this.extractMeshFromInstance=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.geometry.clone(),a=e.material.clone();a.clippingPlanes=e.material.clippingPlanes;var o=new E.Matrix4;e.getMatrixAt(t,o);var s=e.userData.meshMatrix[t],l=new E.Mesh(i,a),u=new E.Vector3,c=new E.Matrix4,h=s.elements,d=u.set(h[0],h[1],h[2]).length(),p=u.set(h[4],h[5],h[6]).length(),f=u.set(h[8],h[9],h[10]).length();s.determinant()<0&&(d=-d),c.copy(s);var m=1/d,v=1/p,g=1/f;c.elements[0]*=m,c.elements[1]*=m,c.elements[2]*=m,c.elements[4]*=v,c.elements[5]*=v,c.elements[6]*=v,c.elements[8]*=g,c.elements[9]*=g,c.elements[10]*=g,l.scale.set(d,p,f),l.quaternion.setFromRotationMatrix(c),l.position.set(h[12],h[13],h[14]),l.updateMatrix();var y=e.userData,x=Object.keys(y);if(x.length>0){var b,M=w(x);try{for(M.s();!(b=M.n()).done;){var _=b.value;"parent"!==_&&(l.userData[_]=y[_][t])}}catch(e){M.e(e)}finally{M.f()}}var A={mesh:e,id:t};return l.userData.instancedMesh=A,e.userData.parent[t].add(l),r&&(n.zoomInstancedMesh(e,t,1e-7),e.userData.meshVisible[t]=!1),l.name=l.userData.name,l.layers.enable(5),e.userData.touchEnable&&n.touchTargetObjs.push(l),l},this.resetObject3DFromAllInstances=function(e){n.traverseNodesAll(e,(function(e){if("instancedMeshes"in e.userData&&!e.userData.isReset){for(var t=0;t<e.userData.instancedMeshes.length;t++){var r=e.userData.instancedMeshes[t].mesh,i=e.userData.instancedMeshes[t].id;if(r.userData.meshVisible[i]){var a=r.geometry.clone(),o=r.material.clone();o.clippingPlanes=r.material.clippingPlanes;var s=new E.Matrix4;r.getMatrixAt(i,s);var l=r.userData.meshMatrix[i],u=new E.Mesh(a,o),c=new E.Vector3,h=new E.Matrix4,d=l.elements,p=c.set(d[0],d[1],d[2]).length(),f=c.set(d[4],d[5],d[6]).length(),m=c.set(d[8],d[9],d[10]).length();l.determinant()<0&&(p=-p),h.copy(l);var v=1/p,g=1/f,y=1/m;h.elements[0]*=v,h.elements[1]*=v,h.elements[2]*=v,h.elements[4]*=g,h.elements[5]*=g,h.elements[6]*=g,h.elements[8]*=y,h.elements[9]*=y,h.elements[10]*=y,u.scale.set(p,f,m),u.quaternion.setFromRotationMatrix(h),u.position.set(d[12],d[13],d[14]);var x=r.userData,b=Object.keys(x);if(b.length>0){var M,_=w(b);try{for(_.s();!(M=_.n()).done;){var A=M.value;"parent"!==A&&null!=x[A]&&x[A].constructor==Array&&(u.userData[A]=x[A][i])}}catch(e){_.e(e)}finally{_.f()}}var C={mesh:r,id:i};u.userData.instancedMesh=C,u.name=u.userData.name,e.add(u),u.layers.enable(5),r.userData.touchEnable&&n.touchTargetObjs.push(u),n.zoomInstancedMesh(r,i,1e-7),r.userData.meshVisible[i]=!1}}e.updateMatrixWorld(),e.userData.isReset=!0}})),e.userData.reset=!0},this.hideObject3D=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(!t&&!e.userData.isStatus||t)&&(e.visible=!1),t&&(e.userData.isStatus=!0),"Mesh"!=e.type&&(n.traverseNodesAll(e,(function(e){if("instancedMeshes"in e.userData)for(var r=0;r<e.userData.instancedMeshes.length;r++){var i=e.userData.instancedMeshes[r].mesh,a=e.userData.instancedMeshes[r].id;i.userData.meshVisible[a]&&(t?i.userData.isShowArr[a]&&n.zoomInstancedMesh(i,a,1e-7):(n.zoomInstancedMesh(i,a,1e-7),i.userData.isShowArr[a]=!1)),t&&(i.userData.isStatusArr[a]=!0)}})),n.needUpdate=!0)},this.showObject3D=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(!t&&!e.userData.isStatus||t)&&(e.visible=!0),t&&(e.userData.isStatus=!0),"Mesh"!=e.type&&(n.traverseNodesAll(e,(function(e){if("instancedMeshes"in e.userData)for(var n=0;n<e.userData.instancedMeshes.length;n++){var r=e.userData.instancedMeshes[n].mesh,i=e.userData.instancedMeshes[n].id;r.userData.meshVisible[i]&&(t?r.userData.isShowArr[i]&&(r.setMatrixAt(i,r.userData.matrix[i]),r.instanceMatrix.needsUpdate=!0):(r.setMatrixAt(i,r.userData.matrix[i]),r.instanceMatrix.needsUpdate=!0,r.userData.isShowArr[i]=!0)),t&&(r.userData.isStatusArr[i]=!0)}})),n.needUpdate=!0)},this.injectInstancedMeshFromMesh=function(e){var t=e;"Mesh"===t.type&&(t=e.parent?e.parent:e),t.userData.reset&&(n.traverseNodesAll(t,(function(e){if("instancedMeshes"in e.userData&&e.userData.isReset){var t=[];e.traverse((function(e){if("Mesh"===e.type&&e.userData.instancedMesh){var n=e.userData.instancedMesh.mesh,r=e.userData.instancedMesh.id,i=n.userData.matrix[r];n.setMatrixAt(r,i),n.userData.meshVisible[r]=!0,n.instanceMatrix.needsUpdate=!0,t.push(e)}}));for(var r=t.length-1;r>=0;r--)n.dispose(t[r]);t=[],e.userData.isReset=!1}})),t.userData.reset=!1)},this.zoomInstancedMesh=function(e,t,n){var r=(new E.Matrix4).makeScale(n,n,n),i=new E.Matrix4;e.getMatrixAt(t,i),e.setMatrixAt(t,i.multiply(r)),e.instanceMatrix.needsUpdate=!0},a().isNull(t))throw"el can not be null";this.width=t.offsetWidth,this.height=t.offsetHeight,this.el=t,this.clock=new E.Clock,this.scene=new E.Scene,this.scene.name="RootScene",s.Cache.enabled=!0,this.camera=new E.PerspectiveCamera(50,this.width/this.height,1,3500),this.camera.updateProjectionMatrix(),this.renderer=new E.WebGLRenderer(r?{antialias:!0,logarithmicDepthBuffer:!0,alpha:!0,precision:"lowp",preserveDrawingBuffer:!1}:{alpha:!0,precision:"lowp",antialias:!0,preserveDrawingBuffer:!0}),this.renderTarget=new E.WebGLRenderTarget(this.width,this.height),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=E.PCFSoftShadowMap,this.renderer.shadowMap.needsUpdate=!0,this.renderer.setPixelRatio(window.devicePixelRatio),this.CSS2DRenderer=new E.CSS2DRenderer({antialias:!0,alpha:!0}),this.CSS2DRenderer.setSize(this.width,this.height),this.CSS2DRenderer.domElement.style.position="absolute",this.CSS2DRenderer.domElement.style.top="0px",this.CSS2DRenderer.domElement.style.userSelect="none",this.el.appendChild(this.CSS2DRenderer.domElement),me.install({THREE:E}),this.cameraControls=new me(this.camera,this.CSS2DRenderer.domElement),this.enablekey=i,window.addEventListener("keydown",this.keydownFn),t.appendChild(this.renderer.domElement),this.cubeTexture=null,this.renderer.setSize(this.width,this.height),this.renderer.render(this.scene,this.camera),this.composer=new E.EffectComposer(this.renderer),this.composer.setSize(this.width,this.height),this.composer.setPixelRatio(window.devicePixelRatio),this.bloomLayer=new E.Layers,this.bloomLayer.set(1),this.finalComposer=new E.EffectComposer(this.renderer),this.FXAAShaderPass=new E.ShaderPass(E.FXAAShader);var o=this.renderer.getPixelRatio();this.FXAAShaderPass.material.uniforms.resolution.value.set(1/this.width*o,1/this.height*o),this.FXAAShaderPass.renderToScreen=!0}return(0,g.default)(e,[{key:"transformControls",get:function(){var e=this;return this._transformControls||(this._transformControls=new ve(this.camera,this.CSS2DRenderer.domElement),this._transformControls.setSpace("local"),this._transformControls.addEventListener("dragging-changed",(function(t){e.cameraControls.enabled=!t.value})),this.afterInitTransformControlsCallbackList.forEach((function(t){return t(e._transformControls)}))),this._transformControls}},{key:"addAfterRenderCallback",value:function(e){this.afterRenderCallbackList.push(e)}},{key:"removeAfterRenderCallback",value:function(e){this.afterRenderCallbackList=this.afterRenderCallbackList.filter((function(t){return t!==e}))}},{key:"removeAllAfterRenderCallback",value:function(){this.afterRenderCallbackList=[]}},{key:"addBeforeRenderCallback",value:function(e){this.beforeRenderCallbackList.push(e)}},{key:"removeAllBeforeRenderCallback",value:function(){this.beforeRenderCallbackList=[]}},{key:"removeBeforeRenderCallback",value:function(e){this.beforeRenderCallbackList=this.beforeRenderCallbackList.filter((function(t){return t!==e}))}},{key:"setPersona",value:function(e){this.persona=e}},{key:"followCamera",value:function(){this.persona.position.x=this.camera.position.x,this.persona.position.z=this.camera.position.z}},{key:"cameraTrigger",value:function(){for(var e=0;e<this.triggerPoints.length;e++)this.camera.position.x<this.triggerPoints[e].v3.x+this.triggerPoints[e].range&&this.camera.position.x>this.triggerPoints[e].v3.x-this.triggerPoints[e].range&&this.camera.position.z<this.triggerPoints[e].v3.z+this.triggerPoints[e].range&&this.camera.position.z>this.triggerPoints[e].v3.z-this.triggerPoints[e].range&&!this.triggerPoints[e].state&&(this.triggerPoints[e].state=!0,this.triggerAction(this.triggerPoints[e])),this.camera.position.x<this.triggerPoints[e].v3.x+this.triggerPoints[e].range&&this.camera.position.x>this.triggerPoints[e].v3.x-this.triggerPoints[e].range&&this.camera.position.z<this.triggerPoints[e].v3.z+this.triggerPoints[e].range&&this.camera.position.z>this.triggerPoints[e].v3.z-this.triggerPoints[e].range||!this.triggerPoints[e].state||(this.triggerPoints[e].state=!1,this.triggerAction(this.triggerPoints[e]))}},{key:"setTriggerPoints",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.triggerPoints=e}},{key:"changeCamera",value:function(e,t){var n=this.cameraControls.getTarget(new s.Vector3),r=this.cameraControls.getPosition(new s.Vector3),i=(new s.Vector3).copy(r).sub(n).length(),a=this.camera.aspect,o=null!=t?t:this.camera.fov,l=i*Math.atan(Math.PI/180*o/2),u=l*a,c=-l,h=-u,d=this.camera.near,p=this.camera.far;this.camera=e?new E.OrthographicCamera(h,u,l,c,d,p):new E.PerspectiveCamera(null!=t?t:50,this.width/this.height,1,3500),this.camera.updateProjectionMatrix(),this.cameraControls=new me(this.camera,this.CSS2DRenderer.domElement),this.cameraControls.setPosition(r.x,r.y,r.z),this.cameraControls.setTarget(n.x,n.y,n.z)}},{key:"getScene",value:function(){return this.scene}},{key:"getCameraControls",value:function(){return this.cameraControls}},{key:"getCamera",value:function(){return this.camera}},{key:"CSS2DRenderControl",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isCSS2DRender=e}},{key:"getaxesHelper",value:function(){return this.axesHelper||(this.axesHelper=new E.AxesHelper(5)),this.axesHelper}},{key:"addBox",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:11185691,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.6,o=arguments.length>6?arguments[6]:void 0;if(!this.boxMeshMap.has(e)){var s=new E.BoxGeometry(t,n,r),l=new E.MeshBasicMaterial({color:i,opacity:a});l.transparent=!0;var u=new E.Mesh(s,l);return o.rotateY&&u.rotateY(o.rotateY),o.position&&u.position.set(o.position.x,o.position.y,o.position.z),u.name=e,u.userData.type="box",u.userData.name=e,this.boxMeshMap.set(e,u),this.scene.add(u),u}}},{key:"removeAllBoxes",value:function(){if(0!==this.scene.children.length){for(var e=this.scene.children.length-1;e>=0;e--)"box"===this.scene.children[e].userData.type&&this.removeObject(this.scene.children[e]);this.boxMeshMap.clear()}}},{key:"removeBoxByName",value:function(e){if(0!==this.scene.children.length)for(var t=this.scene.children.length-1;t>=0;t--)"box"===this.scene.children[t].userData.type&&this.scene.children[t].name===e&&(this.removeObject(this.scene.children[t]),this.boxMeshMap.delete(e))}},{key:"meshToCenter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new E.Vector3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"direction",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new E.Vector3,i=new E.Vector3;if("origin"===n)i=t;else{var a=new E.Vector3,o=new E.Vector3,s=(new E.Box3).setFromObject(e);s.getCenter(a),s.getSize(o);var l=.5*o.x,u=.5*o.y,c=.5*o.z;i.set(a.x+t.x*l,a.y+t.y*u,a.z+t.z*c)}var h=e.position,d=i.x-h.x,p=i.y-h.y,f=i.z-h.z,m=new E.Matrix4;m.makeTranslation(-d,-p,-f);var v=e.geometry;if(v instanceof E.BufferGeometry){var g=v.attributes.position;g.applyMatrix4(m),g.needsUpdate=!0,v.computeBoundingSphere(),v.computeBoundingBox(),v.computeVertexNormals(),v.computeTangents()}else for(var y=0;y<v.vertices.length-1;y++){var x=v.vertices[y];x.x=x.x+d,x.y=x.y+p,x.z=x.z+f}e.position.set(i.x+r.x,i.y+r.y,i.z+r.z),e.matrixWorldNeedsUpdate=!0}},{key:"getModelMeshByChildren",value:function(e,t){var n=null;if(!a().isNil(e.userData.instancedMeshes)&&e.userData.instancedMeshes.length>0)for(var r=0,i=e.userData.instancedMeshes.length;r<i;r++){var o=e.userData.instancedMeshes[r].mesh,s=e.userData.instancedMeshes[r].id;if(o.userData.name[s]==t&&o.userData.meshVisible[s]){n=this.extractMeshFromInstance(o,s,!0);break}}return n}},{key:"getModelNodeByChildren",value:function(e,t){for(var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=null,i=0,a=e.children.length;i<a;i++)if(e.children[i].name==t){var o=e.children[i];n&&this.resetObject3DFromAllInstances(o),r=o;break}return r}},{key:"getModelMeshByChildren2",value:function(e,t){var n=null;if(!a().isNil(e.userData.instancedMeshes)&&e.userData.instancedMeshes.length>0)for(var r=0,i=e.userData.instancedMeshes.length;r<i;r++){var o=e.userData.instancedMeshes[r].mesh,s=e.userData.instancedMeshes[r].id;if(o.userData.name[s]==t&&o.userData.meshVisible[s]){n={instanceId:s,mesh:o};break}}return n}},{key:"getModelMeshByChildrenAndQueryName",value:function(e,t){var n=null;if(!a().isNil(e.userData.instancedMeshes)&&e.userData.instancedMeshes.length>0)for(var r=0,i=e.userData.instancedMeshes.length;r<i;r++){var o=e.userData.instancedMeshes[r].mesh,s=e.userData.instancedMeshes[r].id;if(o.userData.name[s].indexOf(t)>-1&&o.userData.meshVisible[s]){n={instanceId:s,mesh:o};break}}return n}},{key:"removeMesh",value:function(e){var t=this;a().isArray(e)?a().forEach(e,(function(e){t.traverseNodes(e,(function(t){t.geometry.dispose(),t.parent&&t.parent.remove(e)}))})):a().isObject(e)&&(this.traverseNodes(e,(function(e){e.geometry.dispose()})),e.parent.remove(e))}},{key:"decomposeMatrixWorld",value:function(e){var t=new E.Vector3,n=new E.Euler,r=new E.Quaternion,i=new E.Vector3;return e.decompose(t,r,i),n.setFromQuaternion(r),{position:{x:t.x,y:t.y,z:t.z},scale:{x:i.x,y:i.y,z:i.z},rotation:{x:n.x,y:n.y,z:n.z}}}},{key:"getIntersectionByLineAndBox",value:function(e,t,n){var r=new E.Line3(new E.Vector3(e.x,e.y,e.z),new E.Vector3(t.x,t.y,t.z));if(!n.containsPoint(e)&&!n.containsPoint(t)){for(var i=!1,a=0,o=[new E.Plane(new E.Vector3(1,0,0),-n.min.x),new E.Plane(new E.Vector3(-1,0,0),n.max.x),new E.Plane(new E.Vector3(0,1,0),-n.min.y),new E.Plane(new E.Vector3(0,-1,0),n.max.y),new E.Plane(new E.Vector3(0,0,1),-n.min.z),new E.Plane(new E.Vector3(0,0,-1),n.max.z)];a<o.length;a++){var s=o[a],l=new E.Vector3;if(s.intersectLine(r,l)&&n.containsPoint(l)){i=!0;break}}return i}}},{key:"getFaceNormal",value:function(e){var t=(new E.Matrix3).getNormalMatrix(e.object.matrixWorld);return a().isNil(e.face)?new E.Vector3(0,0,0):e.face.normal.clone().applyMatrix3(t).normalize()}},{key:"addImgToBackground",value:function(e){var t=(new E.TextureLoader).load(e);this.scene.background=t}},{key:"changeBackgroundColor",value:function(e){this.scene.background=-1===e?null:new E.Color(e)}},{key:"autoDetect",value:function(e,t,n,r){var i=this.getFirstIntersectionObject(e,t),a=i.position.x,o=i.position.z,s=r.x,l=r.z;return Math.sqrt((a-s)*(a-s)+(o-l)*(o-l))<=n?i:null}},{key:"initOctahedron",value:function(e,t,n){var r=new E.OctahedronBufferGeometry(n),i=new E.MeshPhongMaterial({color:e,transparent:!0,opacity:.9}),a=new E.LineBasicMaterial({color:e}),o=new E.Mesh(r,i),s=new E.LineSegments(r,a);return o.add(s),o.position.z=t,o}},{key:"initRing",value:function(e,t){var n=new E.CylinderBufferGeometry(15,15,150,10,1,!0),r=new E.MeshPhongMaterial({map:(new E.TextureLoader).load(t),side:E.DoubleSide,transparent:!1,depthWrite:!1}),i=new E.Mesh(n,r);return i.rotation.x=Math.PI/180*-90,i.position.z=2,i}},{key:"addGateway",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},t={color:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#54C41D"},n=new E.Group,r=this.initOctahedron(t.color,-50,40),i=this.initOctahedron(t.color,65,6);n.add(r),n.add(i),n.rotation.x=Math.PI/180*90,n.position.y=e.y,n.position.x=e.x,n.position.z=e.z,this.scene.add(n)}},{key:"addWave",value:function(){}},{key:"addPictureSprite",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=(new E.TextureLoader).load(t),a=new E.SpriteMaterial({map:i}),o=new E.Sprite(a);return o.position.set(e.x,e.y,e.z),o.name=n,o.scale.x=r[0],o.scale.y=r[1],o.scale.z=r[2],this.scene.add(o),o}},{key:"switchCameraOrientation",value:function(e,t){var n=this,r=[];this.scene.children.forEach((function(e){"Scene"!=e.type&&"Group"!=e.type||r.push(e)}));var i=this.bbox(r),a=i.getCenter(new s.Vector3),o=i.getSize(new s.Vector3).length();switch(e){case"top":n.cameraControls.setLookAt(a.x,a.y+o,a.z,a.x,a.y,a.z).then((function(){t&&t()}));break;case"down":n.cameraControls.setLookAt(a.x,a.y-o,a.z,a.x,a.y,a.z).then((function(){t&&t()}));break;case"left":n.cameraControls.setLookAt(a.x-o,a.y,a.z,a.x,a.y,a.z).then((function(){t&&t()}));break;case"leftTop":n.cameraControls.setLookAt(a.x-o,a.y+o/2,a.z,a.x,a.y,a.z).then((function(){t&&t()}));break;case"right":n.cameraControls.setLookAt(a.x+o,a.y,a.z,a.x,a.y,a.z).then((function(){t&&t()}));break;case"before":n.cameraControls.setLookAt(a.x,a.y,a.z+o,a.x,a.y,a.z).then((function(){t&&t()}));break;case"back":n.cameraControls.setLookAt(a.x,a.y,a.z-o,a.x,a.y,a.z).then((function(){t&&t()}));break;case"home":n.cameraControls.setLookAt(a.x,100,a.z+o/3,a.x,a.y,a.z).then((function(){t&&t()}));break;case"shell":n.cameraControls.setLookAt(88.55205812722814,61.517755199984926,137.05047667908184,89.01065390996453,45.87943859636357,-3.085571621066399).then((function(){t&&t()}));break;case"floor":n.cameraControls.setLookAt(a.x,a.y+o/2,a.z+o/2,a.x,a.y,a.z).then((function(){t&&t()}))}}},{key:"addModelPlane",value:function(e,t){var n=this,r=this.bbox().getCenter(new s.Vector3),i=this.bbox().getSize(new s.Vector3),a=i.length();if(!this.scene.userData.object){var o=new s.Object3D;n.scene.add(o),this.scene.userData.object=o}switch(t){case"top":n.cameraControls.setLookAt(r.x,r.y+a,r.z,r.x,r.y,r.z).then((function(){setTimeout((function(){var e=n.renderer.domElement.toDataURL("image/png",1),t=n.computeScreenCoord(new s.Vector3(r.x-i.x/2,r.y+i.y/2,r.z-i.z/2)),a=n.computeScreenCoord(new s.Vector3(r.x+i.x/2,r.y+i.y/2,r.z-i.z/2)),o=n.computeScreenCoord(new s.Vector3(r.x-i.x/2,r.y+i.y/2,r.z+i.z/2)),l=Math.round(Math.abs(a.x-t.x)),u=Math.round(Math.abs(o.y-t.y)),c=new Image;c.src=e,c.onload=function(){var e=document.createElement("canvas"),a=e.getContext("2d");e.width=l,e.height=u,a.drawImage(c,Math.round(t.x),Math.round(t.y),l,u,0,0,l,u);var o=e.toDataURL("image/png",1),s=(new E.TextureLoader).load(o),h=new E.MeshBasicMaterial({map:s,transparent:!0,needsUpdate:!0}),d=new E.PlaneGeometry(i.x,i.z),p=new E.Mesh(d,h);p.name="top",p.position.set(r.x,r.y+i.y/2,r.z),p.rotation.set(-Math.PI/2,0,0),n.scene.userData.object.add(p)}}),2e3)}));break;case"left":n.cameraControls.setLookAt(r.x-a,r.y,r.z,r.x,r.y,r.z).then((function(){setTimeout((function(){var e=n.renderer.domElement.toDataURL("image/png",1),t=n.computeScreenCoord(new s.Vector3(r.x-i.x/2,r.y+i.y/2,r.z-i.z/2)),a=n.computeScreenCoord(new s.Vector3(r.x-i.x/2,r.y+i.y/2,r.z+i.z/2)),o=n.computeScreenCoord(new s.Vector3(r.x-i.x/2,r.y-i.y/2,r.z-i.z/2)),l=Math.round(Math.abs(a.x-t.x)),u=Math.round(Math.abs(o.y-t.y)),c=new Image;c.src=e,c.onload=function(){var e=document.createElement("canvas"),a=e.getContext("2d");e.width=l,e.height=u,a.drawImage(c,Math.round(t.x),Math.round(t.y),l,u,0,0,l,u);var o=e.toDataURL("image/png",1),s=(new E.TextureLoader).load(o),h=new E.MeshBasicMaterial({map:s,transparent:!0,needsUpdate:!0}),d=new E.PlaneGeometry(i.z,i.y),p=new E.Mesh(d,h);p.name="left",p.position.set(r.x-i.x/2,r.y,r.z),p.rotation.set(0,-Math.PI/2,0),n.scene.userData.object.add(p)}}),2e3)}));break;case"right":n.cameraControls.setLookAt(r.x+a,r.y,r.z,r.x,r.y,r.z).then((function(){setTimeout((function(){var e=n.renderer.domElement.toDataURL("image/png",1),t=n.computeScreenCoord(new s.Vector3(r.x+i.x/2,r.y+i.y/2,r.z+i.z/2)),a=n.computeScreenCoord(new s.Vector3(r.x+i.x/2,r.y+i.y/2,r.z-i.z/2)),o=n.computeScreenCoord(new s.Vector3(r.x+i.x/2,r.y-i.y/2,r.z+i.z/2)),l=Math.round(Math.abs(a.x-t.x)),u=Math.round(Math.abs(o.y-t.y)),c=new Image;c.src=e,c.onload=function(){var e=document.createElement("canvas"),a=e.getContext("2d");e.width=l,e.height=u,a.drawImage(c,Math.round(t.x),Math.round(t.y),l,u,0,0,l,u);var o=e.toDataURL("image/png",1),s=(new E.TextureLoader).load(o),h=new E.MeshBasicMaterial({map:s,transparent:!0,needsUpdate:!0}),d=new E.PlaneGeometry(i.z,i.y),p=new E.Mesh(d,h);p.name="right",p.position.set(r.x+i.x/2,r.y,r.z),p.rotation.set(0,Math.PI/2,0),n.scene.userData.object.add(p)}}),2e3)}));break;case"before":n.cameraControls.setLookAt(r.x,r.y,r.z+a,r.x,r.y,r.z).then((function(){setTimeout((function(){var e=n.renderer.domElement.toDataURL("image/png",1),t=n.computeScreenCoord(new s.Vector3(r.x-i.x/2,r.y+i.y/2,r.z+i.z/2)),a=n.computeScreenCoord(new s.Vector3(r.x+i.x/2,r.y+i.y/2,r.z+i.z/2)),o=n.computeScreenCoord(new s.Vector3(r.x-i.x/2,r.y-i.y/2,r.z+i.z/2)),l=Math.round(Math.abs(a.x-t.x)),u=Math.round(Math.abs(o.y-t.y)),c=new Image;c.src=e,c.onload=function(){var e=document.createElement("canvas"),a=e.getContext("2d");e.width=l,e.height=u,a.drawImage(c,Math.round(t.x),Math.round(t.y),l,u,0,0,l,u);var o=e.toDataURL("image/png",1),s=(new E.TextureLoader).load(o),h=new E.MeshBasicMaterial({map:s,transparent:!0,needsUpdate:!0}),d=new E.PlaneGeometry(i.x,i.y),p=new E.Mesh(d,h);p.name="before",p.position.set(r.x,r.y,r.z+i.z/2),n.scene.userData.object.add(p)}}),2e3)}));break;case"back":n.cameraControls.setLookAt(r.x,r.y,r.z-a,r.x,r.y,r.z).then((function(){setTimeout((function(){var e=n.renderer.domElement.toDataURL("image/png",1),t=n.computeScreenCoord(new s.Vector3(r.x+i.x/2,r.y+i.y/2,r.z-i.z/2)),a=n.computeScreenCoord(new s.Vector3(r.x-i.x/2,r.y+i.y/2,r.z-i.z/2)),o=n.computeScreenCoord(new s.Vector3(r.x+i.x/2,r.y-i.y/2,r.z-i.z/2)),l=Math.round(Math.abs(a.x-t.x)),u=Math.round(Math.abs(o.y-t.y)),c=new Image;c.src=e,c.onload=function(){var e=document.createElement("canvas"),a=e.getContext("2d");e.width=l,e.height=u,a.drawImage(c,Math.round(t.x),Math.round(t.y),l,u,0,0,l,u);var o=e.toDataURL("image/png",1),s=(new E.TextureLoader).load(o),h=new E.MeshBasicMaterial({map:s,transparent:!0,needsUpdate:!0}),d=new E.PlaneGeometry(i.x,i.y),p=new E.Mesh(d,h);p.name="back",p.position.set(r.x,r.y,r.z-i.z/2),p.rotation.set(0,Math.PI,0),n.scene.userData.object.add(p)}}),2e3)}))}}},{key:"getCenterAndSize",value:function(e){var t=this.getObjectBox(e);return{center:t.getCenter(new E.Vector3),size:t.getSize(new E.Vector3)}}},{key:"getCenterAndSize3",value:function(e,t){var n=this.getObjectBox3(e,t);return{center:n.getCenter(new E.Vector3),size:n.getSize(new E.Vector3)}}},{key:"getCenterAndSize4",value:function(e,t){var n=this.getObjectBox4(e,t);return{center:n.getCenter(new E.Vector3),size:n.getSize(new E.Vector3)}}},{key:"getCesiumClipRange",value:function(e,t){var n=(new E.Box3).setFromObject3(e,t.clone().invert()),r=[];r.push(1*(n.max.x+.01),-1*(n.min.x-.01),1*(n.max.y+.01),-1*(n.min.y-.01),1*(n.max.z+.01),-1*(n.min.z-.01));var i=new s.Plane(new s.Vector3(-1,0,0),r[0]).applyMatrix4(t),a=new s.Plane(new s.Vector3(1,0,0),r[1]).applyMatrix4(t),o=new s.Plane(new s.Vector3(0,-1,0),r[2]).applyMatrix4(t),l=new s.Plane(new s.Vector3(0,1,0),r[3]).applyMatrix4(t),u=new s.Plane(new s.Vector3(0,0,-1),r[4]).applyMatrix4(t),c=new s.Plane(new s.Vector3(0,0,1),r[5]).applyMatrix4(t);return{xRange:[-a.constant,i.constant],yRange:[-l.constant,o.constant],zRange:[-c.constant,u.constant]}}},{key:"getCenterAndSize2",value:function(e){var t=this.bbox3(e);return{center:t.getCenter(new E.Vector3),size:t.getSize(new E.Vector3)}}},{key:"setCameraStandByObjects",value:function(e,t){var n=this,r=this.bbox(t),i=new s.Vector3;r.getCenter(i);var a=r.getSize(new E.Vector3).length();switch(e){case"top":n.cameraControls.setLookAt(i.x,i.y+a,i.z,i.x,i.y,i.z);break;case"down":n.cameraControls.setLookAt(i.x,i.y-a,i.z,i.x,i.y,i.z);break;case"left":n.cameraControls.setLookAt(i.x-a,i.y,i.z,i.x,i.y,i.z);break;case"leftTop":n.cameraControls.setLookAt(i.x-a,i.y+a/2,i.z,i.x,i.y,i.z);break;case"right":n.cameraControls.setLookAt(i.x+a,i.y,i.z,i.x,i.y,i.z);break;case"before":n.cameraControls.setLookAt(i.x,i.y,i.z+a,i.x,i.y,i.z);break;case"back":n.cameraControls.setLookAt(i.x,i.y,i.z-a,i.x,i.y,i.z);break;case"home":n.cameraControls.setLookAt(i.x,100,i.z+a/3,i.x,i.y,i.z);break;case"shell":n.cameraControls.setLookAt(88.55205812722814,61.517755199984926,137.05047667908184,89.01065390996453,45.87943859636357,-3.085571621066399);break;case"floor":n.cameraControls.setLookAt(i.x,i.y+a/1.5,i.z+1.5*a,i.x,i.y,i.z)}}},{key:"setCameraPosition",value:function(e,t,n,r,i,a){var o=new s.Vector3(e,t,n),l=new s.Vector3(r,i,a);this.cameraControls.setLookAt(o.x,o.y,o.z,l.x,l.y,l.z)}},{key:"emptyRootScene2",value:function(){if(0!==this.scene.children.length){for(var e=this.scene.children.length-1;e>=0;e--)"Sprite"!==this.scene.children[e].type&&"Points"!==this.scene.children[e].type&&"Group"!==this.scene.children[e].type&&"Scene"!==this.scene.children[e].type&&"Mesh"!==this.scene.children[e].type||"RootScene"===this.scene.children[e].name||this.dispose(this.scene.children[e]);this.render()}}},{key:"emptyRootScene",value:function(){this.emptyRootScene2(),window.removeEventListener("keydown",this.keydownFn),this.renderer.renderLists.dispose(),this.renderer.dispose(),this.scene.background instanceof E.Texture&&this.scene.background.dispose(),this.scene.environment&&this.scene.environment.dispose(),this.scene.clear(),this.scene=null,this.camera=null,this.cameraControls.dispose(),this.cameraControls=null,this._transformControls&&(this._transformControls.dispose(),this._transformControls=null),this.renderer.domElement.remove(),this.renderer.domElement=null,this.renderer=null,E.Cache.clear(),this.CSS2DRenderer.domElement.remove(),this.CSS2DRenderer.domElement=null,this.CSS2DRenderer=null,this.renderTarget.dispose(),this.renderTarget=null;var e=this.el.cloneNode(!0);this.el.parentNode.replaceChild(e,this.el),this.el.innerHTML="",this.el=null,this.clock=null,this.finalComposer=null,this.composer=null,this.FXAAShaderPass=null,this.needMovingLights=null,this.touchTargetObjs=null,this.touchTargetIDs=null,this.touchEnableLayers=null,this.pickEnableLayers=null,this.mixers=null,this.lightningStrikes=null,this.tilesRenderers=null}},{key:"removeObject",value:function(e){e.traverse((function(e){"Mesh"===e.type&&(Array.isArray(e.material)?e.material.forEach((function(e){e.dispose()})):e.material.dispose(),e.material=null,e.geometry.dispose(),e.geometry=null)})),e.parent.remove(e)}},{key:"setSceneTransparent",value:function(e,t){this.traverseNodes(this.scene,(function(n){n.isMesh&&(n.material.transparent=e,a().isNil(t)||(n.material.opacity=t))}))}},{key:"setModelTransparent",value:function(e,t,n,r,i){var o=this;this.traverseNodes(t,(function(t){if(t.isMesh){void 0===o.materialMap.get(t.uuid)&&o.materialMap.set(t.uuid,{mesh:t,material:o._getMeshMaterial(t),sceneName:e});var s=o._getMeshMaterial(t);s.transparent=!0,s.opacity=n,a().isNil(r)||(s.depthWrite=r),a().isNil(i)||s.color.setHex(i)}}))}},{key:"getPoint",value:function(e,t){var n=new E.Vector3(e.x,e.y,e.z),r=new E.Vector3(t.x,t.y,t.z);return new E.Raycaster(n,r).intersectObjects(this.scene.children,!0)[0]}},{key:"setRendererOutputEncoding",value:function(e){1===e&&(this.renderer.outputEncoding=E.GammaEncoding),2===e&&(this.renderer.outputEncoding=E.sRGBEncoding),0===e&&(this.renderer.outputEncoding=E.LinearEncoding)}},{key:"setCameraFitToScene",value:function(){this.cameraControls.fitTo(this.scene,!1)}},{key:"setAnimationState",value:function(){arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?cancelAnimationFrame(this.animationFrame):this.animation()}},{key:"setTransparentState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.transparentState=e}},{key:"addGround",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ground",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:-1,z:0},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{radius:200,segments:100},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{textureUrl:null,color:8421504,repeatX:1,repeatY:1,roughness:null,metalness:null};null!==i.textureUrl&&(new E.TextureLoader).load(i.textureUrl,(function(a){a.wrapS=E.RepeatWrapping,a.wrapT=E.RepeatWrapping,a.repeat.x=i.repeatX,a.repeat.y=i.repeatY;var o=new E.CircleGeometry(r.radius,r.segments),s=new E.MeshStandardMaterial({map:a,transparent:!0}),l=new E.Mesh(o,s);l.name=t,l.position.set(n.x,n.y,n.z),l.rotation.x=-Math.PI/2,l.layers.enable(5),e.scene.add(l)}))}},{key:"addGridHelper",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=new E.GridHelper(e,t,n,r);i.material.opacity=.1,i.material.transparent=!0,this.scene.add(i)}},{key:"setAllMaterialAttribute",value:function(e,t){this.traverseNodes(this.scene,(function(n){n.material.roughness=e,n.material.metalness=t}))}},{key:"setObjectMaterialAttribute",value:function(e,t,n,r){if("Mesh"==e.type)if("onley"!=e.material.name){var i=new E.MeshStandardMaterial;i.name="onley",i.roughness=t,i.metalness=n,i.color=r||e.material.color,e.material=i}else e.material.roughness=t,e.material.metalness=n,e.material.color=r||e.material.color}},{key:"rotateOnAxisY",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new E.Vector3,r=new E.Matrix4;r.makeRotationY(t);var i=new E.Vector3(e.x,e.y,e.z);return i.applyMatrix4(r),i.add(n)}},{key:"transformControlAttach",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.scene.add(this.transformControls),this.transformControls.detach(),this.transformControls.enabled=!0,this.transformControls.attach(e),t)if("Mesh"==e.type){var n=(new s.Box3).setFromObject(e),r=new s.Sphere;r=n.getBoundingSphere(r),this.cameraControls.fitToSphere(r,!0)}else if(("Object3D"==e.type||"Group"==e.type||"Scene"==e.type)&&e.children.length>0){var i=(new s.Box3).setFromObject(e),a=new s.Sphere;a=i.getBoundingSphere(a),this.cameraControls.fitToSphere(a,!0)}}},{key:"transformControlAttach2",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.scene.add(this.transformControls),this.transformControls.detach(),this.transformControls.enabled=!0;var n=new s.Box3;n.setFromObject(e);var r=n.getCenter(new s.Vector3),i=n.getSize(new s.Vector3);if(r.y-=i.y/2,this.transformHelper||(this.transformHelper=new s.Object3D,this.transformHelper.name="辅助平移拖动中心",this.scene.add(this.transformHelper)),this.transformHelper.position.copy(r),this.transformHelper.userData.transformPosition=e.position.clone().sub(r),this.transformHelper.userData.transformObject=e,this.transformControls.attach(this.transformHelper),t)if("Mesh"==e.type){var a=(new s.Box3).setFromObject(e),o=new s.Sphere;o=a.getBoundingSphere(o),this.cameraControls.fitToSphere(o,!0)}else if(("Object3D"==e.type||"Group"==e.type||"Scene"==e.type)&&e.children.length>0){var l=(new s.Box3).setFromObject(e),u=new s.Sphere;u=l.getBoundingSphere(u),this.cameraControls.fitToSphere(u,!0)}}},{key:"transformControlDetach",value:function(){this.transformControls.object&&(this.scene.remove(this.transformControls),this.scene.remove(this.transformHelper),this.transformHelper=null,this.transformControls.enabled=!1,this.transformControls.detach())}},{key:"convertTranfornmT2UE",value:function(e,t,n){var r=new s.Object3D;r.position.set(e.x,e.y,e.z),r.rotation.set(t.x,t.y,t.z),r.scale.set(n.x,n.y,n.z),r.updateMatrix();var i=r.matrix,a=new s.Vector3,o=new s.Quaternion,l=new s.Vector3;i.decompose(a,o,l);var u=new s.Matrix4;u.set(i.elements[0],i.elements[4],i.elements[8],i.elements[12],i.elements[2],i.elements[6],i.elements[10],i.elements[14],i.elements[1],i.elements[5],i.elements[9],i.elements[13],i.elements[3],i.elements[7],i.elements[11],i.elements[15]);var c=new s.Vector3,h=new s.Quaternion,d=new s.Vector3;u.decompose(c,h,d)}},{key:"readPixels",value:function(e,t){this.renderer.setRenderTarget(this.renderTarget),this.renderer.clear(),this.renderer.render(this.scene,this.camera);var n=new Uint8Array(4);return this.renderer.readRenderTargetPixels(this.renderTarget,e,this.height-t,1,1,n),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.camera),{r:n[0],g:n[1],b:n[2]}}},{key:"getMeshVertex",value:function(e,t){var n=e.geometry.attributes.position.array,r=e.geometry.attributes.normal.array,i=new E.Vector3(n[3*t],n[3*t+1],n[3*t+2]);i.applyMatrix4(e.matrixWorld);var a=new E.Matrix4;a.extractRotation(e.matrixWorld);var o=new E.Vector3(r[3*t],r[3*t+1],r[3*t+2]).applyMatrix4(a);return{vP:i,nP:new E.Vector3(i.x+o.x,i.y+o.y,i.z+o.z),normal:o}}},{key:"getAngle",value:function(e,t){return new E.Vector3(e.x,e.y,e.z).angleTo(new E.Vector3(t.x,t.y,t.z))}},{key:"getAreaLightVertexs",value:function(e){var t=new E.Vector3(0+e.width/2,0-e.height/2,0);t.applyMatrix4(e.matrixWorld);var n=new E.Vector3(0-e.width/2,0-e.height/2,0);n.applyMatrix4(e.matrixWorld);var r=new E.Vector3(0-e.width/2,0+e.height/2,0);r.applyMatrix4(e.matrixWorld);var i=new E.Vector3(0+e.width/2,0+e.height/2,0);return i.applyMatrix4(e.matrixWorld),[t,n,r,i]}},{key:"mergeMesh",value:function(e,t,n,r){this.scene.updateMatrixWorld(!0);var i,a=[];t.forEach((function(e){a.push(e.geometry.clone().applyMatrix4(e.matrixWorld))})),i=Array.isArray(t[0].material)?t[0].material[0].clone():t[0].material.clone();var o=be.mergeBufferGeometries(a,!0);i.map.image.src=r,i.map.needsUpdate=!0;var s=new E.Mesh(o,i);return s.name=n,s.material.metalness=0,s.material.roughness=1,s.material.color.setHex(16777215),s.material.emissive.setHex(16777215),s.layers.enable(5),t.forEach((function(e){e.parent.remove(e)})),e.add(s),s}},{key:"mergeBufferGeometries",value:function(e){return be.mergeBufferGeometries(e,!0)}},{key:"deinterleaveGeometry",value:function(e){!function(e){for(var t in e.attributes){var n=e.attributes[t];if(n.normalized){var r=Le(n);e.setAttribute(t,r)}}}(e)}},{key:"addEdges",value:function(e){var t=[],n=new E.LineBasicMaterial({color:16711680}),r=new E.EdgesGeometry(e.geometry.clone()),i=new E.LineSegments(r,n);i.applyMatrix4(e.matrix.clone()),e.parent.add(i);for(var a=i.geometry.attributes.position.array,o=0;o<a.length;o+=3){var l=new s.Vector3(a[o],a[o+1],a[o+2]);t.push(l.applyMatrix4(e.matrixWorld))}return{line:i,positions:t}}},{key:"getBoxPoints",value:function(e,t){if(e.visible){if(e instanceof E.InstancedMesh);else{e.updateWorldMatrix(!1,!1);var n=e.geometry;if(void 0!==n&&"skybox"!=e.name){null===n.boundingBox&&n.computeBoundingBox();var r=new s.Vector3(n.boundingBox.min.x,n.boundingBox.min.y,n.boundingBox.min.z);r.applyMatrix4(e.matrixWorld),t.push(r);var i=new s.Vector3(n.boundingBox.max.x,n.boundingBox.min.y,n.boundingBox.min.z);i.applyMatrix4(e.matrixWorld),t.push(i);var a=new s.Vector3(n.boundingBox.min.x,n.boundingBox.max.y,n.boundingBox.min.z);a.applyMatrix4(e.matrixWorld),t.push(a);var o=new s.Vector3(n.boundingBox.min.x,n.boundingBox.min.y,n.boundingBox.max.z);o.applyMatrix4(e.matrixWorld),t.push(o);var l=new s.Vector3(n.boundingBox.max.x,n.boundingBox.max.y,n.boundingBox.min.z);l.applyMatrix4(e.matrixWorld),t.push(l);var u=new s.Vector3(n.boundingBox.max.x,n.boundingBox.min.y,n.boundingBox.max.z);u.applyMatrix4(e.matrixWorld),t.push(u);var c=new s.Vector3(n.boundingBox.min.x,n.boundingBox.max.y,n.boundingBox.max.z);c.applyMatrix4(e.matrixWorld),t.push(c);var h=new s.Vector3(n.boundingBox.max.x,n.boundingBox.max.y,n.boundingBox.max.z);h.applyMatrix4(e.matrixWorld),t.push(h)}}"instancedMeshes"in e.userData&&!e.userData.isReset&&e.userData.instancedMeshes.forEach((function(e){var n=e.mesh,r=e.id;if(n.userData.meshVisible[r]&&n.userData.isShowArr[r]){n.updateWorldMatrix(!1,!1);var i=n.geometry;if(void 0!==i){null===i.boundingBox&&i.computeBoundingBox();var a=new s.Vector3(i.boundingBox.min.x,i.boundingBox.min.y,i.boundingBox.min.z);a.applyMatrix4(n.userData.matrix[r]).applyMatrix4(n.matrixWorld),t.push(a);var o=new s.Vector3(i.boundingBox.max.x,i.boundingBox.min.y,i.boundingBox.min.z);o.applyMatrix4(n.userData.matrix[r]).applyMatrix4(n.matrixWorld),t.push(o);var l=new s.Vector3(i.boundingBox.min.x,i.boundingBox.max.y,i.boundingBox.min.z);l.applyMatrix4(n.userData.matrix[r]).applyMatrix4(n.matrixWorld),t.push(l);var u=new s.Vector3(i.boundingBox.min.x,i.boundingBox.min.y,i.boundingBox.max.z);u.applyMatrix4(n.userData.matrix[r]).applyMatrix4(n.matrixWorld),t.push(u);var c=new s.Vector3(i.boundingBox.max.x,i.boundingBox.max.y,i.boundingBox.min.z);c.applyMatrix4(n.userData.matrix[r]).applyMatrix4(n.matrixWorld),t.push(c);var h=new s.Vector3(i.boundingBox.max.x,i.boundingBox.min.y,i.boundingBox.max.z);h.applyMatrix4(n.userData.matrix[r]).applyMatrix4(n.matrixWorld),t.push(h);var d=new s.Vector3(i.boundingBox.min.x,i.boundingBox.max.y,i.boundingBox.max.z);d.applyMatrix4(n.userData.matrix[r]).applyMatrix4(n.matrixWorld),t.push(d);var p=new s.Vector3(i.boundingBox.max.x,i.boundingBox.max.y,i.boundingBox.max.z);p.applyMatrix4(n.userData.matrix[r]).applyMatrix4(n.matrixWorld),t.push(p)}}}));for(var d=e.children,p=0,f=d.length;p<f;p++)this.getBoxPoints(d[p],t)}}},{key:"getBoxPoints2",value:function(e,t){if(e.visible)if("instanceId"in e){var n=e.mesh,r=e.instanceId,i=n.geometry;if(void 0!==i)for(var a=i.attributes.position.array,o=0;o<a.length;o+=3){var s=a[o],l=a[o+1],u=a[o+2],c=new E.Vector3(s,l,u);c.applyMatrix4(n.userData.matrix[r]).applyMatrix4(n.matrixWorld),t.push(c)}}else{if(e instanceof E.InstancedMesh);else{e.updateWorldMatrix(!1,!1);var h=e.geometry;if(void 0!==h&&"skybox"!=e.name)for(a=h.attributes.position.array,o=0;o<a.length;o+=3){s=a[o],l=a[o+1],u=a[o+2];var d=new E.Vector3(s,l,u);d.applyMatrix4(e.matrixWorld),t.push(d)}}"instancedMeshes"in e.userData&&!e.userData.isReset&&e.userData.instancedMeshes.forEach((function(e){var n=e.mesh,r=e.id;if(n.userData.meshVisible[r]&&n.userData.isShowArr[r]){n.updateWorldMatrix(!1,!1);var i=n.geometry;if(void 0!==i)for(var a=i.attributes.position.array,o=0;o<a.length;o+=3){var s=a[o],l=a[o+1],u=a[o+2],c=new E.Vector3(s,l,u);c.applyMatrix4(n.userData.matrix[r]).applyMatrix4(n.matrixWorld),t.push(c)}}}));for(var p=e.children,f=0,m=p.length;f<m;f++)this.getBoxPoints2(p[f],t)}}},{key:"getAutoBox",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=[];e.forEach((function(e){t.getBoxPoints2(e,r)}));for(var i,a,o,l,u=r.map((function(e){return new E.Vector2(e.x,e.z)})),c=r.map((function(e){return e.y})).sort((function(e,t){return e-t})),h=(u=this.CalculateConvexHull_Graham(u)).map((function(e){return e.x})).sort((function(e,t){return e-t})),d=u.map((function(e){return e.y})).sort((function(e,t){return e-t})),p=new E.Vector2((h[0]+h[h.length-1])/2,(d[0]+d[d.length-1])/2),f=1/0,m=function(){var e;e=v<u.length-1?Math.atan2(-u[v+1].y+u[v].y,u[v+1].x-u[v].x):Math.atan2(-u[0].y+u[v].y,u[0].x-u[v].x);var t=1/0,n=1/0,r=-1/0,s=-1/0;u.forEach((function(i,a){var o=i.clone().rotateAround(p,e);t=Math.min(t,o.x),n=Math.min(n,o.y),r=Math.max(r,o.x),s=Math.max(s,o.y)}));var c=(r-t)*(s-n);c<f&&(f=c,Math.PI,i=new E.Vector2(t,n).rotateAround(p,-e),a=new E.Vector2(t,s).rotateAround(p,-e),o=new E.Vector2(r,s).rotateAround(p,-e),l=new E.Vector2(r,n).rotateAround(p,-e))},v=0;v<u.length;v++)m();var g=[i,a,o,l],y=Math.atan2(g[0].y-g[1].y,g[1].x-g[0].x),x=g[1].distanceTo(g[0]),b=g[2].distanceTo(g[1]),M=new s.Vector3((g[0].x+g[1].x+g[2].x+g[3].x)/4,(c[0]+c[c.length-1])/2,(g[0].y+g[1].y+g[2].y+g[3].y)/4),w=new s.Vector3(x,c[c.length-1]-c[0],b),_=new s.Box3;return _.setFromCenterAndSize(new s.Vector3(0,0,0),w.multiplyScalar(n)),{box:_,rotationY:y,position:M}}},{key:"mean",value:function(e){if(0===e.length)throw"Array is empty";return e.reduce((function(e,t){return e+t}),0)/e.length}},{key:"covariance",value:function(e,t){if(e.length!=t.length)return null;for(var n=this.mean(e),r=this.mean(t),i=0,a=0;a<e.length;a++)i+=(e[a]-n)*(t[a]-r);return i/e.length}},{key:"IsCCW",value:function(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)>0}},{key:"CalculateConvexHull_Graham",value:function(e){if(e.length<3)return e;for(var t=[],n=e[0],r=1;r<e.length;r++)(e[r].y<n.y||e[r].y==n.y&&e[r].x<n.x)&&(n=e[r]);e.splice(e.indexOf(n),1),e.sort((function(e,t){return Math.atan2(e.y-n.y,e.x-n.x)-Math.atan2(t.y-n.y,t.x-n.x)}));var i=e;t.push(n);for(var a=0;a<i.length;a++){for(;t.length>=2&&!this.IsCCW(t[t.length-2],t[t.length-1],i[a]);)t.splice(t.length-1,1);t.push(i[a])}return t}},{key:"setExperimentFlag",value:function(e){Object.assign(this.experimentFlag,null!=e?e:{})}},{key:"addAfterInitTransformControlsCallback",value:function(e){this.afterInitTransformControlsCallbackList.push(e)}},{key:"addTouchEnableList",value:function(e){this.touchTargetObjs.push(e),this.touchTargetIDs.push(e.uuid)}},{key:"removeTouchEnableList",value:function(e){this.touchTargetObjs=this.touchTargetObjs.filter((function(t){return t.uuid!=e.uuid})),this.touchTargetIDs=this.touchTargetIDs.filter((function(t){return t!=e.uuid}))}}])}(),ke=function(){function e(){(0,v.default)(this,e),this.core=null,this.action=null,this.doubleClickAction=null,this.mousedownAction=null,this.mouseMoveAction=null,this.mouseUpAction=null,this.touchAction=null,this.restore=null}return(0,g.default)(e,[{key:"getCore",value:function(){return this.core}}])}();!function(e){e[e.TOP=1]="TOP",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT",e[e.RIGHT=4]="RIGHT",e[e.FRONT=5]="FRONT",e[e.BACK=6]="BACK"}(Be||(Be={}));var Re,Oe=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t))._rotate=function(t){var n=e.getCore().getModelCenter(),r=e.getCore().getModelSize();switch(t){case Be.TOP:e.getCore().cameraControls.setPosition(n.x,n.y+r,n.z);break;case Be.BOTTOM:e.getCore().cameraControls.setPosition(n.x,n.y-r,n.z);break;case Be.FRONT:e.getCore().cameraControls.setPosition(n.x,n.y,n.z+r);break;case Be.BACK:e.getCore().cameraControls.setPosition(n.x,n.y,n.z-r);break;case Be.LEFT:e.getCore().cameraControls.setPosition(n.x-r,n.y,n.z);break;case Be.RIGHT:e.getCore().cameraControls.setPosition(n.x+r,n.y,n.z)}},e.changePivot=function(t,n){var r=e.getCore(),i=r.scene;r.render,(new E.Box3).setFromObject(t);var a=new E.Object3D;a.position.set(n.x,n.y,n.z),t.position.set(-n.x,-n.y,-n.z),a.add(t),i.add(a),e.core.needUpdate=!0},e.changeLeftDoorPivot=function(t,n){var r=new E.Box3;r.setFromObject(t);var i=new E.Vector3;r.getCenter(i),"z"===n?e.changePivot(t,{x:i.x,y:i.y,z:r.max.z}):"x"===n&&e.changePivot(t,{x:r.max.x,y:i.y,z:i.z})},e.changeRightDoorPivot=function(t,n){var r=new E.Box3;r.setFromObject(t);var i=new E.Vector3;r.getCenter(i),"z"===n?e.changePivot(t,{x:i.x,y:i.y,z:r.min.z}):"x"===n&&e.changePivot(t,{x:r.min.x,y:i.y,z:i.z})},e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"rotate",value:function(e){this._rotate(e)}},{key:"rotateTop",value:function(){this.rotate(Be.TOP)}},{key:"rotateBottom",value:function(){this.rotate(Be.BOTTOM)}},{key:"rotateLeft",value:function(){this.rotate(Be.LEFT)}},{key:"rotateRight",value:function(){this.rotate(Be.RIGHT)}},{key:"rotateFront",value:function(){this.rotate(Be.FRONT)}},{key:"rotateBack",value:function(){this.rotate(Be.BACK)}},{key:"rotateDoubleDoor",value:function(e,t){this.getCore().render,e.parent.rotation.y=t*Math.PI/180,this.core.needUpdate=!0}},{key:"rotateObject",value:function(e,t,n){this.getCore().render,e.rotation[t]+=n*Math.PI/180,this.core.needUpdate=!0}},{key:"setObjectRotation",value:function(e,t,n){this.getCore().render,e.rotation[t]=n*Math.PI/180,this.core.needUpdate=!0}}])}(ke),Ie=(0,g.default)((function e(){(0,v.default)(this,e)})),Fe=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).activeClick=!0,e.getHideMeshs=function(){var t=[],n=[];return e.getCore().scene.traverse((function(e){"Mesh"==e.type&&0==e.visible&&t.push(e),"Mesh"==e.type&&1==e.visible&&n.push(e)})),{true:n,false:t}},e.getHideObjs=function(){var t=[],n=[];return e.getCore().scene.traverse((function(e){"Object3D"==e.type&&0==e.visible&&t.push(e),"Object3D"==e.type&&1==e.visible&&n.push(e)})),{true:n,false:t}},e.hide=function(t){a().isNil(t)||(t.visible=!1,e.hideObjs.indexOf(t)<0&&e.hideObjs.push(t),e.core.needUpdate=!0)},e.hideAll=function(){var t=e.getCore(),n=t.scene;(0,t.traverseNodes)(n,(function(t){t.parent&&e.hide(t.parent)}))},e.hideById=function(t){var n=e.getCore(),r=n.scene;(0,n.traverseNodes)(r,(function(n){"Object3D"==n.parent.type&&n.parent.userData.uniqId===t&&e.changeVisibleFlag(n.parent,!1)})),e.core.needUpdate=!0},e.hideByIdInObject3D=function(t){var n=e.getCore(),r=n.scene;(0,n.traverseNodesAll)(r,(function(n){"Object3D"==n.type&&n.userData.uniqId===t&&e.changeVisibleFlag(n,!1)})),e.core.needUpdate=!0},e.hideByIds=function(t){var n=e.getCore(),r=n.scene;(0,n.traverseNodes)(r,(function(n){n.parent&&t.indexOf(n.parent.userData.uniqId)>=0&&e.hide(n.parent)}))},e.action=function(t){if(e.activeClick){var n=t.intersection;if(n.object.count){var r=e.getCore().extractMeshFromInstance(n.object,n.instanceId);e.hide(r)}else e.hide(n.object)}},e.restore=function(){e.hideObjs.forEach((function(e){e.visible=!0})),e.hideObjs=new Array,e.core.needUpdate=!0},e.restoreById=function(t){a().remove(e.hideObjs,(function(e){return e.userData.uniqId===t&&(e.visible=!0,!0)})),e.core.needUpdate=!0},e.restoreByIds=function(t){a().remove(e.hideObjs,(function(e){return!(t.indexOf(e.userData.uniqId)<0||(e.visible=!0,0))})),e.core.needUpdate=!0},e.restoreByCodeAndType=function(t,n){for(var r=0;r<e.hideObjs.length;r++){var i=e.hideObjs[r].parent.userData[n];if(null!=i)if("roomId"==n)for(var a=0;a<i.length;a++)i[a]==t&&e.changeVisibleFlag(e.hideObjs[r],!0);else i==t&&e.changeVisibleFlag(e.hideObjs[r],!0)}e.core.needUpdate=!0},e.hideByCodeAndType=function(t,n){var r=e.getCore(),i=r.scene;(0,r.traverseNodes)(i,(function(r){var i=r.parent.userData[n];if(null!=i)if("roomId"==n){if("Object3D"==r.parent.type&&r.parent)for(var a=0;a<i.length;a++)r.parent&&i[a]==t&&1!=r.parent.userData.professionalId&&e.changeVisibleFlag(r,!1)}else"Object3D"==r.parent.type&&r.parent&&i.length>=0&&r.parent&&i==t&&e.changeVisibleFlag(r,!1)})),e.core.needUpdate=!0},e.clearHideNodes=function(){for(var t in e.hideObjs)e.hideObjs[t].visible||(e.hideObjs[t].geometry.dispose(),e.hideObjs[t].material.dispose());e.core.needUpdate=!0},e.removeHideNodes=function(){for(var t in e.hideObjs)e.hideObjs[t].visible||e.hideObjs[t].parent.remove(e.hideObjs[t]);e.core.needUpdate=!0},e.closeHideNodesMatrixAutoUpdate=function(){for(var t in e.hideObjs)e.hideObjs[t].visible||(e.hideObjs[t].matrixAutoUpdate=!1);e.core.needUpdate=!0},e.splitScene=function(){var t=e.getCore().scene,n=[],r=[];for(var i in e.hideObjs)e.hideObjs[i].visible||n.push(e.hideObjs[i]);for(var a=0;a<3;a++)r[a]=new E.Object3D;for(var o in n)r[Math.round(2*Math.random())].add(n[o]);for(var s in r)r[s].traverse((function(e){"Mesh"===e.type&&(e.visible=!1)})),r[s].visible=!1,t.add(r[s]);e.core.needUpdate=!0},e.hideGlbScene=function(t){var n=e.getCore().scene;for(var r in n.children[0].children)-1!==t.indexOf(r)&&(n.children[0].children[r].visible=!1)},e.hideObjByOpcity=function(t,n){var r=e.getCore();(0,r.traverseNodes)(r.scene,(function(e){e.isMesh&&null!==e.material&&e.material.opacity<1&&e.material.opacity>n&&e.material.opacity<t&&(e.material.opacity=0)})),e.core.needUpdate=!0},e.hideAllNode=function(){var t=e.getCore(),n=t.scene;(0,t.traverseNodes)(n,(function(t){e.changeVisibleFlag(t,!1)})),e.core.needUpdate=!0},e.restoreAllNode=function(){var t=e.getCore(),n=t.scene;(0,t.traverseNodes)(n,(function(t){e.changeVisibleFlag(t,!0)})),e.core.needUpdate=!0},e.shell=function(t,n){var r=e.getCore(),i=r.scene,a=r.traverseNodes;if(n)for(var o=0;o<e.hideObjs.length;o++){var s=e.hideObjs[o].parent.name,l=s.lastIndexOf("m");l>0&&s.slice(l-s.length+1)==t&&e.changeVisibleFlag(e.hideObjs[o],n)}else a(i,(function(r){if("Object3D"==r.parent.type&&r.parent&&r.parent.userData.uniqId.length>=0){var i=r.parent.userData.uniqId,a=i.lastIndexOf("m");if(a>0){var o=i.slice(a-i.length+1);r.parent&&o===t&&e.changeVisibleFlag(r,n)}}}));e.core.needUpdate=!0},e.changeVisibleFlag=function(t,n){a().isNil(t)||(t.visible=n,!n&&e.hideObjs.indexOf(t)<0&&e.hideObjs.push(t))},e.showEdges=function(t,n,r,i){n=void 0===n?1:Math.abs(n),void 0===r&&(r=16777215);var a=e.getCore().scene;void 0===i&&(i=a),t.traverse((function(e){if("Mesh"===e.type){var t=(new E.Geometry).fromBufferGeometry(e.geometry),a=new E.EdgesGeometry(t,n),o=new E.LineSegments(a,new E.LineBasicMaterial({color:r}));i.add(o),o.applyMatrix4(e.matrixWorld),o.updateMatrix()}})),e.core.needUpdate=!0},e.statisticsInformations=function(t,n,r,i){void 0===t&&(t=[.5,1,2,5,10,15,20,50,75,100,150,200,500,1e3]),void 0===n&&(n=[1,2,3,4,5,6,7,8,9,10]),void 0===r&&(r=[12,24,36,72,144,288,600,1400,2800]),void 0===i&&(i=[36,72,108,216,432,864,1800,4200,8400]);var a=e.core.scene,o=[];return a.children.forEach((function(a){var l=0,u=0,c=0,h=0,d=e.initArray(n),p=e.initArray(t),f=e.initArray(i),m=e.initArray(r);a.traverse((function(e){if("Object3D"===e.type){l++;var a=0,o=0,v=0,g=0,y=new E.Box3,x=new E.Sphere;if(y.setFromObject(e),a=(x=y.getBoundingSphere(x)).radius,e.children.forEach((function(e){var t;o++,"Mesh"===e.type&&(t="BufferGeometry"===e.geometry.type?(new s.Geometry).fromBufferGeometry(e.geometry):e.geometry,g+=t.faces.length,v+=e.geometry.index.length)})),u+=o,h+=g,c+=v,a>t[t.length-1])p[t.length][1]++;else e:for(var b=0;b<=t.length;b++)if(a<=t[b]){p[b][1]++;break e}if(o>n[n.length-1])d[n.length][1]++;else e:for(var M=0;M<=n.length;M++)if(o<=n[M]){d[M][1]++;break e}if(g>r[r.length-1])m[r.length][1]++;else e:for(var w=0;w<=r.length;w++)if(g<=r[w]){m[w][1]++;break e}if(v>i[i.length-1])f[i.length][1]++;else e:for(var _=0;_<=i.length;_++)if(v<=i[_]){f[_][1]++;break e}}}));var v=new Ie;v.glbName=a.name,v.obj=l,v.mesh=u,v.face=h,v.vertex=c,v.gbRadius=p,v.gbMesh=d,v.gbFace=m,v.gbVertex=f,o.push(v)})),o},e.initArray=function(e){for(var t=[],n=0;n<e.length;n++)t.push([e[n]+": ",0]);return t.push(["往上: ",0]),t},e.hideObjs=new Array,e}return(0,m.default)(t,e),(0,g.default)(t)}(ke),Ne=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t)).boxSize=1.1,n.activeClick=!0,n.setColor=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.isMutex;a().isNil(e)||(r&&n.restore(),e.children.forEach((function(e){if("Mesh"===e.type){var r=e;n._setMeshColor(r,t)}})),n.core.needUpdate=!0)},n.setObject3DColor=function(e,t){a().isNil(e)||((0,n.getCore().traverseNodes)(e,(function(e){n._setMeshColor(e,t)})),n.core.needUpdate=!0)},n.setObject3DColorNew=function(e,t){a().isNil(e)||(e.traverse((function(e){if("Mesh"!==e.type||e instanceof s.InstancedMesh||"MeshStandardMaterial"!==e.material.type){if("instancedMeshes"in e.userData)for(var r=0;r<e.userData.instancedMeshes.length;r++){var i=e.userData.instancedMeshes[r].mesh,a=e.userData.instancedMeshes[r].id;i.setColorAt(a,new E.Color(t)),i.instanceColor.needsUpdate=!0,void 0===n.instancedMeshMap.get(i)&&n.instancedMeshMap.set(i,[]),-1==n.instancedMeshMap.get(i).indexOf(a)&&n.instancedMeshMap.get(i).push(a)}}else{var o=e;n._setMeshColor(o,t)}})),n.core.needUpdate=!0)},n.restoreObject3DColor=function(e){a().isNil(e)||(e.traverse((function(e){if("Mesh"===e.type){var t=e;n.restoreMesh(t)}if("instancedMeshes"in e.userData)for(var r=0;r<e.userData.instancedMeshes.length;r++){var i=e.userData.instancedMeshes[r].mesh,a=e.userData.instancedMeshes[r].id;i.setColorAt(a,new E.Color),i.instanceColor.needsUpdate=!0;var o=n.instancedMeshMap.get(i);o&&o.indexOf(a)>-1&&o.splice(o.indexOf(a),1),o&&0!=o.length||(i.material.transparent=i.userData.oldTransparent),i.material.depthWrite=i.userData.oldDepthWrite,i.userData.meshVisible[a]&&(i.geometry.attributes.customOpacity.setX(a,1),i.geometry.attributes.customOpacity.needsUpdate=!0)}})),n.core.needUpdate=!0)},n.setObject3DColor2=function(e,t){a().isNil(e)||((0,n.getCore().traverseNodes)(e,(function(e){n._setMeshColor2(e,t)})),n.core.needUpdate=!0)},n.setObject3DColor3New=function(e,t,r){a().isNil(e)||(e.traverse((function(e){if("Mesh"!==e.type||e instanceof s.InstancedMesh||"MeshStandardMaterial"!==e.material.type){if("instancedMeshes"in e.userData)for(var i=0;i<e.userData.instancedMeshes.length;i++){var a=e.userData.instancedMeshes[i].mesh,o=e.userData.instancedMeshes[i].id;a.setColorAt(o,new E.Color(t)),a.instanceColor.needsUpdate=!0,a.material.transparent=!0,a.material.depthWrite=!1,a.userData.meshVisible[o]&&(a.geometry.attributes.customOpacity.setX(o,r),a.geometry.attributes.customOpacity.needsUpdate=!0),void 0===n.instancedMeshMap.get(a)&&n.instancedMeshMap.set(a,[]),-1==n.instancedMeshMap.get(a).indexOf(o)&&n.instancedMeshMap.get(a).push(o)}}else{var l=e;n._setMeshColor3(l,t,r)}})),n.core.needUpdate=!0)},n.setObject3DColor3=function(e,t,r){a().isNil(e)||((0,n.getCore().traverseNodes)(e,(function(e){n._setMeshColor3(e,t,r)})),n.core.needUpdate=!0)},n.setObjectsBoxColor=function(e,t,r,i){var o,s;if(!a().isNil(t)){n.objectBoxes.get(e)&&n.removeObjectBoxById(e);var l=n.getCore().bbox(t),u=l.getSize(new E.Vector3),c=new E.BoxBufferGeometry(u.x*n.boxSize,u.y*n.boxSize,u.z*n.boxSize),h=new E.Vector3;l.getCenter(h);var d=new E.MeshBasicMaterial({color:r,transparent:!0,opacity:null!==(o=null==i?void 0:i.opacity)&&void 0!==o?o:.2,depthWrite:!1}),p=[h.x-u.x*n.boxSize/2,h.x+u.x*n.boxSize/2],f=[h.y-u.y*n.boxSize/2,h.y+u.y*n.boxSize/2],m=[h.z-u.z*n.boxSize/2,h.z+u.z*n.boxSize/2],v=[{x:p[0],y:f[0],z:m[0]},{x:p[1],y:f[0],z:m[0]},{x:p[1],y:f[0],z:m[1]},{x:p[0],y:f[0],z:m[1]},{x:p[0],y:f[0],z:m[0]},{x:p[0],y:f[1],z:m[0]},{x:p[1],y:f[1],z:m[0]},{x:p[1],y:f[1],z:m[1]},{x:p[0],y:f[1],z:m[1]},{x:p[0],y:f[1],z:m[0]}],g=[{x:p[0],y:f[0],z:m[1]},{x:p[0],y:f[1],z:m[1]},{x:p[1],y:f[1],z:m[1]},{x:p[1],y:f[0],z:m[1]},{x:p[1],y:f[0],z:m[0]},{x:p[1],y:f[1],z:m[0]}],y=null!==(s=null==i?void 0:i.radius)&&void 0!==s?s:.002,x=16776960;i&&"lineColor"in i&&(x=i.lineColor);var b=n.addBoxLine(v,{radius:y,color:x}),M=n.addBoxLine(g,{radius:y,color:x}),w=new E.Mesh(c,d);return w.renderOrder=20,w.position.set(h.x,h.y,h.z),n.objectBoxes.set(e,[w,b,M]),n.getCore().scene.add(w),n.core.needUpdate=!0,w}},n.setAutoObjectsBoxColor=function(e,t,r,i){var o,s;if(!a().isNil(t)){n.objectBoxes.get(e)&&n.removeObjectBoxById(e);var l=[];t.forEach((function(e){n.getCore().getBoxPoints2(e,l)}));for(var u,c,h,d,p=l.map((function(e){return new E.Vector2(e.x,e.z)})),f=l.map((function(e){return e.y})).sort((function(e,t){return e-t})),m=(p=n.getCore().CalculateConvexHull_Graham(p)).map((function(e){return e.x})).sort((function(e,t){return e-t})),v=p.map((function(e){return e.y})).sort((function(e,t){return e-t})),g=new E.Vector2((m[0]+m[m.length-1])/2,(v[0]+v[v.length-1])/2),y=1/0,x=function(){var e;e=b<p.length-1?Math.atan2(-p[b+1].y+p[b].y,p[b+1].x-p[b].x):Math.atan2(-p[0].y+p[b].y,p[0].x-p[b].x);var t=1/0,n=1/0,r=-1/0,i=-1/0;p.forEach((function(a,o){var s=a.clone().rotateAround(g,e);t=Math.min(t,s.x),n=Math.min(n,s.y),r=Math.max(r,s.x),i=Math.max(i,s.y)}));var a=(r-t)*(i-n);a<y&&(y=a,Math.PI,u=new E.Vector2(t,n).rotateAround(g,-e),c=new E.Vector2(t,i).rotateAround(g,-e),h=new E.Vector2(r,i).rotateAround(g,-e),d=new E.Vector2(r,n).rotateAround(g,-e))},b=0;b<p.length;b++)x();var M=[u,c,h,d],w=Math.atan2(M[0].y-M[1].y,M[1].x-M[0].x),_=M[1].distanceTo(M[0]),A=M[2].distanceTo(M[1]),C={x:(M[0].x+M[1].x+M[2].x+M[3].x)/4,y:(f[0]+f[f.length-1])/2,z:(M[0].y+M[1].y+M[2].y+M[3].y)/4},T=_,S=f[f.length-1]-f[0],L=A,P=new E.BoxBufferGeometry(T*n.boxSize,S*n.boxSize,L*n.boxSize),B=new E.MeshBasicMaterial({color:r,transparent:!0,opacity:null!==(o=null==i?void 0:i.opacity)&&void 0!==o?o:.2,depthWrite:!1}),D=(n.boxSize,n.boxSize,n.boxSize,n.boxSize,n.boxSize,n.boxSize,[{x:C.x+(M[0].x-C.x)*n.boxSize,y:C.y+(f[0]-C.y)*n.boxSize,z:C.z+(M[0].y-C.z)*n.boxSize},{x:C.x+(M[1].x-C.x)*n.boxSize,y:C.y+(f[0]-C.y)*n.boxSize,z:C.z+(M[1].y-C.z)*n.boxSize},{x:C.x+(M[2].x-C.x)*n.boxSize,y:C.y+(f[0]-C.y)*n.boxSize,z:C.z+(M[2].y-C.z)*n.boxSize},{x:C.x+(M[3].x-C.x)*n.boxSize,y:C.y+(f[0]-C.y)*n.boxSize,z:C.z+(M[3].y-C.z)*n.boxSize},{x:C.x+(M[0].x-C.x)*n.boxSize,y:C.y+(f[f.length-1]-C.y)*n.boxSize,z:C.z+(M[0].y-C.z)*n.boxSize},{x:C.x+(M[1].x-C.x)*n.boxSize,y:C.y+(f[f.length-1]-C.y)*n.boxSize,z:C.z+(M[1].y-C.z)*n.boxSize},{x:C.x+(M[2].x-C.x)*n.boxSize,y:C.y+(f[f.length-1]-C.y)*n.boxSize,z:C.z+(M[2].y-C.z)*n.boxSize},{x:C.x+(M[3].x-C.x)*n.boxSize,y:C.y+(f[f.length-1]-C.y)*n.boxSize,z:C.z+(M[3].y-C.z)*n.boxSize}]),k=[D[0],D[1],D[2],D[3],D[0],D[4],D[5],D[6],D[7],D[4]],R=[D[3],D[7],D[6],D[2],D[1],D[5]],O=null!==(s=null==i?void 0:i.radius)&&void 0!==s?s:.002,I=16776960;i&&"lineColor"in i&&(I=i.lineColor);var F=n.addBoxLine(k,{radius:O,color:I}),N=n.addBoxLine(R,{radius:O,color:I}),z=new E.Mesh(P,B);return z.renderOrder=20,z.position.set(C.x,C.y,C.z),z.rotation.y=w,n.objectBoxes.set(e,[z,F,N]),n.getCore().scene.add(z),n.core.needUpdate=!0,z}},n.setObjectBoxColor=function(e,t,r){var i;if(!a().isNil(e)){n.objectBoxes.get(e.uuid)&&n.removeObjectBoxById(e.uuid);var o=n.getCore().getObjectBox(e),s=o.getSize(new E.Vector3),l=new E.BoxBufferGeometry(s.x*n.boxSize,s.y*n.boxSize,s.z*n.boxSize),u=new E.Vector3;o.getCenter(u);var c=new E.MeshBasicMaterial({color:t,transparent:!0,opacity:.2,depthWrite:!1}),h=[u.x-s.x*n.boxSize/2,u.x+s.x*n.boxSize/2],d=[u.y-s.y*n.boxSize/2,u.y+s.y*n.boxSize/2],p=[u.z-s.z*n.boxSize/2,u.z+s.z*n.boxSize/2],f=[{x:h[0],y:d[0],z:p[0]},{x:h[1],y:d[0],z:p[0]},{x:h[1],y:d[0],z:p[1]},{x:h[0],y:d[0],z:p[1]},{x:h[0],y:d[0],z:p[0]},{x:h[0],y:d[1],z:p[0]},{x:h[1],y:d[1],z:p[0]},{x:h[1],y:d[1],z:p[1]},{x:h[0],y:d[1],z:p[1]},{x:h[0],y:d[1],z:p[0]}],m=[{x:h[0],y:d[0],z:p[1]},{x:h[0],y:d[1],z:p[1]},{x:h[1],y:d[1],z:p[1]},{x:h[1],y:d[0],z:p[1]},{x:h[1],y:d[0],z:p[0]},{x:h[1],y:d[1],z:p[0]}],v=null!==(i=null==r?void 0:r.radius)&&void 0!==i?i:.002,g=16776960;r&&"lineColor"in r&&(g=r.lineColor);var y=n.addBoxLine(f,{radius:v,color:g}),x=n.addBoxLine(m,{radius:v,color:g}),b=new E.Mesh(l,c);return b.renderOrder=20,b.position.set(u.x,u.y,u.z),n.objectBoxes.set(e.uuid,[b,y,x]),n.getCore().scene.add(b),n.core.needUpdate=!0,b}},n.setColorById=function(e,t){var r=n.getCore(),i=r.scene,o=r.traverseNodes;r.render,a().isUndefined(t)&&(t=n.color),o(i,(function(r){if(r.parent&&r.parent.userData.uniqId===e){var i=n._getMeshColor(r);void 0===n.colorCache.get(e)&&n.colorCache.set(e,i),n._setMeshColor(r,t)}})),n.core.needUpdate=!0},n.setColorByIds=function(e,t){var r=n.getCore(),i=r.scene,o=r.traverseNodes;r.render,a().isUndefined(t)&&(t=n.color),o(i,(function(r){r.parent&&e.indexOf(r.parent.userData.uniqId)>=0&&n._setMeshColor(r,t)})),n.core.needUpdate=!0},n.setModelColorByName=function(e,t){var r=n.getCore(),i=r.getNodeByName;r.render,a().isUndefined(t)&&(t=n.color);var o=i(e);return n.setColor(o,t),n.core.needUpdate=!0,o},n.setSelectedModelColorById=function(e,t){var r=n.getCore(),i=r.scene,o=r.traverseNodes;r.render,a().isUndefined(t)&&(t=n.color),o(i,(function(r){r.parent&&r.parent.userData.uniqId===e&&n.setColor(r,t)})),n.core.needUpdate=!0},n.setMeshColor=function(e,t){n._setMeshColor(e,t)},n.setTouchObjColor=function(e,t){n.restoreTouchObjColor(),"Object3D"==e.type&&e.children.forEach((function(e){"Mesh"==e.type&&n._setTouchObjColor(e,t)})),"Mesh"==e.type&&n._setTouchObjColor(e,t)},n.restoreTouchObjColor=function(){n.touchObj.forEach((function(e,t){n._getMeshMaterial(t).color.setHex(e)})),n.touchObj=new Map},n._setTouchObjColor=function(e,t){n.touchObj.set(e,n._getMeshColor(e)),n._getMeshMaterial(e).color.setHex(t)},n.restoreById=function(e){var t=n.getCore(),r=t.scene,i=t.traverseNodes;t.render,i(r,(function(t){if(t.parent&&t.parent.userData.uniqId===e){if(void 0===n.colorCache.get(e))return;var r=n.colorCache.get(e);n._setMeshColor(t,r)}})),n.core.needUpdate=!0},n.action=function(e){if(n.activeClick){var t=e.intersection;if(t.object.count){var r=n.getCore().extractMeshFromInstance(t.object,t.instanceId);n.setColor(r,n.color)}else n.setColor(t.object,n.color)}},n.restore=function(){n.materialMap.forEach((function(e,t){t.material=e})),n.materialMap=new Map,n.instancedMeshMap.forEach((function(e,t){e.forEach((function(e){t.setColorAt(e,new E.Color),t.instanceColor.needsUpdate=!0,t.material.transparent=t.userData.oldTransparent,t.material.depthWrite=t.userData.oldDepthWrite,t.geometry.attributes.customOpacity.setX(e,1),t.geometry.attributes.customOpacity.needsUpdate=!0}))})),n.instancedMeshMap=new Map,n.core.needUpdate=!0},n.restoreBoxSelectionModel=function(){n.boxSelectionMap.forEach((function(e,t){n._setMeshColor(t,e)})),n.boxSelectionIds=[],n.boxSelectionMap=new Map,n.core.needUpdate=!0},n._setMeshColor=function(e,t){void 0===n.materialMap.get(e)?(n.materialMap.set(e,n._getMeshMaterial(e)),n._getMeshMaterial(e).color.setHex(t)):e.material.color.setHex(t)},n._setMeshColor3=function(e,t,r){if(void 0===n.materialMap.get(e)){n.materialMap.set(e,n._getMeshMaterial(e));var i=n._getMeshMaterial(e);i.color.setHex(t),i.transparent=!0,i.opacity=r,i.depthWrite=!1}else e.material.color.setHex(t)},n._setMeshColor2=function(e,t){void 0===n.materialMap.get(e)?(n.materialMap.set(e,n._getMeshMaterial(e)),e.material=new s.MeshStandardMaterial({color:t,metalness:e.material.metalness,roughness:e.material.roughness,transparent:e.material.transparent,opacity:e.material.opacity,depthWrite:e.material.depthWrite})):e.material.color.setHex(t)},n._setMeshColorPro=function(e,t,r){a().isNil(e)||(void 0===n.boxSelectionMap.get(e)?(n.boxSelectionMap.set(e,n._getMeshColor(e)),n._getMeshMaterial(e).color.setHex(t),n.boxSelectionIds.push(r)):(n._setMeshColor(e,n.boxSelectionMap.get(e)),n.boxSelectionMap.delete(e),n.boxSelectionIds.splice(n.boxSelectionIds.indexOf(r),1)))},n._getMeshColor=function(e){return n._getMeshMaterial(e).color.getHex()},n._getMeshMaterial=function(e){if(Array.isArray(e.material))return e.material[0]=e.material[0].clone(),e.material[0];var t=e.material.clippingPlanes;return e.material=e.material.clone(),e.material.clippingPlanes=t,e.material},n._getMeshStandardMaterial=function(e){return Array.isArray(e.material)?(e.material[0]=e.material[0].clone(),e.material[0]):(e.material=e.material.clone(),e.material)},n._getMeshEmissive=function(e){return n._getMeshStandardMaterial(e).emissive.getHex()},n._setMeshEmissive=function(e,t){void 0===n.materialMap.get(e)?(n.materialMap.set(e,n._getMeshStandardMaterial(e)),n._getMeshStandardMaterial(e).emissive.setHex(t)):e.material.emissive.setHex(t)},n.setObject3DEmissive=function(e,t){a().isNil(e)||((0,n.getCore().traverseNodes)(e,(function(e){n._setMeshEmissive(e,t)})),n.core.needUpdate=!0)},n.materialMap=new Map,n.instancedMeshMap=new Map,n.colorCache=new Map,n.boxSelectionMap=new Map,n.boxSelectionIds=[],n.dyeAndRecover=new Map,n.touchObj=new Map,n.lut=null,n.color=2329106,n.isMutex=!1,n.objectBoxes=new Map,a().isNil(e)||(a().isNumber(e.color)&&(n.color=e.color),a().isBoolean(e.isMutex)&&(n.isMutex=e.isMutex)),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"selectionNodeById",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.color;if(!a().isNil(e)){var n=this.core.getNodeById(e);this.getCore().selectedModel=n,this.setColor(n,t)}}},{key:"selectionNodeByIds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.color,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!a().isNil(e))for(var r=0;r<e.length;r++){var i=this.core.getNodeById(e[r]);this.setColor(i,t,n)}}},{key:"addBoxLine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{radius:.2,color:16777215},n=this.core.scene,r=[];e.forEach((function(e){r.push(new E.Vector3(e.x,e.y,e.z))}));var i=new E.PathPointList;i.set(r,0,10,!1);var a=new E.MeshStandardMaterial({color:t.color,metalness:.4,roughness:.7}),o=new E.PathTubeGeometry({pathPointList:i,options:{radius:t.radius,radialSegments:8,progress:1},usage:E.DynamicDrawUsage});o.pathPointList=i;var s=new E.Mesh(o,a);return n.add(s),s}},{key:"removeObjectBox",value:function(){var e=this.getCore().dispose;this.objectBoxes.forEach((function(t){t.forEach((function(t){t.userData.opacityTween&&(t.userData.opacityTween.stop(),t.userData.opacityTween=null),e(t)}))})),this.objectBoxes=new Map,this.core.needUpdate=!0}},{key:"removeObjectBoxById",value:function(e){var t=this.getCore().dispose,n=this.objectBoxes.get(e);n&&n.forEach((function(e){e.userData.opacityTween&&(e.userData.opacityTween.stop(),e.userData.opacityTween=null),t(e)})),this.objectBoxes.delete(e),this.core.needUpdate=!0}},{key:"setObjectBoxVisibleById",value:function(e,t){var n=this.objectBoxes.get(e);n&&n.forEach((function(e){e.visible=t})),this.core.needUpdate=!0}},{key:"setBoxSelectionColor",value:function(e,t,n){var r=this;a().isNil(e)||e.children.forEach((function(e){var i=e;r._setMeshColorPro(i,n,t)}))}},{key:"getBoxSelectionIds",value:function(){return this.boxSelectionIds}},{key:"restoreMesh",value:function(e){var t=this.materialMap.get(e);t&&(e.material=t,this.materialMap.delete(e),this.core.needUpdate=!0)}},{key:"addLutColorMap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[[0,3448032],[.25,5152083],[.5,12369199],[.75,12279357],[1,14625801]],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:32;this.lut||(this.lut=new E.Lut),this.lut.addColorMap(e,t),this.lut.setColorMap(e,i),this.lut.setMin(n),this.lut.setMax(r)}},{key:"getLutColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return e>this.lut.maxV&&(e=this.lut.maxV),e<this.lut.minV&&(e=this.lut.minV),this.lut.getColor(e)}},{key:"getColor",value:function(e){return new E.Color(e)}}])}(ke),ze=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).wireframe=function(t){e.getCore().traverseMaterials(e.getCore().scene,(function(e){e.wireframe=t})),e.core.needUpdate=!0},e.addModelEdge=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new s.LineBasicMaterial({color:n}),i=[];e.traverse((function(e){"Mesh"===e.type&&i.push(e)}));for(var a=0;a<i.length;a++){var o=i[a],l=null;l=o.geometry instanceof s.BufferGeometry?(new s.Geometry).fromBufferGeometry(o.geometry):o.geometry;var u=new s.EdgesGeometry(l,t),c=new s.LineSegments(u,r);c.name="edge",c.position.set(o.position.x,o.position.y,o.position.z),c.rotation.set(o.rotation.x,o.rotation.y,o.rotation.z),c.scale.set(o.scale.x,o.scale.y,o.scale.z),c.updateMatrixWorld(),o.parent.add(c)}},e}return(0,m.default)(t,e),(0,g.default)(t)}(ke),Ue=function(){var e=new s.Frustum,t=new s.Vector3,n=new s.Vector3,r=new s.Vector3,i=new s.Vector3,a=new s.Vector3,o=new s.Vector3,l=new s.Vector3,u=new s.Vector3,c=new s.Vector3,h=new s.Vector3,d=new s.Vector3,p=new s.Vector3,f=new s.Vector3,m=new s.Vector3;function v(e,t,n){this.camera=e,this.scene=t,this.startPoint=new s.Vector3,this.endPoint=new s.Vector3,this.collection=[],this.deep=n||Number.MAX_VALUE}return v.prototype.select=function(t,n){return this.startPoint=t||this.startPoint,this.endPoint=n||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(e,this.scene),this.collection},v.prototype.updateFrustum=function(t,s){if(t=t||this.startPoint,s=s||this.endPoint,t.x===s.x&&(s.x+=Number.EPSILON),t.y===s.y&&(s.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera)n.copy(t),n.x=Math.min(t.x,s.x),n.y=Math.max(t.y,s.y),s.x=Math.max(t.x,s.x),s.y=Math.min(t.y,s.y),r.setFromMatrixPosition(this.camera.matrixWorld),i.copy(n),a.set(s.x,n.y,0),o.copy(s),l.set(n.x,s.y,0),i.unproject(this.camera),a.unproject(this.camera),o.unproject(this.camera),l.unproject(this.camera),p.copy(i).sub(r),f.copy(a).sub(r),m.copy(o).sub(r),p.normalize(),f.normalize(),m.normalize(),p.multiplyScalar(this.deep),f.multiplyScalar(this.deep),m.multiplyScalar(this.deep),p.add(r),f.add(r),m.add(r),(v=e.planes)[0].setFromCoplanarPoints(r,i,a),v[1].setFromCoplanarPoints(r,a,o),v[2].setFromCoplanarPoints(o,l,r),v[3].setFromCoplanarPoints(l,i,r),v[4].setFromCoplanarPoints(a,o,l),v[5].setFromCoplanarPoints(m,f,p),v[5].normal.multiplyScalar(-1);else if(this.camera.isOrthographicCamera){var v,g=Math.min(t.x,s.x),y=Math.max(t.y,s.y),x=Math.max(t.x,s.x),b=Math.min(t.y,s.y);i.set(g,y,-1),a.set(x,y,-1),o.set(x,b,-1),l.set(g,b,-1),u.set(g,y,1),c.set(x,y,1),h.set(x,b,1),d.set(g,b,1),i.unproject(this.camera),a.unproject(this.camera),o.unproject(this.camera),l.unproject(this.camera),u.unproject(this.camera),c.unproject(this.camera),h.unproject(this.camera),d.unproject(this.camera),(v=e.planes)[0].setFromCoplanarPoints(i,u,c),v[1].setFromCoplanarPoints(a,c,h),v[2].setFromCoplanarPoints(h,d,l),v[3].setFromCoplanarPoints(d,u,i),v[4].setFromCoplanarPoints(a,o,l),v[5].setFromCoplanarPoints(h,c,u),v[5].normal.multiplyScalar(-1)}},v.prototype.searchChildInFrustum=function(e,n){if((n.isMesh||n.isLine||n.isPoints)&&void 0!==n.material&&(null===n.geometry.boundingSphere&&n.geometry.computeBoundingSphere(),t.copy(n.geometry.boundingSphere.center),t.applyMatrix4(n.matrixWorld),e.containsPoint(t)&&this.collection.push(n)),n.children.length>0)for(var r=0;r<n.children.length;r++)this.searchChildInFrustum(e,n.children[r])},v}(),He=function(){function e(e,t,n){this.element=document.createElement("div"),this.element.classList.add(n),this.element.style.pointerEvents="none",this.renderer=t,this.startPoint=new s.Vector2,this.pointTopLeft=new s.Vector2,this.pointBottomRight=new s.Vector2,this.isDown=!1,this.renderer.domElement.addEventListener("pointerdown",function(e){this.isDown=!0,this.onSelectStart(e)}.bind(this),!1),this.renderer.domElement.addEventListener("pointermove",function(e){this.isDown&&this.onSelectMove(e)}.bind(this),!1),this.renderer.domElement.addEventListener("pointerup",function(e){this.isDown=!1,this.onSelectOver(e)}.bind(this),!1)}return e.prototype.onSelectStart=function(e){this.renderer.domElement.parentElement.appendChild(this.element),this.element.style.left=e.clientX+"px",this.element.style.top=e.clientY+"px",this.element.style.width="0px",this.element.style.height="0px",this.startPoint.x=e.clientX,this.startPoint.y=e.clientY},e.prototype.onSelectMove=function(e){this.pointBottomRight.x=Math.max(this.startPoint.x,e.clientX),this.pointBottomRight.y=Math.max(this.startPoint.y,e.clientY),this.pointTopLeft.x=Math.min(this.startPoint.x,e.clientX),this.pointTopLeft.y=Math.min(this.startPoint.y,e.clientY),this.element.style.left=this.pointTopLeft.x+"px",this.element.style.top=this.pointTopLeft.y+"px",this.element.style.width=this.pointBottomRight.x-this.pointTopLeft.x+"px",this.element.style.height=this.pointBottomRight.y-this.pointTopLeft.y+"px"},e.prototype.onSelectOver=function(){this.element.parentElement.removeChild(this.element)},e}(),je=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t))._position=new s.Vector3,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"saveView",value:function(){var e=new s.Vector3;this.getCore().cameraControls.getPosition(e),this._position=e}},{key:"resetView",value:function(){this.getCore().cameraControls.setPosition(this._position.x,this._position.y,this._position.z,!0)}}])}(ke),Ge=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).setOrthographicCamera=function(){var t=e.getCore(),n=t.width,r=t.height,i=t.setCamera,a=t.bbox,o=(t.render,t.renderer),s=t.getModelSize,l=(a().getSize(new E.Vector3),s());i(new E.OrthographicCamera(-l*n/r/2,l*n/r/2,l/2,-l/2,1,1+2*l)),t.cameraControls=new me(t.camera,o.domElement),e.core.needUpdate=!0},e.orthographicCamera={},e}return(0,m.default)(t,e),(0,g.default)(t)}(ke),Ve=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t)).activeClick=!0,n.setMeshOpacity=function(e,t){var r=n._getMeshMaterial(e);r.transparent=!0,r.depthWrite=!1,r.opacity=t},n.getMeshOpacity=function(e){return n._getMeshMaterial(e).opacity},n.setOpacityById=function(e,t){var r=n.getCore(),i=r.scene,o=r.traverseNodes;a().isNumber(t)&&(n.opacity=t),o(i,(function(t){t.parent&&t.parent.userData.uniqId===e&&n.transparentObject(t.parent)}))},n.setOpacityByIds=function(e,t){var r=n.getCore(),i=r.scene,o=r.traverseNodes;a().isNumber(t)&&(n.opacity=t),o(i,(function(t){t.parent&&e.indexOf(t.parent.userData.uniqId)>=0&&n.transparentObject(t.parent)}))},n.setOBJOpacity=function(e,t){a().isNumber(t)&&(n.opacity=t),n.transparentObject(e)},n.action=function(e){if(n.activeClick){var t=e.intersection;if(t.object.count){var r=n.getCore().extractMeshFromInstance(t.object,t.instanceId);n.transparentObject(r)}else n.transparentObject(t.object)}},n.restore=function(){n.materialMap.forEach((function(e,t){t.material=e})),n.materialMap=new Map,n.instancedMeshMap.forEach((function(e,t){e.forEach((function(e){t.material.transparent=t.userData.oldTransparent,t.material.depthWrite=t.userData.oldDepthWrite,t.geometry.attributes.customOpacity.setX(e,1),t.geometry.attributes.customOpacity.needsUpdate=!0}))})),n.instancedMeshMap=new Map,n.core.needUpdate=!0},n.restoreByName=function(e){e.forEach((function(e){e.traverse((function(e){"Mesh"===e.type&&(e.material=n.materialMap.get(e),n.materialMap.delete(e))}))})),n.core.needUpdate=!0},n._getMeshMaterial=function(e){if(Array.isArray(e.material))return e.material[0]=e.material[0].clone(),e.material[0];var t=e.material.clippingPlanes;return e.material=e.material.clone(),e.material.clippingPlanes=t,e.material},n.setTouchObjOpcity=function(e,t){n.restoreTouchObjOpcity(),a().isNil(e)||("Object3D"==e.type&&e.children.forEach((function(e){var r=e;n._setTouchObjOpcity(r,t)})),"Mesh"==e.type&&n._setTouchObjOpcity(e,t))},n.restoreTouchObjOpcity=function(){n.touchObj.forEach((function(e,t){var r=n._getMeshMaterial(t);r.opacity=e,e>1&&(r.transparent=!1)})),n.touchObj=new Map},n._setTouchObjOpcity=function(e,t){n.touchObj.set(e,n.getMeshOpacity(e));try{var r=n._getMeshMaterial(e);r.opacity=t,r.transparent=!0}catch(e){}},n.opacityMap=new Map,n.materialMap=new Map,n.instancedMeshMap=new Map,n.touchObj=new Map,n.opacity=.2,n.isMutex=!1,a().isNil(e)||(a().isNumber(e.opacity)&&(n.opacity=e.opacity),a().isBoolean(e.isMutex)&&(n.isMutex=e.isMutex)),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"transparent",value:function(e,t){var n=this,r=this.getCore(),i=r.traverseNodes,o=r.scene;r.render,this.opacity=t,a().isString(e)?i(o,(function(e){void 0===n.opacityMap.get(e)&&n.opacityMap.set(e,n.getMeshOpacity(e)),n.setMeshOpacity(e,t)})):a().isArray(e)?a().forEach(e,(function(e){n.transparentObject(e)})):a().isObject(e)&&this.transparentObject(e),this.core.needUpdate=!0}},{key:"transparentObject",value:function(e){var t=this;a().isNil(e)||(e.traverse((function(e){if("Mesh"===e.type&&"MeshStandardMaterial"===e.material.type){var n=e;void 0===t.materialMap.get(n)&&t.materialMap.set(n,t._getMeshMaterial(n)),t.setMeshOpacity(n,t.opacity)}})),this.core.needUpdate=!0)}},{key:"transparentObjectNew",value:function(e){var t=this;a().isNil(e)||(e.traverse((function(e){if("Mesh"!==e.type||e instanceof s.InstancedMesh||"MeshStandardMaterial"!==e.material.type){if("instancedMeshes"in e.userData)for(var n=0;n<e.userData.instancedMeshes.length;n++){var r=e.userData.instancedMeshes[n].mesh,i=e.userData.instancedMeshes[n].id;r.material.transparent=!0,r.material.depthWrite=!1,r.userData.meshVisible[i]&&(r.geometry.attributes.customOpacity.setX(i,t.opacity),r.geometry.attributes.customOpacity.needsUpdate=!0),void 0===t.instancedMeshMap.get(r)&&t.instancedMeshMap.set(r,[]),-1==t.instancedMeshMap.get(r).indexOf(i)&&t.instancedMeshMap.get(r).push(i)}}else{var a=e;void 0===t.materialMap.get(a)&&t.materialMap.set(a,t._getMeshMaterial(a)),t.setMeshOpacity(a,t.opacity)}})),this.core.needUpdate=!0)}},{key:"restoreObject",value:function(e){var t=this;a().isNil(e)||(e.traverse((function(e){if("Mesh"===e.type){var n=e,r=t.materialMap.get(n);r&&(n.material=r,t.materialMap.delete(n))}if("instancedMeshes"in e.userData)for(var i=0;i<e.userData.instancedMeshes.length;i++){var a=e.userData.instancedMeshes[i].mesh,o=e.userData.instancedMeshes[i].id,s=t.instancedMeshMap.get(a);s&&s.indexOf(o)>-1&&s.splice(s.indexOf(o),1),s&&0!=s.length||(a.material.transparent=a.userData.oldTransparent),a.material.depthWrite=a.userData.oldDepthWrite,a.userData.meshVisible[o]&&(a.geometry.attributes.customOpacity.setX(o,1),a.geometry.attributes.customOpacity.needsUpdate=!0)}})),this.core.needUpdate=!0)}}])}(ke);!function(e){e.NEW="new",e.EXIST="exist"}(Re||(Re={}));var We=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).particle=null,e.markId=0,e.allTableMarkArray=[],e.lineArray=[],e.multiple=!1,e.activeClick=!0,e.loader=new E.TextureLoader,e.leftTexture=null,e.rightTexture=null,e.RoutPipes=[],e.editPoints=[],e.action=function(t){if(e.activeClick){var n=e.getCore().getMeshByName("剖切盒");if(n){for(var r=t.intersections,i=(new E.Box3).setFromObject(n),a=0;a<r.length;a++)if(i.containsPoint(r[a].point)){e.mark(r[a]);break}}else{var o=t.intersection;e.mark(o)}}},e.mark=function(t){if(!i.isNil(t)){var n=e.getCore();if("mark"!==t.object.userData.markType){if(!e.multiple){var r=e.getAllMark(),a=i.filter(r.all,(function(e){return e.userData.delEnable&&e.userData.method===Re.NEW}));n.removeMesh(a)}var o=n.getFaceNormal(t);e._addParticle({position:t.point,worldNormal:o,method:Re.NEW,name:t.object.name})}else if(e.callback2)for(var s=0;s<e.allTableMarkArray.length;s++)if(e.allTableMarkArray[s]&&e.allTableMarkArray[s].userData.markId==t.object.userData.markId){e.callback2(s+1);break}}},e.showAllMarkLine=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=e.getCore(),r=n.scene,i=n.setSimulateMotion,a=e.getAllMarkData().all,o=[];for(var s in a)o.push(a[s].position);var l=new E.CatmullRomCurve3(o);if(l.points.length>0){var u=l.getPoints(3e3),c=(new E.BufferGeometry).setFromPoints(u),h=new E.LineBasicMaterial({color:16711680,linewidth:5});e.curveObject&&r.remove(e.curveObject),e.curveObject=new E.Line(c,h),r.add(e.curveObject)}if(t){var d=e.getCore().getModelSize();d>20&&(d=20);var p=d/150,f=d/100,m=new E.SphereGeometry(p,f,6),v=new E.MeshBasicMaterial({color:1387597,side:E.DoubleSide});m.rotateY(Math.PI/2),e.trackModel&&r.remove(e.trackModel),e.trackModel=new E.Mesh(m,v),e.trackModel.position.set(o[0].x,o[0].y,o[0].z),e.trackModel.name="simulateMotion",e.trackModel.lookAt(new E.Vector3(0,1,0)),r.add(e.trackModel),i(t,l,e.trackModel)}e.core.needUpdate=!0},e.clearAllMarkLine=function(){var t=e.getCore().scene;e.curveObject&&(e.curveObject.geometry.dispose(),e.curveObject.material.dispose(),t.remove(e.curveObject)),e.trackModel&&(e.trackModel.geometry.dispose(),e.trackModel.material.dispose(),t.remove(e.trackModel)),e.core.needUpdate=!0},e.clearTableMarkByIndex=function(t){var n=e.getCore().scene;if(t<e.allTableMarkArray.length){if(e.allTableMarkArray[t]){var r=e.allTableMarkArray[t];r.geometry.dispose(),r.material.dispose(),n.remove(r),e.core.needUpdate=!0}e.allTableMarkArray.splice(t,1)}},e.clearAllTableMark=function(){for(var t=e.getCore().scene,n=0;n<e.allTableMarkArray.length;n++){var r=e.allTableMarkArray[n];r&&(r.geometry.dispose(),r.material.dispose(),t.remove(r))}e.core.needUpdate=!0},e.setTableMarkArrayLength=function(t){e.allTableMarkArray.length=t},e.getAllTableMark=function(){return e.allTableMarkArray},e.setTableMarkPositionX=function(t,n){e.getCore(),t<=e.allTableMarkArray.length-1&&e.allTableMarkArray[t]&&(e.allTableMarkArray[t].position.x=n),e.core.needUpdate=!0},e.setTableMarkPositionY=function(t,n){e.getCore(),t<=e.allTableMarkArray.length-1&&e.allTableMarkArray[t]&&(e.allTableMarkArray[t].position.y=n),e.core.needUpdate=!0},e.setTableMarkPositionZ=function(t,n){e.getCore(),t<=e.allTableMarkArray.length-1&&e.allTableMarkArray[t]&&(e.allTableMarkArray[t].position.z=n),e.core.needUpdate=!0},e.getTableMarkByIndex=function(t){return e.allTableMarkArray[t]},e.hideAllTableMark=function(){for(var t in e.getCore(),e.allTableMarkArray)e.allTableMarkArray[t].visible=!1;e.core.needUpdate=!0},e.showAllTableMark=function(){for(var t in e.getCore(),e.allTableMarkArray)e.allTableMarkArray[t].visible=!0;e.core.needUpdate=!0},e.addLine=function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16711680,r=arguments.length>2?arguments[2]:void 0,i=e.getCore().scene,a=[],o=0;o<t.length;o++){var s=new E.Vector3(t[o].x,t[o].y,t[o].z);a.push(s)}if(a.length>0){var l=(new E.BufferGeometry).setFromPoints(a),u=new E.LineBasicMaterial({color:n,linewidth:5});e.curveObject=new E.Line(l,u),e.curveObject.userData.type=r,e.lineArray.push(e.curveObject),i.add(e.curveObject)}e.core.needUpdate=!0},e.addFatLine=function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16711680,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,i=arguments.length>3?arguments[3]:void 0,a=e.getCore().scene,o=[],s=0;s<t.length;s++)o.push(t[s].x,t[s].y,t[s].z);if(o.length>0){var l=new E.LineMaterial({color:n,linewidth:r});l.resolution.set(window.innerWidth,window.innerHeight);var u=new E.LineGeometry;u.setPositions(o);var c=new E.Line2(u,l);c.userData.type=i,c.scale.set(1,1,1),e.lineArray.push(c),a.add(c)}e.core.needUpdate=!0},e.addLineToObject=function(t,n){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16711680,i=arguments.length>3?arguments[3]:void 0,a=(e.getCore().scene,[]),o=0;o<t.length;o++){var s=new E.Vector3(t[o].x,t[o].y,t[o].z);a.push(s)}if(a.length>0){var l=(new E.BufferGeometry).setFromPoints(a),u=new E.LineBasicMaterial({color:r,linewidth:5});e.curveObject,e.curveObject=new E.Line(l,u),e.curveObject.userData.type=i,e.lineArray.push(e.curveObject),n.add(e.curveObject)}e.core.needUpdate=!0},e.removeAllLine=function(){e.getCore().scene;for(var t=e.lineArray.length-1;t>=0;t--)e.lineArray[t].material&&e.lineArray[t].material.dispose(),e.lineArray[t].parent.remove(e.lineArray[t]);e.lineArray=[],e.core.needUpdate=!0},e.removeLinesByType=function(t){e.getCore().scene;for(var n=e.lineArray.length-1;n>=0;n--)e.lineArray[n].userData.type==t&&(e.lineArray[n].material&&e.lineArray[n].material.dispose(),e.lineArray[n].parent.remove(e.lineArray[n]));e.core.needUpdate=!0},e.addRoutPipe=function(t,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0,a=n.length;if(!(a<2)){for(var o=e.getCore(),s=o.scene,l=o.dispose,u=[],c=0;c<n.length;c++){var h=new E.Vector3(n[c].x,n[c].y,n[c].z);u.push(h)}for(var d=new E.CatmullRomCurve3(u,!1),p=new E.CurvePath,f=0;f<a-1;f++){var m=new E.LineCurve3(n[f],n[f+1]);p.curves.push(m)}var v=new E.TubeGeometry(p,64*(a-1),i.radius?i.radius:.2,i.radialSegments?i.radialSegments:8,!1),g=e.loader.load(i.url);g.wrapS=E.RepeatWrapping,g.wrapT=E.RepeatWrapping,g.repeat.set(i.repeat.x?i.repeat.x:d.getLength()/4,i.repeat.y?i.repeat.y:2),e.movingTextures.set(g,i.speed?i.speed:.01);var y=new E.MeshBasicMaterial({map:g,color:i.color?i.color:16777215,transparent:!0,opactity:1,needsUpdate:!0,depthWrite:!0}),x=i&&"opacity"in i?i.opacity:1;y.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );","gl_FragColor = vec4( outgoingLight, diffuseColor.a*"+x.toFixed(2)+" );")},g.needsUpdate=!0,r&&e.RoutPipes.length>0&&(l(e.RoutPipes[0]),e.RoutPipes=[]);var b=new E.Mesh(v,y);b.name=t,b.layers.enable(5),b.renderOrder=30,e.RoutPipes.push(b),s.add(b),e.core.needUpdate=!0}},e.addRoutPipe2=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4?arguments[4]:void 0,o=t.length;if(!(o<2)){for(var s=e.getCore(),l=s.scene,u=s.dispose,c=[],h=0;h<t.length;h++){var d=new E.Vector3(t[h].x,t[h].y,t[h].z);c.push(d)}for(var p=new E.CatmullRomCurve3(c,!1),f=new E.CurvePath,m=0;m<o-1;m++){var v=new E.LineCurve3(t[m],t[m+1]);f.curves.push(v)}var g=new E.TubeGeometry(f,64*(o-1),.2,i,!1);r&&(r.repeat.x=a||p.getLength()/4);var y=new E.MeshBasicMaterial({map:r,transparent:!0,needsUpdate:!0,depthWrite:!1});n&&e.RoutPipes.length>0&&(u(e.RoutPipes[0]),e.RoutPipes=[]);var x=new E.Mesh(g,y);e.RoutPipes.push(x),l.add(x),e.core.needUpdate=!0}},e.addRoutPipe3=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4?arguments[4]:void 0,o=t.length;if(!(o<2)){for(var s=e.getCore(),l=s.scene,u=s.dispose,h=[],d=0;d<t.length;d++){var p=new E.Vector3(t[d].x,t[d].y,t[d].z);h.push(p)}for(var f=new E.CatmullRomCurve3(h,!1),m=new E.CurvePath,v=0;v<o-1;v++){var g=new E.LineCurve3(t[v],t[v+1]);m.curves.push(g)}var y=new E.TubeGeometry(m,64*(o-1),1.5,i,!1);n&&e.RoutPipes.length>0&&(u(e.RoutPipes[0]),e.RoutPipes=[]);var x=(0,c.default)(e);e.loader.load(r,(function(e){e.wrapS=E.RepeatWrapping,e.wrapT=E.RepeatWrapping,e.repeat.set(a||f.getLength()/16,2);var t=new E.MeshBasicMaterial({color:16777215,transparent:!0,map:e,needsUpdate:!0}),n=new E.Mesh(y,t);return n.renderOrder=30,x.RoutPipes.push(n),l.add(n),x.core.needUpdate=!0,n}),void 0,(function(e){}))}},e.removeRoutpipe=function(){var t=e.getCore().dispose;if(e.RoutPipes.length>0){for(var n=e.RoutPipes.length-1;n>=0;n--)t(e.RoutPipes[n]);e.RoutPipes=[]}e.movingTextures=new Map,e.core.needUpdate=!0},e.movingTextures=new Map,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"addFirstRepetitiveTexture",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:1,y:1},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0};this.leftTexture=this.loader.load(e),this.leftTexture.wrapS=E.RepeatWrapping,this.leftTexture.wrapT=E.RepeatWrapping,this.leftTexture.repeat.set(n.x,n.y),this.leftTexture.offset.set(r.x,r.y),this.rightTexture=this.loader.load(t),this.rightTexture.wrapS=E.RepeatWrapping,this.rightTexture.wrapT=E.RepeatWrapping,this.rightTexture.repeat.set(n.x,n.y),this.rightTexture.offset.set(r.x,r.y)}},{key:"loadMarkModel",value:function(e){var t=this;(new E.ObjectLoader).load(e,(function(e){e.scale.setScalar(.1),t.particle=e}))}},{key:"getAllMark",value:function(){var e=this.getCore(),t={newBuild:[],exist:[],all:[]};return e.traverseNodes(e.scene,(function(e){var n=e.userData,r=n.markType,i=n.method;"mark"===r&&(t.all.push(e),i===Re.NEW&&t.newBuild.push(e),i===Re.EXIST&&t.exist.push(e))}),!0),t}},{key:"getAllMarkData",value:function(){var e=this.getAllMark();return{all:i.map(e.all,"userData"),exist:i.map(e.exist,"userData"),new:i.map(e.newBuild,"userData")}}},{key:"clearAllMark",value:function(){var e=this.getCore(),t=this.getAllMark().all;e.removeMesh(t),this.allTableMarkArray.length=0}},{key:"clearNewMark",value:function(){var e=this.getCore(),t=this.getAllMark().newBuild;e.removeMesh(t)}},{key:"clearExistMark",value:function(){var e=this.getCore(),t=this.getAllMark().exist;e.removeMesh(t)}},{key:"showMark",value:function(e,t,n){var r=this;i.isArray(e)?i.forEach(e,(function(e){e.method=Re.EXIST,e.position=new E.Vector3(e.position.x,e.position.y,e.position.z),e.worldNormal=new E.Vector3(e.worldNormal.x,e.worldNormal.y,e.worldNormal.z),r._addParticle(e)})):i.isObject(e)&&(e.method=Re.EXIST,e.position=new E.Vector3(e.position.x,e.position.y,e.position.z),e.worldNormal=new E.Vector3(e.worldNormal.x,e.worldNormal.y,e.worldNormal.z),this._addParticle(e,t,n))}},{key:"_generateMarkModel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16711680,t=arguments.length>1?arguments[1]:void 0,n=this.getCore().getModelSize();i.isNil(t)||(n=t),n>50&&(n=50);var r=n/150,a=n/75,o=new E.ConeBufferGeometry(r,a,6),s=new E.MeshPhysicalMaterial({color:e});o.applyMatrix4((new E.Matrix4).makeTranslation(0,-a/2,0)),o.applyMatrix4((new E.Matrix4).makeRotationX(-Math.PI/2));var l=this.particle?this.particle.clone():new E.Mesh(o,s);return l.material.color.setHex(e),l.userData.markType="mark",l}},{key:"_addParticle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.getCore().scene,i=this._generateMarkModel();r.add(i),i.position.set(0,0,0),i.lookAt(e.worldNormal),i.name=e.name,i.position.copy(e.position),i.userData.position=e.position,i.userData.worldNormal=e.worldNormal,i.userData.method=e.method,i.userData.delEnable=e.delEnable||!0,i.userData.name=e.name,i.userData.id=e.id,i.userData.type=e.markType,i.userData.markId=this.markId++,i.userData.remarks=e.markRemarks,null!=t?t>this.allTableMarkArray.length-1?(this.allTableMarkArray.length=t,this.allTableMarkArray.push(i)):this.allTableMarkArray.splice(t,0,i):this.allTableMarkArray.push(i),this.callback&&n&&this.callback(),this.core.needUpdate=!0}},{key:"run",value:function(){this.movingTextures.forEach((function(e,t){t.offset.x+=e}))}},{key:"runOld",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.rightTexture&&(this.rightTexture.offset.x-=e),this.leftTexture&&(this.leftTexture.offset.x+=e)}},{key:"createPoint",value:function(e,t){var n=new E.MeshBasicMaterial({color:t&&t.color?t.color:16711680,transparent:!0,opacity:t&&t.opacity?t.opacity:1}),r=new E.SphereGeometry(t.size||.3,32,32),i=new E.Mesh(r,n);return i.layers.enable(5),i.position.set(e.x,e.y,e.z),i.userData.type="point",this.getCore().scene.add(i),this.editPoints.push(i),this.core.needUpdate=!0,i}},{key:"createLine",value:function(e,t){var n=new E.Geometry,r=new E.LineBasicMaterial({color:65280});n.vertices.push((new E.Vector3).copy(e),(new E.Vector3).copy(t));var i=new E.Line(n,r);return i.position.y=.01,i.userData.type="line",this.getCore().scene.add(i),this.core.needUpdate=!0,i}},{key:"createRTCLine",value:function(e,t){var n=new E.Geometry,r=new E.LineBasicMaterial({color:65280});n.vertices.push(new E.Vector3(0,0,0),new E.Vector3(t.x-e.x,t.y-e.y,t.z-e.z));var i=new E.Line(n,r);i.userData.type="line";var a=new E.Object3D;return a.add(i),a.position.copy(e),this.getCore().scene.add(a),this.core.needUpdate=!0,a}},{key:"createCylinderByTwoPoints",value:function(e,t){var n=(new E.Vector3).subVectors(t,e),r=new E.Matrix4;r.lookAt(e,t,(new E.Object3D).up),r.multiply((new E.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1));var i=new E.CylinderGeometry(.1,.1,1.1*n.length(),100,100),a=new E.MeshLambertMaterial({color:3342438,side:E.DoubleSide,transparent:!0,opacity:.5}),o=new E.Mesh(i,a);return o.renderOrder=20,o.applyMatrix4(r),o.position.x=(t.x+e.x)/2,o.position.y=(t.y+e.y)/2,o.position.z=(t.z+e.z)/2,this.getCore().scene.add(o),this.core.needUpdate=!0,o}},{key:"removeEdit",value:function(){var e=this.core.dispose;this.editLine&&(e(this.editLine),this.editLine=null);for(var t=0;t<this.editPoints.length;t++)this.editPoints[t].geometry.dispose(),this.editPoints[t].material.dispose(),this.editPoints[t].parent.remove(this.editPoints[t]);this.editPoints=[],this.core.needUpdate=!0}},{key:"removeEditPoint",value:function(e){this.editPoints.splice(this.editPoints.indexOf(e),1),e.geometry.dispose(),e.material.dispose(),e.parent.remove(e),this.core.needUpdate=!0}},{key:"cloneEditPoint",value:function(e){var t=new E.MeshBasicMaterial({color:16711680,transparent:!0,opacity:1}),n=new E.BoxGeometry(.1,.1,.1),r=new E.Mesh(n,t);return r.layers.enable(5),r.position.copy(e.position),r.userData.type="editPoint",this.getCore().scene.add(r),this.editPoints.splice(this.editPoints.indexOf(e)+1,0,r),this.core.needUpdate=!0,r}},{key:"createBox",value:function(e){var t=new E.MeshBasicMaterial({color:16711680,transparent:!0,opacity:1}),n=new E.BoxGeometry(.1,.1,.1),r=new E.Mesh(n,t);return r.layers.enable(5),r.position.set(e.x,e.y,e.z),r.userData.type="editPoint",this.getCore().scene.add(r),this.editPoints.push(r),this.core.needUpdate=!0,r}},{key:"createCurveLine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"centripetal",t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.core,r=n.scene,i=n.dispose;if(this.editLine&&(i(this.editLine),this.editLine=null),!(this.editPoints.length<2)){var a=new E.CatmullRomCurve3(this.editPoints.map((function(e){return e.position})));a.curveType=e,a.closed=t,"catmullrom"==e&&(a.tension=0);var o=a.getPoints(50),s=(new E.BufferGeometry).setFromPoints(o),l=new E.LineBasicMaterial({color:16711680});this.editLine=new E.Line(s,l),r.add(this.editLine),this.core.needUpdate=!0}}}])}(ke),Xe=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t)).loader=new E.TextureLoader,n.leftTexture=null,n.rightTexture=null,n.bufferGeometry=new E.BufferGeometry,n.materialMap=new Map,n.updateTextures=[],n.textureMap=new Map,n.applyGeometryBoxUV=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new E.Vector3(1,1,1),r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return"BufferGeometry"==e.type?(t=(new s.Geometry).fromBufferGeometry(e),e.dispose()):t=e,t.faceVertexUvs[0]=[],t.faces.forEach((function(e){var i=["x","y","z"].sort((function(t,n){return Math.abs(e.normal[t])-Math.abs(e.normal[n])}));if(r&&"x"===i[2]&&e.normal[i[0]]===e.normal[i[1]]){var a=i[0];i[0]=i[1],i[1]=a}if(r&&"z"===i[2]&&e.normal[i[0]]===e.normal[i[1]]){var o=i[0];i[0]=i[1],i[1]=o}if(r&&"y"===i[2]&&e.normal[i[0]]===e.normal[i[1]]){var s=i[0];i[0]=i[1],i[1]=s}var l=t.vertices[e.a].clone().multiply(n),u=t.vertices[e.b].clone().multiply(n),c=t.vertices[e.c].clone().multiply(n);t.faceVertexUvs[0].push([new E.Vector2(l[i[0]],l[i[1]]),new E.Vector2(u[i[0]],u[i[1]]),new E.Vector2(c[i[0]],c[i[1]])])})),t.uvsNeedUpdate=!0,t},n.meshIndex=0,n.faceStart=0,n.fontFace="Bold 20px Arial",n.fontColor="white",n.meshColor="red",n.meshRect=200,n.fontRect=20,a().isNil(e)||(a().isNumber(e.meshIndex)&&(n.meshIndex=e.meshIndex),a().isNumber(e.faceStart)&&(n.faceStart=e.faceStart),a().isString(e.fontFace)&&(n.fontFace=e.fontFace),a().isString(e.fontColor)&&(n.fontColor=e.fontColor),a().isString(e.meshColor)&&(n.meshColor=e.meshColor),a().isNumber(e.meshRect)&&(n.meshRect=e.meshRect),a().isNumber(e.fontRect)&&(n.fontRect=e.fontRect)),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"addText",value:function(e,t){var n=e.children[this.meshIndex];n.geometry=this._computeUvs(n.geometry),this.getCore().render;var r=document.createElement("canvas"),i=r.getContext("2d");r.width=r.height=256,i.font=this.fontFace,i.rect(0,0,this.meshRect,this.meshRect),i.fillStyle=this.meshColor,i.fill(),i.fillStyle=this.fontColor,i.fillText(t,this.fontRect,this.fontRect);var a=new E.MeshBasicMaterial({map:new E.Texture(r)});a.map.needsUpdate=!0,n.material=a,this.core.needUpdate=!0}},{key:"addFirstRepetitiveTexture",value:function(e,t){this.leftTexture=this.loader.load(e),this.leftTexture.wrapS=E.RepeatWrapping,this.leftTexture.wrapT=E.RepeatWrapping,this.rightTexture=this.loader.load(t),this.rightTexture.wrapS=E.RepeatWrapping,this.rightTexture.wrapT=E.RepeatWrapping}},{key:"addRepetitiveTextureFromFirstAdd",value:function(e,t,n){var r=null;(r="Object3D"===e.type?e.children[this.meshIndex]:e).geometry=this._computeUvs(r.geometry),r.material&&"MeshBasicMaterial"==r.material.type||(r.material.dispose(),r.material=new E.MeshBasicMaterial),this.leftTexture&&this.rightTexture&&(r.material.map&&r.material.map.dispose(),"left"==n?(this.leftTexture.repeat.x=t,r.material.map=this.leftTexture,r.material.needsUpdate=!0):"right"==n&&(this.rightTexture.repeat.x=t,r.material.map=this.rightTexture,r.material.needsUpdate=!0)),this.core.needUpdate=!0}},{key:"addRepetitiveTexture",value:function(e,t,n,r){var i=this,a=e.children[this.meshIndex];return a.geometry=this._computeUvs(a.geometry),this.loader.load(t,(function(e){e.wrapS=E.RepeatWrapping,e.wrapT=E.RepeatWrapping,e.repeat.x=r,a.material=new E.MeshBasicMaterial({map:e,needsUpdate:!0}),i.core.needUpdate=!0})).offset.x}},{key:"addRepetitiveTextureOnMesh",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,i=2*Math.PI;null!=r&&(i=r),e.geometry=this._computeUvs(e.geometry);var a=this.loader.load(t);return a.wrapS=E.RepeatWrapping,a.wrapT=E.RepeatWrapping,a.repeat.x=n,a.rotation=i,e.material=new E.MeshBasicMaterial({map:a}),e.material.needsUpdate=!0,a}},{key:"addImg",value:function(e,t){var n=this,r=e.children[this.meshIndex];r.geometry=this._computeUvs(r.geometry),this.getCore().render,this.loader.load(t,(function(e){r.material=new E.MeshBasicMaterial({map:e,needsUpdate:!0}),n.core.needUpdate=!0}),void 0,(function(e){}))}},{key:"addImgForMesh",value:function(e,t,n){var r,i=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=e;"BufferGeometry"==o.geometry.type?(r=(new s.Geometry).fromBufferGeometry(o.geometry),o.geometry.dispose()):r=o.geometry,o.geometry=r,o.geometry.computeFaceNormals(),o.geometry.computeFlatVertexNormals(),this.getCore().render,this.loader.load(t,(function(e){e.wrapS=E.RepeatWrapping,e.wrapT=E.RepeatWrapping,e.repeat.set(n,n),e.rotation=a,o.material=new E.MeshStandardMaterial({color:16378556}),i.core.needUpdate=!0}),void 0,(function(e){}))}},{key:"getUvAndNormal",value:function(e){for(var t=e.attributes.position.array,n=[],r=[],i=0,a=t.length/3;i<a;i+=3){var o=3*i,s=3*(i+1),l=3*(i+2),u=new E.Vector3(t[o],t[o+1],t[o+2]),c=new E.Vector3(t[s],t[s+1],t[s+2]),h=new E.Vector3(t[l],t[l+1],t[l+2]),d=new E.Vector3(c.x-u.x,c.y-u.y,c.z-u.z),p=new E.Vector3(h.x-c.x,h.y-c.y,h.z-c.z),f=new E.Vector3;f.crossVectors(d,p),f.normalize(),n.push(f.x,f.y,f.z,f.x,f.y,f.z,f.x,f.y,f.z),Math.abs(f.x)>Math.abs(f.y)&&Math.abs(f.x)>Math.abs(f.z)?r.push(u.z,u.y,c.z,c.y,h.z,h.y):Math.abs(f.y)>Math.abs(f.x)&&Math.abs(f.y)>Math.abs(f.z)?r.push(u.x,u.z,c.x,c.z,h.x,h.z):r.push(u.x,u.y,c.x,c.y,h.x,h.y)}e.setAttribute("normal",new E.Float32BufferAttribute(n,3))}},{key:"addEmissiveMapForMesh",value:function(e,t,n){var r=this,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=e;this.materialMap.get(o.uuid)||this.materialMap.set(o.uuid,{mesh:o,material:o.material}),i&&(o.geometry=this.applyGeometryBoxUV(o.geometry)),this.getCore().render,this.loader.load(t,(function(e){e.wrapS=E.RepeatWrapping,e.wrapT=E.RepeatWrapping,e.repeat.set(n,n),e.rotation=a,o.material=new E.MeshStandardMaterial({side:E.DoubleSide,transparent:!0,color:16777215,emissive:16777215,map:e,needsUpdate:!0,emissiveIntensity:1,emissiveMap:e,flatShading:!0}),r.core.needUpdate=!0}),void 0,(function(e){}))}},{key:"addEmissiveBox",value:function(e,t,n,r){var i=new E.BoxBufferGeometry(n.x,n.y,n.z),a=new E.Object3D,o=this.getCore(),s=(o.render,o.scene),l=new E.MeshStandardMaterial({transparent:!0,opacity:0}),u=this.loader.load(e);u.wrapS=E.RepeatWrapping,u.wrapT=E.RepeatWrapping,u.wrapS=E.RepeatWrapping,u.wrapT=E.RepeatWrapping,u.repeat.set(1,1);var c=this.loader.load(t);c.wrapS=E.RepeatWrapping,c.wrapT=E.RepeatWrapping,c.wrapS=E.RepeatWrapping,c.wrapT=E.RepeatWrapping,c.repeat.set(1,1);var h=new E.MeshStandardMaterial({side:E.DoubleSide,transparent:!0,color:16777215,emissive:16777215,map:u,needsUpdate:!0,emissiveIntensity:1,emissiveMap:u,flatShading:!0,depthWrite:!1}),d=new E.Mesh(i,[h,h,l,l,h,h]);d.renderOrder=20,d.position.set(0,n.y/2,0),a.add(d);var p=new E.MeshStandardMaterial({side:E.DoubleSide,transparent:!0,color:16777215,emissive:16777215,map:c,needsUpdate:!0,emissiveIntensity:1,emissiveMap:c,flatShading:!0,depthWrite:!1}),f=new E.Mesh(i,[p,p,l,l,p,p]);return f.renderOrder=20,f.position.set(0,n.y/2,0),a.add(f),a.position.set(r.x,r.y,r.z),a.scale.y=0,s.add(a),this.core.needUpdate=!0,{object:a,texture:c}}},{key:"addEmissiveCylinder",value:function(e,t,n,r){var i=new E.CylinderBufferGeometry(n.radiusTop,n.radiusBottom,n.height,n.radialSegments,1,n.openEnded,n.thetaStart,n.thetaLength),a=new E.Object3D,o=this.getCore(),s=(o.render,o.scene),l=this.loader.load(e);l.wrapS=E.RepeatWrapping,l.wrapT=E.RepeatWrapping,l.wrapS=E.RepeatWrapping,l.wrapT=E.RepeatWrapping,l.repeat.set(1,1);var u=this.loader.load(t);u.wrapS=E.RepeatWrapping,u.wrapT=E.RepeatWrapping,u.wrapS=E.RepeatWrapping,u.wrapT=E.RepeatWrapping,u.repeat.set(1,1);var c=new E.MeshStandardMaterial({side:E.DoubleSide,transparent:!0,color:16777215,emissive:16777215,map:l,needsUpdate:!0,emissiveIntensity:1,emissiveMap:l,flatShading:!0,depthWrite:!1}),h=new E.Mesh(i,c);h.renderOrder=20,h.position.set(0,n.height/2,0),a.add(h);var d=new E.MeshStandardMaterial({side:E.DoubleSide,transparent:!0,color:16777215,emissive:16777215,map:u,needsUpdate:!0,emissiveIntensity:1,emissiveMap:u,flatShading:!0,depthWrite:!1}),p=new E.Mesh(i,d);return p.renderOrder=20,p.position.set(0,n.height/2,0),a.add(p),a.position.set(r.x,r.y,r.z),a.scale.y=0,s.add(a),this.core.needUpdate=!0,setInterval((function(){u.offset.y+=.05}),50),a}},{key:"addEmissiveRing",value:function(e,t){var n=this.getCore().scene,r=new E.RingBufferGeometry(t.innerRadius,t.outerRadius,t.thetaSegments),i=new E.MeshStandardMaterial({side:E.DoubleSide,transparent:!0,color:16777215,emissive:16777215,needsUpdate:!0,emissiveIntensity:1,opacity:0}),a=new E.Mesh(r,i);return a.position.set(e.x,e.y,e.z),a.rotation.x=.5*-Math.PI,a.scale.x=0,a.scale.y=0,n.add(a),this.core.needUpdate=!0,a}},{key:"restoreMaterial",value:function(){var e=this.getCore().injectInstancedMeshFromMesh;this.materialMap.forEach((function(t,n){t.mesh.material=t.material,e(t.mesh)})),this.materialMap=new Map,this.core.needUpdate=!0}},{key:"restoreMaterialByMesh",value:function(e){var t=this.getCore().injectInstancedMeshFromMesh,n=this.materialMap.get(e.uuid);n&&(n.mesh.material=n.material,t(n.mesh),this.materialMap.delete(e.uuid),this.core.needUpdate=!0)}},{key:"addVideoTextureForPlane",value:function(e,t,n,r,i,a){var o=this.getCore(),s=(o.render,o.scene,new E.VideoTexture(a)),l=new E.MeshBasicMaterial({map:s,needsUpdate:!0}),u=new E.PlaneGeometry(e,t),c=new E.Mesh(u,l);return c.position.set(i.x,i.y,i.z),c.rotation.set(n.x,n.y,n.z),c.scale.set(r.x,r.y,r.z),this.core.needUpdate=!0,c}},{key:"addLabel",value:function(e,t,n,r){var i=this,a=this.getCore().scene;(new E.FontLoader).load(e,(function(e){var o=new E.TextGeometry(t,{font:e,size:r&&r.size?r.size:.1,height:r&&r.height?r.height:.01,curveSegments:16}),s=new E.MeshBasicMaterial({color:255}),l=new E.Mesh(o,s),u=i.getCore().getObjectBox(l).getSize(new E.Vector3);l.position.set(n.x-u.x/2,n.y,n.z),a.add(l),i.core.needUpdate=!0}))}},{key:"addLabelToParent",value:function(e,t,n,r,i){var a=this;(new E.FontLoader).load(t,(function(t){var o=new E.TextGeometry(n,{font:t,size:i&&i.size?i.size:.1,height:i&&i.height?i.height:.01,curveSegments:16}),s=new E.MeshBasicMaterial({color:16711680}),l=new E.Mesh(o,s);l.renderOrder=20,l.name=n,l.layers.enable(5),l.userData.type="label";var u=a.getCore().getObjectBox(l).getSize(new E.Vector3);l.position.set(r.x-u.x/2,r.y,r.z),e.add(l),a.core.needUpdate=!0}))}},{key:"addPlane",value:function(e,t,n,r,i,a,o,s){var l=this,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:30,c=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],h=arguments.length>10?arguments[10]:void 0,d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{},p=d.resolve,f=d.reject,m=this.getCore().scene;this.loader.load(o,(function(o){var d;o.wrapS=E.RepeatWrapping,o.wrapT=E.RepeatWrapping,o.encoding=E.sRGBEncoding,o.repeat.set(s.x,s.y);var f=new E.MeshStandardMaterial({color:null!==(d=null==h?void 0:h.color)&&void 0!==d?d:16777215,metalness:h&&"metalness"in h?h.metalness:0,roughness:h&&"roughness"in h?h.roughness:1,side:E.DoubleSide,transparent:!0,map:o,needsUpdate:!0,depthWrite:c}),v=new E.PlaneGeometry(t,n),g=new E.Mesh(v,f);return g.name=e,g.position.set(a.x,a.y,a.z),g.rotation.set(r.x,r.y,r.z),g.scale.set(i.x,i.y,i.z),g.userData.type="plane",g.renderOrder=u,g.layers.enable(5),m.add(g),l.core.needUpdate=!0,p&&p(g),g}),void 0,(function(e){f&&f(e)}))}},{key:"addLabelPlane",value:function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{url:"",color:16777215,baseUrl:""},o=this.getCore().scene,l=new s.Object3D;l.name=e;var u=this.textureMap.get(a.url);u||((u=this.loader.load(a.url)).wrapS=E.RepeatWrapping,u.wrapT=E.RepeatWrapping);var c=new E.MeshBasicMaterial({side:E.DoubleSide,transparent:!0,map:u,needsUpdate:!0,color:a.color,depthWrite:!1}),h=this.textureMap.get(a.baseUrl);h||((h=this.loader.load(a.baseUrl)).wrapS=E.RepeatWrapping,h.wrapT=E.RepeatWrapping);var d=new E.MeshBasicMaterial({side:E.DoubleSide,transparent:!0,map:h,needsUpdate:!0,color:a.color,depthWrite:!1}),p=[],f=[];p[0]=-t/2,p[1]=r,p[2]=0,f[0]=0,f[1]=.05,p[3]=-t/2,p[4]=r+n,p[5]=0,f[2]=0,f[3]=.95,p[6]=t/2,p[7]=r+n,p[8]=0,f[4]=1,f[5]=.95,p[9]=t/2,p[10]=r,p[11]=0,f[6]=1,f[7]=.05,p[12]=0,p[13]=r,p[14]=-t/2,f[8]=0,f[9]=.05,p[15]=0,p[16]=r+n,p[17]=-t/2,f[10]=0,f[11]=.95,p[18]=0,p[19]=r+n,p[20]=t/2,f[12]=1,f[13]=.95,p[21]=0,p[22]=r,p[23]=t/2,f[14]=1,f[15]=.05;var m=new E.BufferGeometry;m.addAttribute("position",new E.BufferAttribute(new Float32Array(p),3)),m.addAttribute("uv",new E.BufferAttribute(new Float32Array(f),2)),m.setIndex([0,1,2,0,2,3,4,5,6,4,6,7]);var v=new E.Mesh(m,c);v.name=e+"_1",v.renderOrder=30,v.layers.enable(5),l.add(v);var g=[],y=[];g[0]=-t/2,g[1]=r+n,g[2]=0,y[0]=0,y[1]=.05,g[3]=-t/2,g[4]=2*r+n,g[5]=0,y[2]=0,y[3]=.95,g[6]=t/2,g[7]=2*r+n,g[8]=0,y[4]=1,y[5]=.95,g[9]=t/2,g[10]=r+n,g[11]=0,y[6]=1,y[7]=.05,g[12]=0,g[13]=r+n,g[14]=-t/2,y[8]=0,y[9]=.05,g[15]=0,g[16]=2*r+n,g[17]=-t/2,y[10]=0,y[11]=.95,g[18]=0,g[19]=2*r+n,g[20]=t/2,y[12]=1,y[13]=.95,g[21]=0,g[22]=r+n,g[23]=t/2,y[14]=1,y[15]=.05,g[24]=-t/2,g[25]=0,g[26]=0,y[16]=0,y[17]=.95,g[27]=-t/2,g[28]=r,g[29]=0,y[18]=0,y[19]=.05,g[30]=t/2,g[31]=r,g[32]=0,y[20]=1,y[21]=.05,g[33]=t/2,g[34]=0,g[35]=0,y[22]=1,y[23]=.95,g[36]=0,g[37]=0,g[38]=-t/2,y[24]=0,y[25]=.95,g[39]=0,g[40]=r,g[41]=-t/2,y[26]=0,y[27]=.05,g[42]=0,g[43]=r,g[44]=t/2,y[28]=1,y[29]=.05,g[45]=0,g[46]=0,g[47]=t/2,y[30]=1,y[31]=.95;var x=new E.BufferGeometry;x.addAttribute("position",new E.BufferAttribute(new Float32Array(g),3)),x.addAttribute("uv",new E.BufferAttribute(new Float32Array(y),2)),x.setIndex([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15]);var b=new E.Mesh(x,d);return b.name=e+"_2",b.renderOrder=30,b.layers.enable(5),l.add(b),l.position.set(i.x,i.y,i.z),l.userData.type="labelPlane",o.add(l),this.core.needUpdate=!0,v}},{key:"removePlane",value:function(e){var t=this,n=this.getCore(),r=n.scene,i=n.dispose;r.children.forEach((function(n){"Mesh"==n.type&&"plane"==n.userData.type&&n.name==e&&(t.updateTextures.splice(t.updateTextures.indexOf(n.material.map)),i(n))})),this.core.needUpdate=!0}},{key:"removeLabelPlane",value:function(e){var t=this.getCore(),n=t.scene,r=t.dispose;n.children.forEach((function(t){"Object3D"==t.type&&"labelPlane"==t.userData.type&&t.name==e&&r(t)})),this.core.needUpdate=!0}},{key:"setLabelPlaneVisible",value:function(e,t){this.getCore().scene.children.forEach((function(n){"Object3D"==n.type&&"labelPlane"==n.userData.type&&n.name==e&&(n.visible=t)})),this.core.needUpdate=!0}},{key:"setLabelPlaneColor",value:function(e,t){this.getCore().scene.children.forEach((function(n){"Object3D"==n.type&&"labelPlane"==n.userData.type&&n.name==e&&n.children.forEach((function(e){e.material.color.setHex(t)}))})),this.core.needUpdate=!0}},{key:"clearPlane",value:function(){var e=this,t=this.getCore(),n=t.scene,r=t.dispose,i=[];n.children.forEach((function(e){"Mesh"==e.type&&"plane"==e.userData.type&&i.push(e)})),i.forEach((function(t){e.updateTextures.splice(e.updateTextures.indexOf(t.material.map)),r(t)})),i=null,this.core.needUpdate=!0}},{key:"clearLabelPlane",value:function(){var e=this.getCore(),t=e.scene,n=e.dispose,r=[];t.children.forEach((function(e){"Object3D"==e.type&&"labelPlane"==e.userData.type&&r.push(e)})),r.forEach((function(e){n(e)})),r=null,this.core.needUpdate=!0}},{key:"addCanvasForPlane",value:function(e,t){var n=this.getCore().scene,r=new E.Texture(e);r.needsUpdate=!0;var i=new E.PlaneGeometry(t&&t.width?t.width:.5*e.width,t&&t.height?t.height:.5*e.height),a=new E.MeshBasicMaterial({side:E.DoubleSide,transparent:!0,map:r}),o=new E.Mesh(i,a);t&&t.position&&o.position.set(t.position.x,t.position.y,t.position.z),t&&t.rotation&&o.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),t&&t.scale&&o.scale.set(t.scale.x,t.scale.y,t.scale.z),o.renderOrder=40,o.userData.type="canvasPlane",o.layers.enable(5),n.add(o),this.updateTextures.push(r),this.core.needUpdate=!0}},{key:"addLabelCanvasPlane",value:function(e,t,n){var r=this.getCore().scene,i=new E.Texture(t);i.needsUpdate=!0;var a=new E.PlaneGeometry(n&&n.width?n.width:.5*t.width,n&&n.height?n.height:.5*t.height),o=new E.MeshBasicMaterial({side:E.DoubleSide,transparent:!0,map:i}),s=new E.Mesh(a,o);s.name=e,n&&n.position&&s.position.set(n.position.x,n.position.y,n.position.z),n&&n.rotation&&s.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z),n&&n.scale&&s.scale.set(n.scale.x,n.scale.y,n.scale.z),s.renderOrder=40,s.userData.type="labelCanvasPlane",s.layers.enable(5),r.add(s),this.updateTextures.push(i),this.core.needUpdate=!0}},{key:"removeCanvasPlane",value:function(e){var t=this,n=this.getCore(),r=n.scene,i=n.dispose;r.children.forEach((function(n){"Mesh"==n.type&&"canvasPlane"==n.userData.type&&n.name==e&&(t.updateTextures.splice(t.updateTextures.indexOf(n.material.map)),i(n))})),this.core.needUpdate=!0}},{key:"removeCanvasPlanes",value:function(){var e=this,t=this.getCore(),n=t.scene,r=t.dispose;n.children.forEach((function(t){"Mesh"==t.type&&"canvasPlane"==t.userData.type&&(e.updateTextures.splice(e.updateTextures.indexOf(t.material.map)),r(t))})),this.core.needUpdate=!0}},{key:"removeLabelCanvasPlane",value:function(e){var t=this,n=this.getCore(),r=n.scene,i=n.dispose;r.children.forEach((function(n){"Mesh"==n.type&&"labelCanvasPlane"==n.userData.type&&n.name==e&&(t.updateTextures.splice(t.updateTextures.indexOf(n.material.map)),i(n))})),this.core.needUpdate=!0}},{key:"clearLabelCanvasPlanes",value:function(){var e=this,t=this.getCore(),n=t.scene,r=t.dispose,i=[];n.children.forEach((function(e){"Mesh"==e.type&&"labelCanvasPlane"==e.userData.type&&i.push(e)})),i.forEach((function(t){e.updateTextures.splice(e.updateTextures.indexOf(t.material.map)),r(t)})),i=null,this.core.needUpdate=!0}},{key:"addCanvasForMesh",value:function(e,t,n){var r,i=e;i.geometry=this._computeUvs(i.geometry);var a=new E.CanvasTexture(t);i.material=new E.MeshBasicMaterial({map:a,transparent:null!==(r=null==n?void 0:n.transparent)&&void 0!==r&&r,needsUpdate:!0}),this.updateTextures.push(a),this.core.needUpdate=!0}},{key:"addTextToTexture",value:function(e,t,n){if(e.material.map){var r=e.material.map.image;e.material.map.format;var i=document.createElement("canvas");i.width=r.width,i.height=r.height;var a=i.getContext("2d");e.userData.imgData?a.putImageData(e.userData.imgData,0,0):(a.drawImage(r,0,0),e.userData.imgData=a.getImageData(0,0,r.width,r.height)),a.font=n&&n.font?n.font+"px Arial":"40px Arial",a.textBaseline="middle",a.textAlign="center";var o=i.height/2-5,s=i.width/2;a.fillStyle=n&&n.color?n.color:"#ffffff",a.fillText(t,n&&"left"in n?n.left:s,n&&"top"in n?n.top:o),e.userData.cloneMaterial||(e.material=e.material.clone(),e.material.map=e.material.map.clone(),e.userData.cloneMaterial=!0);var l=new Image;l.src=i.toDataURL("image/format",1),e.material.map.image=l,e.material.map.needsUpdate=!0,this.core.needUpdate=!0}}},{key:"_computeUvs",value:function(e){var t;"BufferGeometry"==e.type?(t=(new s.Geometry).fromBufferGeometry(e),e.dispose()):t=e,t.computeBoundingBox();var n=t.faces;return t.faceVertexUvs[0]=[],this._computeFaceVertices(t,this.faceStart,n.length),this._computeFaceVertices(t,0,this.faceStart),t.uvsNeedUpdate=!0,t}},{key:"_computeFaceVertices",value:function(e,t,n){for(var r=e.boundingBox.max,i=e.boundingBox.min,a=new E.Vector2(0-i.x,0-i.y),o=new E.Vector2(r.x-i.x,r.y-i.y),s=e.faces,l=t;l<n;l++){var u=e.vertices[s[l].a],c=e.vertices[s[l].b],h=e.vertices[s[l].c];e.faceVertexUvs[0].push([new E.Vector2((u.x+a.x)/o.x,(u.y+a.y)/o.y),new E.Vector2((c.x+a.x)/o.x,(c.y+a.y)/o.y),new E.Vector2((h.x+a.x)/o.x,(h.y+a.y)/o.y)])}}},{key:"removeAllArrow",value:function(){var e=this.getCore(),t=e.scene;if(e.render,0!==t.children.length){for(var n=t.children.length-1;n>=0;n--)"Arrow"===t.children[n].userData.type&&t.children[n].parent.remove(t.children[n]);this.core.needUpdate=!0}}},{key:"addArrow",value:function(e,t){var n=new E.MeshBasicMaterial({transparent:!0,side:E.DoubleSide});("left"===t.direction?this.leftTexture:this.rightTexture).repeat.set(t.repeatX?t.repeatX:1,t.repeatY?t.repeatY:1),n.map="left"===t.direction?this.leftTexture:this.rightTexture,n.needsUpdate=!0;for(var r=0;r<e.length;r++){var i=e[r][0].x,a=e[r][0].z,o=e[r][1].x,s=e[r][1].z,l=Math.PI/2+Math.atan(Math.abs(s-a)/Math.abs(o-i)),u=Math.sqrt((s-a)*(s-a)+(o-i)*(o-i)),c=new E.PlaneGeometry(t.planWidth?t.planWidth:.4,u),h=new E.Mesh(c,n);s-a<0&&o-i>0&&(h.position.x=i+Math.abs(o-i)/2,h.position.z=a-Math.abs(s-a)/2,h.rotation.set(Math.PI/2,0,-l)),s-a>0&&o-i<0&&(h.position.x=i-Math.abs(o-i)/2,h.position.z=a+Math.abs(s-a)/2,h.rotation.set(Math.PI/2,0,-l)),s-a<0&&o-i<0&&(h.position.x=o+Math.abs(o-i)/2,h.position.z=s+Math.abs(s-a)/2,h.rotation.set(Math.PI/2,0,l)),s-a==0&&o-i<0&&(h.position.x=i-Math.abs(o-i)/2,h.position.z=a+Math.abs(s-a)/2,h.rotation.set(Math.PI/2,0,l)),s-a<0&&o-i==0&&(h.position.x=i+Math.abs(o-i)/2,h.position.z=a-Math.abs(s-a)/2,h.rotation.set(Math.PI/2,0,l)),s-a>=0&&o-i>=0&&(h.position.x=i+Math.abs(o-i)/2,h.position.z=a+Math.abs(s-a)/2,h.rotation.set(Math.PI/2,0,l)),h.position.y=t.height?t.height:.1,h.userData.type="Arrow",this.getCore().scene.add(h),this.core.needUpdate=!0}}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001;this.rightTexture&&(this.rightTexture.offset.y-=e),this.leftTexture&&(this.leftTexture.offset.y+=e)}},{key:"updateTexture",value:function(){this.updateTextures.forEach((function(e){e.needsUpdate=!0}))}},{key:"addFlagAnimation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"y",n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e.material.map){var r=0;e.userData.intervals||(e.userData.intervals=[]),e.userData.intervals.push(setInterval((function(){32==r&&(r=0);var t=.25*Math.floor(r/8),n=r%8*.125;e.material.map.offset.set(n,t),r++}),50)),n&&this.addAutomaticOrientation(e,t)}}},{key:"addAutomaticOrientation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"y",n=this.getCore(),r=(n.cameraControls,n.camera);e.userData.intervals||(e.userData.intervals=[]),e.userData.intervals.push(setInterval((function(){var n=new E.Vector3(0,0,0);n.applyMatrix4(r.matrixWorld);var i=new E.Vector3(0,0,-1);i.applyMatrix4(r.matrixWorld),"y"==t?e.rotation.y=Math.atan2(n.x-i.x,n.z-i.z):"x"==t?e.rotation.x=Math.atan2(n.x-i.x,n.z-i.z):"z"==t&&(e.rotation.z=Math.atan2(n.x-i.x,n.z-i.z))}),5))}}])}(ke),Ye=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t)).spriteMap=new Map,n.labelSpriteMap=new Map,n.pictureSpriteMap=new Map,n.templateSignageMap=new Map,n.signageMap=new Map,n.progressBarMap=new Map,n.blockBarMap=new Map,n.activeClick=!0,n.click=null,n.setClipTool=function(e){n.clipTool=e},n.emptyPictureSprite=function(){if(!a().isNull(n.pictureSpriteMap)){var e=n.getCore().scene;n.spriteMap.forEach((function(t,n){n.material.dispose(),n.material=null,n.geometry.dispose(),n.material=null,e.remove(n)})),n.pictureSpriteMap=new Map,n.core.needUpdate=!0}},n.restore=function(){if(!a().isNull(n.spriteMap)){var e=n.getCore().scene;n.spriteMap.forEach((function(t,n){e.remove(n)})),n.spriteMap=new Map,n.core.needUpdate=!0}},n.restoreSilently=function(){if(!a().isNull(n.spriteMap)){var e=n.getCore().scene;n.spriteMap.forEach((function(t,n){e.remove(n)})),n.core.needUpdate=!0,n.spriteMap=new Map}},n.fontSize=28,n.fontFace="Arial",n.borderThickness=4,n.borderColor="rgba(49,146,220,1.0)",n.bgColor="rgba(255,255,255,0.0)",n.textColor="#ffffff",n.scale=[1,1,1],a().isNil(e)||(a().isString(e.fontFace)&&(n.fontFace=e.fontFace),a().isNumber(e.borderThickness)&&(n.borderThickness=e.borderThickness),a().isString(e.borderColor)&&(n.borderColor=e.borderColor),a().isString(e.bgColor)&&(n.bgColor=e.bgColor),a().isString(e.textColor)&&(n.textColor=e.textColor),a().isArray(e.scale)&&(n.scale=e.scale)),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"addSignage",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1,1],r=[],i=0;i<e.length;i++){var a=this.addPictureSprite(e[i],t,i.toString(),n);r.push(a)}return r}},{key:"addPictureSprite",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.getCore().scene,a=(new E.TextureLoader).load(t),o=new E.SpriteMaterial({map:a}),s=new E.Sprite(o);return s.position.set(e.x,e.y,e.z),s.name=n,s.scale.x=r[0],s.scale.y=r[1],s.scale.z=r[2],this.pictureSpriteMap.set(s,s.name),i.add(s),this.core.needUpdate=!0,s.name}},{key:"addText",value:function(e,t,n,r){if(!this.signageMap.get(e)){var i=this.getCore().scene,a=this.createCanvas(t,r),o=this.makeSprite(a,n);o.name=e,i.add(o),this.signageMap.set(e,o),this.core.needUpdate=!0}}},{key:"addTextPlane",value:function(e,t,n){if(!this.signageMap.get(e)){var r=this.getCore().scene,i=this.createCanvas(t,n),a=new E.Texture(i);a.needsUpdate=!0;var o=new E.MeshBasicMaterial({side:E.DoubleSide,depthWrite:!1,map:a,transparent:!0}),s=new E.PlaneGeometry(n.planeWidth,n.planeHeight),l=new E.Mesh(s,o);return l.name=e,l.position.set(n.position.x,n.position.y,n.position.z),l.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z),l.renderOrder=30,l.layers.enable(5),r.add(l),this.signageMap.set(e,l),this.core.needUpdate=!0,l}}},{key:"drawBg",value:function(e,t){e.beginPath(),e.lineWidth=10,e.strokeStyle=t,e.lineTo(0,5),e.lineTo(100,5),e.stroke(),e.closePath()}},{key:"roundRect",value:function(e,t,n,r,i,a){e.beginPath(),e.moveTo(t+a,n),e.arcTo(t+r,n,t+r,n+i,a),e.arcTo(t+r,n+i,t,n+i,a),e.arcTo(t,n+i,t,n,a),e.arcTo(t,n,t+r,n,a),e.closePath()}},{key:"drawProgress",value:function(e,t,n,r,i){var a=e.getContext("2d");a.clearRect(0,0,e.width,e.height),this.roundRect(a,0,0,e.width,e.height,i),a.clip(),a.fillStyle=n,this.roundRect(a,0,0,e.width,e.height,i),a.fill(),a.fillStyle=r,this.roundRect(a,e.width*(t-1),0,e.width,e.height,i),a.fill()}},{key:"updateProgressBar",value:function(e,t){var n=this.progressBarMap.get(e);n&&(this.drawProgress(n.material.map.image,(null==t?void 0:t.progress)?t.progress:0,(null==t?void 0:t.baseColor)?t.baseColor:"#cccccc",(null==t?void 0:t.progressColor)?t.progressColor:"#00ff00",(null==t?void 0:t.cornerRadius)?t.cornerRadius:10),n.material.map.needsUpdate=!0,this.core.needUpdate=!0)}},{key:"addProgressBar",value:function(e,t){var n;if(!this.progressBarMap.get(e)){var r=this.getCore().scene,i=document.createElement("canvas");i.width=20*t.planeWidth/t.planeHeight,i.height=20;var a=(null==t?void 0:t.progress)?t.progress:0;this.drawProgress(i,a,(null==t?void 0:t.baseColor)?t.baseColor:"#cccccc",(null==t?void 0:t.progressColor)?t.progressColor:"#00ff00",(null==t?void 0:t.cornerRadius)?t.cornerRadius:10);var o=new E.Texture(i);o.needsUpdate=!0;var s=new E.MeshBasicMaterial({side:E.DoubleSide,depthWrite:!1,map:o,transparent:!0,opacity:null!==(n=null==t?void 0:t.opacity)&&void 0!==n?n:1}),l=new E.PlaneGeometry(t.planeWidth,t.planeHeight),u=new E.Mesh(l,s);u.name=e,u.position.set(t.position.x,t.position.y,t.position.z),u.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),u.renderOrder=30,u.layers.enable(5),r.add(u),this.progressBarMap.set(e,u),this.core.needUpdate=!0}}},{key:"add3DProgressBar",value:function(e,t){var n,r,i,a;if(!this.progressBarMap.get(e)){var o=this.getCore().scene,s=new E.Object3D,l=new E.Object3D,u=new E.MeshStandardMaterial({color:null!==(n=null==t?void 0:t.baseColor)&&void 0!==n?n:7829626,roughness:.5,metalness:0,transparent:!0,opacity:.9,depthWrite:!1}),c=null!==(r=null==t?void 0:t.width)&&void 0!==r?r:.6,h=null!==(i=null==t?void 0:t.height)&&void 0!==i?i:.02,d=new E.SphereGeometry(h/2,50,50,0,2*Math.PI,0,.5*Math.PI),p=new E.Mesh(d,u);p.position.set(0,c,0);var f=new E.SphereGeometry(h/2,50,50,0,2*Math.PI,Math.PI,.5*Math.PI),m=new E.Mesh(f,u);m.position.set(0,0,0);var v=new E.CylinderGeometry(h/2,h/2,c,30,10);v.translate(0,c/2,0);var g=new E.Mesh(v,u);l.add(p),l.add(m),l.add(g),l.position.set(0,-c/2,0);var y=new E.Object3D,x=new E.MeshStandardMaterial({color:null!==(a=null==t?void 0:t.progressColor)&&void 0!==a?a:16724736,roughness:.5,metalness:0,transparent:!0,opacity:.9,depthWrite:!1}),b=new E.SphereGeometry(h/2,50,50,0,2*Math.PI,0,.5*Math.PI),M=new E.Mesh(b,x);M.position.set(0,c,0),M.renderOrder=1;var w=new E.SphereGeometry(h/2,50,50,0,2*Math.PI,Math.PI,.5*Math.PI),_=new E.Mesh(w,x);_.position.set(0,0,0),_.renderOrder=1;var A=new E.CylinderGeometry(h/2,h/2,c,30,10);A.translate(0,c/2,0);var C=new E.Mesh(A,x);C.renderOrder=1,y.add(M),y.add(_),y.add(C),y.position.set(0,-c/2,0);var T=(null==t?void 0:t.progress)?t.progress:0;return 0==T&&(y.visible=!1),T<1&&(y.children[0].visible=!1),y.children[2].scale.y=T,s.add(l),s.add(y),s.position.set(t.position.x,t.position.y,t.position.z),s.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),s.name=e,o.add(s),this.progressBarMap.set(e,s),this.core.needUpdate=!0,s}}},{key:"addBlockBars",value:function(e,t,n){var r,i,a,o,s,l,u,c,h,d,p,f,m,v,g,y,x;if(!this.blockBarMap.get(e)){var b=this.getCore().scene,M=new E.Object3D;M.name=e;var w=new E.MeshStandardMaterial({color:16777215,roughness:.7,metalness:.3,transparent:!0}),_=["#include <lights_fragment_begin2>"].join("\n"),A=null!==(r=null==n?void 0:n.width)&&void 0!==r?r:.1,C=null!==(i=null==n?void 0:n.number)&&void 0!==i?i:10,T=null!==(a=null==n?void 0:n.categorySpacing)&&void 0!==a?a:.005,S=null!==(o=null==n?void 0:n.valueSpacing)&&void 0!==o?o:.005,L=null!==(s=null==n?void 0:n.categoryAxis)&&void 0!==s?s:"y",P=null!==(l=null==n?void 0:n.valueAxis)&&void 0!==l?l:"x",B={x:0,y:0,z:0};switch(L){case"x":B.x=1;break;case"-x":B.x=-1;break;case"y":B.y=1;break;case"-y":B.y=-1;break;case"z":B.z=1;break;case"-z":B.z=-1}var D={x:0,y:0,z:0};switch(P){case"x":D.x=1;break;case"-x":D.x=-1;break;case"y":D.y=1;break;case"-y":D.y=-1;break;case"z":D.z=1;break;case"-z":D.z=-1}for(var k=new E.BoxGeometry(1,1,1),R=(new E.BufferGeometry).fromGeometry(k),O=0,I=0;I<t.length;I++)O+=t[I].series.length*C;var F=new E.InstancedMesh(R,w,O);F.userData.matrix=[];var N=["attribute float customOpacity;","varying float vcustomOpacity;","#include <common>"].join("\n"),z=["#include <begin_vertex>","vcustomOpacity = 1.0;","if (customOpacity>=0.0) {","vcustomOpacity = customOpacity;","};"].join("\n"),U=["varying float vcustomOpacity;","#include <common>"].join("\n"),H=["vec4 diffuseColor = vec4( diffuse, opacity*vcustomOpacity );"].join("\n");w.onBeforeCompile=function(e){e.vertexShader=e.vertexShader.replace("#include <common>",N).replace("#include <begin_vertex>",z),e.fragmentShader=e.fragmentShader.replace("#include <common>",U).replace("#include <lights_fragment_begin>",_).replace("vec4 diffuseColor = vec4( diffuse, opacity );",H)},M.labelIds=[];var j=0,G=document.createElement("canvas"),V=G.getContext("2d");M.userData.idMap={};var W=[];for(I=0;I<t.length;I++){var X=t[I].series.length;M.userData.idMap[t[I].id]={boxIds:[],labelIds:[]};for(var Y=0;Y<X;Y++){var J=new E.Matrix4,Q=new E.Vector3(t[I].position.x,t[I].position.y,t[I].position.z),q=new E.Euler(0,0,0);J.compose(Q,(new E.Quaternion).setFromEuler(q),new E.Vector3(1,1,1));var K=(new E.Matrix4).makeTranslation(B.x*(A+T)*Y,B.y*(A+T)*Y,B.z*(A+T)*Y);J.multiply(K);for(var Z=new E.Vector3,$=new E.Vector3,ee=0;ee<C;ee++){var te=t[I].series[Y].colors[ee];K=(new E.Matrix4).makeTranslation(D.x*(A+S)*ee,D.y*(A+S)*ee,D.z*(A+S)*ee);var ne=(new E.Matrix4).makeScale(A,A,A),re=J.clone().multiply(K).multiply(ne);if(F.userData.matrix.push(re),"visible"in t[I]&&!t[I].visible?F.setMatrixAt(j,(new E.Matrix4).makeScale(1e-7,1e-7,1e-7)):F.setMatrixAt(j,re),M.userData.idMap[t[I].id].boxIds.push(j),F.setColorAt(j,new E.Color(te)),t[I].series[Y].opacities&&t[I].series[Y].opacities.length==C?W.push(t[I].series[Y].opacities[ee]):W.push(1),t[I].series[Y].label){var ie=t[I].series[Y].label.text,ae=null!==(c=null===(u=t[I].series[Y].label)||void 0===u?void 0:u.fontSize)&&void 0!==c?c:20;V.font="Bold "+ae+"px "+this.fontFace;var oe=(null!==(d=null===(h=t[I].series[Y].label)||void 0===h?void 0:h.textHeight)&&void 0!==d?d:.05)*V.measureText(ie).width/(ae+10),se=null!==(f=null===(p=t[I].series[Y].label)||void 0===p?void 0:p.distance)&&void 0!==f?f:0;if(0==ee){var le=(new E.Matrix4).makeTranslation(D.x*(A+S)*ee-D.x*(A/2+oe/2+se),D.y*(A+S)*ee-D.y*(A/2+oe/2+se),D.z*(A+S)*ee-D.z*(A/2+oe/2+se));Z.applyMatrix4(J.clone().multiply(le).multiply(ne))}ee==C-1&&(le=(new E.Matrix4).makeTranslation(D.x*(A+S)*ee+D.x*(A/2+oe/2+se),D.y*(A+S)*ee+D.y*(A/2+oe/2+se),D.z*(A+S)*ee+D.z*(A/2+oe/2+se)),$.applyMatrix4(J.clone().multiply(le).multiply(ne)))}j++}if(t[I].series[Y].label){var ue=t[I].series[Y].label.text,ce=null!==(v=null===(m=t[I].series[Y].label)||void 0===m?void 0:m.fontSize)&&void 0!==v?v:20,he=null!==(y=null===(g=t[I].series[Y].label)||void 0===g?void 0:g.textHeight)&&void 0!==y?y:.05;if(ue&&""!=ue){var de=e+"-"+t[I].id+"-"+Y;M.labelIds.push(de),M.userData.idMap[t[I].id].labelIds.push(de),this.addTextPlane2(de,ue,{position:"top"==t[I].series[Y].label.position?$:Z,rotation:null!==(x=t[I].series[Y].label.rotation)&&void 0!==x?x:{x:0,y:0,z:0},planeHeight:he,fontColor:"fontColor"in t[I].series[Y].label?t[I].series[Y].label.fontColor:"#ffffff",fontSize:ce,height:ce+10,offsetX:0,offsetY:0,visible:!("visible"in t[I])||t[I].visible})}}}}F.geometry.setAttribute("customOpacity",new E.InstancedBufferAttribute(new Float32Array(W),1)),V=null,G=null,M.add(F),b.add(M),this.blockBarMap.set(e,M),this.core.needUpdate=!0}}},{key:"updateBlockBars",value:function(e,t){var n,r,i=this.blockBarMap.get(e);if(i){for(var a=i.children[0],o=t.length,s=0;s<o;s++)for(var l=0,u=0,c=t[s].series.length,h=0;h<c;h++){for(var d=t[s].series[h].colors.length,p=0;p<d;p++){var f=t[s].series[h].colors[p],m=i.userData.idMap[t[s].id].boxIds[l];"visible"in t[s]&&(t[s].visible?a.setMatrixAt(m,a.userData.matrix[m]):a.setMatrixAt(m,(new E.Matrix4).makeScale(1e-7,1e-7,1e-7))),a.setColorAt(m,new E.Color(f)),t[s].series[h].opacities&&t[s].series[h].opacities.length==d&&a.geometry.attributes.customOpacity.setX(m,t[s].series[h].opacities[p]),l++}if(t[s].series[h].label){var v=t[s].series[h].label.text,g=null!==(r=null===(n=t[s].series[h].label)||void 0===n?void 0:n.fontSize)&&void 0!==r?r:20;if(v&&""!=v){var y=i.userData.idMap[t[s].id].labelIds[u];this.updateTextPlane2(y,v,{fontColor:"fontColor"in t[s].series[h].label?t[s].series[h].label.fontColor:"#ffffff",fontSize:g,height:g+10,offsetX:0,offsetY:0,visible:!("visible"in t[s])||t[s].visible}),u++}}}a.instanceMatrix.needsUpdate=!0,a.instanceColor.needsUpdate=!0,a.geometry.attributes.customOpacity.needsUpdate=!0,this.core.needUpdate=!0}}},{key:"updateBlockBars2",value:function(e,t){var n=this,r=this.blockBarMap.get(e);if(r){var i=r.children[0];t.forEach((function(e){"visible"in e&&r.userData.idMap[e.id]&&(r.userData.idMap[e.id].boxIds.forEach((function(t){e.visible?i.setMatrixAt(t,i.userData.matrix[t]):i.setMatrixAt(t,(new E.Matrix4).makeScale(1e-7,1e-7,1e-7))})),r.userData.idMap[e.id].labelIds.forEach((function(t){var r=n.signageMap.get(t);r&&(r.visible=e.visible)})))})),i.instanceMatrix.needsUpdate=!0,this.core.needUpdate=!0}}},{key:"removeBlockBars",value:function(e){var t=this,n=this.getCore().dispose;if(e){var r=this.blockBarMap.get(e);r&&(r.labelIds.forEach((function(e){t.removeSignageByName(e)})),n(r),this.blockBarMap.delete(e))}else this.blockBarMap.forEach((function(e){e.labelIds.forEach((function(e){t.removeSignageByName(e)})),n(e)})),this.blockBarMap=new Map;this.core.needUpdate=!0}},{key:"add3DProgressBars",value:function(e,t,n){var r,i,a,o,s,l;if(!this.progressBarMap.get(e)){var u=this.getCore().scene,c=new E.Object3D;c.name=e;var h=null!==(r=null==n?void 0:n.width)&&void 0!==r?r:.6,d=null!==(i=null==n?void 0:n.height)&&void 0!==i?i:.02,p=new E.MeshStandardMaterial({color:16777215,roughness:.5,metalness:0,transparent:!0}),f=new E.CylinderGeometry(d/2,d/2,h,30,10,!0);f.translate(0,h/2,0);var m=new E.InstancedMesh(f,p,t.length),v=new E.SphereGeometry(d/2,50,50,0,2*Math.PI,0,.5*Math.PI),g=new E.InstancedMesh(v,p,t.length),y=new E.InstancedMesh(v,p,t.length),x=new E.CylinderGeometry(d/2,d/2,h,30,10,!0);x.translate(0,-h/2,0);var b=new E.InstancedMesh(x,p,t.length);c.instanceIds=[],c.width=h,c.height=d;for(var M=0;M<t.length;M++){c.instanceIds[M]=t[M].id;var w=null!==(o=null===(a=t[M])||void 0===a?void 0:a.baseColor)&&void 0!==o?o:7829626,_=null!==(l=null===(s=t[M])||void 0===s?void 0:s.progressColor)&&void 0!==l?l:16724736,A=new E.Matrix4,C=new E.Vector3(0,-h/2,0),T=new E.Euler;A.compose(C,(new E.Quaternion).setFromEuler(T),new E.Vector3(0==t[M].progress?0:1,t[M].progress,0==t[M].progress?0:1));var S=new E.Matrix4,L=new E.Vector3(t[M].position.x,t[M].position.y,t[M].position.z),P=new E.Euler(t[M].rotation.x,t[M].rotation.y,t[M].rotation.z);S.compose(L,(new E.Quaternion).setFromEuler(P),new E.Vector3(1,1,1)),m.setMatrixAt(M,S.clone().multiply(A)),m.setColorAt(M,new E.Color(_));var B=new E.Matrix4,D=(new E.Matrix4).makeTranslation(0,h,0);B.compose(C,(new E.Quaternion).setFromEuler(T),new E.Vector3(1,1,1)),t[M].progress<1?g.setColorAt(M,new E.Color(w)):g.setColorAt(M,new E.Color(_)),g.setMatrixAt(M,S.clone().multiply(B).multiply(D));var k=(new E.Matrix4).makeRotationX(Math.PI);0==t[M].progress?y.setColorAt(M,new E.Color(w)):y.setColorAt(M,new E.Color(_)),y.setMatrixAt(M,S.clone().multiply(B).multiply(k));var R=new E.Matrix4;R.compose(new E.Vector3(0,h/2,0),(new E.Quaternion).setFromEuler(T),new E.Vector3(1==t[M].progress?0:1,1-t[M].progress,1==t[M].progress?0:1)),b.setMatrixAt(M,S.clone().multiply(R)),b.setColorAt(M,new E.Color(w))}c.add(m),c.add(g),c.add(y),c.add(b),u.add(c),this.progressBarMap.set(e,c),this.core.needUpdate=!0}}},{key:"update3DProgressBars",value:function(e,t){var n,r,i,a;if(this.progressBarMap.get(e)){var o=this.progressBarMap.get(e),s=o.width;o.height;for(var l=o.children[0],u=o.children[1],c=o.children[2],h=o.children[3],d=0;d<t.length;d++){var p=o.instanceIds.indexOf(t[d].id);if(-1!=p){var f=null!==(r=null===(n=t[d])||void 0===n?void 0:n.baseColor)&&void 0!==r?r:7829626,m=null!==(a=null===(i=t[d])||void 0===i?void 0:i.progressColor)&&void 0!==a?a:16724736,v=new E.Matrix4,g=new E.Vector3(0,-s/2,0),y=new E.Euler;v.compose(g,(new E.Quaternion).setFromEuler(y),new E.Vector3(0==t[d].progress?0:1,t[d].progress,0==t[d].progress?0:1));var x=new E.Matrix4,b=new E.Vector3(t[d].position.x,t[d].position.y,t[d].position.z),M=new E.Euler(t[d].rotation.x,t[d].rotation.y,t[d].rotation.z);x.compose(b,(new E.Quaternion).setFromEuler(M),new E.Vector3(1,1,1)),l.setMatrixAt(p,x.clone().multiply(v)),l.setColorAt(p,new E.Color(m));var w=new E.Matrix4,_=(new E.Matrix4).makeTranslation(0,s,0);w.compose(g,(new E.Quaternion).setFromEuler(y),new E.Vector3(1,1,1)),t[d].progress<1?u.setColorAt(p,new E.Color(f)):u.setColorAt(p,new E.Color(m)),u.setMatrixAt(p,x.clone().multiply(w).multiply(_));var A=(new E.Matrix4).makeRotationX(Math.PI);0==t[d].progress?c.setColorAt(p,new E.Color(f)):c.setColorAt(p,new E.Color(m)),c.setMatrixAt(p,x.clone().multiply(w).multiply(A));var C=new E.Matrix4;C.compose(new E.Vector3(0,s/2,0),(new E.Quaternion).setFromEuler(y),new E.Vector3(1==t[d].progress?0:1,1-t[d].progress,1==t[d].progress?0:1)),h.setMatrixAt(p,x.clone().multiply(C)),h.setColorAt(p,new E.Color(f))}}l.instanceMatrix.needsUpdate=!0,l.instanceColor.needsUpdate=!0,u.instanceMatrix.needsUpdate=!0,u.instanceColor.needsUpdate=!0,c.instanceMatrix.needsUpdate=!0,c.instanceColor.needsUpdate=!0,h.instanceMatrix.needsUpdate=!0,h.instanceColor.needsUpdate=!0,this.core.needUpdate=!0}}},{key:"update3DProgressBar",value:function(e,t){var n,r,i=this.progressBarMap.get(e);if(i){i.children[0].children[0].material.color.setHex(null!==(n=null==t?void 0:t.baseColor)&&void 0!==n?n:7829626);var a=i.children[1];a.children[0].material.color.setHex(null!==(r=null==t?void 0:t.baseColor)&&void 0!==r?r:16724736);var o=(null==t?void 0:t.progress)?t.progress:0;a.scale.y=o,a.visible=0!=o,this.core.needUpdate=!0}}},{key:"removeProgressBar",value:function(e){var t=this.getCore().dispose;if(e){var n=this.progressBarMap.get(e);n&&(t(n),this.progressBarMap.delete(e))}else this.progressBarMap.forEach((function(e){t(e)})),this.progressBarMap=new Map;this.core.needUpdate=!0}},{key:"addCanvas",value:function(e,t,n){var r=this.getCore().scene,i=this.makeSprite(e,t);return i.scale.x=20,i.scale.y=20,i.scale.z=20,r.add(i),this.spriteMap.set(i,{canvas:e,pos:t}),this.click=n,this.core.needUpdate=!0,i}},{key:"makeSprite",value:function(e,t){var n=new E.Texture(e);n.needsUpdate=!0;var r=new E.SpriteMaterial({depthWrite:!1,map:n}),i=new E.Sprite(r);return i.renderOrder=30,i.position.set(t[0],t[1],t[2]),i.scale.set(e.width/e.height,1,1),i}},{key:"createCanvas",value:function(e,t){var n,r=document.createElement("canvas"),i=r.getContext("2d"),a=(null==t?void 0:t.fontSize)?t.fontSize:this.fontSize;i.font="Bold "+a+"px "+this.fontFace;var o=(null==t?void 0:t.width)?t.width:150,s=(null==t?void 0:t.height)?t.height:50;return r.width=o,r.height=s,i.fillStyle=null!==(n=null==t?void 0:t.fontColor)&&void 0!==n?n:"#ffffff",i.font="Bold "+a+"px "+this.fontFace,i.fillText(e,(null==t?void 0:t.offsetX)?t.offsetX:0,a+((null==t?void 0:t.offsetY)?t.offsetY:0)),r}},{key:"addTextPlane2",value:function(e,t,n){if(!this.signageMap.get(e)){var r=this.getCore().scene,i=this.createCanvas2(t,n),a=new E.Texture(i);a.needsUpdate=!0;var o=new E.MeshBasicMaterial({side:E.DoubleSide,depthWrite:!1,map:a,transparent:!0}),s=new E.PlaneGeometry(n.planeHeight*i.width/i.height,n.planeHeight),l=new E.Mesh(s,o);return l.name=e,l.position.set(n.position.x,n.position.y,n.position.z),l.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z),l.renderOrder=30,l.layers.enable(5),"visible"in n&&(l.visible=n.visible),r.add(l),this.signageMap.set(e,l),this.core.needUpdate=!0,l}}},{key:"updateTextPlane2",value:function(e,t,n){var r=this.signageMap.get(e);if(r){var i=this.createCanvas2(t,n),a=new E.Texture(i);return r.material.map=a,r.material.map.needsUpdate=!0,"visible"in n&&(r.visible=n.visible),this.core.needUpdate=!0,r}}},{key:"createCanvas2",value:function(e,t){var n,r=document.createElement("canvas"),i=r.getContext("2d"),a=(null==t?void 0:t.fontSize)?t.fontSize:this.fontSize;i.font="Bold "+a+"px "+this.fontFace;var o=i.measureText(e).width,s=(null==t?void 0:t.height)?t.height:50;return r.width=o,r.height=s,i.fillStyle=null!==(n=null==t?void 0:t.fontColor)&&void 0!==n?n:"#ffffff",i.font="Bold "+a+"px "+this.fontFace,i.fillText(e,(null==t?void 0:t.offsetX)?t.offsetX:0,a+((null==t?void 0:t.offsetY)?t.offsetY:0)),r}},{key:"addTemplateSignage",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.addTemplateSignage2({name:e,url:t,sizeAttenuation:n,alwaysOnTop:r})}},{key:"addTemplateSignage2",value:function(e){var t,n=this,r=e.name,i=e.url,a=e.sizeAttenuation,o=void 0===a||a,s=e.alwaysOnTop,l=void 0!==s&&s;if(!this.templateSignageMap.get(r)){var u=(new E.TextureLoader).load(i,(function(){n.core.needUpdate=!0})),c=new E.SpriteMaterial({map:u,depthWrite:!l,depthTest:!l,sizeAttenuation:o,clippingPlanes:null===(t=this.clipTool)||void 0===t?void 0:t.getCurrentClipPlanes()}),h=new E.Sprite(c);h.name=r,h.userData.type="label",h.userData.name=r,this.templateSignageMap.set(r,h)}}},{key:"addTemplateSignageByCoord",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4?arguments[4]:void 0;return this.addTemplateSignageByCoord2({name:e,templateSignageName:t,coord:n,scale:r,labelType:i})}},{key:"addTemplateSignageByCoord2",value:function(e){var t=e.name,n=e.templateSignageName,r=e.coord,i=e.scale,o=void 0===i?[1,1,1]:i,s=e.labelType,l=e.touchEnable,u=e.shouldCloneMaterial,c=e.renderOrder,h=void 0===c?30:c,d=e.center,p=this.getCore().scene;if(!this.signageMap.get(t)&&!(a().isNil(r)||a().isNil(n)||a().isNil(t)||a().isNil(this.templateSignageMap.get(n)))){var f=this.templateSignageMap.get(n).clone();return f.name=t,f.position.set(r.x,r.y,r.z),f.name=t,f.layers.enable(5),f.renderOrder=h,f.scale.x=o[0],f.scale.y=o[1],f.scale.z=o[2],d&&(f.center=new E.Vector2(d.x,d.y)),s&&(f.userData.labelType=s),u&&(f.material=f.material.clone()),this.signageMap.set(t,f),p.add(f),this.core.needUpdate=!0,l&&this.core.addTouchEnableList(f),f}}},{key:"addSprteByCanvas",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1,1],a=arguments.length>5?arguments[5]:void 0,o=this.getCore().scene;if(this.signageMap.get(e)){var s=this.signageMap.get(e),l=new E.Texture(t);l.needsUpdate=!0;var u=new E.SpriteMaterial({map:l,depthWrite:!1,sizeAttenuation:n});return s.material=u,s.position.set(r.x,r.y,r.z),s.scale.x=i[0],s.scale.y=i[1],s.scale.z=i[2],a&&(s.userData.labelType=a),void(this.core.needUpdate=!0)}var c=new E.Texture(t);c.needsUpdate=!0;var h=new E.SpriteMaterial({map:c,depthWrite:!1,sizeAttenuation:n}),d=new E.Sprite(h);return d.userData.type="label",d.name=e,d.position.set(r.x,r.y,r.z),d.name=e,d.layers.enable(5),d.renderOrder=30,d.scale.x=i[0],d.scale.y=i[1],d.scale.z=i[2],a&&(d.userData.labelType=a),this.signageMap.set(e,d),o.add(d),this.core.needUpdate=!0,d}},{key:"addTemplateSignageByCoordToObject",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1,1];if(!(a().isNil(r)||a().isNil(n)||a().isNil(e)||a().isNil(this.templateSignageMap.get(n)))){var o=this.templateSignageMap.get(n).clone();return o.name=e,o.position.set(r.x,r.y,r.z),o.name=e,o.layers.enable(5),o.scale.x=i[0],o.scale.y=i[1],o.scale.z=i[2],this.signageMap.set(e,o),t.add(o),this.core.needUpdate=!0,o}}},{key:"removeSignageByName",value:function(e){var t=this.getCore();if(!a().isNil(e)&&!a().isNil(this.signageMap.get(e))){var n=this.signageMap.get(e);t.removeTouchEnableList(n),t.dispose(n),this.signageMap.delete(e),this.core.needUpdate=!0}}},{key:"replaceSignage",value:function(e,t){var n=this.signageMap.get(e),r=n.position,i=[n.scale.x,n.scale.y,n.scale.z];this.removeSignageByName(e),this.addTemplateSignageByCoord(e,t,r,i,null)}},{key:"removeAllSignage",value:function(){var e=this;this.signageMap.forEach((function(t,n){e.removeSignageByName(n)}))}},{key:"removeByType",value:function(e){var t=this;this.signageMap.forEach((function(n,r){n.userData.labelType==e&&t.removeSignageByName(r)}))}},{key:"addSpriteLabel",value:function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=this.getCore().scene,s=this.createLabelCanvas(t,r,i),l=this.makeLabelSprite(s);l.name=e,l.scale.set(a[0],a[1],a[2]),l.position.set(n.x,n.y,n.z),o.add(l),this.labelSpriteMap.set(e,l),this.core.needUpdate=!0}},{key:"makeLabelSprite",value:function(e){var t=new E.Texture(e);t.needsUpdate=!0;var n=new E.SpriteMaterial({map:t});return new E.Sprite(n)}},{key:"createLabelCanvas",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:18,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#999",a=document.createElement("canvas"),o=a.getContext("2d"),s=this.getPixelRatio(o);return a.style.width=t+"px",a.style.height=n+"px",a.width=a.width*s,a.height=a.height*s,o.scale(s,s),o.font=r+"px Georgia",o.fillStyle=i,o.fillText(e,10,10),a}},{key:"getPixelRatio",value:function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t}}])}(ke),Je=function(){function e(){(0,v.default)(this,e),this._listeners={}}return(0,g.default)(e,[{key:"addEventListener",value:function(e,t){var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:"hasEventListener",value:function(e,t){var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},{key:"dispatchEvent",value:function(e){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e)}}}])}(),Qe=function(e){function t(e,n,r){var i;return(0,v.default)(this,t),(i=T(this,t)).activate=function(){i._domElement.addEventListener("mousemove",i.onDocumentMouseMove,!1),i._domElement.addEventListener("mousedown",i.onDocumentMouseDown,!1),i._domElement.addEventListener("mouseup",i.onDocumentMouseCancel,!1),i._domElement.addEventListener("mouseleave",i.onDocumentMouseCancel,!1),i._domElement.addEventListener("touchmove",i.onDocumentTouchMove,!1),i._domElement.addEventListener("touchstart",i.onDocumentTouchStart,!1),i._domElement.addEventListener("touchend",i.onDocumentTouchEnd,!1)},i.deactivate=function(){i._domElement.removeEventListener("mousemove",i.onDocumentMouseMove,!1),i._domElement.removeEventListener("mousedown",i.onDocumentMouseDown,!1),i._domElement.removeEventListener("mouseup",i.onDocumentMouseCancel,!1),i._domElement.removeEventListener("mouseleave",i.onDocumentMouseCancel,!1),i._domElement.removeEventListener("touchmove",i.onDocumentTouchMove,!1),i._domElement.removeEventListener("touchstart",i.onDocumentTouchStart,!1),i._domElement.removeEventListener("touchend",i.onDocumentTouchEnd,!1)},i.dispose=function(){i.deactivate()},i.onDocumentMouseMove=function(e){e.preventDefault();var t=i._domElement.getBoundingClientRect();if(i._mouse.x=(e.clientX-t.left)/t.width*2-1,i._mouse.y=-(e.clientY-t.top)/t.height*2+1,i._raycaster.setFromCamera(i._mouse,i._camera),i._selected&&i.enabled)return i._raycaster.ray.intersectPlane(i._plane,i._intersection)&&i._selected.position.copy(i._intersection.sub(i._offset).applyMatrix4(i._inverseMatrix)),void i.dispatchEvent({type:"drag",object:i._selected});i._raycaster.setFromCamera(i._mouse,i._camera);var n=i._raycaster.intersectObjects(i._objects);if(n.length>0){var r=n[0].object;i._plane.setFromNormalAndCoplanarPoint(i._camera.getWorldDirection(i._plane.normal),i._worldPosition.setFromMatrixPosition(r.matrixWorld)),i._hovered!==r&&(i.dispatchEvent({type:"hoveron",object:r}),i._domElement.style.cursor="pointer",i._hovered=r)}else null!==i._hovered&&(i.dispatchEvent({type:"hoveroff",object:i._hovered}),i._domElement.style.cursor="auto",i._hovered=null)},i.onDocumentMouseDown=function(e){e.preventDefault(),i._raycaster.setFromCamera(i._mouse,i._camera);var t=i._raycaster.intersectObjects(i._objects);t.length>0&&(i._selected=t[0].object.parent,i._raycaster.ray.intersectPlane(i._plane,i._intersection)&&i._selected.parent&&(i._inverseMatrix.getInverse(i._selected.parent.matrixWorld),i._offset.copy(i._intersection).sub(i._worldPosition.setFromMatrixPosition(i._selected.matrixWorld))),i._domElement.style.cursor="move",i.dispatchEvent({type:"dragstart",object:i._selected}))},i.onDocumentMouseCancel=function(e){e.preventDefault(),i._selected&&(i.dispatchEvent({type:"dragend",object:i._selected}),i._selected=null),i._domElement.style.cursor=i._hovered?"pointer":"auto"},i.onDocumentTouchMove=function(e){e.preventDefault();var t=e.changedTouches[0],n=i._domElement.getBoundingClientRect();if(i._mouse.x=(t.clientX-n.left)/n.width*2-1,i._mouse.y=-(t.clientY-n.top)/n.height*2+1,i._raycaster.setFromCamera(i._mouse,i._camera),i._selected&&i.enabled)return i._raycaster.ray.intersectPlane(i._plane,i._intersection)&&i._selected.position.copy(i._intersection.sub(i._offset).applyMatrix4(i._inverseMatrix)),void i.dispatchEvent({type:"drag",object:i._selected})},i.onDocumentTouchStart=function(e){e.preventDefault();var t=e.changedTouches[0],n=i._domElement.getBoundingClientRect();i._mouse.x=(t.clientX-n.left)/n.width*2-1,i._mouse.y=-(t.clientY-n.top)/n.height*2+1,i._raycaster.setFromCamera(i._mouse,i._camera);var r=i._raycaster.intersectObjects(i._objects);r.length>0&&(i._selected=r[0].object,i._plane.setFromNormalAndCoplanarPoint(i._camera.getWorldDirection(i._plane.normal),i._worldPosition.setFromMatrixPosition(i._selected.matrixWorld)),i._raycaster.ray.intersectPlane(i._plane,i._intersection)&&i._selected.parent&&(i._inverseMatrix.getInverse(i._selected.parent.matrixWorld),i._offset.copy(i._intersection).sub(i._worldPosition.setFromMatrixPosition(i._selected.matrixWorld))),i._domElement.style.cursor="move",i.dispatchEvent({type:"dragstart",object:i._selected}))},i.onDocumentTouchEnd=function(e){e.preventDefault(),i._selected&&(i.dispatchEvent({type:"dragend",object:i._selected}),i._selected=null),i._domElement.style.cursor="auto"},i._objects=e,i._camera=n,i._domElement=r,i._plane=new E.Plane,i._raycaster=new E.Raycaster,i._mouse=new E.Vector2,i._offset=new E.Vector3,i._intersection=new E.Vector3,i._worldPosition=new E.Vector3,i._inverseMatrix=new E.Matrix4,i._selected=null,i._hovered=null,i.enabled=!0,i}return(0,m.default)(t,e),(0,g.default)(t)}(Je),qe=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).startDrag=function(){var t=new Array,n=e.getCore(),r=n.scene,i=n.camera,a=n.renderer;r.traverse((function(e){t.push(e)})),e._dragControls=new Qe(t,i,a.domElement),e._dragControls.addEventListener("dragstart",e._dragstart),e._dragControls.addEventListener("drag",e._drag),e._dragControls.addEventListener("dragend",e._dragend),e._dragControls.activate()},e.stopDrag=function(){e._dragControls&&(e._dragControls.removeEventListener("dragstart",e._dragstart),e._dragControls.removeEventListener("drag",e._drag),e._dragControls.removeEventListener("dragend",e._dragend),e._dragControls.dispose(),e._dragControls=void 0)},e._dragstart=function(t){var n=e.getCore(),r=n.cameraControls;n.render,r.enabled=!1,e.core.needUpdate=!0},e._drag=function(t){e.getCore().render,e.core.needUpdate=!0},e._dragend=function(t){var n=e.getCore(),r=n.cameraControls;n.render,r.enabled=!0,e.core.needUpdate=!0},e._dragControls=void 0,e}return(0,m.default)(t,e),(0,g.default)(t)}(ke),Ke=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).linePoint=[],e.click=function(){},e.activeClick=!0,e.action=function(t){if(e.activeClick){var n=t.intersection;if(n){e.linePoint.push(n.point);var r=e.getLastLine();if(2===r.length){var i=e.createLine(r);e.click(i)}}}},e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"measureReset",value:function(){this.removeLine(),this.linePoint=[]}},{key:"getDistance",value:function(){var e=this.getDistanceLine();return i.map(e,"userData")}},{key:"getLastLine",value:function(){var e=i.chunk(this.linePoint,2),t=i.last(e);return i.isUndefined(t)?[]:t}},{key:"createLine",value:function(e){var t;if(2===e.length){var n=this.getCore(),r=new E.Geometry;(t=r.vertices).push.apply(t,(0,l.default)(e));var i=new E.LineBasicMaterial({color:65280,linewidth:10}),a=new E.LineSegments(r,i),o={uuid:a.uuid,distance:e[0].distanceTo(e[1]).toFixed(2)};return a.name="distanceLine",a.userData=o,n.scene.add(a),this.core.needUpdate=!0,o}}},{key:"getDistanceLine",value:function(){var e=this.getCore();return i.filter(e.scene.children,{name:"distanceLine"})}},{key:"removeLine",value:function(){var e=this.getCore(),t=this.getDistanceLine();i.forEach(t,(function(t){e.traverseNodes(t,(function(e){e.geometry.dispose()})),e.scene.remove(t)})),this.core.needUpdate=!0}}])}(ke),Ze=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((r=r.apply(e,t||[])).next())}))},$e=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t)).moveToPosition=function(e){n.getCore().cameraControls.setPosition(e.x,e.y,e.z,!0)},n.moveToPositions=function(e,t,r,i){var o=n.getCore(),s=o.cameraControls;(0,o.setAnimateMoves)(e.map((function(e,n,o){return function(){s.setLookAt(e.x,e.y,e.z,t[n].x,t[n].y,t[n].z,!0),a().isNil(i)||a().isNil(r)||i[n](r[n].x,r[n].y,r[n].z,r[n].meterId,r[n].bimId)}})))},n.curPosition=function(){var e=n.getCore().cameraControls,t=new E.Vector3;return e.getPosition(t),t},n.curTarget=function(){var e=n.getCore().cameraControls,t=new E.Vector3;return e.getTarget(t),t},n.lookAt=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0;n.getCore().cameraControls.setLookAt(e.x,e.y,e.z,t.x,t.y,t.z,r).then((function(){i&&i()}))},n.fitToObject=function(e){a().isNil(e)||n.fitToObjects([e])},n.fitToObjects=function(e){e=a().filter(e,(function(e){return!a().isNil(e)}));var t=n.getCore(),r=t.cameraControls,i=t.bbox;r.fitTo(i(e),!0,n.fitOption)},n.restore=function(){var e=n.getCore(),t=e.cameraControls,r=e.scene;t.fitTo(r,!0)},n.focusingToObjectById=function(e){var t=n.core.getNodeById(e);n.focusingToObject(t)},n.focusingToObject=function(e,t,r,i){var o;if(a().isNil(e)){if(a().isNil(n.getCore().selectedModel))return;o=n.getCore().selectedModel}else if(e.constructor==String)o=n.core.getNodeById(e);else if(e.constructor==E.Group)o=e;else if(e.constructor==E.Object3D)o=e;else{if(e.constructor!=E.Mesh)return;o=e}void 0===t&&(t=!1);var s=new E.Box3;s.setFromObject(o);var l,u=s.getBoundingSphere(new E.Sphere),c=u.center,h=u.radius,d=n.curPosition(),p=n.curTarget(),f=new E.Vector3(d.x-p.x,d.y-p.y,d.z-p.z),m=Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z),v=new E.Vector3(f.x/m,f.y/m,f.z/m);if(t){var g=n.getPixelDistance(h,r);l=new E.Vector3(g*v.x+c.x,g*v.y+c.y,g*v.z+c.z)}else l=new E.Vector3(1.5*h*v.x+c.x,1.5*h*v.y+c.y,1.5*h*v.z+c.z);n.getCore().cameraControls.lerpLookAt(d.x,d.y,d.z,p.x,p.y,p.z,l.x,l.y,l.z,c.x,c.y,c.z,1,!0).then((function(){i&&i()}))},n.focusingToObjectByRotation=function(e,t,r,i,o,s){var l;if(a().isNil(e)){if(a().isNil(n.getCore().selectedModel))return;l=n.getCore().selectedModel}else if(e.constructor==String)l=n.core.getNodeById(e);else if(e.constructor==E.Group)l=e;else if(e.constructor==E.Object3D)l=e;else{if(e.constructor!=E.Mesh)return;l=e}var u=new E.Box3;u.setFromObject(l);var c=u.getBoundingSphere(new E.Sphere),h={x:l.userData.centroid[0],y:c.center.y,z:l.userData.centroid[1]},d=c.radius,p=n.curPosition(),f=n.curTarget(),m=n.getPixelDistance(d,o);h.x=m*Math.cos(r)*Math.sin(i)/3+h.x,h.z=h.z-m*Math.cos(r)*Math.cos(i)/3;var v=new E.Vector3(m*Math.cos(r)*Math.sin(i)+h.x,m*Math.sin(r)+h.y,h.z-m*Math.cos(r)*Math.cos(i));n.getCore().cameraControls.lerpLookAt(p.x,p.y,p.z,f.x,f.y,f.z,v.x,v.y,v.z,h.x,h.y,h.z,1,!0).then((function(){s&&s()}))},n.getObjectDefaultViewByRotation=function(e,t,r,i){var o;if(a().isNil(e)){if(a().isNil(n.getCore().selectedModel))return;o=n.getCore().selectedModel}else if(e.constructor==String)o=n.core.getNodeById(e);else if(e.constructor==E.Group||e.constructor==E.Scene)o=e;else if(e.constructor==E.Object3D)o=e;else{if(e.constructor!=E.Mesh)return;o=e}var s=new E.Box3;s.setFromObject(o);var l=s.getBoundingSphere(new E.Sphere),u=l.center,c=l.radius,h=n.getPixelDistance(c,i);u.x=h*Math.cos(t)*Math.sin(r)/6+u.x,u.z=u.z-h*Math.cos(t)*Math.cos(r)/6;var d=new E.Vector3(h*Math.cos(t)*Math.sin(r)+u.x,h*Math.sin(t)+u.y,u.z-h*Math.cos(t)*Math.cos(r));return{position:{x:d.x,y:d.y,z:d.z},target:{x:u.x,y:u.y,z:u.z}}},n.focusingToObjects=function(e,t,r,i){var a=n.core.bbox(e);if(0!=a.getSize().length()){var o,s=a.getBoundingSphere(new E.Sphere),l=s.center,u=s.radius,c=n.curPosition(),h=n.curTarget(),d=new E.Vector3(c.x-h.x,c.y-h.y,c.z-h.z),p=Math.sqrt(d.x*d.x+d.y*d.y+d.z*d.z),f=new E.Vector3(d.x/p,d.y/p,d.z/p);if(t){var m=n.getPixelDistance(u,r);m<.1&&(m=.1),o=new E.Vector3(m*f.x+l.x,m*f.y+l.y,m*f.z+l.z)}else o=new E.Vector3(1.5*u*f.x+l.x,1.5*u*f.y+l.y,1.5*u*f.z+l.z);n.getCore().cameraControls.lerpLookAt(c.x,c.y,c.z,h.x,h.y,h.z,o.x,o.y,o.z,l.x,l.y,l.z,1,!0).then((function(){i&&i()})).catch((function(e){}))}},n.focusingToObjectsByParams=function(e,t,r){var i=n.core.bbox(e);if(0!=i.getSize().length()){var a,o=i.getBoundingSphere(new E.Sphere),s=o.center,l=o.radius,u=n.curPosition(),c=n.curTarget();t&&t.distance?a=t.distance:t&&t.percentage&&(a=n.getPixelDistance(l,t.percentage))<.1&&(a=.1);var h=n.getCore().cameraControls,d=h.azimuthAngle,p=h.polarAngle;t&&"heading"in t&&(d=t.heading*Math.PI/180),t&&"pitch"in t&&(p=t.pitch*Math.PI/180);var f=new E.Vector3(a*Math.sin(p)*Math.sin(d)+s.x,a*Math.cos(p)+s.y,a*Math.sin(p)*Math.cos(d)+s.z);h.lerpLookAt(u.x,u.y,u.z,c.x,c.y,c.z,f.x,f.y,f.z,s.x,s.y,s.z,1,!0).then((function(){r&&r()})).catch((function(e){}))}},n.getPixelDistance=function(e,t,r){(void 0===t||t<=0)&&(t=.5),void 0===r&&(r=0);var i=n.getCore().getCamera().fov,a=Math.PI/180*i;return e/Math.tan(a/2)/t},n.fitOption={paddingLeft:0,paddingBottom:0,paddingRight:0,paddingTop:0},a().isNil(e)||a().isObject(e.fitOption)&&(n.fitOption=e.fitOption),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"focusingToSelectedObject",value:function(){this.focusingToObject(this.getCore().selectedModel)}},{key:"customer_focusingToObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0,z:0},r=new E.Box3;r.setFromObject(e);var i=r.getBoundingSphere(new E.Sphere).center;e.rotation.y>0&&(t.z*=-1,t.x*=-1,n.x*=-1);var a=new E.Vector3(i.x+t.x,i.y+t.y,i.z+t.z),o=new E.Vector3(i.x+n.x,i.y+n.y,i.z+n.z);this.lookAt(a,o)}},{key:"moveTo",value:function(e,t,n){this.getCore().cameraControls.setLookAt(e,t,n,this.curTarget().x+e-this.curPosition().x,this.curTarget().y+t-this.curPosition().y,this.curTarget().z+n-this.curPosition().z,!0)}},{key:"setOrbitTarget",value:function(e){var t=this.getCore(),n=t.cameraControls;t.experimentFlag.changeOrbitTarget&&n.setOrbitPoint(e.x,e.y,e.z)}},{key:"restoreOrbitTarget",value:function(){return Ze(this,void 0,void 0,o.default.mark((function e(){var t,n,r,i;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getCore(),n=t.cameraControls,t.camera,r=this.curPosition(),i=this.curTarget(),e.next=3,n.setFocalOffset(0,0,0,!1);case 3:this.lookAt(r,i,!1);case 4:case"end":return e.stop()}}),e,this)})))}}])}(ke),et={uniforms:{color:{type:"color",value:new s.Color(14740855)},fadeRangeMax:{type:"float",value:15},fadeRangeMin:{type:"float",value:.2},fadeFactor:{type:"float",value:1},power:{type:"float",value:-.4},base:{type:"float",value:-.5},minclipY:{type:"float",value:0},maxclipY:{type:"float",value:1/0}},vertexShader:[s.ShaderChunk.common,s.ShaderChunk.logdepthbuf_pars_vertex,"varying vec3 vWorldPos;","varying vec3 vNormal;","varying float vPosY;","void main() {","vNormal =  normal;","vPosY = abs(position.y);","vec4 worldPos= modelMatrix * vec4( position, 1.0 );","vWorldPos = worldPos.xyz;","gl_Position =  projectionMatrix * viewMatrix * worldPos;",s.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[s.ShaderChunk.logdepthbuf_pars_fragment,"#include <packing>","uniform vec3 color;","uniform float fadeRangeMax;","uniform float fadeRangeMin;","uniform float fadeFactor;","uniform float power;","uniform float base;","uniform float minclipY;","uniform float maxclipY;","varying vec3 vWorldPos;","varying vec3 vNormal;","varying float vPosY;","void main() {","float d = dot(normalize(cameraPosition - vWorldPos), normalize(vNormal));","float intensity = pow(d, power) + base;","float alpha = smoothstep(1.0, 0.0, intensity);","if( vPosY >= fadeRangeMax){","float factor = clamp(abs( vPosY - fadeRangeMax) * fadeFactor , 0.0, 1.0);","alpha = alpha * ( 1.0 - factor );","}","gl_FragColor = vec4( color, alpha );","if (vPosY < fadeRangeMin || vWorldPos.y < minclipY || vWorldPos.y > maxclipY){","discard;","}",s.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")};function tt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n={};for(var r in e.uniforms)if(t&&t[r])switch(n[r]=t[r],e.uniforms[r].type){case"repeat":var i=new s.Vector2(1,1);t[r].value instanceof Array?i.set(t[r].value[0],t[r].value[1]):i.set(t[r].value.x,t[r].value.y);break;case"color":var a=new s.Color(t[r].value);n[r].value=a}else n[r]=e.uniforms[r];return new s.ShaderMaterial({uniforms:n,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,transparent:!0,side:s.DoubleSide})}function nt(e,t,n){var r=/\.(png|jpg|gif|jpeg|webp)$/;for(var i in e)if(e[i].value&&"string"==typeof e[i].value&&r.test(e[i].value)){var a=e[i].value;t.has(a)?e[i].value=t.get(a):e[i].value=n.load(a,(function(e){e.wrapS=e.wrapT=s.RepeatWrapping}))}return e}var rt=function(){var e=[1,0,0,2e-5,1,0,0,503905e-9,1,0,0,.00201562,1,0,0,.00453516,1,0,0,.00806253,1,0,0,.0125978,1,0,0,.018141,1,0,0,.0246924,1,0,0,.0322525,1,0,0,.0408213,1,0,0,.0503999,1,0,0,.0609894,1,0,0,.0725906,1,0,0,.0852058,1,0,0,.0988363,1,0,0,.113484,1,0,0,.129153,1,0,0,.145839,1,0,0,.163548,1,0,0,.182266,1,0,0,.201942,1,0,0,.222314,1,0,0,.241906,1,0,0,.262314,1,0,0,.285754,1,0,0,.310159,1,0,0,.335426,1,0,0,.361341,1,0,0,.387445,1,0,0,.412784,1,0,0,.438197,1,0,0,.466966,1,0,0,.49559,1,0,0,.523448,1,0,0,.549938,1,0,0,.57979,1,0,0,.608746,1,0,0,.636185,1,0,0,.664748,1,0,0,.69313,1,0,0,.71966,1,0,0,.747662,1,0,0,.774023,1,0,0,.799775,1,0,0,.825274,1,0,0,.849156,1,0,0,.873248,1,0,0,.89532,1,0,0,.917565,1,0,0,.937863,1,0,0,.958139,1,0,0,.976563,1,0,0,.994658,1,0,0,1.0112,1,0,0,1.02712,1,0,0,1.04189,1,0,0,1.05568,1,0,0,1.06877,1,0,0,1.08058,1,0,0,1.09194,1,0,0,1.10191,1,0,0,1.11161,1,0,0,1.1199,1,0,0,1.12813,.999547,-4.48815e-7,.0224417,199902e-10,.999495,-113079e-10,.0224406,503651e-9,.999496,-452317e-10,.0224406,.00201461,.999496,-101772e-9,.0224406,.00453287,.999495,-180928e-9,.0224406,.00805845,.999497,-282702e-9,.0224406,.0125914,.999496,-407096e-9,.0224406,.0181319,.999498,-554114e-9,.0224406,.02468,.999499,-723768e-9,.0224406,.0322363,.999495,-916058e-9,.0224405,.0408009,.999499,-.00113101,.0224408,.050375,.999494,-.00136863,.0224405,.0609586,.999489,-.00162896,.0224401,.0725537,.999489,-.00191201,.0224414,.0851619,.999498,-.00221787,.0224413,.0987867,.999492,-.00254642,.0224409,.113426,.999507,-.00289779,.0224417,.129088,.999494,-.0032716,.0224386,.145767,.999546,-.0036673,.0224424,.163472,.999543,-.00408166,.0224387,.182182,.999499,-.00450056,.0224338,.201843,.999503,-.00483661,.0224203,.222198,.999546,-.00452928,.022315,.241714,.999508,-.00587403,.0224329,.262184,.999509,-.00638806,.0224271,.285609,.999501,-.00691028,.0224166,.309998,.999539,-.00741979,.0223989,.335262,.999454,-.00786282,.0223675,.361154,.999529,-.00811928,.0222828,.387224,.999503,-.00799941,.0221063,.41252,.999561,-.00952753,.0223057,.438006,.999557,-.0099134,.0222065,.466735,.999541,-.0100935,.0220402,.495332,.999562,-.00996821,.0218067,.523197,.999556,-.0105031,.0217096,.550223,.999561,-.0114191,.0217215,.579498,.999588,-.0111818,.0213357,.608416,.999633,-.0107725,.0208689,.635965,.999527,-.0121671,.0210149,.664476,.999508,-.0116005,.020431,.692786,.999568,-.0115604,.0199791,.719709,.999671,-.0121117,.0197415,.74737,.999688,-.0110769,.0188846,.773692,.99962,-.0122368,.0188452,.799534,.999823,-.0110325,.0178001,.825046,.999599,-.0114923,.0174221,.849075,.999619,-.0105923,.0164345,.872999,.999613,-.0105988,.0158227,.895371,.99964,-.00979861,.0148131,.917364,.99977,-.00967238,.0140721,.938002,.999726,-.00869175,.0129543,.957917,.99973,-.00866872,.0122329,.976557,.999773,-.00731956,.0108958,.994459,.999811,-.00756027,.0102715,1.01118,.999862,-.00583732,.00878781,1.02701,.999835,-.00631438,.00827529,1.04186,.999871,-.00450785,.00674583,1.05569,.999867,-.00486079,.00621041,1.06861,.999939,-.00322072,.00478301,1.08064,.999918,-.00318199,.00406395,1.09181,1.00003,-.00193348,.00280682,1.10207,.999928,-.00153729,.00198741,1.11152,.999933,-623666e-9,917714e-9,1.12009,1,-102387e-11,9.07581e-7,1.12813,.997866,-8.96716e-7,.0448334,199584e-10,.997987,-225945e-10,.0448389,502891e-9,.997987,-903781e-10,.0448388,.00201156,.997985,-203351e-9,.0448388,.00452602,.997986,-361514e-9,.0448388,.00804629,.997987,-56487e-8,.0448389,.0125724,.997988,-813423e-9,.0448389,.0181045,.997984,-.00110718,.0448387,.0246427,.997985,-.00144616,.0448388,.0321875,.997987,-.00183038,.044839,.0407392,.997983,-.00225987,.0448387,.0502986,.997991,-.00273467,.0448389,.0608667,.997984,-.00325481,.0448384,.0724444,.998002,-.00382043,.044839,.0850348,.997997,-.00443145,.0448396,.0986372,.998007,-.00508796,.0448397,.113255,.998008,-.00578985,.04484,.128891,.998003,-.00653683,.0448384,.145548,.997983,-.00732713,.0448358,.163221,.997985,-.00815454,.0448358,.181899,.998005,-.00898985,.0448286,.201533,.998026,-.00964404,.0447934,.221821,.998055,-.00922677,.044611,.241282,.99804,-.0117361,.0448245,.261791,.998048,-.0127628,.0448159,.285181,.998088,-.0138055,.0447996,.30954,.998058,-.0148206,.0447669,.334751,.998099,-.0156998,.044697,.36061,.998116,-.0161976,.0445122,.386603,.998195,-.015945,.0441711,.411844,.998168,-.0183947,.0444255,.43773,.998184,-.0197913,.0443809,.466009,.998251,-.0201426,.0440689,.494574,.998305,-.0198847,.0435632,.522405,.998273,-.0210577,.043414,.549967,.998254,-.0227901,.0433943,.578655,.998349,-.0223108,.0426529,.60758,.99843,-.0223088,.042,.635524,.998373,-.0241141,.0418987,.663621,.998425,-.0231446,.0408118,.691906,.998504,-.0233684,.0400565,.719339,.998443,-.0241652,.0394634,.74643,.99848,-.0228715,.0380002,.773086,.998569,-.023519,.0372322,.798988,.998619,-.0223108,.0356468,.824249,.998594,-.0223105,.034523,.848808,.998622,-.0213426,.0328887,.87227,.998669,-.0207912,.0314374,.895157,.998705,-.0198416,.0296925,.916769,.998786,-.0189168,.0279634,.937773,.998888,-.0178811,.0261597,.957431,.99906,-.0166845,.0242159,.976495,.999038,-.0155464,.0222638,.994169,.999237,-.0141349,.0201967,1.01112,.999378,-.0129324,.0181744,1.02692,.999433,-.0113192,.0159898,1.04174,.999439,-.0101244,.0140385,1.05559,.999614,-.00837456,.0117826,1.06852,.999722,-.00721769,.00983745,1.08069,.999817,-.00554067,.00769002,1.09176,.99983,-.00426961,.005782,1.10211,.999964,-.00273904,.00374503,1.11152,1.00001,-.00136739,.00187176,1.12031,.999946,393227e-10,-28919e-9,1.12804,.995847,-13435e-10,.0671785,19916e-9,.995464,-338387e-10,.0671527,501622e-9,.99547,-135355e-9,.0671531,.00200649,.995471,-30455e-8,.0671532,.00451461,.99547,-541423e-9,.0671531,.008026,.995471,-84598e-8,.0671531,.0125407,.99547,-.00121823,.0671531,.0180589,.99547,-.00165817,.0671531,.0245806,.995463,-.00216583,.0671526,.0321062,.995468,-.00274127,.0671527,.0406366,.995474,-.00338447,.0671534,.0501717,.995473,-.00409554,.0671533,.0607131,.995478,-.00487451,.0671531,.0722618,.995476,-.00572148,.0671532,.0848191,.995477,-.00663658,.0671539,.0983882,.995498,-.00761986,.0671541,.112972,.995509,-.00867094,.0671542,.128568,.995509,-.00978951,.0671531,.145183,.995503,-.0109725,.0671491,.162808,.995501,-.012211,.0671465,.181441,.99553,-.0134565,.0671371,.201015,.99555,-.014391,.0670831,.221206,.99558,-.014351,.0668883,.240813,.995577,-.0173997,.0671055,.261257,.995602,-.0191111,.0671178,.284467,.995623,-.0206705,.0670946,.308765,.995658,-.022184,.0670472,.333905,.995705,-.0234832,.0669417,.359677,.995719,-.0241933,.0666714,.385554,.995786,-.0243539,.066266,.410951,.995887,-.0271866,.0664367,.437163,.995944,-.0296012,.0664931,.464842,.996004,-.0301045,.0660105,.49332,.996128,-.0298311,.0652694,.521131,.996253,-.0316426,.0650739,.549167,.996244,-.0339043,.0649433,.57737,.996309,-.033329,.0638926,.606073,.996417,-.0338935,.0630849,.634527,.996372,-.0353104,.0625083,.66256,.996542,-.0348942,.0611986,.690516,.996568,-.0351614,.060069,.718317,.996711,-.0354317,.0588522,.74528,.996671,-.0349513,.0571902,.772061,.996865,-.0345622,.0555321,.798089,.996802,-.0342566,.0537816,.823178,.996992,-.0330862,.0516095,.847949,.996944,-.0324666,.0495537,.871431,.997146,-.0309544,.0470302,.894357,.997189,-.0299372,.0446043,.916142,.997471,-.0281389,.0418812,.937193,.997515,-.0268702,.0391823,.957,.997812,-.0247166,.0361338,.975936,.998027,-.0233525,.0333945,.99391,.998233,-.0209839,.0301917,1.01075,.998481,-.0194309,.027271,1.02669,.998859,-.0169728,.0240162,1.04173,.99894,-.0152322,.0210517,1.05551,.999132,-.0127497,.0178632,1.06856,.999369,-.0108282,.014787,1.08054,.999549,-.00845886,.0116185,1.09185,.999805,-.0063937,.00867209,1.10207,.99985,-.00414582,.00566823,1.1117,.999912,-.00207443,.00277562,1.12022,1.00001,870226e-10,-53766e-9,1.12832,.991943,-178672e-11,.0893382,198384e-10,.991952,-450183e-10,.089339,499849e-9,.991956,-180074e-9,.0893394,.0019994,.991955,-405167e-9,.0893393,.00449867,.991953,-720298e-9,.0893391,.00799764,.991955,-.00112548,.0893393,.0124964,.991957,-.0016207,.0893395,.0179951,.991958,-.00220601,.0893396,.0244939,.991947,-.00288137,.0893385,.0319929,.991962,-.00364693,.0893399,.0404933,.991965,-.00450264,.0893399,.049995,.99198,-.00544862,.0893411,.0604995,.99197,-.00648491,.0893397,.0720074,.991976,-.00761164,.089341,.0845207,.99198,-.00882891,.0893405,.0980413,.991982,-.0101367,.0893396,.112571,.992008,-.011535,.0893415,.128115,.992026,-.0130228,.0893414,.144672,.992064,-.0145966,.0893418,.162241,.992041,-.0162421,.0893359,.180801,.992086,-.0178888,.0893214,.200302,.992157,-.0190368,.0892401,.220332,.992181,-.0195584,.0890525,.240144,.992175,-.0227257,.0892153,.260728,.99221,-.0254195,.089304,.283473,.99222,-.0274883,.0892703,.307673,.992317,-.0294905,.0892027,.332729,.992374,-.0311861,.0890577,.358387,.992505,-.0320656,.0886994,.384102,.992568,-.0329715,.0883198,.409767,.992675,-.036006,.0883602,.436145,.992746,-.0392897,.0884591,.463217,.992873,-.0399337,.0878287,.491557,.992934,-.040231,.0870108,.519516,.993091,-.0422013,.0865857,.547741,.993259,-.0443503,.0861937,.575792,.993455,-.0446368,.0851187,.604233,.993497,-.0454299,.0840576,.632925,.993694,-.0463296,.0829671,.660985,.993718,-.0470619,.0817185,.688714,.993973,-.0468838,.0800294,.716743,.994207,-.046705,.0781286,.74377,.994168,-.0469698,.0763337,.77042,.9945,-.0456816,.0738184,.796659,.994356,-.0455518,.0715545,.821868,.994747,-.0439488,.0686085,.846572,.994937,-.0430056,.065869,.870435,.995142,-.0413414,.0626446,.893272,.995451,-.0396521,.05929,.915376,.995445,-.0378453,.0558503,.936196,.995967,-.0355219,.0520949,.956376,.996094,-.0335146,.048377,.975327,.996622,-.030682,.0442575,.993471,.996938,-.0285504,.0404693,1.01052,.997383,-.0253399,.0360903,1.02637,.997714,-.0231651,.0322176,1.04139,.998249,-.0198138,.0278433,1.05542,.998596,-.0174337,.0238759,1.06846,.998946,-.0141349,.0195944,1.08056,.99928,-.0115603,.0156279,1.09181,.999507,-.00839065,.0114607,1.10213,.999697,-.005666,.00763325,1.11169,.999869,-.00269902,.00364946,1.12042,1.00001,623836e-10,-319288e-10,1.12832,.987221,-222675e-11,.111332,197456e-10,.98739,-561116e-10,.111351,497563e-9,.987448,-224453e-9,.111357,.00199031,.987441,-505019e-9,.111357,.0044782,.987442,-897816e-9,.111357,.00796129,.987442,-.00140284,.111357,.0124396,.987444,-.00202012,.111357,.0179132,.987442,-.00274964,.111357,.0243824,.987446,-.00359147,.111357,.0318474,.987435,-.00454562,.111356,.0403086,.987461,-.00561225,.111358,.0497678,.987458,-.00679125,.111358,.0602239,.987443,-.0080828,.111356,.0716792,.987476,-.0094872,.111358,.0841364,.98749,-.0110044,.111361,.097597,.987508,-.0126344,.111362,.112062,.987494,-.0143767,.111357,.127533,.987526,-.0162307,.111359,.144015,.987558,-.0181912,.111361,.161502,.987602,-.0202393,.111355,.179979,.987692,-.022273,.111346,.199386,.987702,-.0235306,.111215,.219183,.987789,-.0247628,.111061,.239202,.987776,-.0280668,.111171,.259957,.987856,-.0316751,.111327,.282198,.987912,-.0342468,.111282,.306294,.988,-.0367205,.111198,.331219,.988055,-.0387766,.110994,.356708,.988241,-.0397722,.110547,.382234,.988399,-.0416076,.110198,.408227,.988539,-.0448192,.110137,.434662,.988661,-.0483793,.110143,.461442,.988967,-.0495895,.109453,.489318,.989073,-.0506797,.108628,.517516,.989274,-.0526953,.108003,.545844,.989528,-.054578,.107255,.573823,.989709,-.0561503,.106294,.601944,.989991,-.056866,.104896,.630855,.990392,-.0572914,.103336,.658925,.990374,-.0586224,.10189,.686661,.990747,-.0584764,.099783,.714548,.991041,-.0582662,.0974309,.74186,.991236,-.0584118,.0951678,.768422,.991585,-.0573055,.0921581,.794817,.991984,-.0564241,.0891167,.820336,.9921,-.0553608,.085805,.84493,.992749,-.0533816,.0820354,.868961,.99288,-.0518661,.0782181,.891931,.993511,-.0492492,.0738935,.914186,.993617,-.0471956,.0696402,.93532,.99411,-.044216,.0649659,.95543,.994595,-.0416654,.0603177,.974685,.994976,-.0384314,.0553493,.992807,.995579,-.0353491,.0503942,1.00996,.996069,-.0319787,.0452123,1.02606,.996718,-.028472,.0400112,1.04114,.997173,-.0250789,.0349456,1.05517,.997818,-.0213326,.029653,1.0683,.998318,-.0178509,.024549,1.0805,.998853,-.0141118,.0194197,1.09177,.999218,-.0105914,.0143869,1.1022,.999594,-.00693474,.00943517,1.11175,.99975,-.00340478,.00464051,1.12056,1.00001,109172e-9,-112821e-9,1.12853,.983383,-266524e-11,.133358,196534e-10,.981942,-671009e-10,.133162,494804e-9,.981946,-268405e-9,.133163,.00197923,.981944,-603912e-9,.133163,.00445326,.981941,-.00107362,.133162,.00791693,.981946,-.00167755,.133163,.0123703,.981944,-.00241569,.133162,.0178135,.981945,-.00328807,.133163,.0242466,.981945,-.00429472,.133162,.03167,.981955,-.00543573,.133164,.0400846,.981951,-.00671105,.133163,.0494901,.981968,-.00812092,.133165,.0598886,.981979,-.00966541,.133166,.0712811,.981996,-.0113446,.133168,.083669,.982014,-.0131585,.133169,.0970533,.982011,-.0151073,.133167,.111438,.982062,-.0171906,.133172,.126826,.9821,-.0194067,.133175,.143215,.982149,-.0217502,.133176,.160609,.982163,-.0241945,.133173,.178981,.982247,-.0265907,.133148,.198249,.982291,-.027916,.132974,.217795,.982396,-.0299663,.132868,.238042,.982456,-.0334544,.132934,.258901,.982499,-.0378636,.133137,.280639,.982617,-.0409274,.133085,.304604,.98274,-.0438523,.132985,.329376,.982944,-.0462288,.132728,.354697,.98308,-.0475995,.132228,.380102,.983391,-.0501901,.131924,.406256,.983514,-.0535899,.131737,.432735,.98373,-.0571858,.131567,.459359,.984056,-.0592353,.130932,.486637,.984234,-.0610488,.130092,.51509,.984748,-.0630758,.12923,.543461,.985073,-.0647398,.128174,.571376,.985195,-.0671941,.127133,.599414,.985734,-.0681345,.125576,.628134,.986241,-.0686089,.123639,.656399,.986356,-.0698511,.121834,.684258,.986894,-.0700931,.119454,.711818,.987382,-.0698321,.116718,.739511,.988109,-.0693975,.113699,.766267,.988363,-.0689584,.110454,.792456,.989112,-.0672353,.106602,.81813,.989241,-.0662034,.10267,.842889,.990333,-.0638938,.0981381,.867204,.990591,-.0618534,.0935388,.89038,.991106,-.0593117,.088553,.912576,.991919,-.0562676,.0832187,.934118,.992111,-.0534085,.0778302,.954254,.992997,-.0495459,.0720453,.973722,.993317,-.0463707,.0663458,.991949,.994133,-.0421245,.0601883,1.00936,.994705,-.0384977,.0542501,1.02559,.995495,-.0340956,.0479862,1.04083,.996206,-.030105,.041887,1.05497,.996971,-.0256095,.0355355,1.06824,.997796,-.0213932,.0293655,1.08056,.998272,-.0169612,.0232926,1.09182,.998857,-.0126756,.0172786,1.10219,.99939,-.00832486,.0113156,1.11192,.999752,-.00410826,.00557892,1.12075,1,150957e-9,-119101e-9,1.12885,.975169,-309397e-11,.154669,195073e-10,.975439,-779608e-10,.154712,491534e-9,.975464,-311847e-9,.154716,.00196617,.975464,-701656e-9,.154716,.00442387,.975462,-.0012474,.154715,.0078647,.975461,-.00194906,.154715,.0122886,.975464,-.00280667,.154715,.0176959,.975468,-.00382025,.154716,.0240867,.975471,-.00498985,.154716,.0314612,.975472,-.00631541,.154717,.0398199,.975486,-.00779719,.154718,.0491639,.975489,-.00943505,.154718,.0594932,.975509,-.0112295,.154721,.0708113,.97554,-.0131802,.154724,.0831176,.975557,-.0152876,.154726,.096415,.975585,-.0175512,.154728,.110705,.975605,-.0199713,.154729,.125992,.975645,-.0225447,.154729,.142272,.975711,-.0252649,.154735,.159549,.975788,-.0280986,.154736,.177805,.975872,-.0308232,.154704,.196911,.975968,-.0324841,.154525,.216324,.976063,-.0351281,.154432,.236628,.976157,-.0388618,.15446,.257539,.976204,-.0437704,.154665,.278975,.976358,-.047514,.154652,.302606,.976571,-.0508638,.154535,.327204,.976725,-.0534995,.154221,.352276,.977013,-.0555547,.153737,.377696,.977294,-.0586728,.153403,.403855,.977602,-.0622715,.15312,.430333,.977932,-.0658166,.152755,.456855,.978241,-.0689877,.152233,.483668,.978602,-.0712805,.15132,.512097,.979234,-.0732775,.150235,.540455,.97977,-.075163,.148978,.568486,.979995,-.0778026,.147755,.596524,.98078,-.0791854,.146019,.624825,.981628,-.0799666,.143906,.653403,.982067,-.0808532,.141561,.681445,.98271,-.0816024,.139025,.708918,.983734,-.0812511,.135764,.736594,.98431,-.0806201,.132152,.763576,.985071,-.0801605,.12846,.789797,.98618,-.0784208,.124084,.815804,.986886,-.0766643,.1193,.840869,.987485,-.0747744,.114236,.864952,.988431,-.0716701,.108654,.888431,.988886,-.0691609,.102994,.910963,.990024,-.0654048,.0967278,.932629,.990401,-.0619765,.090384,.95313,.991093,-.0579296,.0837885,.972587,.992018,-.0536576,.0770171,.991184,.992536,-.0493719,.0701486,1.00863,.993421,-.0444813,.062953,1.02494,.993928,-.040008,.0560455,1.04017,.994994,-.0347982,.04856,1.05463,.995866,-.0301017,.0416152,1.06807,.996916,-.0248225,.0342597,1.08039,.997766,-.0199229,.0271668,1.09177,.998479,-.0147422,.0201387,1.10235,.99921,-.00980173,.0131944,1.11206,.999652,-.0047426,.00640712,1.12104,.999998,891673e-10,-10379e-8,1.12906,.967868,-351885e-11,.175947,193569e-10,.968001,-886733e-10,.175972,487782e-9,.96801,-354697e-9,.175973,.00195115,.968012,-798063e-9,.175974,.00439006,.968011,-.00141879,.175973,.00780461,.968011,-.00221686,.175973,.0121948,.968016,-.00319231,.175974,.0175607,.968019,-.00434515,.175974,.0239027,.968018,-.00567538,.175974,.0312208,.968033,-.00718308,.175977,.0395158,.968049,-.00886836,.175979,.0487885,.968047,-.0107312,.175978,.0590394,.968072,-.0127719,.175981,.0702705,.968108,-.0149905,.175986,.0824836,.968112,-.0173866,.175985,.0956783,.968173,-.0199611,.175993,.109862,.96827,-.0227128,.176008,.125033,.968292,-.025639,.17601,.141193,.968339,-.0287299,.176007,.158336,.968389,-.0319399,.176001,.176441,.968501,-.034941,.175962,.195359,.968646,-.0370812,.175793,.214686,.968789,-.0402329,.175708,.234973,.96886,-.0442601,.1757,.255871,.969013,-.049398,.175876,.277238,.969242,-.0539932,.17594,.300326,.969419,-.0577299,.175781,.324702,.969763,-.0605643,.175432,.349527,.970093,-.0634488,.174992,.374976,.970361,-.0670589,.174611,.401097,.970825,-.0708246,.174226,.427496,.971214,-.0742871,.173684,.453858,.971622,-.0782608,.173186,.480637,.972175,-.0813151,.172288,.508655,.972944,-.0832678,.170979,.536973,.973595,-.0855964,.169573,.565138,.974345,-.0882163,.168152,.593222,.975233,-.0901671,.166314,.621201,.976239,-.0912111,.163931,.649919,.977289,-.0916959,.161106,.678011,.978076,-.0927061,.158272,.705717,.979533,-.0925562,.15475,.733228,.980335,-.0918159,.150638,.760454,.981808,-.0908508,.146201,.786918,.983061,-.0896172,.141386,.812953,.984148,-.0871588,.135837,.838281,.985047,-.0850624,.130135,.862594,.986219,-.0818541,.123882,.88633,.987043,-.0784523,.117126,.908952,.988107,-.0749601,.110341,.930744,.988955,-.0703548,.102885,.951728,.989426,-.0662798,.0954167,.971166,.990421,-.0610834,.0876331,.989984,.991032,-.0562936,.0797785,1.00765,.992041,-.0508154,.0718166,1.02434,.992794,-.0454045,.0637125,1.03976,.993691,-.0398194,.0555338,1.05418,.994778,-.0341482,.0473388,1.06772,.995915,-.028428,.0391016,1.08028,.997109,-.022642,.0309953,1.09185,.998095,-.0168738,.0230288,1.10247,.998985,-.0111274,.0150722,1.11229,.999581,-.00543881,.00740605,1.12131,1.00003,162239e-9,-105549e-9,1.12946,.959505,-393734e-11,.196876,191893e-10,.959599,-992157e-10,.196895,483544e-9,.959641,-396868e-9,.196903,.0019342,.959599,-892948e-9,.196895,.00435193,.959603,-.00158747,.196896,.0077368,.959604,-.00248042,.196896,.0120888,.959605,-.00357184,.196896,.0174082,.959605,-.00486169,.196896,.0236949,.959613,-.00635008,.196897,.0309497,.959619,-.00803696,.196898,.0391725,.959636,-.00992255,.196901,.0483649,.959634,-.0120067,.1969,.0585266,.959675,-.0142898,.196906,.0696609,.959712,-.0167717,.196911,.0817678,.959752,-.0194524,.196918,.0948494,.959807,-.0223321,.196925,.10891,.959828,-.0254091,.196924,.123947,.959906,-.0286815,.196934,.139968,.960005,-.0321371,.196944,.156968,.960071,-.0357114,.196936,.17491,.960237,-.0389064,.196882,.193597,.960367,-.041623,.196731,.21285,.960562,-.0452655,.196654,.233075,.960735,-.0496207,.196643,.253941,.960913,-.0549379,.196774,.275278,.961121,-.0603414,.196893,.297733,.96139,-.0644244,.196717,.321877,.961818,-.067556,.196314,.346476,.962175,-.0712709,.195917,.371907,.96255,-.0752848,.1955,.397916,.963164,-.0792073,.195026,.424229,.963782,-.0828225,.194424,.450637,.964306,-.0873119,.193831,.477288,.964923,-.0911051,.192973,.504716,.966048,-.093251,.19151,.533053,.967024,-.0958983,.190013,.561366,.968038,-.09835,.188253,.589464,.969152,-.100754,.186257,.617433,.970557,-.102239,.183775,.645801,.972104,-.102767,.180645,.674278,.973203,-.103492,.177242,.702004,.975123,-.103793,.17345,.729529,.97641,-.102839,.168886,.756712,.978313,-.101687,.163892,.783801,.980036,-.100314,.158439,.809671,.981339,-.097836,.152211,.835402,.982794,-.0950006,.145679,.860081,.984123,-.0920994,.138949,.883757,.984918,-.0878641,.131283,.90685,.985999,-.083939,.123464,.928786,.987151,-.0791234,.115324,.94983,.987827,-.0739332,.106854,.96962,.988806,-.0688088,.0982691,.98861,.989588,-.0628962,.0893456,1.00667,.990438,-.0573146,.0805392,1.02344,.991506,-.0509433,.0713725,1.03933,.992492,-.0448724,.0623732,1.05378,.993663,-.0383497,.0530838,1.06747,.994956,-.0319593,.0439512,1.08007,.99634,-.025401,.0347803,1.09182,.99761,-.0189687,.0257954,1.1025,.99863,-.0124441,.0169893,1.11247,.99947,-.00614003,.00829498,1.12151,1.00008,216624e-9,-146107e-9,1.12993,.950129,-434955e-11,.217413,190081e-10,.950264,-10957e-8,.217444,47884e-8,.9503,-438299e-9,.217451,.00191543,.950246,-986124e-9,.21744,.00430951,.950246,-.00175311,.21744,.00766137,.950245,-.00273923,.21744,.011971,.950253,-.00394453,.217441,.0172385,.950258,-.00536897,.217442,.0234641,.950267,-.00701262,.217444,.030648,.950277,-.00887551,.217446,.038791,.950284,-.0109576,.217446,.0478931,.950312,-.0132591,.217451,.0579568,.950334,-.01578,.217454,.0689821,.950378,-.0185204,.217462,.0809714,.950417,-.0214803,.217467,.0939265,.950488,-.0246594,.217479,.10785,.950534,-.0280565,.217483,.122743,.950633,-.0316685,.217498,.138611,.950698,-.0354787,.217499,.155442,.950844,-.0394003,.217507,.173208,.950999,-.0426812,.217419,.191605,.951221,-.0461302,.217317,.21084,.951412,-.0502131,.217238,.230945,.951623,-.0549183,.21722,.251745,.951867,-.0604493,.217306,.273001,.952069,-.0665189,.217466,.294874,.952459,-.0709179,.217266,.318732,.952996,-.0746112,.216891,.34318,.953425,-.0789252,.216503,.36849,.953885,-.0833293,.216042,.394373,.954617,-.087371,.215469,.420505,.955429,-.0914054,.214802,.446907,.956068,-.0961671,.214146,.473522,.957094,-.10048,.213286,.50052,.958372,-.103248,.211796,.528715,.959654,-.106033,.21016,.557065,.961305,-.108384,.208149,.585286,.962785,-.111122,.206024,.613334,.964848,-.112981,.203442,.641334,.966498,-.113717,.19996,.669955,.968678,-.114121,.196105,.698094,.970489,-.114524,.191906,.725643,.972903,-.113792,.186963,.752856,.974701,-.112406,.181343,.780013,.976718,-.110685,.175185,.806268,.978905,-.108468,.168535,.832073,.980267,-.105061,.161106,.857149,.981967,-.101675,.153387,.881145,.983063,-.0974492,.145199,.904255,.984432,-.0925815,.136527,.926686,.985734,-.0877983,.127584,.947901,.986228,-.081884,.118125,.968111,.98719,-.0761208,.108594,.98719,.988228,-.0698196,.0989996,1.00559,.989046,-.0632739,.0890074,1.02246,.990242,-.056522,.0790832,1.03841,.991252,-.0495272,.0689182,1.05347,.992542,-.0425373,.0588592,1.06724,.994096,-.0353198,.0486833,1.08009,.995593,-.028235,.0385977,1.09177,.99711,-.0209511,.0286457,1.10274,.998263,-.0139289,.0188497,1.11262,.999254,-.0067359,.009208,1.12191,.999967,141846e-9,-657764e-10,1.13024,.935608,-474692e-11,.236466,187817e-10,.93996,-11971e-8,.237568,473646e-9,.939959,-478845e-9,.237567,.0018946,.939954,-.0010774,.237566,.00426284,.939956,-.00191538,.237566,.00757842,.939954,-.00299277,.237566,.0118413,.93996,-.00430961,.237567,.0170518,.939969,-.00586589,.237569,.02321,.939982,-.00766166,.237572,.0303164,.939987,-.00969686,.237572,.0383711,.939997,-.0119715,.237574,.0473751,.940031,-.0144858,.237581,.0573298,.940073,-.0172399,.237589,.0682366,.94012,-.0202335,.237598,.080097,.940162,-.0234663,.237604,.0929116,.940237,-.0269387,.237615,.106686,.940328,-.0306489,.237632,.121421,.940419,-.0345917,.237645,.137115,.940522,-.0387481,.237654,.153766,.940702,-.0429906,.237661,.17133,.940871,-.0465089,.237561,.189502,.941103,-.050531,.23748,.208616,.941369,-.0550657,.237423,.228595,.941641,-.0601337,.237399,.249287,.941903,-.0658804,.237443,.270467,.942224,-.0722674,.237597,.292024,.942633,-.0771788,.237419,.315272,.943172,-.0815623,.237068,.339579,.943691,-.0863973,.236682,.364717,.944382,-.0911536,.236213,.390435,.945392,-.0952967,.235562,.416425,.946185,-.0998948,.234832,.442772,.947212,-.104796,.234114,.469347,.948778,-.10928,.233222,.496162,.950149,-.113081,.231845,.523978,.951989,-.115893,.230005,.552295,.953921,-.11846,.227862,.580569,.955624,-.12115,.225439,.608698,.958234,-.123373,.222635,.636696,.960593,-.124519,.219093,.665208,.963201,-.124736,.214749,.693557,.965642,-.125012,.210059,.721334,.968765,-.124661,.204935,.748613,.971753,-.122996,.198661,.776224,.973751,-.120998,.191823,.802461,.976709,-.118583,.184359,.828399,.977956,-.115102,.176437,.853693,.979672,-.111077,.167681,.877962,.981816,-.10688,.158872,.901564,.98238,-.101469,.149398,.924057,.983964,-.0960013,.139436,.945751,.984933,-.0899626,.12943,.966272,.985694,-.0832973,.11894,.985741,.986822,-.0767082,.108349,1.00407,.987725,-.0693614,.0976026,1.02154,.98877,-.06211,.086652,1.03757,.990129,-.0544143,.0756182,1.05296,.991337,-.046744,.0645753,1.06683,.992978,-.0387931,.0534683,1.0798,.994676,-.030973,.0424137,1.09181,.99645,-.0230311,.0314035,1.10286,.997967,-.0152065,.0206869,1.11291,.99922,-.00744837,.010155,1.12237,1.00002,240209e-9,-752767e-10,1.13089,.922948,-515351e-11,.255626,186069e-10,.928785,-129623e-9,.257244,468009e-9,.928761,-51849e-8,.257237,.00187202,.928751,-.0011666,.257235,.00421204,.928751,-.00207395,.257234,.0074881,.928754,-.00324055,.257235,.0117002,.92876,-.00466639,.257236,.0168486,.928763,-.00635149,.257237,.0229334,.928774,-.00829584,.257239,.029955,.928791,-.0104995,.257243,.0379139,.928804,-.0129623,.257245,.0468108,.928847,-.0156846,.257255,.0566473,.92889,-.0186661,.257263,.0674246,.928924,-.0219067,.257268,.0791433,.928989,-.0254066,.257282,.0918076,.92909,-.0291651,.257301,.105419,.92918,-.0331801,.257316,.119978,.92929,-.0374469,.257332,.135491,.929453,-.041939,.257357,.151948,.929586,-.0464612,.257347,.169275,.929858,-.0503426,.257269,.187257,.930125,-.0548409,.257199,.206204,.930403,-.0598063,.257149,.22601,.930726,-.0652437,.257122,.246561,.931098,-.0712376,.257153,.267618,.931396,-.0777506,.257237,.288993,.931947,-.0832374,.257124,.311527,.932579,-.0883955,.25683,.335697,.933194,-.0937037,.256444,.360634,.934013,-.0987292,.255939,.386126,.935307,-.103215,.255282,.412018,.936374,-.108234,.254538,.438292,.93776,-.113234,.253728,.464805,.939599,-.118013,.25275,.491464,.941036,-.122661,.251404,.518751,.94337,-.125477,.249435,.547133,.945318,-.128374,.247113,.575456,.947995,-.130996,.244441,.60372,.950818,-.133438,.241352,.63174,.954378,-.135004,.237849,.659971,.957151,-.135313,.233188,.688478,.960743,-.13521,.228001,.716767,.964352,-.135007,.222249,.744349,.967273,-.133523,.21542,.771786,.969767,-.131155,.208039,.798639,.973195,-.128492,.200076,.824774,.975557,-.125094,.191451,.850222,.977692,-.120578,.18184,.874761,.98026,-.115882,.172102,.898497,.981394,-.110372,.161859,.921636,.982386,-.10415,.15108,.943467,.983783,-.0978128,.140407,.964045,.98422,-.0906171,.129058,.98398,.985447,-.0832921,.117614,1.00276,.986682,-.0754412,.10585,1.02047,.987326,-.0673885,.0940943,1.03678,.988707,-.0592565,.0822093,1.05218,.990185,-.050717,.070192,1.06652,.991866,-.0423486,.0582081,1.07965,.993897,-.0336118,.0460985,1.09188,.995841,-.0252178,.0342737,1.10307,.997605,-.0164893,.0224829,1.11324,.999037,-.00817112,.0110647,1.12262,1.00003,291686e-9,-168673e-9,1.13139,.915304,-552675e-11,.275999,183285e-10,.91668,-139285e-9,.276414,461914e-9,.916664,-55713e-8,.276409,.00184763,.916653,-.00125354,.276406,.00415715,.916651,-.00222851,.276405,.00739053,.916655,-.00348205,.276406,.0115478,.916653,-.00501414,.276405,.0166291,.916667,-.00682478,.276409,.0226346,.91668,-.00891398,.276412,.0295648,.91669,-.0112817,.276413,.0374199,.916727,-.013928,.276422,.0462016,.916759,-.0168528,.276429,.0559101,.916793,-.0200558,.276436,.0665466,.916849,-.0235373,.276448,.0781139,.916964,-.0272973,.276474,.0906156,.917047,-.0313344,.276491,.104051,.917152,-.0356465,.276511,.118424,.917286,-.0402271,.276533,.133736,.917469,-.0450408,.276564,.149978,.917686,-.0497872,.276563,.167057,.917953,-.0540937,.276493,.184846,.918228,-.0590709,.276437,.203614,.918572,-.0644277,.276398,.223212,.918918,-.0702326,.276362,.243584,.919356,-.076484,.276383,.264465,.919842,-.0830808,.276434,.285701,.920451,-.0892972,.276407,.307559,.921113,-.095016,.276128,.331501,.921881,-.100771,.275754,.356207,.923027,-.106029,.275254,.381477,.924364,-.111029,.274595,.40722,.925818,-.116345,.273841,.433385,.92746,-.121424,.272913,.459848,.929167,-.12657,.271837,.486493,.931426,-.131581,.270575,.513432,.934001,-.135038,.268512,.541502,.936296,-.138039,.266135,.569658,.939985,-.140687,.263271,.598375,.943516,-.143247,.260058,.626563,.94782,-.145135,.256138,.654711,.951023,-.145733,.251154,.683285,.955338,-.145554,.245562,.711831,.959629,-.145008,.239265,.739573,.963123,-.144003,.232064,.767027,.966742,-.141289,.224036,.794359,.969991,-.138247,.215305,.820361,.973403,-.134786,.206051,.846548,.975317,-.129966,.195914,.871541,.977647,-.12471,.185184,.895313,.980137,-.119086,.174161,.918398,.981031,-.112297,.162792,.940679,.982037,-.105372,.150952,.961991,.983164,-.097821,.138921,.981913,.983757,-.0897245,.126611,1.00109,.985036,-.0815974,.114228,1.01902,.986289,-.0727725,.101389,1.03604,.987329,-.0639323,.0886476,1.05149,.989193,-.0548109,.0756837,1.06619,.990716,-.045687,.0627581,1.07948,.992769,-.0364315,.0498337,1.09172,.99524,-.0271761,.0370305,1.1033,.997154,-.0179609,.0243959,1.11353,.998845,-.00878063,.0119567,1.12319,1.00002,259038e-9,-108146e-9,1.13177,.903945,-591681e-11,.295126,181226e-10,.903668,-148672e-9,.295037,455367e-9,.903677,-594683e-9,.29504,.00182145,.903673,-.00133805,.295039,.00409831,.903666,-.00237872,.295036,.00728584,.903668,-.00371676,.295037,.0113842,.903679,-.00535212,.29504,.0163936,.903684,-.00728479,.295041,.0223141,.903698,-.00951473,.295044,.0291462,.903718,-.0120419,.295049,.0368904,.903754,-.0148664,.295058,.0455477,.903801,-.017988,.29507,.0551194,.903851,-.0214064,.295082,.0656058,.903921,-.0251219,.295097,.0770109,.904002,-.0291337,.295116,.0893354,.904111,-.033441,.29514,.102583,.904246,-.0380415,.295169,.116755,.904408,-.0429258,.295202,.131853,.904637,-.0480468,.295245,.147869,.904821,-.0529208,.295214,.164658,.905163,-.0577748,.295185,.182274,.905469,-.0631763,.295143,.200828,.905851,-.068917,.295112,.2202,.906322,-.0750861,.295104,.240372,.906761,-.0815855,.295086,.261082,.90735,-.0882138,.295095,.282123,.908087,-.095082,.295139,.303563,.908826,-.101488,.29492,.327028,.909832,-.107577,.294577,.351464,.911393,-.113033,.294115,.376497,.912804,-.118629,.293446,.402115,.914081,-.124232,.292581,.428111,.91637,-.129399,.29166,.454442,.91814,-.134892,.290422,.481024,.921179,-.140069,.289194,.507924,.924544,-.144431,.287421,.535557,.927995,-.147498,.284867,.563984,.931556,-.150197,.281722,.5923,.935777,-.152711,.278207,.620832,.940869,-.154836,.274148,.649069,.945994,-.155912,.269057,.677746,.949634,-.155641,.262799,.706293,.955032,-.154809,.256097,.734278,.95917,-.153678,.248618,.761751,.962931,-.151253,.239794,.789032,.966045,-.147625,.230281,.815422,.96971,-.143964,.220382,.841787,.972747,-.139464,.209846,.867446,.975545,-.133459,.198189,.892004,.978381,-.127424,.186362,.915458,.979935,-.120506,.173964,.937948,.980948,-.11282,.161429,.959732,.982234,-.104941,.148557,.980118,.982767,-.0962905,.135508,.999463,.983544,-.0873625,.122338,1.01756,.984965,-.0783447,.108669,1.03492,.986233,-.0684798,.0949911,1.05087,.987796,-.0590867,.0811386,1.0656,.989885,-.0489145,.0673099,1.0794,.991821,-.0391,.0535665,1.09174,.99448,-.029087,.0397529,1.10341,.996769,-.019114,.0261463,1.11383,.998641,-.00947007,.0128731,1.1237,.999978,446316e-9,-169093e-9,1.13253,.888362,-627064e-11,.312578,178215e-10,.889988,-157791e-9,.313148,448451e-9,.889825,-631076e-9,.313092,.00179356,.88984,-.00141994,.313097,.00403554,.889828,-.0025243,.313092,.00717429,.889831,-.00394421,.313093,.0112099,.889831,-.00567962,.313093,.0161425,.889844,-.00773051,.313096,.0219724,.889858,-.0100968,.3131,.0286999,.889882,-.0127786,.313106,.0363256,.889918,-.0157757,.313116,.0448509,.889967,-.0190878,.313129,.0542758,.89003,-.022715,.313145,.0646032,.890108,-.0266566,.313165,.0758339,.890218,-.0309131,.313193,.0879729,.890351,-.0354819,.313226,.101019,.89051,-.0403613,.313263,.114979,.890672,-.0455385,.313294,.129848,.890882,-.0509444,.313333,.145616,.891189,-.0559657,.313324,.162122,.891457,-.0613123,.313281,.179524,.891856,-.0671488,.313281,.197855,.892312,-.0732732,.313268,.216991,.892819,-.0797865,.313263,.236924,.893369,-.0865269,.313247,.257433,.894045,-.0931592,.313205,.278215,.894884,-.100532,.313276,.299467,.895832,-.107716,.313205,.322276,.897043,-.114099,.312873,.34642,.898515,-.119941,.312331,.371187,.900191,-.126044,.311731,.396656,.90188,-.131808,.310859,.422488,.904359,-.137289,.309857,.448744,.906923,-.142991,.308714,.475239,.910634,-.148253,.307465,.501983,.914502,-.153332,.305774,.529254,.919046,-.156646,.303156,.557709,.923194,-.159612,.299928,.586267,.928858,-.162027,.296245,.614925,.934464,-.164203,.291832,.643187,.939824,-.165602,.286565,.671601,.944582,-.165383,.280073,.700213,.949257,-.164439,.272891,.728432,.954389,-.162953,.264771,.756082,.958595,-.161007,.255927,.78369,.962138,-.157243,.245769,.810769,.966979,-.152872,.235127,.836999,.969566,-.148209,.22347,.862684,.972372,-.142211,.211147,.887847,.975916,-.135458,.198606,.911843,.978026,-.128398,.185498,.934795,.979686,-.120313,.17171,.956787,.980748,-.11166,.158159,.978046,.981622,-.103035,.144399,.997693,.982356,-.0930328,.13001,1.01642,.983308,-.0834627,.115778,1.03366,.985037,-.0732249,.101327,1.05014,.986493,-.0628145,.086554,1.06507,.988484,-.0526556,.0720413,1.07907,.991051,-.0415744,.0571151,1.09189,.993523,-.0314275,.0426643,1.10369,.99628,-.0203603,.0279325,1.11423,.998344,-.0102446,.0138182,1.12421,.999997,42612e-8,-193628e-9,1.1333,.871555,-660007e-11,.329176,174749e-10,.875255,-166579e-9,.330571,441051e-9,.875644,-666394e-9,.330718,.00176441,.875159,-.00149903,.330536,.00396899,.87516,-.00266493,.330536,.007056,.875158,-.00416393,.330535,.0110251,.87516,-.00599598,.330535,.0158764,.875163,-.00816108,.330536,.0216101,.875174,-.0106591,.330538,.0282266,.875199,-.0134899,.330545,.0357266,.875257,-.0166538,.330563,.0441117,.875304,-.0201501,.330575,.0533821,.875373,-.0239785,.330595,.0635395,.875464,-.0281389,.330619,.0745872,.875565,-.0326301,.330645,.0865255,.875691,-.0374516,.330676,.0993599,.875897,-.0425993,.330733,.113093,.876091,-.0480576,.330776,.127722,.876353,-.0537216,.330826,.143227,.876649,-.0589807,.330809,.159462,.877034,-.0647865,.330819,.176642,.877443,-.0709789,.330817,.194702,.877956,-.0774782,.330832,.213577,.878499,-.0843175,.330822,.233246,.879144,-.0912714,.330804,.253512,.879982,-.0980824,.330766,.274137,.88097,-.105823,.330864,.295209,.882051,-.113671,.330896,.317226,.883397,-.120303,.330545,.341068,.884987,-.12667,.330068,.365613,.886789,-.133118,.329418,.390807,.889311,-.139024,.328683,.416494,.891995,-.144971,.327729,.442618,.895106,-.150747,.326521,.469131,.899527,-.156283,.325229,.495921,.90504,-.161707,.32378,.523162,.909875,-.165661,.32122,.55092,.91561,-.168755,.317942,.579928,.921225,-.171193,.313983,.608539,.927308,-.17319,.309636,.636854,.933077,-.174819,.304262,.66523,.938766,-.175002,.297563,.693609,.943667,-.173946,.289613,.722157,.949033,-.172221,.281227,.750021,.953765,-.169869,.271545,.777466,.95804,-.166578,.261034,.804853,.962302,-.161761,.249434,.831569,.966544,-.156636,.237484,.857779,.969372,-.150784,.224395,.883051,.972486,-.143672,.210786,.907864,.975853,-.135772,.196556,.931223,.977975,-.127942,.182307,.954061,.979122,-.118347,.167607,.97531,.980719,-.109112,.152739,.995666,.981223,-.0991789,.137932,1.01475,.98216,-.0883553,.122692,1.03253,.983379,-.0780825,.107493,1.04917,.985434,-.0665646,.0917791,1.06464,.987332,-.0557714,.0764949,1.07896,.990004,-.0442805,.060721,1.09199,.992975,-.0331676,.0452284,1.10393,.995811,-.0219547,.0297934,1.11476,.9982,-.0107613,.0146415,1.12484,1.00002,248678e-9,-14555e-8,1.13413,.859519,-693595e-11,.347264,171673e-10,.859843,-17503e-8,.347394,433219e-9,.859656,-700076e-9,.347319,.00173277,.859671,-.00157517,.347325,.00389875,.859669,-.00280028,.347324,.00693112,.85967,-.0043754,.347324,.01083,.859665,-.00630049,.347321,.0155954,.859685,-.0085755,.347328,.0212278,.859694,-.0112003,.347329,.0277273,.859718,-.0141747,.347336,.0350946,.85976,-.0174988,.347348,.0433314,.85982,-.0211722,.347366,.0524384,.859892,-.0251941,.347387,.0624168,.860006,-.0295649,.347422,.0732708,.860122,-.0342825,.347453,.0849999,.860282,-.0393462,.347499,.0976102,.860482,-.0447513,.347554,.111104,.860719,-.0504775,.347614,.125479,.860998,-.0563577,.347666,.140703,.861322,-.0619473,.347662,.156681,.861724,-.0681277,.347684,.173597,.862198,-.0746567,.347709,.191371,.862733,-.0815234,.347727,.209976,.863371,-.0886643,.347744,.229351,.86414,-.0957908,.347734,.24934,.865138,-.102912,.34772,.269797,.866182,-.110924,.3478,.290654,.867436,-.119223,.347911,.312074,.869087,-.126197,.347649,.335438,.870859,-.133145,.347222,.359732,.872997,-.139869,.346645,.38467,.875939,-.146089,.345935,.41019,.879012,-.152334,.345012,.436218,.883353,-.15821,.343924,.462641,.888362,-.164097,.342636,.489449,.895026,-.169528,.341351,.516629,.900753,-.174408,.339115,.544109,.906814,-.17751,.335809,.572857,.912855,-.180101,.331597,.601554,.919438,-.182116,.32698,.630198,.925962,-.183494,.321449,.658404,.931734,-.184159,.314595,.686625,.93762,-.18304,.306462,.71531,.943858,-.181323,.297514,.744272,.948662,-.178683,.287447,.771462,.953299,-.175379,.276166,.798593,.957346,-.170395,.263758,.8256,.962565,-.165042,.251019,.852575,.966075,-.158655,.237011,.878316,.969048,-.151707,.222518,.90329,.972423,-.143271,.207848,.927745,.975833,-.134824,.192463,.950859,.977629,-.125444,.1768,.972947,.978995,-.114949,.161033,.993263,.980533,-.104936,.145523,1.01337,.980745,-.0935577,.129799,1.03128,.981814,-.0822956,.113486,1.04825,.983943,-.0710082,.0972925,1.06405,.986141,-.0587931,.0808138,1.0785,.988878,-.0472755,.0644915,1.09204,.992132,-.0349128,.0478128,1.10413,.9953,-.0232407,.031621,1.11527,.998117,-.0112713,.0154935,1.12551,1.00003,339743e-9,-195763e-9,1.13504,.845441,-729126e-11,.364305,169208e-10,.843588,-183164e-9,.363506,425067e-9,.843412,-73253e-8,.36343,.00169999,.843401,-.00164818,.363426,.00382495,.843399,-.00293008,.363425,.00679993,.843401,-.00457822,.363425,.010625,.843394,-.00659249,.363421,.0153002,.843398,-.00897282,.363421,.0208258,.843415,-.0117191,.363426,.0272024,.843438,-.0148312,.363432,.0344305,.843483,-.018309,.363447,.0425116,.84356,-.0221521,.363472,.0514471,.843646,-.0263597,.363499,.061238,.843743,-.0309315,.363527,.0718873,.84388,-.0358658,.363569,.0833969,.844079,-.0411624,.363631,.0957742,.844279,-.0468128,.363688,.109015,.844549,-.0527923,.363761,.123124,.844858,-.0588204,.363817,.138044,.84522,-.0647573,.36383,.153755,.845669,-.0713181,.363879,.170394,.846155,-.0781697,.363908,.187861,.846789,-.0853913,.363969,.206176,.847502,-.0928086,.363999,.225244,.8484,-.10005,.363997,.244926,.849461,-.107615,.364008,.265188,.850562,-.115814,.364055,.28587,.851962,-.124334,.364179,.306926,.854326,-.131995,.364233,.329605,.856295,-.139338,.363856,.35359,.858857,-.146346,.363347,.37831,.862428,-.152994,.362807,.403722,.866203,-.159463,.361963,.429537,.871629,-.165623,.36112,.456,.877365,-.171649,.359917,.482773,.883744,-.177151,.35848,.509705,.890693,-.182381,.356523,.537215,.897278,-.186076,.3533,.565493,.903958,-.188602,.349095,.594293,.910908,-.190755,.344215,.623165,.918117,-.192063,.338606,.651573,.924644,-.192758,.331544,.679869,.931054,-.192238,.323163,.708668,.937303,-.190035,.313529,.737201,.943387,-.187162,.303152,.764977,.948494,-.183876,.29146,.792683,.952546,-.178901,.277917,.819228,.958077,-.173173,.264753,.846559,.962462,-.16645,.25002,.872962,.966569,-.159452,.234873,.898729,.969108,-.15074,.218752,.923126,.973072,-.141523,.202673,.947278,.975452,-.132075,.186326,.969938,.977784,-.121257,.169396,.991325,.97899,-.110182,.153044,1.01123,.979777,-.0989634,.136485,1.0299,.980865,-.0865894,.119343,1.04727,.982432,-.0746115,.102452,1.06341,.984935,-.0621822,.0852423,1.07834,.987776,-.0495694,.0678546,1.092,.99103,-.0372386,.0506917,1.1043,.99474,-.0244353,.0333316,1.11576,.997768,-.0121448,.0164348,1.12617,1.00003,31774e-8,-169504e-9,1.13598,.825551,-756799e-11,.378425,165099e-10,.82664,-190922e-9,.378923,416504e-9,.826323,-763495e-9,.378779,.0016656,.826359,-.00171789,.378795,.00374768,.82636,-.00305402,.378795,.00666259,.826368,-.00477185,.378798,.0104104,.826364,-.00687131,.378795,.0149912,.826368,-.00935232,.378795,.0204054,.826376,-.0122146,.378797,.0266532,.826399,-.0154581,.378803,.0337355,.82646,-.0190825,.378824,.0416537,.826525,-.0230873,.378846,.0504091,.826614,-.0274719,.378876,.0600032,.82674,-.0322355,.378917,.0704393,.826888,-.0373766,.378964,.0817195,.827078,-.0428936,.379024,.0938492,.827318,-.0487778,.379099,.106828,.82764,-.0549935,.379199,.120659,.827926,-.0611058,.379227,.13526,.828325,-.0675054,.379275,.150713,.828801,-.0743455,.379332,.167034,.8294,-.0815523,.379415,.184209,.830094,-.0890779,.379495,.202203,.8309,-.096736,.379555,.220945,.831943,-.104135,.379577,.240306,.833037,-.112106,.379604,.260317,.834278,-.120554,.379668,.2808,.836192,-.129128,.3799,.301654,.838671,-.137541,.380109,.323502,.840939,-.14523,.379809,.347176,.844575,-.15248,.379593,.371706,.848379,-.159607,.37909,.39688,.853616,-.166267,.378617,.422702,.858921,-.172698,.377746,.448919,.865324,-.178823,.376749,.475661,.872207,-.184542,.375363,.502599,.880018,-.189836,.373657,.529914,.88694,-.194294,.370673,.557683,.894779,-.197022,.36662,.586848,.902242,-.199108,.36138,.615831,.909914,-.200398,.355434,.644478,.917088,-.20094,.348173,.672905,.923888,-.200671,.339482,.701327,.930495,-.198773,.32956,.730101,.937247,-.195394,.318363,.758383,.943108,-.191956,.306323,.786539,.948296,-.187227,.292576,.813637,.953472,-.181165,.278234,.840793,.958485,-.174119,.263054,.867712,.962714,-.166564,.246756,.893635,.966185,-.158181,.229945,.919028,.970146,-.148275,.212633,.943413,.973491,-.138157,.195229,.966627,.975741,-.127574,.178048,.988817,.977238,-.11554,.160312,1.00924,.978411,-.10364,.142857,1.02845,.979811,-.0913122,.125317,1.04648,.98116,-.0782558,.107627,1.06284,.983543,-.0655957,.0895862,1.07798,.986789,-.0520411,.0713756,1.092,.990292,-.0389727,.053228,1.10484,.994187,-.025808,.0351945,1.11642,.997499,-.0126071,.0173198,1.12703,.999999,275604e-9,-148602e-9,1.13674,.81075,-78735e-10,.394456,161829e-10,.808692,-198293e-9,.393453,407564e-9,.80846,-792877e-9,.39334,.00162965,.808595,-.00178416,.393407,.00366711,.808597,-.00317182,.393408,.00651934,.808598,-.00495589,.393408,.0101866,.808591,-.00713627,.393403,.0146689,.808592,-.00971285,.393402,.0199667,.80861,-.0126855,.393407,.0260803,.808633,-.0160538,.393413,.0330107,.80868,-.0198175,.393429,.0407589,.808748,-.0239758,.393453,.0493264,.808854,-.0285286,.39349,.0587161,.808992,-.0334748,.39354,.0689304,.809141,-.0388116,.393588,.0799707,.809352,-.0445375,.39366,.0918432,.809608,-.0506427,.393742,.104549,.809915,-.0570708,.393834,.118085,.810253,-.0633526,.393885,.132377,.810687,-.0700966,.393953,.147537,.811233,-.0772274,.394047,.163543,.811865,-.0847629,.394148,.180394,.812648,-.0925663,.394265,.198051,.813583,-.100416,.394363,.216443,.814683,-.108119,.394402,.235502,.815948,-.11644,.394489,.255242,.817278,-.125036,.394542,.275441,.819605,-.133655,.39486,.296094,.822256,-.142682,.395248,.317309,.825349,-.150756,.395241,.340516,.829605,-.158392,.395285,.364819,.83391,-.165801,.394922,.389736,.839808,-.172677,.394691,.415409,.845708,-.179448,.394006,.441546,.853025,-.185746,.393279,.46832,.859666,-.191684,.391655,.495302,.86789,-.197146,.390068,.52262,.875845,-.201904,.38727,.550336,.882634,-.205023,.382688,.578825,.891076,-.207098,.377543,.608103,.900589,-.208474,.371752,.63723,.90791,-.209068,.364016,.665769,.915971,-.208655,.355593,.694428,.923455,-.20729,.345439,.723224,.931514,-.203821,.334099,.751925,.937885,-.19986,.321069,.780249,.943136,-.194993,.306571,.8077,.948818,-.189132,.291556,.83497,.954433,-.181617,.275745,.86188,.959078,-.173595,.258695,.888562,.962705,-.164855,.240825,.914008,.966753,-.155129,.22268,.939145,.970704,-.144241,.204542,.963393,.973367,-.133188,.185927,.985983,.975984,-.121146,.167743,1.00704,.976994,-.108366,.149218,1.02715,.978485,-.0956746,.13131,1.0455,.980074,-.0820733,.112513,1.06221,.98225,-.0684061,.0938323,1.07782,.98553,-.0549503,.0749508,1.09199,.989529,-.0407857,.055848,1.10508,.993536,-.0271978,.0368581,1.11684,.997247,-.0132716,.0181845,1.12789,1,431817e-9,-198809e-9,1.13792,.785886,-812608e-11,.405036,157669e-10,.790388,-205278e-9,.407355,398297e-9,.790145,-820824e-9,.407231,.00159263,.790135,-.00184681,.407226,.00358336,.790119,-.00328316,.407218,.00637039,.790126,-.00512988,.40722,.0099539,.79013,-.00738684,.407221,.0143339,.790135,-.0100538,.407221,.0195107,.790134,-.0131306,.407217,.0254848,.79016,-.0166169,.407224,.0322572,.790197,-.020512,.407236,.0398284,.790273,-.0248157,.407263,.0482014,.790381,-.029527,.407304,.0573777,.790521,-.0346446,.407355,.0673602,.790704,-.0401665,.40742,.0781522,.790925,-.0460896,.407499,.0897582,.791195,-.0524017,.407589,.10218,.791522,-.0590121,.407691,.11541,.791878,-.0654876,.407748,.12939,.792361,-.0725207,.407849,.144237,.792942,-.0799844,.407963,.159924,.79362,-.0877896,.408087,.176425,.794529,-.0958451,.408259,.193733,.795521,-.103827,.408362,.211756,.796778,-.111937,.408482,.230524,.798027,-.120521,.408547,.249967,.799813,-.129242,.408721,.269926,.802387,-.138048,.409148,.290338,.805279,-.147301,.409641,.311193,.809251,-.155895,.410154,.333611,.813733,-.163942,.410297,.357615,.819081,-.171666,.410373,.382339,.825427,-.178905,.410348,.407828,.83172,-.185812,.409486,.434034,.83877,-.192318,.408776,.460493,.845817,-.198249,.407176,.487346,.854664,-.204034,.405719,.514832,.863495,-.208908,.403282,.542401,.871883,-.212765,.399293,.570683,.88065,-.214911,.393803,.599947,.89004,-.216214,.387536,.62932,.898476,-.216745,.379846,.658319,.906738,-.216387,.370625,.687138,.914844,-.215053,.360139,.71601,.923877,-.212007,.348849,.745124,.931925,-.207481,.335639,.773366,.938054,-.202418,.320798,.801636,.943895,-.196507,.304772,.829055,.949468,-.189009,.288033,.856097,.955152,-.180539,.270532,.88301,.959403,-.171437,.251639,.909296,.963309,-.161661,.232563,.934868,.967399,-.150425,.213231,.959662,.972009,-.138659,.194247,.98302,.97433,-.126595,.174718,1.00517,.975823,-.113205,.155518,1.02566,.976371,-.0996096,.136709,1.04418,.978705,-.0860754,.117571,1.06146,.981477,-.0714438,.0980046,1.07777,.984263,-.0572304,.0782181,1.09214,.988423,-.0428875,.0584052,1.10553,.993,-.0282442,.038522,1.11758,.99704,-.0140183,.0190148,1.12864,.999913,369494e-9,-145203e-9,1.13901,.777662,-84153e-10,.423844,154403e-10,.770458,-211714e-9,.419915,38845e-8,.770716,-846888e-9,.420055,.00155386,.770982,-.00190567,.420202,.00349653,.770981,-.00338782,.420201,.00621606,.77098,-.00529338,.4202,.00971274,.770983,-.00762223,.4202,.0139867,.770985,-.0103741,.420198,.0190381,.770996,-.0135489,.4202,.0248677,.771029,-.0171461,.420212,.0314764,.771052,-.0211647,.420215,.0388648,.771131,-.0256048,.420245,.047036,.771235,-.0304647,.420284,.0559911,.771383,-.0357436,.420341,.0657346,.771591,-.0414392,.420423,.0762694,.771819,-.0475462,.420506,.0875984,.772123,-.0540506,.420617,.099727,.772464,-.060797,.42072,.112637,.772855,-.0675393,.420799,.126313,.773317,-.0748323,.420893,.140824,.773981,-.0825681,.421058,.15617,.774746,-.0906307,.421226,.172322,.77566,-.0988982,.421397,.189253,.776837,-.106994,.421569,.206912,.778097,-.115528,.421704,.225359,.779588,-.124317,.421849,.24447,.781574,-.133139,.422097,.264156,.784451,-.142179,.422615,.284318,.787682,-.15165,.423269,.304902,.792433,-.160771,.424396,.3265,.797359,-.169166,.424772,.35014,.803986,-.177149,.425475,.374768,.809504,-.184745,.424996,.399928,.815885,-.19173,.424247,.425796,.823513,-.198525,.423515,.452287,.832549,-.204709,.422787,.479321,.841653,-.210447,.421187,.506718,.850401,-.215501,.418519,.53432,.859854,-.219752,.414715,.56242,.869364,-.222305,.409462,.591558,.878837,-.223744,.402926,.621074,.888636,-.224065,.395043,.650538,.898132,-.223742,.38564,.679538,.907181,-.222308,.375378,.708674,.915621,-.219837,.363212,.737714,.9239,-.215233,.349313,.767014,.931644,-.209592,.334162,.795133,.938887,-.203644,.317943,.823228,.945282,-.196349,.300581,.850822,.950758,-.18742,.282195,.877594,.956146,-.177879,.262481,.904564,.960355,-.167643,.242487,.930741,.965256,-.156671,.222668,.955868,.968029,-.144123,.201907,.979869,.97251,-.131305,.18202,1.00291,.974925,-.118335,.161909,1.02392,.975402,-.103714,.142129,1.0433,.976987,-.089415,.122447,1.06089,.979677,-.0748858,.102248,1.07713,.983184,-.0596086,.0814851,1.09218,.987466,-.0447671,.0609484,1.10585,.992348,-.0295217,.0401835,1.11829,.996674,-.0143917,.0198163,1.12966,1.00003,321364e-9,-149983e-9,1.1402,.757901,-869074e-11,.436176,151011e-10,.751195,-217848e-9,.432317,378533e-9,.751178,-871373e-9,.432307,.0015141,.751195,-.00196061,.432317,.0034068,.751198,-.00348552,.432318,.00605659,.751195,-.00544599,.432315,.00946353,.751207,-.00784203,.43232,.013628,.751213,-.0106732,.43232,.0185499,.751221,-.0139393,.432319,.0242302,.751244,-.0176398,.432325,.0306694,.7513,-.0217743,.432348,.0378698,.751358,-.0263412,.432367,.0458321,.751458,-.0313396,.432404,.0545587,.751608,-.0367682,.432464,.0640543,.7518,-.0426246,.43254,.0743222,.752065,-.0489031,.432645,.0853668,.752376,-.0555828,.432762,.0971911,.752715,-.0623861,.432859,.109768,.753137,-.069415,.432958,.123126,.753676,-.0770039,.433099,.137308,.754345,-.084971,.433272,.15229,.755235,-.0932681,.433504,.168075,.756186,-.10171,.433693,.184625,.757363,-.110019,.433857,.201897,.75884,-.11887,.434102,.220014,.760467,-.127881,.434306,.238778,.762969,-.136766,.434751,.258172,.765823,-.14612,.43529,.278062,.769676,-.15566,.436236,.298437,.774909,-.165177,.437754,.319532,.77994,-.17402,.438343,.342505,.785757,-.182201,.438609,.366693,.792487,-.190104,.438762,.391668,.80038,-.197438,.438795,.417494,.808494,-.204365,.438226,.443933,.817695,-.210714,.437283,.470929,.828111,-.216651,.436087,.498569,.837901,-.221804,.433717,.526165,.847813,-.226318,.430133,.554155,.858314,-.229297,.425213,.582822,.868891,-.230999,.418576,.612847,.878941,-.231155,.410405,.642445,.888809,-.230935,.400544,.672024,.898089,-.229343,.389613,.701366,.908081,-.226886,.377197,.730763,.916819,-.222676,.363397,.759642,.924968,-.216835,.347437,.788775,.932906,-.210245,.32995,.817135,.940025,-.202992,.312262,.844912,.946101,-.19436,.293313,.872164,.952835,-.184125,.273638,.899443,.957347,-.173657,.252385,.926389,.961434,-.162204,.231038,.951947,.965522,-.14979,.209834,.976751,.969412,-.136307,.188821,1.00022,.973902,-.122527,.168013,1.02229,.974045,-.108213,.147634,1.04199,.975775,-.0927397,.12705,1.06019,.978383,-.0778212,.106309,1.07711,.98211,-.0621216,.0849279,1.09245,.986517,-.0463847,.0633519,1.10651,.991696,-.0309353,.0419698,1.11903,.996349,-.0150914,.0206272,1.13073,1.00003,442449e-9,-231396e-9,1.14146,.727498,-885074e-11,.441528,145832e-10,.730897,-223525e-9,.443589,368298e-9,.730796,-893996e-9,.443528,.00147303,.730805,-.00201149,.443533,.00331433,.730814,-.00357596,.443538,.00589222,.730815,-.00558734,.443538,.00920678,.730822,-.00804544,.44354,.0132582,.730836,-.0109501,.443545,.0180468,.730848,-.0143008,.443546,.0235732,.730871,-.0180969,.443552,.0298382,.730915,-.022338,.443567,.0368438,.730982,-.0270225,.443591,.044591,.731076,-.0321491,.443627,.0530831,.731245,-.0377166,.443699,.0623243,.73144,-.0437216,.443777,.0723181,.7317,-.0501576,.443881,.0830691,.732034,-.0569942,.444014,.0945809,.732388,-.0638756,.444113,.106825,.732853,-.071203,.444247,.119859,.733473,-.0790076,.444442,.13369,.734195,-.0871937,.444645,.148304,.735069,-.095696,.444877,.163702,.736169,-.10426,.445133,.179861,.73747,-.112853,.44537,.196778,.738991,-.12199,.445651,.214496,.740865,-.131153,.445958,.232913,.743637,-.140245,.446548,.251977,.746797,-.149722,.447246,.271551,.751517,-.159341,.448656,.291774,.756156,-.169106,.449866,.312455,.761519,-.178436,.450919,.334552,.768295,-.186904,.451776,.358491,.776613,-.195117,.452832,.383446,.783966,-.202695,.45249,.408945,.793542,-.20985,.452587,.435364,.803192,-.216403,.451852,.462336,.813892,-.22251,.450708,.48987,.824968,-.227676,.4486,.517697,.835859,-.232443,.445156,.545975,.846825,-.235775,.440351,.574483,.858085,-.237897,.433641,.604246,.868825,-.238074,.425354,.634101,.879638,-.237661,.415383,.664201,.889966,-.236186,.404136,.693918,.899479,-.233599,.390917,.723481,.908769,-.229737,.376352,.75258,.917966,-.223836,.360372,.781764,.926304,-.217067,.342551,.811139,.934626,-.209309,.324238,.839585,.941841,-.20071,.304484,.867044,.94789,-.190602,.283607,.894579,.954196,-.179253,.262205,.921743,.958383,-.167646,.239847,.948026,.963119,-.155073,.218078,.973296,.966941,-.141426,.195899,.998135,.970836,-.126849,.174121,1.02021,.973301,-.112296,.153052,1.04085,.97448,-.0964965,.131733,1.05946,.977045,-.080489,.10997,1.07693,.980751,-.064844,.0881657,1.09254,.985475,-.0481938,.0657987,1.10697,.991089,-.0319185,.0435215,1.12004,.996122,-.0158088,.0214779,1.13173,1.00001,372455e-9,-200295e-9,1.14291,.708622,-907597e-11,.45304,141962e-10,.711162,-228911e-9,.454662,358052e-9,.709812,-914446e-9,.453797,.00143034,.709865,-.00205819,.453834,.00321935,.709864,-.00365894,.453833,.00572331,.709855,-.00571692,.453826,.00894278,.709862,-.00823201,.453828,.012878,.709875,-.011204,.453832,.0175295,.709896,-.0146323,.453839,.0228978,.709925,-.0185163,.453847,.0289839,.709974,-.0228551,.453866,.0357894,.710045,-.0276473,.453892,.0433161,.710133,-.032891,.453924,.0515665,.710292,-.0385851,.453992,.0605458,.710485,-.0447254,.45407,.0702574,.710769,-.0513051,.454192,.0807077,.711106,-.0582733,.454329,.091896,.711516,-.0652866,.45446,.103814,.712071,-.0728426,.454653,.116508,.712676,-.0808307,.45484,.129968,.713476,-.0892216,.455096,.144206,.714377,-.0979047,.455346,.159212,.715579,-.106531,.455647,.174973,.716977,-.115492,.455961,.191504,.71862,-.124821,.456315,.208835,.72084,-.134079,.4568,.226869,.723786,-.143427,.457521,.245582,.727464,-.153061,.458475,.264957,.732771,-.162768,.460239,.284948,.736515,-.172627,.460899,.30522,.743519,-.182487,.463225,.326717,.750041,-.191295,.464027,.350113,.758589,-.199746,.465227,.374782,.767703,-.207584,.465877,.400226,.777484,-.214973,.465996,.426442,.788792,-.221796,.466019,.453688,.800194,-.228038,.465083,.481246,.811234,-.233346,.462506,.509086,.822859,-.238073,.459257,.537338,.835082,-.241764,.454863,.566108,.846332,-.244241,.448163,.595126,.858355,-.244736,.439709,.625574,.87034,-.244278,.429837,.65617,.881027,-.24255,.418002,.686029,.891007,-.239912,.404325,.716039,.900874,-.236133,.389222,.745518,.911072,-.230672,.373269,.775026,.920359,-.22356,.355083,.804521,.928604,-.215591,.335533,.834045,.937175,-.206503,.315278,.861612,.942825,-.196684,.293653,.889131,.949805,-.185116,.271503,.916853,.955535,-.172703,.248821,.943541,.959843,-.159978,.225591,.970132,.964393,-.146375,.202719,.994709,.968008,-.131269,.179928,1.0186,.971013,-.11569,.158007,1.03928,.973334,-.1003,.13624,1.05887,.975775,-.0833352,.1138,1.07652,.979579,-.0668981,.0913141,1.09297,.984323,-.0500902,.0683051,1.10734,.990351,-.0332377,.0451771,1.12084,.995823,-.0161491,.0221705,1.13296,1.0001,234083e-9,-108712e-9,1.14441,.683895,-924677e-11,.46015,137429e-10,.68833,-233383e-9,.463134,346865e-9,.688368,-933547e-9,.463159,.00138748,.688367,-.00210049,.463159,.00312187,.688369,-.00373415,.463159,.00555004,.688377,-.00583449,.463163,.00867216,.688386,-.00840128,.463166,.0124884,.688398,-.0114343,.463169,.0169993,.688418,-.0149329,.463175,.0222054,.688453,-.0188964,.463188,.028108,.688515,-.0233239,.463214,.0347085,.68857,-.0282136,.463231,.0420091,.688679,-.033564,.463276,.0500132,.688854,-.0393733,.463356,.0587255,.689038,-.0456354,.46343,.0681476,.689321,-.0523433,.463553,.0782897,.689662,-.059412,.463693,.0891501,.690188,-.0665736,.4639,.100735,.690755,-.0743106,.464107,.113074,.691405,-.0824722,.464329,.126161,.692198,-.0910484,.464585,.140007,.693196,-.0998778,.464893,.154612,.69454,-.108651,.465285,.169984,.695921,-.117855,.465596,.186106,.697749,-.12734,.466056,.203034,.700375,-.136714,.466771,.220703,.703395,-.146386,.467579,.239062,.707904,-.156096,.469067,.258188,.711673,-.165904,.469851,.277759,.717489,-.175812,.471815,.297935,.724051,-.185931,.47389,.318916,.731965,-.195238,.47587,.341591,.741151,-.204021,.477523,.366062,.751416,-.212113,.478881,.391396,.761848,-.21979,.479226,.417599,.771886,-.2267,.478495,.444401,.783998,-.232991,.477622,.472084,.796523,-.238645,.475833,.500193,.808851,-.243396,.472568,.52865,.821191,-.247226,.467857,.557362,.834261,-.250102,.461871,.586768,.846762,-.251056,.453543,.617085,.859867,-.250604,.443494,.647659,.871948,-.248783,.431711,.678119,.882967,-.245855,.417911,.708399,.892826,-.242168,.401993,.738256,.90332,-.237062,.385371,.767999,.913633,-.22997,.366837,.798191,.922774,-.221687,.346372,.827756,.931371,-.212345,.325682,.856425,.938929,-.20206,.303665,.884299,.944821,-.190981,.280786,.912023,.951792,-.178065,.2573,.939669,.957712,-.164634,.233448,.96655,.961912,-.150863,.209504,.992366,.966382,-.13577,.18597,1.01633,.969588,-.119593,.162905,1.03843,.971777,-.103203,.14053,1.05841,.97433,-.0865888,.117909,1.07632,.978686,-.0690829,.0944101,1.09326,.983281,-.0516568,.0705671,1.10796,.989562,-.034558,.0468592,1.12182,.995465,-.0167808,.0229846,1.1342,.999991,373016e-9,-235606e-9,1.1459,.662251,-939016e-11,.468575,132714e-10,.666634,-237624e-9,.471675,335842e-9,.666411,-950385e-9,.471516,.00134321,.666399,-.00213833,.471509,.00302221,.666386,-.0038014,.471499,.00537283,.666405,-.00593958,.471511,.00839533,.666406,-.00855253,.471508,.0120898,.666428,-.0116401,.471519,.0164569,.666444,-.0152015,.471522,.0214971,.66649,-.0192362,.471543,.027212,.666537,-.0237428,.471558,.033603,.666617,-.0287198,.471591,.0406728,.666718,-.0341647,.471631,.0484238,.666889,-.0400759,.47171,.0568621,.667104,-.0464479,.471805,.0659915,.667374,-.0532677,.471923,.0758178,.667772,-.0603805,.472098,.0863425,.668371,-.0677392,.472363,.0975917,.668971,-.0756028,.472596,.109567,.669696,-.0839293,.472869,.122272,.670481,-.0926683,.473126,.135718,.6715,-.1016,.473442,.149914,.672911,-.110566,.47389,.164882,.674512,-.119984,.474354,.180602,.67651,-.129574,.474922,.19711,.679292,-.139106,.475764,.214371,.682798,-.148993,.476886,.232405,.686955,-.158737,.478179,.251153,.691406,-.168754,.479432,.270436,.697438,-.178703,.481481,.290374,.704761,-.188955,.484143,.311044,.713599,-.198814,.487007,.333003,.723194,-.207869,.488962,.357144,.732601,-.216189,.489815,.382169,.744193,-.22398,.490888,.408227,.754907,-.231156,.490355,.434928,.767403,-.23747,.489548,.462599,.78107,-.243503,.488274,.490908,.793893,-.248114,.484843,.519421,.807296,-.25222,.4803,.548561,.820529,-.255265,.474097,.577772,.833716,-.256741,.466041,.607782,.848403,-.25637,.456547,.638807,.860755,-.254804,.443946,.670058,.874012,-.251834,.430852,.700749,.885619,-.247867,.414903,.731446,.896069,-.242634,.397276,.761191,.906266,-.236093,.378535,.791053,.916759,-.227543,.358038,.821298,.92523,-.21783,.335705,.850747,.93436,-.207534,.313797,.879258,.941631,-.195983,.289671,.907734,.947564,-.183567,.265319,.935206,.953681,-.169345,.240815,.962739,.960008,-.154909,.216119,.989227,.964145,-.140161,.192096,1.01465,.968171,-.123411,.167855,1.03737,.969859,-.106525,.144817,1.05767,.972666,-.0891023,.12149,1.0761,.977055,-.0718094,.0975306,1.09336,.982527,-.0534213,.0730217,1.10878,.989001,-.0355579,.0483366,1.12285,.99512,-.0176383,.023938,1.13548,1.00007,368831e-9,-211581e-9,1.14744,.651047,-960845e-11,.484101,12922e-9,.644145,-241347e-9,.478968,324578e-9,.64396,-965142e-9,.478831,.00129798,.64396,-.00217154,.47883,.00292046,.643968,-.00386049,.478835,.00519202,.643974,-.00603186,.478838,.0081128,.643977,-.0086854,.478836,.011683,.643982,-.0118207,.478834,.0159031,.644024,-.0154374,.478856,.0207743,.644059,-.0195343,.478868,.0262975,.644122,-.0241103,.478896,.0324747,.644207,-.0291638,.478933,.039309,.64432,-.0346919,.478981,.0468029,.644481,-.0406919,.479053,.0549614,.644722,-.047159,.479169,.0637909,.645013,-.0540748,.479302,.0732974,.645503,-.0612001,.479541,.0834898,.646117,-.0687303,.479829,.0943873,.646707,-.0767846,.480061,.105991,.647431,-.0852465,.480343,.11831,.64831,-.0940719,.48066,.131348,.649486,-.103056,.481083,.14514,.650864,-.112261,.481528,.159676,.652604,-.121852,.482102,.174979,.654825,-.131505,.482813,.191079,.657876,-.141189,.483876,.207927,.661339,-.151239,.48499,.225586,.665463,-.161091,.486279,.243947,.670542,-.171235,.487968,.262957,.677361,-.181347,.49053,.282781,.685672,-.191679,.493862,.303311,.694551,-.201781,.49699,.324607,.703753,-.211164,.498884,.347916,.713703,-.219675,.500086,.372628,.725911,-.227836,.501554,.398694,.73862,-.23533,.502193,.425529,.752118,-.241786,.501811,.453209,.76579,-.247865,.500185,.481381,.779568,-.252696,.497159,.51011,.793991,-.256802,.492765,.539322,.808182,-.259942,.486827,.569078,.821698,-.261703,.478386,.598818,.836009,-.262006,.468772,.629762,.849824,-.260333,.456352,.661366,.863888,-.257398,.442533,.69295,.876585,-.253264,.426573,.723608,.888665,-.248026,.408964,.754378,.899537,-.241487,.389677,.784761,.9094,-.233463,.368516,.814688,.920166,-.223397,.346624,.845009,.928899,-.21255,.322717,.874431,.937156,-.200869,.298698,.902922,.943861,-.188387,.273491,.931356,.949557,-.174341,.247866,.958854,.955862,-.158994,.222496,.986098,.961721,-.143664,.197522,1.01229,.965976,-.127412,.17302,1.03571,.968652,-.109798,.148954,1.05699,.971084,-.0916787,.125044,1.07587,.975584,-.0739634,.100577,1.09372,.98122,-.055322,.0753666,1.10948,.988253,-.0366825,.0498899,1.12394,.99482,-.0180389,.024611,1.13694,1.00001,229839e-9,-188283e-9,1.14919,.613867,-964198e-11,.479449,123452e-10,.621485,-244534e-9,.485399,313091e-9,.621429,-978202e-9,.485353,.00125245,.62112,-.00220004,.485114,.00281687,.621119,-.0039111,.485112,.00500783,.621122,-.00611091,.485112,.00782498,.621133,-.00879922,.485117,.0112687,.621152,-.0119756,.485125,.0153394,.621183,-.0156396,.485139,.0200382,.621227,-.0197898,.485158,.0253663,.621298,-.0244253,.485192,.0313261,.621388,-.0295441,.485233,.0379204,.621507,-.0351432,.485286,.0451523,.621693,-.0412198,.485378,.0530277,.621933,-.0477673,.485495,.0615522,.622232,-.0547574,.485635,.0707316,.622809,-.0619417,.485943,.0805883,.623407,-.069625,.486232,.0911267,.62406,-.077796,.486516,.102354,.624835,-.0863731,.486838,.114279,.625758,-.095251,.487188,.126902,.627043,-.104299,.487695,.140285,.628438,-.113724,.488163,.154397,.630325,-.123417,.488858,.169267,.632801,-.133137,.489754,.184941,.635784,-.143052,.490815,.20136,.639406,-.153132,.492048,.218643,.643872,-.163143,.49363,.236615,.6499,-.17333,.496009,.255449,.657201,-.183622,.498994,.275006,.666221,-.194019,.502888,.295354,.674419,-.204192,.505459,.316244,.683729,-.21406,.507771,.33849,.695584,-.222854,.510245,.363166,.708583,-.231315,.512293,.389071,.721233,-.238911,.512747,.415737,.735134,-.245657,.512482,.443331,.750179,-.251879,.511526,.471891,.765073,-.256911,.508935,.500892,.779794,-.261144,.504341,.530294,.794801,-.264316,.498515,.560144,.810339,-.266276,.491015,.590213,.824818,-.266981,.481126,.620865,.839375,-.265778,.468685,.652687,.853043,-.262748,.453925,.684759,.867335,-.258474,.437912,.716209,.88037,-.253187,.419648,.747508,.891711,-.246476,.39982,.77797,.902896,-.238735,.37879,.808586,.913601,-.22885,.355891,.838843,.923019,-.217656,.331773,.869014,.933432,-.205539,.307356,.898512,.939691,-.192595,.281321,.9269,.946938,-.178945,.255441,.955297,.952372,-.163587,.229013,.983231,.95909,-.147214,.203179,1.00971,.963675,-.13064,.17792,1.03438,.968247,-.113121,.152898,1.05625,.97001,-.0945824,.128712,1.07598,.974458,-.0755648,.103349,1.094,.980168,-.0571998,.0776731,1.1104,.987295,-.0377994,.0514445,1.12491,.994432,-.0186417,.025429,1.13851,.999975,542714e-9,-282356e-9,1.15108,.592656,-980249e-11,.486018,119532e-10,.598467,-247275e-9,.490781,301531e-9,.597934,-988317e-9,.490343,.00120517,.597903,-.00222366,.490319,.0027116,.597913,-.00395315,.490327,.00482077,.597919,-.00617653,.490329,.00753264,.597936,-.00889375,.490339,.0108478,.597956,-.0121043,.490347,.0147668,.597992,-.0158073,.490365,.0192905,.598032,-.0200017,.490382,.0244204,.598109,-.0246865,.49042,.0301593,.598215,-.0298594,.490474,.03651,.59833,-.0355167,.490524,.0434757,.598525,-.0416559,.490624,.0510629,.598778,-.0482692,.490753,.0592781,.599135,-.0553114,.49094,.0681304,.599802,-.062542,.491328,.0776467,.600361,-.0703638,.491598,.0878184,.60101,-.0786256,.491882,.0986573,.601811,-.0872962,.492232,.11018,.602861,-.0962284,.492684,.1224,.604167,-.10538,.493213,.135354,.605693,-.114896,.493799,.149034,.607682,-.124654,.494576,.163469,.610672,-.13456,.4959,.178747,.613313,-.144581,.496713,.194723,.617603,-.154703,.498499,.211617,.622174,-.16489,.500188,.229183,.628855,-.175164,.503072,.247786,.636963,-.185565,.506798,.267116,.644866,-.195911,.509719,.28702,.653741,-.206104,.512776,.307763,.664942,-.216447,.516812,.329631,.67633,-.22552,.519181,.353515,.690012,-.234316,.521681,.379226,.704243,-.242032,.523129,.405901,.719396,-.249172,.523768,.433585,.734471,-.255543,.522541,.462085,.750539,-.260697,.520217,.491233,.766365,-.26501,.516293,.521094,.781677,-.268409,.509708,.551014,.797132,-.270399,.501944,.581463,.812655,-.271247,.492025,.612402,.828592,-.270708,.480424,.643798,.844044,-.268085,.465955,.67682,.857305,-.263459,.448425,.708496,.87114,-.258151,.430243,.74046,.884936,-.251171,.410578,.771583,.895772,-.243305,.38862,.802234,.906961,-.234037,.365214,.833179,.917775,-.222714,.34116,.86353,.927883,-.210175,.31572,.893557,.936617,-.196925,.289159,.922976,.943384,-.182788,.261996,.951606,.949713,-.167965,.235324,.979958,.955818,-.151109,.208408,1.00765,.961344,-.133834,.182591,1.03329,.965469,-.115987,.156958,1.0557,.968693,-.09746,.132239,1.07583,.973165,-.0778514,.106195,1.09451,.979387,-.0585067,.0797669,1.11137,.98671,-.0390409,.0530263,1.12643,.994093,-.019408,.0263163,1.14016,1.00002,540029e-9,-194487e-9,1.15299,.574483,-989066e-11,.494533,114896e-10,.574478,-249127e-9,.494528,289403e-9,.574607,-996811e-9,.494637,.00115797,.574396,-.00224241,.494458,.00260498,.574377,-.00398632,.49444,.00463102,.574386,-.00622836,.494445,.00723623,.574401,-.0089683,.494453,.010421,.574419,-.0122056,.49446,.0141859,.574459,-.0159396,.494481,.0185322,.574525,-.0201692,.49452,.0234617,.574587,-.0248924,.494547,.0289762,.574697,-.0301074,.494604,.0350797,.574853,-.0358114,.494688,.0417767,.575027,-.041999,.494772,.0490718,.575294,-.0486618,.494915,.0569728,.575733,-.0557148,.495173,.0654955,.576356,-.0630489,.495537,.0746612,.576944,-.0709285,.495836,.0844615,.57765,-.0792723,.496177,.0949142,.578491,-.0880167,.496563,.10603,.579639,-.0969462,.497096,.117841,.580989,-.10622,.497684,.130367,.582587,-.115861,.498337,.143609,.584951,-.125605,.499414,.157625,.587602,-.135608,.500518,.172413,.59076,-.145742,.501767,.187999,.594992,-.155934,.503542,.20445,.600656,-.166303,.506135,.221764,.607816,-.176681,.509542,.24002,.61522,-.187071,.51263,.258992,.623702,-.197465,.516021,.278773,.634192,-.207816,.520422,.299377,.644936,-.218183,.524073,.320802,.657888,-.2278,.528049,.34384,.670666,-.236747,.52986,.36916,.685626,-.24484,.531892,.395867,.701304,-.252071,.532727,.423488,.717727,-.258714,.532146,.452201,.733914,-.264211,.529883,.481579,.750529,-.26859,.5259,.511558,.76747,-.272046,.51999,.542042,.785189,-.274225,.513083,.572799,.800954,-.275189,.502936,.603816,.816962,-.274946,.490921,.635461,.83336,-.272695,.47684,.6676,.848143,-.268223,.459405,.70051,.861818,-.262768,.440319,.732902,.876828,-.255872,.420123,.765084,.889312,-.247703,.398379,.796391,.900412,-.238381,.374496,.827333,.912251,-.227783,.349874,.858385,.921792,-.214832,.323181,.888652,.931273,-.200949,.296624,.917763,.940295,-.186537,.269211,.947878,.946812,-.171538,.241447,.977016,.953588,-.155254,.213829,1.00501,.958841,-.137156,.186807,1.03179,.963746,-.118699,.160706,1.05502,.966468,-.0998358,.135504,1.07568,.971178,-.0805186,.109131,1.09479,.97831,-.0599348,.0818293,1.1123,.985886,-.0399661,.0545872,1.12771,.994021,-.0198682,.0269405,1.14186,1.00009,271022e-9,-12989e-8,1.15514,.538716,-990918e-11,.486732,109675e-10,.550656,-250642e-9,.497518,277412e-9,.55057,-.00100265,.497441,.00110974,.550903,-.00225672,.497733,.00249779,.550568,-.00401046,.497438,.00443906,.550574,-.00626613,.49744,.00693637,.550591,-.0090226,.497449,.00998921,.550623,-.0122795,.497469,.0135984,.550667,-.0160361,.497495,.0177654,.550724,-.0202908,.497526,.0224915,.550792,-.0250421,.497557,.0277795,.550918,-.0302878,.49763,.0336334,.551058,-.0360241,.497701,.0400573,.551276,-.0422473,.497824,.0470585,.551551,-.0489441,.497977,.0546433,.552074,-.0559596,.498312,.0628367,.552681,-.0633978,.498679,.071646,.553324,-.0713176,.499031,.0810746,.554011,-.0797268,.499365,.091129,.55488,-.0885238,.499779,.101837,.556171,-.0974417,.500444,.113239,.557498,-.106841,.501025,.125316,.559299,-.116533,.501864,.138128,.561647,-.126298,.502967,.151695,.564347,-.136388,.504129,.16604,.567863,-.146576,.505713,.181207,.572569,-.156832,.507953,.197259,.578919,-.167323,.511186,.214258,.585387,-.177712,.514042,.232038,.593134,-.188184,.517484,.250733,.603295,-.198717,.522345,.270454,.613854,-.209177,.526751,.290807,.626092,-.219644,.531595,.312202,.637868,-.229494,.534721,.334435,.652458,-.238718,.538304,.359184,.666985,-.247061,.539875,.385637,.683301,-.254652,.541042,.41328,.69998,-.261376,.540735,.441903,.717824,-.267085,.539139,.471609,.734617,-.271465,.534958,.501446,.753663,-.27528,.53032,.532571,.770512,-.277617,.522134,.563641,.787356,-.278525,.51206,.595067,.806252,-.278512,.50119,.627226,.822061,-.277023,.486791,.659402,.838959,-.273175,.470467,.692874,.85379,-.267238,.450688,.725702,.868268,-.260327,.429741,.75832,.881994,-.251946,.407223,.790189,.893885,-.242432,.383214,.821625,.905118,-.231904,.357297,.853011,.916045,-.219545,.330733,.883773,.927614,-.205378,.303916,.914435,.936005,-.190388,.275941,.944502,.944533,-.1749,.247493,.974439,.950758,-.158588,.218996,1.00286,.957078,-.141027,.191559,1.0304,.962448,-.121507,.164457,1.05466,.964993,-.102068,.138636,1.0761,.970017,-.0822598,.111861,1.09541,.97661,-.062033,.0843438,1.11317,.985073,-.0409832,.0558496,1.12911,.993515,-.020146,.0275331,1.1438,1.00006,27329e-8,-107883e-9,1.15736,.525324,-999341e-11,.498153,105385e-10,.526513,-251605e-9,.499277,265329e-9,.526517,-.00100641,.499282,.0010613,.526588,-.00226466,.499337,.00238823,.526539,-.0040255,.499302,.00424535,.526547,-.00628954,.499306,.00663364,.526561,-.00905628,.499313,.00955337,.526593,-.0123253,.499334,.0130054,.526642,-.0160957,.499365,.0169911,.5267,-.0203661,.499396,.0215122,.526792,-.0251347,.499451,.0265718,.526904,-.0303985,.499511,.0321732,.527079,-.0361554,.499617,.0383231,.527285,-.0423982,.499731,.045026,.527602,-.0491121,.499924,.0522936,.528166,-.0561127,.500306,.0601528,.52879,-.0635988,.5007,.0686059,.529421,-.071581,.501048,.0776518,.530144,-.0799854,.501421,.0873148,.531062,-.0888032,.501884,.0976084,.532374,-.0977643,.50259,.108588,.533828,-.107197,.50329,.120234,.53581,-.116887,.504312,.132602,.538063,-.126755,.505365,.145721,.5409,-.136819,.506668,.159617,.544882,-.147117,.508731,.174369,.550238,-.157446,.511601,.190028,.556038,-.167988,.514431,.206587,.563031,-.178364,.517808,.224046,.571543,-.189007,.521937,.242503,.582255,-.199546,.527415,.261977,.59272,-.210084,.531682,.282162,.605648,-.220448,.537123,.303426,.61785,-.230593,.540664,.325323,.632223,-.240238,.544467,.348993,.648819,-.24887,.547594,.375462,.665825,-.256657,.54912,.403024,.683389,-.263711,.549294,.431773,.701495,-.269666,.547649,.461494,.719197,-.274169,.543786,.491623,.737906,-.278124,.538644,.522994,.756652,-.280632,.531057,.554775,.775279,-.281741,.521972,.586441,.792688,-.281652,.509613,.618596,.811894,-.280345,.496497,.651462,.827938,-.277128,.47968,.684023,.844837,-.271646,.460688,.718024,.859239,-.264397,.438872,.751207,.874088,-.256144,.41577,.784232,.887693,-.246311,.391369,.816191,.899402,-.235497,.365872,.847828,.910973,-.223631,.338618,.87934,.92204,-.209874,.310803,.910325,.930987,-.194265,.281802,.940695,.94,-.178125,.252836,.970958,.948018,-.161479,.224239,1.00078,.955141,-.144038,.195857,1.0288,.960513,-.124915,.168487,1.05371,.963964,-.104284,.141495,1.07596,.968713,-.0838732,.114437,1.09628,.975524,-.0635579,.0863105,1.11448,.98431,-.042291,.0574774,1.13069,.992916,-.0209131,.0284343,1.14568,.999926,743097e-9,-379265e-9,1.15955,.501042,-998428e-11,.498726,100306e-10,.502992,-252112e-9,.500665,253283e-9,.502417,-.00100791,.500092,.00101259,.502965,-.00226919,.500621,.00227978,.502318,-.00403109,.499994,.00405011,.502333,-.00629832,.500005,.00632868,.502362,-.00906907,.500027,.00911446,.502369,-.0123423,.500023,.0124078,.50243,-.0161178,.500066,.016211,.502493,-.0203937,.500103,.0205256,.502592,-.0251684,.500166,.0253548,.502707,-.0304389,.50023,.0307029,.502881,-.0362015,.500335,.0365753,.503124,-.0424507,.500488,.0429798,.503443,-.0491582,.500686,.0499268,.504083,-.0561476,.501155,.0574541,.504668,-.0636846,.501524,.0655408,.505319,-.0716834,.501904,.0742072,.50609,-.0800925,.502321,.0834699,.507122,-.0888425,.502896,.0933603,.508414,-.097855,.503603,.10391,.509955,-.107304,.504416,.115113,.512061,-.116921,.505565,.127054,.514419,-.12689,.506732,.139709,.517529,-.136934,.508338,.153173,.522085,-.147327,.510987,.167528,.526986,-.157612,.513527,.182708,.533122,-.168213,.516717,.198881,.540807,-.178688,.520832,.215986,.550687,-.189511,.52632,.234335,.560567,-.199998,.531009,.253375,.571698,-.210652,.535839,.273499,.584364,-.220917,.541091,.294355,.599066,-.23137,.546875,.316525,.614148,-.241206,.551306,.339671,.631157,-.250379,.555187,.36531,.647919,-.258397,.556595,.392767,.666112,-.265528,.556949,.421397,.686158,-.271827,.556617,.451433,.704838,-.27674,.552975,.482131,.723957,-.280733,.547814,.513458,.74262,-.283359,.53997,.545446,.762009,-.284541,.530422,.57775,.781314,-.284507,.518546,.610434,.799116,-.283309,.504178,.643178,.817604,-.280378,.48843,.676248,.83459,-.275619,.469457,.709698,.850974,-.26856,.447698,.744245,.866747,-.260094,.424791,.777695,.881412,-.249929,.399913,.810392,.8936,-.239137,.37308,.842872,.905943,-.226818,.345705,.874677,.916408,-.213699,.31706,.906257,.927215,-.198428,.288444,.936881,.935625,-.181643,.258329,.96795,.944076,-.164386,.228488,.998216,.951229,-.146339,.199763,1.02689,.958793,-.127709,.172153,1.0535,.963219,-.107244,.144989,1.07646,.967562,-.0857764,.11685,1.09675,.974866,-.0645377,.0880571,1.11576,.983353,-.0431732,.0587352,1.13227,.992503,-.0218356,.0294181,1.1478,1.00003,605203e-9,-231013e-9,1.16207,.482935,-101177e-10,.504695,968142e-11,.477554,-251521e-9,.499071,240676e-9,.477904,-.00100683,.499436,96342e-8,.478368,-.00226636,.499899,.0021687,.477977,-.00402719,.499513,.00385384,.477993,-.00629226,.499525,.0060221,.478011,-.00906011,.499536,.00867289,.478051,-.0123305,.499566,.0118074,.478089,-.016102,.499587,.0154269,.478171,-.0203736,.499645,.0195341,.478254,-.025143,.499692,.0241318,.47839,-.0304071,.499779,.0292247,.478588,-.0361631,.499911,.0348196,.478812,-.0424023,.500046,.0409231,.479208,-.0490724,.500326,.047552,.479841,-.0560722,.500805,.0547377,.480392,-.0636125,.501152,.0624607,.481068,-.0716134,.501561,.0707473,.481898,-.0800062,.502054,.0796118,.483022,-.0886568,.502728,.0890974,.484332,-.0977553,.503479,.0992099,.486126,-.107173,.504546,.10999,.488066,-.11677,.50557,.121476,.490521,-.126725,.506849,.133672,.494232,-.136793,.50911,.146731,.498302,-.147116,.511345,.160577,.503565,-.157446,.514344,.175335,.510902,-.168121,.518824,.191207,.519263,-.178799,.523666,.208058,.528204,-.189407,.528296,.225875,.538854,-.200145,.533724,.244782,.551278,-.210701,.539833,.264753,.565222,-.221303,.546131,.285745,.579403,-.231688,.551496,.307592,.595469,-.241718,.556809,.330582,.610929,-.250992,.559641,.354995,.629433,-.259602,.562379,.382471,.648504,-.267038,.563676,.411126,.66756,-.273388,.562092,.440924,.689143,-.278788,.560807,.472118,.709056,-.282783,.555701,.503774,.729855,-.285836,.548698,.536364,.748954,-.287078,.538544,.56895,.768373,-.287133,.526711,.601991,.78827,-.285839,.512511,.635403,.807465,-.283238,.496323,.668797,.825194,-.27906,.477638,.702584,.842203,-.272286,.456253,.736393,.857749,-.263854,.432412,.77096,.874799,-.253943,.407806,.80489,.887497,-.24237,.38033,.83771,.89966,-.230278,.352446,.870376,.911753,-.21646,.323268,.902256,.923011,-.202071,.294314,.933306,.932375,-.185519,.264104,.965177,.940537,-.167604,.234035,.996303,.948904,-.149068,.20412,1.0261,.955263,-.129539,.175431,1.05304,.960303,-.109932,.148116,1.07617,.965512,-.0880572,.119693,1.09742,.973466,-.0660548,.0901619,1.11721,.98284,-.0439228,.0599875,1.13436,.992216,-.0219588,.0298975,1.15006,.999946,119402e-9,-208547e-10,1.16471,.447827,-100414e-10,.491543,914833e-11,.454778,-251257e-9,.499172,22891e-8,.453519,-.00100342,.497787,914184e-9,.45357,-.00225776,.497847,.00205701,.453578,-.00401371,.497855,.00365705,.45357,-.00627107,.497841,.00571453,.453598,-.00902968,.497864,.00823019,.453627,-.0122888,.497882,.0112049,.453684,-.0160475,.497923,.0146405,.453764,-.0203044,.49798,.0185394,.453866,-.0250576,.498049,.0229054,.453996,-.0303028,.49813,.0277424,.454196,-.0360379,.498267,.0330587,.454457,-.0422521,.498445,.0388613,.454926,-.0488393,.498812,.0451767,.455525,-.0558653,.499272,.0520153,.456074,-.0633772,.499625,.0593754,.456752,-.0713606,.500049,.0672751,.457648,-.07971,.500615,.0757447,.458849,-.0883032,.501399,.0848231,.46029,-.0974095,.502293,.0945135,.462,-.106729,.503301,.104848,.464121,-.116354,.504533,.115884,.466889,-.126214,.506172,.127652,.470744,-.136324,.508667,.14024,.47488,-.146595,.510995,.153673,.480845,-.157027,.514832,.168053,.488262,-.167658,.519506,.183508,.496547,-.178343,.524347,.199948,.506254,-.188916,.52983,.217503,.517961,-.199975,.536357,.236272,.531484,-.210624,.543641,.256096,.545496,-.221227,.550048,.277085,.559497,-.231568,.555076,.298615,.575752,-.241698,.560541,.321547,.591999,-.251172,.564156,.345602,.610654,-.260178,.567607,.371851,.630484,-.268094,.56923,.40076,.651807,-.274661,.569779,.430801,.67239,-.280331,.566791,.461939,.693024,-.284501,.562007,.493854,.715473,-.287852,.555791,.526992,.736323,-.28929,.546345,.560102,.755771,-.289405,.534,.593543,.775424,-.2881,.519114,.627256,.795447,-.285562,.502543,.661464,.815319,-.281416,.484773,.695206,.831769,-.275523,.463445,.729044,.849464,-.267516,.440269,.764069,.866775,-.257584,.415049,.799089,.881252,-.245817,.388049,.831948,.894209,-.233127,.35889,.865526,.906922,-.219579,.329915,.89818,.919686,-.204491,.300441,.930013,.929044,-.188962,.269445,.962061,.938393,-.171079,.238402,.994214,.94661,-.15199,.208204,1.02533,.953095,-.131953,.178653,1.0529,.958644,-.111233,.150684,1.0771,.963925,-.0903098,.122359,1.09855,.971995,-.0680505,.0923342,1.11874,.981658,-.0448512,.0614195,1.13635,.991649,-.0221931,.0303582,1.15238,.999985,393403e-9,-111086e-9,1.16772,.396806,-971563e-11,.457671,842355e-11,.429186,-249421e-9,.495017,21625e-8,.429324,-998052e-9,.495173,865322e-9,.429175,-.00224487,.494999,.00194637,.429129,-.00399041,.494952,.00346004,.429153,-.00623476,.494974,.00540684,.429168,-.0089773,.494983,.00778714,.429207,-.0122175,.495012,.0106022,.429257,-.0159542,.495047,.0138535,.429338,-.0201864,.495106,.0175443,.429431,-.0249104,.495165,.0216774,.429587,-.0301252,.495279,.0262594,.429796,-.0358249,.495432,.0312968,.430065,-.0419972,.495621,.0367985,.430588,-.0485144,.496061,.042798,.43113,-.0555028,.496472,.0492914,.431743,-.0629852,.496904,.0562907,.432448,-.0709256,.497369,.0638056,.433414,-.0791942,.498032,.071885,.434638,-.0877346,.498854,.0805517,.43611,-.0968056,.499812,.0898047,.437859,-.106002,.500891,.0997142,.440017,-.115648,.502198,.110289,.443236,-.125427,.504389,.121644,.44697,-.135492,.506809,.133769,.451689,-.145746,.509858,.146787,.45811,-.156219,.514247,.160793,.465305,-.166834,.518816,.175791,.474085,-.177546,.524331,.191906,.484808,-.188262,.53104,.209199,.49732,-.199346,.538511,.227825,.509693,-.209951,.544554,.247269,.524367,-.220533,.551616,.267978,.539228,-.231082,.557368,.289672,.55644,-.241342,.563782,.31268,.574204,-.250964,.568851,.33651,.593388,-.260306,.57312,.362219,.613358,-.268667,.574916,.390322,.634512,-.275591,.575053,.420478,.65563,-.281328,.572404,.451614,.678265,-.285948,.568893,.484112,.70011,-.289408,.561878,.517348,.723005,-.291328,.55359,.551355,.743744,-.291418,.541099,.585109,.763949,-.290252,.526489,.619487,.784186,-.287648,.509496,.65404,.804304,-.283782,.491484,.688649,.823629,-.278067,.470517,.723133,.84094,-.270588,.44705,.757163,.857852,-.261188,.421252,.792816,.874934,-.249313,.394191,.827248,.888709,-.236492,.365359,.861074,.902589,-.222185,.336016,.894417,.914201,-.207314,.30527,.926825,.925978,-.191146,.274532,.9595,.93512,-.174135,.243393,.991583,.943656,-.155231,.212414,1.02356,.951719,-.134403,.182005,1.05239,.957164,-.113023,.153043,1.07754,.962656,-.0914493,.124186,1.09984,.970695,-.0694179,.0941654,1.12,.980749,-.0466199,.0629671,1.13849,.991205,-.0227032,.0311146,1.15494,.999884,632388e-9,-254483e-9,1.1706,.379821,-957289e-11,.460637,789337e-11,.405188,-247483e-9,.491396,204064e-9,.404796,-989434e-9,.490914,815853e-9,.40483,-.00222607,.490949,.00183559,.40473,-.00395723,.49084,.00326332,.404731,-.00618287,.490836,.00509945,.404768,-.00890258,.490871,.00734463,.404791,-.0121156,.490883,.00999992,.404857,-.0158214,.490938,.0130676,.404943,-.0200178,.491004,.0165503,.405059,-.0247027,.491093,.0204521,.405213,-.0298729,.491205,.0247788,.405399,-.0355226,.491333,.0295373,.405731,-.0416352,.491604,.034741,.406303,-.0480807,.492116,.0404255,.406814,-.0550458,.492506,.0465732,.407404,-.0624652,.492926,.0532058,.408149,-.0702958,.493442,.0603442,.409128,-.0784623,.494136,.0680297,.410408,-.087007,.495054,.0762786,.411813,-.0959639,.495962,.0851046,.413735,-.105075,.497257,.0945878,.416137,-.114646,.498882,.104725,.41934,-.124394,.501132,.11563,.423326,-.134328,.503883,.127325,.428419,-.14458,.50747,.139911,.43484,-.154979,.511964,.153481,.442641,-.165628,.517328,.168114,.452511,-.176365,.524258,.183995,.463473,-.187298,.531248,.200953,.475564,-.198244,.538367,.219176,.488664,-.208938,.545175,.238514,.504073,-.219599,.553227,.259129,.520832,-.230378,.560653,.280997,.538455,-.240703,.567523,.303821,.55709,-.250548,.573287,.327948,.576646,-.259964,.577795,.353362,.596705,-.268721,.580077,.380336,.618053,-.276054,.58018,.4101,.640303,-.282176,.578747,.44161,.662365,-.286931,.574294,.474106,.684542,-.290521,.567035,.507549,.707984,-.292672,.558687,.541853,.730913,-.293189,.547606,.576581,.752948,-.292199,.533471,.61172,.773452,-.289508,.516395,.646339,.794715,-.285716,.497873,.682131,.814251,-.280051,.476845,.716396,.833057,-.272873,.453449,.751503,.84959,-.263982,.427857,.786085,.867022,-.252745,.400335,.821355,.882277,-.239655,.371304,.85646,.895375,-.225386,.340397,.890828,.909347,-.209587,.310005,.923532,.921885,-.193433,.2796,.956419,.932127,-.176135,.247276,.989445,.941869,-.157872,.216186,1.02221,.949735,-.137577,.185602,1.05195,.956617,-.115285,.155767,1.07822,.961974,-.0928418,.126103,1.10149,.96972,-.0700592,.0956758,1.12207,.98012,-.0474671,.0643269,1.1408,.990825,-.0238113,.0320863,1.1577,.999876,381574e-9,-812203e-10,1.17403,.367636,-961342e-11,.469176,753287e-11,.380377,-244772e-9,.485434,191797e-9,.380416,-978857e-9,.485475,767015e-9,.380376,-.00220165,.485435,.00172522,.380419,-.00391408,.485487,.00306734,.380438,-.00611549,.485505,.00479332,.380462,-.00880558,.485525,.00690391,.380496,-.0119837,.485551,.00940039,.38056,-.0156487,.485605,.0122848,.38064,-.0197988,.485666,.0155601,.380767,-.0244324,.48577,.0192313,.380909,-.0295444,.485871,.0233032,.381142,-.0351321,.48606,.0277861,.381472,-.0411535,.486336,.0326939,.382015,-.0475408,.486833,.0380565,.382523,-.0544395,.487231,.0438615,.383129,-.061784,.487683,.0501332,.383952,-.0695085,.488313,.0568996,.38498,-.0775819,.489077,.0641952,.386331,-.0860443,.490113,.0720324,.387788,-.0948406,.491099,.0804379,.389808,-.103899,.492566,.0894899,.39252,-.113313,.494601,.0992098,.395493,-.123007,.496619,.109641,.399826,-.132859,.499912,.120919,.405341,-.143077,.504061,.133107,.411932,-.153465,.508905,.146263,.420591,-.164108,.515482,.160544,.43101,-.174893,.523191,.176123,.441881,-.185839,.53026,.192757,.453919,-.196633,.537295,.210535,.468715,-.207611,.546156,.229886,.485182,-.218517,.555173,.250543,.501926,-.229249,.562728,.27221,.51785,-.239481,.567494,.294892,.536947,-.249395,.573889,.318987,.557115,-.259,.578831,.344348,.577966,-.268075,.582055,.371223,.599489,-.276115,.583307,.399834,.62479,-.282523,.583902,.431415,.647504,-.287663,.57953,.464301,.670601,-.291538,.573103,.498123,.693539,-.293842,.563731,.532662,.717385,-.294681,.553169,.567925,.741533,-.293717,.539908,.603502,.762142,-.291156,.521902,.639074,.783014,-.28719,.502815,.674439,.805158,-.281773,.482598,.710497,.823646,-.274682,.458949,.7456,.841879,-.266184,.433129,.781085,.859515,-.255682,.406064,.816,.875335,-.242849,.376509,.851074,.890147,-.228329,.345502,.886473,.903144,-.212491,.31428,.920751,.916618,-.195695,.282994,.954606,.927953,-.178267,.251091,.988402,.937414,-.159549,.219107,1.02141,.946823,-.140022,.18896,1.05167,.954651,-.118154,.158667,1.07819,.959955,-.0946636,.128808,1.1025,.96858,-.0711792,.0973787,1.12391,.97938,-.0475046,.0650965,1.14322,.990498,-.024059,.0326267,1.16077,.999844,-512408e-10,112444e-9,1.17727,.316912,-934977e-11,.425996,695559e-11,.356423,-241372e-9,.479108,179562e-9,.356272,-965292e-9,.478897,71811e-8,.356262,-.00217182,.478894,.00161574,.356265,-.00386092,.478895,.00287261,.356278,-.0060324,.478905,.00448907,.356293,-.00868565,.478914,.00646572,.356346,-.0118207,.478965,.00880438,.356395,-.0154355,.479001,.0115066,.356484,-.019529,.479075,.0145762,.356609,-.0240991,.47918,.018018,.356766,-.0291413,.479305,.0218379,.357009,-.0346498,.479512,.0260454,.357424,-.0405462,.479909,.0306657,.357899,-.0468825,.480337,.0357054,.358424,-.0536887,.480771,.0411728,.359041,-.0609416,.481242,.0470841,.359903,-.0685239,.481943,.0534831,.360932,-.0764883,.482741,.0603795,.362196,-.0848364,.483688,.0678028,.363847,-.0935002,.484947,.0758086,.365972,-.102471,.486588,.0844173,.368741,-.111751,.488787,.0937199,.372146,-.121334,.491405,.103732,.377114,-.131147,.495604,.114608,.38226,-.141213,.499436,.126345,.389609,-.151632,.505334,.139116,.397925,-.162073,.51168,.152995,.407824,-.172819,.518876,.168071,.420014,-.183929,.527639,.184495,.434266,-.195032,.537588,.20232,.447352,-.205792,.544379,.221189,.463726,-.216704,.553422,.241616,.481406,-.227531,.562074,.263298,.498707,-.238017,.568227,.286116,.518039,-.247936,.574473,.3101,.538277,-.257437,.579191,.335401,.561166,-.266829,.584807,.362246,.583189,-.275329,.586476,.390609,.606024,-.28234,.585578,.420998,.632419,-.287924,.584496,.454357,.656128,-.291972,.577766,.488233,.679953,-.29456,.56875,.523248,.704654,-.295816,.558388,.559168,.729016,-.295157,.544826,.595326,.752062,-.292779,.528273,.631864,.773138,-.288681,.508482,.667793,.794869,-.283358,.487341,.704035,.815101,-.27608,.46354,.739925,.834212,-.26767,.438672,.775539,.852368,-.257397,.411239,.810895,.870207,-.245689,.3829,.846472,.884063,-.231452,.351496,.881788,.898284,-.215561,.31895,.917438,.912964,-.198208,.287367,.952422,.924666,-.180426,.254487,.987551,.934429,-.161525,.222226,1.02142,.943485,-.141197,.191143,1.05218,.9521,-.120085,.161112,1.07937,.957876,-.0975881,.130982,1.10403,.966943,-.0726842,.0990553,1.12616,.978313,-.0483705,.0662818,1.14619,.990048,-.0239072,.0329243,1.16413,.999984,461885e-9,-772859e-10,1.18099,.321287,-935049e-11,.455413,659662e-11,.332595,-237513e-9,.471437,167562e-9,.332729,-949964e-9,.471618,670192e-9,.332305,-.00213618,.471028,.00150712,.332326,-.00379765,.471055,.00267959,.332344,-.00593353,.471072,.00418751,.332356,-.00854349,.471077,.00603172,.332403,-.0116268,.471121,.00821362,.332461,-.0151824,.47117,.0107357,.332552,-.0192088,.471251,.0136014,.332657,-.0237024,.47133,.0168152,.332835,-.0286615,.471487,.0203853,.333083,-.0340765,.471708,.0243212,.333547,-.0398563,.47219,.0286518,.333989,-.0460916,.472587,.0333763,.334532,-.0527897,.473054,.0385084,.335167,-.0599284,.473568,.0440638,.33608,-.0673514,.474362,.0500962,.337146,-.0752237,.475231,.0566022,.338462,-.083418,.476282,.0636272,.34014,-.0919382,.477615,.0712153,.342341,-.100741,.479404,.079417,.345088,-.109905,.481618,.0882631,.349049,-.119369,.485081,.0978851,.353939,-.129033,.489317,.108336,.359893,-.139038,.494309,.119698,.366945,-.149411,.499983,.132024,.375814,-.159843,.507185,.145558,.387112,-.170664,.516392,.160433,.40023,-.181897,.526519,.176648,.412555,-.192785,.53423,.193922,.427023,-.203663,.542741,.212662,.443685,-.214695,.552066,.232944,.461499,-.225561,.560762,.254495,.480975,-.236257,.569421,.277531,.501,-.24639,.576101,.301724,.521691,-.256101,.581493,.327112,.543478,-.265289,.585221,.353917,.566094,-.273938,.587614,.381941,.589578,-.281679,.587991,.41172,.614583,-.287655,.585928,.444148,.641813,-.292228,.582092,.478617,.666189,-.295172,.57398,.51397,.690475,-.29648,.561676,.550118,.715543,-.296203,.548758,.586933,.740405,-.293999,.532792,.62384,.762183,-.28998,.512735,.660723,.786069,-.28478,.492402,.69807,.806812,-.277568,.469058,.734422,.826987,-.268951,.443017,.770946,.844588,-.259049,.415501,.80699,.863725,-.2471,.387328,.842107,.879137,-.234157,.356108,.878078,.894634,-.218719,.324315,.914058,.909162,-.201293,.291813,.949922,.92072,-.18267,.258474,.985337,.93158,-.163212,.225593,1.0205,.941238,-.142771,.193986,1.05273,.949293,-.120956,.163392,1.08075,.956226,-.0985743,.132934,1.10559,.96546,-.075118,.101255,1.12823,.977403,-.0497921,.0675441,1.149,.989648,-.0241574,.0334681,1.16765,1.00001,5762e-7,-184807e-9,1.18519,.303474,-916603e-11,.4542,61243e-10,.308894,-232869e-9,.462306,155592e-9,.309426,-931661e-9,.463093,622499e-9,.308643,-.0020949,.461933,.00139979,.308651,-.0037242,.461941,.00248874,.308662,-.00581873,.46195,.00388933,.308687,-.00837818,.461974,.00560247,.308728,-.0114016,.462011,.00762948,.308789,-.0148884,.462067,.00997326,.308882,-.0188369,.462151,.0126375,.309007,-.0232436,.462263,.0156271,.30918,-.0281054,.462417,.0189498,.309442,-.0334065,.462667,.0226167,.309901,-.0390589,.463162,.0266614,.310331,-.0452042,.463555,.0310715,.310858,-.0517735,.464019,.0358698,.311576,-.0587359,.464669,.0410848,.312436,-.0660383,.465406,.0467453,.313526,-.0737266,.466339,.0528718,.314903,-.0817574,.467504,.0595039,.316814,-.090167,.469226,.0666888,.318965,-.0987555,.470981,.0744658,.322077,-.107792,.473814,.082912,.325947,-.117098,.477241,.0920846,.331008,-.126602,.48184,.102137,.337893,-.136619,.488334,.113135,.345106,-.146838,.494415,.12511,.355111,-.157357,.503275,.138356,.365095,-.167955,.510966,.152686,.378344,-.179157,.521508,.16856,.391599,-.190143,.530455,.18561,.407786,-.20123,.541275,.204308,.425294,-.212456,.551784,.224623,.444021,-.223568,.561493,.246172,.463418,-.234154,.569886,.268979,.484077,-.244546,.577116,.293411,.505513,-.254301,.582914,.318936,.527672,-.263564,.587208,.345856,.550565,-.272332,.589277,.374054,.573656,-.280011,.588426,.403276,.59827,-.286924,.587504,.43474,.624731,-.291994,.583401,.468767,.652396,-.295159,.576997,.504411,.67732,-.296954,.565863,.54114,.703147,-.296877,.552316,.57816,.728715,-.295147,.536773,.616124,.752448,-.291275,.51771,.653885,.775169,-.285905,.496087,.691537,.799307,-.279064,.474232,.729251,.819482,-.270294,.447676,.766267,.837659,-.260032,.419656,.802616,.856903,-.248497,.391328,.838583,.873325,-.235252,.360285,.874711,.889788,-.221126,.329215,.91077,.904486,-.204304,.296392,.94653,.917711,-.185562,.262159,.983828,.928969,-.165635,.229142,1.01955,.939707,-.14442,.19673,1.05317,.948167,-.122147,.165095,1.0823,.955222,-.099098,.13451,1.10791,.964401,-.0755332,.102476,1.1312,.976605,-.0513817,.0689667,1.15218,.989085,-.0258499,.034506,1.17129,.999908,617773e-9,-271268e-9,1.18961,.285803,-905752e-11,.452348,572272e-11,.284689,-22732e-8,.450581,143626e-9,.285263,-910214e-9,.451482,575099e-9,.285302,-.00204784,.451553,.00129395,.285318,-.00364057,.451574,.0023006,.28533,-.00568813,.451585,.00359547,.285361,-.00819001,.451618,.00517934,.285397,-.0111458,.45165,.007054,.285447,-.0145536,.451688,.00922167,.285527,-.0184127,.451758,.0116869,.285688,-.0227207,.451929,.0144555,.28584,-.0274712,.452055,.0175341,.286136,-.0326278,.452369,.0209406,.286574,-.0381792,.452853,.0246965,.287012,-.0441879,.453272,.0287996,.287542,-.0506096,.453752,.033268,.288299,-.0573634,.454488,.0381504,.289186,-.0645458,.455294,.0434447,.290302,-.0720405,.456301,.0491973,.291776,-.0799046,.457648,.0554453,.29372,-.088117,.459483,.0622311,.296052,-.0965328,.461571,.0695992,.299563,-.105409,.465085,.077658,.30335,-.114553,.468506,.0864176,.309167,-.123917,.474423,.0961078,.31529,-.13381,.47995,.106643,.324163,-.144021,.488592,.118322,.333272,-.154382,.496461,.131133,.344224,-.165015,.50562,.145208,.357733,-.176168,.516719,.16073,.373046,-.187468,.528513,.177807,.38788,-.198488,.537713,.196072,.405133,-.209545,.547999,.21605,.423845,-.220724,.55759,.237484,.443777,-.231518,.566246,.26039,.464824,-.242035,.574326,.284835,.486635,-.251898,.58037,.310518,.51012,-.261304,.58568,.337678,.535301,-.270384,.590197,.366242,.559193,-.27841,.590569,.395873,.583544,-.285325,.588161,.426857,.608834,-.291113,.584249,.459477,.635753,-.294882,.57763,.494734,.664367,-.297088,.569479,.532023,.689688,-.297364,.555064,.569629,.715732,-.295949,.539522,.608124,.741307,-.292259,.521613,.646231,.764949,-.287063,.49969,.684938,.788599,-.28012,.476747,.723548,.81048,-.27153,.45116,.761135,.831372,-.261289,.424101,.798916,.850092,-.249559,.39443,.835952,.867777,-.236348,.363849,.871606,.884632,-.221569,.332477,.907843,.90047,-.20618,.300667,.944187,.914524,-.188771,.266552,.981371,.926892,-.168362,.232349,1.01841,.937951,-.146761,.199359,1.05308,.947236,-.123813,.1675,1.0839,.954367,-.099984,.136166,1.11047,.963907,-.0759278,.103808,1.13414,.976218,-.0511367,.0697061,1.15575,.988772,-.0267415,.0352529,1.17531,.999888,-520778e-9,289926e-9,1.19389,.263546,-883274e-11,.441896,526783e-11,.262352,-221849e-9,.439889,132311e-9,.262325,-886683e-9,.439848,528824e-9,.26228,-.00199476,.439765,.00118975,.262372,-.00354671,.439922,.00211568,.26239,-.00554141,.439941,.00330652,.262412,-.00797888,.439961,.00476346,.262453,-.0108584,.440002,.00648818,.262528,-.0141788,.440085,.0084835,.262615,-.017938,.440166,.0107533,.262744,-.0221346,.440291,.0133044,.262939,-.026762,.440493,.0161445,.263277,-.0317573,.440889,.0192974,.26368,-.0371832,.441338,.0227699,.264106,-.0430371,.441753,.0265698,.264624,-.0493035,.442227,.0307178,.265378,-.0558669,.442985,.0352616,.266253,-.0628718,.443795,.0401968,.267478,-.0701569,.445008,.04559,.269062,-.077845,.446599,.0514539,.270926,-.0857941,.448349,.0578382,.273693,-.0940773,.451221,.0648363,.276746,-.102704,.454097,.0724389,.281693,-.111735,.459517,.0808744,.287335,-.121004,.46531,.0901551,.29448,-.130734,.472605,.100371,.30257,-.140777,.480251,.111644,.312465,-.15111,.489444,.124111,.324856,-.16189,.500919,.137979,.33774,-.172946,.511317,.153163,.35255,-.184152,.522684,.169817,.367786,-.19522,.53248,.187886,.385474,-.20632,.543326,.207634,.404976,-.217744,.554109,.229165,.425203,-.228691,.563395,.252068,.446704,-.239299,.571565,.276471,.468951,-.249348,.577935,.302323,.493487,-.258933,.584309,.329882,.517861,-.268009,.58773,.358525,.543309,-.276238,.589612,.388585,.569704,-.28356,.589294,.419787,.594871,-.289497,.585137,.452114,.622555,-.294452,.580356,.486466,.651167,-.296918,.57185,.523079,.677332,-.297647,.558428,.5611,.703718,-.296321,.542232,.599592,.730262,-.293339,.524541,.639138,.754304,-.288036,.502691,.677978,.778051,-.281018,.479212,.716537,.801557,-.272414,.454071,.75586,.822559,-.262419,.425952,.794477,.843051,-.250702,.397313,.832664,.86232,-.237264,.366534,.869876,.879044,-.222716,.334816,.906973,.896362,-.206827,.303143,.943558,.910342,-.189659,.269699,.979759,.924119,-.171108,.236411,1.01718,.935374,-.149579,.202224,1.05289,.944295,-.126295,.16989,1.08496,.952227,-.101511,.138089,1.11256,.962041,-.0766392,.105053,1.1375,.97528,-.0511967,.070329,1.15983,.988476,-.025463,.0351268,1.17987,.999962,286808e-10,145564e-10,1.19901,.227089,-841413e-11,.404216,472707e-11,.239725,-215083e-9,.426708,120833e-9,.239904,-860718e-9,.427028,483555e-9,.239911,-.00193661,.427039,.00108806,.239914,-.00344276,.42704,.00193457,.239933,-.00537907,.427064,.00302363,.239944,-.00774482,.427065,.00435604,.239993,-.01054,.427122,.00593398,.240052,-.0137626,.427179,.00775987,.240148,-.0174115,.427279,.00983854,.240278,-.021484,.42741,.0121763,.240472,-.0259729,.427618,.0147827,.240839,-.0308131,.428086,.0176837,.241201,-.0360893,.428482,.0208775,.241626,-.0417723,.428907,.0243821,.242207,-.0478337,.42952,.0282228,.24298,-.0542199,.430332,.0324333,.243881,-.0610015,.431222,.0370252,.245123,-.0680874,.432512,.0420535,.24667,-.0755482,.434088,.0475414,.248779,-.0832873,.436323,.0535542,.251665,-.0913546,.439509,.0601716,.255305,-.0998489,.443478,.0674282,.260049,-.108576,.448713,.0754673,.266192,-.117754,.455524,.084339,.273158,-.127294,.4627,.0941683,.282131,-.137311,.472068,.10515,.293332,-.147736,.483565,.117402,.304667,-.158357,.493702,.130824,.317785,-.169274,.504708,.145724,.333245,-.180595,.517107,.16215,.349843,-.191892,.528849,.180149,.367944,-.203168,.540301,.199746,.387579,-.214443,.551514,.221047,.408247,-.225624,.560906,.243981,.43014,-.236422,.56959,.268513,.452669,-.24654,.576098,.294409,.476196,-.256157,.580925,.322002,.501157,-.265289,.584839,.351052,.527632,-.273671,.587614,.3812,.555754,-.281254,.589119,.412994,.581682,-.287448,.585204,.445498,.608196,-.292614,.579006,.479505,.635661,-.296068,.571297,.514643,.664999,-.297395,.560855,.552213,.691039,-.296645,.544525,.591365,.7179,-.293785,.526535,.630883,.744059,-.289089,.50545,.670932,.76863,-.282239,.482514,.710904,.793273,-.273688,.457246,.750259,.814731,-.26328,.428872,.78948,.835603,-.251526,.399384,.828597,.85489,-.238339,.368811,.866892,.872828,-.223607,.336617,.90563,.889462,-.207538,.303997,.943538,.904929,-.190297,.270812,.980591,.919101,-.172034,.237453,1.01935,.930536,-.152058,.204431,1.05498,.941223,-.129515,.172495,1.08717,.94982,-.104263,.140175,1.11551,.960592,-.0781944,.106465,1.14098,.974629,-.051688,.0711592,1.16418,.98811,-.0253929,.0354432,1.18465,1.00004,804378e-9,-330876e-9,1.20462,.214668,-821282e-11,.406619,433582e-11,.218053,-208144e-9,.413025,109887e-9,.217987,-832212e-9,.412901,439362e-9,.217971,-.00187246,.412876,988623e-9,.217968,-.00332855,.41286,.00175772,.217985,-.00520055,.412882,.00274729,.218014,-.00748814,.412916,.00395842,.218054,-.0101901,.412957,.00539274,.218106,-.0133057,.413005,.00705348,.218217,-.0168342,.413139,.00894581,.218338,-.0207707,.413258,.0110754,.21855,-.0251001,.413509,.0134551,.218913,-.0297861,.413992,.0161081,.219265,-.0348956,.414383,.0190307,.219696,-.0403909,.414839,.0222458,.220329,-.0462003,.415567,.025792,.220989,-.0524208,.41621,.0296637,.222027,-.058948,.417385,.0339323,.223301,-.0658208,.418779,.0386055,.224988,-.0730347,.420665,.0437355,.227211,-.0805274,.423198,.0493844,.230131,-.088395,.426566,.0556135,.233908,-.0966208,.43091,.0624829,.239092,-.105223,.437148,.0701636,.245315,-.11424,.444302,.0786949,.253166,-.12368,.453262,.0882382,.262374,-.133569,.463211,.0988682,.273145,-.143836,.474271,.110727,.285512,-.154577,.4863,.123945,.299512,-.165501,.498817,.138581,.314287,-.176698,.510341,.154676,.331083,-.188066,.522583,.172459,.349615,-.199597,.534879,.191979,.369318,-.210843,.546083,.21309,.390377,-.222068,.5562,.235998,.412411,-.233059,.564704,.260518,.435715,-.24357,.572314,.286795,.461196,-.253356,.579395,.314559,.485587,-.262362,.581985,.343581,.511908,-.270895,.584347,.374367,.539798,-.278452,.58505,.406015,.567974,-.284877,.583344,.439168,.594303,-.290124,.577348,.473005,.622951,-.294183,.570751,.508534,.652404,-.296389,.561541,.544764,.679291,-.296605,.546426,.582927,.706437,-.294095,.528599,.622681,.734485,-.28978,.508676,.663567,.758841,-.283363,.484768,.704092,.78537,-.275015,.460434,.745101,.807315,-.264689,.432166,.784712,.8271,-.252597,.401807,.824241,.849191,-.239154,.371458,.863803,.867046,-.224451,.338873,.903063,.8852,-.208342,.306175,.942763,.901771,-.190684,.272759,.981559,.915958,-.172105,.239306,1.02048,.928046,-.152214,.206071,1.05765,.939961,-.130247,.17367,1.08999,.948711,-.10672,.142201,1.11829,.959305,-.0808688,.108454,1.14467,.973009,-.0539145,.0728109,1.16839,.987631,-.0262947,.0360625,1.19004,.999978,.00132758,-559424e-9,1.21058,.193925,-793421e-11,.391974,392537e-11,.196746,-200315e-9,.397675,991033e-10,.19667,-801099e-9,.397521,396342e-9,.196633,-.00180246,.397445,891829e-9,.196654,-.00320443,.397482,.00158582,.196659,-.00500647,.39748,.00247867,.196683,-.0072086,.397506,.00357167,.196728,-.00981001,.397562,.00486675,.196792,-.0128096,.397633,.00636707,.19689,-.0162055,.397746,.00807752,.197017,-.0199943,.397884,.0100052,.19729,-.024139,.39827,.0121691,.197583,-.0286671,.398639,.0145755,.197927,-.0335858,.399034,.0172355,.198383,-.0388806,.399554,.0201718,.199002,-.0444736,.400289,.0234194,.199739,-.0504583,.401111,.026984,.200784,-.056729,.402349,.0309217,.202075,-.0633643,.403841,.0352496,.203898,-.0703247,.406076,.0400313,.206199,-.0775565,.408841,.0453282,.209252,-.085184,.41259,.0511794,.213638,-.0931994,.418288,.0577459,.21881,-.101617,.424681,.0650508,.225642,-.11052,.433429,.0732759,.233717,-.119772,.442897,.0824683,.242823,-.129505,.452888,.0927484,.254772,-.139906,.466407,.104417,.266603,-.150402,.477413,.117211,.28073,-.161395,.490519,.131598,.295399,-.172465,.50201,.147407,.312705,-.183982,.515311,.165031,.331335,-.195532,.52786,.184336,.351037,-.206971,.5392,.205361,.372175,-.218117,.54941,.228043,.394548,-.229327,.558642,.25267,.419598,-.240052,.567861,.279071,.443922,-.249937,.573332,.306882,.471495,-.259407,.58013,.33661,.496769,-.267749,.580564,.367328,.524951,-.275524,.581696,.399753,.55318,-.282148,.579885,.433134,.581577,-.287533,.575471,.467534,.609231,-.291612,.567445,.502943,.637478,-.293911,.557657,.53871,.667795,-.295096,.546535,.576568,.694272,-.294073,.529561,.614929,.722937,-.290386,.510561,.655909,.749682,-.284481,.487846,.697663,.774754,-.276188,.462487,.738515,.799301,-.266215,.43481,.779802,.820762,-.254116,.404879,.820045,.843231,-.240393,.374559,.860294,.861857,-.225503,.341582,.900965,.880815,-.209382,.308778,.941727,.89766,-.19155,.275232,.980916,.912926,-.172346,.240938,1.02162,.926391,-.151799,.207223,1.0597,.938429,-.129968,.17484,1.09291,.947834,-.10651,.142984,1.12248,.958432,-.0824098,.109902,1.149,.972402,-.0565242,.0744454,1.1733,.987191,-.028427,.0373794,1.19538,.999975,385685e-10,-4203e-8,1.21676,.178114,-766075e-11,.385418,354027e-11,.176074,-191966e-9,.381002,887135e-10,.17601,-767549e-9,.380861,354715e-9,.17598,-.00172696,.380798,798168e-9,.175994,-.00307012,.380824,.00141928,.176017,-.00479684,.380858,.00221859,.176019,-.00690648,.380839,.00319714,.176072,-.00939888,.380913,.0043572,.176131,-.0122726,.380979,.005702,.176239,-.0155264,.38112,.00723689,.176371,-.0191551,.381272,.00896907,.176638,-.023117,.381669,.0109194,.176912,-.0274633,.382015,.0130903,.177279,-.032173,.382476,.0154949,.17774,-.0372219,.383041,.0181669,.178344,-.0426132,.38378,.0211209,.179153,-.0483309,.384773,.0243899,.180197,-.0543447,.386076,.0280062,.181581,-.0607122,.387809,.032004,.18344,-.0673855,.390205,.036453,.186139,-.0743989,.393944,.0414162,.189432,-.0817731,.39832,.0469394,.193795,-.0895464,.404188,.0531442,.199641,-.0978264,.4121,.0601374,.206679,-.106499,.421425,.0680078,.214865,-.115654,.431504,.076919,.224406,-.125268,.442526,.0868835,.235876,-.135475,.455465,.0981875,.248335,-.146023,.4681,.110759,.262868,-.157016,.482069,.124885,.278962,-.168245,.496182,.140645,.295082,-.17958,.507401,.157838,.313738,-.191227,.520252,.17695,.333573,-.202718,.531708,.197817,.356433,-.214424,.544509,.220785,.378853,-.225492,.55373,.245306,.402717,-.236236,.561348,.271593,.428375,-.246568,.568538,.299776,.454724,-.255941,.573462,.329433,.482291,-.264511,.576356,.360598,.509706,-.272129,.576446,.393204,.538805,-.278979,.575298,.427227,.568919,-.284528,.572154,.462157,.596804,-.288801,.564691,.497997,.625987,-.291334,.555134,.534467,.656414,-.292722,.545051,.571736,.683916,-.292185,.528813,.610158,.711809,-.290043,.51106,.649061,.739547,-.285246,.490103,.690081,.766914,-.277647,.465523,.732554,.791375,-.267603,.437718,.773982,.814772,-.256109,.40882,.81609,.836691,-.242281,.377823,.856849,.856984,-.227155,.34496,.898363,.876332,-.210395,.311335,.939471,.894988,-.192612,.277703,.980799,.911113,-.173236,.243019,1.02215,.924092,-.152258,.209037,1.06139,.936828,-.129575,.175909,1.09635,.946869,-.10594,.143852,1.12707,.958284,-.081318,.110289,1.15419,.972325,-.0556133,.0747232,1.17909,.986878,-.0297899,.0383149,1.20163,.999936,-.00197169,912402e-9,1.22338,.151174,-720365e-11,.351531,309789e-11,.155594,-18279e-8,.361806,78608e-9,.156099,-731569e-9,.362982,314615e-9,.156053,-.00164578,.362869,707845e-9,.156093,-.0029261,.362961,.00125884,.156099,-.00457155,.362959,.00196783,.15612,-.00658224,.362982,.00283622,.156168,-.00895774,.363048,.00386625,.156221,-.0116962,.363101,.00506109,.156324,-.0147973,.363241,.00642675,.156476,-.0182503,.363448,.00797175,.156731,-.0220266,.36384,.00971484,.156994,-.026176,.364179,.0116575,.157341,-.0306701,.36462,.0138207,.157867,-.0354591,.365364,.0162356,.15846,-.0406141,.366111,.0189092,.159308,-.0460519,.367248,.021885,.160426,-.0518096,.368767,.0252004,.161877,-.0578906,.370745,.0288825,.163995,-.0642812,.373831,.0330139,.16655,-.0710067,.377366,.0376283,.170237,-.0781522,.382799,.0428493,.175096,-.0857172,.389915,.0487324,.181069,-.0938025,.398487,.0554214,.188487,-.102363,.408799,.0630189,.197029,-.111343,.419991,.071634,.206684,-.120812,.431455,.0812797,.218698,-.131033,.445746,.0923651,.230726,-.141373,.457471,.104545,.245516,-.152387,.472388,.118449,.261551,-.163628,.486671,.133923,.277437,-.174814,.49762,.150849,.296662,-.186713,.51162,.169924,.31795,-.198513,.525435,.190848,.339422,-.210119,.536267,.213504,.362143,-.221354,.545982,.237947,.387198,-.23224,.555364,.264427,.412349,-.24257,.561489,.292519,.439274,-.252284,.566903,.322561,.466779,-.261023,.569614,.353952,.496011,-.26899,.571589,.387278,.524964,-.275498,.570325,.421356,.556518,-.281449,.568792,.457314,.584363,-.285526,.560268,.493199,.614214,-.28844,.55205,.530276,.645684,-.289777,.541906,.56855,.673446,-.289722,.526464,.606927,.701924,-.287792,.509872,.645945,.73037,-.284315,.490649,.685564,.757405,-.278804,.467964,.726511,.784025,-.269543,.441468,.768601,.808255,-.258117,.41216,.811321,.830739,-.244728,.380606,.853496,.851914,-.229428,.348111,.895374,.872586,-.212508,.314732,.937674,.891581,-.194025,.280338,.979869,.907641,-.174711,.245203,1.02253,.922233,-.153509,.21077,1.06371,.935878,-.130418,.177399,1.09972,.946338,-.105558,.144507,1.13124,.957265,-.080059,.110508,1.15973,.971668,-.0539766,.0742311,1.18515,.9866,-.0277101,.0375224,1.20858,1.00021,-515531e-9,135226e-9,1.23135,.137468,-686011e-11,.345041,273315e-11,.13703,-173378e-9,.343936,690761e-10,.136986,-693048e-9,.34383,276126e-9,.136964,-.00155931,.343761,621337e-9,.137003,-.00277211,.343863,.00110494,.137012,-.00433103,.343868,.00172744,.137043,-.00623606,.343916,.00249022,.13709,-.0084868,.343986,.00339559,.137145,-.0110814,.344045,.00444687,.137242,-.0140187,.344177,.00565007,.137431,-.0172713,.344491,.00701868,.137644,-.0208605,.344805,.00856042,.13791,-.024792,.345172,.0102863,.138295,-.0290461,.345734,.0122185,.138764,-.0335957,.346371,.0143771,.139415,-.038467,.347298,.0167894,.140272,-.0436176,.348527,.0194895,.141457,-.0491016,.350276,.0225043,.14303,-.0548764,.352646,.0258962,.145289,-.0610096,.356206,.0297168,.148502,-.0674777,.361488,.0340562,.152188,-.074345,.367103,.0389534,.157359,-.0817442,.375247,.0445541,.16379,-.0896334,.385064,.0509535,.171376,-.098005,.396082,.0582611,.179901,-.106817,.407418,.06654,.189892,-.116239,.420031,.075994,.201838,-.12627,.434321,.0867239,.214311,-.136701,.447631,.0987517,.228902,-.147616,.462046,.112353,.245107,-.158871,.476942,.127605,.262292,-.170261,.490285,.144469,.281215,-.182017,.503783,.163282,.301058,-.193729,.515505,.183873,.322752,-.205512,.52682,.206466,.347547,-.217214,.539473,.231194,.370969,-.227966,.546625,.257288,.397533,-.238555,.55472,.285789,.42398,-.248278,.559468,.315746,.452928,-.257422,.564095,.347724,.482121,-.265306,.565426,.380922,.510438,-.272043,.563205,.415639,.541188,-.277614,.561087,.451702,.571667,-.281927,.554922,.48845,.602432,-.285015,.546838,.526442,.634126,-.286512,.537415,.564896,.662816,-.286388,.522906,.604037,.692411,-.284734,.507003,.643795,.720946,-.281297,.488398,.68298,.748293,-.276262,.466353,.723466,.776931,-.269978,.443573,.764565,.801065,-.260305,.415279,.805838,.825843,-.247426,.384773,.849985,.84807,-.232437,.352555,.893174,.869122,-.215806,.318642,.936564,.888963,-.197307,.28381,.980253,.905547,-.177203,.247888,1.02463,.918554,-.155542,.212904,1.06714,.931395,-.131948,.1787,1.10451,.941749,-.106723,.145902,1.13694,.954551,-.0804939,.111193,1.1666,.970279,-.0534239,.0744697,1.19249,.986117,-.0257452,.0368788,1.21665,.999938,.00190634,-.0010291,1.23981,.118493,-647439e-11,.32272,23772e-10,.118765,-163023e-9,.323456,598573e-10,.118772,-65212e-8,.323477,239447e-9,.118843,-.00146741,.323657,538881e-9,.118804,-.00260846,.323553,95826e-8,.118826,-.00407576,.323595,.00149845,.118846,-.00586826,.323617,.00216047,.118886,-.00798578,.32367,.00294679,.118947,-.0104273,.323753,.00386124,.119055,-.0131909,.323922,.00490999,.119241,-.0162444,.324251,.00610804,.11944,-.0196339,.324544,.00745805,.119739,-.0233378,.325026,.00897805,.12011,-.0273179,.325586,.0106895,.120571,-.0316143,.326231,.0126073,.12124,-.0361939,.327264,.0147654,.122162,-.0410511,.328733,.0172001,.123378,-.0462233,.330659,.0199375,.125183,-.0517109,.333754,.0230498,.127832,-.0575652,.338507,.026597,.130909,-.0637441,.343666,.0306345,.135221,-.0704302,.351063,.035273,.14082,-.0776364,.360604,.0406137,.146781,-.0852293,.369638,.0466788,.155121,-.0935351,.3827,.0537628,.16398,-.102234,.39522,.0617985,.173926,-.111465,.40793,.07097,.185137,-.121296,.42105,.0813426,.19826,-.13169,.435735,.0931596,.212938,-.142614,.450932,.106547,.229046,-.153884,.465726,.121575,.246246,-.165382,.479461,.138286,.264637,-.176806,.492106,.15666,.284959,-.188793,.504774,.17728,.308157,-.200763,.518805,.19988,.330951,-.21239,.528231,.224293,.3549,-.223521,.536376,.250541,.381502,-.234169,.544846,.278902,.409529,-.244077,.551717,.309227,.437523,-.253363,.55517,.341426,.467624,-.261659,.557772,.37518,.497268,-.268498,.556442,.41007,.528294,-.274018,.553915,.446445,.559053,-.278169,.549153,.483779,.589329,-.281229,.539878,.522249,.622503,-.282902,.53162,.561754,.652382,-.282815,.518119,.601544,.681847,-.281247,.502187,.641574,.712285,-.277986,.484824,.682633,.740094,-.273017,.463483,.723426,.768478,-.266692,.441299,.763747,.794556,-.258358,.415238,.805565,.819408,-.248807,.386912,.847254,.843411,-.236214,.356165,.891091,.862397,-.219794,.320562,.936174,.883113,-.201768,.285322,.982562,.90023,-.181672,.249713,1.02862,.915192,-.159279,.214546,1.07163,.928458,-.134725,.180285,1.10995,.94069,-.10913,.147119,1.14354,.953409,-.0821315,.112492,1.17372,.969537,-.0542677,.0752014,1.20043,.985612,-.0259096,.0370361,1.22528,.999835,.00298198,-.00151801,1.24959,.10097,-602574e-11,.300277,202619e-11,.101577,-152164e-9,.302077,511662e-10,.101572,-608889e-9,.302066,204751e-9,.101566,-.00136997,.302047,460753e-9,.101592,-.00243557,.302114,819497e-9,.101608,-.0038053,.30214,.00128154,.101627,-.00547906,.30216,.0018483,.101669,-.00745647,.302224,.00252223,.101732,-.00973615,.302318,.00330716,.101844,-.0123097,.302513,.00421061,.102025,-.0151681,.30285,.00524481,.102224,-.0183334,.303166,.0064154,.102515,-.0217819,.303654,.00774063,.102886,-.0255067,.304243,.0092398,.103395,-.029514,.305089,.0109339,.104109,-.0337912,.306301,.0128561,.105074,-.0383565,.30798,.0150338,.10654,-.0432132,.310726,.0175228,.108478,-.0484244,.314351,.0203648,.111015,-.0539339,.319032,.0236325,.114682,-.0598885,.32605,.0274188,.11911,-.0663375,.334109,.0317905,.124736,-.0733011,.344013,.0368502,.131479,-.0807744,.355358,.0427104,.139283,-.0888204,.367614,.0494788,.148054,-.0973394,.380072,.0572367,.159037,-.10665,.395678,.0662704,.169794,-.116221,.40795,.0763192,.18314,-.126632,.423546,.087956,.197515,-.137383,.438213,.101042,.213514,-.148641,.453248,.115827,.23065,-.160117,.46688,.132283,.249148,-.171807,.479962,.150644,.270219,-.183695,.494618,.171073,.292338,-.195574,.506937,.193378,.314999,-.207205,.516463,.217585,.340991,-.218955,.528123,.24428,.367982,-.229917,.537025,.272784,.39432,-.239737,.541627,.302742,.423364,-.249048,.546466,.335112,.453751,-.257329,.549466,.369032,.48416,-.264623,.549503,.404577,.515262,-.270411,.547008,.441337,.547036,-.274581,.542249,.479162,.576614,-.277266,.533015,.517904,.611143,-.279144,.525512,.558508,.640989,-.279001,.51154,.598995,.671182,-.277324,.495641,.639935,.700848,-.273908,.477526,.681017,.729862,-.269063,.457955,.722764,.758273,-.262282,.434846,.764349,.784121,-.254281,.409203,.806206,.809798,-.24505,.382694,.848617,.834953,-.233861,.354034,.892445,.856817,-.221308,.321764,.936263,.877609,-.205996,.288118,.982401,.897489,-.186702,.253277,1.02975,.913792,-.164618,.217963,1.07488,.92785,-.140023,.183221,1.11487,.940378,-.11328,.149385,1.14947,.95273,-.0853958,.114152,1.1807,.969059,-.0568698,.0769845,1.20912,.985574,-.0276502,.0381186,1.23498,.999943,.00239052,-.00126861,1.25987,.0852715,-560067e-11,.279021,171162e-11,.0854143,-140871e-9,.279483,430516e-10,.0854191,-563385e-9,.2795,172184e-9,.0854188,-.00126753,.279493,387464e-9,.0854229,-.00225337,.279501,68918e-8,.0854443,-.00352086,.279549,.00107803,.0854697,-.00506962,.279591,.00155536,.0855093,-.00689873,.279652,.00212354,.0855724,-.00900821,.279752,.00278703,.0856991,-.0113799,.280011,.0035551,.085855,-.0140314,.280297,.00443449,.0860682,-.016963,.280682,.00543636,.086344,-.0201438,.281159,.0065788,.0867426,-.0235999,.281886,.00787977,.087239,-.0273069,.282745,.0093606,.0879815,-.031269,.284139,.011056,.0891258,-.035531,.28647,.0130065,.0906909,-.0400947,.289708,.0152495,.0927624,-.0449638,.293904,.0178454,.0958376,-.0502427,.300471,.0208915,.0995827,-.0559514,.30806,.0244247,.104526,-.0622152,.317874,.0285721,.110532,-.0690046,.329332,.0334227,.117385,-.0763068,.341217,.0390466,.12522,-.084184,.353968,.0455786,.134037,-.0925248,.366797,.0530773,.144014,-.101487,.380209,.0617424,.156013,-.111273,.395956,.071777,.168872,-.121431,.41053,.0830905,.183089,-.132105,.425073,.0959341,.198763,-.143286,.439833,.110448,.216159,-.154841,.454507,.126769,.234859,-.166588,.468368,.14495,.255879,-.178626,.482846,.165233,.27677,-.190218,.493489,.187217,.301184,-.202227,.506549,.211659,.325852,-.213764,.5158,.237922,.352824,-.22487,.525442,.26632,.380882,-.235246,.532487,.296691,.410137,-.244847,.537703,.329179,.439787,-.253122,.540361,.363135,.472291,-.260517,.542734,.399222,.501856,-.266519,.538826,.436352,.534816,-.270905,.535152,.474505,.565069,-.273826,.525979,.513988,.597154,-.275333,.516394,.554852,.630473,-.275314,.506206,.596592,.660574,-.273323,.489769,.638117,.692015,-.270008,.472578,.680457,.720647,-.265001,.452134,.723008,.750528,-.258311,.430344,.765954,.777568,-.250046,.405624,.809012,.80387,-.240114,.378339,.852425,.828439,-.228737,.349877,.895346,.851472,-.216632,.318968,.940695,.873906,-.202782,.287489,.987235,.89467,-.187059,.254394,1.03348,.912281,-.168818,.221294,1.07812,.927358,-.146494,.18675,1.11928,.940385,-.120009,.152322,1.15609,.952672,-.0917183,.117514,1.18875,.968496,-.0620321,.0797405,1.21821,.985236,-.0314945,.0402383,1.24523,.99998,-575153e-9,110644e-9,1.27133,.0702429,-512222e-11,.255273,140947e-11,.0702981,-128826e-9,.255469,354488e-10,.0703691,-515562e-9,.255727,141874e-9,.0703805,-.00116,.255754,31929e-8,.0703961,-.00206224,.255813,567999e-9,.0704102,-.00322223,.255839,88871e-8,.0704298,-.00463928,.255863,.00128272,.0704759,-.00631375,.255953,.00175283,.0705434,-.00824317,.256079,.00230342,.0706693,-.010412,.25636,.0029443,.0708189,-.0128439,.256647,.00368031,.0710364,-.0155177,.257084,.00452614,.0713223,-.0184374,.257637,.00549706,.0717182,-.0216002,.258416,.00661246,.072321,-.0249966,.259699,.00790147,.0731446,-.0286566,.261475,.0093884,.0743352,-.0325888,.264132,.0111186,.0760676,-.036843,.26815,.013145,.078454,-.0414292,.273636,.0155251,.0818618,-.0464634,.281653,.0183525,.0857382,-.0519478,.289992,.0216642,.0908131,-.0579836,.30066,.0255956,.0967512,-.0645124,.312204,.0301954,.103717,-.0716505,.325001,.0356017,.111596,-.0793232,.338129,.041896,.120933,-.087645,.352853,.0492447,.130787,-.096492,.366192,.0576749,.142311,-.105973,.380864,.0673969,.155344,-.116182,.396575,.0785899,.169535,-.126815,.411443,.0912377,.185173,-.138015,.426256,.105607,.201755,-.149325,.439607,.121551,.221334,-.161207,.455467,.139608,.241461,-.173162,.469096,.159591,.26294,-.18504,.481014,.18156,.286776,-.196881,.493291,.205781,.311596,-.208311,.503556,.231819,.338667,-.219671,.513268,.260274,.366021,-.230451,.519414,.290862,.395875,-.240131,.526766,.323196,.425564,-.248566,.52905,.357071,.457094,-.256195,.530796,.393262,.488286,-.262331,.528703,.430797,.522291,-.267141,.52727,.470231,.554172,-.270411,.519848,.510477,.586427,-.271986,.510307,.551594,.619638,-.27192,.499158,.593849,.650656,-.269817,.483852,.636314,.68284,-.266267,.467515,.679679,.714356,-.26113,.44931,.723884,.742717,-.254067,.425789,.767245,.770894,-.245652,.401144,.811819,.797358,-.235554,.374224,.856315,.823377,-.223896,.346167,.901077,.847456,-.210865,.316056,.946502,.870697,-.196574,.284503,.993711,.891068,-.180814,.251628,1.04134,.909267,-.163314,.219065,1.08609,.925653,-.143304,.186446,1.12702,.940017,-.121322,.153416,1.16371,.952398,-.0973872,.120334,1.19712,.967568,-.0698785,.08352,1.22791,.984772,-.0390031,.0439209,1.25672,1.00026,-.0070087,.00315668,1.28428,.0556653,-459654e-11,.227325,112556e-11,.0565238,-116382e-9,.230826,284985e-10,.0565717,-465666e-9,.231026,114036e-9,.0565859,-.00104773,.231079,256656e-9,.0565761,-.00186255,.231025,45663e-8,.0565913,-.00291002,.231058,714664e-9,.0566108,-.00418998,.231085,.00103224,.0566532,-.00570206,.231169,.00141202,.0567473,-.00743666,.231417,.00186018,.0568567,-.00940298,.231661,.00238264,.0569859,-.0115991,.231895,.00298699,.0572221,-.0140096,.232456,.00368957,.057519,-.0166508,.233096,.00450303,.0579534,-.01951,.234094,.00544945,.0585922,-.0225991,.235629,.00655564,.0595647,-.0259416,.238106,.00785724,.0609109,-.0295661,.241557,.00939127,.0628751,-.0335126,.246652,.0112198,.0656908,-.0378604,.254091,.0134168,.0691347,-.0426543,.262666,.0160374,.0732165,-.0478967,.272029,.0191514,.0782863,-.0536716,.283007,.0228597,.0843973,-.0600683,.295732,.0272829,.0913598,-.0670095,.308779,.032484,.0994407,-.0745516,.322886,.0385886,.108189,-.082712,.336408,.0457133,.118574,-.0914927,.351692,.0539832,.129989,-.100854,.366502,.0635162,.142722,-.110837,.381675,.0744386,.156654,-.121353,.3963,.0868483,.172151,-.132414,.411477,.100963,.188712,-.143809,.42508,.116795,.208093,-.155765,.441328,.134715,.227936,-.167608,.454328,.154396,.249495,-.179579,.467235,.176179,.27362,-.191488,.480248,.200193,.296371,-.202618,.487886,.225775,.324234,-.214133,.499632,.25441,.353049,-.225212,.509532,.285077,.381785,-.234875,.514265,.317047,.414038,-.244205,.521282,.351874,.445251,-.252145,.522931,.388279,.476819,-.258433,.520947,.425825,.509209,-.263411,.517669,.465104,.542759,-.266732,.512841,.505741,.574822,-.268263,.503317,.547611,.609324,-.268489,.493035,.590953,.641772,-.266941,.478816,.63488,.674049,-.263297,.462863,.679072,.705071,-.257618,.442931,.723487,.734709,-.250625,.421299,.768708,.763704,-.24179,.397085,.814375,.791818,-.231115,.370577,.859907,.817439,-.21922,.34232,.906715,.843202,-.205658,.312627,.953943,.866639,-.190563,.280933,1.00185,.888129,-.173978,.248393,1.05105,.907239,-.155485,.216007,1.09704,.923893,-.134782,.183233,1.13857,.938882,-.11249,.150376,1.17539,.952464,-.0890706,.117177,1.20924,.968529,-.0646523,.0813095,1.24055,.984763,-.038606,.0439378,1.27018,1.00053,-.01238,.00598668,1.29873,.0437928,-409594e-11,.204012,8.79224e-7,.0440166,-103395e-9,.205049,221946e-10,.0440529,-413633e-9,.205225,887981e-10,.0440493,-930594e-9,.2052,199858e-9,.0439884,-.00165352,.204901,355495e-9,.0440716,-.0025849,.205255,556983e-9,.0440968,-.00372222,.205311,805326e-9,.0441359,-.00506478,.205391,.00110333,.0442231,-.00660384,.205638,.00145768,.0443254,-.00835246,.205877,.00187275,.0444832,-.0102992,.20627,.00235938,.0447001,-.0124449,.206796,.0029299,.0450168,-.0147935,.207593,.0036005,.0454816,-.017336,.208819,.00439246,.0462446,-.0201156,.211036,.00533864,.0473694,-.0231568,.214388,.00646984,.0490191,-.0264941,.219357,.00783856,.0512776,-.030184,.226061,.00950182,.0541279,-.0342661,.234094,.0115156,.0578989,-.0388539,.244297,.0139687,.0620835,-.0438735,.254457,.0169015,.0673497,-.04951,.266706,.0204554,.0731759,-.0556263,.278753,.0246606,.0803937,-.0624585,.29309,.0297126,.0879287,-.0697556,.305856,.0355868,.0970669,-.0778795,.321059,.0425768,.106508,-.0863541,.333873,.05056,.11776,-.0955935,.349008,.0598972,.130081,-.105438,.363776,.0706314,.144454,-.115899,.380112,.0828822,.1596,-.126827,.394843,.0967611,.176097,-.138161,.409033,.112381,.194726,-.149904,.424257,.129952,.213944,-.161675,.436945,.149333,.235516,-.173659,.450176,.170892,.260564,-.185963,.466305,.194984,.285183,-.197582,.477328,.220805,.311095,-.208697,.486566,.248694,.338924,-.219519,.494811,.279015,.369757,-.229766,.504065,.311725,.3996,-.238879,.507909,.345844,.430484,-.246802,.509805,.381749,.46413,-.253924,.511436,.420251,.497077,-.259319,.508787,.459957,.530434,-.263297,.50394,.501356,.565725,-.265619,.49804,.544252,.599254,-.265842,.487346,.587856,.631251,-.263978,.472975,.631969,.663972,-.26043,.457135,.677471,.697724,-.255358,.439844,.723744,.727725,-.248308,.417872,.770653,.756417,-.239181,.39273,.817357,.785419,-.22814,.367839,.864221,.81266,-.215681,.339449,.912701,.839391,-.201623,.309279,.962419,.86366,-.185624,.278029,1.0122,.885028,-.16797,.245294,1.06186,.904639,-.148336,.212689,1.10934,.922048,-.12637,.179616,1.15063,.936952,-.102928,.146749,1.18885,.951895,-.0785268,.112733,1.22352,.967198,-.0530153,.0760056,1.25681,.984405,-.02649,.0383183,1.28762,1.00021,70019e-8,-20039e-8,1.31656,.0325964,-355447e-11,.176706,6.55682e-7,.0329333,-899174e-10,.178527,165869e-10,.0329181,-359637e-9,.178453,663498e-10,.0329085,-808991e-9,.178383,149332e-9,.0329181,-.00143826,.178394,265873e-9,.0329425,-.00224678,.178517,416597e-9,.0329511,-.00323575,.17849,603299e-9,.033011,-.00439875,.178695,829422e-9,.0330733,-.00574059,.178843,.00109908,.0331857,-.00725896,.179176,.00141933,.0333445,-.00895289,.179618,.0017999,.0335674,-.0108219,.180238,.00225316,.033939,-.0128687,.181417,.00279765,.0345239,-.015114,.183395,.0034564,.0354458,-.017596,.186616,.00425864,.0368313,-.0203524,.191547,.00524936,.0386115,-.0234105,.197508,.00647033,.0410303,-.0268509,.205395,.00798121,.0442245,-.0307481,.215365,.0098557,.0478659,-.0350863,.225595,.0121417,.0522416,-.0399506,.236946,.0149385,.0574513,-.045357,.249442,.0183189,.0631208,-.0512863,.261222,.0223644,.0701124,-.0579273,.275418,.0272418,.0777331,-.0650652,.288989,.0329458,.0862709,-.0728813,.302546,.0396819,.096103,-.081363,.317164,.04757,.106976,-.0904463,.331733,.0567012,.119175,-.100105,.34661,.067202,.132919,-.110375,.362249,.0792588,.147727,-.121115,.376978,.0928672,.163618,-.132299,.390681,.108228,.182234,-.143887,.406571,.125502,.201809,-.155827,.42042,.144836,.225041,-.168357,.438411,.166706,.247621,-.18004,.450368,.189909,.27097,-.191536,.460083,.215251,.296658,-.203024,.469765,.243164,.325892,-.214056,.481837,.273388,.35406,-.224104,.487474,.305344,.384372,-.233489,.492773,.339741,.41749,-.241874,.498451,.376287,.45013,-.248834,.499632,.414195,.481285,-.254658,.495233,.454077,.519183,-.259367,.496401,.496352,.551544,-.261818,.487686,.538798,.587349,-.262964,.479453,.583626,.621679,-.262128,.467709,.629451,.654991,-.258998,.452123,.67566,.686873,-.254119,.433495,.723248,.719801,-.246946,.413657,.771156,.750355,-.237709,.390366,.81989,.780033,-.226549,.364947,.868601,.809254,-.214186,.337256,.920034,.836576,-.199639,.307395,.971706,.861774,-.183169,.275431,1.02479,.885707,-.165111,.243431,1.07837,.904742,-.144363,.210921,1.12783,.915604,-.121305,.17647,1.17254,.930959,-.0962119,.143106,1.21012,.948404,-.069969,.108112,1.24474,.967012,-.0427586,.0708478,1.27718,.984183,-.0147043,.032335,1.3083,.999577,.0142165,-.00726867,1.3382,.0229227,-299799e-11,.148623,4.62391e-7,.0232194,-758796e-10,.15054,117033e-10,.0232315,-303636e-9,.15063,468397e-10,.0232354,-683189e-9,.150624,105472e-9,.0232092,-.0012136,.150445,187744e-9,.0232523,-.00189765,.150679,294847e-9,.0232828,-.00273247,.150789,428013e-9,.0233371,-.00371287,.150995,591134e-9,.0234015,-.00484794,.15118,787642e-9,.023514,-.00612877,.151562,.00102547,.023679,-.00756125,.152116,.00131351,.0239559,-.00914651,.153162,.00166594,.0244334,-.010904,.155133,.00210182,.025139,-.0128615,.158035,.00264406,.0262598,-.0150628,.162751,.00332923,.0277875,-.0175532,.168944,.00419773,.0298472,-.0203981,.176835,.00530034,.0325444,-.023655,.186686,.00669777,.0355581,-.0272982,.196248,.00842661,.0392841,-.0314457,.207352,.0105854,.0436815,-.0361157,.219279,.0132458,.0485272,-.0412932,.230728,.0164736,.0541574,-.0470337,.242994,.0203715,.0609479,-.0535002,.257042,.0250953,.0685228,-.0605409,.27102,.0306856,.0768042,-.0680553,.28406,.037193,.0864844,-.0765011,.299186,.0449795,.0969415,-.0852674,.3132,.0538316,.108478,-.0947333,.327138,.0641149,.121705,-.10481,.342345,.0759185,.136743,-.115474,.358472,.0894116,.152986,-.126536,.374067,.104562,.170397,-.138061,.388267,.121632,.191392,-.150203,.406467,.140996,.211566,-.161751,.418641,.161696,.233567,-.173407,.430418,.184557,.257769,-.185397,.44277,.210092,.28531,-.197048,.457191,.237827,.311726,-.20784,.464712,.267253,.340537,-.218345,.472539,.299332,.372921,-.228306,.482331,.333988,.402924,-.236665,.484378,.369722,.434475,-.244097,.484717,.407836,.469736,-.250547,.487093,.448465,.505045,-.25511,.485575,.490263,.540262,-.258444,.481225,.534495,.576347,-.259903,.473481,.579451,.608656,-.259572,.4603,.625604,.646679,-.257908,.450341,.674511,.679902,-.253663,.431561,.723269,.714159,-.247419,.412684,.773263,.745345,-.239122,.389388,.824182,.778248,-.228837,.365361,.876634,.807208,-.216197,.337667,.92945,.835019,-.201772,.307197,.985261,.860261,-.185291,.274205,1.04299,.877601,-.165809,.240178,1.09816,.898211,-.143897,.207571,1.14694,.915789,-.119513,.174904,1.19008,.931831,-.0932919,.141423,1.2297,.949244,-.0656528,.105603,1.26553,.967527,-.0370262,.0679551,1.29986,.984139,-.00730117,.0283133,1.33252,.999713,.0234648,-.0121785,1.36397,.0152135,-245447e-11,.122795,3.04092e-7,.0151652,-615778e-10,.122399,76292e-10,.0151181,-245948e-9,.122023,304802e-10,.0151203,-553394e-9,.12203,686634e-10,.015125,-983841e-9,.122037,122463e-9,.0151427,-.00153774,.12214,192706e-9,.0151708,-.0022103,.122237,281219e-9,.0152115,-.00300741,.12238,390804e-9,.0152877,-.00392494,.1227,526317e-9,.015412,-.00496597,.123244,69443e-8,.0156201,-.00613314,.124228,90547e-8,.0159658,-.00744113,.125945,.0011732,.0165674,-.00892546,.129098,.00151888,.017487,-.010627,.133865,.00197007,.018839,-.0126043,.140682,.0025637,.020554,-.0148814,.148534,.00333637,.0226727,-.0175123,.157381,.00433738,.0251879,-.0205266,.166685,.00561664,.0283635,-.0240319,.177796,.00725563,.0318694,-.0279432,.188251,.00928811,.0361044,-.0324313,.200038,.011835,.0406656,-.0373527,.210685,.0149146,.0463846,-.0430132,.224182,.0187254,.0525696,-.0491013,.23634,.0232283,.0598083,-.0559175,.250013,.0286521,.0679437,-.0633657,.263981,.0350634,.0771181,-.0714602,.278072,.0425882,.0881273,-.0803502,.29511,.0514487,.0996628,-.0896903,.309976,.0615766,.112702,-.099644,.325611,.0732139,.126488,-.109829,.339321,.0862324,.142625,-.120859,.35574,.101275,.15953,-.131956,.369845,.117892,.176991,-.143145,.38146,.136205,.199715,-.155292,.40052,.157252,.220787,-.167066,.412055,.179966,.243697,-.178396,.423133,.204418,.272106,-.190433,.439524,.232141,.297637,-.201265,.447041,.261109,.325273,-.211834,.454488,.292627,.357219,-.221889,.465004,.326669,.387362,-.230729,.468527,.362426,.423131,-.23924,.475836,.401533,.45543,-.246067,.475017,.441902,.493393,-.251557,.478017,.484239,.526253,-.255571,.4709,.528586,.560554,-.257752,.463167,.574346,.599306,-.258076,.456452,.621655,.634541,-.256471,.443725,.670492,.668907,-.253283,.428719,.721943,.705619,-.247562,.411348,.772477,.739034,-.240626,.388939,.8264,.771408,-.231493,.36425,.881702,.803312,-.220125,.337321,.9385,.828457,-.206645,.305364,.997437,.854819,-.190664,.273715,1.05693,.878666,-.171429,.242218,1.11251,.898404,-.149235,.209556,1.16398,.917416,-.12435,.176863,1.21014,.933133,-.0972703,.142775,1.25178,.95066,-.0683607,.106735,1.29028,.968589,-.0378724,.0681609,1.32703,.984776,-.00605712,.0273966,1.36158,.99994,.0263276,-.0138124,1.3943,.00867437,-186005e-11,.0928979,1.73682e-7,.00864003,-466389e-10,.0925237,435505e-11,.00864593,-186594e-9,.0925806,174322e-10,.00864095,-419639e-9,.0924903,392862e-10,.00863851,-746272e-9,.0924589,702598e-10,.00868531,-.00116456,.0929,111188e-9,.00869667,-.00167711,.0928529,163867e-9,.00874332,-.00228051,.0930914,23104e-8,.00882709,-.00297864,.0935679,31741e-8,.00898874,-.00377557,.0946165,430186e-9,.00929346,-.00469247,.0967406,580383e-9,.00978271,-.00575491,.100084,783529e-9,.0105746,-.00701514,.105447,.00106304,.0116949,-.00851797,.112494,.00144685,.0130419,-.0102757,.119876,.00196439,.0148375,-.012381,.129034,.00266433,.0168725,-.01482,.137812,.00358364,.0193689,-.0176563,.147696,.00478132,.0222691,-.0209211,.157795,.00631721,.0256891,-.0246655,.168431,.00826346,.0294686,-.0288597,.178587,.0106714,.0340412,-.0336441,.190251,.0136629,.0393918,-.039033,.202999,.0173272,.0453947,-.0450087,.215655,.0217448,.0521936,-.0515461,.228686,.0269941,.0600279,-.058817,.242838,.033272,.0692398,-.0667228,.258145,.0406457,.0793832,-.0752401,.273565,.0492239,.0902297,-.0841851,.287735,.0590105,.102014,-.0936479,.301161,.0702021,.116054,-.103967,.317438,.0832001,.13191,-.114622,.334166,.0977951,.148239,-.125452,.348192,.113985,.165809,-.136453,.361094,.131928,.184616,-.147648,.373534,.151811,.207491,-.159607,.39101,.174476,.230106,-.171119,.402504,.198798,.257036,-.182906,.418032,.225796,.281172,-.193605,.425468,.254027,.312034,-.204771,.440379,.285713,.340402,-.214988,.445406,.319196,.370231,-.224711,.44968,.35537,.407105,-.233516,.460747,.393838,.439037,-.240801,.460624,.433747,.47781,-.24762,.465957,.477234,.510655,-.251823,.460054,.52044,.550584,-.255552,.459172,.567853,.585872,-.257036,.450311,.615943,.620466,-.257535,.437763,.667693,.660496,-.255248,.426639,.718988,.695578,-.251141,.409185,.772503,.732176,-.244718,.39015,.827023,.760782,-.236782,.362594,.885651,.79422,-.225923,.33711,.943756,.824521,-.213855,.308272,1.00874,.854964,-.197723,.278529,1.06764,.878065,-.179209,.246208,1.12836,.899834,-.157569,.21329,1.18318,.918815,-.133206,.181038,1.23161,.934934,-.106545,.146993,1.27644,.952115,-.0780574,.111175,1.31842,.96906,-.0478279,.0728553,1.35839,.985178,-.0160014,.032579,1.39697,1.00039,.0173126,-.0095256,1.43312,.00384146,-124311e-11,.0613583,7.78271e-8,.00390023,-314043e-10,.0622919,196626e-11,.00389971,-125622e-9,.0622632,787379e-11,.00389491,-282352e-9,.0620659,1778e-8,.00391618,-502512e-9,.0624687,320918e-10,.00392662,-784458e-9,.0625113,515573e-10,.00396053,-.00112907,.0628175,778668e-10,.00401911,-.00153821,.0633286,113811e-9,.00414994,-.0020208,.0646443,16445e-8,.00441223,-.00260007,.0673886,237734e-9,.00484427,-.0033097,.0716528,345929e-9,.00549109,-.00418966,.0774998,505987e-9,.00636293,-.00527331,.0844758,739208e-9,.00746566,-.00660428,.0921325,.00107347,.00876625,-.00818826,.0997067,.00153691,.0103125,-.0100811,.107433,.00217153,.0123309,-.0123643,.117088,.00303427,.0146274,-.0150007,.126438,.00416018,.0172295,-.0180531,.135672,.00561513,.0204248,-.0215962,.146244,.007478,.0241597,-.0256234,.157481,.00981046,.0284693,-.0302209,.169125,.0127148,.033445,-.0353333,.181659,.0162453,.0391251,-.0410845,.1944,.0205417,.0454721,-.0473451,.207082,.0256333,.0530983,-.0542858,.221656,.0317036,.0615356,-.0618384,.236036,.0388319,.0703363,-.0697631,.248398,.046974,.0810391,-.0784757,.263611,.0565246,.0920144,-.0873488,.275857,.0671724,.105584,-.0973652,.292555,.0798105,.119506,-.107271,.306333,.0935945,.134434,-.117608,.318888,.109106,.153399,-.128938,.337552,.127074,.171258,-.139944,.349955,.14643,.191059,-.151288,.361545,.168,.215069,-.163018,.378421,.192082,.237838,-.174226,.38879,.217838,.266965,-.186063,.405857,.246931,.292827,-.196909,.414146,.277505,.324352,-.207473,.426955,.310711,.354427,-.217713,.433429,.346794,.389854,-.227183,.443966,.385237,.420749,-.235131,.44471,.424955,.459597,-.242786,.451729,.468446,.495316,-.248767,.45072,.513422,.534903,-.253351,.450924,.560618,.572369,-.256277,.445266,.609677,.612383,-.2576,.438798,.660995,.644037,-.256931,.421693,.713807,.686749,-.254036,.4109,.767616,.719814,-.249785,.390151,.82533,.754719,-.244283,.367847,.888311,.792022,-.235076,.345013,.948177,.822404,-.225061,.316193,1.01661,.853084,-.211113,.287013,1.08075,.879871,-.19449,.255424,1.14501,.901655,-.174023,.222879,1.20203,.919957,-.1509,.18989,1.25698,.938412,-.124923,.15606,1.30588,.953471,-.0968139,.120512,1.3529,.970451,-.066734,.0828515,1.3986,.985522,-.034734,.0424458,1.44148,1.00099,-.00102222,678929e-9,1.48398,965494e-9,-6.27338e-7,.0306409,1.97672e-8,99168e-8,-158573e-10,.0314638,4.99803e-7,991068e-9,-634012e-10,.031363,200682e-11,974567e-9,-14144e-8,.03036,457312e-11,998079e-9,-252812e-9,.031496,860131e-11,.00102243,-396506e-9,.0319955,148288e-10,.00107877,-577593e-9,.0331376,249141e-10,.00121622,-816816e-9,.0359396,423011e-10,.0014455,-.00113761,.0399652,724613e-10,.00178791,-.00156959,.0450556,123929e-9,.00225668,-.00214064,.0508025,208531e-9,.00285627,-.00287655,.0568443,341969e-9,.0035991,-.00380271,.0630892,544158e-9,.00455524,-.00496264,.0702204,842423e-9,.00569143,-.0063793,.0773426,.00126704,.00716928,-.00813531,.0860839,.00186642,.00885307,-.0101946,.0944079,.00267014,.0109316,-.0126386,.103951,.00374033,.0133704,-.0154876,.113786,.0051304,.0161525,-.0187317,.123477,.00688858,.0194267,-.0224652,.133986,.00910557,.0230967,-.0265976,.143979,.0118074,.0273627,-.0312848,.154645,.0151266,.0323898,-.0365949,.166765,.0191791,.0379225,-.0422914,.177932,.0239236,.0447501,-.0487469,.19167,.0296568,.0519391,-.0556398,.203224,.0362924,.0599464,-.0631646,.215652,.0440585,.0702427,-.0714308,.232089,.0531619,.0806902,-.0800605,.245258,.0634564,.0923194,-.0892815,.258609,.0752481,.106938,-.09931,.276654,.0888914,.121238,-.109575,.289847,.104055,.138817,-.120461,.307566,.121266,.15595,-.131209,.320117,.139944,.178418,-.143049,.339677,.161591,.197875,-.154074,.349886,.184303,.224368,-.166307,.369352,.210669,.252213,-.178051,.386242,.238895,.277321,-.189335,.395294,.269182,.310332,-.200683,.412148,.302508,.338809,-.210856,.418266,.337264,.372678,-.220655,.428723,.374881,.405632,-.230053,.433887,.415656,.442293,-.237993,.439911,.457982,.477256,-.244897,.440175,.502831,.515592,-.250657,.441079,.550277,.550969,-.255459,.435219,.601102,.592883,-.257696,.432882,.651785,.629092,-.259894,.421054,.708961,.672033,-.258592,.41177,.763806,.709147,-.256525,.395267,.824249,.745367,-.254677,.375013,.8951,.784715,-.247892,.353906,.959317,.818107,-.240162,.327801,1.03153,.847895,-.229741,.298821,1.10601,.879603,-.213084,.269115,1.164,.902605,-.195242,.236606,1.22854,.922788,-.174505,.203442,1.29017,.944831,-.150169,.169594,1.34157,.959656,-.124099,.135909,1.3956,.972399,-.0960626,.0990563,1.45128,.986549,-.0657097,.0602348,1.50312,1.00013,-.0333558,.0186694,1.55364,619747e-11,-1e-7,.00778326,796756e-16,2.37499e-8,-9.99999e-8,282592e-10,1.14596e-10,100292e-11,-166369e-11,250354e-9,6.77492e-9,350752e-11,-637769e-11,357289e-9,6.31655e-8,826445e-11,-174689e-10,516179e-9,3.1851e-7,242481e-10,-450868e-10,.0010223,130577e-11,455631e-10,-89044e-9,.00144302,374587e-11,971222e-10,-178311e-9,.00241912,102584e-10,171403e-9,-313976e-9,.00354938,236481e-10,292747e-9,-520026e-9,.00513765,496014e-10,789827e-9,-.00118187,.0238621,139056e-9,.00114093,-.00171827,.0286691,244093e-9,.00176119,-.00249667,.0368565,420623e-9,.0022233,-.00333742,.0400469,65673e-8,.00343382,-.00481976,.0535751,.00109323,.00427602,-.00600755,.057099,.00155268,.00461435,-.00737637,.0551084,.00215031,.00695698,-.00971401,.0715767,.00316529,.00867619,-.0120943,.0793314,.00436995,.0106694,-.0148202,.0869391,.0058959,.0140351,-.0183501,.101572,.00798757,.0168939,-.022006,.11018,.0104233,.020197,-.0261568,.119041,.0134167,.0254702,-.0312778,.135404,.0173009,.0298384,-.0362469,.1437,.0215428,.035159,-.042237,.15512,.0268882,.0427685,-.0488711,.17128,.033235,.0494848,-.0557997,.181813,.0404443,.0592394,-.0635578,.198745,.0490043,.0681463,-.071838,.210497,.0588239,.0804753,-.0809297,.228864,.0702835,.0942205,-.0906488,.247008,.0834012,.106777,-.100216,.258812,.0975952,.124471,-.110827,.278617,.114162,.138389,-.121193,.287049,.131983,.159543,-.13253,.307151,.152541,.176432,-.143611,.31564,.174673,.201723,-.15548,.33538,.199842,.229721,-.167166,.355256,.227097,.250206,-.178238,.360047,.256014,.282118,-.189905,.378761,.28855,.312821,-.201033,.39181,.323348,.341482,-.211584,.397716,.360564,.377368,-.221314,.410141,.400004,.418229,-.230474,.423485,.442371,.444881,-.239443,.418874,.488796,.488899,-.245987,.427545,.535012,.520317,-.253948,.422147,.589678,.568566,-.256616,.42719,.637683,.599607,-.26376,.415114,.703363,.64222,-.268687,.408715,.771363,.685698,-.2694,.399722,.83574,.732327,-.266642,.388651,.897764,.769873,-.267712,.369198,.983312,.806733,-.263479,.346802,1.06222,.843466,-.254575,.321368,1.13477,.873008,-.242749,.29211,1.20712,.908438,-.22725,.262143,1.27465,.936321,-.207621,.228876,1.33203,.950353,-.187932,.19484,1.40439,.96442,-.165154,.163178,1.4732,.979856,-.139302,.127531,1.53574,.982561,-.11134,.0903457,1.59982,.996389,-.0808124,.0489007,1.6577],t=[1,0,0,0,1,791421e-36,0,0,1,104392e-29,0,0,1,349405e-26,0,0,1,109923e-23,0,0,1,947414e-22,0,0,1,359627e-20,0,0,1,772053e-19,0,0,1,108799e-17,0,0,1,110655e-16,0,0,1,865818e-16,0,0,.999998,5.45037e-10,0,0,.999994,2.85095e-9,0,0,.999989,1.26931e-8,0,0,.999973,4.89938e-8,0,0,.999947,1.66347e-7,0,0,.999894,5.02694e-7,0,0,.999798,136532e-11,0,0,.999617,335898e-11,0,0,.999234,752126e-11,0,0,.998258,152586e-10,0,0,.99504,266207e-10,0,0,.980816,236802e-10,0,0,.967553,207684e-11,0,0,.966877,403733e-11,0,0,.965752,741174e-11,0,0,.96382,127746e-10,0,0,.960306,202792e-10,0,0,.953619,280232e-10,0,0,.941103,278816e-10,0,0,.926619,160221e-10,0,0,.920983,235164e-10,0,0,.912293,311924e-10,0,.0158731,.899277,348118e-10,0,.0476191,.880884,26041e-9,0,.0793651,.870399,338726e-10,0,.111111,.856138,392906e-10,0,.142857,.837436,372874e-10,0,.174603,.820973,392558e-10,0,.206349,.803583,434658e-10,0,.238095,.782168,40256e-9,0,.269841,.764107,448159e-10,0,.301587,.743092,457627e-10,0,.333333,.721626,455314e-10,0,.365079,.700375,477335e-10,0,.396825,.677334,461072e-10,0,.428571,.655702,484393e-10,0,.460317,.632059,464583e-10,0,.492064,.610125,483923e-10,0,.52381,.58653,464342e-10,0,.555556,.564508,477033e-10,0,.587302,.541405,459263e-10,0,.619048,.519556,46412e-9,0,.650794,.497292,448913e-10,0,.68254,.475898,445789e-10,0,.714286,.454722,433496e-10,0,.746032,.434042,423054e-10,0,.777778,.414126,413737e-10,0,.809524,.394387,397265e-10,0,.84127,.375841,390709e-10,0,.873016,.357219,369938e-10,0,.904762,.340084,365618e-10,0,.936508,.322714,342533e-10,0,.968254,.306974,339596e-10,0,1,1,101524e-23,0,0,1,10292e-22,0,0,1,130908e-23,0,0,1,473331e-23,0,0,1,625319e-22,0,0,1,107932e-20,0,0,1,163779e-19,0,0,1,203198e-18,0,0,1,204717e-17,0,0,.999999,168995e-16,0,0,.999998,1.15855e-10,0,0,.999996,6.6947e-10,0,0,.999991,3.30863e-9,0,0,.999983,1.41737e-8,0,0,.999968,5.32626e-8,0,0,.99994,1.77431e-7,0,0,.999891,5.28835e-7,0,0,.999797,142169e-11,0,0,.999617,347057e-11,0,0,.999227,77231e-10,0,0,.998239,155753e-10,0,0,.994937,268495e-10,0,0,.980225,213742e-10,0,0,.967549,21631e-10,0,0,.966865,417989e-11,0,0,.965739,763341e-11,0,0,.963794,130892e-10,0,0,.960244,206456e-10,0,0,.953495,282016e-10,0,148105e-9,.940876,271581e-10,0,.002454,.926569,164159e-10,0,.00867491,.920905,239521e-10,0,.01956,.912169,315127e-10,0,.035433,.899095,346626e-10,0,.056294,.882209,290223e-10,0,.0818191,.870272,342992e-10,0,.111259,.855977,394164e-10,0,.142857,.837431,372343e-10,0,.174603,.820826,396691e-10,0,.206349,.803408,435395e-10,0,.238095,.782838,419579e-10,0,.269841,.763941,450953e-10,0,.301587,.742904,455847e-10,0,.333333,.721463,458833e-10,0,.365079,.700197,477159e-10,0,.396825,.677501,470641e-10,0,.428571,.655527,484732e-10,0,.460317,.6324,476834e-10,0,.492064,.609964,484213e-10,0,.52381,.586839,475541e-10,0,.555556,.564353,476951e-10,0,.587302,.541589,467611e-10,0,.619048,.519413,463493e-10,0,.650794,.497337,453994e-10,0,.68254,.475797,445308e-10,0,.714286,.454659,435787e-10,0,.746032,.434065,424839e-10,0,.777778,.414018,41436e-9,0,.809524,.39455,401902e-10,0,.84127,.375742,390813e-10,0,.873016,.357501,377116e-10,0,.904762,.339996,36535e-9,0,.936508,.323069,351265e-10,0,.968254,.306897,339112e-10,0,1,1,10396e-19,0,0,1,104326e-20,0,0,1,110153e-20,0,0,1,144668e-20,0,0,1,34528e-19,0,0,1,175958e-19,0,0,1,12627e-17,0,0,1,936074e-18,0,0,1,645742e-17,0,0,.999998,401228e-16,0,0,.999997,2.22338e-10,0,0,.999995,1.0967e-9,0,0,.999991,4.82132e-9,0,0,.999981,1.89434e-8,0,0,.999967,6.67716e-8,0,0,.999938,2.12066e-7,0,0,.999886,6.0977e-7,0,0,.999792,159504e-11,0,0,.999608,381191e-11,0,0,.999209,833727e-11,0,0,.998179,165288e-10,0,0,.994605,274387e-10,0,0,.979468,167316e-10,0,0,.967529,242877e-11,0,0,.966836,461696e-11,0,0,.96569,830977e-11,0,0,.963706,140427e-10,0,244659e-11,.960063,217353e-10,0,760774e-9,.953113,286606e-10,0,.00367261,.940192,247691e-10,0,.00940263,.927731,195814e-10,0,.018333,.920669,252531e-10,0,.0306825,.911799,324277e-10,0,.0465556,.89857,340982e-10,0,.0659521,.883283,319622e-10,0,.0887677,.86989,35548e-9,0,.114784,.855483,397143e-10,0,.143618,.837987,391665e-10,0,.174606,.820546,411306e-10,0,.206349,.802878,436753e-10,0,.238095,.783402,444e-7,0,.269841,.763439,458726e-10,0,.301587,.742925,467097e-10,0,.333333,.721633,478887e-10,0,.365079,.69985,481251e-10,0,.396825,.67783,491811e-10,0,.428571,.655126,488199e-10,0,.460318,.632697,496025e-10,0,.492064,.609613,48829e-9,0,.52381,.587098,492754e-10,0,.555556,.564119,482625e-10,0,.587302,.541813,482807e-10,0,.619048,.519342,471552e-10,0,.650794,.497514,466765e-10,0,.68254,.475879,455582e-10,0,.714286,.454789,446007e-10,0,.746032,.434217,435382e-10,0,.777778,.414086,421753e-10,0,.809524,.394744,412093e-10,0,.84127,.375782,396634e-10,0,.873016,.357707,386419e-10,0,.904762,.340038,370345e-10,0,.936508,.323284,359725e-10,0,.968254,.306954,3436e-8,0,1,1,599567e-19,0,0,1,600497e-19,0,0,1,614839e-19,0,0,1,686641e-19,0,0,1,972658e-19,0,0,1,221271e-18,0,0,1,833195e-18,0,0,1,403601e-17,0,0,.999999,206001e-16,0,0,.999998,1.01739e-10,0,0,.999997,4.70132e-10,0,0,.999993,2.00436e-9,0,0,.999988,7.83682e-9,0,0,.999979,2.80338e-8,0,0,.999962,9.17033e-8,0,0,.999933,2.74514e-7,0,0,.999881,7.53201e-7,0,0,.999783,189826e-11,0,0,.999594,440279e-11,0,0,.999178,93898e-10,0,0,.998073,181265e-10,0,0,.993993,280487e-10,0,0,.979982,149422e-10,0,0,.968145,378481e-11,0,0,.966786,53771e-10,0,0,.965611,947508e-11,0,388934e-10,.963557,156616e-10,0,9693e-7,.959752,235144e-10,0,.00370329,.952461,291568e-10,0,.00868428,.940193,240102e-10,0,.0161889,.929042,231235e-10,0,.0263948,.920266,273968e-10,0,.0394088,.911178,337915e-10,0,.0552818,.897873,333629e-10,0,.0740138,.884053,351405e-10,0,.0955539,.869455,378034e-10,0,.119795,.854655,399378e-10,0,.14656,.838347,419108e-10,0,.175573,.820693,440831e-10,0,.206388,.802277,445599e-10,0,.238095,.783634,472691e-10,0,.269841,.763159,476984e-10,0,.301587,.742914,491487e-10,0,.333333,.721662,502312e-10,0,.365079,.699668,502817e-10,0,.396825,.677839,51406e-9,0,.428571,.655091,511095e-10,0,.460317,.632665,516067e-10,0,.492064,.609734,512255e-10,0,.52381,.587043,510263e-10,0,.555556,.564298,50565e-9,0,.587302,.541769,497951e-10,0,.619048,.519529,492698e-10,0,.650794,.497574,482066e-10,0,.68254,.476028,473689e-10,0,.714286,.454961,461941e-10,0,.746032,.434341,450618e-10,0,.777778,.414364,438355e-10,0,.809524,.394832,424196e-10,0,.84127,.376109,412563e-10,0,.873016,.35779,396226e-10,0,.904762,.340379,384886e-10,0,.936508,.323385,368214e-10,0,.968254,.307295,356636e-10,0,1,1,106465e-17,0,0,1,106555e-17,0,0,1,107966e-17,0,0,1,114601e-17,0,0,1,137123e-17,0,0,1,21243e-16,0,0,.999999,489653e-17,0,0,.999999,160283e-16,0,0,.999998,62269e-15,0,0,.999997,2.51859e-10,0,0,.999996,9.96192e-10,0,0,.999992,3.74531e-9,0,0,.999986,1.32022e-8,0,0,.999975,4.33315e-8,0,0,.999959,1.31956e-7,0,0,.999927,3.72249e-7,0,0,.999871,9.72461e-7,0,0,.999771,235343e-11,0,0,.999572,52768e-10,0,0,.999133,109237e-10,0,0,.997912,203675e-10,0,0,.993008,279396e-10,0,0,.980645,139604e-10,0,0,.970057,646596e-11,0,0,.966717,65089e-10,0,474145e-10,.965497,111863e-10,0,89544e-8,.96334,179857e-10,0,.0032647,.959294,259045e-10,0,.0075144,.951519,292327e-10,0,.0138734,.940517,249769e-10,0,.0224952,.93014,26803e-9,0,.0334828,.91972,303656e-10,0,.0468973,.910294,353323e-10,0,.0627703,.897701,351002e-10,0,.0811019,.884522,388104e-10,0,.10186,.869489,412932e-10,0,.124985,.853983,415781e-10,0,.150372,.838425,454066e-10,0,.177868,.820656,471624e-10,0,.207245,.801875,475243e-10,0,.238143,.783521,505621e-10,0,.269841,.763131,50721e-9,0,.301587,.74261,523293e-10,0,.333333,.72148,528699e-10,0,.365079,.699696,538677e-10,0,.396825,.677592,539255e-10,0,.428571,.65525,546367e-10,0,.460317,.632452,541348e-10,0,.492064,.609903,544976e-10,0,.52381,.586928,536201e-10,0,.555556,.564464,535185e-10,0,.587302,.541801,524949e-10,0,.619048,.519681,51812e-9,0,.650794,.497685,507687e-10,0,.68254,.47622,496243e-10,0,.714286,.455135,485714e-10,0,.746032,.4346,471847e-10,0,.777778,.414564,459294e-10,0,.809524,.395165,444705e-10,0,.84127,.376333,430772e-10,0,.873016,.358197,416229e-10,0,.904762,.34064,401019e-10,0,.936508,.323816,386623e-10,0,.968254,.307581,370933e-10,0,1,1,991541e-17,0,0,1,992077e-17,0,0,1,100041e-16,0,0,1,10385e-15,0,0,1,115777e-16,0,0,1,150215e-16,0,0,.999999,254738e-16,0,0,.999999,598822e-16,0,0,.999998,1.79597e-10,0,0,.999997,6.02367e-10,0,0,.999994,2.06835e-9,0,0,.99999,6.94952e-9,0,0,.999984,2.23363e-8,0,0,.999972,6.78578e-8,0,0,.999952,1.93571e-7,0,0,.999919,5.16594e-7,0,0,.99986,128739e-11,0,0,.999753,299298e-11,0,0,.999546,648258e-11,0,0,.999074,129985e-10,0,0,.997671,232176e-10,0,0,.991504,256701e-10,0,0,.981148,131141e-10,0,0,.971965,869048e-11,0,280182e-10,.966624,808301e-11,0,695475e-9,.965344,135235e-10,0,.00265522,.963048,210592e-10,0,.00622975,.958673,287473e-10,0,.0116234,.950262,281379e-10,0,.018976,.940836,271089e-10,0,.0283844,.930996,30926e-9,0,.0399151,.919848,348359e-10,0,.0536063,.909136,366092e-10,0,.0694793,.897554,384162e-10,0,.0875342,.884691,430971e-10,0,.107749,.869414,447803e-10,0,.130087,.853462,452858e-10,0,.154481,.838187,495769e-10,0,.180833,.820381,502709e-10,0,.209005,.801844,522713e-10,0,.238791,.783061,541505e-10,0,.269869,.763205,553712e-10,0,.301587,.742362,564909e-10,0,.333333,.721393,572646e-10,0,.365079,.699676,581012e-10,0,.396825,.677395,58096e-9,0,.428571,.655208,585766e-10,0,.460317,.632451,583602e-10,0,.492064,.609839,580234e-10,0,.52381,.587093,577161e-10,0,.555556,.564467,568447e-10,0,.587302,.542043,563166e-10,0,.619048,.519826,55156e-9,0,.650794,.497952,541682e-10,0,.68254,.476477,528971e-10,0,.714286,.455412,514952e-10,0,.746032,.434926,502222e-10,0,.777778,.4149,485779e-10,0,.809524,.395552,472242e-10,0,.84127,.376712,454891e-10,0,.873016,.358622,440924e-10,0,.904762,.341048,422984e-10,0,.936508,.324262,408582e-10,0,.968254,.308013,390839e-10,0,1,1,613913e-16,0,0,1,614145e-16,0,0,1,617708e-16,0,0,1,633717e-16,0,0,1,681648e-16,0,0,1,808291e-16,0,0,1,1.14608e-10,0,0,.999998,2.10507e-10,0,0,.999997,4.99595e-10,0,0,.999995,1.39897e-9,0,0,.999994,4.19818e-9,0,0,.999988,1.27042e-8,0,0,.999979,3.75153e-8,0,0,.999965,1.06206e-7,0,0,.999945,2.85381e-7,0,0,.999908,7.23611e-7,0,0,.999846,17255e-10,0,0,.999733,386104e-11,0,0,.999511,808493e-11,0,0,.998993,156884e-10,0,0,.997326,265538e-10,0,0,.989706,206466e-10,0,0,.981713,130756e-10,0,70005e-10,.973636,106473e-10,0,464797e-9,.966509,10194e-9,0,.00201743,.965149,165881e-10,0,.00497549,.962669,249147e-10,0,.00953262,.95786,317449e-10,0,.0158211,.949334,281045e-10,0,.0239343,.941041,303263e-10,0,.0339372,.931575,356754e-10,0,.0458738,.920102,397075e-10,0,.059772,.908002,384886e-10,0,.075645,.897269,43027e-9,0,.0934929,.884559,479925e-10,0,.113302,.869161,48246e-9,0,.135045,.853342,509505e-10,0,.158678,.837633,542846e-10,0,.184136,.820252,554139e-10,0,.211325,.801872,581412e-10,0,.240113,.782418,585535e-10,0,.270306,.7631,610923e-10,0,.301594,.742183,613678e-10,0,.333333,.721098,627275e-10,0,.365079,.699512,629413e-10,0,.396825,.677372,636351e-10,0,.428571,.655059,633555e-10,0,.460317,.632567,636513e-10,0,.492064,.609784,628965e-10,0,.52381,.587237,625546e-10,0,.555556,.564525,615825e-10,0,.587302,.542181,605048e-10,0,.619048,.520017,596329e-10,0,.650794,.498204,581516e-10,0,.68254,.476742,569186e-10,0,.714286,.455803,553833e-10,0,.746032,.435251,537807e-10,0,.777778,.415374,522025e-10,0,.809524,.395921,503421e-10,0,.84127,.377253,488211e-10,0,.873016,.359021,468234e-10,0,.904762,.341637,453269e-10,0,.936508,.3247,433014e-10,0,.968254,.308625,418007e-10,0,1,1,2.86798e-10,0,0,1,2.86877e-10,0,0,1,2.88094e-10,0,0,1,2.93506e-10,0,0,1,3.09262e-10,0,0,.999999,3.48593e-10,0,0,.999999,4.44582e-10,0,0,.999998,6.88591e-10,0,0,.999996,1.34391e-9,0,0,.999993,3.17438e-9,0,0,.999989,8.35609e-9,0,0,.999983,2.28677e-8,0,0,.999974,6.23361e-8,0,0,.999959,1.65225e-7,0,0,.999936,4.19983e-7,0,0,.999896,101546e-11,0,0,.99983,232376e-11,0,0,.999709,50156e-10,0,0,.999469,10167e-9,0,0,.998886,190775e-10,0,0,.996819,300511e-10,0,0,.988837,185092e-10,0,1.68222e-7,.982178,134622e-10,0,259622e-9,.975017,125961e-10,0,.00142595,.967101,13507e-9,0,.00382273,.964905,205003e-10,0,.00764164,.96218,29546e-9,0,.0130121,.956821,343738e-10,0,.0200253,.948829,305063e-10,0,.0287452,.941092,346487e-10,0,.039218,.931883,412061e-10,0,.0514748,.920211,444651e-10,0,.0655351,.907307,431252e-10,0,.0814082,.89684,490382e-10,0,.0990939,.884119,53334e-9,0,.118583,.869148,54114e-9,0,.139856,.853377,578536e-10,0,.162882,.836753,592285e-10,0,.187615,.820063,622787e-10,0,.213991,.801694,645492e-10,0,.241918,.782116,65353e-9,0,.271267,.762673,674344e-10,0,.301847,.742133,682788e-10,0,.333333,.720779,691959e-10,0,.365079,.699386,696817e-10,0,.396826,.67732,699583e-10,0,.428572,.654888,698447e-10,0,.460318,.632499,694063e-10,0,.492064,.609825,691612e-10,0,.52381,.587287,681576e-10,0,.555556,.564743,674138e-10,0,.587302,.542409,661617e-10,0,.619048,.520282,647785e-10,0,.650794,.498506,633836e-10,0,.68254,.477102,615905e-10,0,.714286,.456167,601013e-10,0,.746032,.435728,581457e-10,0,.777778,.415809,564215e-10,0,.809524,.396517,544997e-10,0,.84127,.377737,525061e-10,0,.873016,.359698,506831e-10,0,.904762,.342164,48568e-9,0,.936508,.325417,467826e-10,0,.968254,.309186,446736e-10,0,1,1,1.09018e-9,0,0,1,1.0904e-9,0,0,1,1.09393e-9,0,0,1,1.1095e-9,0,0,1,1.154e-9,0,0,1,1.26089e-9,0,0,.999999,1.5059e-9,0,0,.999997,2.07899e-9,0,0,.999994,3.48164e-9,0,0,.999993,7.05728e-9,0,0,.999987,1.63692e-8,0,0,.999981,4.06033e-8,0,0,.999969,1.0245e-7,0,0,.999953,2.55023e-7,0,0,.999925,6.1511e-7,0,0,.999881,142218e-11,0,0,.99981,313086e-11,0,0,.99968,653119e-11,0,0,.999418,12832e-9,0,0,.998748,232497e-10,0,0,.996066,329522e-10,0,0,.988379,179613e-10,0,108799e-9,.982567,143715e-10,0,921302e-9,.976097,148096e-10,0,.00280738,.968475,178905e-10,0,.00596622,.964606,253921e-10,0,.0105284,.961564,348623e-10,0,.0165848,.955517,357612e-10,0,.0242,.948381,343493e-10,0,.03342,.941095,405849e-10,0,.0442777,.931923,475394e-10,0,.0567958,.91996,484328e-10,0,.0709879,.907419,502146e-10,0,.086861,.89618,561654e-10,0,.104415,.88337,587612e-10,0,.123643,.869046,618057e-10,0,.144531,.853278,657392e-10,0,.167057,.836091,66303e-9,0,.191188,.819644,704445e-10,0,.216878,.801246,714071e-10,0,.244062,.782031,740093e-10,0,.272649,.762066,74685e-9,0,.302509,.741964,766647e-10,0,.333442,.720554,766328e-10,0,.365079,.699098,777857e-10,0,.396826,.677189,774633e-10,0,.428572,.65484,776235e-10,0,.460318,.632496,770316e-10,0,.492064,.609908,762669e-10,0,.52381,.587312,753972e-10,0,.555556,.564938,739994e-10,0,.587302,.542577,728382e-10,0,.619048,.52062,71112e-9,0,.650794,.498819,694004e-10,0,.68254,.477555,675575e-10,0,.714286,.456568,653449e-10,0,.746032,.436278,636068e-10,0,.777778,.41637,613466e-10,0,.809524,.397144,594177e-10,0,.84127,.378412,570987e-10,0,.873016,.360376,550419e-10,0,.904762,.342906,527422e-10,0,.936508,.326136,506544e-10,0,.968254,.30997,484307e-10,0,1,1,3.54014e-9,0,0,1,3.54073e-9,0,0,1,3.54972e-9,0,0,1,3.58929e-9,0,0,1,3.70093e-9,0,0,.999999,3.96194e-9,0,0,.999998,4.53352e-9,0,0,.999997,5.78828e-9,0,0,.999994,8.63812e-9,0,0,.999991,1.53622e-8,0,0,.999985,3.16356e-8,0,0,.999977,7.12781e-8,0,0,.999964,1.66725e-7,0,0,.999945,3.90501e-7,0,0,.999912,8.95622e-7,0,0,.999866,198428e-11,0,0,.999786,421038e-11,0,0,.999647,850239e-11,0,0,.999356,162059e-10,0,0,.998563,282652e-10,0,0,.994928,336309e-10,0,244244e-10,.987999,178458e-10,0,523891e-9,.982893,159162e-10,0,.00194729,.977044,178056e-10,0,.00451099,.969972,230624e-10,0,.00835132,.964237,313922e-10,0,.013561,.960791,406145e-10,0,.0202056,.954292,372796e-10,0,.0283321,.948052,403199e-10,0,.0379739,.940938,479537e-10,0,.0491551,.931689,545292e-10,0,.0618918,.91987,54038e-9,0,.0761941,.907665,589909e-10,0,.0920672,.895281,642651e-10,0,.109511,.882621,659707e-10,0,.12852,.86873,709973e-10,0,.149085,.853008,742221e-10,0,.171189,.835944,761754e-10,0,.194809,.818949,797052e-10,0,.21991,.800951,812434e-10,0,.246447,.781847,838075e-10,0,.274352,.761649,84501e-9,0,.303535,.74152,860258e-10,0,.333857,.720495,866233e-10,0,.365104,.698742,868326e-10,0,.396826,.677096,87133e-9,0,.428572,.654782,863497e-10,0,.460318,.632335,860206e-10,0,.492064,.610031,849337e-10,0,.52381,.587457,838279e-10,0,.555556,.56513,82309e-9,0,.587302,.542877,803542e-10,0,.619048,.5209,786928e-10,0,.650794,.499291,765171e-10,0,.68254,.477971,744753e-10,0,.714286,.457221,72209e-9,0,.746032,.436803,697448e-10,0,.777778,.417083,675333e-10,0,.809524,.397749,648058e-10,0,.84127,.379177,625759e-10,0,.873016,.361061,598584e-10,0,.904762,.343713,575797e-10,0,.936508,.326894,549999e-10,0,.968254,.310816,527482e-10,0,1,1,1.0153e-8,0,0,1,1.01544e-8,0,0,1,1.01751e-8,0,0,1,1.02662e-8,0,0,1,1.0521e-8,0,0,.999999,1.11049e-8,0,0,.999999,1.23408e-8,0,0,.999996,1.4924e-8,0,0,.999992,2.04471e-8,0,0,.999989,3.26539e-8,0,0,.99998,6.03559e-8,0,0,.999971,1.23936e-7,0,0,.999955,2.69058e-7,0,0,.999933,5.93604e-7,0,0,.999901,129633e-11,0,0,.999847,275621e-11,0,0,.999761,564494e-11,0,0,.999607,110485e-10,0,0,.999282,204388e-10,0,0,.99831,341084e-10,0,2.2038e-7,.993288,294949e-10,0,242388e-9,.987855,192736e-10,0,.0012503,.983167,182383e-10,0,.0032745,.977908,218633e-10,0,.00646321,.971194,290662e-10,0,.0109133,.963867,386401e-10,0,.0166927,.95982,462827e-10,0,.0238494,.953497,420705e-10,0,.0324178,.947621,477743e-10,0,.0424225,.940611,568258e-10,0,.0538808,.931174,618061e-10,0,.0668047,.919919,627098e-10,0,.0812014,.907856,694714e-10,0,.0970745,.894509,735008e-10,0,.114424,.881954,763369e-10,0,.133246,.868309,821896e-10,0,.153534,.852511,83769e-9,0,.175275,.835821,881615e-10,0,.198453,.817981,896368e-10,0,.223042,.800504,930906e-10,0,.249009,.78141,945056e-10,0,.276304,.761427,963605e-10,0,.304862,.74094,968088e-10,0,.334584,.720233,981481e-10,0,.365322,.698592,979122e-10,0,.396826,.676763,981057e-10,0,.428571,.654808,973956e-10,0,.460318,.632326,962619e-10,0,.492064,.610049,952996e-10,0,.52381,.58763,933334e-10,0,.555556,.565261,917573e-10,0,.587302,.543244,896636e-10,0,.619048,.521273,873304e-10,0,.650794,.499818,852648e-10,0,.68254,.478536,823961e-10,0,.714286,.457826,79939e-9,0,.746032,.437549,77126e-9,0,.777778,.41776,743043e-10,0,.809524,.39863,716426e-10,0,.84127,.379954,686456e-10,0,.873016,.362025,660514e-10,0,.904762,.344581,630755e-10,0,.936508,.327909,605439e-10,0,.968254,.311736,576345e-10,0,1,1,2.63344e-8,0,0,1,2.63373e-8,0,0,1,2.63815e-8,0,0,1,2.65753e-8,0,0,1,2.71132e-8,0,0,.999999,2.83279e-8,0,0,.999997,3.0833e-8,0,0,.999995,3.58711e-8,0,0,.999992,4.61266e-8,0,0,.999985,6.7574e-8,0,0,.999977,1.1358e-7,0,0,.999966,2.13657e-7,0,0,.999948,4.31151e-7,0,0,.999923,8.96656e-7,0,0,.999884,186603e-11,0,0,.999826,381115e-11,0,0,.999732,754184e-11,0,0,.999561,143192e-10,0,0,.999191,257061e-10,0,0,.997955,405724e-10,0,744132e-10,.992228,276537e-10,0,716477e-9,.987638,208885e-10,0,.0022524,.983395,215226e-10,0,.00484816,.978614,270795e-10,0,.00860962,.972389,365282e-10,0,.0136083,.964392,474747e-10,0,.0198941,.95861,509141e-10,0,.0275023,.952806,48963e-9,0,.0364584,.94712,571119e-10,0,.04678,.940104,671704e-10,0,.0584799,.930398,687586e-10,0,.0715665,.919866,738161e-10,0,.086045,.907853,813235e-10,0,.101918,.894078,834582e-10,0,.119186,.881177,892093e-10,0,.137845,.867575,944548e-10,0,.157891,.852107,969607e-10,0,.179316,.835502,101456e-9,0,.202106,.81756,103256e-9,0,.226243,.79984,106954e-9,0,.251704,.780998,108066e-9,0,.278451,.761132,110111e-9,0,.306436,.740429,110459e-9,0,.335586,.719836,111219e-9,0,.365796,.698467,11145e-8,0,.3969,.676446,110393e-9,0,.428571,.654635,110035e-9,0,.460318,.632411,108548e-9,0,.492064,.609986,106963e-9,0,.52381,.587872,105238e-9,0,.555556,.565528,102665e-9,0,.587302,.543563,100543e-9,0,.619048,.52176,976182e-10,0,.650794,.500188,947099e-10,0,.68254,.479204,919929e-10,0,.714286,.458413,886139e-10,0,.746032,.438314,857839e-10,0,.777778,.418573,82411e-9,0,.809524,.39947,792211e-10,0,.84127,.380892,759546e-10,0,.873016,.362953,727571e-10,0,.904762,.345601,695738e-10,0,.936508,.328895,664907e-10,0,.968254,.312808,634277e-10,0,1,1,6.28647e-8,0,0,1,6.28705e-8,0,0,1,6.29587e-8,0,0,1,6.33441e-8,0,0,.999999,6.44087e-8,0,0,.999998,6.67856e-8,0,0,.999997,7.15889e-8,0,0,.999995,8.09577e-8,0,0,.999989,9.92764e-8,0,0,.999983,1.35834e-7,0,0,.999974,2.10482e-7,0,0,.999959,3.65215e-7,0,0,.999939,6.86693e-7,0,0,.999911,13472e-10,0,0,.999868,26731e-10,0,0,.999804,524756e-11,0,0,.9997,100403e-10,0,0,.99951,185019e-10,0,0,.999078,322036e-10,0,620676e-11,.997428,470002e-10,0,341552e-9,.99162,287123e-10,0,.00143727,.987479,234706e-10,0,.00349201,.983582,260083e-10,0,.0066242,.979186,337927e-10,0,.0109113,.97325,454689e-10,0,.0164064,.965221,573759e-10,0,.0231463,.957262,544114e-10,0,.0311571,.952211,587006e-10,0,.0404572,.946631,692256e-10,0,.0510592,.939391,787819e-10,0,.0629723,.929795,792368e-10,0,.0762025,.91965,875075e-10,0,.090753,.907737,950903e-10,0,.106626,.893899,972963e-10,0,.123822,.880239,10459e-8,0,.142337,.866562,107689e-9,0,.16217,.85164,113081e-9,0,.183314,.835021,116636e-9,0,.20576,.817311,120074e-9,0,.229496,.798845,121921e-9,0,.254502,.780479,12475e-8,0,.280753,.760694,125255e-9,0,.308212,.740142,126719e-9,0,.336825,.719248,12636e-8,0,.366517,.698209,126712e-9,0,.397167,.676398,125769e-9,0,.428578,.654378,124432e-9,0,.460318,.632484,123272e-9,0,.492064,.610113,12085e-8,0,.52381,.587931,118411e-9,0,.555556,.565872,11569e-8,0,.587302,.543814,112521e-9,0,.619048,.522265,109737e-9,0,.650794,.500835,106228e-9,0,.68254,.479818,102591e-9,0,.714286,.459258,991288e-10,0,.746032,.439061,952325e-10,0,.777778,.419552,91895e-9,0,.809524,.400399,879051e-10,0,.84127,.381976,844775e-10,0,.873016,.364009,806316e-10,0,.904762,.346761,771848e-10,0,.936508,.330049,735429e-10,0,.968254,.314018,702103e-10,0,1,1,1.39968e-7,0,0,1,1.39979e-7,0,0,1,1.40145e-7,0,0,1,1.4087e-7,0,0,.999999,1.42865e-7,0,0,.999998,1.47279e-7,0,0,.999997,1.56057e-7,0,0,.999992,1.7276e-7,0,0,.999989,2.04352e-7,0,0,.99998,2.6494e-7,0,0,.999969,3.83435e-7,0,0,.999953,6.18641e-7,0,0,.999929,108755e-11,0,0,.999898,201497e-11,0,0,.999849,381346e-11,0,0,.999778,719815e-11,0,0,.999661,133215e-10,0,0,.999451,238313e-10,0,0,.998936,401343e-10,0,113724e-9,.99662,517346e-10,0,820171e-9,.991094,304323e-10,0,.00238143,.987487,281757e-10,0,.00493527,.983731,320048e-10,0,.00856859,.979647,423905e-10,0,.0133393,.973837,562935e-10,0,.0192863,.96584,677442e-10,0,.0264369,.956309,623073e-10,0,.03481,.951523,704131e-10,0,.0444184,.946003,836594e-10,0,.0552713,.938454,911736e-10,0,.0673749,.929279,938264e-10,0,.0807329,.919239,103754e-9,0,.0953479,.907293,109928e-9,0,.111221,.893936,115257e-9,0,.128352,.879674,122265e-9,0,.14674,.865668,125733e-9,0,.166382,.850998,132305e-9,0,.187276,.834498,134844e-9,0,.209413,.816903,139276e-9,0,.232786,.798235,140984e-9,0,.257382,.779724,14378e-8,0,.283181,.760251,144623e-9,0,.310156,.739808,145228e-9,0,.338269,.718762,14539e-8,0,.367461,.697815,144432e-9,0,.397646,.67631,143893e-9,0,.428685,.654278,141846e-9,0,.460318,.632347,13935e-8,0,.492064,.610296,137138e-9,0,.52381,.588039,133806e-9,0,.555556,.566218,130755e-9,0,.587302,.544346,127128e-9,0,.619048,.522701,123002e-9,0,.650794,.501542,119443e-9,0,.68254,.480508,115055e-9,0,.714286,.460092,111032e-9,0,.746032,.440021,106635e-9,0,.777778,.420446,102162e-9,0,.809524,.401512,98184e-9,0,.84127,.38299,936497e-10,0,.873016,.365232,89813e-9,0,.904762,.347865,853073e-10,0,.936508,.331342,817068e-10,0,.968254,.315202,773818e-10,0,1,1,2.9368e-7,0,0,1,2.937e-7,0,0,1,2.93998e-7,0,0,1,2.95298e-7,0,0,.999999,2.98865e-7,0,0,.999998,3.067e-7,0,0,.999995,3.22082e-7,0,0,.999992,3.50767e-7,0,0,.999986,4.03538e-7,0,0,.999976,5.01372e-7,0,0,.999964,6.8562e-7,0,0,.999945,10374e-10,0,0,.999919,171269e-11,0,0,.999882,300175e-11,0,0,.999829,542144e-11,0,0,.999749,984182e-11,0,0,.99962,176213e-10,0,0,.999382,305995e-10,0,138418e-10,.998751,496686e-10,0,389844e-9,.995344,510733e-10,0,.00150343,.990768,345829e-10,0,.00352451,.987464,342841e-10,0,.00655379,.983846,399072e-10,0,.0106554,.980007,533219e-10,0,.0158723,.974494,696992e-10,0,.0222333,.96622,776754e-10,0,.029758,.956273,747718e-10,0,.0384596,.950952,864611e-10,0,.0483473,.945215,100464e-9,0,.0594266,.937287,103729e-9,0,.0717019,.928649,111665e-9,0,.0851752,.918791,12353e-8,0,.0998479,.906685,127115e-9,0,.115721,.893706,13628e-8,0,.132794,.879248,142427e-9,0,.151067,.864685,148091e-9,0,.170538,.850032,153517e-9,0,.191204,.833853,157322e-9,0,.213063,.816353,161086e-9,0,.236107,.797834,164111e-9,0,.260329,.778831,165446e-9,0,.285714,.759756,167492e-9,0,.312243,.739419,166928e-9,0,.339887,.718491,167e-6,0,.368604,.697392,165674e-9,0,.398329,.676102,163815e-9,0,.428961,.654243,162003e-9,0,.460331,.632176,158831e-9,0,.492064,.610407,155463e-9,0,.52381,.588394,152062e-9,0,.555556,.56645,147665e-9,0,.587302,.5449,14375e-8,0,.619048,.523276,138905e-9,0,.650794,.502179,134189e-9,0,.68254,.481359,129392e-9,0,.714286,.46092,124556e-9,0,.746032,.441084,11957e-8,0,.777778,.421517,114652e-9,0,.809524,.402721,109688e-9,0,.84127,.384222,104667e-9,0,.873016,.366534,999633e-10,0,.904762,.349205,950177e-10,0,.936508,.332702,907301e-10,0,.968254,.316599,859769e-10,0,1,1,5.85473e-7,0,0,1,5.85507e-7,0,0,1,5.8602e-7,0,0,.999999,5.88259e-7,0,0,.999999,5.94381e-7,0,0,.999998,6.07754e-7,0,0,.999995,6.33729e-7,0,0,.99999,6.8137e-7,0,0,.999984,7.67003e-7,0,0,.999973,9.21212e-7,0,0,.999959,120218e-11,0,0,.999936,172024e-11,0,0,.999907,268088e-11,0,0,.999866,445512e-11,0,0,.999806,768481e-11,0,0,.999716,1342e-8,0,0,.999576,232473e-10,0,0,.9993,391694e-10,0,129917e-9,.998498,608429e-10,0,845035e-9,.994132,489743e-10,0,.00237616,.99031,384644e-10,0,.00484456,.987409,421768e-10,0,.00832472,.983981,504854e-10,0,.0128643,.980268,671028e-10,0,.0184947,.974875,852749e-10,0,.025237,.966063,85531e-9,0,.0331046,.956779,900588e-10,0,.0421067,.950259,10577e-8,0,.0522487,.944239,119458e-9,0,.0635343,.936341,122164e-9,0,.0759654,.928047,134929e-9,0,.0895434,.918065,145544e-9,0,.104269,.906267,150531e-9,0,.120142,.893419,161652e-9,0,.137163,.878758,16593e-8,0,.15533,.863699,174014e-9,0,.174645,.848876,177877e-9,0,.195106,.833032,184049e-9,0,.21671,.815557,186088e-9,0,.239454,.797323,19054e-8,0,.263332,.778124,191765e-9,0,.288336,.758929,192535e-9,0,.314451,.738979,192688e-9,0,.341658,.718213,191522e-9,0,.369924,.696947,190491e-9,0,.399202,.675807,187913e-9,0,.429416,.654147,184451e-9,0,.460447,.63229,181442e-9,0,.492064,.610499,177139e-9,0,.523809,.588747,172596e-9,0,.555555,.566783,167457e-9,0,.587301,.545359,162518e-9,0,.619048,.523984,156818e-9,0,.650794,.502917,151884e-9,0,.68254,.482294,145514e-9,0,.714286,.461945,140199e-9,0,.746032,.442133,134101e-9,0,.777778,.422705,128374e-9,0,.809524,.403916,122996e-9,0,.84127,.38554,116808e-9,0,.873016,.367909,111973e-9,0,.904762,.350651,105938e-9,0,.936508,.334208,101355e-9,0,.968254,.318123,957629e-10,0,1,1,111633e-11,0,0,1,111639e-11,0,0,1,111725e-11,0,0,1,112096e-11,0,0,.999999,11311e-10,0,0,.999997,115315e-11,0,0,.999995,11956e-10,0,0,.999989,127239e-11,0,0,.999981,140772e-11,0,0,.999969,164541e-11,0,0,.999952,206607e-11,0,0,.999928,281783e-11,0,0,.999895,416835e-11,0,0,.999848,658728e-11,0,0,.999781,108648e-10,0,0,.999682,182579e-10,0,0,.999523,306003e-10,0,159122e-10,.999205,499862e-10,0,391184e-9,.998131,73306e-9,0,.00147534,.993334,513229e-10,0,.0034227,.99016,467783e-10,0,.00632232,.987321,523413e-10,0,.0102295,.984099,64267e-9,0,.0151794,.980432,843042e-10,0,.0211947,.974976,102819e-9,0,.0282899,.966429,996234e-10,0,.0364739,.957633,111074e-9,0,.0457522,.949422,128644e-9,0,.0561278,.943045,140076e-9,0,.0676023,.935448,146349e-9,0,.0801762,.927225,161854e-9,0,.0938499,.917033,169135e-9,0,.108623,.905762,179987e-9,0,.124496,.892879,189832e-9,0,.141469,.878435,195881e-9,0,.159541,.863114,20466e-8,0,.178713,.84776,209473e-9,0,.198985,.832084,214861e-9,0,.220355,.814915,217695e-9,0,.242823,.796711,220313e-9,0,.266385,.777603,22313e-8,0,.291036,.757991,222471e-9,0,.316767,.738371,222869e-9,0,.343563,.717872,221243e-9,0,.371402,.696619,218089e-9,0,.400248,.675379,21562e-8,0,.430047,.65411,21169e-8,0,.460709,.63241,206947e-9,0,.492079,.61046,201709e-9,0,.52381,.58903,196753e-9,0,.555556,.567267,189637e-9,0,.587302,.545886,184735e-9,0,.619048,.524714,177257e-9,0,.650794,.503789,171424e-9,0,.68254,.483204,164688e-9,0,.714286,.462976,157172e-9,0,.746032,.443294,151341e-9,0,.777778,.423988,143737e-9,0,.809524,.405325,138098e-9,0,.84127,.386981,130698e-9,0,.873016,.369436,125276e-9,0,.904762,.35219,118349e-9,0,.936508,.335804,11312e-8,0,.968254,.319749,106687e-9,0,1,1,204685e-11,0,0,1,204694e-11,0,0,1,204831e-11,0,0,.999999,205428e-11,0,0,.999999,207056e-11,0,0,.999997,210581e-11,0,0,.999993,21732e-10,0,0,.999987,229365e-11,0,0,.999979,250243e-11,0,0,.999965,286127e-11,0,0,.999947,348028e-11,0,0,.999918,455588e-11,0,0,.999881,643303e-11,0,0,.999828,970064e-11,0,0,.999753,153233e-10,0,0,.999642,24793e-9,0,0,.999464,402032e-10,0,122947e-9,.999089,635852e-10,0,807414e-9,.997567,857026e-10,0,.00227206,.992903,594912e-10,0,.00462812,.990011,578515e-10,0,.00794162,.987192,65399e-9,0,.0122534,.98418,819675e-10,0,.0175888,.980491,105514e-9,0,.0239635,.974779,121532e-9,0,.031387,.96675,119144e-9,0,.0398644,.958248,136125e-9,0,.0493982,.948884,155408e-9,0,.0599896,.941673,162281e-9,0,.0716382,.934521,176754e-9,0,.0843437,.926205,192873e-9,0,.0981056,.916089,200038e-9,0,.112923,.904963,213624e-9,0,.128796,.892089,221834e-9,0,.145725,.878028,232619e-9,0,.163709,.86249,238632e-9,0,.182749,.846587,247002e-9,0,.202847,.830988,250702e-9,0,.224001,.814165,255562e-9,0,.246214,.796135,257505e-9,0,.269482,.777052,258625e-9,0,.293805,.757201,258398e-9,0,.319176,.737655,256714e-9,0,.345587,.717477,255187e-9,0,.373021,.696433,251792e-9,0,.401454,.675084,247223e-9,0,.430844,.653907,242213e-9,0,.461125,.632561,237397e-9,0,.492187,.610658,229313e-9,0,.52381,.589322,224402e-9,0,.555556,.567857,216116e-9,0,.587302,.54652,209124e-9,0,.619048,.525433,201601e-9,0,.650794,.504679,192957e-9,0,.68254,.484203,186052e-9,0,.714286,.464203,177672e-9,0,.746032,.444549,170005e-9,0,.777778,.425346,162401e-9,0,.809524,.406706,1544e-7,0,.84127,.388576,147437e-9,0,.873016,.37094,139493e-9,0,.904762,.353996,133219e-9,0,.936508,.337391,125573e-9,0,.968254,.321648,119867e-9,0,1,1,362511e-11,0,0,1,362525e-11,0,0,1,362739e-11,0,0,.999999,363673e-11,0,0,.999998,366214e-11,0,0,.999996,371698e-11,0,0,.999992,382116e-11,0,0,.999986,400554e-11,0,0,.999976,432058e-11,0,0,.999961,485194e-11,0,0,.999938,574808e-11,0,0,.999908,726643e-11,0,0,.999865,984707e-11,0,0,.999807,142217e-10,0,0,.999723,215581e-10,0,0,.999602,336114e-10,0,119113e-10,.999398,527353e-10,0,355813e-9,.998946,805809e-10,0,.00137768,.996647,942908e-10,0,.00322469,.992298,668733e-10,0,.00597897,.989802,716564e-10,0,.00968903,.987019,821355e-10,0,.0143845,.984219,104555e-9,0,.0200831,.980425,131245e-9,0,.0267948,.974241,139613e-9,0,.034525,.967006,145931e-9,0,.0432757,.95893,167153e-9,0,.0530471,.949157,188146e-9,0,.0638386,.94062,194625e-9,0,.0756487,.933509,213721e-9,0,.0884762,.925088,229616e-9,0,.10232,.915178,239638e-9,0,.117178,.904093,254814e-9,0,.133051,.891337,263685e-9,0,.149939,.877326,274789e-9,0,.167841,.861794,280534e-9,0,.18676,.845758,289534e-9,0,.206696,.829792,294446e-9,0,.22765,.813037,296877e-9,0,.249625,.795285,300217e-9,0,.27262,.776323,299826e-9,0,.296636,.756673,299787e-9,0,.321671,.736856,297867e-9,0,.347718,.716883,294052e-9,0,.374768,.696089,289462e-9,0,.402804,.67505,285212e-9,0,.431796,.653509,27653e-8,0,.461695,.63258,271759e-9,0,.49242,.61104,262811e-9,0,.523822,.589567,255151e-9,0,.555556,.568322,246434e-9,0,.587302,.547235,237061e-9,0,.619048,.52616,228343e-9,0,.650794,.505716,219236e-9,0,.68254,.485274,209595e-9,0,.714286,.465411,201011e-9,0,.746032,.445854,19109e-8,0,.777778,.426911,182897e-9,0,.809524,.408222,173569e-9,0,.84127,.390307,165496e-9,0,.873016,.372624,156799e-9,0,.904762,.355804,14917e-8,0,.936508,.33924,140907e-9,0,.968254,.323534,134062e-9,0,1,1,622487e-11,0,0,1,62251e-10,0,0,1,622837e-11,0,0,.999999,624259e-11,0,0,.999998,628127e-11,0,0,.999996,636451e-11,0,0,.999991,65218e-10,0,0,.999984,679782e-11,0,0,.999973,726361e-11,0,0,.999955,803644e-11,0,0,.999931,931397e-11,0,0,.999896,114299e-10,0,0,.999847,149402e-10,0,0,.999784,207461e-10,0,0,.999692,302493e-10,0,0,.999554,454957e-10,0,997275e-10,.999326,690762e-10,0,724813e-9,.998757,101605e-9,0,.0020972,.995367,958745e-10,0,.00432324,.99209,832808e-10,0,.00746347,.989517,887601e-10,0,.0115534,.987008,10564e-8,0,.0166134,.98421,133179e-9,0,.0226552,.98021,161746e-9,0,.0296838,.973676,161821e-9,0,.0377016,.967052,178635e-9,0,.0467079,.959385,206765e-9,0,.0567013,.949461,22476e-8,0,.0676796,.939578,23574e-8,0,.0796403,.932416,25893e-8,0,.0925812,.923759,271228e-9,0,.106501,.914223,289165e-9,0,.121397,.902942,301156e-9,0,.13727,.890419,313852e-9,0,.15412,.876639,324408e-9,0,.171946,.861316,33249e-8,0,.190751,.84496,338497e-9,0,.210537,.828427,345861e-9,0,.231305,.811871,347863e-9,0,.253057,.794397,350225e-9,0,.275797,.775726,349915e-9,0,.299525,.75617,347297e-9,0,.324242,.736091,344232e-9,0,.349947,.716213,340835e-9,0,.376633,.695736,332369e-9,0,.404289,.674961,327943e-9,0,.432895,.653518,318533e-9,0,.462415,.632574,310391e-9,0,.492788,.61134,300755e-9,0,.523909,.590017,290506e-9,0,.555556,.568752,280446e-9,0,.587302,.548061,269902e-9,0,.619048,.52711,258815e-9,0,.650794,.506682,248481e-9,0,.68254,.486524,237141e-9,0,.714286,.466812,226872e-9,0,.746032,.44732,216037e-9,0,.777778,.428473,205629e-9,0,.809524,.409921,195691e-9,0,.84127,.392028,185457e-9,0,.873016,.374606,176436e-9,0,.904762,.357601,166508e-9,0,.936508,.341348,158385e-9,0,.968254,.32542,149203e-9,0,1,1,103967e-10,0,0,1,10397e-9,0,0,1,104019e-10,0,0,.999999,104231e-10,0,0,.999998,104806e-10,0,0,.999995,106042e-10,0,0,.999991,108366e-10,0,0,.999982,112415e-10,0,0,.999968,119174e-10,0,0,.99995,130227e-10,0,0,.999922,148176e-10,0,0,.999884,177303e-10,0,0,.99983,224564e-10,0,0,.999758,300966e-10,0,0,.999654,423193e-10,0,549083e-11,.999503,614848e-10,0,296087e-9,.999237,903576e-10,0,.00123144,.998491,1271e-7,0,.00295954,.994594,107754e-9,0,.00555829,.99178,103025e-9,0,.00907209,.989265,11154e-8,0,.0135257,.986998,136296e-9,0,.0189327,.984137,169154e-9,0,.0252993,.979798,196671e-9,0,.0326272,.97337,196678e-9,0,.0409157,.967239,223121e-9,0,.0501623,.959543,253809e-9,0,.0603638,.949466,265972e-9,0,.0715171,.939074,288372e-9,0,.0836187,.931118,310983e-9,0,.0966657,.922525,325561e-9,0,.110656,.912983,345725e-9,0,.125588,.901617,3556e-7,0,.141461,.889487,374012e-9,0,.158275,.875787,383445e-9,0,.176031,.860654,393972e-9,0,.19473,.844417,400311e-9,0,.214374,.82741,405004e-9,0,.234967,.810545,407378e-9,0,.256512,.793312,407351e-9,0,.279011,.774847,406563e-9,0,.302468,.755621,404903e-9,0,.326887,.735511,397486e-9,0,.352266,.715435,39357e-8,0,.378605,.695403,384739e-9,0,.405897,.674681,376108e-9,0,.43413,.65359,365997e-9,0,.463277,.632471,354957e-9,0,.493295,.61151,343593e-9,0,.524106,.59064,331841e-9,0,.555561,.569386,318891e-9,0,.587302,.548785,3072e-7,0,.619048,.528146,29361e-8,0,.650794,.507872,281709e-9,0,.68254,.487805,268627e-9,0,.714286,.468196,255887e-9,0,.746032,.448922,243997e-9,0,.777778,.430093,231662e-9,0,.809524,.411845,220339e-9,0,.84127,.393808,208694e-9,0,.873016,.376615,198045e-9,0,.904762,.359655,187375e-9,0,.936508,.343452,177371e-9,0,.968254,.32765,167525e-9,0,1,1,169351e-10,0,0,1,169356e-10,0,0,1,169427e-10,0,0,.999999,169736e-10,0,0,.999998,170575e-10,0,0,.999995,172372e-10,0,0,.99999,175739e-10,0,0,.999979,181568e-10,0,0,.999966,191206e-10,0,0,.999944,20677e-9,0,0,.999912,231644e-10,0,0,.999869,271268e-10,0,0,.999811,334272e-10,0,0,.99973,433979e-10,0,0,.999617,590083e-10,0,680315e-10,.999445,829497e-10,0,612796e-9,.999138,118019e-9,0,.00187408,.998095,156712e-9,0,.00395791,.993919,125054e-9,0,.00692144,.991333,126091e-9,0,.0107962,.989226,144912e-9,0,.0155986,.986954,175737e-9,0,.0213364,.983982,213883e-9,0,.0280114,.979128,234526e-9,0,.0356226,.973327,243725e-9,0,.0441668,.967416,2773e-7,0,.0536399,.959729,308799e-9,0,.0640376,.949758,322447e-9,0,.0753554,.939173,350021e-9,0,.0875893,.9296,370089e-9,0,.100736,.921181,391365e-9,0,.114793,.91164,413636e-9,0,.129759,.900435,427068e-9,0,.145632,.888183,441046e-9,0,.162412,.874772,454968e-9,0,.180101,.859566,461882e-9,0,.1987,.843579,471556e-9,0,.218213,.826453,474335e-9,0,.238641,.809164,477078e-9,0,.259989,.792179,47755e-8,0,.282262,.773866,472573e-9,0,.305464,.754944,469765e-9,0,.329599,.735133,462371e-9,0,.35467,.714858,453674e-9,0,.380678,.694829,443888e-9,0,.407622,.674453,432052e-9,0,.435493,.653685,420315e-9,0,.464275,.632666,406829e-9,0,.493938,.611676,392234e-9,0,.524422,.591193,379208e-9,0,.555624,.570145,36319e-8,0,.587302,.549566,349111e-9,0,.619048,.529278,334166e-9,0,.650794,.509026,318456e-9,0,.68254,.489186,30449e-8,0,.714286,.469662,289051e-9,0,.746032,.450691,275494e-9,0,.777778,.431841,261437e-9,0,.809524,.413752,247846e-9,0,.84127,.395951,235085e-9,0,.873016,.378633,222245e-9,0,.904762,.36194,210533e-9,0,.936508,.345599,198494e-9,0,.968254,.329999,188133e-9,0,1,1,269663e-10,0,0,1,26967e-9,0,0,1,269772e-10,0,0,.999999,270214e-10,0,0,.999998,271415e-10,0,0,.999994,27398e-9,0,0,.999988,278771e-10,0,0,.999977,287019e-10,0,0,.999961,300544e-10,0,0,.999937,322138e-10,0,0,.999904,356163e-10,0,0,.999854,409465e-10,0,0,.99979,492651e-10,0,0,.999699,621722e-10,0,8.8288e-7,.999572,819715e-10,0,223369e-9,.999381,111689e-9,0,.00105414,.999016,153862e-9,0,.0026493,.997437,187667e-9,0,.00508608,.993545,155672e-9,0,.00840554,.991135,161455e-9,0,.012629,.989157,188241e-9,0,.0177661,.986874,226229e-9,0,.0238198,.983714,268668e-9,0,.0307887,.978301,277109e-9,0,.0386688,.973227,303446e-9,0,.0474554,.967317,341851e-9,0,.0571428,.959477,370885e-9,0,.0677256,.950012,392753e-9,0,.0791988,.939484,42781e-8,0,.0915576,.928135,443866e-9,0,.104798,.919819,472959e-9,0,.118918,.910049,491551e-9,0,.133915,.899181,512616e-9,0,.149788,.886881,523563e-9,0,.166537,.87359,540183e-9,0,.184164,.858613,547386e-9,0,.202669,.842809,554809e-9,0,.222056,.825727,558316e-9,0,.242329,.808086,557824e-9,0,.263492,.790728,556346e-9,0,.285551,.772987,552672e-9,0,.30851,.7541,543738e-9,0,.332376,.734669,536107e-9,0,.357153,.714411,523342e-9,0,.382845,.694196,512238e-9,0,.409454,.674252,497465e-9,0,.436977,.65357,481096e-9,0,.465404,.632999,467054e-9,0,.494713,.611994,448771e-9,0,.524864,.591604,431889e-9,0,.555779,.571134,415238e-9,0,.587302,.550528,396369e-9,0,.619048,.530292,379477e-9,0,.650794,.510364,361488e-9,0,.68254,.490749,343787e-9,0,.714286,.471266,327822e-9,0,.746032,.452462,310626e-9,0,.777778,.433907,295352e-9,0,.809524,.415659,279179e-9,0,.84127,.398138,264685e-9,0,.873016,.380833,249905e-9,0,.904762,.364247,236282e-9,0,.936508,.348041,222905e-9,0,.968254,.332389,210522e-9,0,1,1,420604e-10,0,0,1,420614e-10,0,0,1,420757e-10,0,0,.999999,42138e-9,0,0,.999997,423067e-10,0,0,.999993,426668e-10,0,0,.999986,433372e-10,0,0,.999974,444857e-10,0,0,.999956,463554e-10,0,0,.99993,493105e-10,0,0,.999892,539077e-10,0,0,.999838,610005e-10,0,0,.999767,718822e-10,0,0,.999666,884581e-10,0,365471e-10,.999525,113398e-9,0,485623e-9,.999311,150043e-9,0,.00162096,.998865,200063e-9,0,.00355319,.996278,211014e-9,0,.00633818,.992956,189672e-9,0,.0100043,.991017,210262e-9,0,.0145648,.989055,244292e-9,0,.0200237,.986741,290481e-9,0,.0263798,.983288,334303e-9,0,.033629,.977784,340307e-9,0,.0417652,.973037,377864e-9,0,.0507821,.967181,4239e-7,0,.060673,.958971,443854e-9,0,.0714314,.950093,483039e-9,0,.0830518,.939552,517934e-9,0,.0955288,.927678,539449e-9,0,.108859,.918278,568604e-9,0,.123038,.908449,588505e-9,0,.138065,.897713,612473e-9,0,.153938,.885533,625575e-9,0,.170657,.872131,63854e-8,0,.188224,.857517,647034e-9,0,.20664,.841796,65209e-8,0,.225909,.824726,6544e-7,0,.246035,.807297,655744e-9,0,.267022,.789058,646716e-9,0,.288878,.77189,643898e-9,0,.311607,.753082,629973e-9,0,.335216,.7341,621564e-9,0,.359713,.714094,605171e-9,0,.385103,.693839,588752e-9,0,.41139,.673891,573294e-9,0,.438576,.653565,552682e-9,0,.466656,.633326,533446e-9,0,.495617,.612582,514635e-9,0,.525431,.59205,49303e-8,0,.556041,.571918,471842e-9,0,.587338,.551572,451713e-9,0,.619048,.531553,430049e-9,0,.650794,.51175,410445e-9,0,.68254,.49238,390098e-9,0,.714286,.473143,370033e-9,0,.746032,.45423,351205e-9,0,.777778,.435963,332049e-9,0,.809524,.41787,315021e-9,0,.84127,.400387,297315e-9,0,.873016,.383332,281385e-9,0,.904762,.366665,265397e-9,0,.936508,.350633,250601e-9,0,.968254,.334964,23589e-8,0,1,1,643736e-10,0,0,1,64375e-9,0,0,1,643947e-10,0,0,.999999,64481e-9,0,0,.999997,647143e-10,0,0,.999994,652119e-10,0,0,.999985,661359e-10,0,0,.999972,677116e-10,0,0,.999952,702599e-10,0,0,.999922,742517e-10,0,0,.99988,803906e-10,0,0,.99982,897315e-10,0,0,.999741,103838e-9,0,0,.999629,12496e-8,0,149024e-9,.999474,156161e-9,0,861027e-9,.999229,201034e-9,0,.00231198,.998662,259069e-9,0,.00458147,.995299,245439e-9,0,.00770895,.992732,24498e-8,0,.0117126,.990847,273211e-9,0,.0165989,.988911,316492e-9,0,.0223674,.98654,37161e-8,0,.0290135,.982636,410352e-9,0,.0365309,.977346,421756e-9,0,.0449117,.972909,475578e-9,0,.0541481,.966821,522482e-9,0,.0642326,.958686,545008e-9,0,.075158,.949754,589286e-9,0,.0869181,.939184,619995e-9,0,.0995074,.927505,654266e-9,0,.112922,.916606,682362e-9,0,.127157,.906707,704286e-9,0,.142212,.895937,725909e-9,0,.158085,.883913,743939e-9,0,.174776,.870642,755157e-9,0,.192287,.856241,764387e-9,0,.210619,.84069,771032e-9,0,.229775,.823728,765906e-9,0,.249761,.806481,767604e-9,0,.270582,.787924,754385e-9,0,.292243,.770588,749668e-9,0,.314753,.751991,731613e-9,0,.338118,.733407,717655e-9,0,.362347,.713688,700604e-9,0,.387447,.693595,678765e-9,0,.413424,.673426,657042e-9,0,.440284,.65359,635892e-9,0,.468027,.633576,611569e-9,0,.496645,.613144,586011e-9,0,.526122,.592711,563111e-9,0,.556417,.572722,537699e-9,0,.587451,.552762,512556e-9,0,.619048,.532985,489757e-9,0,.650794,.513219,464139e-9,0,.68254,.493992,442193e-9,0,.714286,.47509,418629e-9,0,.746032,.456287,397045e-9,0,.777778,.438152,375504e-9,0,.809524,.420294,35492e-8,0,.84127,.402749,335327e-9,0,.873016,.385879,316422e-9,0,.904762,.369352,298333e-9,0,.936508,.353301,281417e-9,0,.968254,.337781,265203e-9,0,1,1,968267e-10,0,0,1,968284e-10,0,0,1,968556e-10,0,0,.999999,969733e-10,0,0,.999997,972913e-10,0,0,.999993,979688e-10,0,0,.999984,992239e-10,0,0,.999969,101356e-9,0,0,.999946,104784e-9,0,0,.999913,110111e-9,0,0,.999868,118217e-9,0,0,.999801,130396e-9,0,0,.999712,148523e-9,0,124907e-10,.999589,175233e-9,0,355405e-9,.999416,213999e-9,0,.0013528,.999136,268529e-9,0,.00312557,.998367,333088e-9,0,.00573045,.994701,304757e-9,0,.00919397,.992497,318031e-9,0,.0135261,.990608,353863e-9,0,.0187278,.988715,409044e-9,0,.0247947,.986241,472967e-9,0,.0317196,.981696,495104e-9,0,.039494,.977097,532873e-9,0,.0481087,.972583,594447e-9,0,.0575549,.966142,636867e-9,0,.0678242,.95823,669899e-9,0,.0789089,.949677,719499e-9,0,.0908023,.939226,750584e-9,0,.103499,.927501,793183e-9,0,.116993,.915199,81995e-8,0,.131282,.90498,847654e-9,0,.146364,.894243,868929e-9,0,.162237,.882154,884278e-9,0,.178902,.869161,898108e-9,0,.196358,.854751,901254e-9,0,.21461,.839368,90679e-8,0,.23366,.822874,901541e-9,0,.253512,.805514,897297e-9,0,.274174,.78716,881856e-9,0,.29565,.769061,870032e-9,0,.31795,.751,851719e-9,0,.341081,.732614,830671e-9,0,.365053,.713171,806569e-9,0,.389874,.693472,78338e-8,0,.415553,.673528,756404e-9,0,.442098,.653397,726872e-9,0,.469512,.633781,700494e-9,0,.497794,.613877,67105e-8,0,.526935,.593506,640361e-9,0,.556908,.573667,613502e-9,0,.587657,.553932,583177e-9,0,.61906,.534345,554375e-9,0,.650794,.515042,527811e-9,0,.68254,.495674,499367e-9,0,.714286,.477132,47429e-8,0,.746032,.458609,447726e-9,0,.777778,.440354,424205e-9,0,.809524,.422765,399549e-9,0,.84127,.405472,378315e-9,0,.873016,.388482,355327e-9,0,.904762,.372191,336122e-9,0,.936508,.356099,315247e-9,0,.968254,.340737,29794e-8,0,1,1,143327e-9,0,0,1,14333e-8,0,0,1,143366e-9,0,0,.999999,143524e-9,0,0,.999996,143952e-9,0,0,.999991,144862e-9,0,0,.999981,146544e-9,0,0,.999966,149391e-9,0,0,.999941,153946e-9,0,0,.999905,160971e-9,0,0,.999852,171562e-9,0,0,.99978,18729e-8,0,0,.999681,210386e-9,0,826239e-10,.999546,243906e-9,0,664807e-9,.999352,291739e-9,0,.00196192,.999027,357419e-9,0,.00405941,.997886,422349e-9,0,.00699664,.99419,385008e-9,0,.0107896,.99214,409775e-9,0,.0154415,.990274,456418e-9,0,.0209488,.988455,527008e-9,0,.0273037,.985804,597685e-9,0,.0344969,.98103,613124e-9,0,.0425183,.976674,668321e-9,0,.0513575,.972021,736985e-9,0,.0610046,.965274,773789e-9,0,.0714508,.958046,830852e-9,0,.0826877,.949333,875766e-9,0,.0947085,.939135,917088e-9,0,.107507,.927119,952244e-9,0,.121078,.91469,990626e-9,0,.135419,.903006,.00101304,0,.150526,.892368,.00103834,0,.166399,.880231,.00105002,0,.183038,.867432,.00106331,0,.200443,.853208,.00106783,0,.218618,.837956,.00106458,0,.237566,.821772,.00105945,0,.257291,.804328,.00104685,0,.2778,.786465,.00103178,0,.2991,.768004,.00101077,0,.321199,.74972,985504e-9,0,.344106,.731682,962893e-9,0,.36783,.712813,932146e-9,0,.392383,.693139,89871e-8,0,.417774,.673566,869678e-9,0,.444013,.653483,835525e-9,0,.471107,.633891,799853e-9,0,.49906,.614433,766838e-9,0,.527869,.594586,732227e-9,0,.557517,.574769,696442e-9,0,.587966,.555149,663935e-9,0,.61913,.535898,629826e-9,0,.650794,.516753,596486e-9,0,.68254,.497816,567078e-9,0,.714286,.479034,534399e-9,0,.746032,.460975,507013e-9,0,.777778,.442935,477421e-9,0,.809524,.425263,451101e-9,0,.84127,.408248,424964e-9,0,.873016,.391339,39993e-8,0,.904762,.37513,377619e-9,0,.936508,.359172,354418e-9,0,.968254,.343876,334823e-9,0,1,1,209042e-9,0,0,1,209045e-9,0,0,1,209093e-9,0,0,.999999,209304e-9,0,0,.999996,209871e-9,0,0,.999991,211078e-9,0,0,.999979,213304e-9,0,0,.999963,217061e-9,0,0,.999933,223042e-9,0,0,.999894,232206e-9,0,0,.999837,245901e-9,0,0,.999756,266023e-9,0,102927e-11,.999648,295204e-9,0,233468e-9,.999499,336958e-9,0,.00108237,.999283,395563e-9,0,.00268832,.998896,473785e-9,0,.00511138,.997006,520008e-9,0,.00837705,.993819,497261e-9,0,.0124928,.991632,523722e-9,0,.0174561,.989875,587258e-9,0,.0232596,.988109,676329e-9,0,.0298932,.985155,747701e-9,0,.0373453,.980479,768803e-9,0,.0456045,.976271,841054e-9,0,.0546593,.971347,911469e-9,0,.0644994,.964528,953057e-9,0,.0751152,.957632,.00102221,0,.0864981,.948681,.00106122,0,.0986407,.938716,.00111857,0,.111537,.926629,.00114762,0,.125182,.914025,.00118995,0,.139571,.901026,.00121228,0,.154703,.890358,.00123946,0,.170576,.878283,.0012527,0,.18719,.865459,.00125536,0,.204547,.851407,.00126134,0,.222648,.836276,.00124759,0,.241498,.820436,.00124443,0,.261101,.803253,.00122071,0,.281465,.785562,.00120107,0,.302595,.76718,.00117762,0,.324501,.748551,.00114289,0,.347192,.730564,.00110872,0,.370679,.712253,.00107636,0,.394973,.692867,.00103646,0,.420085,.673695,996793e-9,0,.446027,.653912,95675e-8,0,.47281,.634129,916739e-9,0,.500441,.615004,874401e-9,0,.528921,.595587,833411e-9,0,.558244,.575965,794556e-9,0,.588384,.5566,75196e-8,0,.619281,.537428,716381e-9,0,.650795,.518623,676558e-9,0,.68254,.499964,64074e-8,0,.714286,.481356,605984e-9,0,.746032,.463279,570256e-9,0,.777778,.445673,540138e-9,0,.809524,.428032,507299e-9,0,.84127,.411112,479553e-9,0,.873016,.394444,450737e-9,0,.904762,.378247,424269e-9,0,.936508,.362415,399111e-9,0,.968254,.347103,375274e-9,0,1,1,300729e-9,0,0,1,300733e-9,0,0,1,300797e-9,0,0,.999998,301072e-9,0,0,.999996,301817e-9,0,0,.999989,303398e-9,0,0,.999977,306309e-9,0,0,.999958,311209e-9,0,0,.999927,318975e-9,0,0,.999884,330804e-9,0,0,.99982,34834e-8,0,0,.999733,373854e-9,0,326995e-10,.999613,410424e-9,0,477174e-9,.999447,462047e-9,0,.00161099,.999204,533322e-9,0,.00353153,.998725,624964e-9,0,.00627965,.995871,631786e-9,0,.0098693,.993194,632017e-9,0,.0143011,.991541,68923e-8,0,.019568,.989773,766892e-9,0,.0256593,.987647,863668e-9,0,.0325625,.984193,922089e-9,0,.0402647,.980016,970749e-9,0,.0487532,.975859,.00106027,0,.058016,.970514,.00112239,0,.0680419,.963625,.00117212,0,.0788208,.956959,.00125211,0,.0903439,.947956,.00129411,0,.102604,.93809,.00135879,0,.115594,.92659,.00139309,0,.129309,.913829,.00143253,0,.143745,.90005,.00145809,0,.158901,.888129,.0014748,0,.174774,.87607,.00148756,0,.191365,.863461,.00148714,0,.208674,.849594,.00148892,0,.226705,.834531,.00146496,0,.245461,.81903,.0014579,0,.264947,.802122,.00143039,0,.28517,.78445,.00139717,0,.306137,.766434,.00136312,0,.327857,.747816,.00132597,0,.350341,.729519,.00128323,0,.373598,.711454,.00123803,0,.397642,.692699,.00119097,0,.422485,.673723,.00114565,0,.448139,.654386,.00109552,0,.474619,.634673,.00104553,0,.501933,.615554,99985e-8,0,.530089,.596462,948207e-9,0,.559087,.577385,902299e-9,0,.588913,.558257,856448e-9,0,.619525,.5392,810395e-9,0,.650826,.520543,768558e-9,0,.68254,.502206,7239e-7,0,.714286,.48402,685794e-9,0,.746032,.465779,64471e-8,0,.777778,.448455,609583e-9,0,.809524,.431091,57227e-8,0,.84127,.414147,54042e-8,0,.873016,.39765,506545e-9,0,.904762,.381576,477635e-9,0,.936508,.365881,448446e-9,0,.968254,.350582,421424e-9,0,1,1,427144e-9,0,0,1,427151e-9,0,0,1,427232e-9,0,0,.999998,42759e-8,0,0,.999995,428555e-9,0,0,.999988,430603e-9,0,0,.999976,434368e-9,0,0,.999952,440688e-9,0,0,.999919,450667e-9,0,0,.999871,46578e-8,0,0,.999801,488024e-9,0,0,.999704,520092e-9,0,129791e-9,.999572,565553e-9,0,821056e-9,.999389,628906e-9,0,.00225241,.999114,714911e-9,0,.00449109,.998488,819218e-9,0,.00756249,.995234,80415e-8,0,.0114716,.993021,830181e-9,0,.0162131,.991407,902645e-9,0,.021776,.989625,996934e-9,0,.0281471,.987064,.00109707,0,.0353118,.983265,.00114353,0,.0432562,.979535,.0012272,0,.0519665,.975224,.00132642,0,.0614298,.969574,.00138092,0,.0716348,.963021,.00145896,0,.0825709,.956046,.00152834,0,.094229,.947136,.00158217,0,.106602,.937313,.0016347,0,.119682,.926073,.00168383,0,.133465,.913121,.00171627,0,.147947,.899165,.00174229,0,.163125,.885891,.00176137,0,.178998,.873783,.00176406,0,.195566,.861331,.00176156,0,.21283,.847569,.00175346,0,.230793,.832785,.00172753,0,.249459,.817442,.00170204,0,.268832,.800613,.00166576,0,.28892,.783597,.00162909,0,.30973,.76571,.0015826,0,.331271,.747021,.00153106,0,.353554,.728593,.00148036,0,.37659,.710661,.00142808,0,.400391,.692426,.00136906,0,.424973,.673623,.00131066,0,.450347,.65494,.00125569,0,.476531,.635448,.00119517,0,.503535,.616221,.00113828,0,.531372,.597531,.0010816,0,.560047,.578795,.00102673,0,.589554,.559892,970985e-9,0,.619869,.541307,919773e-9,0,.650923,.522608,868479e-9,0,.68254,.504484,82137e-8,0,.714286,.486603,772916e-9,0,.746032,.468802,730353e-9,0,.777778,.451172,684955e-9,0,.809524,.434348,647565e-9,0,.84127,.417445,605863e-9,0,.873016,.401077,571885e-9,0,.904762,.385039,536034e-9,0,.936508,.369483,504227e-9,0,.968254,.354272,473165e-9,0,1,1,599525e-9,0,0,1,599533e-9,0,0,1,599639e-9,0,0,.999998,600097e-9,0,0,.999994,601336e-9,0,0,.999987,603958e-9,0,0,.999972,608775e-9,0,0,.999949,616842e-9,0,0,.999912,629534e-9,0,0,.999857,648658e-9,0,0,.999781,676615e-9,0,538873e-11,.999674,716574e-9,0,308602e-9,.999528,772641e-9,0,.00127003,.999326,849806e-9,0,.00300783,.999009,952682e-9,0,.00556637,.998112,.00106394,0,.00895889,.994496,.00102228,0,.0131827,.992806,.00108586,0,.0182277,.991211,.0011759,0,.0240795,.989415,.00128955,0,.030723,.986499,.00139038,0,.0381418,.982679,.00144539,0,.046321,.978839,.00153954,0,.0552459,.974295,.00164417,0,.0649034,.968784,.00171517,0,.0752814,.962324,.00180282,0,.0863693,.954956,.00186387,0,.0981578,.94624,.00193817,0,.110639,.936517,.00198156,0,.123806,.925186,.00203042,0,.137655,.91252,.0020664,0,.15218,.898441,.00207822,0,.16738,.884394,.0020992,0,.183253,.871273,.00208748,0,.199799,.859057,.00208686,0,.21702,.845243,.00205519,0,.234918,.830723,.00202868,0,.253496,.815801,.00199501,0,.272761,.79914,.00194193,0,.292719,.782372,.00188824,0,.313377,.76482,.00183695,0,.334745,.746586,.00177418,0,.356833,.7281,.00170628,0,.379654,.709842,.00164063,0,.403221,.692019,.00157355,0,.427548,.67364,.00150262,0,.452651,.655277,.00143473,0,.478545,.636438,.00136371,0,.505246,.617364,.00129911,0,.532768,.598603,.00123014,0,.561122,.580195,.00116587,0,.590309,.561786,.00110398,0,.620318,.543377,.00104148,0,.651102,.525093,983984e-9,0,.682545,.506791,92667e-8,0,.714286,.489291,874326e-9,0,.746032,.471811,821734e-9,0,.777778,.454435,774698e-9,0,.809524,.437493,727302e-9,0,.84127,.420977,684039e-9,0,.873016,.404729,64373e-8,0,.904762,.388756,60285e-8,0,.936508,.373344,56765e-8,0,.968254,.358191,531929e-9,0,1,1,832169e-9,0,0,1,832178e-9,0,0,1,83231e-8,0,0,.999998,832893e-9,0,0,.999995,834465e-9,0,0,.999985,837791e-9,0,0,.999969,843893e-9,0,0,.999944,854086e-9,0,0,.999903,870071e-9,0,0,.999843,894042e-9,0,0,.999759,928865e-9,0,531805e-10,.999643,978242e-9,0,579365e-9,.99948,.00104684,0,.00182774,.999255,.00114012,0,.00387804,.998885,.00126188,0,.00675709,.997405,.00135888,0,.010468,.99424,.00133626,0,.0150018,.992458,.00140905,0,.0203443,.990929,.00152305,0,.0264786,.989116,.00165882,0,.0333875,.985624,.00174128,0,.0410536,.982003,.00182108,0,.0494609,.978336,.00194498,0,.0585941,.973184,.00202708,0,.0684396,.9678,.00212166,0,.0789851,.961348,.00221366,0,.0902199,.953841,.00228219,0,.102134,.94534,.00235662,0,.114721,.935552,.00240572,0,.127972,.924064,.00244405,0,.141884,.911827,.00247557,0,.156451,.897731,.00248374,0,.171672,.883409,.00249863,0,.187545,.868625,.00246688,0,.20407,.856529,.00246523,0,.221249,.842999,.00242368,0,.239083,.828505,.00237354,0,.257578,.813825,.00232588,0,.276738,.797813,.00226731,0,.296569,.781097,.00219704,0,.31708,.764038,.00212394,0,.338281,.746067,.00204786,0,.360181,.727687,.00196728,0,.382794,.709571,.00188779,0,.406133,.691503,.00180532,0,.430213,.673673,.00171849,0,.45505,.655732,.00164147,0,.480662,.637399,.00155858,0,.507065,.618616,.00147641,0,.534278,.60005,.00140125,0,.562313,.581713,.00132441,0,.59118,.563546,.00125014,0,.620875,.545605,.00118249,0,.651373,.527559,.0011116,0,.682593,.509764,.00104979,0,.714286,.49193,985977e-9,0,.746032,.475011,928592e-9,0,.777778,.457878,873466e-9,0,.809524,.440979,819585e-9,0,.84127,.424613,772365e-9,0,.873016,.408549,722195e-9,0,.904762,.392771,680014e-9,0,.936508,.377317,636797e-9,0,.968254,.362352,598318e-9,0,1,1,.00114313,0,0,1,.00114314,0,0,.999999,.00114331,0,0,.999998,.00114404,0,0,.999994,.00114601,0,0,.999984,.00115019,0,0,.999967,.00115784,0,0,.999937,.0011706,0,0,.999894,.00119054,0,0,.999828,.00122031,0,0,.999735,.00126331,0,169263e-9,.999606,.00132382,0,949167e-9,.999426,.0014071,0,.00249668,.999173,.00151895,0,.00486392,.99873,.00166102,0,.00806323,.996243,.0017023,0,.0120895,.993779,.00172782,0,.0169288,.9919,.0018108,0,.0225633,.990524,.00196028,0,.028974,.98868,.00212014,0,.036142,.984663,.00217598,0,.044049,.981457,.00230563,0,.0526781,.977608,.00243966,0,.0620137,.972215,.00251336,0,.0720418,.966798,.0026285,0,.0827499,.960241,.00271409,0,.0941271,.952489,.00278381,0,.106164,.944127,.00285399,0,.118852,.934282,.00290994,0,.132185,.923271,.00294558,0,.146157,.910803,.00296269,0,.160766,.896705,.00296803,0,.176007,.88238,.00296637,0,.19188,.867116,.00293163,0,.208385,.853636,.00289418,0,.225523,.840469,.00284663,0,.243296,.82639,.00278594,0,.261709,.811759,.00271618,0,.280767,.796113,.00263187,0,.300476,.779518,.00254589,0,.320845,.763142,.00246003,0,.341883,.745464,.00236529,0,.363601,.727491,.00226536,0,.386011,.709414,.00216375,0,.409128,.691396,.00207127,0,.432967,.67368,.00197106,0,.457545,.656049,.00187022,0,.482881,.638188,.00177605,0,.508992,.620177,.00168482,0,.535899,.601506,.00158909,0,.563619,.58362,.00150583,0,.592165,.565496,.00141791,0,.621544,.54789,.00133693,0,.651743,.530323,.00126038,0,.682709,.512795,.00118556,0,.714286,.495199,.00111527,0,.746032,.478101,.0010489,0,.777778,.461511,984264e-9,0,.809524,.444879,92591e-8,0,.84127,.428424,866582e-9,0,.873016,.412495,814463e-9,0,.904762,.396975,764498e-9,0,.936508,.381614,715967e-9,0,.968254,.366732,672483e-9,0,1,1,.00155501,0,0,1,.00155503,0,0,1,.00155524,0,0,.999998,.00155615,0,0,.999994,.0015586,0,0,.999983,.00156379,0,0,.999963,.0015733,0,0,.999932,.00158911,0,0,.999882,.00161376,0,0,.99981,.00165041,0,100875e-10,.999708,.00170304,0,367658e-9,.999565,.00177658,0,.0014234,.999368,.00187688,0,.00327939,.999081,.00200989,0,.00596629,.99852,.00217177,0,.0094852,.99549,.0021745,0,.013824,.993252,.00222357,0,.0189642,.991727,.00235022,0,.0248856,.989951,.00250561,0,.0315669,.988029,.00268829,0,.0389882,.984029,.0027496,0,.0471302,.980683,.00289793,0,.0559754,.976554,.00303315,0,.0655081,.97139,.00313257,0,.0757138,.965544,.00323656,0,.08658,.95912,.00333432,0,.0980954,.951183,.0034039,0,.110251,.942974,.00347515,0,.123038,.932642,.00350381,0,.13645,.922158,.00354519,0,.150482,.909404,.00353851,0,.165129,.896071,.0035435,0,.18039,.881206,.00349936,0,.196263,.866077,.00347256,0,.212748,.85093,.003415,0,.229847,.837703,.00333367,0,.247561,.823878,.003249,0,.265895,.809449,.00316347,0,.284854,.794379,.00306351,0,.304445,.778138,.0029499,0,.324675,.761997,.00284099,0,.345555,.744938,.00272104,0,.367095,.727212,.00260715,0,.389309,.709549,.00248855,0,.41221,.691704,.00236783,0,.435814,.673689,.00225178,0,.460138,.656453,.00213765,0,.485203,.639128,.00202178,0,.511028,.621512,.00191443,0,.537634,.603598,.00180977,0,.565041,.58559,.00170456,0,.593268,.567852,.00160927,0,.622327,.5503,.00151395,0,.652217,.533033,.00142499,0,.682907,.515942,.00133955,0,.714296,.498814,.0012602,0,.746032,.481595,.00118188,0,.777778,.465117,.00111171,0,.809524,.448865,.00104091,0,.84127,.432711,976618e-9,0,.873016,.416822,91859e-8,0,.904762,.401272,857704e-9,0,.936508,.386226,807172e-9,0,.968254,.371321,75464e-8,0,1,1,.00209596,0,0,1,.00209598,0,0,1,.00209624,0,0,.999997,.00209736,0,0,.999991,.00210039,0,0,.999979,.00210678,0,0,.999959,.00211847,0,0,.999925,.0021379,0,0,.99987,.00216809,0,0,.999791,.00221281,0,681487e-10,.999677,.00227669,0,658161e-9,.999521,.00236533,0,.00200635,.999301,.00248514,0,.0041779,.998977,.00264185,0,.00718648,.998191,.00281695,0,.0110239,.994801,.00278518,0,.015672,.993091,.00288774,0,.0211091,.991571,.00303931,0,.0273123,.9897,.00321643,0,.034259,.987023,.00337332,0,.0419282,.983289,.00346146,0,.0502998,.979892,.00363704,0,.0593562,.975111,.00373601,0,.069081,.970351,.0038842,0,.0794598,.964131,.00397053,0,.0904798,.957747,.00408078,0,.10213,.949536,.00413533,0,.1144,.941372,.00420305,0,.127284,.931049,.00422815,0,.140772,.920647,.00425048,0,.154862,.908033,.0042281,0,.169548,.895028,.00422026,0,.184828,.879968,.00415042,0,.200701,.864875,.00408821,0,.217167,.84918,.00400909,0,.234227,.834934,.00391178,0,.251884,.821397,.00380066,0,.270141,.807135,.00367974,0,.289004,.792363,.00355172,0,.308479,.776661,.003411,0,.328575,.760705,.00328123,0,.349301,.744408,.00314003,0,.370668,.726994,.0029906,0,.392689,.709598,.00285034,0,.415379,.692112,.00271179,0,.438754,.674435,.00257185,0,.46283,.65676,.00243425,0,.48763,.639982,.00230351,0,.513173,.622983,.0021777,0,.539482,.605471,.00204991,0,.566579,.58796,.00193759,0,.594488,.570463,.00181976,0,.623226,.553058,.00171497,0,.6528,.535894,.00161109,0,.683198,.519089,.00151394,0,.714354,.502454,.00142122,0,.746032,.485681,.00133488,0,.777778,.468935,.00124975,0,.809524,.452951,.00117309,0,.84127,.437139,.00110155,0,.873016,.421446,.00103124,0,.904762,.405951,966387e-9,0,.936508,.391003,908119e-9,0,.968254,.376198,848057e-9,0,1,1,.00280076,0,0,1,.00280078,0,0,.999999,.00280109,0,0,.999997,.00280246,0,0,.999992,.00280616,0,0,.999979,.00281396,0,0,.999956,.00282822,0,0,.999916,.00285186,0,0,.999857,.0028885,0,0,.999768,.00294259,0,196026e-9,.999645,.00301946,0,.00104842,.99947,.00312541,0,.00270199,.999229,.00326733,0,.00519449,.998852,.00344992,0,.00852602,.997558,.00361052,0,.0126804,.994417,.0035898,0,.017635,.992824,.00372393,0,.023365,.991344,.00390695,0,.0298456,.989337,.00410392,0,.0370529,.985811,.00420987,0,.0449651,.982772,.00437488,0,.0535615,.979001,.00455069,0,.0628243,.974102,.00464462,0,.0727368,.969197,.00480577,0,.0832844,.962759,.00487818,0,.0944545,.956207,.00498176,0,.106236,.947909,.00503392,0,.118619,.939596,.00507474,0,.131595,.929642,.00509798,0,.145159,.918807,.00508476,0,.159305,.906921,.00505634,0,.174028,.893312,.00498845,0,.189327,.878933,.0049133,0,.2052,.863986,.0048259,0,.221647,.847936,.00470848,0,.23867,.832253,.00456889,0,.25627,.818619,.00442726,0,.274453,.804788,.00427677,0,.293222,.790241,.00411906,0,.312585,.775162,.00394833,0,.33255,.759463,.00377366,0,.353126,.743598,.00361026,0,.374324,.72697,.00343627,0,.396158,.709646,.00326422,0,.418641,.69277,.00309717,0,.44179,.675371,.0029356,0,.465624,.657863,.00277712,0,.490163,.640772,.00261738,0,.515429,.624441,.0024737,0,.541445,.607497,.00233125,0,.568236,.590438,.00218994,0,.595828,.573224,.0020664,0,.624242,.556168,.00193526,0,.653496,.539232,.00182463,0,.683588,.522352,.00170735,0,.714482,.506172,.00160555,0,.746032,.489842,.00150451,0,.777778,.473463,.00140938,0,.809524,.457266,.00132568,0,.84127,.441609,.0012376,0,.873016,.426348,.00116265,0,.904762,.411002,.00108935,0,.936508,.396045,.00101946,0,.968254,.381448,955665e-9,0,1,1,.0037121,0,0,1,.00371213,0,0,1,.00371251,0,0,.999997,.00371417,0,0,.99999,.00371863,0,0,.999977,.00372807,0,0,.99995,.00374529,0,0,.999908,.0037738,0,0,.999843,.00381789,0,123596e-10,.999745,.00388273,0,407442e-9,.999608,.00397443,0,.0015447,.999415,.00409998,0,.00351385,.999143,.00426662,0,.0063316,.9987,.00447625,0,.00998679,.996363,.00455323,0,.0144569,.994021,.00461052,0,.0197151,.992372,.00476359,0,.0257344,.991007,.00499101,0,.0324882,.988767,.0051972,0,.0399517,.984872,.00528407,0,.0481022,.982004,.00548926,0,.0569191,.977714,.00564385,0,.0663839,.973076,.0057693,0,.0764801,.967565,.0058924,0,.0871928,.961384,.00599629,0,.0985095,.954435,.00605998,0,.110419,.946303,.0061133,0,.122912,.937662,.00612028,0,.13598,.927867,.00612209,0,.149617,.916475,.00604813,0,.163817,.90541,.00603088,0,.178577,.891591,.00592218,0,.193894,.877573,.00578854,0,.209767,.862511,.00566648,0,.226196,.846861,.00551481,0,.243182,.83068,.00533754,0,.260728,.815725,.00515487,0,.278837,.802321,.0049655,0,.297515,.787826,.00475421,0,.316768,.773454,.00456002,0,.336605,.758224,.00434727,0,.357034,.74265,.00414444,0,.378067,.726729,.00393738,0,.399717,.710155,.00373575,0,.421998,.693312,.00353736,0,.444928,.67653,.00334368,0,.468523,.659444,.00315981,0,.492806,.642051,.00297809,0,.517798,.625758,.00280592,0,.543525,.609615,.00264254,0,.570012,.592919,.00248459,0,.597288,.576298,.00233327,0,.625379,.559489,.00219519,0,.654307,.542891,.00205441,0,.684084,.526255,.00193385,0,.714693,.509853,.00180745,0,.746044,.494131,.00169817,0,.777778,.478114,.0015913,0,.809524,.462274,.00148981,0,.84127,.446412,.00139537,0,.873016,.431274,.00130984,0,.904762,.41635,.00122403,0,.936508,.401476,.00114809,0,.968254,.386993,.00107563,0,1,1,.00488216,0,0,1,.0048822,0,0,1,.00488265,0,0,.999997,.00488463,0,0,.999988,.00488999,0,0,.999974,.00490129,0,0,.999946,.00492191,0,0,.999897,.00495598,0,0,.999825,.00500855,0,744791e-10,.999718,.00508559,0,712744e-9,.999565,.005194,0,.00215249,.999352,.00534147,0,.00444576,.999046,.00553523,0,.00759218,.998492,.00577016,0,.0115714,.995564,.00578487,0,.0163557,.993339,.00586414,0,.021915,.991834,.00606002,0,.0282201,.990496,.00633312,0,.0352433,.987826,.00651941,0,.042959,.98383,.00660842,0,.0513439,.98109,.00685523,0,.0603772,.976131,.00695778,0,.0700402,.971922,.00714236,0,.0803163,.965901,.00721437,0,.0911908,.959606,.00732017,0,.102651,.952504,.00735788,0,.114686,.944365,.00738493,0,.127286,.935652,.00737969,0,.140443,.925813,.00733612,0,.154151,.914397,.00723094,0,.168405,.903257,.00714002,0,.183201,.890015,.00700149,0,.198536,.876014,.00682813,0,.214409,.861436,.00665567,0,.23082,.845752,.00644526,0,.24777,.829169,.00621635,0,.265263,.813435,.00597789,0,.283301,.799701,.00575694,0,.301889,.785726,.00549866,0,.321035,.77152,.0052503,0,.340746,.75683,.00499619,0,.361032,.741951,.0047543,0,.381904,.726367,.0045084,0,.403374,.710537,.00426784,0,.425457,.693965,.00403487,0,.448169,.677724,.0038075,0,.47153,.66117,.00359431,0,.495561,.644274,.00338354,0,.520284,.627449,.00318163,0,.545725,.611645,.00299672,0,.571911,.595614,.00281016,0,.598873,.579426,.00264252,0,.62664,.563016,.00247509,0,.655239,.546728,.00232647,0,.684692,.530539,.00217803,0,.714999,.514164,.00204216,0,.746106,.498344,.00191403,0,.777778,.482957,.00179203,0,.809524,.467336,.00167695,0,.84127,.451994,.00157567,0,.873016,.436514,.00147113,0,.904762,.42178,.00138034,0,.936508,.407271,.00129219,0,.968254,.392822,.0012098,0,1,1,.00637427,0,0,1,.00637431,0,0,.999999,.00637485,0,0,.999996,.00637721,0,0,.999987,.00638357,0,0,.999971,.006397,0,0,.999939,.00642142,0,0,.999888,.00646177,0,0,.999807,.00652387,0,207916e-9,.999689,.00661454,0,.00112051,.99952,.00674155,0,.00287719,.999283,.00691313,0,.00550145,.998936,.00713598,0,.00897928,.998165,.00738501,0,.0132829,.994847,.00734388,0,.01838,.993182,.00749991,0,.0242381,.991665,.0077246,0,.030826,.989708,.00797579,0,.0381152,.986663,.00813011,0,.0460794,.983288,.00830365,0,.0546951,.980104,.00853496,0,.0639411,.974855,.00861045,0,.0737988,.97045,.00879133,0,.0842516,.964509,.00886377,0,.0952848,.957594,.00890346,0,.106886,.950546,.00893289,0,.119044,.942225,.00890074,0,.131749,.933365,.00886826,0,.144994,.923202,.0087316,0,.158772,.912605,.00863082,0,.173078,.901099,.00847403,0,.187908,.888177,.00825838,0,.203261,.873955,.00801834,0,.219134,.860091,.00779026,0,.235527,.84434,.00752478,0,.252443,.828517,.00724074,0,.269883,.81239,.00693769,0,.287851,.79721,.00664817,0,.306352,.783489,.00634763,0,.325393,.769514,.00604221,0,.344981,.755419,.00573568,0,.365126,.741083,.00544359,0,.385839,.726059,.00515515,0,.407132,.710809,.00487139,0,.42902,.695052,.00459846,0,.45152,.678886,.00433412,0,.474651,.663042,.00407981,0,.498433,.646634,.00384264,0,.52289,.630117,.00360897,0,.548048,.613804,.00338863,0,.573936,.598338,.00318486,0,.600584,.582687,.00298377,0,.628027,.566809,.00280082,0,.656295,.550817,.00262255,0,.685417,.534937,.00245835,0,.715406,.519151,.00230574,0,.74624,.503118,.0021549,0,.777778,.487723,.00202008,0,.809524,.472725,.00189355,0,.84127,.457599,.00177108,0,.873016,.442558,.00165843,0,.904762,.427624,.00155494,0,.936508,.413171,.00145273,0,.968254,.399122,.00136454,0,1,1,.00826496,0,0,1,.00826499,0,0,1,.00826564,0,0,.999996,.00826842,0,0,.999987,.00827589,0,0,.999967,.00829167,0,0,.999933,.00832037,0,0,.999876,.00836768,0,109338e-10,.999786,.00844031,0,427145e-9,.999655,.00854603,0,.0016384,.999468,.00869337,0,.00372392,.999203,.008891,0,.00668513,.998803,.00914387,0,.0104968,.99748,.00935838,0,.015125,.994446,.00933309,0,.0205338,.99292,.00953084,0,.0266884,.991414,.0097893,0,.0335565,.989049,.0100228,0,.0411086,.98582,.0101664,0,.0493181,.982441,.0103582,0,.0581613,.978595,.0105292,0,.0676169,.973495,.0106274,0,.0776661,.968405,.0107261,0,.0882926,.962717,.0108234,0,.0994817,.955478,.0108102,0,.111221,.948275,.0107914,0,.123499,.940006,.0107161,0,.136308,.930831,.0106309,0,.149639,.920648,.0104083,0,.163485,.910205,.0102312,0,.177843,.898445,.0100051,0,.192707,.885986,.00971928,0,.208077,.872204,.00940747,0,.22395,.858436,.0091085,0,.240326,.843454,.00876595,0,.257208,.827437,.00839794,0,.274596,.811488,.00803692,0,.292496,.796039,.00767352,0,.310911,.781083,.0073097,0,.329849,.767642,.00694032,0,.349316,.753901,.00657476,0,.369323,.740131,.00622699,0,.38988,.725845,.0058838,0,.410999,.710991,.00555586,0,.432696,.696002,.00523089,0,.454987,.680461,.00492494,0,.47789,.664875,.00463464,0,.501426,.649273,.00435422,0,.52562,.63302,.0040875,0,.550498,.61705,.00384075,0,.576089,.601154,.00359557,0,.602427,.586008,.00337636,0,.629544,.570699,.00316019,0,.657479,.555166,.00296033,0,.686264,.539645,.00277552,0,.715924,.524159,.00259499,0,.746459,.508682,.00243257,0,.777789,.493163,.00227851,0,.809524,.478004,.00213083,0,.84127,.46347,.00199502,0,.873016,.448778,.00186967,0,.904762,.434105,.00174732,0,.936508,.419576,.00163861,0,.968254,.405541,.00153341,0,1,1,.0106462,0,0,1,.0106462,0,0,.999999,.010647,0,0,.999995,.0106502,0,0,.999985,.0106589,0,0,.999964,.0106773,0,0,.999925,.0107106,0,0,.999861,.0107655,0,712986e-10,.999763,.0108497,0,743959e-9,.999616,.0109716,0,.00227361,.999408,.0111408,0,.0046983,.999112,.0113659,0,.00800158,.998637,.0116475,0,.0121493,.996223,.0117231,0,.0171023,.994006,.0118064,0,.0228218,.992444,.0120254,0,.0292711,.991028,.0123314,0,.036417,.98803,.0124954,0,.0442295,.984816,.0126538,0,.0526815,.981399,.0128537,0,.0617492,.977085,.0129694,0,.0714114,.972154,.013091,0,.0816495,.966617,.0131166,0,.0924472,.960628,.0131583,0,.10379,.953295,.0131094,0,.115665,.94575,.0129966,0,.128062,.937654,.0128796,0,.140972,.927716,.0126477,0,.154387,.917932,.0123889,0,.168301,.907719,.012131,0,.182709,.89584,.0118013,0,.197608,.883526,.0114145,0,.212994,.870301,.0110075,0,.228867,.856272,.0106019,0,.245227,.842251,.0101938,0,.262074,.826466,.00973254,0,.279412,.810859,.0092846,0,.297244,.795051,.00883304,0,.315575,.780053,.00840272,0,.334412,.76575,.00796438,0,.35376,.752298,.00752526,0,.373631,.739153,.00711486,0,.394034,.725514,.00670361,0,.414983,.711473,.00632656,0,.436491,.696936,.00595206,0,.458575,.682126,.00559191,0,.481253,.667027,.00525362,0,.504547,.651875,.00493805,0,.528481,.636463,.00462848,0,.553081,.620641,.00433936,0,.578377,.604931,.00407,0,.604404,.589549,.00380864,0,.631197,.574712,.00357049,0,.658795,.559775,.00334466,0,.687238,.544514,.00312505,0,.716559,.529555,.00293199,0,.746776,.514402,.00274204,0,.777849,.499302,.00256647,0,.809524,.484114,.00239901,0,.84127,.469308,.00225148,0,.873016,.455133,.00210178,0,.904762,.440939,.0019727,0,.936508,.426627,.00184382,0,.968254,.412509,.00172548,0,1,1,.013628,0,0,1,.0136281,0,0,.999999,.0136289,0,0,.999995,.0136327,0,0,.999983,.0136427,0,0,.99996,.0136638,0,0,.999917,.0137022,0,0,.999846,.0137652,0,204597e-9,.999736,.0138615,0,.00116837,.999573,.0140007,0,.00303325,.99934,.0141927,0,.00580613,.999004,.0144457,0,.00945626,.998407,.0147489,0,.0139421,.995464,.014731,0,.0192202,.993328,.0148283,0,.0252495,.991799,.0150797,0,.0319921,.990397,.0154316,0,.0394138,.986835,.0155005,0,.0474843,.983938,.0157308,0,.0561763,.980154,.0158753,0,.0654661,.975659,.0159581,0,.0753326,.970171,.0159832,0,.0857571,.964803,.0160084,0,.0967236,.958366,.0159484,0,.108218,.950613,.0158001,0,.120227,.942874,.0155845,0,.132741,.935005,.0154292,0,.145751,.924991,.0150742,0,.159249,.914814,.0146757,0,.17323,.904743,.0143097,0,.187687,.893216,.0138695,0,.202619,.880769,.0133706,0,.218021,.868136,.0128606,0,.233894,.85469,.0123403,0,.250238,.840593,.0118091,0,.267052,.825808,.011253,0,.284341,.81009,.0107099,0,.302106,.79504,.0101636,0,.320354,.779757,.00964041,0,.33909,.764697,.00911896,0,.358322,.750913,.00859533,0,.378059,.738175,.00811592,0,.398311,.725242,.00764504,0,.41909,.711864,.00718885,0,.440412,.698009,.00675843,0,.462292,.683841,.00634984,0,.484748,.669391,.00595502,0,.507802,.654731,.00558671,0,.531477,.639805,.00523578,0,.555802,.624789,.00490834,0,.580805,.609325,.00459448,0,.606522,.593975,.00430342,0,.63299,.578983,.00403019,0,.66025,.564442,.0037707,0,.688346,.549835,.0035316,0,.717319,.535039,.00330255,0,.7472,.520403,.00308932,0,.777982,.505687,.00289335,0,.809524,.490939,.00270818,0,.84127,.476233,.0025343,0,.873016,.461624,.00237097,0,.904762,.447833,.00222065,0,.936508,.433992,.00207561,0,.968254,.420147,.00194955,0,1,1,.0173415,0,0,1,.0173416,0,0,.999999,.0173426,0,0,.999995,.0173468,0,0,.999983,.0173582,0,0,.999954,.0173822,0,0,.999908,.0174258,0,669501e-11,.999828,.0174973,0,427399e-9,.999705,.0176063,0,.00171019,.999524,.0177631,0,.0039248,.999263,.0179781,0,.00705382,.998878,.018258,0,.0110552,.998012,.0185551,0,.0158812,.994614,.0184264,0,.0214852,.993132,.0186385,0,.0278239,.991563,.0189067,0,.0348585,.989298,.0191577,0,.0425544,.986036,.0192522,0,.050881,.982558,.0194063,0,.059811,.978531,.019486,0,.0693209,.974198,.0195847,0,.0793895,.968148,.0194749,0,.0899984,.962565,.0194277,0,.101132,.956041,.0192991,0,.112775,.947749,.0189893,0,.124917,.94018,.018704,0,.137547,.93165,.0183458,0,.150655,.921798,.0178775,0,.164236,.911573,.0173618,0,.178281,.901569,.0168482,0,.192788,.890341,.016265,0,.207752,.877835,.0156199,0,.223171,.865472,.0149516,0,.239044,.852905,.0143274,0,.255371,.838906,.0136643,0,.272153,.824888,.0129903,0,.289393,.809977,.0123218,0,.307093,.794697,.0116572,0,.325259,.780028,.0110307,0,.343896,.765124,.0104236,0,.363012,.750411,.0098219,0,.382617,.737264,.00924397,0,.402719,.724799,.00868719,0,.423332,.712253,.00816476,0,.444469,.699267,.00767262,0,.466146,.685618,.00719746,0,.488383,.671736,.00673916,0,.511199,.657777,.00631937,0,.534618,.643497,.00592411,0,.558668,.62889,.00553928,0,.58338,.614299,.0051934,0,.608787,.599197,.00485985,0,.634929,.584175,.00454357,0,.661849,.569541,.00425787,0,.689594,.555193,.00397905,0,.718211,.540947,.00372364,0,.747742,.526593,.00348599,0,.778205,.512335,.00326103,0,.80953,.498017,.00305137,0,.84127,.483609,.00285485,0,.873016,.469368,.00267472,0,.904762,.455037,.00249945,0,.936508,.441493,.00234792,0,.968254,.428147,.00219936,0,1,1,.0219422,0,0,1,.0219423,0,0,.999998,.0219434,0,0,.999993,.0219481,0,0,.999981,.021961,0,0,.999949,.0219879,0,0,.999896,.0220367,0,593194e-10,.999808,.0221167,0,75364e-8,.99967,.0222383,0,.00237884,.999466,.0224125,0,.00495612,.999174,.0226495,0,.00844887,.998725,.0229525,0,.0128058,.996979,.0231123,0,.0179742,.994317,.0230742,0,.0239047,.992781,.0232895,0,.0305526,.991191,.0235734,0,.0378786,.987787,.0236152,0,.0458475,.985092,.0237994,0,.0544287,.981121,.0238553,0,.0635952,.976924,.0238706,0,.0733233,.97218,.0238704,0,.0835922,.965956,.0236598,0,.0943839,.959998,.0234735,0,.105682,.953245,.0232277,0,.117474,.944445,.0226973,0,.129747,.937087,.0223527,0,.142491,.928341,.0218144,0,.155697,.9184,.0211516,0,.169358,.907959,.0204553,0,.183469,.89808,.0197673,0,.198024,.887047,.0189915,0,.21302,.875221,.0182082,0,.228455,.86269,.0173584,0,.244329,.850735,.0165718,0,.260639,.837545,.0157524,0,.277389,.823639,.0149482,0,.29458,.809699,.0141431,0,.312216,.794797,.0133527,0,.3303,.780578,.0126193,0,.34884,.766019,.0118914,0,.367842,.751447,.0111839,0,.387315,.737275,.010514,0,.40727,.724545,.00987277,0,.427717,.712644,.00926569,0,.448671,.700432,.00869029,0,.470149,.687664,.00814691,0,.492167,.674288,.00763012,0,.514746,.660966,.00714437,0,.537911,.647264,.00668457,0,.561688,.633431,.00626581,0,.586108,.619133,.00585593,0,.611206,.604935,.00548188,0,.637022,.590236,.00513288,0,.663599,.575473,.0047906,0,.690989,.561228,.00448895,0,.719242,.547054,.00420233,0,.748411,.533175,.00392869,0,.778531,.519163,.00367445,0,.809583,.505328,.00344097,0,.84127,.491446,.00322003,0,.873016,.477356,.00301283,0,.904762,.46356,.00282592,0,.936508,.449623,.00264956,0,.968254,.436068,.00246956,0,1,1,.0276135,0,0,1,.0276136,0,0,.999998,.0276148,0,0,.999993,.0276201,0,0,.999976,.0276342,0,0,.999945,.027664,0,0,.999884,.0277179,0,18679e-8,.999784,.027806,0,.00119607,.99963,.0279394,0,.00318407,.999401,.0281295,0,.00613601,.999066,.0283858,0,.00999963,.998524,.0287027,0,.0147164,.995702,.0286256,0,.0202295,.993593,.0286733,0,.0264876,.992067,.0288989,0,.0334452,.990548,.0292135,0,.0410621,.986775,.0291296,0,.0493032,.984054,.0293099,0,.0581381,.979481,.0291881,0,.0675397,.975297,.0291598,0,.0774848,.96981,.028954,0,.0879528,.963524,.028628,0,.0989258,.957398,.0283135,0,.110388,.950088,.0278469,0,.122327,.941538,.0271798,0,.134729,.933332,.0265388,0,.147587,.924392,.0257776,0,.160889,.914581,.024916,0,.174631,.904347,.0240242,0,.188806,.894324,.0231229,0,.203409,.883724,.022153,0,.218437,.872207,.0211355,0,.233888,.859927,.0201048,0,.249761,.848373,.0191263,0,.266056,.836023,.0181306,0,.282774,.82289,.0171718,0,.299917,.809324,.0162196,0,.317488,.795361,.0152622,0,.335493,.781253,.01439,0,.353936,.767338,.013533,0,.372825,.753156,.0127244,0,.392168,.739122,.0119454,0,.411976,.725358,.0112054,0,.432259,.712949,.010487,0,.453032,.701621,.00984032,0,.47431,.689703,.00921495,0,.496111,.677216,.00862492,0,.518456,.664217,.00806882,0,.541367,.65137,.00755922,0,.564872,.638,.00705705,0,.589001,.62453,.00661266,0,.613789,.610601,.00618432,0,.639277,.59676,.00578033,0,.66551,.582433,.00540927,0,.692539,.568026,.00506104,0,.720422,.55414,.0047353,0,.749216,.540178,.00442889,0,.778974,.526513,.00414363,0,.809711,.512954,.00388237,0,.84127,.499403,.00362875,0,.873016,.486026,.00340827,0,.904762,.472345,.00318598,0,.936508,.458828,.00297635,0,.968254,.445379,.00279447,0,1,1,.0345716,0,0,1,.0345717,0,0,.999999,.034573,0,0,.999991,.0345787,0,0,.999974,.0345941,0,0,.999937,.0346263,0,188589e-11,.999869,.0346847,0,409238e-9,.999757,.0347798,0,.0017674,.999582,.0349233,0,.00413658,.999322,.0351265,0,.00747408,.998939,.0353967,0,.0117157,.998219,.0357018,0,.0167966,.994974,.0354726,0,.0226572,.993201,.0355621,0,.0292445,.991573,.0357641,0,.0365123,.989301,.0359252,0,.0444203,.985712,.0358017,0,.0529334,.982411,.0358353,0,.0620214,.977827,.035617,0,.0716574,.973278,.0354398,0,.0818186,.967397,.0350483,0,.0924846,.960696,.0344795,0,.103638,.954349,.0339861,0,.115263,.946066,.0331323,0,.127348,.938012,.032359,0,.13988,.929413,.0314413,0,.152849,.920355,.0304103,0,.166248,.910586,.0292785,0,.18007,.900609,.0281391,0,.194308,.890093,.0269103,0,.208958,.880013,.0257269,0,.224018,.869001,.0244671,0,.239485,.85751,.0232252,0,.255359,.84582,.0220117,0,.271638,.834383,.0208274,0,.288324,.822158,.0196628,0,.305419,.809056,.0185306,0,.322927,.795832,.0174174,0,.340851,.782547,.0163758,0,.359199,.7689,.015391,0,.377975,.755526,.0144488,0,.397189,.741681,.0135372,0,.416851,.728178,.0126957,0,.436971,.714642,.0118812,0,.457564,.702756,.0111165,0,.478644,.69175,.0104145,0,.500229,.680159,.00974439,0,.522339,.668073,.00911926,0,.544997,.655405,.00851393,0,.56823,.642921,.00797637,0,.592068,.629993,.00745119,0,.616546,.616828,.00696972,0,.641705,.603305,.00652425,0,.66759,.589833,.00610188,0,.694255,.575945,.00570834,0,.72176,.561745,.00533384,0,.750168,.548277,.00500001,0,.779545,.534467,.00467582,0,.809933,.521032,.00438092,0,.841272,.507877,.00410348,0,.873016,.494654,.00383618,0,.904762,.481592,.00358699,0,.936508,.468509,.00337281,0,.968254,.455293,.00316196,0,1,1,.0430698,0,0,1,.0430699,0,0,.999998,.0430713,0,0,.999991,.0430773,0,0,.99997,.0430936,0,0,.999928,.0431277,0,406396e-10,.999852,.0431893,0,744376e-9,.999724,.0432895,0,.0024806,.999527,.0434397,0,.00524779,.99923,.0436507,0,.00898164,.998783,.0439255,0,.0136083,.997507,.0441104,0,.0190582,.994418,.0438225,0,.0252694,.992864,.0439396,0,.0321879,.991127,.0440962,0,.039767,.987331,.0438408,0,.0479667,.984819,.0438991,0,.056752,.980384,.0435906,0,.0660929,.975846,.0432543,0,.075963,.970748,.0428293,0,.0863398,.964303,.042153,0,.0972035,.95772,.0414111,0,.108537,.950747,.0405893,0,.120325,.942533,.0394887,0,.132554,.934045,.0383544,0,.145215,.924942,.037057,0,.158296,.915811,.0356993,0,.17179,.90612,.0342401,0,.185691,.896434,.0328078,0,.199993,.886021,.031288,0,.214691,.876081,.0297776,0,.229782,.865608,.0282334,0,.245265,.854924,.026749,0,.261138,.843607,.02526,0,.277401,.832456,.0238214,0,.294056,.821342,.0224682,0,.311104,.809303,.0211297,0,.328548,.796468,.0198387,0,.346394,.784046,.0186227,0,.364645,.771262,.0174561,0,.38331,.758118,.0163806,0,.402396,.745075,.0153287,0,.421912,.731926,.0143647,0,.44187,.71863,.0134363,0,.462283,.705414,.0125603,0,.483165,.693792,.0117508,0,.504535,.683108,.0110016,0,.52641,.67183,.0102757,0,.548816,.66015,.00962044,0,.571776,.647907,.00898031,0,.595323,.635734,.00840811,0,.619489,.623208,.00786211,0,.644317,.610438,.00734953,0,.669852,.597345,.00687688,0,.696148,.584138,.00643469,0,.723267,.5707,.00602236,0,.75128,.556966,.0056324,0,.780258,.543607,.00528277,0,.810268,.530213,.00493999,0,.841311,.516912,.00462265,0,.873016,.503916,.0043307,0,.904762,.491146,.00406858,0,.936508,.478439,.00381436,0,.968254,.465834,.00358003,0,1,1,.0534039,0,0,1,.053404,0,0,.999998,.0534055,0,0,.999989,.0534116,0,0,.999968,.0534283,0,0,.999918,.0534633,0,155895e-9,.99983,.0535262,0,.00120914,.999685,.0536281,0,.00334944,.999461,.0537799,0,.00653077,.999119,.0539902,0,.0106718,.998582,.0542524,0,.0156907,.995919,.0540318,0,.0215147,.993735,.0538914,0,.0280801,.992126,.0539557,0,.0353323,.990266,.0540401,0,.0432247,.986317,.0536064,0,.0517172,.983213,.0534425,0,.0607754,.978303,.0528622,0,.0703698,.973665,.0523363,0,.0804742,.968091,.0516165,0,.0910667,.961026,.0505434,0,.102128,.954333,.049523,0,.113641,.946372,.0481698,0,.125591,.938254,.0467674,0,.137965,.929516,.0452341,0,.150754,.920106,.0435083,0,.163947,.910899,.0417399,0,.177537,.901532,.0399389,0,.191516,.891919,.0380901,0,.205881,.882006,.0362341,0,.220626,.871965,.0343444,0,.235749,.862145,.0324832,0,.251248,.852058,.0306681,0,.267121,.84161,.0289097,0,.283368,.830806,.0272079,0,.299992,.820476,.0256089,0,.316992,.809514,.0240394,0,.334374,.797865,.0225379,0,.35214,.785621,.0211235,0,.370296,.773765,.0197908,0,.388849,.761629,.0185235,0,.407807,.748891,.0173358,0,.427178,.736437,.0162305,0,.446974,.723707,.0151778,0,.467207,.710606,.0141791,0,.487892,.698019,.0132592,0,.509046,.686203,.0123887,0,.530687,.675692,.0115976,0,.552839,.664826,.0108325,0,.575527,.65349,.0101348,0,.59878,.641774,.00947756,0,.622634,.629794,.00886058,0,.647128,.617647,.00828526,0,.672308,.60534,.00775312,0,.698231,.592718,.00726033,0,.724958,.579746,.00679731,0,.752563,.566763,.00636111,0,.781127,.553515,.00595228,0,.810733,.540118,.00556876,0,.841426,.527325,.00523051,0,.873016,.514265,.00490712,0,.904762,.501406,.00460297,0,.936508,.488922,.00431247,0,.968254,.476541,.0040472,0,1,1,.0659184,0,0,1,.0659185,0,0,.999998,.06592,0,0,.999988,.0659259,0,0,.999963,.0659423,0,0,.999907,.0659764,0,374198e-9,.999806,.0660376,0,.00182071,.999639,.0661361,0,.0043894,.999378,.0662814,0,.00800055,.998985,.0664779,0,.0125594,.998285,.0666914,0,.0179786,.995071,.0661989,0,.0241822,.993172,.0660454,0,.031106,.991438,.0660105,0,.0386952,.988428,.0656875,0,.0469032,.985218,.0652913,0,.0556905,.981128,.0647107,0,.065023,.976015,.0638491,0,.0748717,.97097,.062993,0,.0852112,.964582,.0617927,0,.0960199,.957383,.0603626,0,.107279,.949969,.0588128,0,.118971,.941843,.0570274,0,.131084,.933624,.0551885,0,.143604,.924543,.053122,0,.156521,.914919,.0508897,0,.169825,.905773,.0486418,0,.18351,.896434,.0463364,0,.197569,.887195,.0440623,0,.211997,.877706,.0417799,0,.226789,.867719,.03945,0,.241944,.858587,.037243,0,.257458,.849317,.0350956,0,.273331,.839585,.0329852,0,.289563,.829856,.0310028,0,.306154,.819589,.0290953,0,.323108,.809714,.0272738,0,.340426,.79934,.0255631,0,.358113,.788224,.0239175,0,.376175,.776619,.0223831,0,.394616,.76521,.0209298,0,.413445,.753716,.0195786,0,.432671,.741564,.0183001,0,.452305,.729413,.0171259,0,.472358,.717146,.0159933,0,.492845,.70436,.0149495,0,.513783,.69219,.0139681,0,.535189,.680289,.0130577,0,.557087,.669611,.0122198,0,.5795,.659113,.0114174,0,.602459,.648148,.0106729,0,.625997,.636905,.00998997,0,.650154,.625154,.00934313,0,.674976,.613481,.00874839,0,.700518,.60154,.00818265,0,.726845,.58943,.00766889,0,.754032,.576828,.00717153,0,.782167,.564194,.00672696,0,.811344,.551501,.00630863,0,.841644,.538635,.00592177,0,.873016,.525724,.00554888,0,.904762,.513209,.00520225,0,.936508,.500457,.00488231,0,.968254,.48799,.00457153,0,1,1,.0810131,0,0,1,.0810133,0,0,.999997,.0810145,0,0,.999985,.08102,0,0,.999956,.0810347,0,195026e-10,.999893,.0810656,0,719316e-9,.999777,.0811205,0,.00259774,.999583,.081208,0,.00561807,.999281,.0813343,0,.00967472,.998813,.0814969,0,.0146627,.997597,.0815217,0,.0204902,.994379,.0808502,0,.0270802,.992744,.0806792,0,.0343674,.990745,.0804589,0,.0422974,.986646,.0796107,0,.0508242,.983611,.0790913,0,.0599087,.978869,.0780746,0,.0695175,.973475,.0768218,0,.0796223,.967845,.0754926,0,.0901983,.960778,.0737063,0,.101224,.953333,.0718052,0,.112682,.945274,.0695946,0,.124555,.936955,.0672492,0,.136831,.928319,.0647732,0,.149496,.919075,.0620947,0,.162542,.909114,.0591816,0,.175958,.900137,.0563917,0,.189739,.891069,.0535392,0,.203877,.882262,.0507642,0,.218368,.873232,.0479793,0,.233208,.864042,.045226,0,.248393,.855002,.0425413,0,.263923,.846569,.0400126,0,.279796,.837714,.0375269,0,.296012,.828918,.0352027,0,.312573,.819783,.0330011,0,.329479,.810129,.0308908,0,.346734,.800866,.0289112,0,.364342,.79093,.0270255,0,.382307,.780593,.0252758,0,.400637,.769511,.0236178,0,.419337,.758558,.0220652,0,.438418,.747632,.0206289,0,.457889,.736146,.0192873,0,.477761,.724093,.0180333,0,.49805,.71234,.0168264,0,.51877,.700201,.015746,0,.53994,.687949,.0147027,0,.561581,.676163,.0137512,0,.583718,.665001,.0128655,0,.60638,.65472,.0120366,0,.629599,.644213,.0112604,0,.653415,.633382,.0105413,0,.677874,.62212,.00986498,0,.70303,.610631,.00923308,0,.728948,.599078,.00864206,0,.755706,.587519,.00811784,0,.783396,.575505,.00761237,0,.812121,.563148,.00713949,0,.841989,.550828,.00668379,0,.873035,.538458,.00627715,0,.904762,.525905,.00588336,0,.936508,.513517,.00552687,0,.968254,.501395,.00519681,0,1,1,.0991506,0,0,1,.0991504,0,0,.999996,.0991515,0,0,.999984,.0991558,0,0,.999947,.0991672,0,114389e-9,.999874,.0991912,0,.00121503,.999739,.0992331,0,.00356108,.999514,.0992983,0,.00705578,.999159,.0993877,0,.011574,.998586,.0994837,0,.017003,.995731,.0988425,0,.0232484,.993384,.098276,0,.0302318,.991615,.0979269,0,.0378884,.989029,.0973432,0,.0461641,.985373,.0963539,0,.0550136,.981278,.0952306,0,.0643988,.975777,.0936233,0,.0742868,.970526,.0920219,0,.0846501,.963755,.0898912,0,.0954644,.956676,.0876064,0,.106709,.948099,.0847751,0,.118367,.939718,.0818638,0,.130423,.931305,.078857,0,.142862,.922342,.0756127,0,.155674,.912842,.0721473,0,.168849,.903304,.0686195,0,.182378,.89411,.0650589,0,.196255,.885512,.0616022,0,.210473,.877193,.0582434,0,.225027,.86877,.0548979,0,.239915,.860267,.0516095,0,.255132,.851915,.048468,0,.270678,.843912,.0454447,0,.286551,.83604,.0425612,0,.302751,.828245,.0398752,0,.31928,.820159,.0373198,0,.336138,.81167,.034916,0,.35333,.802659,.0326402,0,.370858,.793921,.0304901,0,.388728,.784713,.0284857,0,.406944,.774946,.0266186,0,.425515,.76448,.0248593,0,.444449,.753793,.0232114,0,.463756,.743506,.0217039,0,.483447,.732555,.0202841,0,.503535,.720965,.0189648,0,.524036,.709422,.0177189,0,.544968,.697756,.0165626,0,.56635,.685565,.015483,0,.588208,.673987,.0144892,0,.610569,.66244,.0135607,0,.633466,.651675,.0126956,0,.656936,.641598,.0118788,0,.681025,.63121,.0111261,0,.705788,.620514,.010437,0,.731289,.609366,.00978747,0,.757606,.598137,.00917257,0,.784834,.586966,.00859778,0,.813085,.575549,.00806803,0,.842485,.563797,.00757294,0,.87313,.551758,.00710592,0,.904762,.539894,.0066841,0,.936508,.527901,.00627901,0,.968254,.515819,.00590506,0,1,1,.120864,0,0,1,.120864,0,0,.999996,.120864,0,0,.99998,.120867,0,0,.99994,.120872,0,323781e-9,.999852,.120884,0,.00188693,.999693,.120903,0,.00473489,.999426,.120929,0,.00872704,.999002,.120955,0,.0137237,.998235,.120918,0,.0196068,.994608,.119764,0,.0262803,.992997,.119265,0,.0336657,.990968,.11863,0,.0416987,.987002,.117261,0,.0503261,.983524,.116009,0,.0595035,.97875,.114252,0,.0691935,.972652,.11193,0,.0793645,.966613,.109555,0,.0899894,.959275,.106612,0,.101045,.951272,.103375,0,.112512,.942323,.0996594,0,.124372,.933679,.0958841,0,.136611,.924822,.0919265,0,.149216,.915742,.0878061,0,.162176,.906348,.0834894,0,.175482,.896883,.079085,0,.189125,.88774,.0746745,0,.203098,.87986,.0705773,0,.217396,.871998,.0665005,0,.232015,.864325,.0625413,0,.24695,.856685,.0586781,0,.2622,.84925,.0550063,0,.277761,.841719,.0514727,0,.293634,.834755,.0481398,0,.309819,.827853,.0450172,0,.326315,.820888,.0420969,0,.343126,.813616,.0393702,0,.360254,.805767,.0367771,0,.377701,.797338,.0343274,0,.395474,.789122,.0320529,0,.413577,.780601,.0299485,0,.432018,.771424,.0279812,0,.450804,.761502,.0261054,0,.469944,.751166,.0243942,0,.489451,.741276,.0228087,0,.509337,.730898,.0213265,0,.529617,.719878,.0199307,0,.550307,.708379,.0186574,0,.571428,.697165,.0174446,0,.593003,.685554,.0163144,0,.615059,.673631,.015276,0,.637628,.662385,.0143003,0,.660746,.651059,.0134112,0,.68446,.640451,.0125794,0,.70882,.630536,.011793,0,.733893,.620316,.0110547,0,.759756,.609722,.0103668,0,.786505,.598804,.00973009,0,.814259,.587871,.00912812,0,.843157,.577121,.00858916,0,.87334,.566019,.00807333,0,.904762,.554664,.00759687,0,.936508,.543101,.00714759,0,.968254,.531558,.00673418,0,1,1,.146767,0,0,1,.146767,0,0,.999997,.146767,0,0,.999977,.146765,0,320658e-11,.999929,.146762,0,682576e-9,.999823,.146753,0,.00276402,.999633,.146735,0,.00614771,.999314,.146699,0,.0106613,.998796,.14662,0,.0161546,.997124,.146107,0,.0225063,.994062,.144857,0,.0296198,.992154,.144011,0,.037417,.989186,.142712,0,.0458348,.985279,.140926,0,.0548211,.980826,.13885,0,.0643326,.975056,.136168,0,.074333,.969005,.133217,0,.0847917,.961554,.12959,0,.0956828,.954206,.125886,0,.106984,.945046,.121335,0,.118675,.935678,.116492,0,.130741,.926748,.111635,0,.143166,.917764,.106625,0,.155939,.908358,.101325,0,.169049,.899219,.0960249,0,.182487,.890089,.0906527,0,.196245,.881488,.0853905,0,.210317,.874031,.0804177,0,.224697,.866932,.0756005,0,.23938,.859976,.0709019,0,.254364,.853375,.0664391,0,.269646,.846971,.0622012,0,.285223,.840483,.058129,0,.301096,.833969,.0542762,0,.317265,.82806,.0507042,0,.333729,.822128,.047368,0,.350491,.815989,.044272,0,.367554,.809336,.0413444,0,.38492,.802177,.038601,0,.402594,.79441,.0360227,0,.420582,.786573,.0336383,0,.438891,.778619,.0314321,0,.457527,.77,.029362,0,.476499,.760698,.0274102,0,.49582,.750932,.0256146,0,.5155,.740993,.023974,0,.535555,.731159,.0224182,0,.556,.720836,.0209889,0,.576855,.709913,.0196411,0,.598143,.698415,.0183824,0,.619888,.68745,.0172222,0,.642123,.676154,.0161509,0,.664883,.664383,.0151397,0,.688211,.6533,.0141873,0,.71216,.642072,.0133105,0,.736792,.631412,.0124932,0,.762186,.621622,.0117408,0,.788439,.611681,.0110358,0,.815672,.60142,.0103775,0,.844034,.59083,.00975623,0,.873699,.580254,.00918084,0,.904765,.569841,.00864721,0,.936508,.559224,.00815731,0,.968254,.548315,.00767924,0,1,1,.177563,0,0,1,.177563,0,0,.999994,.177562,0,0,.999972,.177555,0,664171e-10,.999914,.177536,0,.0012276,.999787,.177496,0,.00388025,.999556,.17742,0,.00783463,.999165,.177285,0,.0128953,.9985,.177037,0,.0189053,.995388,.175634,0,.025742,.993102,.174375,0,.033309,.990992,.173121,0,.0415298,.986932,.170896,0,.0503425,.982786,.16847,0,.0596964,.977592,.165455,0,.0695498,.971075,.161676,0,.0798676,.963967,.157458,0,.0906201,.956397,.152836,0,.101783,.947489,.147467,0,.113333,.937564,.14145,0,.125254,.928182,.135383,0,.137529,.919027,.129212,0,.150144,.909618,.12276,0,.163088,.900492,.116273,0,.176351,.891671,.1098,0,.189924,.883146,.103362,0,.203799,.875151,.0970799,0,.21797,.868338,.0911732,0,.232433,.862033,.0854966,0,.247182,.856107,.0800691,0,.262216,.850644,.0749618,0,.27753,.845261,.070079,0,.293124,.839885,.0654321,0,.308997,.834609,.0610975,0,.325149,.829083,.0569741,0,.341581,.82404,.0531736,0,.358294,.818968,.049665,0,.37529,.813496,.0463856,0,.392573,.807533,.0433217,0,.410148,.80099,.0404402,0,.428019,.793891,.0377578,0,.446192,.786281,.0352616,0,.464676,.778773,.0329577,0,.483478,.770737,.030808,0,.502608,.762094,.0287964,0,.522079,.752898,.0269254,0,.541905,.743306,.0251926,0,.5621,.733416,.023595,0,.582684,.723742,.0221155,0,.603677,.713542,.0207435,0,.625106,.702755,.019434,0,.646998,.691484,.0182046,0,.66939,.680531,.0170771,0,.692324,.66953,.0160339,0,.715849,.658126,.0150677,0,.740028,.646933,.0141551,0,.764937,.636107,.0133179,0,.790673,.625271,.0125284,0,.817358,.615225,.0117937,0,.84515,.605678,.0111181,0,.874244,.59583,.0104759,0,.904828,.585704,.00986672,0,.936508,.575413,.00929712,0,.968254,.565373,.00876713,0,1,1,.214058,0,0,.999999,.214058,0,0,.999994,.214055,0,0,.999966,.214039,0,259642e-9,.999893,.213998,0,.00200075,.999737,.21391,0,.00527775,.999449,.213745,0,.00983959,.99896,.213458,0,.0154755,.9979,.212855,0,.0220249,.994278,.210779,0,.0293654,.992254,.20926,0,.0374021,.98881,.206908,0,.0460604,.984715,.204009,0,.0552802,.979738,.200471,0,.0650127,.972884,.195813,0,.0752175,.965996,.190856,0,.0858612,.957974,.185077,0,.0969155,.949155,.17868,0,.108356,.939288,.171513,0,.120163,.928996,.163838,0,.132319,.919563,.156246,0,.144808,.910004,.148359,0,.157618,.900791,.140417,0,.170737,.892135,.132569,0,.184155,.883803,.124741,0,.197866,.876034,.117091,0,.211861,.869219,.109835,0,.226134,.863062,.102859,0,.240682,.857795,.0962928,0,.255499,.853009,.0900725,0,.270583,.848603,.0842101,0,.285931,.844335,.0786527,0,.301542,.840208,.0734397,0,.317415,.836035,.0685334,0,.33355,.83172,.0639275,0,.349948,.827135,.0595909,0,.36661,.822797,.0556204,0,.383539,.818387,.0519394,0,.400738,.813565,.0485317,0,.41821,.808142,.0453138,0,.435961,.802212,.0423354,0,.453997,.79573,.0395553,0,.472324,.788741,.036988,0,.490951,.781093,.0345688,0,.509887,.773597,.0323297,0,.529144,.765622,.0302719,0,.548735,.757083,.0283477,0,.568674,.747992,.0265562,0,.588979,.738591,.0248844,0,.609671,.728719,.0233342,0,.630773,.719146,.0219081,0,.652314,.709165,.0205711,0,.674328,.69875,.0193248,0,.696854,.687884,.0181582,0,.719942,.676818,.0170746,0,.743651,.666247,.0160718,0,.768057,.655284,.0151262,0,.793253,.64401,.0142561,0,.819363,.633353,.0134327,0,.846547,.622674,.012653,0,.875017,.612265,.0119354,0,.905021,.602455,.0112533,0,.936508,.593147,.0106234,0,.968254,.583592,.0100213,0,1,1,.25717,0,0,1,.25717,0,0,.999992,.257164,0,0,.999958,.257135,0,641715e-9,.999864,.25706,0,.00305314,.999666,.256897,0,.00700975,.999302,.256596,0,.0122194,.998663,.25607,0,.0184622,.995607,.254123,0,.0255773,.993094,.252081,0,.0334439,.9907,.249867,0,.0419696,.98594,.246118,0,.0510823,.981214,.242049,0,.0607242,.974966,.236869,0,.0708486,.967589,.230724,0,.081417,.95915,.223635,0,.0923974,.950257,.21596,0,.103763,.940165,.207296,0,.115491,.929396,.197901,0,.127562,.919288,.188437,0,.13996,.909428,.178762,0,.15267,.900105,.169072,0,.165679,.891418,.159478,0,.178979,.883347,.15002,0,.192558,.875992,.140813,0,.20641,.869466,.13196,0,.220529,.863699,.123501,0,.234907,.858553,.115436,0,.249542,.854379,.107901,0,.264428,.850894,.10088,0,.279564,.847632,.0942296,0,.294947,.844571,.0879861,0,.310575,.84163,.0821534,0,.326448,.838542,.0766409,0,.342566,.835412,.0715322,0,.358929,.831899,.0666883,0,.37554,.828177,.0622175,0,.392399,.82416,.0580452,0,.409511,.820393,.054267,0,.426878,.816068,.0507172,0,.444506,.811201,.0474041,0,.4624,.805785,.0443174,0,.480566,.799878,.0414562,0,.499013,.793469,.0388147,0,.517749,.786473,.0363453,0,.536785,.778874,.0340225,0,.556134,.771277,.0318599,0,.575809,.763426,.0298859,0,.595827,.755044,.0280357,0,.616207,.746161,.0262979,0,.636973,.737124,.0247295,0,.65815,.72761,.0232514,0,.679772,.717822,.0218755,0,.701876,.708279,.0205942,0,.724509,.698333,.0193947,0,.74773,.68802,.0182717,0,.771609,.677321,.0172044,0,.79624,.666504,.0162122,0,.821743,.656184,.0152924,0,.84828,.64556,.0144326,0,.876069,.634636,.0136157,0,.905404,.624124,.0128612,0,.936508,.613914,.0121435,0,.968254,.603589,.0114887,0,1,1,.307946,0,0,.999999,.307945,0,0,.999988,.307934,0,204479e-10,.999944,.307886,0,.00127833,.999824,.307756,0,.00445047,.999565,.30748,0,.00914673,.999085,.306966,0,.0150498,.998103,.306004,0,.0219367,.994249,.303028,0,.0296485,.991807,.300435,0,.038068,.987773,.296554,0,.0471062,.982673,.2916,0,.0566942,.976623,.285641,0,.0667768,.968757,.27815,0,.0773099,.959849,.269529,0,.088257,.950663,.260248,0,.0995879,.940129,.249704,0,.111277,.92895,.238291,0,.123304,.917996,.226501,0,.13565,.907813,.214669,0,.148299,.898305,.202835,0,.161237,.889626,.191158,0,.174455,.88175,.179695,0,.187941,.874715,.168548,0,.201687,.868746,.15792,0,.215687,.863703,.147807,0,.229933,.859315,.138149,0,.24442,.855538,.128993,0,.259145,.852428,.120414,0,.274103,.850168,.112498,0,.289293,.848132,.105054,0,.304711,.846291,.0981087,0,.320357,.844431,.0915942,0,.33623,.842493,.0855056,0,.35233,.840368,.0798204,0,.368658,.83798,.0745097,0,.385214,.83523,.0695424,0,.402002,.832091,.0649092,0,.419023,.828667,.0606291,0,.436282,.824805,.0566523,0,.453782,.820988,.0530229,0,.471529,.816635,.0496364,0,.489528,.811725,.0464658,0,.507788,.806316,.0435082,0,.526317,.800469,.0407873,0,.545124,.794107,.038255,0,.564221,.787218,.0358825,0,.583621,.779872,.0336785,0,.603341,.772097,.0316379,0,.623397,.764484,.0297379,0,.643812,.756428,.0279581,0,.664611,.748022,.0263153,0,.685824,.739268,.0247799,0,.707488,.73024,.0233385,0,.729646,.720893,.0220035,0,.752354,.71119,.0207555,0,.77568,.701791,.0195843,0,.799715,.692184,.0184891,0,.824574,.682258,.0174541,0,.850417,.67206,.0164873,0,.877466,.661717,.0155959,0,.90604,.651462,.0147519,0,.936528,.641467,.0139727,0,.968254,.631229,.0132363,0,1,1,.367573,0,0,.999999,.367571,0,0,.999984,.367553,0,183382e-9,.999925,.367473,0,.00225254,.999759,.367259,0,.00628165,.99941,.366801,0,.0117858,.998739,.365946,0,.0184359,.995529,.363191,0,.0260114,.992875,.360171,0,.0343581,.989135,.355981,0,.0433637,.984166,.350401,0,.0529438,.977871,.343348,0,.0630334,.96951,.334341,0,.0735805,.959964,.323862,0,.0845437,.950162,.312521,0,.095889,.938882,.299577,0,.107588,.926992,.285573,0,.119617,.915589,.271212,0,.131957,.904791,.256611,0,.144591,.895177,.242224,0,.157503,.886403,.227952,0,.170682,.878957,.214192,0,.184117,.872418,.200795,0,.197799,.867029,.188015,0,.21172,.862835,.175975,0,.225873,.859411,.164526,0,.240253,.856655,.153693,0,.254854,.854519,.14352,0,.269673,.852828,.13397,0,.284707,.851412,.124984,0,.299953,.850609,.116748,0,.315408,.849855,.10905,0,.331073,.849017,.101839,0,.346946,.848079,.0951359,0,.363028,.846911,.0888774,0,.379318,.845445,.0830375,0,.395818,.84362,.0775844,0,.41253,.841411,.0725054,0,.429457,.838768,.0677691,0,.446602,.835801,.0634016,0,.463968,.832341,.0593095,0,.481561,.828424,.0555121,0,.499386,.824312,.052024,0,.51745,.819918,.0487865,0,.535761,.815072,.0457801,0,.554328,.809863,.0430184,0,.573162,.804164,.0404245,0,.592275,.798034,.0380146,0,.611681,.791436,.0357436,0,.631398,.784498,.0336475,0,.651445,.777125,.0316666,0,.671845,.769365,.0298122,0,.692628,.761579,.0281001,0,.713827,.753746,.0265049,0,.735484,.745573,.0250067,0,.75765,.737083,.0236026,0,.78039,.728545,.0223302,0,.803789,.719691,.0211243,0,.82796,.710569,.0199983,0,.853056,.701216,.0189569,0,.879298,.692094,.0179702,0,.907014,.682909,.0170418,0,.936691,.673509,.0161732,0,.968254,.663863,.0153406,0,1,1,.437395,0,0,.999998,.437394,0,0,.99998,.437363,0,616704e-9,.999891,.437232,0,.00367925,.999656,.436877,0,.00867446,.999148,.436121,0,.0150679,.997959,.434564,0,.022531,.993464,.430134,0,.0308507,.990606,.426077,0,.0398805,.985027,.419397,0,.0495148,.978491,.41118,0,.0596749,.969643,.40048,0,.0703001,.959189,.38769,0,.0813427,.948223,.373575,0,.0927641,.935955,.357622,0,.104533,.923237,.34043,0,.116624,.911074,.322735,0,.129015,.899724,.30479,0,.141687,.890189,.287392,0,.154626,.881796,.270248,0,.167818,.874781,.253659,0,.181252,.869166,.237786,0,.194918,.864725,.222618,0,.208807,.861565,.208356,0,.222913,.859284,.194867,0,.237229,.857677,.18212,0,.25175,.856714,.17018,0,.266473,.856155,.158969,0,.281392,.8558,.148413,0,.296505,.855672,.138578,0,.311811,.855538,.129345,0,.327306,.855689,.120861,0,.342991,.855767,.112969,0,.358864,.855618,.105593,0,.374925,.85525,.0987451,0,.391176,.854583,.0923727,0,.407616,.853534,.0864143,0,.424249,.852061,.0808338,0,.441076,.850253,.0756771,0,.4581,.848004,.0708612,0,.475324,.845333,.0663784,0,.492754,.842376,.0622631,0,.510394,.838956,.0584112,0,.528251,.835121,.0548328,0,.546331,.830842,.0514838,0,.564644,.826212,.048355,0,.583198,.821522,.0454714,0,.602005,.816551,.0428263,0,.621078,.811211,.0403612,0,.640434,.805479,.038039,0,.660089,.799409,.0358739,0,.680066,.79306,.0338727,0,.70039,.786395,.0319985,0,.721094,.779416,.030241,0,.742215,.77214,.0285951,0,.7638,.764636,.0270747,0,.785912,.756836,.0256354,0,.808628,.749315,.0243027,0,.832055,.741561,.0230497,0,.856338,.733589,.0218801,0,.88169,.725479,.020784,0,.908441,.717255,.0197702,0,.937125,.708829,.0188168,0,.968254,.700191,.0179113,0,1,1,.518937,0,0,.999998,.518933,0,0,.999967,.518883,0,.00147741,.999832,.51866,0,.00573221,.999466,.518057,0,.011826,.998644,.516752,0,.0192116,.994458,.512347,0,.027573,.991223,.507675,0,.0367099,.985515,.500188,0,.046487,.978308,.490408,0,.0568071,.968359,.477357,0,.0675984,.95682,.461752,0,.0788059,.943929,.443796,0,.090386,.930224,.423893,0,.102304,.916514,.402682,0,.114532,.903653,.380914,0,.127047,.892315,.359212,0,.139828,.882942,.338102,0,.152861,.875438,.31773,0,.16613,.869642,.298186,0,.179624,.865304,.279491,0,.193332,.862382,.261804,0,.207247,.860666,.245146,0,.22136,.859788,.229406,0,.235666,.859608,.214605,0,.250158,.859912,.200691,0,.264832,.86053,.187623,0,.279684,.861368,.17539,0,.294711,.862237,.163901,0,.309911,.863127,.153175,0,.32528,.863923,.143147,0,.340819,.864567,.133781,0,.356524,.865013,.125042,0,.372397,.86539,.116952,0,.388438,.865591,.109476,0,.404645,.865517,.102542,0,.421022,.865084,.0960688,0,.437569,.864309,.0900499,0,.454287,.863151,.0844328,0,.471181,.861649,.0792218,0,.488253,.859742,.0743482,0,.505507,.857446,.0697963,0,.522947,.854757,.0655364,0,.54058,.851783,.061608,0,.558412,.848516,.0579701,0,.576449,.844897,.0545742,0,.594701,.840956,.0514167,0,.613178,.836676,.0484598,0,.631892,.832075,.0456934,0,.650856,.827191,.0431178,0,.670088,.822295,.0407718,0,.689606,.817294,.0386032,0,.709434,.812013,.0365675,0,.7296,.806465,.0346547,0,.750138,.800691,.0328717,0,.771093,.794709,.031211,0,.792519,.788493,.0296504,0,.814488,.782049,.0281782,0,.837097,.775403,.0267965,0,.860481,.76857,.0255002,0,.884842,.761536,.0242759,0,.910494,.754303,.0231142,0,.937985,.74692,.0220305,0,.968254,.739745,.0210192,0,1,1,.613914,0,0,.999996,.613907,0,963597e-10,.999942,.613814,0,.00301247,.999704,.613407,0,.00870385,.999046,.612302,0,.0160714,.995516,.608266,0,.0245899,.991726,.602863,0,.0339681,.985157,.593956,0,.0440254,.97642,.581748,0,.0546409,.964404,.565183,0,.0657284,.950601,.545273,0,.0772246,.935158,.522129,0,.0890812,.919364,.496782,0,.10126,.904754,.470571,0,.113731,.89176,.444037,0,.126469,.881492,.418322,0,.139454,.873656,.393522,0,.15267,.868053,.369795,0,.166101,.864336,.347171,0,.179736,.862259,.325737,0,.193565,.861556,.305532,0,.207578,.861776,.286416,0,.221769,.862661,.268355,0,.23613,.864015,.251334,0,.250656,.865711,.235352,0,.265343,.867519,.220302,0,.280187,.869351,.206161,0,.295183,.871144,.192908,0,.31033,.872839,.180505,0,.325624,.874307,.168848,0,.341065,.875667,.158021,0,.35665,.876758,.147877,0,.37238,.87764,.138441,0,.388253,.878237,.129627,0,.404269,.878563,.121415,0,.42043,.878572,.113741,0,.436735,.87842,.106652,0,.453187,.878057,.100097,0,.469786,.877413,.0940128,0,.486536,.87646,.0883462,0,.503439,.875233,.0830924,0,.520498,.8737,.0781975,0,.537717,.871873,.07364,0,.555102,.86978,.0694103,0,.572657,.867405,.0654696,0,.59039,.864751,.0617914,0,.608307,.861818,.0583491,0,.626419,.858645,.0551443,0,.644733,.855307,.0521894,0,.663264,.851736,.0494334,0,.682025,.847927,.0468504,0,.701032,.843888,.0444261,0,.720308,.839629,.0421497,0,.739875,.835158,.0400082,0,.759764,.830509,.0380076,0,.780014,.825714,.0361488,0,.800673,.820729,.0343956,0,.821803,.815751,.0327781,0,.843492,.810752,.031275,0,.86586,.805587,.0298542,0,.889087,.800317,.0285397,0,.913466,.79489,.0272948,0,.93952,.789314,.0261139,0,.96835,.783593,.0249938,0,1,1,.724258,0,0,.999992,.724243,0,726889e-9,.99987,.724044,0,.00569574,.999336,.72317,0,.0131702,.996271,.719432,0,.0220738,.991159,.712576,0,.0319405,.982465,.700927,0,.0425202,.97049,.684297,0,.0536599,.953973,.661244,0,.065258,.935546,.633804,0,.0772427,.916596,.603071,0,.0895616,.899353,.57105,0,.102175,.885216,.539206,0,.11505,.875076,.508714,0,.128164,.868334,.479571,0,.141495,.864414,.451796,0,.155026,.862678,.425328,0,.168745,.862835,.400352,0,.182639,.864067,.376532,0,.196699,.866086,.35391,0,.210915,.868557,.332424,0,.225282,.871271,.312053,0,.239792,.874058,.292764,0,.25444,.8768,.27453,0,.269223,.87939,.257297,0,.284135,.8819,.24114,0,.299174,.884187,.225934,0,.314337,.886262,.211669,0,.329622,.888119,.198311,0,.345026,.889709,.185783,0,.360549,.891054,.174063,0,.376189,.892196,.163143,0,.391946,.893101,.152952,0,.407819,.893803,.143475,0,.423808,.894277,.134647,0,.439914,.894532,.126434,0,.456137,.894576,.1188,0,.472479,.894393,.111694,0,.48894,.893976,.105069,0,.505523,.893346,.0989077,0,.52223,.892502,.0931724,0,.539064,.891441,.0878276,0,.556028,.890276,.082903,0,.573125,.888972,.0783505,0,.590361,.887469,.0741083,0,.607741,.885785,.0701633,0,.62527,.883914,.0664835,0,.642957,.881872,.0630567,0,.660809,.879651,.0598527,0,.678836,.877267,.0568615,0,.69705,.874717,.05406,0,.715465,.872012,.0514378,0,.734098,.869157,.0489805,0,.752968,.866155,.0466727,0,.772101,.863014,.0445056,0,.791529,.859748,.0424733,0,.81129,.856416,.0405957,0,.831438,.852958,.0388273,0,.852044,.849382,.0371619,0,.87321,.845694,.0355959,0,.89509,.841893,.0341155,0,.917932,.837981,.0327141,0,.942204,.833963,.0313856,0,.968981,.829847,.0301275,0,1,1,.85214,0,0,.999969,.852095,0,.00279627,.999483,.851408,0,.0107635,.994545,.84579,0,.0206454,.986188,.835231,0,.0315756,.969847,.814687,0,.0432021,.945951,.783735,0,.0553396,.91917,.746074,0,.0678766,.895488,.706938,0,.0807395,.878232,.669534,0,.0938767,.868252,.635168,0,.10725,.863873,.603069,0,.120832,.863369,.572514,0,.134598,.86545,.543169,0,.148533,.868803,.514578,0,.16262,.872794,.486762,0,.176849,.87702,.459811,0,.19121,.881054,.433654,0,.205694,.884974,.408574,0,.220294,.888587,.384525,0,.235005,.891877,.36156,0,.24982,.894793,.339661,0,.264737,.89743,.318913,0,.279751,.899796,.299302,0,.294859,.901943,.280843,0,.310058,.903858,.263481,0,.325346,.905574,.247197,0,.340721,.907069,.231915,0,.356181,.908379,.217614,0,.371725,.90952,.20425,0,.387353,.910483,.191758,0,.403063,.91128,.180092,0,.418854,.911936,.169222,0,.434727,.912454,.159098,0,.450682,.912835,.149668,0,.466718,.913078,.140884,0,.482837,.913192,.132709,0,.499038,.913175,.125095,0,.515324,.91304,.118012,0,.531695,.912781,.111417,0,.548153,.91241,.105281,0,.5647,.911924,.0995691,0,.581338,.911331,.0942531,0,.59807,.910637,.0893076,0,.6149,.90984,.0846998,0,.63183,.908941,.0804044,0,.648865,.907944,.0763984,0,.666011,.906857,.0726638,0,.683273,.90568,.0691783,0,.700659,.904416,.0659222,0,.718176,.903067,.0628782,0,.735834,.901637,.0600307,0,.753646,.900128,.0573647,0,.771625,.898544,.0548668,0,.78979,.89689,.052527,0,.808162,.895165,.0503306,0,.826771,.893371,.0482668,0,.845654,.891572,.0463605,0,.864863,.889763,.0445998,0,.884472,.887894,.0429451,0,.904592,.885967,.0413884,0,.925407,.883984,.0399225,0,.947271,.881945,.0385405,0,.97105,.879854,.0372362,0,1,.999804,.995833,0,0,.938155,.933611,0,.0158731,.864755,.854311,0,.0317461,.888594,.865264,0,.0476191,.905575,.863922,0,.0634921,.915125,.850558,0,.0793651,.920665,.829254,0,.0952381,.924073,.802578,0,.111111,.926304,.772211,0,.126984,.927829,.739366,0,.142857,.928924,.705033,0,.15873,.92973,.670019,0,.174603,.930339,.634993,0,.190476,.930811,.600485,0,.206349,.931191,.566897,0,.222222,.93149,.534485,0,.238095,.931737,.503429,0,.253968,.931939,.473811,0,.269841,.932108,.445668,0,.285714,.93225,.418993,0,.301587,.932371,.393762,0,.31746,.932474,.369939,0,.333333,.932562,.347479,0,.349206,.932638,.326336,0,.365079,.932703,.306462,0,.380952,.93276,.287805,0,.396825,.932809,.270313,0,.412698,.932851,.253933,0,.428571,.932887,.23861,0,.444444,.932917,.224289,0,.460317,.932943,.210917,0,.47619,.932965,.19844,0,.492063,.932982,.186807,0,.507937,.932995,.175966,0,.52381,.933005,.165869,0,.539683,.933011,.156468,0,.555556,.933013,.147719,0,.571429,.933013,.139579,0,.587302,.93301,.132007,0,.603175,.933004,.124965,0,.619048,.932994,.118416,0,.634921,.932982,.112326,0,.650794,.932968,.106663,0,.666667,.93295,.101397,0,.68254,.932931,.0964993,0,.698413,.932908,.0919438,0,.714286,.932883,.0877057,0,.730159,.932856,.0837623,0,.746032,.932827,.0800921,0,.761905,.932796,.0766754,0,.777778,.932762,.0734936,0,.793651,.932727,.0705296,0,.809524,.932689,.0677676,0,.825397,.93265,.0651929,0,.84127,.932609,.0627917,0,.857143,.932565,.0605515,0,.873016,.932521,.0584606,0,.888889,.932474,.0565082,0,.904762,.932427,.0546841,0,.920635,.932377,.0529793,0,.936508,.932326,.0513851,0,.952381,.932274,.0498936,0,.968254,.93222,.0484975,0,.984127,.932164,.0471899,0,1],n=new Float32Array(e),r=new Float32Array(t);s.UniformsLib.LTC_FLOAT_1=new s.DataTexture(n,64,64,s.RGBAFormat,s.FloatType,s.UVMapping,s.ClampToEdgeWrapping,s.ClampToEdgeWrapping,s.LinearFilter,s.NearestFilter,1),s.UniformsLib.LTC_FLOAT_2=new s.DataTexture(r,64,64,s.RGBAFormat,s.FloatType,s.UVMapping,s.ClampToEdgeWrapping,s.ClampToEdgeWrapping,s.LinearFilter,s.NearestFilter,1);var i=new Uint16Array(e.length);e.forEach((function(e,t){i[t]=s.DataUtils.toHalfFloat(e)}));var a=new Uint16Array(t.length);t.forEach((function(e,t){a[t]=s.DataUtils.toHalfFloat(e)})),s.UniformsLib.LTC_HALF_1=new s.DataTexture(i,64,64,s.RGBAFormat,s.HalfFloatType,s.UVMapping,s.ClampToEdgeWrapping,s.ClampToEdgeWrapping,s.LinearFilter,s.NearestFilter,1),s.UniformsLib.LTC_HALF_2=new s.DataTexture(a,64,64,s.RGBAFormat,s.HalfFloatType,s.UVMapping,s.ClampToEdgeWrapping,s.ClampToEdgeWrapping,s.LinearFilter,s.NearestFilter,1)};function it(e,t){this.light=e,this.color=t;var n=new s.BufferGeometry;n.setAttribute("position",new s.Float32BufferAttribute([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),n.computeBoundingSphere();var r=new s.LineBasicMaterial({fog:!1});s.Line.call(this,n,r),this.type="RectAreaLightHelper";var i=new s.BufferGeometry;i.setAttribute("position",new s.Float32BufferAttribute([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),i.computeBoundingSphere(),this.add(new s.Mesh(i,new s.MeshBasicMaterial({side:s.BackSide,fog:!1}))),this.update()}it.prototype=Object.create(s.Line.prototype),it.prototype.constructor=it,it.prototype.update=function(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),void 0!==this.color)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}},it.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()};var at=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t)).lightVolumes=new Map,n.TEXTURE_FLARE_0_URL="http://renyuan.bos.xyz/lensflare0.png",n.TEXTURE_FLARE_3_URL="http://renyuan.bos.xyz/lensflare3.png",n.LensflareSize=[300,60,70,120,60],n.lensFlareDistance=[0,.1,.12,.3,.4],n.defaultAmbientLightProperty={name:"defaultAmbientLight",color:16777211,intensity:0},n.defaultDirectionalLightProperty={name:"defaultDirectionalLight",color:16777211,intensity:0,position:{x:200,y:1e3,z:200},castShadow:!0,shadowMapWidth:8192,shadowMapheight:8192,addHelper:!1,d:1e3},n.defaultInteriorLightProperty={color:16777211,intensity:0,distance:0,decay:1,shadow:!0,shadowMapSize:512,addHelper:!1},n.defaultHemisphereLightProperty={name:"defaultHemisphereLight",color:16777211,groundColor:16777211,intensity:.1,addHelper:!1},n.interiorLightCount=1,n.directionLightShadowProperty={left:-1500,right:1500,top:1500,bottom:-1500,far:3e3,bias:-23e-5},n.activeClick=!0,n.currentSceneLights=function(){return n.sceneLights},n.currentCameraLights=function(){return n.cameraLights},n.addFloorLights=function(){var e=n.getCore().scene;n.addAmbientLight("环境光",10932727,.8);var t=new E.HemisphereLight(1066894,134439,.3);e.add(t),n.core.needUpdate=!0},n.addSceneDefaultLights=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.defaultAmbientLightProperty,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.defaultDirectionalLightProperty,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.defaultHemisphereLightProperty,i=n.getCore(),a=i.scene;i.camera,n.defaultAmbientLight=new E.AmbientLight(e.color,e.intensity),n.defaultAmbientLight.name=e.name,n.defaultHemisphereLight=new E.HemisphereLight(r.color,r.groundColor,r.intensity),n.defaultHemisphereLight.position.set(0,50,0),n.defaultHemisphereLight.name=r.name,n.defaultDirectionalLight=new E.DirectionalLight(t.color,t.intensity),n.defaultDirectionalLight.name=t.name,n.defaultDirectionalLight.position.set(0,5,1),n.defaultDirectionalLight.position.multiplyScalar(100),n.defaultDirectionalLight.castShadow=t.castShadow,n.defaultDirectionalLight.shadow.mapSize.width=t.shadowMapWidth,n.defaultDirectionalLight.shadow.mapSize.height=t.shadowMapheight,n.defaultDirectionalLight.shadow.camera.left=n.directionLightShadowProperty.left,n.defaultDirectionalLight.shadow.camera.right=n.directionLightShadowProperty.right,n.defaultDirectionalLight.shadow.camera.top=n.directionLightShadowProperty.top,n.defaultDirectionalLight.shadow.camera.bottom=n.directionLightShadowProperty.bottom,n.defaultDirectionalLight.shadow.camera.far=n.directionLightShadowProperty.far,n.defaultDirectionalLight.shadow.bias=n.directionLightShadowProperty.bias,a.add(n.defaultAmbientLight),a.add(n.defaultHemisphereLight),a.add(n.defaultDirectionalLight),n.core.needUpdate=!0},n.addSceneLights=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.defaultAmbientLightProperty,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.defaultDirectionalLightProperty,r=n.getCore().scene;n.addAmbientLight("环境光",e.color,e.intensity);var i=new E.DirectionalLight(t.color,t.intensity);i.position.set(t.position.x,t.position.y,t.position.z),i.position.multiplyScalar(100),i.castShadow=t.castShadow,i.shadow.mapSize.width=t.shadowMapWidth,i.shadow.mapSize.height=t.shadowMapheight;var a=t.d;if(i.shadow.camera.left=-a,i.shadow.camera.right=a,i.shadow.camera.top=a,i.shadow.camera.bottom=-a,i.shadow.camera.far=3500,i.shadow.bias=-1e-4,t.addHelper){var o=new E.CameraHelper(i.shadow.camera);r.add(o)}n.core.needUpdate=!0},n.addAmbientLightForScene=function(e,t){var r=n.getCore().scene,i=new E.AmbientLight(t);r.add(i),n.sceneLights.set(e,i),n.core.needUpdate=!0},n.addAmbientLightForCamera=function(e,t){var r=n.getCore().camera,i=new E.AmbientLight(t);r.add(i),n.cameraLights.set(e,i),n.core.needUpdate=!0},n.addDirectionalLightForScene=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777215,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.8*Math.PI,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=n.getCore().scene,u=new E.DirectionalLight(r,i);if(a().isNil(t)||u.position.set(t.x,t.y,t.z),o&&(u.castShadow=!0,u.shadow.mapSize.width=8192,u.shadow.mapSize.height=8192,u.shadow.camera.left=-1e3,u.shadow.camera.right=1e3,u.shadow.camera.top=1e3,u.shadow.camera.bottom=-1e3,u.shadow.camera.far=3500,u.shadow.camera.near=1,u.shadow.bias=-1e-4),s){var c=new E.DirectionalLightHelper(u,5,1316015);l.add(c)}l.add(u),n.sceneLights.set(e,u),n.core.needUpdate=!0},n.addDirectionalLightForCamera=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777215,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.8*Math.PI,o=n.getCore().camera,s=new E.DirectionalLight(r,i);s.castShadow=!0,a().isNil(t)||s.position.set(t.x,t.y,t.z),o.add(s),n.cameraLights.set(e,s),n.core.needUpdate=!0},n.addHemisphereLightForScene=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777147,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:526368,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=n.getCore().scene,l=new E.HemisphereLight(r,i,o);a().isNil(t)||l.position.set(t.x,t.y,t.z),s.add(l),n.sceneLights.set(e,l),n.core.needUpdate=!0},n.addHemisphereLightForCamera=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777147,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:526368,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=n.getCore().camera,l=new E.HemisphereLight(r,i,o);a().isNil(t)||l.position.set(t.x,t.y,t.z),s.add(l),n.cameraLights.set(e,l),n.core.needUpdate=!0},n.addAmbientLight=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16777215,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=n.getCore().scene,a=new E.AmbientLight(t,r);i.add(a),n.sceneLights.set(e,a),n.core.needUpdate=!0},n.setinteriorLightProperty=function(e){a().isNil(e)||(a().isNumber(e.color)&&(n.defaultInteriorLightProperty.color=e.color),a().isNumber(e.intensity)&&(n.defaultInteriorLightProperty.intensity=e.intensity),a().isNumber(e.distance)&&(n.defaultInteriorLightProperty.distance=e.distance),a().isNumber(e.decay)&&(n.defaultInteriorLightProperty.decay=e.decay),a().isBoolean(e.shadow)&&(n.defaultInteriorLightProperty.shadow=e.shadow),a().isNumber(e.shadowMapSize)&&(n.defaultInteriorLightProperty.shadowMapSize=e.shadowMapSize),a().isBoolean(e.addHelper)&&(n.defaultInteriorLightProperty.addHelper=e.addHelper))},n.addTemplateLight=function(e,t){if(!a().isNil(e)&&!a().isNil(t)){n.setinteriorLightProperty(t);var r=new E.PointLight(n.defaultInteriorLightProperty.color,n.defaultInteriorLightProperty.intensity,n.defaultInteriorLightProperty.distance,n.defaultInteriorLightProperty.decay);r.castShadow=n.defaultInteriorLightProperty.shadow,r.receiveShadow=n.defaultInteriorLightProperty.shadow,r.shadow.mapSize.width=n.defaultInteriorLightProperty.shadowMapSize,r.shadow.mapSize.height=n.defaultInteriorLightProperty.shadowMapSize,n.templateLights.set(e,r)}},n.addTemplateLightToScene=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:1,z:0},r=arguments.length>2?arguments[2]:void 0;if(!a().isNil(e)&&!n.interiorLights.get(e)){var i=n.getCore().scene,o=n.templateLights.get(r).clone();if(o.position.set(t.x,t.y,t.z),o.name=e,n.interiorLights.set(e,o),i.add(o),n.defaultInteriorLightProperty.addHelper){var s=new E.CameraHelper(o.shadow.camera);i.add(s)}return n.core.needUpdate=!0,o}},n.addInteriorPointLight=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:1,z:0},r=arguments.length>2?arguments[2]:void 0;if(!a().isNil(e)&&!a().isNil(r)){n.setinteriorLightProperty(r);var i=n.getCore().scene,o=new E.PointLight(n.defaultInteriorLightProperty.color,n.defaultInteriorLightProperty.intensity,n.defaultInteriorLightProperty.distance,n.defaultInteriorLightProperty.decay);if(o.castShadow=n.defaultInteriorLightProperty.shadow,o.receiveShadow=n.defaultInteriorLightProperty.shadow,o.shadow.mapSize.width=n.defaultInteriorLightProperty.shadowMapSize,o.shadow.mapSize.height=n.defaultInteriorLightProperty.shadowMapSize,o.position.set(t.x,t.y,t.z),n.interiorLights.set(e,o),i.add(o),n.defaultInteriorLightProperty.addHelper){var s=new E.CameraHelper(o.shadow.camera);i.add(s)}n.core.needUpdate=!0}},n.getInteriorLightByName=function(e){if(!a().isNil(e))return n.interiorLights.get(e)},n.setMovingLights=function(e){e.forEach((function(e){n.getCore().needMovingLights.push(n.getInteriorLightByName(e))})),n.getCore().isMovingLight=!0},n.removeMovingLights=function(){n.getCore().needMovingLights=[],n.getCore().isMovingLight=!1},n.setMovingParams=function(e,t,r){n.getCore().movingXmax=e,n.getCore().movingXmix=t,n.getCore().movingSpeed=r},n.removeInteriorLightByName=function(e){if(!a().isNil(e)){var t=n.getCore().scene,r=n.interiorLights.get(e);t.remove(r),n.interiorLights.delete(e),n.core.needUpdate=!0}},n.removeAllInteriorLights=function(){var e=n.getCore().scene;n.interiorLights.forEach((function(t,n){e.remove(t)})),n.interiorLights=new Map,n.core.needUpdate=!0},n.removeAllSceneLight=function(){var e=n.getCore().scene;n.sceneLights.forEach((function(t,n){e.remove(t)})),n.sceneLights=new Map,n.core.needUpdate=!0},n.adjustInteriorLightByName=function(e,t,r){if(!a().isNil(e)&&!a().isNil(t)&&!a().isNil(r)){var i=n.interiorLights.get(e);null!=i&&(i[t]=r,n.core.needUpdate=!0)}},n.resetInteriorLightByName=function(e,t,r){if(!a().isNil(e)){var i=n.interiorLights.get(e);null!=i&&(i.intensity=r,i.position.set(t.x,t.y,t.z),n.core.needUpdate=!0)}},n.addLensflare=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.LensflareSize,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.lensFlareDistance;if(!a().isNil(e)){for(var i=(new E.TextureLoader).load(n.TEXTURE_FLARE_0_URL),o=(new E.TextureLoader).load(n.TEXTURE_FLARE_3_URL),s=i,l=new E.Lensflare,u=0;u<t.length;u++)l.addElement(new E.LensflareElement(s,t[u],r[u],e.color)),s=o;e.add(l),n.core.needUpdate=!0}},n.addSunToScene=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777215,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.8*Math.PI,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:512,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:512,l=n.getCore().scene,u=new E.DirectionalLight(r,i);a().isNil(t)||u.position.set(t.x,t.y,t.z),u.castShadow=!0,u.receiveShadow=!0,u.shadow.mapSize.width=o,u.shadow.mapSize.height=s,n.addLensflare(u),l.add(u),n.sceneLights.set(e,u),n.core.needUpdate=!0},n.addPointLightForCamera=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16777215,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,l=n.getCore().camera,u=new E.PointLight(r,i,o,s);a().isNil(t)||u.position.set(t.x,t.y,t.z),l.add(u),n.cameraLights.set(e,u),n.core.needUpdate=!0},n.removeLightForScene=function(e){var t=n.getCore(),r=t.scene,i=t.dispose;if(void 0!==e){var a=n.sceneLights.get(e);a&&(a.userData.helper&&i(a.userData.helper),a.userData.pointMesh&&i(a.userData.pointMesh),r.remove(a),n.sceneLights.delete(e))}else n.sceneLights.forEach((function(e,t){e.userData.helper&&i(e.userData.helper),e.userData.pointMesh&&i(e.userData.pointMesh),r.remove(e)})),n.sceneLights=new Map;n.core.needUpdate=!0},n.removeLightForCamera=function(e){var t=n.getCore().camera,r=n.cameraLights.get(e);t.remove(r),n.cameraLights.delete(e),n.core.needUpdate=!0},n.showAllDirectionalLight=function(){n.getCore().scene.traverse((function(e){"DirectionalLight"==e.type&&(e.visible=!0)})),n.core.needUpdate=!0},n.hideAllDirectionalLight=function(){n.getCore().scene.traverse((function(e){"DirectionalLight"==e.type&&(e.visible=!1)})),n.core.needUpdate=!0},n.adjustLight=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/8,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=n.getCore(),a=i.scene,o=i.getObject3dPosition;a.traverse((function(n){if("SpotLight"==n.type){var i=o(n);n.castShadow=r,n.angle=t,n.intensity=e,n.target.position.set(i.x,i.y-2,i.z)}else"PointLight"==n.type&&(n.castShadow=r,n.intensity=e,n.shadow.mapSize.width=2048,n.shadow.mapSize.height=2048)})),n.core.needUpdate=!0},n.addSplotLight=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new E.Vector3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new E.Vector3||null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16777215,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:10,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI/4,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:.5,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:2,c=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],h=arguments.length>10&&void 0!==arguments[10]&&arguments[10],d=n.getCore().scene,p=new E.Object3D;p.name="target"+e,r?p.position.set(r.x,r.y,r.z):p.position.set(t.x,t.y-2,t.z),d.add(p);var f=new E.SpotLight(i,a,o,s,l,u);if(f.name=e,f.position.set(t.x,t.y,t.z),f.target=p,f.castShadow=c,n.sceneLights.set(e,f),d.add(f),h){var m=new E.MeshBasicMaterial({color:16711680,transparent:!0,opacity:1}),v=new E.SphereGeometry(.3,32,32),g=new E.Mesh(v,m);g.position.set(t.x,t.y,t.z),g.renderOrder=20,g.name=e,g.layers.enable(5),g.userData.type="label",d.add(g),f.userData.pointMesh=g;var y=new E.SpotLightHelper(f);requestAnimationFrame((function(){y.update()})),d.add(y),f.userData.helper=y}return n.core.needUpdate=!0,f},n.addSpotLightForScene=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new E.Vector3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new E.Vector3,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Math.PI/8*50,s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:14740855,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:9,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:.3,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,d=n.getCore(),p=d.scene,f=d.rotateOnAxisY;if(!n.sceneLights.get(e)){var m=new E.SpotLight(l,a,u,o,c,h),v=f(new E.Vector3(t.x,t.y,t.z),r).add(i);m.position.set(v.x,v.y,v.z),p.add(m);var g=new E.Object3D;g.position.set(v.x,v.y-2,v.z),p.add(g),m.target=g,m.name=e,m.castShadow=s,m.scale.set(2.54,2.54,2.54),n.sceneLights.set(e,m),n.core.needUpdate=!0}},n.addSoptLightVolume=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:-1.431,y:8.789,z:0},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new E.Vector3,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{color:{type:"color",value:14740855},fadeRangeMin:{type:"float",value:.2},power:{type:"float",value:-.4},base:{type:"float",value:-.5},minclipY:{type:"float",value:0},maxclipY:{type:"float",value:1/0},fadeRangeMax:{type:"float",value:7.8}},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{raidus:7,height:8.8,radialSegments:64,heightSegments:16,openEnded:!1};if(e.trim(),!n.lightVolumes.has(e)){var l=n.getCore(),u=l.scene,c=l.meshToCenter,h=l.rotateOnAxisY,d=new E.ConeBufferGeometry(o.raidus,o.height,o.radialSegments,o.heightSegments,o.openEnded),p=tt(et,a),f=new s.Mesh(d,p);f.name=e,c(f,new E.Vector3(0,1,0));var m=h(new E.Vector3(t.x,t.y,t.z),r).add(i);return f.position.set(m.x,m.y,m.z),f.updateMatrixWorld(),u.add(f),n.lightVolumes.set(e,f),n.core.needUpdate=!0,f}},n.updateSpotLightVolume=function(e,t){var r=n.lightVolumes.get(e);if(void 0!==r){var i=r.material;t.color&&(i.uniforms.color=new E.Color(t.color)),t.fadeRangeMin&&(i.uniforms.fadeRangeMin=t.fadeRangeMin),t.fadeFactor&&(i.uniforms.fadeFactor=t.fadeFactor),t.fadeRangeMax&&(i.uniforms.fadeRangeMax=t.fadeRangeMax),t.power&&(i.uniforms.power=t.power),t.base&&(i.uniforms.base=t.base),i.needsUpdate=!0,n.core.needUpdate=!0}},n.removeLightVolume=function(e){var t=n.getCore().removeObject;if(void 0!==e)n.lightVolumes.has(e)&&(t(n.lightVolumes.get(e)),n.lightVolumes.delete(e));else{var r,i=w(n.lightVolumes.values());try{for(i.s();!(r=i.n()).done;)t(r.value)}catch(e){i.e(e)}finally{i.f()}n.lightVolumes.clear()}n.core.needUpdate=!0},n.addPointLightForScene=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new E.Vector3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:16777215,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=n.getCore().scene,h=new E.PointLight(o,r,s,l);if(a().isNil(t)||h.position.set(t.x,t.y,t.z),h.name=e,h.castShadow=i,h.shadow.mapSize.width=2048,h.shadow.mapSize.height=2048,n.sceneLights.set(e,h),c.add(h),u){var d=new E.MeshBasicMaterial({color:16711680,transparent:!0,opacity:1}),p=new E.SphereGeometry(.3,32,32),f=new E.Mesh(p,d);f.position.set(t.x,t.y,t.z),f.renderOrder=20,f.name=e,f.layers.enable(5),f.userData.type="label",h.userData.pointMesh=f,c.add(f),h.userData.pointMesh=f}return n.core.needUpdate=!0,h},n.hideLightForScene=function(e){if(e){var t=n.sceneLights.get(e);t&&(t.visible=!1)}else n.sceneLights.forEach((function(e,t){e.visible=!1}));n.core.needUpdate=!0},n.showLightForScene=function(e){if(e){var t=n.sceneLights.get(e);t&&(t.visible=!0)}else n.sceneLights.forEach((function(e,t){e.visible=!0}));n.core.needUpdate=!0},n.sceneLights=new Map,n.cameraLights=new Map,n.interiorLights=new Map,n.templateLights=new Map,n.isInit=!1,n.isMutex=!0,n.isHF=!0,rt(),a().isNil(e)||(n.config=e),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"setdefaultLightProperty",value:function(e){e.ambientLight&&(e.ambientLight.color&&(this.defaultAmbientLight.color=new E.Color(e.ambientLight.color)),void 0!==e.ambientLight.intensity&&(this.defaultAmbientLight.intensity=e.ambientLight.intensity)),e.hemisphereLight&&(e.hemisphereLight.color&&(this.defaultHemisphereLight.color=new E.Color(e.hemisphereLight.color)),e.hemisphereLight.groundColor&&(this.defaultHemisphereLight.groundColor=new E.Color(e.hemisphereLight.groundColor)),void 0!==e.hemisphereLight.intensity&&(this.defaultHemisphereLight.intensity=e.hemisphereLight.intensity)),e.directionalLight&&(e.directionalLight.color&&(this.defaultDirectionalLight.color=new E.Color(e.directionalLight.color)),void 0!==e.directionalLight.intensity&&(this.defaultDirectionalLight.intensity=e.directionalLight.intensity),void 0!==e.directionalLight.castShadow&&(this.defaultDirectionalLight.castShadow=e.directionalLight.castShadow),void 0!==e.directionalLight.bias&&(this.defaultDirectionalLight.shadow.bias=e.directionalLight.bias),void 0!==e.directionalLight.position&&this.defaultDirectionalLight.position.set(e.directionalLight.position.x,e.directionalLight.position.y,e.directionalLight.position.z),void 0!==e.directionalLight.target&&(this.defaultDirectionalLight.target.position.set(e.directionalLight.target.x,e.directionalLight.target.y,e.directionalLight.target.z),this.defaultDirectionalLight.target.parent||this.getCore().scene.add(this.defaultDirectionalLight.target))),this.core.needUpdate=!0}},{key:"setdefaultLightPropertyByType",value:function(e,t,n){"color"===t||"groundColor"===t?this[e][t]=new E.Color(n):"position"===t?this[e][t].set(n.x,n.y,n.z):this[e][t]=n,this.core.needUpdate=!0}},{key:"addAreaLight",value:function(e,t,n,r,i,a,o){var s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],u=this.getCore().scene,c=new E.RectAreaLight(t,n,r,i);if(c.name=e,c.position.set(a.x,a.y,a.z),c.rotation.set(o.x,o.y,o.z),c.visible=s,u.add(c),this.sceneLights.set(e,c),l){var h=new it(c);h.name=e+"Helper",h.position.set(a.x,a.y,a.z),h.rotation.set(o.x,o.y,o.z),u.add(h);var d=new E.MeshBasicMaterial({color:16711680,transparent:!0,opacity:1}),p=new E.SphereGeometry(.3,32,32),f=new E.Mesh(p,d);f.position.set(a.x,a.y,a.z),f.renderOrder=20,f.name=e,f.layers.enable(5),f.userData.type="label",c.userData.pointMesh=f,c.userData.helper=h,u.add(f)}return this.core.needUpdate=!0,c}}])}(ke),ot=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ModelsDB",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];(0,v.default)(this,e),this._version=1,this.DB_NAME="modelDB",this.db=null,this.STORE_NAME="model",this.support=this.checkDBSupper(),this._version=n,this.DB_NAME=t,this.enabled=r,this.createDB(this.DB_NAME,Date.now())}return(0,g.default)(e,[{key:"version",get:function(){return this._version}},{key:"add",value:function(e,t){var n=this;if(!this.support||!this.enabled)return Promise.resolve(null);var r=indexedDB.open(this.DB_NAME);r.onsuccess=function(i){var a={url:e,data:t,version:n._version},o=r.result,s=o.transaction([n.STORE_NAME],"readwrite").objectStore(n.STORE_NAME).add(a);s.onsuccess=function(){o.close()},s.onerror=function(e){o.close()}}}},{key:"get",value:function(e){var t=this;return this.support&&this.enabled?new Promise((function(n,r){var i=indexedDB.open(t.DB_NAME);i.onsuccess=function(a){var o=i.result,s=o.transaction([t.STORE_NAME],"readonly").objectStore(t.STORE_NAME).get(e);s.onsuccess=function(e){var t=s.result;n(t),o.close()},s.onerror=function(e){r(void 0),o.close()}}})):Promise.resolve(null)}},{key:"put",value:function(e,t){var n=this;if(!this.support||!this.enabled)return null;var r=indexedDB.open(this.DB_NAME);r.onsuccess=function(i){var a={url:e,data:t,version:n._version},o=r.result,s=o.transaction([n.STORE_NAME],"readwrite").objectStore(n.STORE_NAME).put(a);s.onsuccess=function(e){o.close()},s.onerror=function(e){o.close()}}}},{key:"checkDBSupper",value:function(){return!!window.indexedDB}},{key:"createDB",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.DB_NAME,n=arguments.length>1?arguments[1]:void 0;if(!this.support||!this.enabled)return null;var r=indexedDB.open(t,n);r.onerror=function(e){},r.onsuccess=function(t){e.db=r.result,e.db.onversionchange=function(){e.db.close()}},r.onupgradeneeded=function(t){e.db=r.result,e.db.onversionchange=function(){e.db.close()},e.db.objectStoreNames.contains(e.STORE_NAME)||e.db.createObjectStore(e.STORE_NAME,{keyPath:"url"})}}},{key:"deleteDB",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.DB_NAME;if(!this.support||!this.enabled)return null;try{var t=indexedDB.deleteDatabase(e);this.db=null,t.onerror=function(){},t.onsuccess=function(){}}catch(e){}}}])}();function st(e){var t;try{t=new URL(e,"http://fakehost.com/")}catch(e){return null}var n=t.pathname.split("/").pop(),r=n.lastIndexOf(".");return-1===r||r===n.length-1?null:n.substring(r+1)}var lt=function(){function e(){(0,v.default)(this,e),this.maxSize=800,this.minSize=600,this.unloadPercent=.05,this.itemSet=new Map,this.itemList=[],this.usedSet=new Set,this.callbacks=new Map,this.unloadPriorityCallback=null;var t=this.itemSet;this.defaultPriorityCallback=function(e){return t.get(e)}}return(0,g.default)(e,[{key:"isFull",value:function(){return this.itemSet.size>=this.maxSize}},{key:"add",value:function(e,t){var n=this.itemSet;if(n.has(e))return!1;if(this.isFull())return!1;var r=this.usedSet,i=this.itemList,a=this.callbacks;return i.push(e),r.add(e),n.set(e,Date.now()),a.set(e,t),!0}},{key:"remove",value:function(e){var t=this.usedSet,n=this.itemSet,r=this.itemList,i=this.callbacks;if(n.has(e)){i.get(e)(e);var a=r.indexOf(e);return r.splice(a,1),t.delete(e),n.delete(e),i.delete(e),!0}return!1}},{key:"markUsed",value:function(e){var t=this.itemSet,n=this.usedSet;t.has(e)&&!n.has(e)&&(t.set(e,Date.now()),n.add(e))}},{key:"markAllUnused",value:function(){this.usedSet.clear()}},{key:"unloadUnusedContent",value:function(){var e=this.unloadPercent,t=this.minSize,n=this.itemList,r=this.itemSet,i=this.usedSet,a=this.callbacks,o=n.length-i.size,s=n.length-t,l=this.unloadPriorityCallback||this.defaultPriorityCallback;if(s>0&&o>0){n.sort((function(e,t){var n=i.has(e),r=i.has(t);return n&&r?0:n||r?n?1:-1:l(t)-l(e)}));var u=Math.min(s,o),c=Math.max(t*e,u*e),h=Math.min(c,o);h=Math.ceil(h);for(var d=n.splice(0,h),p=0,f=d.length;p<f;p++){var m=d[p];a.get(m)(m),r.delete(m),a.delete(m)}}}},{key:"scheduleUnload",value:function(){var e,t=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.scheduled||(this.scheduled=!0,e=function(){t.scheduled=!1,t.unloadUnusedContent(),n&&t.markAllUnused()},Promise.resolve().then(e))}}])}(),ut=function(){function e(){var t=this;(0,v.default)(this,e),this.maxJobs=6,this.items=[],this.callbacks=new Map,this.currJobs=0,this.scheduled=!1,this.autoUpdate=!0,this.priorityCallback=function(){throw new Error("PriorityQueue: PriorityCallback function not defined.")},this.schedulingCallback=function(e){requestAnimationFrame(e)},this._runjobs=function(){t.tryRunJobs(),t.scheduled=!1}}return(0,g.default)(e,[{key:"sort",value:function(){var e=this.priorityCallback;this.items.sort(e)}},{key:"add",value:function(e,t){var n=this;return new Promise((function(r,i){var a=n.items,o=n.callbacks;a.push(e),o.set(e,(function(){return t.apply(void 0,arguments).then(r).catch(i)})),n.autoUpdate&&n.scheduleJobRun()}))}},{key:"remove",value:function(e){var t=this.items,n=this.callbacks,r=t.indexOf(e);-1!==r&&(t.splice(r,1),n.delete(e))}},{key:"tryRunJobs",value:function(){var e=this;this.sort();for(var t=this.items,n=this.callbacks,r=this.maxJobs,i=this.currJobs;r>i&&t.length>0;){i++;var a=t.pop(),o=n.get(a);n.delete(a),o(a).then((function(){e.currJobs--,e.autoUpdate&&e.scheduleJobRun()})).catch((function(){e.currJobs--,e.autoUpdate&&e.scheduleJobRun()}))}this.currJobs=i}},{key:"scheduleJobRun",value:function(){this.scheduled||(this.schedulingCallback(this._runjobs),this.scheduled=!0)}}])}(),ct=3,ht=4,dt=6378137;function pt(e){return e===ct||e===ht}function ft(e,t){return e.__lastFrameVisited===t&&e.__used}function mt(e,t){e.__lastFrameVisited!==t&&(e.__lastFrameVisited=t,e.__used=!1,e.__inFrustum=!1,e.__isLeaf=!1,e.__visible=!1,e.__active=!1,e.__error=1/0,e.__distanceFromCamera=1/0,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1)}function vt(e,t,n){if(mt(e,t),e.__used=!0,n.markUsed(e),e.__contentEmpty)for(var r=e.children,i=0,a=r.length;i<a;i++)vt(r[i],t,n)}function gt(e,t,n){if(!e.__contentEmpty||e.__externalTileSet&&!pt(e.__loadingState))n.requestTileContents(e);else for(var r=e.children,i=0,a=r.length;i<a;i++){var o=r[i];o.__depthFromRenderedParent=t,gt(o,t,n)}}function yt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(t&&t(e,r,i))n&&n(e,r,i);else{for(var a=e.children,o=0,s=a.length;o<s;o++)yt(a[o],t,n,e,i+1);n&&n(e,r,i)}}function xt(e,t){var n=t.stats,r=t.frameCount,i=t.errorTarget,a=t.maxDepth,o=t.loadSiblings,s=t.lruCache,l=t.stopAtEmptyTiles;if(mt(e,r),!1===t.tileInView(e))return!1;if(e.__used=!0,s.markUsed(e),e.__inFrustum=!0,n.inFrustum++,(l||!e.__contentEmpty)&&!e.__externalTileSet){if(t.calculateError(e),e.__error<=i)return!0;if(t.maxDepth>0&&e.__depth+1>=a)return!0}for(var u=!1,c=e.children,h=0,d=c.length;h<d;h++){var p=xt(c[h],t);u=u||p}if(u&&o)for(var f=0,m=c.length;f<m;f++)vt(c[f],r,s);return!0}function bt(e,t){var n=t.stats,r=t.frameCount;if(ft(e,r)){n.used++;for(var i=e.children,a=!1,o=0,s=i.length;o<s;o++){var l=i[o];a=a||ft(l,r)}if(a){for(var u=!1,c=!0,h=0,d=i.length;h<d;h++){var p=i[h];if(bt(p,t),u=u||p.__wasSetVisible||p.__childrenWereVisible,ft(p,r)){var f=p.__allChildrenLoaded||!p.__contentEmpty&&pt(p.__loadingState)||p.__externalTileSet&&p.__loadingState===ht;c=c&&f}}e.__childrenWereVisible=u,e.__allChildrenLoaded=c}else e.__isLeaf=!0}}function Mt(e,t){var n=t.stats,r=t.frameCount;if(ft(e,r)){var i=e.parent,a=i?i.__depthFromRenderedParent:-1;e.__depthFromRenderedParent=a;var o=t.lruCache;if(e.__isLeaf)return e.__depthFromRenderedParent++,void(e.__loadingState===ct?(e.__inFrustum&&(e.__visible=!0,n.visible++),e.__active=!0,n.active++):o.isFull()||e.__contentEmpty&&!e.__externalTileSet||t.requestTileContents(e));var s=(t.errorTarget+1)*t.errorThreshold,l=e.__error<=s,u=l||"ADD"===e.refine,c=!e.__contentEmpty,h=c||e.__externalTileSet,d=pt(e.__loadingState)&&h,p=e.__childrenWereVisible,f=e.children,m=e.__allChildrenLoaded;if(u&&c&&e.__depthFromRenderedParent++,u&&!d&&!o.isFull()&&h&&t.requestTileContents(e),(l&&!m&&!p&&d||"ADD"===e.refine&&d)&&(e.__inFrustum&&(e.__visible=!0,n.visible++),e.__active=!0,n.active++),"ADD"!==e.refine&&l&&!m&&d)for(var v=0,g=f.length;v<g;v++){var y=f[v];ft(y,r)&&!o.isFull()&&(y.__depthFromRenderedParent=e.__depthFromRenderedParent+1,gt(y,y.__depthFromRenderedParent,t))}else for(var x=0,b=f.length;x<b;x++){var M=f[x];ft(M,r)&&Mt(M,t)}}}function wt(e,t){var n=ft(e,t.frameCount);if(n||e.__usedLastFrame){var r=!1,i=!1;n&&(r=e.__active,i=t.displayActiveTiles&&e.__active||e.__visible),e.__contentEmpty||e.__loadingState!==ct||(e.__wasSetActive!==r&&t.setTileActive(e,r),e.__wasSetVisible!==i&&t.setTileVisible(e,i)),e.__wasSetActive=r,e.__wasSetVisible=i,e.__usedLastFrame=n;for(var a=e.children,o=0,s=a.length;o<s;o++)wt(a[o],t)}}var _t=function(e,t){return e.__depth!==t.__depth?e.__depth>t.__depth?-1:1:e.__inFrustum!==t.__inFrustum?e.__inFrustum?1:-1:e.__used!==t.__used?e.__used?1:-1:e.__error!==t.__error?e.__error>t.__error?1:-1:e.__distanceFromCamera!==t.__distanceFromCamera?e.__distanceFromCamera>t.__distanceFromCamera?-1:1:0},At=function(e){return 1/(e.__depthFromRenderedParent+1)},Ct=function(){function e(t){(0,v.default)(this,e),this.tileSets={},this.rootURL=t,this.fetchOptions={},this.preprocessURL=null;var n=new lt;n.unloadPriorityCallback=At;var r=new ut;r.maxJobs=4,r.priorityCallback=_t;var i=new ut;i.maxJobs=1,i.priorityCallback=_t,this.lruCache=n,this.downloadQueue=r,this.parseQueue=i,this.stats={parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0,this.errorTarget=6,this.errorThreshold=1/0,this.loadSiblings=!0,this.displayActiveTiles=!1,this.maxDepth=1/0,this.stopAtEmptyTiles=!0}return(0,g.default)(e,[{key:"rootTileSet",get:function(){var e=this.tileSets[this.rootURL];return!e||e instanceof Promise?null:e}},{key:"root",get:function(){var e=this.rootTileSet;return e?e.root:null}},{key:"traverse",value:function(e,t){var n=this.tileSets[this.rootURL];n&&n.root&&yt(n.root,e,t)}},{key:"update",value:function(){var e=this.stats,t=this.lruCache,n=this.tileSets,r=n[this.rootURL];if(this.rootURL in n){if(r&&r.root){var i=r.root;e.inFrustum=0,e.used=0,e.active=0,e.visible=0,this.frameCount++,xt(i,this),bt(i,this),Mt(i,this),wt(i,this),t.scheduleUnload()}}else this.loadRootTileSet(this.rootURL)}},{key:"parseTile",value:function(e,t,n){return null}},{key:"disposeTile",value:function(e){}},{key:"preprocessNode",value:function(e,t,n){if(e.content&&(!("uri"in e.content)&&"url"in e.content&&(e.content.uri=e.content.url,delete e.content.url),e.content.uri&&(e.content.uri=new URL(e.content.uri,n+"/").toString()),e.content.boundingVolume&&!("box"in e.content.boundingVolume||"sphere"in e.content.boundingVolume||"region"in e.content.boundingVolume)&&delete e.content.boundingVolume),e.parent=t,e.children=e.children||[],e.content&&e.content.uri){var r=st(e.content.uri),i=Boolean(r&&"json"===r.toLowerCase());e.__externalTileSet=i,e.__contentEmpty=i}else e.__externalTileSet=!1,e.__contentEmpty=!0;e.__distanceFromCamera=1/0,e.__error=1/0,e.__inFrustum=!1,e.__isLeaf=!1,e.__usedLastFrame=!1,e.__used=!1,e.__wasSetVisible=!1,e.__visible=!1,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1,e.__wasSetActive=!1,e.__active=!1,e.__loadingState=0,e.__loadIndex=0,e.__loadAbort=null,e.__depthFromRenderedParent=-1,null===t?(e.__depth=0,e.refine=e.refine||"REPLACE"):(e.__depth=t.__depth+1,e.refine=e.refine||t.refine)}},{key:"setTileActive",value:function(e,t){}},{key:"setTileVisible",value:function(e,t){}},{key:"calculateError",value:function(e){return 0}},{key:"tileInView",value:function(e){return!0}},{key:"resetFailedTiles",value:function(){var e=this.stats;0!==e.failed&&(this.traverse((function(e){e.__loadingState===ht&&(e.__loadingState=0)})),e.failed=0)}},{key:"fetchTileSet",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return fetch(e,t).then((function(t){if(t.ok)return t.json();throw new Error('TilesRenderer: Failed to load tileset "'.concat(e,'" with status ').concat(t.status," : ").concat(t.statusText))})).then((function(t){t.asset.version;var i=e.replace(/\/[^\/]*\/?$/,"");return i=new URL(i,window.location.href).toString(),yt(t.root,(function(e,t){return n.preprocessNode(e,t,i)}),null,r,r?r.__depth:0),t}))}},{key:"loadRootTileSet",value:function(e){var t=this.tileSets;if(e in t)return t[e]instanceof Error?Promise.reject(t[e]):Promise.resolve(t[e]);var n=this.fetchTileSet(this.preprocessURL?this.preprocessURL(e):e,this.fetchOptions).then((function(n){t[e]=n}));return n.catch((function(n){t[e]=n})),t[e]=n,n}},{key:"requestTileContents",value:function(e){var t=this;if(0===e.__loadingState){var n=this.stats,r=this.lruCache,i=this.downloadQueue,a=this.parseQueue,o=e.__externalTileSet;r.add(e,(function(e){1===e.__loadingState?(e.__loadAbort.abort(),e.__loadAbort=null):o?e.children.length=0:t.disposeTile(e),1===e.__loadingState?n.downloading--:2===e.__loadingState&&n.parsing--,e.__loadingState=0,e.__loadIndex++,a.remove(e),i.remove(e)})),e.__loadIndex++;var s=e.__loadIndex,l=new AbortController,u=l.signal;n.downloading++,e.__loadAbort=l,e.__loadingState=1;var c=function(t){e.__loadIndex===s&&("AbortError"!==t.name?(a.remove(e),i.remove(e),2===e.__loadingState?n.parsing--:1===e.__loadingState&&n.downloading--,n.failed++,e.__loadingState=ht):r.remove(e))};o?i.add(e,(function(e){if(e.__loadIndex!==s)return Promise.resolve();var n=t.preprocessURL?t.preprocessURL(e.content.uri):e.content.uri;return t.fetchTileSet(n,Object.assign({signal:u},t.fetchOptions),e)})).then((function(t){e.__loadIndex===s&&(n.downloading--,e.__loadAbort=null,e.__loadingState=ct,e.children.push(t.root))})).catch(c):i.add(e,(function(e){if(e.__loadIndex!==s)return Promise.resolve();var n=t.preprocessURL?t.preprocessURL(e.content.uri):e.content.uri;return fetch(n,Object.assign({signal:u},t.fetchOptions))})).then((function(t){if(e.__loadIndex===s){if(t.ok)return t.arrayBuffer();throw new Error("Failed to load model with error code ".concat(t.status))}})).then((function(r){if(e.__loadIndex===s)return n.downloading--,n.parsing++,e.__loadAbort=null,e.__loadingState=2,a.add(e,(function(e){if(e.__loadIndex!==s)return Promise.resolve();var n=st(e.content.uri);return t.parseTile(r,e,n)}))})).then((function(){e.__loadIndex===s&&(n.parsing--,e.__loadingState=ct,e.__wasSetVisible&&t.setTileVisible(e,!0),e.__wasSetActive&&t.setTileActive(e,!0))})).catch(c)}}},{key:"dispose",value:function(){var e=this.lruCache;this.traverse((function(t){e.remove(t)})),this.stats={parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0}}])}();function Tt(e){return(new TextDecoder).decode(e)}var St=function(){function e(t,n,r,i){(0,v.default)(this,e),this.buffer=t,this.binOffset=n+r,this.binLength=i;var a=null;if(0!==r){var o=new Uint8Array(t,n,r);a=JSON.parse(Tt(o))}else a={};this.header=a}return(0,g.default)(e,[{key:"getKeys",value:function(){return Object.keys(this.header)}},{key:"getData",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=this.header;if(!(e in i))return null;var a=i[e];if(a instanceof Object){if(Array.isArray(a))return a;var o,s,l=this.buffer,u=this.binOffset,c=this.binLength,h=a.byteOffset||0,d=a.type||r,p=a.componentType||n;if("type"in a&&r&&a.type!==r)throw new Error("FeatureTable: Specified type does not match expected type.");switch(d){case"SCALAR":o=1;break;case"VEC2":o=2;break;case"VEC3":o=3;break;case"VEC4":o=4;break;default:throw new Error('FeatureTable : Feature type not provided for "'.concat(e,'".'))}var f=u+h,m=t*o;switch(p){case"BYTE":s=new Int8Array(l,f,m);break;case"UNSIGNED_BYTE":s=new Uint8Array(l,f,m);break;case"SHORT":s=new Int16Array(l,f,m);break;case"UNSIGNED_SHORT":s=new Uint16Array(l,f,m);break;case"INT":s=new Int32Array(l,f,m);break;case"UNSIGNED_INT":s=new Uint32Array(l,f,m);break;case"FLOAT":s=new Float32Array(l,f,m);break;case"DOUBLE":s=new Float64Array(l,f,m);break;default:throw new Error('FeatureTable : Feature component type not provided for "'.concat(e,'".'))}if(f+m*s.BYTES_PER_ELEMENT>u+c)throw new Error("FeatureTable: Feature data read outside binary body length.");return s}return a}}])}(),Et=function(e){function t(e,n,r,i,a){var o;return(0,v.default)(this,t),(o=T(this,t,[e,r,i,a])).batchSize=n,o}return(0,m.default)(t,e),(0,g.default)(t,[{key:"getData",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return C(t,"getData",this,3)([e,this.batchSize,n,r])}}])}(St),Lt=function(){function e(){(0,v.default)(this,e),this.fetchOptions={},this.workingPath=""}return(0,g.default)(e,[{key:"load",value:function(e){var t=this;return fetch(e,this.fetchOptions).then((function(t){if(!t.ok)throw new Error('Failed to load file "'.concat(e,'" with status ').concat(t.status," : ").concat(t.statusText));return t.arrayBuffer()})).then((function(n){return""===t.workingPath&&(t.workingPath=t.workingPathForURL(e)),t.parse(n)}))}},{key:"resolveExternalURL",value:function(e){return/^[^\\/]/.test(e)?this.workingPath+"/"+e:e}},{key:"workingPathForURL",value:function(e){var t=e.split(/[\\/]/g);return t.pop(),t.join("/")+"/"}},{key:"parse",value:function(e){throw new Error("LoaderBase: Parse not implemented.")}}])}();function Pt(e){var t;if(t=e instanceof DataView?e:new DataView(e),"{"===String.fromCharCode(t.getUint8(0)))return null;for(var n="",r=0;r<4;r++)n+=String.fromCharCode(t.getUint8(r));return n}var Bt=function(e){function t(){return(0,v.default)(this,t),T(this,t,arguments)}return(0,m.default)(t,e),(0,g.default)(t,[{key:"parse",value:function(e){var t=new DataView(e),n=(Pt(t),t.getUint32(4,!0)),r=t.getUint32(8,!0),i=t.getUint32(12,!0),a=t.getUint32(16,!0),o=t.getUint32(20,!0),s=t.getUint32(24,!0),l=e.slice(28,28+i+a),u=new St(l,0,i,a),c=28+i+a,h=e.slice(c,c+o+s),d=new Et(h,u.getData("BATCH_LENGTH"),0,o,s),p=c+o+s;return{version:n,featureTable:u,batchTable:d,glbBytes:new Uint8Array(e,p,r-p)}}}])}(Lt),Dt=function(){function e(e){s.Loader.call(this,e),this.commonBinData={},this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new o(e)})),this.register((function(e){return new u(e)})),this.register((function(e){return new c(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new i(e)})),this.register((function(e){return new h(e)})),this.register((function(e){return new d(e)}))}function t(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(s.Loader.prototype),{constructor:e,load:function(e,t,n,r){var i,a=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:s.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);var o=function(t){r&&r(t),a.manager.itemError(e),a.manager.itemEnd(e)},l=new s.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(n){try{a.parse(n,i,(function(n){t(n),a.manager.itemEnd(e)}),o)}catch(e){o(e)}}),n,o)},loadGlb:function(e,t,n,r,i){var a,o=this;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:s.LoaderUtils.extractUrlBase(e),o.manager.itemStart(e);var l=function(t){i&&i(t),o.manager.itemError(e),o.manager.itemEnd(e)},u=new s.FileLoader(o.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),"use-credentials"===o.crossOrigin&&u.setWithCredentials(!0),u.load(e,(function(r){try{o.parseGlb(r,t,a,(function(t){n(t),o.manager.itemEnd(e)}),l)}catch(e){l(e)}}),r,l)},preload:function(e,t,n,r){var i=this;""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:s.LoaderUtils.extractUrlBase(e),i.manager.itemStart(e);var a=new s.FileLoader(i.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),"use-credentials"===i.crossOrigin&&a.setWithCredentials(!0),a.load(e,(function(n){t(n),i.manager.itemError(e),i.manager.itemEnd(e)}),n,(function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}))},loadFileDate:function(e,t,n){var r=this,i=function(e){n&&n(e)};try{r.parse(e,r.resourcePath,(function(e){t(e)}),i)}catch(e){i(e)}},loadNewFileDate:function(e,t,n,r){var i=this,a=function(e){r&&r(e)};try{i.parseGlb(e,t,i.resourcePath,(function(e){n(e)}),a)}catch(e){a(e)}},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,i,o){var l,u={},c={};if("string"==typeof e)l=e;else{var h=s.LoaderUtils.decodeText(new Uint8Array(e,0,4));if(h===p||h===f){try{u[n.KHR_BINARY_GLTF]=new b(e)}catch(e){return void(o&&o(e))}l=u[n.KHR_BINARY_GLTF].content}else l=s.LoaderUtils.decodeText(new Uint8Array(e))}var d=JSON.parse(l);if(void 0===d.asset||d.asset.version[0]<2)o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var m=new V(d,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});m.fileLoader.setRequestHeader(this.requestHeader);for(var v=0;v<this.pluginCallbacks.length;v++){var g=this.pluginCallbacks[v](m);c[g.name]=g,u[g.name]=!0}if(d.extensionsUsed)for(v=0;v<d.extensionsUsed.length;++v){var y=d.extensionsUsed[v],x=d.extensionsRequired||[];switch(y){case n.KHR_MATERIALS_UNLIT:u[y]=new a;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:u[y]=new C;break;case n.KHR_DRACO_MESH_COMPRESSION:u[y]=new M(d,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:u[y]=new r(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:u[y]=new _;break;case n.KHR_MESH_QUANTIZATION:u[y]=new T;break;default:x.indexOf(y)>=0&&c[y]}}m.setExtensions(u),m.setPlugins(c),m.parse(i,o)}},parseGlb:function(e,t,l,u,c){var h,d=this,m={};if("string"==typeof e)h=e;else{var v=s.LoaderUtils.decodeText(new Uint8Array(e,0,4));if(v===p||v===f){try{m[n.KHR_BINARY_GLTF]=new b(e)}catch(e){return void(c&&c(e))}h=m[n.KHR_BINARY_GLTF].content}else h=s.LoaderUtils.decodeText(new Uint8Array(e))}var g=JSON.parse(h);if(void 0===g.asset||g.asset.version[0]<2)c&&c(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{if(g.extensionsUsed)for(var y=0;y<g.extensionsUsed.length;++y){var x=g.extensionsUsed[y],w=g.extensionsRequired||[];switch(x){case n.KHR_LIGHTS_PUNCTUAL:m[x]=new i(g);break;case n.KHR_MATERIALS_CLEARCOAT:m[x]=new o;break;case n.KHR_MATERIALS_UNLIT:m[x]=new a;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:m[x]=new C;break;case n.KHR_DRACO_MESH_COMPRESSION:m[x]=new M(g,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:m[x]=new r(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:m[x]=new _;break;case n.KHR_MESH_QUANTIZATION:m[x]=new T;break;default:w.indexOf(x)}}var A=new V(g,m,{path:l||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});if(A.fileLoader.setRequestHeader(this.requestHeader),0!=t.length){var S=0;g.buffers.forEach((function(e){null!=e.uri&&(e.uri=t[S],e.uri in d.commonBinData||(d.commonBinData[e.uri]=new Promise((function(t,n){A.fileLoader.load(e.uri,t,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.url+'".'))}))}))),A.currentBinData[e.uri]=d.commonBinData[e.uri],S++)}))}A.parse(u,c)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};function r(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=e}function i(e){this.parser=e,this.name=n.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function a(){this.name=n.KHR_MATERIALS_UNLIT}function o(e){this.parser=e,this.name=n.KHR_MATERIALS_CLEARCOAT}function l(e){this.parser=e,this.name=n.KHR_MATERIALS_TRANSMISSION}function u(e){this.parser=e,this.name=n.KHR_TEXTURE_BASISU}function c(e){this.parser=e,this.name=n.EXT_TEXTURE_WEBP,this.isSupported=null}function h(e){this.name=n.EXT_MESHOPT_COMPRESSION,this.parser=e}i.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,r=t.length;n<r;n++){var i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}},i.prototype._loadLight=function(e){var t=this.parser,n="light:"+e,r=t.cache.get(n);if(r)return r;var i,a=t.json,o=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e],l=new s.Color(16777215);void 0!==o.color&&l.fromArray(o.color);var u=void 0!==o.range?o.range:0;switch(o.type){case"directional":(i=new s.DirectionalLight(l)).target.position.set(0,0,-1),i.add(i.target);break;case"point":(i=new s.PointLight(l)).distance=u;break;case"spot":(i=new s.SpotLight(l)).distance=u,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,i.angle=o.spot.outerConeAngle,i.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+o.type+'".')}return i.position.set(0,0,0),i.decay=2,void 0!==o.intensity&&(i.intensity=o.intensity),i.name=t.createUniqueName(o.name||"light_"+e),r=Promise.resolve(i),t.cache.add(n,r),r},i.prototype.createNodeAttachment=function(e){var t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return n._getNodeRef(t.cache,i,e)}))},a.prototype.getMaterialType=function(){return s.MeshBasicMaterial},a.prototype.extendParams=function(e,t,n){var r=[];e.color=new s.Color(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var a=i.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(r)},o.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.MeshPhysicalMaterial:null},o.prototype.extendMaterialParams=function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],a=r.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&i.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(i.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){var o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new s.Vector2(o,o)}return Promise.all(i)},l.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.MeshPhysicalMaterial:null},l.prototype.extendMaterialParams=function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],a=r.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(i)},u.prototype.loadTexture=function(e){var t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var i=r.extensions[this.name],a=n.images[i.source],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a,o)},c.prototype.loadTexture=function(e){var t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;var a=i.extensions[t],o=r.images[a.source],s=o.uri?n.options.manager.getHandler(o.uri):n.textureLoader;return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,o,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))},c.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported},h.prototype.loadBufferView=function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var r=n.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,a.ready]).then((function(e){var t=r.byteOffset||0,n=r.byteLength||0,i=r.count,o=r.byteStride,s=new ArrayBuffer(i*o),l=new Uint8Array(e[0],t,n);return a.decodeGltfBuffer(new Uint8Array(s),i,o,l,r.mode,r.filter),s}))}return null};var d=function(){function e(t){(0,v.default)(this,e),this.name=n.EXT_MESH_GPU_INSTANCING,this.parser=t}return(0,g.default)(e,[{key:"createNodeMesh",value:function(e){var t=this,n=this.parser.json,r=n.nodes[e];if(!r.extensions||!r.extensions[this.name]||void 0===r.mesh)return null;var i,a=w(n.meshes[r.mesh].primitives);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(o.mode!==E.TRIANGLES&&o.mode!==E.TRIANGLE_STRIP&&o.mode!==E.TRIANGLE_FAN&&void 0!==o.mode)return null}}catch(e){a.e(e)}finally{a.f()}var l=r.extensions[this.name].attributes,u=[],c={},h=function(e){u.push(t.parser.getDependency("accessor",l[e]).then((function(t){return c[e]=t,c[e]})))};for(var d in l)h(d);return u.length<1?null:(u.push(this.parser.createNodeMesh(e)),Promise.all(u).then((function(e){var n,r=e.pop(),i=r.isGroup?r.children:[r],a=e[0].count,o=[],l=w(i);try{for(l.s();!(n=l.n()).done;){for(var u=n.value,h=new s.Matrix4,d=new s.Vector3,p=new s.Quaternion,f=new s.Vector3(1,1,1),m=new s.InstancedMesh(u.geometry,u.material,a),v=0;v<a;v++)c.TRANSLATION&&d.fromBufferAttribute(c.TRANSLATION,v),c.ROTATION&&p.fromBufferAttribute(c.ROTATION,v),c.SCALE&&f.fromBufferAttribute(c.SCALE,v),m.setMatrixAt(v,h.compose(d,p,f));s.Object3D.prototype.copy.call(m,u),t.parser.assignFinalMaterial(m),o.push(m)}}catch(e){l.e(e)}finally{l.f()}return r.isGroup?(r.clear(),r.add.apply(r,o),r):o[0]})))}}])}(),p="glTF",f="glyb",m=12,x={JSON:1313821514,BIN:5130562};function b(e){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,m);if(this.header={magic:s.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==p&&this.header.magic!==f)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var r=new DataView(e,m),i=0;i<r.byteLength;){var a=r.getUint32(i,!0);i+=4;var o=r.getUint32(i,!0);if(i+=4,o===x.JSON){var l=new Uint8Array(e,m+i,a);this.content=s.LoaderUtils.decodeText(l)}else if(o===x.BIN){var u=m+i;this.body=e.slice(u,u+a)}i+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function M(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function _(){this.name=n.KHR_TEXTURE_TRANSFORM}function A(e){s.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new s.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(var s in o)e.uniforms[s]=o[s];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function C(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return A},extendParams:function(e,t,n){var r=t.extensions[this.name];e.color=new s.Color(1,1,1),e.opacity=1;var i=[];if(Array.isArray(r.diffuseFactor)){var a=r.diffuseFactor;e.color.fromArray(a),e.opacity=a[3]}if(void 0!==r.diffuseTexture&&i.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new s.Color(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new s.Color(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var o=r.specularGlossinessTexture;i.push(n.assignTexture(e,"glossinessMap",o)),i.push(n.assignTexture(e,"specularMap",o))}return Promise.all(i)},createMaterial:function(e){var t=new A(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=s.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function T(){this.name=n.KHR_MESH_QUANTIZATION}function S(e,t,n,r){s.Interpolant.call(this,e,t,n,r)}M.prototype.decodePrimitive=function(e,t){var n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(var u in a){var c=k[u]||u.toLowerCase();o[c]=a[u]}for(u in e.attributes)if(c=k[u]||u.toLowerCase(),void 0!==a[u]){var h=n.accessors[e.attributes[u]],d=L[h.componentType];l[c]=d,s[c]=!0===h.normalized}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var n in e.attributes){var r=e.attributes[n],i=s[n];void 0!==i&&(r.normalized=i)}t(e)}),o,l)}))}))},_.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),t.texCoord,e.needsUpdate=!0,e},A.prototype=Object.create(s.MeshStandardMaterial.prototype),A.prototype.constructor=A,A.prototype.copy=function(e){return s.MeshStandardMaterial.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},S.prototype=Object.create(s.Interpolant.prototype),S.prototype.constructor=S,S.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r,a=0;a!==r;a++)t[a]=n[i+a];return t},S.prototype.beforeStart_=S.prototype.copySampleValue_,S.prototype.afterEnd_=S.prototype.copySampleValue_,S.prototype.interpolate_=function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,u=r-t,c=(n-t)/u,h=c*c,d=h*c,p=e*l,f=p-l,m=-2*d+3*h,v=d-h,g=1-m,y=v-h+c,x=0;x!==o;x++){var b=a[f+x+o],M=a[f+x+s]*u,w=a[p+x+o],_=a[p+x]*u;i[x]=g*b+y*M+m*w+v*_}return i};var E={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},L={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},P={9728:s.NearestFilter,9729:s.LinearFilter,9984:s.NearestMipmapNearestFilter,9985:s.LinearMipmapNearestFilter,9986:s.NearestMipmapLinearFilter,9987:s.LinearMipmapLinearFilter},B={33071:s.ClampToEdgeWrapping,33648:s.MirroredRepeatWrapping,10497:s.RepeatWrapping},D={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},k={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},R={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},O={CUBICSPLINE:void 0,LINEAR:s.InterpolateLinear,STEP:s.InterpolateDiscrete},I="OPAQUE",F="MASK",N="BLEND";function z(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function U(e,t,n){for(var r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function H(e,t){void 0!==t.extras&&"object"==(0,y.default)(t.extras)&&Object.assign(e.userData,t.extras)}function j(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length)for(e.morphTargetDictionary={},n=0,r=i.length;n<r;n++)e.morphTargetDictionary[i[n]]=n}}function G(e){for(var t="",n=Object.keys(e).sort(),r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function V(e,n){this.json=e||{},this.extensions={},this.plugins={},this.options=n||{},this.currentBinData={},this.cache=new t,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new s.ImageBitmapLoader(this.options.manager):this.textureLoader=new s.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new s.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function W(e,t,n){var r=t.attributes,i=[];function a(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var o in r){var l=k[o]||o.toLowerCase();l in e.attributes||i.push(a(r[o],l))}if(void 0!==t.indices&&!e.index){var u=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));i.push(u)}return H(e,t),function(e,t,n){var r=t.attributes,i=new s.Box3;if(void 0!==r.POSITION){var a=(p=n.json.accessors[r.POSITION]).min,o=p.max;if(void 0!==a&&void 0!==o){i.set(new s.Vector3(a[0],a[1],a[2]),new s.Vector3(o[0],o[1],o[2]));var l=t.targets;if(void 0!==l){for(var u=new s.Vector3,c=new s.Vector3,h=0,d=l.length;h<d;h++){var p,f=l[h];void 0!==f.POSITION&&(a=(p=n.json.accessors[f.POSITION]).min,o=p.max,void 0!==a&&void 0!==o&&(c.setX(Math.max(Math.abs(a[0]),Math.abs(o[0]))),c.setY(Math.max(Math.abs(a[1]),Math.abs(o[1]))),c.setZ(Math.max(Math.abs(a[2]),Math.abs(o[2]))),u.max(c)))}i.expandByVector(u)}e.boundingBox=i;var m=new s.Sphere;i.getCenter(m.center),m.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=m}}}(e,t,n),Promise.all(i).then((function(){return void 0!==t.targets?function(e,t,n){for(var r=!1,i=!1,a=0,o=t.length;a<o&&(void 0!==(u=t[a]).POSITION&&(r=!0),void 0!==u.NORMAL&&(i=!0),!r||!i);a++);if(!r&&!i)return Promise.resolve(e);var s=[],l=[];for(a=0,o=t.length;a<o;a++){var u=t[a];if(r){var c=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;s.push(c)}i&&(c=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal,l.push(c))}return Promise.all([Promise.all(s),Promise.all(l)]).then((function(t){var n=t[0],a=t[1];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function X(e,t){var n=e.getIndex();if(null===n){var r=[],i=e.getAttribute("position");if(void 0===i)return e;for(var a=0;a<i.count;a++)r.push(a);e.setIndex(r),n=e.getIndex()}var o=n.count-2,l=[];if(t===s.TriangleFanDrawMode)for(a=1;a<=o;a++)l.push(n.getX(0)),l.push(n.getX(a)),l.push(n.getX(a+1));else for(a=0;a<o;a++)a%2==0?(l.push(n.getX(a)),l.push(n.getX(a+1)),l.push(n.getX(a+2))):(l.push(n.getX(a+2)),l.push(n.getX(a+1)),l.push(n.getX(a)));l.length;var u=e.clone();return u.setIndex(l),u}return V.prototype.setExtensions=function(e){this.extensions=e},V.prototype.setPlugins=function(e){this.plugins=e},V.prototype.parse=function(e,t){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var a={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};U(i,a,r),H(a,r),e(a)})).catch(t)},V.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],r=0,i=t.length;r<i;r++)for(var a=t[r].joints,o=0,s=a.length;o<s;o++)e[a[o]].isBone=!0;for(var l=0,u=e.length;l<u;l++){var c=e[l];void 0!==c.mesh&&(this._addNodeRef(this.meshCache,c.mesh),void 0!==c.skin&&(n[c.mesh].isSkinnedMesh=!0)),void 0!==c.camera&&this._addNodeRef(this.cameraCache,c.camera)}},V.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},V.prototype._getNodeRef=function(e,t,n){if(e.refs[t]<=1)return n;var r=n.clone();return r.name+="_instance_"+e.uses[t]++,r},V.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var r=e(t[n]);if(r)return r}},V.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],r=0;r<t.length;r++){var i=e(t[r]);i&&n.push(i)}return n},V.prototype.getDependency=function(e,t){var n=e+":"+t,r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r},V.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t},V.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);if(t.uri in this.currentBinData)return this.currentBinData[t.uri];var i=this.options;return new Promise((function(e,n){r.load(z(t.uri,i.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},V.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))},V.prototype.loadAccessor=function(e){var t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(e){var i,a,o=e[0],l=D[r.type],u=L[r.componentType],c=u.BYTES_PER_ELEMENT,h=c*l,d=r.byteOffset||0,p=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,f=!0===r.normalized;if(p&&p!==h){var m=Math.floor(d/p),v="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+m+":"+r.count,g=t.cache.get(v);g||(i=new u(o,m*p,r.count*p/c),g=new s.InterleavedBuffer(i,p/c),t.cache.add(v,g)),a=new s.InterleavedBufferAttribute(g,l,d%p/c,f)}else i=null===o?new u(r.count*l):new u(o,d,r.count*l),a=new s.BufferAttribute(i,l,f);if(void 0!==r.sparse){var y=D.SCALAR,x=L[r.sparse.indices.componentType],b=r.sparse.indices.byteOffset||0,M=r.sparse.values.byteOffset||0,w=new x(e[1],b,r.sparse.count*y),_=new u(e[2],M,r.sparse.count*l);null!==o&&(a=new s.BufferAttribute(a.array.slice(),a.itemSize,a.normalized));for(var A=0,C=w.length;A<C;A++){var T=w[A];if(a.setX(T,_[A*l]),l>=2&&a.setY(T,_[A*l+1]),l>=3&&a.setZ(T,_[A*l+2]),l>=4&&a.setW(T,_[A*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a}))},V.prototype.loadTexture=function(e){var t,r,i=this.json,a=this.options,o=i.textures[e],s=o.extensions||{};return(t=s[n.MSFT_TEXTURE_DDS]?i.images[s[n.MSFT_TEXTURE_DDS].source]:i.images[o.source]).uri&&(r=a.manager.getHandler(t.uri)),r||(r=s[n.MSFT_TEXTURE_DDS]?this.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(e,t,r)},V.prototype.loadTextureImage=function(e,t,n){var r=this,i=this.json,a=this.options,o=i.textures[e],l=self.URL||self.webkitURL,u=t.uri,c=!1,h=!0;return"image/jpeg"===t.mimeType&&(h=!1),void 0!==t.bufferView&&(u=r.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){var n=new DataView(e,25,1).getUint8(0,!1);h=6===n||4===n||3===n}c=!0;var r=new Blob([e],{type:t.mimeType});return u=l.createObjectURL(r)}))),Promise.resolve(u).then((function(e){return new Promise((function(t,r){var i=t;!0===n.isImageBitmapLoader&&(i=function(e){t(new s.CanvasTexture(e))}),n.load(z(e,a.path),i,void 0,r)}))})).then((function(t){!0===c&&l.revokeObjectURL(u),t.flipY=!1,o.name&&(t.name=o.name),h||(t.format=s.RGBFormat);var n=(i.samplers||{})[o.sampler]||{};return t.magFilter=P[n.magFilter]||s.LinearFilter,t.minFilter=P[n.minFilter]||s.LinearMipmapLinearFilter,t.wrapS=B[n.wrapS]||s.RepeatWrapping,t.wrapT=B[n.wrapT]||s.RepeatWrapping,r.associations.set(t,{type:"textures",index:e}),t}))},V.prototype.assignTexture=function(e,t,r){var i=this;return this.getDependency("texture",r.index).then((function(a){if(void 0!==r.texCoord&&0!=r.texCoord&&("aoMap"!==t||r.texCoord),i.extensions[n.KHR_TEXTURE_TRANSFORM]){var o=void 0!==r.extensions?r.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(o){var s=i.associations.get(a);a=i.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),i.associations.set(a,s)}}e[t]=a}))},V.prototype.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,r=void 0!==t.attributes.tangent,i=void 0!==t.attributes.color,a=void 0===t.attributes.normal,o=!0===e.isSkinnedMesh,l=Object.keys(t.morphAttributes).length>0,u=l&&void 0!==t.morphAttributes.normal;if(e.isPoints){var c="PointsMaterial:"+n.uuid,h=this.cache.get(c);h||(h=new s.PointsMaterial,s.Material.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,h.sizeAttenuation=!1,this.cache.add(c,h)),n=h}else if(e.isLine){c="LineBasicMaterial:"+n.uuid;var d=this.cache.get(c);d||(d=new s.LineBasicMaterial,s.Material.prototype.copy.call(d,n),d.color.copy(n.color),this.cache.add(c,d)),n=d}if(r||i||a||o||l){c="ClonedMaterial:"+n.uuid+":",n.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),o&&(c+="skinning:"),r&&(c+="vertex-tangents:"),i&&(c+="vertex-colors:"),a&&(c+="flat-shading:"),l&&(c+="morph-targets:"),u&&(c+="morph-normals:");var p=this.cache.get(c);p||(p=n.clone(),o&&(p.skinning=!0),r&&(p.vertexTangents=!0),i&&(p.vertexColors=!0),a&&(p.flatShading=!0),l&&(p.morphTargets=!0),u&&(p.morphNormals=!0),this.cache.add(c,p),this.associations.set(p,this.associations.get(n))),n=p}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),n.normalScale&&!r&&(n.normalScale.y=-n.normalScale.y),n.clearcoatNormalScale&&!r&&(n.clearcoatNormalScale.y=-n.clearcoatNormalScale.y),e.material=n},V.prototype.getMaterialType=function(){return s.MeshStandardMaterial},V.prototype.loadMaterial=function(e){var t,r=this,i=this.json,a=this.extensions,o=i.materials[e],l={},u=o.extensions||{},c=[];if(u[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var h=a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=h.getMaterialType(),c.push(h.extendParams(l,o,r))}else if(u[n.KHR_MATERIALS_UNLIT]){var d=a[n.KHR_MATERIALS_UNLIT];t=d.getMaterialType(),c.push(d.extendParams(l,o,r))}else{var p=o.pbrMetallicRoughness||{};if(l.color=new s.Color(1,1,1),l.opacity=1,Array.isArray(p.baseColorFactor)){var f=p.baseColorFactor;l.color.fromArray(f),l.opacity=f[3]}void 0!==p.baseColorTexture&&c.push(r.assignTexture(l,"map",p.baseColorTexture)),l.metalness=void 0!==p.metallicFactor?p.metallicFactor:1,l.roughness=void 0!==p.roughnessFactor?p.roughnessFactor:1,void 0!==p.metallicRoughnessTexture&&(c.push(r.assignTexture(l,"metalnessMap",p.metallicRoughnessTexture)),c.push(r.assignTexture(l,"roughnessMap",p.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)}))))}!0===o.doubleSided&&(l.side=s.DoubleSide);var m=o.alphaMode||I;return m===N?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,m===F&&(l.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&t!==s.MeshBasicMaterial&&(c.push(r.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new s.Vector2(1,1),void 0!==o.normalTexture.scale&&l.normalScale.set(o.normalTexture.scale,o.normalTexture.scale)),void 0!==o.occlusionTexture&&t!==s.MeshBasicMaterial&&(c.push(r.assignTexture(l,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(l.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&t!==s.MeshBasicMaterial&&(l.emissive=(new s.Color).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&t!==s.MeshBasicMaterial&&c.push(r.assignTexture(l,"emissiveMap",o.emissiveTexture)),Promise.all(c).then((function(){var i;return i=t===A?a[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new t(l),o.name&&(i.name=o.name),i.map&&(i.map.encoding=s.sRGBEncoding),i.emissiveMap&&(i.emissiveMap.encoding=s.sRGBEncoding),H(i,o),r.associations.set(i,{type:"materials",index:e}),o.extensions&&U(a,i,o),i}))},V.prototype.createUniqueName=function(e){if(e.indexOf("MCYB_")>-1)return e;var t=s.PropertyBinding.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)},V.prototype.loadGeometries=function(e){var t=this,r=this.extensions,i=this.primitiveCache;function a(e){return r[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return W(n,e,t)}))}for(var o,l,u=[],c=0,h=e.length;c<h;c++){var d,p=e[c],f=(l=void 0,(l=(o=p).extensions&&o.extensions[n.KHR_DRACO_MESH_COMPRESSION])?"draco:"+l.bufferView+":"+l.indices+":"+G(l.attributes):o.indices+":"+G(o.attributes)+":"+o.mode),m=i[f];m?u.push(m.promise):(d=p.extensions&&p.extensions[n.KHR_DRACO_MESH_COMPRESSION]?a(p):W(new s.BufferGeometry,p,t),i[f]={primitive:p,promise:d},u.push(d))}return Promise.all(u)},V.prototype.loadMesh=function(e){for(var t,n=this,r=this.json,i=this.extensions,a=r.meshes[e],o=a.primitives,l=[],u=0,c=o.length;u<c;u++){var h=void 0===o[u].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new s.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:s.FrontSide})),t.DefaultMaterial):this.getDependency("material",o[u].material);l.push(h)}return l.push(n.loadGeometries(o)),Promise.all(l).then((function(t){for(var r=t.slice(0,t.length-1),l=t[t.length-1],u=[],c=0,h=l.length;c<h;c++){var d,p=l[c],f=o[c],m=r[c];if(f.mode===E.TRIANGLES||f.mode===E.TRIANGLE_STRIP||f.mode===E.TRIANGLE_FAN||void 0===f.mode)!0!==(d=!0===a.isSkinnedMesh?new s.SkinnedMesh(p,m):new s.Mesh(p,m)).isSkinnedMesh||d.geometry.attributes.skinWeight.normalized||d.normalizeSkinWeights(),f.mode===E.TRIANGLE_STRIP?d.geometry=X(d.geometry,s.TriangleStripDrawMode):f.mode===E.TRIANGLE_FAN&&(d.geometry=X(d.geometry,s.TriangleFanDrawMode));else if(f.mode===E.LINES)d=new s.LineSegments(p,m);else if(f.mode===E.LINE_STRIP)d=new s.Line(p,m);else if(f.mode===E.LINE_LOOP)d=new s.LineLoop(p,m);else{if(f.mode!==E.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode);d=new s.Points(p,m)}Object.keys(d.geometry.morphAttributes).length>0&&j(d,a),d.name=n.createUniqueName(a.name||"mesh_"+e),H(d,a),f.extensions&&U(i,d,f),n.assignFinalMaterial(d),u.push(d)}if(1===u.length)return u[0];var v=new s.Group;for(c=0,h=u.length;c<h;c++)v.add(u[c]);return v}))},V.prototype.loadCamera=function(e){var t,n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new s.PerspectiveCamera(s.MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new s.OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),H(t,n),Promise.resolve(t)},V.prototype.loadSkin=function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))},V.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],n=[],r=[],i=[],a=[],o=[],l=0,u=t.channels.length;l<u;l++){var c=t.channels[l],h=t.samplers[c.sampler],d=c.target,p=void 0!==d.node?d.node:d.id,f=void 0!==t.parameters?t.parameters[h.input]:h.input,m=void 0!==t.parameters?t.parameters[h.output]:h.output;n.push(this.getDependency("node",p)),r.push(this.getDependency("accessor",f)),i.push(this.getDependency("accessor",m)),a.push(h),o.push(d)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(i),Promise.all(a),Promise.all(o)]).then((function(n){for(var r=n[0],i=n[1],a=n[2],o=n[3],l=n[4],u=[],c=0,h=r.length;c<h;c++){var d=r[c],p=i[c],f=a[c],m=o[c],v=l[c];if(void 0!==d){var g;switch(d.updateMatrix(),d.matrixAutoUpdate=!0,R[v.path]){case R.weights:g=s.NumberKeyframeTrack;break;case R.rotation:g=s.QuaternionKeyframeTrack;break;default:g=s.VectorKeyframeTrack}var y=d.name?d.name:d.uuid,x=void 0!==m.interpolation?O[m.interpolation]:s.InterpolateLinear,b=[];R[v.path]===R.weights?d.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&b.push(e.name?e.name:e.uuid)})):b.push(y);var M=f.array;if(f.normalized){var w;if(M.constructor===Int8Array)w=1/127;else if(M.constructor===Uint8Array)w=1/255;else if(M.constructor==Int16Array)w=1/32767;else{if(M.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");w=1/65535}for(var _=new Float32Array(M.length),A=0,C=M.length;A<C;A++)_[A]=M[A]*w;M=_}for(A=0,C=b.length;A<C;A++){var T=new g(b[A]+"."+R[v.path],p.array,M,x);"CUBICSPLINE"===m.interpolation&&(T.createInterpolant=function(e){return new S(this.times,this.values,this.getValueSize()/3,e)},T.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),u.push(T)}}}var E=t.name?t.name:"animation_"+e;return new s.AnimationClip(E,void 0,u)}))},V.prototype.createNodeMesh=function(e){var t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(e){var t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]})),t}))},V.prototype.loadNode=function(e){var t=this.json,n=this.extensions,r=this,i=t.nodes[e],a=i.name?r.createUniqueName(i.name):"";return function(){var t=[],n=r._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return n&&t.push(n),void 0!==i.camera&&t.push(r.getDependency("camera",i.camera).then((function(e){return r._getNodeRef(r.cameraCache,i.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){var o;if((o=!0===i.isBone?new s.Bone:t.length>1?new s.Group:1===t.length?t[0]:new s.Object3D)!==t[0])for(var l=0,u=t.length;l<u;l++)o.add(t[l]);if(i.name&&(o.userData.name=i.name,o.name=a),H(o,i),i.extensions&&U(n,o,i),void 0!==i.matrix){var c=new s.Matrix4;c.fromArray(i.matrix),o.applyMatrix4(c)}else void 0!==i.translation&&o.position.fromArray(i.translation),void 0!==i.rotation&&o.quaternion.fromArray(i.rotation),void 0!==i.scale&&o.scale.fromArray(i.scale);return r.associations.set(o,{type:"nodes",index:e}),o}))},V.prototype.loadScene=function(){function e(t,n,r,i){var a=r.nodes[t];return i.getDependency("node",t).then((function(e){return void 0===a.skin?e:i.getDependency("skin",a.skin).then((function(e){for(var n=[],r=0,a=(t=e).joints.length;r<a;r++)n.push(i.getDependency("node",t.joints[r]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var r=[],i=[],a=0,o=n.length;a<o;a++){var l=n[a];if(l){r.push(l);var u=new s.Matrix4;void 0!==t.inverseBindMatrices&&u.fromArray(t.inverseBindMatrices.array,16*a),i.push(u)}}e.bind(new s.Skeleton(r,i),e.matrixWorld)}})),e}));var t})).then((function(t){n.add(t);var o=[];if(a.children)for(var s=a.children,l=0,u=s.length;l<u;l++){var c=s[l];o.push(e(c,t,r,i))}return Promise.all(o)}))}return function(t){var n=this.json,r=this.extensions,i=this.json.scenes[t],a=new s.Group;i.name&&(a.name=this.createUniqueName(i.name)),H(a,i),i.extensions&&U(r,a,i);for(var o=i.nodes||[],l=[],u=0,c=o.length;u<c;u++)l.push(e(o[u],a,n,this));return Promise.all(l).then((function(){return a}))}}(),e}(),kt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.DefaultLoadingManager;return(0,v.default)(this,t),(e=T(this,t)).manager=n,e.adjustmentTransform=new s.Matrix4,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"parse",value:function(e){var n=this,r=C(t,"parse",this,3)([e]),i=r.glbBytes.slice().buffer;return new Promise((function(e,t){var a=n.manager,o=n.fetchOptions,s=a.getHandler("path.gltf")||new Dt(a);"include"===o.credentials&&"cors"===o.mode&&s.setCrossOrigin("use-credentials"),"credentials"in o&&s.setWithCredentials("include"===o.credentials),o.headers&&s.setRequestHeader(o.headers);var l=n.workingPath;!/[\\/]$/.test(l)&&l.length&&(l+="/");var u=n.adjustmentTransform;s.parse(i,l,(function(t){var n=r.batchTable,i=r.featureTable,a=t.scene,o=i.getData("RTC_CENTER");o&&(a.position.x+=o[0],a.position.y+=o[1],a.position.z+=o[2]),t.scene.updateMatrix(),t.scene.matrix.multiply(u),t.scene.matrix.decompose(t.scene.position,t.scene.quaternion,t.scene.scale),t.batchTable=n,t.featureTable=i,a.batchTable=n,a.featureTable=i,e(t)}),t)}))}}])}(Bt),Rt=function(e){function t(){return(0,v.default)(this,t),T(this,t,arguments)}return(0,m.default)(t,e),(0,g.default)(t,[{key:"parse",value:function(e){var t=new DataView(e),n=(Pt(t),t.getUint32(4,!0)),r=(t.getUint32(8,!0),t.getUint32(12,!0)),i=t.getUint32(16,!0),a=t.getUint32(20,!0),o=t.getUint32(24,!0),s=e.slice(28,28+r+i),l=new St(s,0,r,i),u=28+r+i,c=e.slice(u,u+a+o),h=new Et(c,l.getData("BATCH_LENGTH")||l.getData("POINTS_LENGTH"),0,a,o);return Promise.resolve({version:n,featureTable:l,batchTable:h})}}])}(Lt),Ot=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.DefaultLoadingManager;return(0,v.default)(this,t),(e=T(this,t)).manager=n,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"parse",value:function(e){return C(t,"parse",this,3)([e]).then((function(e){var t=e.featureTable,n=t.getData("POINTS_LENGTH"),r=t.getData("POSITION",n,"FLOAT","VEC3"),i=t.getData("RGB",n,"UNSIGNED_BYTE","VEC3");["QUANTIZED_VOLUME_OFFSET","QUANTIZED_VOLUME_SCALE","CONSTANT_RGBA","BATCH_LENGTH","POSITION_QUANTIZED","RGBA","RGB565","NORMAL","NORMAL_OCT16P"].forEach((function(e){t.header}));var a=new s.BufferGeometry;a.setAttribute("position",new s.BufferAttribute(r,3,!1));var o=new s.PointsMaterial;o.size=2,o.sizeAttenuation=!1,null!==i&&(a.setAttribute("color",new s.BufferAttribute(i,3,!0)),o.vertexColors=!0);var l=new s.Points(a,o);e.scene=l,e.scene.featureTable=t;var u=t.getData("RTC_CENTER");return u&&(e.scene.position.x+=u[0],e.scene.position.y+=u[1],e.scene.position.z+=u[2]),e}))}}])}(Rt),It=function(e){function t(){return(0,v.default)(this,t),T(this,t,arguments)}return(0,m.default)(t,e),(0,g.default)(t,[{key:"parse",value:function(e){var t=new DataView(e),n=(Pt(t),t.getUint32(4,!0)),r=t.getUint32(8,!0),i=t.getUint32(12,!0),a=t.getUint32(16,!0),o=t.getUint32(20,!0),s=t.getUint32(24,!0),l=t.getUint32(28,!0),u=e.slice(32,32+i+a),c=new St(u,0,i,a),h=32+i+a,d=e.slice(h,h+o+s),p=new Et(d,c.getData("INSTANCES_LENGTH"),0,o,s),f=h+o+s,m=new Uint8Array(e,f,r-f),v=null,g=null;if(l)v=m,g=Promise.resolve();else{var y=this.resolveExternalURL(Tt(m));g=fetch(y,this.fetchOptions).then((function(e){if(!e.ok)throw new Error('I3DMLoaderBase : Failed to load file "'.concat(y,'" with status ').concat(e.status," : ").concat(e.statusText));return e.arrayBuffer()})).then((function(e){v=new Uint8Array(e)}))}return g.then((function(){return{version:n,featureTable:c,batchTable:p,glbBytes:v}}))}}])}(Lt),Ft=new s.Vector3,Nt=new s.Vector3,zt=new s.Vector3,Ut=new s.Vector3,Ht=new s.Quaternion,jt=new s.Vector3,Gt=new s.Matrix4,Vt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.DefaultLoadingManager;return(0,v.default)(this,t),(e=T(this,t)).manager=n,e.adjustmentTransform=new s.Matrix4,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"resolveExternalURL",value:function(e){return this.manager.resolveURL(C(t,"resolveExternalURL",this,3)([e]))}},{key:"parse",value:function(e){var n=this;return C(t,"parse",this,3)([e]).then((function(e){var t=e.featureTable,r=e.batchTable,i=e.glbBytes.slice().buffer;return new Promise((function(e,a){var o=n.fetchOptions,l=n.manager,u=l.getHandler("path.gltf")||new Dt(l);"include"===o.credentials&&"cors"===o.mode&&u.setCrossOrigin("use-credentials"),"credentials"in o&&u.setWithCredentials("include"===o.credentials),o.headers&&u.setRequestHeader(o.headers);var c=n.workingPath;/[\\/]$/.test(c)||(c+="/");var h=n.adjustmentTransform;u.parse(i,c,(function(n){var i=t.getData("INSTANCES_LENGTH"),a=t.getData("POSITION",i,"FLOAT","VEC3"),o=t.getData("NORMAL_UP",i,"FLOAT","VEC3"),l=t.getData("NORMAL_RIGHT",i,"FLOAT","VEC3"),u=t.getData("SCALE_NON_UNIFORM",i,"FLOAT","VEC3"),c=t.getData("SCALE",i,"FLOAT","SCALAR");["RTC_CENTER","QUANTIZED_VOLUME_OFFSET","QUANTIZED_VOLUME_SCALE","EAST_NORTH_UP","POSITION_QUANTIZED","NORMAL_UP_OCT32P","NORMAL_RIGHT_OCT32P"].forEach((function(e){t.header}));var d=new Map,p=[];n.scene.traverse((function(e){if(e.isMesh){var t=e.geometry,n=e.material,r=new s.InstancedMesh(t,n,i);r.position.copy(e.position),r.rotation.copy(e.rotation),r.scale.copy(e.scale),p.push(r),d.set(e,r)}}));for(var f=new s.Vector3,m=0;m<i;m++)f.x+=a[3*m+0]/i,f.y+=a[3*m+1]/i,f.z+=a[3*m+2]/i;d.forEach((function(e,t){var n=t.parent;n&&(n.remove(t),n.add(e),e.updateMatrixWorld(),e.position.copy(f).applyMatrix4(e.matrixWorld))}));for(var v=0;v<i;v++){Ut.set(a[3*v+0]-f.x,a[3*v+1]-f.y,a[3*v+2]-f.z),o?(Nt.set(o[3*v+0],o[3*v+1],o[3*v+2]),zt.set(l[3*v+0],l[3*v+1],l[3*v+2]),Ft.crossVectors(zt,Nt).normalize(),Gt.makeBasis(zt,Nt,Ft),Ht.setFromRotationMatrix(Gt)):Ht.set(0,0,0,1),c?jt.setScalar(c[v]):u?jt.set(u[3*v+0],u[3*v+1],u[3*v+2]):jt.set(1,1,1),Gt.compose(Ut,Ht,jt).multiply(h);for(var g=0,y=p.length;g<y;g++)p[g].setMatrixAt(v,Gt)}n.batchTable=r,n.featureTable=t,n.scene.batchTable=r,n.scene.featureTable=t,e(n)}),a)}))}))}}])}(It),Wt=function(e){function t(){return(0,v.default)(this,t),T(this,t,arguments)}return(0,m.default)(t,e),(0,g.default)(t,[{key:"parse",value:function(e){for(var t=new DataView(e),n=(Pt(t),t.getUint32(4,!0)),r=(t.getUint32(8,!0),t.getUint32(12,!0)),i=[],a=16,o=0;o<r;o++){var s=new DataView(e,a,12),l=Pt(s),u=s.getUint32(4,!0),c=s.getUint32(8,!0),h=new Uint8Array(e,a,c);i.push({type:l,buffer:h,version:u}),a+=c}return{version:n,tiles:i}}}])}(Lt),Xt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.DefaultLoadingManager;return(0,v.default)(this,t),(e=T(this,t)).manager=n,e.adjustmentTransform=new s.Matrix4,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"parse",value:function(e){var n=C(t,"parse",this,3)([e]),r=this.manager,i=this.adjustmentTransform,a=[];for(var o in n.tiles){var l=n.tiles[o],u=l.type,c=l.buffer;switch(u){case"b3dm":var h=c.slice(),d=new kt(r);d.workingPath=this.workingPath,d.fetchOptions=this.fetchOptions,d.adjustmentTransform.copy(i);var p=d.parse(h.buffer);a.push(p);break;case"pnts":var f=c.slice(),m=new Ot(r);m.workingPath=this.workingPath,m.fetchOptions=this.fetchOptions;var v=m.parse(f.buffer);a.push(v);break;case"i3dm":var g=c.slice(),y=new Vt(r);y.workingPath=this.workingPath,y.fetchOptions=this.fetchOptions,y.adjustmentTransform.copy(i);var x=y.parse(g.buffer);a.push(x)}}return Promise.all(a).then((function(e){var t=new s.Group;return e.forEach((function(e){t.add(e.scene)})),{tiles:e,scene:t}}))}}])}(Wt),Yt=function(){function e(){(0,v.default)(this,e),this.name="CESIUM_RTC"}return(0,g.default)(e,[{key:"afterRoot",value:function(e){if(e.parser.json.extensions&&e.parser.json.extensions.CESIUM_RTC){var t=e.parser.json.extensions.CESIUM_RTC.center;t&&(e.scene.position.x+=t[0],e.scene.position.y+=t[1],e.scene.position.z+=t[2])}}}])}(),Jt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.DefaultLoadingManager;return(0,v.default)(this,t),(e=T(this,t)).manager=n,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"parse",value:function(e){var t=this;return new Promise((function(n,r){var i=t.manager,a=t.fetchOptions,o=i.getHandler("path.gltf")||i.getHandler("path.glb");o||((o=new Dt(i)).register((function(){return new Yt})),"include"===a.credentials&&"cors"===a.mode&&o.setCrossOrigin("use-credentials"),"credentials"in a&&o.setWithCredentials("include"===a.credentials),a.headers&&o.setRequestHeader(a.headers));var s=o.resourcePath||o.path||t.workingPath;!/[\\/]$/.test(s)&&s.length&&(s+="/"),o.parse(e,s,(function(e){n(e)}),r)}))}}])}(Lt),Qt=new s.Matrix4,qt=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t)).name="TilesRenderer.TilesGroup",n.tilesRenderer=e,n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"raycast",value:function(e,t){this.tilesRenderer.optimizeRaycast&&this.tilesRenderer.raycast(e,t)}},{key:"updateMatrixWorld",value:function(e){if(this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldNeedsUpdate||e){null===this.parent?Qt.copy(this.matrix):Qt.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1;for(var t=Qt.elements,n=this.matrixWorld.elements,r=!1,i=0;i<16;i++){var a=t[i],o=n[i];if(Math.abs(a-o)>Number.EPSILON){r=!0;break}}if(r){this.matrixWorld.copy(Qt);for(var s=this.children,l=0,u=s.length;l<u;l++)s[l].updateMatrixWorld()}}}}])}(s.Group);function Kt(e){var t=e.x,n=e.y,r=e.z;e.x=r,e.y=t,e.z=n}var Zt=new s.Spherical,$t=new s.Vector3,en=new s.Vector3,tn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;(0,v.default)(this,e),this.radius=new s.Vector3(t,n,r)}return(0,g.default)(e,[{key:"getCartographicToPosition",value:function(e,t,n,r){var i=this.radius;Zt.set(1,-e+Math.PI/2,t),$t.setFromSpherical(Zt).normalize(),Kt($t),en.copy($t),en.x*=Math.pow(i.x,2),en.y*=Math.pow(i.y,2),en.z*=Math.pow(i.z,2);var a=Math.sqrt($t.dot(en));return en.divideScalar(a),r.copy(en).addScaledVector($t,n)}},{key:"getCartographicToNormal",value:function(e,t,n){return Zt.set(1,-e+Math.PI/2,t),n.setFromSpherical(Zt).normalize(),Kt(n),n}},{key:"getPositionToNormal",value:function(e,t){var n=this.radius;return t.copy(e),t.x/=Math.pow(n.x,2),t.y/=Math.pow(n.y,2),t.z/=Math.pow(n.z,2),t.normalize(),t}}])}(),nn=Math.PI,rn=nn/2,an=new s.Vector3,on=new s.Vector3,sn=new s.Vector3,ln=new s.Matrix4,un=0,cn=[];function hn(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?(cn[un]||(cn[un]=new s.Vector3),un++,cn[un-1]):new s.Vector3}function dn(){un=0}var pn=function(e){function t(e,n,r){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-rn,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:rn,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*nn,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;return(0,v.default)(this,t),(i=T(this,t,[e,n,r])).latStart=a,i.latEnd=o,i.lonStart=s,i.lonEnd=l,i.heightStart=u,i.heightEnd=c,i}return(0,m.default)(t,e),(0,g.default)(t,[{key:"_getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.latStart,n=this.latEnd,r=this.lonStart,i=this.lonEnd,a=this.heightStart,o=this.heightEnd,l=s.MathUtils.mapLinear(.5,0,1,t,n),c=s.MathUtils.mapLinear(.5,0,1,r,i),h=Math.floor(r/rn)*rn,d=[[-nn/2,0],[nn/2,0],[0,h],[0,h+nn/2],[0,h+nn],[0,h+3*nn/2],[t,i],[n,i],[t,r],[n,r],[0,r],[0,i],[l,c],[t,c],[n,c],[l,r],[l,i]],p=[],f=d.length,m=0;m<=1;m++)for(var v=s.MathUtils.mapLinear(m,0,1,a,o),g=0,y=f;g<y;g++){var x=(0,u.default)(d[g],2),b=x[0],M=x[1];if(b>=t&&b<=n&&M>=r&&M<=i){var w=hn(e);p.push(w),this.getCartographicToPosition(b,M,v,w)}}return p}},{key:"getBoundingBox",value:function(e,t){dn();var n=this.latStart,r=this.latEnd,i=this.lonStart,a=this.lonEnd;if(r-n<nn/2){var o=s.MathUtils.mapLinear(.5,0,1,n,r),l=s.MathUtils.mapLinear(.5,0,1,i,a);this.getCartographicToNormal(o,l,sn),on.set(0,0,1),an.crossVectors(on,sn),on.crossVectors(an,sn),t.makeBasis(an,on,sn)}else an.set(1,0,0),on.set(0,1,0),sn.set(0,0,1),t.makeBasis(an,on,sn);ln.copy(t).invert();for(var u=this._getPoints(!0),c=0,h=u.length;c<h;c++)u[c].applyMatrix4(ln);e.makeEmpty(),e.setFromPoints(u)}},{key:"getBoundingSphere",value:function(e,t){dn();var n=this._getPoints(!0);e.makeEmpty(),e.setFromPoints(n,t)}}])}(tn),fn=new s.Sphere,mn=new s.Matrix4,vn=new s.Vector3,gn=new s.Vector3,yn=new s.Ray,xn=[];function bn(e,t){return e.distance-t.distance}function Mn(e,t,n){e.traverse((function(e){Object.getPrototypeOf(e).raycast.call(e,t,n)}))}function wn(e,t,n,r){if(n.has(e)){if(Mn(e.cached.scene,r,xn),xn.length>0){xn.length>1&&xn.sort(bn);var i=xn[0];return xn.length=0,i}return null}for(var a=[],o=e.children,s=0,l=o.length;s<l;s++){var u=o[s],c=u.cached,h=t.matrixWorld;mn.copy(h);var d=c.sphere;if(!d||(fn.copy(d),fn.applyMatrix4(mn),r.ray.intersectsSphere(fn))){var p=c.box,f=c.boxTransform;if(p){if(mn.multiply(f).invert(),yn.copy(r.ray),yn.applyMatrix4(mn),!yn.intersectBox(p,vn))continue;gn.setFromMatrixScale(mn);var m=gn.x;Math.abs(Math.max(gn.x-gn.y,gn.x-gn.z));var v={distance:1/0,tile:null};a.push(v),v.distance=vn.distanceToSquared(yn.origin)*m*m,v.tile=u}}}a.sort(bn);for(var g=1/0,y=null,x=0,b=a.length;x<b;x++){var M=a[x];if(M.distance>g)break;var w=M.tile,_=w.cached.scene,A=null;if(n.has(w)?(Mn(_,r,xn),xn.length>0&&(xn.length>1&&xn.sort(bn),A=xn[0])):A=wn(w,t,n,r),A){var C=A.distance*A.distance;C<g&&(g=C,y=A),xn.length=0}}return y}function _n(e,t,n,r,i){var a=e.cached,o=t.matrixWorld;mn.copy(o);var s=a.sphere;if(!s||(fn.copy(s),fn.applyMatrix4(mn),r.ray.intersectsSphere(fn))){var l=a.box,u=a.boxTransform;if(!l||(mn.multiply(u).invert(),yn.copy(r.ray).applyMatrix4(mn),yn.intersectsBox(l))){var c=a.scene;if(n.has(e))Mn(c,r,i);else for(var h=e.children,d=0,p=h.length;d<p;d++)_n(h[d],t,n,r,i)}}}var An=Symbol("INITIAL_FRUSTUM_CULLED"),Cn=new s.Matrix4,Tn=new s.Matrix4,Sn=new s.Vector3,En=new s.Vector3,Ln=new s.Vector3,Pn=new s.Vector3,Bn=new s.Vector3(1,0,0),Dn=new s.Vector3(0,1,0);function kn(e,t){e.traverse((function(e){e.frustumCulled=e[An]&&t}))}var Rn=function(e){function t(){var e;(0,v.default)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];(e=T(this,t,[].concat(r))).group=new qt((0,c.default)(e)),e.cameras=[],e.cameraMap=new Map,e.cameraInfo=[],e.activeTiles=new Set,e.visibleTiles=new Set,e._autoDisableRendererCulling=!0,e.optimizeRaycast=!0,e.onLoadTileSet=null,e.onLoadModel=null,e.onDisposeModel=null,e.onTileVisibilityChange=null;var a=new s.LoadingManager;a.setURLModifier((function(t){return e.preprocessURL?e.preprocessURL(t):t})),e.manager=a;var o=e;return e._overridenRaycast=function(e,t){o.optimizeRaycast||Object.getPrototypeOf(this).raycast.call(this,e,t)},e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"autoDisableRendererCulling",get:function(){return this._autoDisableRendererCulling},set:function(e){this._autoDisableRendererCulling!==e&&(M(t,"_autoDisableRendererCulling",e,this,1,1),this.forEachLoadedModel((function(t){kn(t,!e)})))}},{key:"getBounds",value:function(e){if(!this.root)return!1;var t=this.root.cached,n=t.box,r=t.boxTransform;return!!n&&(e.copy(n),e.applyMatrix4(r),!0)}},{key:"getOrientedBounds",value:function(e,t){if(!this.root)return!1;var n=this.root.cached,r=n.box,i=n.boxTransform;return!!r&&(e.copy(r),t.copy(i),!0)}},{key:"getBoundingSphere",value:function(e){if(!this.root)return!1;var t=this.root.cached.sphere;return!!t&&(e.copy(t),!0)}},{key:"forEachLoadedModel",value:function(e){this.traverse((function(t){var n=t.cached.scene;n&&e(n,t)}))}},{key:"raycast",value:function(e,t){if(this.root)if(e.firstHitOnly){var n=wn(this.root,this.group,this.activeTiles,e);n&&t.push(n)}else _n(this.root,this.group,this.activeTiles,e,t)}},{key:"hasCamera",value:function(e){return this.cameraMap.has(e)}},{key:"setCamera",value:function(e){var t=this.cameras,n=this.cameraMap;return!n.has(e)&&(n.set(e,new s.Vector2),t.push(e),!0)}},{key:"setResolution",value:function(e,t,n){var r=this.cameraMap;return!!r.has(e)&&(t instanceof s.Vector2?r.get(e).copy(t):r.get(e).set(t,n),!0)}},{key:"setResolutionFromRenderer",value:function(e,t){var n=this.cameraMap;if(!n.has(e))return!1;var r=n.get(e);return t.getSize(r),r.multiplyScalar(t.getPixelRatio()),!0}},{key:"deleteCamera",value:function(e){var t=this.cameras,n=this.cameraMap;if(n.has(e)){var r=t.indexOf(e);return t.splice(r,1),n.delete(e),!0}return!1}},{key:"fetchTileSet",value:function(e){for(var n=this,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];var o=C(t,"fetchTileSet",this,3)([e].concat(i));return o.then((function(t){n.onLoadTileSet&&Promise.resolve().then((function(){n.onLoadTileSet(t,e)}))})),o}},{key:"update",value:function(){var e=this.group,n=this.cameras,r=this.cameraMap,i=this.cameraInfo;if(0!==n.length){for(;i.length>n.length;)i.pop();for(;i.length<n.length;)i.push({frustum:new s.Frustum,isOrthographic:!1,sseDenominator:-1,position:new s.Vector3,invScale:-1,pixelSize:0});Tn.copy(e.matrixWorld).invert(),Sn.setFromMatrixScale(Tn);var a=Sn.x;Math.abs(Math.max(Sn.x-Sn.y,Sn.x-Sn.z));for(var o=0,l=i.length;o<l;o++){var u=n[o],c=i[o],h=c.frustum,d=c.position,p=r.get(u);0===p.width||p.height;var f=u.projectionMatrix.elements;if(c.isOrthographic=1===f[15],c.isOrthographic){var m=2/f[0],v=2/f[5];c.pixelSize=Math.max(v/p.height,m/p.width)}else c.sseDenominator=2/f[5]/p.height;c.invScale=a,Cn.copy(e.matrixWorld),Cn.premultiply(u.matrixWorldInverse),Cn.premultiply(u.projectionMatrix),h.setFromProjectionMatrix(Cn),d.set(0,0,0),d.applyMatrix4(u.matrixWorld),d.applyMatrix4(Tn)}C(t,"update",this,3)([])}}},{key:"preprocessNode",value:function(e,n,r){C(t,"preprocessNode",this,3)([e,n,r]);var i=new s.Matrix4;if(e.transform)for(var a=e.transform,o=0;o<16;o++)i.elements[o]=a[o];else i.identity();n&&i.premultiply(n.cached.transform);var l=(new s.Matrix4).copy(i).invert(),c=null,h=null,d=null;if("box"in e.boundingVolume){var p=e.boundingVolume.box;c=new s.Box3,h=new s.Matrix4,d=new s.Matrix4,En.set(p[3],p[4],p[5]),Ln.set(p[6],p[7],p[8]),Pn.set(p[9],p[10],p[11]);var f=En.length(),m=Ln.length(),v=Pn.length();En.normalize(),Ln.normalize(),Pn.normalize(),0===f&&En.crossVectors(Ln,Pn),0===m&&Ln.crossVectors(En,Pn),0===v&&Pn.crossVectors(En,Ln),h.set(En.x,Ln.x,Pn.x,p[0],En.y,Ln.y,Pn.y,p[1],En.z,Ln.z,Pn.z,p[2],0,0,0,1),h.premultiply(i),d.copy(h).invert(),c.min.set(-f,-m,-v),c.max.set(f,m,v)}var g=null;if("sphere"in e.boundingVolume){var y=e.boundingVolume.sphere;(g=new s.Sphere).center.set(y[0],y[1],y[2]),g.radius=y[3],g.applyMatrix4(i)}else if("box"in e.boundingVolume){var x=e.boundingVolume.box;g=new s.Sphere,c.getBoundingSphere(g),g.center.set(x[0],x[1],x[2]),g.applyMatrix4(i)}var b=null;if("region"in e.boundingVolume){var M=e.boundingVolume.region,w=(0,u.default)(M,6),_=w[0],A=w[1],T=w[2],S=w[3],E=w[4],L=w[5];b=new pn(dt,dt,6356752.314245179,A,S,_,T,E,L),null===g&&(g=new s.Sphere,b.getBoundingSphere(g)),null===c&&(c=new s.Box3,h=new s.Matrix4,d=new s.Matrix4,b.getBoundingBox(c,h),d.copy(h).invert())}e.cached={loadIndex:0,transform:i,transformInverse:l,active:!1,inFrustum:[],box:c,boxTransform:h,boxTransformInverse:d,sphere:g,region:b,scene:null,geometry:null,material:null}}},{key:"parseTile",value:function(e,t,n){var r=this;t._loadIndex=t._loadIndex||0,t._loadIndex++;var i=t.content.uri.split(/[\\\/]/g);i.pop();var a=i.join("/"),o=this.fetchOptions,s=this.manager,l=t._loadIndex,u=null,c=this.rootTileSet.asset&&this.rootTileSet.asset.gltfUpAxis||"y",h=t.cached,d=h.transform;switch(c.toLowerCase()){case"x":Cn.makeRotationAxis(Dn,-Math.PI/2);break;case"y":Cn.makeRotationAxis(Bn,Math.PI/2);break;case"z":Cn.identity()}var p=Pt(e)||n;switch(p){case"b3dm":var f=new kt(s);f.workingPath=a,f.fetchOptions=o,f.adjustmentTransform.copy(Cn),u=f.parse(e).then((function(e){return e.scene}));break;case"pnts":var m=new Ot(s);m.workingPath=a,m.fetchOptions=o,u=m.parse(e).then((function(e){return e.scene}));break;case"i3dm":var v=new Vt(s);v.workingPath=a,v.fetchOptions=o,v.adjustmentTransform.copy(Cn),u=v.parse(e).then((function(e){return e.scene}));break;case"cmpt":var g=new Xt(s);g.workingPath=a,g.fetchOptions=o,g.adjustmentTransform.copy(Cn),u=g.parse(e).then((function(e){return e.scene}));break;case"gltf":case"glb":var y=new Jt(s);y.workingPath=a,y.fetchOptions=o,u=y.parse(e).then((function(e){return e.scene}));break;default:u=Promise.resolve(null)}return u.then((function(e){if(t._loadIndex===l){e.updateMatrix(),"glb"!==p&&"gltf"!==p||e.matrix.multiply(Cn),e.matrix.premultiply(d),e.matrix.decompose(e.position,e.quaternion,e.scale),e.traverse((function(e){e[An]=e.frustumCulled})),kn(e,!r.autoDisableRendererCulling),h.scene=e,e.traverse((function(e){e.raycast=r._overridenRaycast}));var n=[],i=[],a=[];e.traverse((function(e){if(e.geometry&&i.push(e.geometry),e.material){var t=e.material;for(var r in n.push(e.material),t){var o=t[r];o&&o.isTexture&&a.push(o)}}})),h.materials=n,h.geometry=i,h.textures=a,r.onLoadModel&&r.onLoadModel(e,t)}}))}},{key:"disposeTile",value:function(e){var t=e.cached;if(t.scene){for(var n=t.materials,r=t.geometry,i=t.textures,a=t.scene.parent,o=0,s=r.length;o<s;o++)r[o].dispose();for(var l=0,u=n.length;l<u;l++)n[l].dispose();for(var c=0,h=i.length;c<h;c++)i[c].dispose();a&&a.remove(t.scene),this.onDisposeModel&&this.onDisposeModel(t.scene,e),t.scene=null,t.materials=null,t.textures=null,t.geometry=null}this.activeTiles.delete(e),this.visibleTiles.delete(e),e._loadIndex++}},{key:"setTileVisible",value:function(e,t){var n=e.cached.scene,r=this.visibleTiles,i=this.group;t?(i.add(n),r.add(e),n.updateMatrixWorld(!0)):(i.remove(n),r.delete(e)),this.onTileVisibilityChange&&this.onTileVisibilityChange(n,e,t)}},{key:"setTileActive",value:function(e,t){var n=this.activeTiles;t?n.add(e):n.delete(e)}},{key:"calculateError",value:function(e){for(var t=e.cached,n=t.inFrustum,r=this.cameras,i=this.cameraInfo,a=t.sphere,o=t.box,s=t.boxTransformInverse,l=t.transformInverse,u=o&&s,c=-1/0,h=1/0,d=0,p=r.length;d<p;d++)if(n[d]){var f=i[d],m=f.invScale,v=void 0;if(f.isOrthographic){var g=f.pixelSize;v=e.geometricError/(g*m)}else{var y=void 0;Sn.copy(f.position),u?(Sn.applyMatrix4(s),y=o.distanceToPoint(Sn)):(Sn.applyMatrix4(l),y=Math.max(a.distanceToPoint(Sn),0));var x=y*m,b=f.sseDenominator;v=e.geometricError/(x*b),h=Math.min(h,x)}c=Math.max(c,v)}e.__distanceFromCamera=h,e.__error=c}},{key:"tileInView",value:function(e){var t=e.cached,n=t.sphere,r=t.inFrustum;if(n){for(var i=this.cameraInfo,a=!1,o=0,s=i.length;o<s;o++)i[o].frustum.intersectsSphere(n)?(a=!0,r[o]=!0):r[o]=!1;return a}return!0}}])}(Ct),On=n(323),In=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((r=r.apply(e,t||[])).next())}))};E.PathTubeGeometry=On.PathTubeGeometry,E.PathGeometry=On.PathGeometry,E.PathPointList=On.PathPointList;var Fn,Nn=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((r=r.apply(e,t||[])).next())}))},zn=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return fetch(e,{method:"POST",mode:"cors",headers:Object.assign({"Content-Type":"application/json"},n),body:JSON.stringify(t)}).then((function(e){return e.json()}))},Un=function(e,t){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify(t)}).then((function(e){return e.body})).then((function(e){if(e){var t=e.getReader();return new ReadableStream({start:function(e){return Nn(this,void 0,void 0,o.default.mark((function n(){var r,i,a;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.read();case 2:if(r=n.sent,i=r.done,a=r.value,!i){n.next=7;break}return n.abrupt("break",10);case 7:e.enqueue(a);case 8:n.next=0;break;case 10:e.close();case 11:case"end":return n.stop()}}),n)})))}})}})).then((function(e){return new Response(e)})).then((function(e){return e.blob()}))},Hn=function(e,t,n,r,i,a){a=a||0;var o,s={tx:0,ty:e.py-a,tz:0};return o=null!=i?i:Math.atan((t.pz-e.pz)/(t.px-e.px)),t.pz<=e.pz&&t.px<=e.px||t.pz>=e.pz&&t.px<=e.px?"up"===r?(s.tz=e.pz-n*Math.sin(o),s.tx=e.px-n*Math.cos(o)):"down"===r&&(s.tz=e.pz+n*Math.sin(o),s.tx=e.px+n*Math.cos(o)):(t.pz>=e.pz&&t.px>=e.px||t.pz<=e.pz&&t.px>=e.px)&&("up"===r?(s.tz=e.pz+n*Math.sin(o),s.tx=e.px+n*Math.cos(o)):"down"===r&&(s.tz=e.pz-n*Math.sin(o),s.tx=e.px-n*Math.cos(o))),s},jn=function(e,t,n,r){var i,a,o,s;e=JSON.parse(JSON.stringify(e)),t=JSON.parse(JSON.stringify(t));var l=Math.atan((t.tz-e.pz)/(t.tx-e.px));return t.tz<=e.pz&&t.tx<=e.px||t.tz>=e.pz&&t.tx<=e.px?"up"===r?(i=e.pz-n*Math.sin(l),a=e.px-n*Math.cos(l),o=t.tz-n*Math.sin(l),s=t.tx-n*Math.cos(l)):"down"===r&&(i=e.pz+n*Math.sin(l),a=e.px+n*Math.cos(l),o=t.tz+n*Math.sin(l),s=t.tx+n*Math.cos(l)):(t.tz>=e.pz&&t.tx>=e.px||t.tz<=e.pz&&t.tx>=e.px)&&("up"===r?(i=e.pz+n*Math.sin(l),a=e.px+n*Math.cos(l),o=t.tz+n*Math.sin(l),s=t.tx+n*Math.cos(l)):"down"===r&&(i=e.pz-n*Math.sin(l),a=e.px-n*Math.cos(l),o=t.tz-n*Math.sin(l),s=t.tx-n*Math.cos(l))),{position:{px:a,py:e.py,pz:i},target:{tx:s,ty:t.ty,tz:o}}},Gn=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((r=r.apply(e,t||[])).next())}))},Vn=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).showChildrenVisible=function(e){for(var t in e.children)e.children[t].visible=!0},e.show=function(t,n,r){for(var i in t){var a=(new E.Box3).setFromObject(t[i]).getSize(new E.Vector3),o=a.x*a.y*a.z;o>n&&o<=r&&(t[i].visible=!0,t[i].children.length>0&&e.showChildrenVisible(t[i]))}},e.showBox=function(t){var n=e.getCore().scene;for(var r in t){var i=new E.Box3;i.setFromObject(t[r]);var a=new E.Box3Helper(i,16776960);n.add(a)}},e.setDrawRange=function(e,t){var n=new Array;for(var r in"[object Array]"===Object.prototype.toString.call(e)?n=e:n.push(e),n)n[r].traverse((function(e){if("Mesh"===e.type&&"BufferGeometry"===e.geometry.type){var n=e.geometry.getIndex();e.geometry=e.geometry.clone(),e.geometry.setDrawRange(0,n.count*t)}}))},e.getObject3dPosition=function(e){var t=new E.Box3;t.setFromObject(e);var n=new E.Vector3;return t.getCenter(n),{x:n.x,y:n.y,z:n.z}},e.setLod3=function(t){var n=[],r=0,i=new E.Group,a=e.getCore().scene;for(var o in t){var s=(new E.Box3).setFromObject(t[o]).getSize(new E.Vector3),l=s.x*s.y*s.z;if(l<.005||l>.005&&l<=.05||l>.35&&l<=.4||l>.05&&l<=.2||l>.3&&l<=.35||l>.4&&l<=.5||l>2.3&&l<=2.5||l>3.85&&l<=3.95){n[r]=new E.LOD,t[o].visible=!1;var u=t[o].clone(),c=t[o].clone(),h=new E.Object3D;u.matrixAutoUpdate=!1,c.matrixAutoUpdate=!1,h.matrixAutoUpdate=!1,n[r].matrixAutoUpdate=!1;for(var d=0;d<u.children.length;d++)u.children[d].visible=!0,c.children[d].visible=!0;var p=void 0,f=void 0,m=void 0,v=void 0,g={x:0,y:0,z:0};0==t[o].position.x&&0==t[o].position.y&&0==t[o].position.z?g=e.getObject3dPosition(t[o]):(g.x=t[o].position.x,g.y=t[o].position.y,g.z=t[o].position.z),u.position.set(u.position.x-g.x,u.position.y-g.y,u.position.z-g.z),c.position.set(c.position.x-g.x,c.position.y-g.y,c.position.z-g.z),h.position.set(h.position.x-g.x,h.position.y-g.y,h.position.z-g.z),u.updateMatrix(),c.updateMatrix(),h.updateMatrix(),n[r].position.set(g.x,g.y,g.z),n[r].updateMatrix(),l<.005?(p=5,f=10,m=20,v=1/3):l>.005&&l<=.05||l>.35&&l<=.4?(p=5,f=15,m=40,v=2/3):(p=5,f=10,m=20,v=.1),e.setDrawRange(c,v);for(var y=[[u,p],[c,f],[h,m]],x=0;x<y.length;x++)n[r].addLevel(y[x][0],y[x][1]);i.add(n[r++])}}return a.add(i),i},e.setLod2=function(t,n){for(var r=(0,c.default)(e),i=e.getCore().scene,a=(n.x-t.x)/20,o=(n.z-t.z)/20,s=[],l=[],u=[],h=0,d=new E.Group,p=t.z;p+o<=n.z+1;p+=o)for(var f=0,m=t.x;m+a<=n.x+1;m+=a,f++){var v=new E.Vector3(m,t.y,p),g=new E.Vector3(m+a,n.y,p+o);s.push(new E.Box3(v,g))}for(var y in s)l[y]=new E.Object3D;for(var x in i.children[0].children){var b=i.children[0].children[x].children;for(var M in b)if("Object3D"===b[M].type){var w={x:0,y:0,z:0};for(var _ in 0===b[M].position.x&&0===b[M].position.y&&0===b[M].position.z?w=r.getObject3dPosition(b[M]):(w.x=b[M].position.x,w.y=b[M].position.y,w.z=b[M].position.z),s)if(s[_].containsPoint(new E.Vector3(w.x,w.y,w.z))){l[_].add(b[_]);break}}}var A=[];for(var C in l)if(l[C].children.length>0){A.push(l[C]),u[h]=new E.LOD,l[C].visible=!1;var T=l[C].clone(),S=l[C].clone(),L=new E.Object3D;T.matrixAutoUpdate=!1,S.matrixAutoUpdate=!1,L.matrixAutoUpdate=!1,u[h].matrixAutoUpdate=!1;var P={x:0,y:0,z:0},B=new E.Vector3;s[C].getCenter(B),P.x=B.x,P.y=B.y,P.z=B.z,T.position.set(T.position.x-P.x,T.position.y-P.y,T.position.z-P.z),S.position.set(S.position.x-P.x,S.position.y-P.y,S.position.z-P.z),L.position.set(L.position.x-P.x,L.position.y-P.y,L.position.z-P.z),T.updateMatrix(),S.updateMatrix(),L.updateMatrix(),u[h].position.set(P.x,P.y,P.z),u[h].updateMatrix();var D=5,k=15,R=40,O=2/3;e.setDrawRange(S,O);for(var I=[[T,D],[S,k],[L,R]],F=0;F<I.length;F++)u[h].addLevel(I[F][0],I[F][1]);d.add(u[h++])}return i.add(d),[d,A]},e.getLodMeshArray=function(t){if(null!=t){e.getCore().scene.updateMatrixWorld(!0);var n=[];return t.traverse((function(e){if(e.isMesh){var t=new s.Vector3,r=new E.Box3,i=(new E.Sphere,0),a=e.clone();e.getWorldPosition(t),r.setFromObject(e.parent),i=r.getBoundingSphere().radius,n.push([a,i,t,e.parent.rotation,e.parent.scale])}})),n}},e.setLod=function(t,n,r,i,a){if(t){void 0===n&&(n=[20]),void 0===r&&(r=!0),void 0===a&&((a=new E.Group).name="LODRoot");var o=e.getCore().scene;o.updateMatrixWorld(!0);for(var s=function(){var o=[],s=[];if(e.isArray(t[l])?t[l].forEach((function(t){o.push(e.getLodMeshArray(t))})):s.push(e.getLodMeshArray(t[l])),s.length>0){var u=new E.Group;s.forEach((function(e){u.add(e)})),a.add(u)}o.length>0&&a.add(e.setLodWithArray(o,n,r,i))},l=0;l<t.length;l++)s();return o.add(a),a}},e.setLodWithArray=function(t,n,r,i,a){if(void 0===n)for(var o=0;o<t.length;o++)n.push(20*o);else if(n.length<=t.length)for(var s=1,l=n.length;l<=t.length;l++)n.push(n[n.length-1]+20*s),s+=1;void 0===r&&(r=!0),void 0===a&&(a=new E.Group);for(var u=0,c=t[0];u<c.length;u++){var h=new E.LOD;h.position.x+=c[u][2].x,h.position.y+=c[u][2].y,h.position.z+=c[u][2].z,h.rotation.x=c[u][3].x,h.rotation.y=c[u][3].y,h.rotation.z=c[u][3].z,h.scale.x=c[u][4].x,h.scale.y=c[u][4].y,h.scale.z=c[u][4].z;for(var d=0;d<t.length;d++)t[d][u][0].position.x=0,t[d][u][0].position.y=0,t[d][u][0].position.z=0,t[d][u][0].updateMatrix(),h.addLevel(t[d][u][0],c[u][1]+n[d]);if(r){var p=new E.Mesh;p.name="emptyMesh";var f=e.getObjPixelDistanceWithRadius(c[u][1],i),m=c[u][1]+n[n.length-1];f>m?h.addLevel(p,f):h.addLevel(p,m)}h.updateMatrix(),a.add(h)}return a},e.mergeMeshBFG=function(){var t=e.getCore().scene;t.updateMatrixWorld(!0);var n=[],r=[];t.traverse((function(e){"Mesh"==e.type&&(n.push(e),r.push(e.material))}));for(var i=new E.Geometry,a=0;a<n.length;a++)i.merge((new E.Geometry).fromBufferGeometry(n[a].geometry),n[a].matrixWorld,a);var o=(new E.BufferGeometry).fromGeometry(i),s=new E.Mesh(o,r),l=new E.Object3D;l.name="mergeObj",l.add(s),t.add(l)},e.setBounding=function(t,n,r,i){void 0===t&&(t=.036*window.screen.height),void 0===i&&(i=!1),void 0===n&&(n=!0),void 0===r&&(r=3);var a=e.getCore().scene;if(i){var o=[];if(a.traverse((function(n){if("Object3D"===n.type){var r,i=w(n.children);try{for(i.s();!(r=i.n()).done;){var a=r.value;if("Mesh"===a.type){a.geometry.computeBoundingSphere();var l=e.getObjPixelDistanceWithRadius(a.geometry.boundingSphere.radius,t);n.userData.distance2=(100*l|0)/100,n.userData.center=a.geometry.boundingSphere.center;var u=new s.LOD;n.add(u),u.addLevel(a.clone(),l-1),u.addLevel(new E.Mesh,l),o.push(u)}}}catch(e){i.e(e)}finally{i.f()}var c,h=w(n.children);try{for(h.s();!(c=h.n()).done;){var d=c.value;"Mesh"===d.type&&n.remove(d)}}catch(e){h.e(e)}finally{h.f()}}})),i)return o}else if(n){var l=new E.Box3,u=new E.Sphere,c=0,h=0,d=0;a.traverse((function(n){if("Mesh"===n.type){var i=new E.Vector3;l.setFromObject(n),u=l.getBoundingSphere(u);var a=[(i=l.getSize(i)).x,i.y,i.z];a.sort(),c=a[1],d=e.getObjPixelDistanceWithRadius(c/2,r),h=e.getObjPixelDistanceWithRadius(u.radius,t);var o=d<h?d:h;n.userData.distance2=(o*o*100|0)/100,n.userData.center=u.center}}))}else a.traverse((function(n){if("Mesh"===n.type){n.geometry.computeBoundingSphere();var r=e.getObjPixelDistanceWithRadius(n.geometry.boundingSphere.radius,t);n.userData.distance2=(r*r*100|0)/100,n.userData.center=n.geometry.boundingSphere.center}}))},e.updateLods=function(t){var n=e.getCore().camera;t.forEach((function(e){e.update(n)}))},e.getObjPixelDistanceWithRadius=function(t,n,r){var i=window.screen.height;t=Math.abs(t),(void 0===n||n<=0||n>i)&&(n=.036*i),n/=2,void 0===r&&(r=e.core.getCamera());var a=0,o=r.fov*Math.PI/180,s=Math.tan(o/2);return a=(a=Math.round(t/s*(i/n)*100)/100)<=20?20:a},e.getAllLods=function(){var t=e.getCore().scene,n=[];return t.traverse((function(e){"LOD"==e.type&&n.push(e)})),n},e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"isArray",value:function(e){return"[object Array]"==Object.prototype.toString.call(e)}}])}(ke),Wn=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).addLabel=function(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#255a99",o=document.createElement("div");o.id=t,o.className="labels",o.style.cssText="background-color: "+a+";border-radius:5px;\nopacity: 0.8;font-size: 0.2em;color: white; width: auto;height: auto;padding: 0px 8px 0px 8px;";var s=document.createElement("table");s.style.cssText="border-collapse:collapse;border-spacing:0;border:0px;",r.forEach((function(e,n){var r=document.createElement("tr");r.style.cssText="padding:0; border:0px;";for(var i=0;i<2;i++){var a=document.createElement("td");if(a.style.cssText="padding:0; border:0px;",0===i){var o=document.createElement("p");o.style.cssText="text-align-last: justify;",o.className="title",o.innerHTML=n,a.appendChild(o)}if(1===i){var l=document.createElement("span");l.innerHTML=":";var u=document.createElement("span");u.id=t+n,u.style.cssText="padding-left:5px",u.innerHTML=e,a.appendChild(l),a.appendChild(u)}r.appendChild(a)}s.appendChild(r)})),o.appendChild(s),i&&(o.onclick=i(t)),e.addCSS2DLabel(t,o,n,"normal")},e.addCSS2DLabel=function(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new E.Vector3,s=e.getCore(),l=s.scene,u=(s.CSS2DRenderControl,s.rotateOnAxisY);if(!e.labelMap.get(t)){var c=new E.CSS2DObject(n);c.name=t,c.userData.type="CSS2DObject",c.userData.labelType=i;var h=u(r,a).add(o);c.position.set(h.x,h.y,h.z),e.labelMap.set(t,c),l.add(c),e.core.needUpdate=!0}},e.addCSS2DLabelToObject=function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new E.Vector3,a=e.getCore();if(a.scene,a.CSS2DRenderControl,!e.labelMap.get(t)){var o=new E.CSS2DObject(n);o.name=t,o.userData.type="CSS2DObject",o.position.set(i.x,i.y,i.z),o.updateMatrixWorld(),e.labelMap.set(t,o),r.add(o),e.core.needUpdate=!0}},e.labelMap=new Map,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"emptyLabel",value:function(){0!==this.getCore().scene.children.length&&(this.labelMap.forEach((function(e,t){e.parent.remove(e)})),this.labelMap=new Map,this.core.needUpdate=!0)}},{key:"emptyLabelByName",value:function(e){var t=this.labelMap.get(e);t&&(t.parent.remove(t),this.labelMap.delete(e),this.core.needUpdate=!0)}},{key:"emptyLabelByLabelType",value:function(e){var t=this;0!==this.getCore().scene.children.length&&(this.labelMap.forEach((function(n,r){n.userData.labelType==e&&(t.labelMap.delete(n.name),n.parent.remove(n))})),this.core.needUpdate=!0)}},{key:"setLabelVisibleByName",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.getCore(),i=r.scene;if(r.render,0!==i.children.length){for(var a=i.children.length-1;a>=0;a--)"CSS2DObject"===i.children[a].userData.type&&i.children[a].name==e&&(i.children[a].visible=n?!i.children[a].visible:t);this.core.needUpdate=!0}}},{key:"setLabelVisible",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getCore(),r=n.scene;if(n.render,0!==r.children.length){for(var i=r.children.length-1;i>=0;i--)"CSS2DObject"===r.children[i].userData.type&&(r.children[i].visible=t?!r.children[i].visible:e);this.core.needUpdate=!0}}}])}(ke),Xn=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).fontSize=.5,e.fontColor=26265,e.fontFamilyUrl="./Bustard/font/YaHeiConsolasHybrid_YaHeiConsolasHybridRegular.json",e.rotation={x:-Math.PI/2,y:0,z:0},e.setFontFamily=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.fontFamilyUrl,n=new E.FontLoader,r=(0,c.default)(e);n.load(t,(function(e){r.fontFamily=e}))},e.addText=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.fontSize,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.fontColor,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.rotation;if(arguments.length>5&&void 0!==arguments[5]||e.fontFamilyUrl,!a().isNil(t)&&!a().isNil(n)){var s=e.getCore(),l=s.scene,u=(s.render,new E.MeshBasicMaterial({color:i,transparent:!0})),c=e.fontFamily.generateShapes(t,r),h=new E.ShapeBufferGeometry(c);h.computeBoundingBox();var d=new E.Mesh(h,u);d.position.set(n.x,n.y,n.z),d.rotation.set(o.x,o.y,o.z),l.add(d),e.core.needUpdate=!0}},e}return(0,m.default)(t,e),(0,g.default)(t)}(ke),Yn={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-Yn.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*Yn.Bounce.In(2*e):.5*Yn.Bounce.Out(2*e-1)+.5}}},Jn="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},Qn=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map((function(t){return e._tweens[t]}))},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},e.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},e.prototype.update=function(e,t){void 0===e&&(e=Jn()),void 0===t&&(t=!1);var n=Object.keys(this._tweens);if(0===n.length)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var i=this._tweens[n[r]],a=!t;i&&!1===i.update(e,a)&&!t&&delete this._tweens[n[r]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),qn={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=qn.Utils.Linear;return t<0?a(e[0],e[1],r):t>1?a(e[n],e[n-1],n-r):a(e[i],e[i+1>n?n:i+1],r-i)},Bezier:function(e,t){for(var n=0,r=e.length-1,i=Math.pow,a=qn.Utils.Bernstein,o=0;o<=r;o++)n+=i(1-t,r-o)*i(t,o)*e[o]*a(r,o);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),a=qn.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(i=Math.floor(r=n*(1+t))),a(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(a(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):a(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=qn.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:(Fn=[1],function(e){var t=1;if(Fn[e])return Fn[e];for(var n=e;n>1;n--)t*=n;return Fn[e]=t,t}),CatmullRom:function(e,t,n,r,i){var a=.5*(n-e),o=.5*(r-t),s=i*i;return(2*t-2*n+a+o)*(i*s)+(-3*t+3*n-2*a-o)*s+a*i+t}}},Kn=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),Zn=new Qn,$n=function(){function e(e,t){void 0===t&&(t=Zn),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Yn.Linear.None,this._interpolationFunction=qn.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=Kn.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.to=function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},e.prototype.duration=function(e){return this._duration=e,this},e.prototype.start=function(e){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var t in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==e?"string"==typeof e?Jn()+parseFloat(e):e:Jn(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},e.prototype._setupProperties=function(e,t,n,r){for(var i in n){var a=e[i],o=Array.isArray(a),s=o?"array":(0,y.default)(a),l=!o&&Array.isArray(n[i]);if("undefined"!==s&&"function"!==s){if(l){var u=n[i];if(0===u.length)continue;u=u.map(this._handleRelativeValue.bind(this,a)),n[i]=[a].concat(u)}if("object"!==s&&!o||!a||l)void 0===t[i]&&(t[i]=a),o||(t[i]*=1),r[i]=l?n[i].slice().reverse():t[i]||0;else{for(var c in t[i]=o?[]:{},a)t[i][c]=a[c];r[i]=o?[]:{},this._setupProperties(a,t[i],n[i],r[i])}}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(e){return void 0===e&&(e=Jn()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this)),this},e.prototype.resume=function(e){return void 0===e&&(e=Jn()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return this._group=e,this},e.prototype.delay=function(e){return this._delayTime=e,this},e.prototype.repeat=function(e){return this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return this._yoyo=e,this},e.prototype.easing=function(e){return this._easingFunction=e,this},e.prototype.interpolation=function(e){return this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(e,t){if(void 0===e&&(e=Jn()),void 0===t&&(t=!0),this._isPaused)return!0;var n,r,i=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>i)return!1;t&&this.start(e)}if(this._goToEnd=!1,e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||r>1?1:r;var a=this._easingFunction(r);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,a),this._onUpdateCallback&&this._onUpdateCallback(this._object,r),1===r){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,s=this._chainedTweens.length;o<s;o++)this._chainedTweens[o].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(e,t,n,r){for(var i in n)if(void 0!==t[i]){var a=t[i]||0,o=n[i],s=Array.isArray(e[i]),l=Array.isArray(o);!s&&l?e[i]=this._interpolationFunction(o,r):"object"==(0,y.default)(o)&&o?this._updateProperties(e[i],a,o,r):"number"==typeof(o=this._handleRelativeValue(a,o))&&(e[i]=a+(o-a)*r)}},e.prototype._handleRelativeValue=function(e,t){return"string"!=typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],n=this._valuesEnd[e];this._valuesStartRepeat[e]="string"==typeof n?this._valuesStartRepeat[e]+parseFloat(n):this._valuesEnd[e],this._valuesEnd[e]=t},e}(),er=Kn.nextId,tr=Zn,nr=tr.getAll.bind(tr),rr=tr.removeAll.bind(tr),ir=tr.add.bind(tr),ar=tr.remove.bind(tr),or=tr.update.bind(tr),sr={Easing:Yn,Group:Qn,Interpolation:qn,now:Jn,Sequence:Kn,nextId:er,Tween:$n,VERSION:"18.6.4",getAll:nr,removeAll:rr,add:ir,remove:ar,update:or},lr=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t)).highLight=function(e){if(!a().isNil(e)){n.isInit||n._init();var t=n.getCore(),r=(t.scene,t.render,t.composer),i=t.setHighPerformance,o=t.traverseNodes,s=(0,c.default)(n);i(n.isHF),"Object3D"===e.type&&e.children.forEach((function(e){l(e)})),"Group"===e.type&&o(e,(function(e){e.isMesh&&l(e)})),"Mesh"===e.type&&l(e),n.detection(),n.core.needUpdate=!0,r.render()}function l(e){void 0===s.highLightedObjectsMap.get(e)?(s.highLightedObjectsMap.set(e,e.name),s.highLightedObjects.push(e)):(s.highLightedObjectsMap.delete(e),s.highLightedObjects.forEach((function(t,n,r){t==e&&r.splice(n,1)}))),s.outlinePass.selectedObjects=s.highLightedObjects}},n.customer_highLight=function(e,t){if(!a().isNil(e)){n.isCustomerInit||n.customer_init(t);var r=n.getCore(),i=(r.render,r.composer),o=r.setHighPerformance,s=(0,c.default)(n);o(n.isHF),"Object3D"===e.type&&e.children.forEach((function(e){l(e)})),"Mesh"===e.type&&l(e),n.detection(),n.core.needUpdate=!0,i.render()}function l(e){void 0===s.customerHighLightedObjectsMap.get(e)?(s.customerHighLightedObjectsMap.set(e,e.name),s.customerHighLightedObjects.push(e)):(s.customerHighLightedObjectsMap.delete(e),s.customerHighLightedObjects.forEach((function(t,n,r){t==e&&r.splice(n,1)}))),s.customerOutlinePass.selectedObjects=s.customerHighLightedObjects}},n.removeCustomerHL=function(){var e=(0,c.default)(n),t=n.getCore(),r=(t.scene,t.render,t.composer);t.setHighPerformance,0!=n.customerHighLightedObjectsMap.size&&(n.customerHighLightedObjectsMap.forEach((function(t,n,r){e.customerHighLightedObjectsMap.delete(n)})),n.customerHighLightedObjects=[],n.customerOutlinePass.selectedObjects=n.customerHighLightedObjects,n.detection(),n.core.needUpdate=!0,r.render())},n.removeAllHighLight=function(){var e=(0,c.default)(n);if(0!=n.highLightedObjects.length){var t=n.getCore(),r=(t.scene,t.render,t.composer);(0,t.setHighPerformance)(n.isHF),n.highLightedObjectsMap.forEach((function(t,n,r){e.highLightedObjectsMap.delete(n)})),n.highLightedObjects=[],n.outlinePass.selectedObjects=n.highLightedObjects,n.detection(),n.core.needUpdate=!0,r.render()}},n.highLightById=function(e){var t=n.getCore(),r=t.scene,i=t.traverseNodes,a="";i(r,(function(t){t.parent&&t.parent.userData.uniqId===e&&a!==e&&(a=e,n.highLight(t.parent))}))},n.highLightByIds=function(e){var t=n.getCore(),r=t.scene,i=t.traverseNodes,a=[];i(r,(function(t){t.parent&&e.indexOf(t.parent.userData.uniqId)>=0&&a.indexOf(t.parent.userData.uniqId)<0&&a.push(t.parent.userData.uniqId),n.highLight(t.parent)}))},n.detection=function(){n.highLightedObjects.length>0||n.customerHighLightedObjects.length>0?n.getCore().isComposerRender=!0:n.getCore().isComposerRender=!1},n._init=function(){var e=n.getCore(),t=e.composer,r=e.scene,i=e.camera,o=e.width,s=e.height;if(n.isRenderPassInit||n.renderPassInit(),n.outlinePass=new E.OutlinePass(new E.Vector2(o,s),r,i),t.addPass(n.outlinePass),n.isPassInit||n.passInit(),n.isInit=!0,!a().isNil(n.config)){var l=n.config;a().isNumber(l.edgeStrength)&&(n.outlinePass.edgeStrength=l.edgeStrength),a().isNumber(l.edgeGlow)&&(n.outlinePass.edgeGlow=l.edgeGlow),a().isNumber(l.edgeThickness)&&(n.outlinePass.edgeThickness=l.edgeThickness),a().isNumber(l.edgeStrength)&&(n.outlinePass.edgeStrength=l.edgeStrength),a().isNumber(l.pulsePeriod)&&(n.outlinePass.pulsePeriod=l.pulsePeriod),a().isNumber(l.visibleEdgeColor)&&(n.outlinePass.visibleEdgeColor=new E.Color(l.visibleEdgeColor)),a().isNumber(l.hiddenEdgeColor)&&(n.outlinePass.hiddenEdgeColor=new E.Color(l.hiddenEdgeColor)),a().isBoolean(l.isMutex)&&(n.isMutex=l.isMutex),a().isBoolean(l.isHF)&&(n.isHF=l.isHF)}},n.customer_init=function(e){var t=n.getCore(),r=t.composer,i=t.scene,o=t.camera,s=t.width,l=t.height;n.isRenderPassInit||n.renderPassInit(),n.isCustomerInit=!0,n.customerOutlinePass=new E.OutlinePass(new E.Vector2(s,l),i,o),r.addPass(n.customerOutlinePass),n.isPassInit||n.passInit(),a().isNil(e)||(a().isNumber(e.edgeStrength)&&(n.customerOutlinePass.edgeStrength=e.edgeStrength),a().isNumber(e.edgeGlow)&&(n.customerOutlinePass.edgeGlow=e.edgeGlow),a().isNumber(e.edgeThickness)&&(n.customerOutlinePass.edgeThickness=e.edgeThickness),a().isNumber(e.edgeStrength)&&(n.customerOutlinePass.edgeStrength=e.edgeStrength),a().isNumber(e.pulsePeriod)&&(n.customerOutlinePass.pulsePeriod=e.pulsePeriod),a().isNumber(e.visibleEdgeColor)&&(n.customerOutlinePass.visibleEdgeColor=new E.Color(e.visibleEdgeColor)),a().isNumber(e.hiddenEdgeColor)&&(n.customerOutlinePass.hiddenEdgeColor=new E.Color(e.hiddenEdgeColor)))},n.isInit=!1,n.isCustomerInit=!1,n.isPassInit=!1,n.isRenderPassInit=!1,n.isMutex=!0,n.isHF=!0,a().isNil(e)||(n.config=e),n.highLightedObjects=[],n.highLightedObjectsMap=new Map,n.customerHighLightedObjects=[],n.customerHighLightedObjectsMap=new Map,n.lineSegments=[],n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"passInit",value:function(){var e=this.getCore(),t=(e.scene,e.camera,e.composer),n=e.width,r=e.height,i=new E.ShaderPass(E.FXAAShader);i.uniforms.resolution.value.set(1/n,1/r),i.renderToScreen=!0,t.addPass(i),this.isPassInit=!0}},{key:"renderPassInit",value:function(){var e=this.getCore(),t=e.scene,n=e.camera,r=e.composer,i=new E.RenderPass(t,n);r.addPass(i),this.isRenderPassInit=!0}},{key:"addEdge2",value:function(e,t){var n=this;this.lineSegments.forEach((function(e){e.parent.remove(e)})),this.lineSegments=[],e&&0!=e.length&&e.forEach((function(e){var r=new E.LineBasicMaterial({color:t,linewidth:5}),i=n;(0,n.getCore().traverseNodes)(e,(function(e){if("Mesh"==e.type)if(e instanceof E.InstancedMesh)for(var t=0;t<e.count;t++){var n=new E.EdgesGeometry(e.geometry),a=new E.LineSegments(n,r);a.applyMatrix4(e.userData.meshMatrix[t]),i.lineSegments.push(a),e.userData.parent[t].add(a)}else{var o=new E.EdgesGeometry(e.geometry),s=new E.LineSegments(o,r);s.applyMatrix4(e.matrix.clone()),i.lineSegments.push(s),e.parent.add(s)}}))}))}},{key:"addEdge",value:function(e,t,n){var r=this,i=this.getCore(),a=i.traverseNodes,o=i.traverseNodesAll;if(e){var s=new E.LineBasicMaterial({color:t,linewidth:5});o(e,(function(e){"instancedMeshes"in e.userData&&e.userData.instancedMeshes.forEach((function(t){var i=t.mesh,a=t.id,o=new E.EdgesGeometry(i.geometry.clone()),l=new E.LineSegments(o,s);l.applyMatrix4(i.userData.meshMatrix[a].clone()),l.userData.type=n,r.lineSegments.push(l),e.add(l)}))})),a(e,(function(e){if("Mesh"==e.type&&!(e instanceof E.InstancedMesh)){var t=new E.EdgesGeometry(e.geometry.clone()),i=new E.LineSegments(t,s);i.applyMatrix4(e.matrix.clone()),i.userData.type=n,r.lineSegments.push(i),e.parent.add(i)}}))}}},{key:"removeEdge",value:function(e){for(var t=this.lineSegments.length-1;t>-1;t--)e&&e!=this.lineSegments[t].userData.type||(this.lineSegments[t].geometry.dispose(),this.lineSegments[t].geometry=null,this.lineSegments[t].material.dispose(),this.lineSegments[t].material=null,this.lineSegments[t].parent.remove(this.lineSegments[t]),this.lineSegments.splice(t,1))}}])}(ke),ur=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).particleFireAnimationState=!1,e.time=0,e.addParticleFire=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},r=arguments.length>2?arguments[2]:void 0,i=e.getCore().scene;e.particleFireTemplate||e.createParticleFire();var a=e.particleFireTemplate.clone();a.name=t,a.position.set(n.x,n.y,n.z),a.scale.set(.8*r,r,.8*r),e.particleFireMap.set(t,a),i.add(a),e.particleFireAnimationState=!0,e.core.needUpdate=!0},e.removeParticleFireByName=function(t){var n=e.getCore().dispose;e.particleFireMap.get(t)&&(n(e.particleFireMap.get(t)),e.particleFireMap.delete(t),e.particleFireMap.size||(e.particleFireAnimationState=!1),e.core.needUpdate=!0)},e.removeAllParticleFire=function(){var t=e.getCore().dispose;if(e.particleFireMap.size){var n=(0,c.default)(e);e.particleFireMap.forEach((function(e,r){t(e),n.particleFireMap.delete(r)}))}e.core.needUpdate=!0,e.particleFireAnimationState=!1},e.particleFireMap=new Map,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"createParticleFire",value:function(){for(var e=100,t=new Float32Array(300),r=new Float32Array(300),i=new Float32Array(e),a=new E.Vector3,o=new E.Color(16777215),s=0;s<e;s++)a.x=.5*(2*Math.random()-1),a.y=.5*(2*Math.random()-1),a.z=.5*(2*Math.random()-1),a.toArray(t,3*s),o.setHSL(0+s/e*.1,.9,.5),o.toArray(r,3*s),i[s]=40;var l=new E.BufferGeometry;l.setAttribute("position",new E.BufferAttribute(t,3)),l.setAttribute("customColor",new E.BufferAttribute(r,3)),l.setAttribute("size",new E.BufferAttribute(i,1));var u=new E.ShaderMaterial({uniforms:{color:{value:new E.Color(16777215)},pointTexture:{value:(new E.TextureLoader).load(n(811).A)}},vertexShader:["attribute float size;","attribute vec3 customColor;","varying vec3 vColor;","void main() {","    vColor = customColor;","    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);","    gl_PointSize = size * (300.0 / -mvPosition.z);","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D pointTexture;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( color * vColor, 1.0 );","    gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord );","}"].join("\n"),transparent:!0,depthTest:!1,blending:E.AdditiveBlending});this.particleFireTemplate=new E.Points(l,u),this.particleFireTemplate.renderOrder=20}},{key:"particleAnimation",value:function(){var e=this;this.particleFireAnimationState&&(this.time+=.1,this.particleFireMap.forEach((function(t,n){t.rotation.y=.01*e.time;for(var r=t.geometry.attributes,i=0;i<r.size.array.length;i++)r.size.array[i]=1.5*t.scale.y+1.5*Math.sin(.3*i+e.time)*t.scale.y;for(var a=0;a<r.position.array.length;a++)a%3==1&&(r.position.array[a]+=.01*Math.sin(.3*a+e.time)*t.scale.y);r.position.needsUpdate=!0,r.size.needsUpdate=!0})))}}])}(ke),cr=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).addGlowRing=function(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sign-temp",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{position:{x:0,y:0,z:0},surfaceTextureUrl:null,surfaceSize:2,color:16737823},i=e.getCore().scene,a=new E.TextureLoader;if(r.surfaceTextureUrl){var o=a.load(r.surfaceTextureUrl);o.wrapS=E.RepeatWrapping,o.wrapT=E.RepeatWrapping,t=new E.MeshBasicMaterial({color:r.color,map:o,transparent:!0})}else t=new E.MeshPhongMaterial({color:r.color,dithering:!0,depthTest:!0,depthWrite:!1,transparent:!0,opacity:.6});var s=new E.CircleGeometry(r.surfaceSize,64),l=new E.Mesh(s,t);l.position.set(r.position.x,r.position.y,r.position.z),l.rotation.x=.5*-Math.PI,l.renderOrder=r.renderOrder?r.renderOrder:20,l.receiveShadow=!0,l.name="glowRing-"+n,l.layers.enable(1),e.glowRingMap.set(l.name,l),i.add(l)},e.addLabelGlowRing=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sign-temp",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{position:{x:0,y:0,z:0},surfaceTextureUrl:null,surfaceSize:2,color:16737823};if(!e.labelGlowRingMap.get(t)){var r,i=e.getCore().scene,a=(new E.TextureLoader).load(n.surfaceTextureUrl);a.wrapS=E.RepeatWrapping,a.wrapT=E.RepeatWrapping,r=new E.MeshBasicMaterial({color:n.color,map:a,transparent:!0});var o=new E.CircleGeometry(n.surfaceSize,64),s=new E.Mesh(o,r);s.position.set(n.position.x,n.position.y,n.position.z),s.rotation.x=.5*-Math.PI,s.renderOrder=n.renderOrder?n.renderOrder:20,s.receiveShadow=!0,s.name=t,s.layers.enable(1),e.labelGlowRingMap.set(s.name,s),i.add(s)}},e.addGlowSign=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sign-temp",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{position:{x:0,y:0,z:0},addSurface:!0,surfaceTextureUrl:null,surfaceSize:2,color:16737823,pyramidRadius:.5,pyramidheight:2,pyramidRadialSegments:4},r=e.getCore(),i=r.scene;if(r.camera,n.addSurface){var a,o=new E.TextureLoader;if(n.surfaceTextureUrl){var s=o.load(n.surfaceTextureUrl);s.wrapS=E.RepeatWrapping,s.wrapT=E.RepeatWrapping,a=new E.MeshPhongMaterial({emissive:n.color,dithering:!0,map:s,depthTest:!0,depthWrite:!1,transparent:!0})}else a=new E.MeshPhongMaterial({emissive:n.color,dithering:!0,depthTest:!0,depthWrite:!1,transparent:!0,opacity:.6});var l=new E.CircleGeometry(n.surfaceSize,32),u=new E.Mesh(l,a);u.position.set(n.position.x,n.position.y,n.position.z),u.rotation.x=.5*-Math.PI,u.receiveShadow=!0,u.name="surface-"+t,u.layers.enable(1),e.surfaces.push(u),i.add(u)}var c=new E.ConeGeometry(n.pyramidRadius,n.pyramidheight,n.pyramidRadialSegments),h=new E.MeshBasicMaterial({color:16776960}),d=new E.Mesh(c,h);d.position.set(n.position.x,n.position.y+n.pyramidheight/2,n.position.z),d.rotation.x=-Math.PI,d.name="pyramid-"+t,d.layers.enable(1),e.pyramids.push(d),i.add(d)},e.addGlowMesh=function(t){var n=e.getCore().scene;e.init(),e.getCore().isGlow=!0;var r=(new E.TextureLoader).load(t);r.wrapS=E.RepeatWrapping,r.wrapT=E.RepeatWrapping;var i=new E.MeshBasicMaterial({color:16711893,dithering:!0,map:r,depthTest:!0,depthWrite:!1});i.transparent=!0;var a=new E.CircleGeometry(1,32),o=new E.Mesh(a,i);o.position.set(0,.2,0),o.rotation.x=.5*-Math.PI,o.receiveShadow=!0,o.layers.enable(1),n.add(o);var s=new E.ConeGeometry(.2,.5,4),l=new E.MeshBasicMaterial({color:16711893}),u=new E.Mesh(s,l);u.position.set(0,5,0),u.rotation.x=-Math.PI,u.layers.enable(1),n.add(u)},e.ENTIRE_SCENE=0,e.BLOOM_SCENE=1,e.params={exposure:1,bloomStrength:2.5,bloomThreshold:0,bloomRadius:1},e.surfaces=[],e.pyramids=[],e.glowRingMap=new Map,e.labelGlowRingMap=new Map,e.clock=new E.Clock,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"setMeshGlow",value:function(e){var t=this;"Object3D"==e.type&&e.traverse((function(e){"Mesh"==e.type&&e.layers.enable(t.BLOOM_SCENE)})),"Mesh"==e.type&&e.layers.enable(this.BLOOM_SCENE)}},{key:"removeGlowRing",value:function(e){var t=this.getCore().dispose,n=this.glowRingMap.get(e);n&&(this.glowRingMap.delete(e),t(n))}},{key:"emptyGlowRings",value:function(){var e=this.getCore().dispose;this.glowRingMap.forEach((function(t,n){e(t)})),this.glowRingMap=new Map}},{key:"removeLabelGlowRing",value:function(e){var t=this.getCore().dispose,n=this.labelGlowRingMap.get(e);n&&(this.labelGlowRingMap.delete(e),t(n),this.core.needUpdate=!0)}},{key:"emptyLabelGlowRings",value:function(){var e=this.getCore().dispose;this.labelGlowRingMap.forEach((function(t,n){e(t)})),this.labelGlowRingMap=new Map,this.core.needUpdate=!0}},{key:"glowRingsRun",value:function(){var e=2*Math.PI,t=Math.PI/2,n=.5*this.clock.getElapsedTime();Math.sin(n-t),n/e-Math.floor(n/e)>.5&&(Math.floor(n/Math.PI),Math.PI),this.glowRingMap.forEach((function(e,t){e.rotation.z=n,e.material.transparent=!0})),this.labelGlowRingMap.forEach((function(e,t){e.rotation.z=n,e.material.transparent=!0}))}},{key:"signRun",value:function(){for(var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,t=arguments.length>3?arguments[3]:void 0,n=2*Math.PI,r=Math.PI/2,i=this.clock.getElapsedTime(),a=Math.sin(i-r),o=e/2*Math.sin(i-r)+e/2+t/2,s=i/n-Math.floor(i/n),l=s>.5?Math.floor(i/Math.PI)-i/Math.PI+1:1,u=0;u<this.surfaces.length;u++)this.surfaces[u].scale.set(s,s,s),this.surfaces[u].material.transparent=!0,this.surfaces[u].material.opacity=l;for(var c=0;c<this.pyramids.length;c++)this.pyramids[c].position.y=o,this.pyramids[c].rotation.y=a}},{key:"init",value:function(e){var t=this.getCore(),n=t.composer,r=t.finalComposer,i=t.scene,a=t.camera,o=t.width,s=t.height,l=t.FXAAShaderPass,u=(t.renderer,new E.RenderPass(i,a)),c=this.params.bloomThreshold,h=this.params.bloomStrength,d=this.params.bloomRadius;e&&(c=e.bloomThreshold,h=e.bloomStrength,d=e.bloomRadius);var p=new E.UnrealBloomPass(new E.Vector2(o,s),1.5,.4,.85);p.threshold=c,p.strength=h,p.radius=d,n.addPass(u),n.addPass(p),n.addPass(l);var f=new E.ShaderPass(new E.ShaderMaterial({uniforms:{baseTexture:{value:null},bloomTexture:{value:n.renderTarget2.texture}},vertexShader:"varying vec2 vUv;void main() {vUv = uv;gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );} ",fragmentShader:"uniform sampler2D baseTexture;uniform sampler2D bloomTexture;varying vec2 vUv;void main() {gl_FragColor = ( texture2D( baseTexture, vUv ) + vec4( 1.0 ) * texture2D( bloomTexture, vUv ) );}",defines:{}}),"baseTexture");f.needsSwap=!0,r.addPass(u),r.addPass(f),r.addPass(l)}},{key:"removeGlowSign",value:function(){for(var e=0,t=this.surfaces.length;e<t;e++)this.surfaces[e].geometry.dispose(),this.surfaces[e].material.dispose(),this.surfaces[e].parent.remove(this.surfaces[e]);for(var n=0,r=this.pyramids.length;n<r;n++)this.pyramids[n].geometry.dispose(),this.pyramids[n].material.dispose(),this.pyramids[n].parent.remove(this.pyramids[n]);this.surfaces=[],this.pyramids=[]}}])}(ke),hr=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).audioArray=[],e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"init",value:function(){var e=this.getCore().camera;void 0===this.loader&&(this.loader=new s.default.AudioLoader),void 0===this.listener&&(this.listener=new s.default.AudioListener,e.add(this.listener))}},{key:"getAudios",value:function(){return this.audioArray}},{key:"addAudio",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;this.init();var i=new s.default.Audio(this.listener);return this.loader.load(e,(function(e){i.setBuffer(e),i.setLoop(n),i.setVolume(r),t&&i.play()})),this.audioArray.push(i),i}},{key:"addPositionalAudio",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;this.init();var i=new s.default.PositionalAudio(this.listener);return this.loader.load(e,(function(e){i.setBuffer(e),i.setLoop(n),i.setVolume(r),t&&i.play()})),this.audioArray.push(i),i}},{key:"setAll",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;"play"===e?this.playAll(t):"pause"===e?this.pauseAll(t):"stop"===e&&this.stopAll(t)}},{key:"playAll",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=0;t<this.audioArray.length;t++){var n=this.audioArray[t];e?n.type===e&&n.pause():n.pause()}}},{key:"pauseAll",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=0;t<this.audioArray.length;t++){var n=this.audioArray[t];e?n.type===e&&n.stop():n.stop()}}},{key:"stopAll",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=0;t<this.audioArray.length;t++){var n=this.audioArray[t];e?n.type===e&&n.play():n.play()}}}])}(ke),dr=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).fileloader=new s.FileLoader,e.textureLoader=new s.TextureLoader,e.gltfLoader=new Dt,e.nodeName={cadModel:"cadModel",road:"road",ground:"ground",room:"room",window:"window",door:"door",wall:"wall",column:"column",equipment:"equipment"},e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"getCadModel",value:function(){var e=this,t=this.getCore().scene,n=null;return t.children.forEach((function(t){t.name==e.nodeName.cadModel&&(n=t)})),null===n&&((n=new s.Group).name=this.nodeName.cadModel,n.rotation.set(-Math.PI/2,0,0),t.add(n)),n}},{key:"getBuilding",value:function(e){var t=this.getCadModel(),n=null;return t.children.forEach((function(t){t.name===e&&(n=t)})),n}},{key:"getBuildingFloor",value:function(e,t){var n=t+"F",r=this.getBuilding(e);if(null===r)return null;var i=null;return r.children.forEach((function(e){e.name===n&&(i=e)})),i}},{key:"getBuildingFloorBlock",value:function(e,t,n){var r=this.getBuildingFloor(e,t);if(null===r)return null;var i=null;return r.children.forEach((function(e){e.name===n&&(i=e)})),i}},{key:"findModelByName",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.nodeName.cadModel;return this.getCadModel().traverse((function(t){if(t.name===e)return t})),null}},{key:"findModelById",value:function(e){return this.getCadModel().traverse((function(t){var n;if((null===(n=t.userData)||void 0===n?void 0:n.id)===e)return t})),null}},{key:"disposeCadModel",value:function(){var e=this.getCore(),t=e.dispose,n=e.render;t(this.getCadModel()),n()}},{key:"disposeBuilding",value:function(e){var t=this.getCore(),n=t.dispose,r=t.render;n(this.getBuilding(e)),r()}},{key:"disposeAllBuilding",value:function(e){var t=this.getCore(),n=t.dispose,r=t.render,i=this.getCadModel();if(null!==i){for(var a=this.nodeName.ground,o=this.nodeName.road,s=i.children.length-1;s>=0;s--){var l=i.children[s];l.name!==a&&l.name!==o&&n(l)}r()}}},{key:"loadTexture",value:function(e,t){var n=this.textureLoader.load(e);return n.wrapS=n.wrapT=1e3,n.repeat.set(t[0],t[1]),n}},{key:"loadJsonFile",value:function(e){var t=this;return this.fileloader.setResponseType("json"),new Promise((function(n,r){t.fileloader.load(e,(function(e){n(e)}),(function(e){}),(function(e){r(e)}))}))}},{key:"createExtrudeGeometry",value:function(e,t,n,r,i,a,o){var l=this.getCore().render,u=this.findModelByName("road");if(null==u){var c=this.getCadModel();(u=new s.Group).name="road",c.add(u)}var h=[];e.forEach((function(e){var t=new s.Vector2(e.x/1e3,e.y/1e3);h.push(t)}));var d=new s.Shape(h),p=null;null!==i&&(p=this.loadTexture(i,[a,o]));var f=new s.MeshStandardMaterial({color:r,map:p,metalness:.1,roughness:.9}),m=new s.ExtrudeGeometry(d,{steps:1,bevelEnabled:!1,depth:.02}),v=new s.Mesh(m,f);v.name=t;var g={type:n};return v.userData=g,u.add(v),l(),Promise.resolve(u)}},{key:"createRoad",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=this.getCore().render,o=this.findModelByName("road");if(null==o){var l=this.getCadModel();(o=new s.Group).name="road",l.add(o)}if(0!==e.length){var u=e[0].curveLoop,c=[];u.forEach((function(e){var t=new s.Vector2(e.x/1e3,e.y/1e3);c.push(t)}));for(var h=new s.Shape(c),d=function(){var t=e[p].curveLoop,n=[];t.forEach((function(e){var t=new s.Vector2(e.x/1e3,e.y/1e3);n.push(t)}));var r=new s.Path(n);h.holes.push(r)},p=1;p<e.length;p++)d();var f=null;null!==n&&(f=this.loadTexture(n,[r,i]));var m=new s.MeshStandardMaterial({color:t,map:f,metalness:.1,roughness:.9}),v=new s.ExtrudeGeometry(h,{steps:1,bevelEnabled:!1,depth:.03}),g=new s.Mesh(v,m);return g.name="road",g.userData={type:"road"},o.add(g),a(),Promise.resolve(o)}}},{key:"createGround",value:function(e,t,n,r,i){var a={repeat:[1,1],color:8421504,metalness:.3,roughness:.7},o=Object.assign(a,i),l=this.getCore(),u=l.render,c=(l.switchCameraOrientation,new s.Vector2(n-e,r-t).divideScalar(1e3)),h=new s.Vector2((e+n)/2,(r+t)/2).divideScalar(1e3),d=this.getCadModel(),p=null;o.texturePath&&((p=this.textureLoader.load(o.texturePath)).wrapS=p.wrapT=1e3,p.repeat.set(o.repeat[0],o.repeat[1]));var f=new s.PlaneGeometry(c.x,c.y),m=new s.MeshStandardMaterial({color:o.color,map:p,metalness:a.metalness,roughness:a.roughness}),v=new s.Mesh(f,m);return v.name="ground",v.position.set(h.x,h.y,-.02),d.add(v),u(),Promise.resolve(v)}},{key:"createExtrudes",value:function(e,t,n,r,i,a){var o=n.buildingName,l=n.level,u=n.bottom;if(e){var c=new s.MeshStandardMaterial({color:i,opacity:a,metalness:.2,roughness:.8});1!=a&&(c.transparent=!0);var h=this.getCadModel(),d=this.getBuilding(o);if(null===d){var p=t[0]/1e3,f=t[1]/1e3;(d=new s.Group).name=o,d.position.set(p,f,0),h.add(d)}var m=this.getBuildingFloor(o,l);null===m&&((m=new s.Group).name=l+"F",m.position.z=u/1e3,d.add(m));var v=new s.Group;v.name=r,m.add(v);for(var g=0;g<e.length;g++){var y=e[g],x=void 0;(x="cable"===y.subtype?this._createTube(y,n,c,r):this._createExtrude(y,n,c,r))&&v.add(x)}}}},{key:"_createExtrude",value:function(e,t,n,r){var i=e.points,a=t.bottom;if(null!=i&&null!=i){for(var o=0;o<i.length;o++){var l=i[o],u=l.x/1e3,c=l.y/1e3;i[o].x=u,i[o].y=c}var h=(e.top-e.bottom)/1e3;"room"!==r&&"equipment"!==r||(h=.05);var d={steps:1,bevelEnabled:!1,depth:h},p=new s.Shape(i),f=new s.ExtrudeGeometry(p,d),m=new s.Mesh(f,n);m.position.z=(e.bottom-a)/1e3;var v={id:e.id,type:e.type,subtype:void 0===e.subtype?null:e.subtype,height:h,rotate:e.rotate,overturn:void 0===e.overturn?null:e.overturn};return m.userData=v,m}}},{key:"_createTube",value:function(e,t,n,r){var i=e.points3D,a=t.bottom;if(null!=i&&null!=i){for(var o=[],l=0;l<i.length;l++){var u=i[l],c=u.x/1e3,h=u.y/1e3,d=u.z/1e3-1;isNaN(d)&&(d=(a+2300)/1e3);var p=new s.Vector3(c,h,d);o.push(p)}var f=new s.CatmullRomCurve3(o),m=new s.TubeGeometry(f,64,.1,8,!1),v=e.color,g=n.clone();g.color=new s.Color(v),g.needsUpdate=!0;var y=new s.Mesh(m,g),x={id:e.id,type:e.type,subtype:void 0===e.subtype?null:e.subtype,rotate:e.rotate,overturn:void 0===e.overturn?null:e.overturn};return y.userData=x,y}}},{key:"buildModel",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.loadJsonFile(e).then((function(e){for(var r=e.all,i=0;i<r.length;i++){var a=[0,0],o=r[i],s=o.building,l=null==o?void 0:o.name,u=null==o?void 0:o.position;a=u?[u.x,u.y]:[0,0];for(var c=0;c<s.length;c++){var h=s[c],d=h.blocks.column,p=h.blocks.wall,f=h.blocks.window,m=h.blocks.door,v=h.blocks.room,g=h.blocks.equipment,y=h.blocks.equipment2,x={buildingName:l,level:h.level,bottom:h.levelBottom,height:h.levelHeight};t.createExtrudes(d,a,x,"column",2899536,1),t.createExtrudes(p,a,x,"wall",13421772,1),t.createExtrudes(f,a,x,"window",4774907,.5),t.createExtrudes(m,a,x,"door",13849600,1),t.createExtrudes(v,a,x,"room",9807270,1),t.createExtrudes(g,a,x,"equipment",12597547,.1),t.createExtrudes(y,a,x,"equipment2",10773060,1)}}t.getCore().switchCameraOrientation("floor",n)}))}},{key:"buildModelWithJson",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=JSON.parse(e).all,r=0;r<n.length;r++){var i=[0,0],a=n[r],o=a.building,s=null==a?void 0:a.name,l=(null==a||a.rotate,null==a?void 0:a.position);l&&(i=[l.x,l.y]);for(var u=0;u<o.length;u++){var c=o[u],h=c.blocks.column,d=c.blocks.wall,p=c.blocks.window,f=c.blocks.door,m=c.blocks.room,v=c.blocks.equipment,g={buildingName:s,level:c.level,bottom:c.levelBottom,height:c.levelHeight};this.createExtrudes(h,i,g,"column",2899536,1),this.createExtrudes(d,i,g,"wall",13421772,1),this.createExtrudes(p,i,g,"window",4774907,.5),this.createExtrudes(f,i,g,"door",13849600,1),this.createExtrudes(m,i,g,"room",9807270,1),this.createExtrudes(v,i,g,"equipment",12597547,1)}}this.getCore().switchCameraOrientation("floor",t)}},{key:"replaceModel",value:function(e,t,n,r){var i=this.getCore().dispose,a=[];if(this.getBuilding(r).traverse((function(e){var r,i;e instanceof s.Mesh&&(null===(r=e.userData)||void 0===r?void 0:r.type)===t&&(null===(i=e.userData)||void 0===i?void 0:i.subtype)===n&&a.push(e)})),0!=a.length){var o=null,l=this.getBuilding(r);if(null!==l){o=l;for(var u=null,c=0;c<o.children.length;c++){var h=o.children[c];if("replaceModel"===h.name){u=h;break}}if(null===u){var d=o.position;(u=new s.Group).name="replaceModel",u.rotation.set(Math.PI/2,0,0),u.position.set(-1*d.x,-1*d.y,-1*d.z),o.add(u)}var p=e.lastIndexOf("/"),f=e.lastIndexOf("."),m=e.substring(p+1,f);this.gltfLoader.load(e,(function(e){e.scene.name=m;var r=e.scene;r.updateMatrixWorld(!0),r.traverse((function(e){if(e instanceof s.Mesh){var t=e.material;t.opacity<1&&(t.transparent=!0),"grid"===n&&(t.side=2),t.needsUpdate=!0}}));var o=(new s.Box3).setFromObject(r),l=new s.Vector3;l=o.getSize(l);var c=new s.Vector3;c=o.getCenter(c);var h=new s.Group;h.name="replace-"+m,u.add(h);for(var d=0;d<a.length;d++){var p=a[d],f=p.userData.rotate,v=(new s.Box3).setFromObject(p),g=new s.Vector3,y=g=v.getCenter(g),x=new s.Vector3;x=v.getSize(x);var b=Math.max(x.x,x.z)/l.x,M=x.y/l.y,w=Math.min(x.x,x.z)/l.z;n.includes("柜")&&90!==f&&(b=x.x/l.x,w=x.z/l.z),p.userData.overturn&&(b*=p.userData.overturn.y,w*=p.userData.overturn.x);var _=r.clone(!0);_.userData=Object.assign({},p.userData),"equipment"===t?_.scale.set(b,1,w):_.scale.set(b,M,w),_.rotation.set(0,f*Math.PI/180,0),"equipment"!==t&&x.z>x.x&&_.rotation.set(0,Math.PI/2,0),_.position.set(y.x,y.y,y.z),h.add(_)}for(var A=a.length-1;A>=0;A--){var C=a[A];i(C)}}),(function(e){}),(function(e){}))}}}},{key:"replaceModelsMatreial",value:function(e,t){for(var n=Object.assign({},{repeat:[1,1],color:16777215,metalness:.3,roughness:.7},t),r=this.getCore().render,i=this.loadTexture(n.texturePath,n.repeat),a=new s.MeshStandardMaterial({color:n.color,map:i,metalness:n.metalness,roughness:n.roughness}),o=0;o<e.length;o++){var l=e[o];l instanceof s.Mesh&&(l.material=a)}r()}},{key:"replaceModelsMatreialWithType",value:function(e,t,n,r){var i=Object.assign({repeat:[1,1],color:16777215,metalness:.3,roughness:.7},r),a=[];this.getBuilding(n).traverse((function(n){var r,i;n instanceof s.Mesh&&(null===(r=n.userData)||void 0===r?void 0:r.type)===e&&(null===(i=n.userData)||void 0===i?void 0:i.subtype)===t&&a.push(n)})),this.replaceModelsMatreial(a,i)}},{key:"hasCableTube",value:function(e,t,n){var r=this.getCore().dispose,i=this.getBuildingFloorBlock(e,t,n),a=[];if(i.traverse((function(e){var t;e instanceof s.Mesh&&"cable"===(null===(t=e.userData)||void 0===t?void 0:t.subtype)&&a.push(e)})),a.length>0){for(var o=a.length-1;o>=0;o--)r(a[o]);return!0}return!1}},{key:"addModelToBuilding",value:function(e,t,n,r,i){var a=Object.assign({position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},rotate:{x:0,y:0,z:0}},t),o=this.getBuildingFloorBlock(n,r,i);if(null===o)return null;this.gltfLoader.load(e,(function(e){var t=e.scene;t.updateMatrixWorld(!0),t.traverse((function(e){if(e instanceof s.Mesh){var t=e.material;t.opacity<1&&(t.transparent=!0),t.needsUpdate=!0}}));var n=new s.Vector3(a.position.x,a.position.y,a.position.z),r=new s.Vector3(a.scale.x,a.scale.y,a.scale.z),i=new s.Vector3(a.rotate.x,a.rotate.y,a.rotate.z),l=t.clone(!0);return l.scale.set(r.x,r.y,r.z),l.rotation.set(i.x,i.y,i.z),l.position.set(n.x,n.y,n.z),o.add(l),Promise.resolve(l)}),(function(){}),(function(e){return null}))}}])}(ke),pr=n(40),fr=n(924),mr=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t)).geometry=null,n.material=null,n.name=e&&e.name?e.name:"LineMesh",n.isRunning=!e||!e.isRunning||e.isRunning,n.isFlicking=!(!e||!e.isFlicking)&&e.isFlicking,n.renderOrder=e&&e.renderOrder?e.renderOrder:10,n.speed=e&&"speed"in e?e.speed:.01,n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"setSpeed",value:function(e){this.speed=e}},{key:"run",value:function(){this.isRunning&&(this.material.uniforms.time.value+=this.speed)}},{key:"setMaterial",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new pr.MeshLineMaterial({map:e&&e.map?e.map:null,useMap:!e||!e.useMap||e.useMap,repeat:e&&e.repeat?new s.Vector2(e.repeat.x,e.repeat.y):new s.Vector2(1,1),color:e&&e.color?new s.Color(e.color):new s.Color(16777215),opacity:e&&e.opacity?e.opacity:5,sizeAttenuation:!e||!e.sizeAttenuation||e.sizeAttenuation,lineWidth:e&&e.lineWidth?e.lineWidth:5,alphaTest:e&&e.alphaTest?e.alphaTest:0,resolution:new s.Vector2(window.innerWidth,window.innerHeight),transparent:!0,depthWrite:!0,side:s.DoubleSide});t&&(n.uniforms.time.value=Math.random()),this.material=n}},{key:"setGeometry",value:function(e,t){var n=new pr.MeshLine;n.setGeometry(e,t),this.geometry=n.geometry}},{key:"setPoints",value:function(e,t){var n=new pr.MeshLine;n.setPoints(e),this.geometry=n.geometry}}])}(s.Mesh),vr=function(e){null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(var t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());for(this.perm=[],t=0;t<512;t++)this.perm[t]=this.p[255&t];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};vr.prototype.dot=function(e,t,n){return e[0]*t+e[1]*n},vr.prototype.dot3=function(e,t,n,r){return e[0]*t+e[1]*n+e[2]*r},vr.prototype.dot4=function(e,t,n,r,i){return e[0]*t+e[1]*n+e[2]*r+e[3]*i},vr.prototype.noise=function(e,t){var n,r,i=(e+t)*(.5*(Math.sqrt(3)-1)),a=Math.floor(e+i),o=Math.floor(t+i),s=(3-Math.sqrt(3))/6,l=(a+o)*s,u=e-(a-l),c=t-(o-l);u>c?(n=1,r=0):(n=0,r=1);var h=u-n+s,d=c-r+s,p=u-1+2*s,f=c-1+2*s,m=255&a,v=255&o,g=this.perm[m+this.perm[v]]%12,y=this.perm[m+n+this.perm[v+r]]%12,x=this.perm[m+1+this.perm[v+1]]%12,b=.5-u*u-c*c,M=.5-h*h-d*d,w=.5-p*p-f*f;return 70*((b<0?0:(b*=b)*b*this.dot(this.grad3[g],u,c))+(M<0?0:(M*=M)*M*this.dot(this.grad3[y],h,d))+(w<0?0:(w*=w)*w*this.dot(this.grad3[x],p,f)))},vr.prototype.noise3d=function(e,t,n){var r,i,a,o,s,l,u=(e+t+n)*(1/3),c=Math.floor(e+u),h=Math.floor(t+u),d=Math.floor(n+u),p=1/6,f=(c+h+d)*p,m=e-(c-f),v=t-(h-f),g=n-(d-f);m>=v?v>=g?(r=1,i=0,a=0,o=1,s=1,l=0):m>=g?(r=1,i=0,a=0,o=1,s=0,l=1):(r=0,i=0,a=1,o=1,s=0,l=1):v<g?(r=0,i=0,a=1,o=0,s=1,l=1):m<g?(r=0,i=1,a=0,o=0,s=1,l=1):(r=0,i=1,a=0,o=1,s=1,l=0);var y=m-r+p,x=v-i+p,b=g-a+p,M=m-o+2*p,w=v-s+2*p,_=g-l+2*p,A=m-1+.5,C=v-1+.5,T=g-1+.5,S=255&c,E=255&h,L=255&d,P=this.perm[S+this.perm[E+this.perm[L]]]%12,B=this.perm[S+r+this.perm[E+i+this.perm[L+a]]]%12,D=this.perm[S+o+this.perm[E+s+this.perm[L+l]]]%12,k=this.perm[S+1+this.perm[E+1+this.perm[L+1]]]%12,R=.6-m*m-v*v-g*g,O=.6-y*y-x*x-b*b,I=.6-M*M-w*w-_*_,F=.6-A*A-C*C-T*T;return 32*((R<0?0:(R*=R)*R*this.dot3(this.grad3[P],m,v,g))+(O<0?0:(O*=O)*O*this.dot3(this.grad3[B],y,x,b))+(I<0?0:(I*=I)*I*this.dot3(this.grad3[D],M,w,_))+(F<0?0:(F*=F)*F*this.dot3(this.grad3[k],A,C,T)))},vr.prototype.noise4d=function(e,t,n,r){var i,a,o,s,l,u,c,h,d,p,f,m,v=this.grad4,g=this.simplex,y=this.perm,x=(Math.sqrt(5)-1)/4,b=(5-Math.sqrt(5))/20,M=(e+t+n+r)*x,w=Math.floor(e+M),_=Math.floor(t+M),A=Math.floor(n+M),C=Math.floor(r+M),T=(w+_+A+C)*b,S=e-(w-T),E=t-(_-T),L=n-(A-T),P=r-(C-T),B=(S>E?32:0)+(S>L?16:0)+(E>L?8:0)+(S>P?4:0)+(E>P?2:0)+(L>P?1:0),D=S-(i=g[B][0]>=3?1:0)+b,k=E-(a=g[B][1]>=3?1:0)+b,R=L-(o=g[B][2]>=3?1:0)+b,O=P-(s=g[B][3]>=3?1:0)+b,I=S-(l=g[B][0]>=2?1:0)+2*b,F=E-(u=g[B][1]>=2?1:0)+2*b,N=L-(c=g[B][2]>=2?1:0)+2*b,z=P-(h=g[B][3]>=2?1:0)+2*b,U=S-(d=g[B][0]>=1?1:0)+3*b,H=E-(p=g[B][1]>=1?1:0)+3*b,j=L-(f=g[B][2]>=1?1:0)+3*b,G=P-(m=g[B][3]>=1?1:0)+3*b,V=S-1+4*b,W=E-1+4*b,X=L-1+4*b,Y=P-1+4*b,J=255&w,Q=255&_,q=255&A,K=255&C,Z=y[J+y[Q+y[q+y[K]]]]%32,$=y[J+i+y[Q+a+y[q+o+y[K+s]]]]%32,ee=y[J+l+y[Q+u+y[q+c+y[K+h]]]]%32,te=y[J+d+y[Q+p+y[q+f+y[K+m]]]]%32,ne=y[J+1+y[Q+1+y[q+1+y[K+1]]]]%32,re=.6-S*S-E*E-L*L-P*P,ie=.6-D*D-k*k-R*R-O*O,ae=.6-I*I-F*F-N*N-z*z,oe=.6-U*U-H*H-j*j-G*G,se=.6-V*V-W*W-X*X-Y*Y;return 27*((re<0?0:(re*=re)*re*this.dot4(v[Z],S,E,L,P))+(ie<0?0:(ie*=ie)*ie*this.dot4(v[$],D,k,R,O))+(ae<0?0:(ae*=ae)*ae*this.dot4(v[ee],I,F,N,z))+(oe<0?0:(oe*=oe)*oe*this.dot4(v[te],U,H,j,G))+(se<0?0:(se*=se)*se*this.dot4(v[ne],V,W,X,Y)))};var gr=function(e){s.BufferGeometry.call(this),this.type="LightningStrike",e=e||{},this.init(gr.copyParameters(e,e)),this.createMesh()};gr.prototype=Object.create(s.BufferGeometry.prototype),gr.prototype.constructor=gr,gr.prototype.isLightningStrike=!0,gr.RAY_INITIALIZED=0,gr.RAY_UNBORN=1,gr.RAY_PROPAGATING=2,gr.RAY_STEADY=3,gr.RAY_VANISHING=4,gr.RAY_EXTINGUISHED=5,gr.COS30DEG=Math.cos(30*Math.PI/180),gr.SIN30DEG=Math.sin(30*Math.PI/180),gr.createRandomGenerator=function(){for(var e=2053,t=[],n=0;n<e;n++)t.push(Math.random());var r={currentSeed:0,random:function(){var n=t[r.currentSeed];return r.currentSeed=(r.currentSeed+1)%e,n},getSeed:function(){return r.currentSeed/e},setSeed:function(t){r.currentSeed=Math.floor(t*e)%e}};return r},gr.copyParameters=function(e,t){t=t||{};var n=function(n){return t===e?n:n.clone()};return(e=e||{}).sourceOffset=void 0!==t.sourceOffset?n(t.sourceOffset):new s.Vector3(0,100,0),e.destOffset=void 0!==t.destOffset?n(t.destOffset):new s.Vector3(0,0,0),e.timeScale=void 0!==t.timeScale?t.timeScale:1,e.roughness=void 0!==t.roughness?t.roughness:.9,e.straightness=void 0!==t.straightness?t.straightness:.7,e.up0=void 0!==t.up0?n(t.up0):new s.Vector3(0,0,1),e.up1=void 0!==t.up1?n(t.up1):new s.Vector3(0,0,1),e.radius0=void 0!==t.radius0?t.radius0:1,e.radius1=void 0!==t.radius1?t.radius1:1,e.radius0Factor=void 0!==t.radius0Factor?t.radius0Factor:.5,e.radius1Factor=void 0!==t.radius1Factor?t.radius1Factor:.2,e.minRadius=void 0!==t.minRadius?t.minRadius:.2,e.isEternal=void 0!==t.isEternal?t.isEternal:void 0===t.birthTime||void 0===t.deathTime,e.birthTime=t.birthTime,e.deathTime=t.deathTime,e.propagationTimeFactor=void 0!==t.propagationTimeFactor?t.propagationTimeFactor:.1,e.vanishingTimeFactor=void 0!==t.vanishingTimeFactor?t.vanishingTimeFactor:.9,e.subrayPeriod=void 0!==t.subrayPeriod?t.subrayPeriod:4,e.subrayDutyCycle=void 0!==t.subrayDutyCycle?t.subrayDutyCycle:.6,e.maxIterations=void 0!==t.maxIterations?t.maxIterations:9,e.isStatic=void 0!==t.isStatic&&t.isStatic,e.ramification=void 0!==t.ramification?t.ramification:5,e.maxSubrayRecursion=void 0!==t.maxSubrayRecursion?t.maxSubrayRecursion:3,e.recursionProbability=void 0!==t.recursionProbability?t.recursionProbability:.6,e.generateUVs=void 0!==t.generateUVs&&t.generateUVs,e.randomGenerator=t.randomGenerator,e.noiseSeed=t.noiseSeed,e.onDecideSubrayCreation=t.onDecideSubrayCreation,e.onSubrayCreation=t.onSubrayCreation,e},gr.prototype.update=function(e){this.isStatic||(this.rayParameters.isEternal||this.rayParameters.birthTime<=e&&e<=this.rayParameters.deathTime?(this.updateMesh(e),e<this.subrays[0].endPropagationTime?this.state=gr.RAY_PROPAGATING:e>this.subrays[0].beginVanishingTime?this.state=gr.RAY_VANISHING:this.state=gr.RAY_STEADY,this.visible=!0):(this.visible=!1,e<this.rayParameters.birthTime?this.state=gr.RAY_UNBORN:this.state=gr.RAY_EXTINGUISHED))},gr.prototype.init=function(e){this.rayParameters=e,this.maxIterations=void 0!==e.maxIterations?Math.floor(e.maxIterations):9,e.maxIterations=this.maxIterations,this.isStatic=void 0!==e.isStatic&&e.isStatic,e.isStatic=this.isStatic,this.ramification=void 0!==e.ramification?Math.floor(e.ramification):5,e.ramification=this.ramification,this.maxSubrayRecursion=void 0!==e.maxSubrayRecursion?Math.floor(e.maxSubrayRecursion):3,e.maxSubrayRecursion=this.maxSubrayRecursion,this.recursionProbability=void 0!==e.recursionProbability?e.recursionProbability:.6,e.recursionProbability=this.recursionProbability,this.generateUVs=void 0!==e.generateUVs&&e.generateUVs,e.generateUVs=this.generateUVs,void 0!==e.randomGenerator?(this.randomGenerator=e.randomGenerator,this.seedGenerator=e.randomGenerator,void 0!==e.noiseSeed&&this.seedGenerator.setSeed(e.noiseSeed)):(this.randomGenerator=gr.createRandomGenerator(),this.seedGenerator=Math),void 0!==e.onDecideSubrayCreation?this.onDecideSubrayCreation=e.onDecideSubrayCreation:(this.createDefaultSubrayCreationCallbacks(),void 0!==e.onSubrayCreation&&(this.onSubrayCreation=e.onSubrayCreation)),this.state=gr.RAY_INITIALIZED,this.maxSubrays=Math.ceil(1+Math.pow(this.ramification,Math.max(0,this.maxSubrayRecursion-1))),e.maxSubrays=this.maxSubrays,this.maxRaySegments=2*(1<<this.maxIterations),this.subrays=[];for(var t=0;t<this.maxSubrays;t++)this.subrays.push(this.createSubray());for(this.raySegments=[],t=0;t<this.maxRaySegments;t++)this.raySegments.push(this.createSegment());this.time=0,this.timeFraction=0,this.currentSegmentCallback=null,this.currentCreateTriangleVertices=this.generateUVs?this.createTriangleVerticesWithUVs:this.createTriangleVerticesWithoutUVs,this.numSubrays=0,this.currentSubray=null,this.currentSegmentIndex=0,this.isInitialSegment=!1,this.subrayProbability=0,this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.vertices=null,this.uvs=null,this.indices=null,this.positionAttribute=null,this.uvsAttribute=null,this.simplexX=new vr(this.seedGenerator),this.simplexY=new vr(this.seedGenerator),this.simplexZ=new vr(this.seedGenerator),this.forwards=new s.Vector3,this.forwardsFill=new s.Vector3,this.side=new s.Vector3,this.down=new s.Vector3,this.middlePos=new s.Vector3,this.middleLinPos=new s.Vector3,this.newPos=new s.Vector3,this.vPos=new s.Vector3,this.cross1=new s.Vector3},gr.prototype.createMesh=function(){var e=1<<this.maxIterations,t=3*(e+1)*this.maxSubrays,n=18*e*this.maxSubrays;this.vertices=new Float32Array(3*t),this.indices=new Uint32Array(n),this.generateUVs&&(this.uvs=new Float32Array(2*t)),this.fillMesh(0),this.setIndex(new s.Uint32BufferAttribute(this.indices,1)),this.positionAttribute=new s.Float32BufferAttribute(this.vertices,3),this.setAttribute("position",this.positionAttribute),this.generateUVs&&(this.uvsAttribute=new s.Float32BufferAttribute(new Float32Array(this.uvs),2),this.setAttribute("uv",this.uvsAttribute)),this.isStatic||(this.index.usage=s.DynamicDrawUsage,this.positionAttribute.usage=s.DynamicDrawUsage,this.generateUVs&&(this.uvsAttribute.usage=s.DynamicDrawUsage)),this.vertices=this.positionAttribute.array,this.indices=this.index.array,this.generateUVs&&(this.uvs=this.uvsAttribute.array)},gr.prototype.updateMesh=function(e){this.fillMesh(e),this.drawRange.count=this.currentIndex,this.index.needsUpdate=!0,this.positionAttribute.needsUpdate=!0,this.generateUVs&&(this.uvsAttribute.needsUpdate=!0)},gr.prototype.fillMesh=function(e){var t=this;this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.fractalRay(e,(function(n){var r=t.currentSubray;e<r.birthTime||(this.rayParameters.isEternal&&0==t.currentSubray.recursion?(t.createPrism(n),t.onDecideSubrayCreation(n,t)):e<r.endPropagationTime?t.timeFraction>=n.fraction0*r.propagationTimeFactor&&(t.createPrism(n),t.onDecideSubrayCreation(n,t)):e<r.beginVanishingTime?(t.createPrism(n),t.onDecideSubrayCreation(n,t)):(t.timeFraction<=r.vanishingTimeFactor+n.fraction1*(1-r.vanishingTimeFactor)&&t.createPrism(n),t.onDecideSubrayCreation(n,t)))}))},gr.prototype.addNewSubray=function(){return this.subrays[this.numSubrays++]},gr.prototype.initSubray=function(e,t){e.pos0.copy(t.sourceOffset),e.pos1.copy(t.destOffset),e.up0.copy(t.up0),e.up1.copy(t.up1),e.radius0=t.radius0,e.radius1=t.radius1,e.birthTime=t.birthTime,e.deathTime=t.deathTime,e.timeScale=t.timeScale,e.roughness=t.roughness,e.straightness=t.straightness,e.propagationTimeFactor=t.propagationTimeFactor,e.vanishingTimeFactor=t.vanishingTimeFactor,e.maxIterations=this.maxIterations,e.seed=void 0!==t.noiseSeed?t.noiseSeed:0,e.recursion=0},gr.prototype.fractalRay=function(e,t){this.time=e,this.currentSegmentCallback=t,this.numSubrays=0,this.initSubray(this.addNewSubray(),this.rayParameters);for(var n=0;n<this.numSubrays;n++){var r=this.subrays[n];this.currentSubray=r,this.randomGenerator.setSeed(r.seed),r.endPropagationTime=s.MathUtils.lerp(r.birthTime,r.deathTime,r.propagationTimeFactor),r.beginVanishingTime=s.MathUtils.lerp(r.deathTime,r.birthTime,1-r.vanishingTimeFactor);var i=this.randomGenerator.random;r.linPos0.set(i(),i(),i()).multiplyScalar(1e3),r.linPos1.set(i(),i(),i()).multiplyScalar(1e3),this.timeFraction=(e-r.birthTime)/(r.deathTime-r.birthTime),this.currentSegmentIndex=0,this.isInitialSegment=!0;var a=this.getNewSegment();a.iteration=0,a.pos0.copy(r.pos0),a.pos1.copy(r.pos1),a.linPos0.copy(r.linPos0),a.linPos1.copy(r.linPos1),a.up0.copy(r.up0),a.up1.copy(r.up1),a.radius0=r.radius0,a.radius1=r.radius1,a.fraction0=0,a.fraction1=1,a.positionVariationFactor=1-r.straightness,this.subrayProbability=this.ramification*Math.pow(this.recursionProbability,r.recursion)/(1<<r.maxIterations),this.fractalRayRecursive(a)}this.currentSegmentCallback=null,this.currentSubray=null},gr.prototype.fractalRayRecursive=function(e){if(e.iteration>=this.currentSubray.maxIterations)this.currentSegmentCallback(e);else{this.forwards.subVectors(e.pos1,e.pos0);var t=this.forwards.length();t<1e-6&&(this.forwards.set(0,0,.01),t=this.forwards.length());var n=.5*(e.radius0+e.radius1),r=.5*(e.fraction0+e.fraction1),i=this.time*this.currentSubray.timeScale*Math.pow(2,e.iteration);this.middlePos.lerpVectors(e.pos0,e.pos1,.5),this.middleLinPos.lerpVectors(e.linPos0,e.linPos1,.5);var a=this.middleLinPos;this.newPos.set(this.simplexX.noise4d(a.x,a.y,a.z,i),this.simplexY.noise4d(a.x,a.y,a.z,i),this.simplexZ.noise4d(a.x,a.y,a.z,i)),this.newPos.multiplyScalar(e.positionVariationFactor*t),this.newPos.add(this.middlePos);var o=this.getNewSegment();o.pos0.copy(e.pos0),o.pos1.copy(this.newPos),o.linPos0.copy(e.linPos0),o.linPos1.copy(this.middleLinPos),o.up0.copy(e.up0),o.up1.copy(e.up1),o.radius0=e.radius0,o.radius1=n,o.fraction0=e.fraction0,o.fraction1=r,o.positionVariationFactor=e.positionVariationFactor*this.currentSubray.roughness,o.iteration=e.iteration+1;var s=this.getNewSegment();s.pos0.copy(this.newPos),s.pos1.copy(e.pos1),s.linPos0.copy(this.middleLinPos),s.linPos1.copy(e.linPos1),this.cross1.crossVectors(e.up0,this.forwards.normalize()),s.up0.crossVectors(this.forwards,this.cross1).normalize(),s.up1.copy(e.up1),s.radius0=n,s.radius1=e.radius1,s.fraction0=r,s.fraction1=e.fraction1,s.positionVariationFactor=e.positionVariationFactor*this.currentSubray.roughness,s.iteration=e.iteration+1,this.fractalRayRecursive(o),this.fractalRayRecursive(s)}},gr.prototype.createPrism=function(e){this.forwardsFill.subVectors(e.pos1,e.pos0).normalize(),this.isInitialSegment&&(this.currentCreateTriangleVertices(e.pos0,e.up0,this.forwardsFill,e.radius0,0),this.isInitialSegment=!1),this.currentCreateTriangleVertices(e.pos1,e.up0,this.forwardsFill,e.radius1,e.fraction1),this.createPrismFaces()},gr.prototype.createTriangleVerticesWithoutUVs=function(e,t,n,r){this.side.crossVectors(t,n).multiplyScalar(r*gr.COS30DEG),this.down.copy(t).multiplyScalar(-r*gr.SIN30DEG);var i=this.vPos,a=this.vertices;i.copy(e).sub(this.side).add(this.down),a[this.currentCoordinate++]=i.x,a[this.currentCoordinate++]=i.y,a[this.currentCoordinate++]=i.z,i.copy(e).add(this.side).add(this.down),a[this.currentCoordinate++]=i.x,a[this.currentCoordinate++]=i.y,a[this.currentCoordinate++]=i.z,i.copy(t).multiplyScalar(r).add(e),a[this.currentCoordinate++]=i.x,a[this.currentCoordinate++]=i.y,a[this.currentCoordinate++]=i.z,this.currentVertex+=3},gr.prototype.createTriangleVerticesWithUVs=function(e,t,n,r,i){this.side.crossVectors(t,n).multiplyScalar(r*gr.COS30DEG),this.down.copy(t).multiplyScalar(-r*gr.SIN30DEG);var a=this.vPos,o=this.vertices,s=this.uvs;a.copy(e).sub(this.side).add(this.down),o[this.currentCoordinate++]=a.x,o[this.currentCoordinate++]=a.y,o[this.currentCoordinate++]=a.z,s[this.currentUVCoordinate++]=i,s[this.currentUVCoordinate++]=0,a.copy(e).add(this.side).add(this.down),o[this.currentCoordinate++]=a.x,o[this.currentCoordinate++]=a.y,o[this.currentCoordinate++]=a.z,s[this.currentUVCoordinate++]=i,s[this.currentUVCoordinate++]=.5,a.copy(t).multiplyScalar(r).add(e),o[this.currentCoordinate++]=a.x,o[this.currentCoordinate++]=a.y,o[this.currentCoordinate++]=a.z,s[this.currentUVCoordinate++]=i,s[this.currentUVCoordinate++]=1,this.currentVertex+=3},gr.prototype.createPrismFaces=function(e){var t=this.indices;e=this.currentVertex-6,t[this.currentIndex++]=e+1,t[this.currentIndex++]=e+2,t[this.currentIndex++]=e+5,t[this.currentIndex++]=e+1,t[this.currentIndex++]=e+5,t[this.currentIndex++]=e+4,t[this.currentIndex++]=e+0,t[this.currentIndex++]=e+1,t[this.currentIndex++]=e+4,t[this.currentIndex++]=e+0,t[this.currentIndex++]=e+4,t[this.currentIndex++]=e+3,t[this.currentIndex++]=e+2,t[this.currentIndex++]=e+0,t[this.currentIndex++]=e+3,t[this.currentIndex++]=e+2,t[this.currentIndex++]=e+3,t[this.currentIndex++]=e+5},gr.prototype.createDefaultSubrayCreationCallbacks=function(){var e=this.randomGenerator.random;this.onDecideSubrayCreation=function(t,n){var r=n.currentSubray,i=n.rayParameters.subrayPeriod,a=n.rayParameters.subrayDutyCycle,o=n.rayParameters.isEternal&&0==r.recursion?-e()*i:s.MathUtils.lerp(r.birthTime,r.endPropagationTime,t.fraction0)-e()*i,l=n.time-o,u=Math.floor(l/i),c=e()*(u+1),h=0;if(l%i<=a*i&&(h=n.subrayProbability),r.recursion<n.maxSubrayRecursion&&n.numSubrays<n.maxSubrays&&e()<h){var d=n.addNewSubray(),p=n.randomGenerator.getSeed();d.seed=c,n.randomGenerator.setSeed(c),d.recursion=r.recursion+1,d.maxIterations=Math.max(1,r.maxIterations-1),d.linPos0.set(e(),e(),e()).multiplyScalar(1e3),d.linPos1.set(e(),e(),e()).multiplyScalar(1e3),d.up0.copy(r.up0),d.up1.copy(r.up1),d.radius0=t.radius0*n.rayParameters.radius0Factor,d.radius1=Math.min(n.rayParameters.minRadius,t.radius1*n.rayParameters.radius1Factor),d.birthTime=o+u*i,d.deathTime=d.birthTime+i*a,n.rayParameters.isEternal||0!=r.recursion||(d.birthTime=Math.max(d.birthTime,r.birthTime),d.deathTime=Math.min(d.deathTime,r.deathTime)),d.timeScale=2*r.timeScale,d.roughness=r.roughness,d.straightness=r.straightness,d.propagationTimeFactor=r.propagationTimeFactor,d.vanishingTimeFactor=r.vanishingTimeFactor,n.onSubrayCreation(t,r,d,n),n.randomGenerator.setSeed(p)}};var t=new s.Vector3,n=new s.Vector3,r=new s.Vector3,i=new s.Vector3;this.onSubrayCreation=function(e,t,n,r){r.subrayCylinderPosition(e,t,n,.5,.6,.2)},this.subrayConePosition=function(a,o,s,l,u,c){s.pos0.copy(a.pos0),t.subVectors(o.pos1,o.pos0),n.copy(t).normalize(),t.multiplyScalar(a.fraction0+(1-a.fraction0)*(e()*l));var h=t.length();r.crossVectors(o.up0,n);var d=2*Math.PI*e();r.multiplyScalar(Math.cos(d)),i.copy(o.up0).multiplyScalar(Math.sin(d)),s.pos1.copy(r).add(i).multiplyScalar(h*u*(c+e()*(1-c))).add(t).add(o.pos0)},this.subrayCylinderPosition=function(a,o,s,l,u,c){s.pos0.copy(a.pos0),t.subVectors(o.pos1,o.pos0),n.copy(t).normalize(),t.multiplyScalar(a.fraction0+(1-a.fraction0)*((2*e()-1)*l));var h=t.length();r.crossVectors(o.up0,n);var d=2*Math.PI*e();r.multiplyScalar(Math.cos(d)),i.copy(o.up0).multiplyScalar(Math.sin(d)),s.pos1.copy(r).add(i).multiplyScalar(h*u*(c+e()*(1-c))).add(t).add(o.pos0)}},gr.prototype.createSubray=function(){return{seed:0,maxIterations:0,recursion:0,pos0:new s.Vector3,pos1:new s.Vector3,linPos0:new s.Vector3,linPos1:new s.Vector3,up0:new s.Vector3,up1:new s.Vector3,radius0:0,radius1:0,birthTime:0,deathTime:0,timeScale:0,roughness:0,straightness:0,propagationTimeFactor:0,vanishingTimeFactor:0,endPropagationTime:0,beginVanishingTime:0}},gr.prototype.createSegment=function(){return{iteration:0,pos0:new s.Vector3,pos1:new s.Vector3,linPos0:new s.Vector3,linPos1:new s.Vector3,up0:new s.Vector3,up1:new s.Vector3,radius0:0,radius1:0,fraction0:0,fraction1:0,positionVariationFactor:0}},gr.prototype.getNewSegment=function(){return this.raySegments[this.currentSegmentIndex++]},gr.prototype.copy=function(e){return s.BufferGeometry.prototype.copy.call(this,e),this.init(gr.copyParameters({},e.rayParameters)),this},gr.prototype.clone=function(){return new this.constructor(gr.copyParameters({},this.rayParameters))};var yr=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).textureLoader=new s.TextureLoader,e.textureMap=new Map,e.lineMeshs=new Array,e.lightnings=new Array,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"getLineMeshs",value:function(){return this.lineMeshs}},{key:"removeLineMeshs",value:function(){for(var e=0,t=this.lineMeshs.length;e<t;e++)this.lineMeshs[e].geometry.dispose(),this.lineMeshs[e].material.dispose(),this.lineMeshs[e].parent.remove(this.lineMeshs[e]);this.lineMeshs=[],this.core.needUpdate=!0}},{key:"addMeshLines",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=this.getCore().scene,a=this.getAndCheckTexture(t.url);e.forEach((function(e){var o=new pr.MeshLineMaterial({map:a,useMap:!t||!("useMap"in t)||t.useMap,color:t&&t.color?new s.Color(t.color):new s.Color(16777215),opacity:t&&t.opacity?t.opacity:5,resolution:new s.Vector2(window.innerWidth,window.innerHeight),sizeAttenuation:!t||!("sizeAttenuation"in t)||t.sizeAttenuation,lineWidth:t&&t.lineWidth?t.lineWidth:10,transparent:!0,repeat:t&&t.repeat?new s.Vector2(t.repeat.x,t.repeat.y):new s.Vector2(1,1),depthWrite:!0,side:s.DoubleSide,alphaTest:t&&t.alphaTest?t.alphaTest:0}),l=[];e.forEach((function(e){var t=new s.Vector3(e.x,e.y,e.z);l.push(t)}));var u=new mr;if(1===r){var c=new s.CatmullRomCurve3(l);u.setPoints(c.getPoints(50))}else if(2===r&&4===l.length){var h=new s.CubicBezierCurve3(l[0],l[1],l[2],l[3]),d=h.getLength(),p=Math.floor(d/.5);u.setPoints(h.getPoints(p))}else u.setPoints(l);t&&t.isRandom&&(o.uniforms.time.value=Math.random()),u.material=o,t&&"speed"in t&&u.setSpeed(t.speed),t&&t.renderOrder&&(u.renderOrder=t.renderOrder),n.lineMeshs.push(u),i.add(u),n.core.needUpdate=!0}))}},{key:"addMigrationLine",value:function(e,t,n,r){var i=this.getCore().scene,a=this.getAndCheckTexture(r.url),o=new pr.MeshLineMaterial({map:a,useMap:!r||!("useMap"in r)||r.useMap,color:r&&r.color?new s.Color(r.color):new s.Color(16777215),opacity:r&&r.opacity?r.opacity:5,resolution:new s.Vector2(window.innerWidth,window.innerHeight),sizeAttenuation:!r||!("sizeAttenuation"in r)||r.sizeAttenuation,lineWidth:r&&r.lineWidth?r.lineWidth:10,transparent:!0,repeat:r&&r.repeat?new s.Vector2(r.repeat.x,r.repeat.y):new s.Vector2(1,1),depthWrite:!0,side:s.DoubleSide,alphaTest:r&&r.alphaTest?r.alphaTest:0}),l=new mr,u=new s.QuadraticBezierCurve3(e,t,n);l.setPoints(u.getPoints(50)),r&&r.isRandom&&(o.uniforms.time.value=Math.random()),l.material=o,r&&"speed"in r&&l.setSpeed(r.speed),r&&r.renderOrder&&(l.renderOrder=r.renderOrder),this.lineMeshs.push(l),i.add(l),this.core.needUpdate=!0}},{key:"addClipMeshLine",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=this.getCore().scene,a=this.getAndCheckTexture(t.url),o=new E.Object3D;return e.forEach((function(e){var i=new fr.MeshLineMaterialTest({map:a,useMap:!t||!("useMap"in t)||t.useMap,color:t&&t.color?new s.Color(t.color):new s.Color(16777215),opacity:t&&t.opacity?t.opacity:5,resolution:new s.Vector2(window.innerWidth,window.innerHeight),sizeAttenuation:!t||!("sizeAttenuation"in t)||t.sizeAttenuation,lineWidth:t&&t.lineWidth?t.lineWidth:10,lineHeight:t&&"lineHeight"in t?t.lineHeight:1/0,highHeight:t&&"highHeight"in t?t.highHeight:-1/0,transparent:!0,repeat:t&&t.repeat?new s.Vector2(t.repeat.x,t.repeat.y):new s.Vector2(1,1),depthWrite:!0,side:s.DoubleSide,alphaTest:t&&t.alphaTest?t.alphaTest:0}),l=[];e.forEach((function(e){var t=new s.Vector3(e.x,e.y,e.z);l.push(t)}));var u=new mr;if(1===r){var c=new s.CatmullRomCurve3(l);u.setPoints(c.getPoints(50))}else if(2===r&&4===l.length){var h=new s.CubicBezierCurve3(l[0],l[1],l[2],l[3]),d=h.getLength(),p=Math.floor(d/.5);u.setPoints(h.getPoints(p))}else u.setPoints(l);t&&t.isRandom&&(i.uniforms.time.value=Math.random()),u.material=i,t&&"speed"in t&&u.setSpeed(t.speed),t&&t.renderOrder&&(u.renderOrder=t.renderOrder),n.lineMeshs.push(u),o.add(u)})),i.add(o),this.core.needUpdate=!0,o}},{key:"addMeshLines2",value:function(e,t){for(var n=this.getCore().scene,r=this.getAndCheckTexture(t.url),i=(new pr.MeshLineMaterial({map:r,useMap:!t||!("useMap"in t)||t.useMap,color:t&&t.color?new s.Color(t.color):new s.Color(16777215),opacity:t&&t.opacity?t.opacity:5,resolution:new s.Vector2(window.innerWidth,window.innerHeight),sizeAttenuation:!t||!("sizeAttenuation"in t)||t.sizeAttenuation,lineWidth:t&&t.lineWidth?t.lineWidth:10,transparent:!0,repeat:t&&t.repeat?new s.Vector2(t.repeat.x,t.repeat.y):new s.Vector2(1,1),depthWrite:!0,side:s.DoubleSide,alphaTest:t&&t.alphaTest?t.alphaTest:0})),a=e.length,o=new E.CurvePath,l=0;l<a-1;l++){var u=new E.LineCurve3(e[l],e[l+1]);o.curves.push(u)}var c=new mr;c.material=i,c.setPoints(o.getPoints(200)),t&&t.speed&&c.setSpeed(t.speed),this.lineMeshs.push(c),n.add(c),this.core.needUpdate=!0}},{key:"addMeshLinesByJsonData",value:function(e,t){var n=this.getCore().scene,r=this.lineMeshs,i=(new s.TextureLoader).load(t.url);i.wrapS=i.wrapT=s.RepeatWrapping;var a=new pr.MeshLineMaterial({map:i,useMap:!t||!("useMap"in t)||t.useMap,color:t&&t.color?new s.Color(t.color):new s.Color(16777215),opacity:t&&t.opacity?t.opacity:5,resolution:new s.Vector2(window.innerWidth,window.innerHeight),sizeAttenuation:!t||!("sizeAttenuation"in t)||t.sizeAttenuation,lineWidth:t&&t.lineWidth?t.lineWidth:10,transparent:!0,repeat:t&&t.repeat?new s.Vector2(t.repeat.x,t.repeat.y):new s.Vector2(1,1),depthWrite:!0,side:s.DoubleSide}),o=new s.FileLoader;o.setResponseType("json"),o.load(e,(function(e){var t=this;e.forEach((function(e){var i=[];e.forEach((function(e){var t=new s.Vector3(e.x,e.y,e.z);i.push(t)}));var o=new s.CatmullRomCurve3(i),l=(new s.BufferGeometry).setFromPoints(o.getPoints(50)),u=new mr;u.setGeometry(l),u.material=a,r.push(u),n.add(u),t.core.needUpdate=!0}))}),(function(e){}),(function(e){}))}},{key:"addCircleLines",value:function(e,t,n){var r=this,i=this.getCore().scene,a=this.getAndCheckTexture(n.url),o=new pr.MeshLineMaterial({map:a,useMap:!n||!("useMap"in n)||n.useMap,color:n&&n.color?new s.Color(n.color):new s.Color(16777215),opacity:n&&n.opacity?n.opacity:5,resolution:new s.Vector2(window.innerWidth,window.innerHeight),sizeAttenuation:!n||!("sizeAttenuation"in n)||n.sizeAttenuation,lineWidth:n&&n.lineWidth?n.lineWidth:10,transparent:!0,repeat:n&&n.repeat?new s.Vector2(n.repeat.x,n.repeat.y):new s.Vector2(1,1),depthWrite:!0,side:s.DoubleSide});e.forEach((function(e){for(var n=[],a=t,l=0;l<=50;l++){var u=2*Math.PI/50*l,c=a*Math.sin(u)+e.x,h=a*Math.cos(u)+e.z;n.push(new s.Vector3(c,e.y,h))}var d=(new s.BufferGeometry).setFromPoints(n),p=new mr;p.setGeometry(d),p.material=o,r.lineMeshs.push(p),i.add(p)})),this.core.needUpdate=!0}},{key:"addCircleLinesByJsonData",value:function(e,t,n){var r=this.getCore().scene,i=this.lineMeshs,a=this.getAndCheckTexture(n.url),o=new pr.MeshLineMaterial({map:a,useMap:!n||!("useMap"in n)||n.useMap,color:n&&n.color?new s.Color(n.color):new s.Color(16777215),opacity:n&&n.opacity?n.opacity:5,resolution:new s.Vector2(window.innerWidth,window.innerHeight),sizeAttenuation:!n||!("sizeAttenuation"in n)||n.sizeAttenuation,lineWidth:n&&n.lineWidth?n.lineWidth:10,transparent:!0,repeat:n&&n.repeat?new s.Vector2(n.repeat.x,n.repeat.y):new s.Vector2(1,1),depthWrite:!0,side:s.DoubleSide}),l=new s.FileLoader;l.setResponseType("json"),l.load(e,(function(e){var n=this;e.forEach((function(e){for(var a=[],l=t,u=0;u<=50;u++){var c=2*Math.PI/50*u,h=l*Math.sin(c)+e.x,d=l*Math.cos(c)+e.z;a.push(new s.Vector3(h,e.y,d))}var p=(new s.BufferGeometry).setFromPoints(a),f=new mr;f.setGeometry(p),f.material=o,i.push(f),r.add(f),n.core.needUpdate=!0}))}),(function(e){}),(function(e){}))}},{key:"getAndCheckTexture",value:function(e){var t;return e&&((t=this.textureMap.has(e)?this.textureMap.get(e):this.textureLoader.load(e)).wrapS=t.wrapT=s.RepeatWrapping),t}},{key:"run",value:function(){for(var e=0,t=this.lineMeshs.length;e<t;e++)this.lineMeshs[e].run()}},{key:"setRunAll",value:function(){for(var e=0;e<this.lineMeshs.length;e++){var t=this.lineMeshs[e];t.isRunning=!0,t.isFlicking=!0}}},{key:"setStopAll",value:function(){for(var e=0;e<this.lineMeshs.length;e++){var t=this.lineMeshs[e];t.isRunning=!1,t.isFlicking=!1}}},{key:"addLightning",value:function(e,t,n){var r=this.getCore(),i=r.scene,a=r.lightningStrikes,o={sourceOffset:new E.Vector3(e.x,e.y,e.z),destOffset:new E.Vector3(t.x,t.y,t.z),radius0:n.radius0?n.radius0:.1,radius1:n.radius1?n.radius1:.1,minRadius:.001,maxIterations:7,isEternal:!0,timeScale:n.timeScale?n.timeScale:.7,propagationTimeFactor:.05,vanishingTimeFactor:.95,subrayPeriod:3.5,subrayDutyCycle:.6,maxSubrayRecursion:3,ramification:n.ramification?n.ramification:7,recursionProbability:.6,roughness:.85,straightness:.6},s=new gr(o);a.push(s);var l=new E.Mesh(s,new E.MeshBasicMaterial({color:new E.Color(11599871)}));i.add(l),this.core.needUpdate=!0}}])}(ke),xr=n(590),br=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).textureLoader=new s.TextureLoader,e.textureMap=new Map,e.lineMeshs=new Map,e.instancePathTubeLines=new Map,e.pathTubeLines=new Map,e.path3D=new xr.Path3D,e.playing=!1,e.progress=0,e.geometry=new E.PathGeometry,e.curve=null,e.curveMap=new Map,e.trackModel=null,e.velocity=.001,e.isPlayTrack=!1,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"removeLineMeshs",value:function(){this.lineMeshs.forEach((function(e,t){e.userData.tween&&(e.userData.tween.stop(),e.userData.tween=null),e.geometry.dispose(),e.material.dispose(),e.parent.remove(e)})),this.lineMeshs=new Map,this.core.needUpdate=!0}},{key:"removeByName",value:function(e){if(e){var t=this.getPathTubeLine(e);t&&(t.userData.tween&&(t.userData.tween.stop(),t.userData.tween=null),t.userData.opacityTween&&(t.userData.opacityTween.stop(),t.userData.opacityTween=null),t.geometry.dispose(),t.material.dispose(),t.parent.remove(t),this.lineMeshs.delete(e))}else this.lineMeshs.forEach((function(e){e&&(e.userData.tween&&(e.userData.tween.stop(),e.userData.tween=null),e.userData.opacityTween&&(e.userData.opacityTween.stop(),e.userData.opacityTween=null),e.geometry.dispose(),e.material.dispose(),e.parent.remove(e))})),this.lineMeshs.clear();this.core.needUpdate=!0}},{key:"run",value:function(){this.lineMeshs.forEach((function(e,t){e.material.map.offset.x-=e.userData.reverse?-1*e.userData.scrollSpeed:e.userData.scrollSpeed,e.userData.playing&&(e.userData.progress<1?e.userData.progress+=e.userData.playSpeed/e.geometry.pathPointList.distance():e.userData.progress=0,e.geometry.update(e.userData.reverse?e.geometry.pathPointList2:e.geometry.pathPointList,{width:e.userData.width,progress:e.userData.progress,arrow:e.userData.arrow}))}))}},{key:"addPathLine",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{width:.2,progress:1,cornerRadius:.3,close:!1,arrow:!1,color:16777215,repeat:1/24,autoRepeat:!1,scrollSpeed:.03,playing:!1,playSpeed:.1,highAlphaGradient:!1},i=this.core,a=i.renderer,o=i.scene,l=[],u=-1/0,c=1/0;t.forEach((function(e){l.push(new E.Vector3(e.x,e.y,e.z)),u=Math.max(u,e.y),c=Math.min(c,e.y)}));var h=new E.PathPointList,d=new E.Vector3(0,1,0);h.set(l,r.cornerRadius,10,d,r.close);var p=(new s.TextureLoader).load(n,(function(e){e.wrapS=e.wrapT=E.RepeatWrapping,e.anisotropy=a.capabilities.getMaxAnisotropy()}));p.repeat.x=r.autoRepeat?r.repeat*h.distance():r.repeat;var f=new E.MeshBasicMaterial({color:r.color,depthWrite:!0,transparent:!0,side:E.DoubleSide,map:p});r.highAlphaGradient&&(f.onBeforeCompile=function(e){e.uniforms.maxHeight={value:u,type:"f"},e.uniforms.minHeight={value:c,type:"f"};var t=["uniform float maxHeight;","uniform float minHeight;","varying float vOpacity;","#include <common>"].join("\n"),n=["#include <begin_vertex>","vec4 w = modelMatrix * vec4(position, 1.0);","vOpacity = (w.y - minHeight)/(maxHeight-minHeight);"].join("\n");e.vertexShader=e.vertexShader.replace("#include <common>",t).replace("#include <begin_vertex>",n);var r=["varying float vOpacity;","#include <common>"].join("\n"),i=["vec4 diffuseColor = vec4( diffuse, opacity*vOpacity );"].join("\n");e.fragmentShader=e.fragmentShader.replace("#include <common>",r).replace("vec4 diffuseColor = vec4( diffuse, opacity );",i)});var m=new E.PathGeometry;m.update(h,{width:r.width,progress:r.progress,arrow:r.arrow}),m.pathPointList=h;var v=new E.Mesh(m,f);return v.name=e,v.userData.scrollSpeed=r.scrollSpeed,v.userData.playing=r.playing,v.userData.playSpeed=r.playSpeed,v.userData.width=r.width,v.userData.progress=r.progress,v.userData.arrow=r.arrow,v.renderOrder=30,v.frustumCulled=!1,v.layers.enable(5),this.lineMeshs.set(e,v),o.add(v),this.core.needUpdate=!0,v}},{key:"addPathLine2",value:function(e,t){var n=this.core.scene;e=new E.Vector3(e.y,e.z,e.x),t=new E.Vector3(t.y,t.z,t.x);var r=e.distanceTo(t),i=new E.CylinderGeometry(5,5,r,64),a=new E.Vector3;a.addVectors(e,t).divideScalar(2);var o=new E.Vector3(0,1,0),s=new E.Quaternion;s.setFromUnitVectors(o,t.clone().sub(e).normalize());var l=new E.Matrix4;l.makeRotationFromQuaternion(s),i.applyMatrix4(l),i.translate(a.x,a.y,a.z);var u=new E.MeshBasicMaterial({color:16711680}),c=new E.Mesh(i,u);n.add(c),this.core.needUpdate=!0}},{key:"addPathLine3",value:function(e){var t=this.core.scene,n=[];e.forEach((function(e){n.push(new E.Vector3(e.y,e.z,e.x))}));var r=new E.CatmullRomCurve3(n),i=new E.TubeGeometry(r,10*n.length,5,8,!1),a=new E.MeshBasicMaterial({color:657930}),o=new E.Mesh(i,a);t.add(o),this.core.needUpdate=!0}},{key:"updatePathLine",value:function(e,t){e.userData.progress=t,e.geometry.update(e.geometry.pathPointList,{width:e.userData.width,progress:e.userData.progress,arrow:e.userData.arrow}),this.core.needUpdate=!0}},{key:"addPathTubeLine",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{radius:.2,radialSegments:8,progress:1,cornerRadius:.3,color:16777215,repeat:1,repeatY:1,autoRepeat:!1,scrollSpeed:.03,playing:!1,playSpeed:.1,reverse:!1,visible:!0,isStandardMaterial:!1};if(!this.lineMeshs.get(e)){var i=this.core,a=i.renderer,o=i.scene,l=[];t.forEach((function(e){l.push(new E.Vector3(e.x,e.y,e.z))}));var u=new E.PathPointList,c=new E.PathPointList;u.set(l,r.cornerRadius,10,!1),c.set(l.reverse(),r.cornerRadius,10,!1);var h=(new s.TextureLoader).load(n,(function(e){e.wrapS=e.wrapT=E.RepeatWrapping,e.anisotropy=a.capabilities.getMaxAnisotropy()}));h.repeat.x=r.autoRepeat?r.repeat*u.distance():r.repeat,h.repeat.y=r.repeatY?r.repeatY:1;var d=null;d=r&&r.isStandardMaterial?new E.MeshStandardMaterial({color:r.color,roughness:.7,metalness:.3,depthWrite:!0,transparent:!0,map:h}):new E.MeshBasicMaterial({color:r.color,depthWrite:!0,transparent:!0,map:h});var p=new E.PathTubeGeometry({pathPointList:r.reverse?c:u,options:{radius:r.radius,radialSegments:r.radialSegments,progress:r.progress},usage:E.DynamicDrawUsage});p.pathPointList=u,p.pathPointList2=c;var f=new E.Mesh(p,d);return f.name=e,f.userData.reverse=r.reverse,f.userData.scrollSpeed=r.scrollSpeed,f.userData.playing=r.playing,f.userData.playSpeed=r.playSpeed,f.userData.radius=r.radius,f.userData.progress=r.progress,f.userData.radialSegments=r.radialSegments,f.renderOrder=30,f.frustumCulled=!1,f.layers.enable(5),"visible"in r&&(f.visible=r.visible),this.lineMeshs.set(e,f),o.add(f),this.core.needUpdate=!0,f}}},{key:"addPathTubeLines",value:function(e,t,n,r){if(!this.pathTubeLines.get(e)){var i=this.getCore().scene,a=new s.Object3D;a.name=e;var o=new Map;t.forEach((function(e){var t=JSON.stringify(e.positions);o.get(t)||o.set(t,[]),o.get(t).push(e)}));var l={},u=!1;r&&r.scrollSpeed&&(u=!0);var c=[],h=[];return o.forEach((function(e,t){var i,o,d=JSON.parse(t),p=[];d.forEach((function(e){p.push(new E.Vector3(e.x,e.y,e.z))}));var f=new E.PathPointList;f.set(p,r.cornerRadius,10,!1);var m=(new s.TextureLoader).load(n,(function(e){e.wrapS=e.wrapT=E.RepeatWrapping}));m.repeat.x=r.autoRepeat?r.repeat*f.distance():r.repeat,m.repeat.y=r.repeatY?r.repeatY:1;var v=null;v=r&&r.isStandardMaterial?new E.MeshStandardMaterial({color:16777215,metalness:.3,roughness:.7,depthWrite:!0,transparent:!0,map:m}):new E.MeshBasicMaterial({color:16777215,metalness:.3,roughness:.7,depthWrite:!0,transparent:!0,map:m});var g=["#include <lights_fragment_begin2>"].join("\n"),y=new E.PathTubeGeometry({pathPointList:f,options:{radius:null!==(i=r.radius)&&void 0!==i?i:.01,radialSegments:16,progress:1},usage:E.DynamicDrawUsage}),x=new E.InstancedMesh(y,v,e.length),b=["attribute float customOpacity;","attribute float offsetX;","varying float vcustomOpacity;","varying float voffsetX;","#include <common>"].join("\n"),M=["#include <begin_vertex>","voffsetX = offsetX;","vcustomOpacity = 1.0;","if (customOpacity>=0.0) {","vcustomOpacity = customOpacity;","};"].join("\n"),w=["varying float vcustomOpacity;","varying float voffsetX;","#include <common>"].join("\n"),_=["vec4 diffuseColor = vec4( diffuse, opacity*vcustomOpacity );"].join("\n");["vUv.x = vUv.x + voffsetX;","vec4 texelColor = texture2D( map, vUv );"].join("\n"),v.onBeforeCompile=function(e){e.vertexShader=e.vertexShader.replace("#include <common>",b).replace("#include <begin_vertex>",M),e.fragmentShader=e.fragmentShader.replace("#include <common>",w).replace("#include <lights_fragment_begin>",g).replace("vec4 diffuseColor = vec4( diffuse, opacity );",_).replace("#include <map_fragment>","#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vec2(vUv.x + voffsetX,vUv.y) );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif")},x.layers.enable(5),x.userData.matrix=[],x.userData.object=[];for(var A=[],C=[],T=0;T<e.length;T++){l[e[T].id]={instanceMesh:x,instanceId:T},u&&e[T].scroll&&c.push({instanceMesh:x,instanceId:T}),e[T].flash&&h.push({instanceMesh:x,instanceId:T});var S=new E.Matrix4,L=new E.Vector3(e[T].position.x,e[T].position.y,e[T].position.z),P=new E.Euler(e[T].rotation.x,e[T].rotation.y,e[T].rotation.z);S.compose(L,(new E.Quaternion).setFromEuler(P),new E.Vector3(1,1,1)),x.userData.matrix.push(S),x.userData.object.push(e[T].userData),"visible"in e[T]&&!e[T].visible?x.setMatrixAt(T,(new E.Matrix4).makeScale(1e-7,1e-7,1e-7)):x.setMatrixAt(T,S),x.setColorAt(T,new E.Color(null!==(o=e[T].color)&&void 0!==o?o:16711680)),A.push(1),C.push(0)}x.geometry.setAttribute("customOpacity",new E.InstancedBufferAttribute(new Float32Array(A),1)),x.geometry.setAttribute("offsetX",new E.InstancedBufferAttribute(new Float32Array(C),1)),a.add(x)})),a.userData.scrollList=c,a.userData.flashList=h,a.userData.idMap=l,i.add(a),this.pathTubeLines.set(e,a),this.core.needUpdate=!0,a}}},{key:"updatePathTubeLines",value:function(e,t){var n=this.pathTubeLines.get(e);if(n){n.userData.scrollList.forEach((function(e){e.instanceMesh.geometry.attributes.offsetX.setX(e.instanceId,0),e.instanceMesh.geometry.attributes.offsetX.needsUpdate=!0})),n.userData.flashList.forEach((function(e){e.instanceMesh.geometry.attributes.customOpacity.setX(e.instanceId,1),e.instanceMesh.geometry.attributes.customOpacity.needsUpdate=!0}));var r=[],i=[];return t.forEach((function(e){var t,a=e.id;if(a in n.userData.idMap){var o=n.userData.idMap[a].instanceMesh,s=n.userData.idMap[a].instanceId;if("visible"in e)if(e.visible)o.setMatrixAt(s,o.userData.matrix[s]);else{var l=(new E.Matrix4).makeScale(1e-7,1e-7,1e-7);o.setMatrixAt(s,o.userData.matrix[s].clone().multiply(l))}"color"in e&&o.setColorAt(s,new E.Color(null!==(t=e.color)&&void 0!==t?t:16711680)),e.scroll&&r.push({instanceMesh:o,instanceId:s}),e.flash&&i.push({instanceMesh:o,instanceId:s})}})),n.children.forEach((function(e){e.instanceMatrix.needsUpdate=!0,e.instanceColor.needsUpdate=!0})),n.userData.scrollList=r,n.userData.flashList=i,this.core.needUpdate=!0,n}}},{key:"showPathTubeLines",value:function(e,t){var n=this.pathTubeLines.get(e);n&&(t.forEach((function(e){var t=e.id;if(t in n.userData.idMap){var r=n.userData.idMap[t].instanceMesh,i=n.userData.idMap[t].instanceId;r.setMatrixAt(i,r.userData.matrix[i])}})),n.children.forEach((function(e){e.instanceMatrix.needsUpdate=!0})),this.core.needUpdate=!0)}},{key:"hidePathTubeLines",value:function(e,t){var n=this.pathTubeLines.get(e);n&&(t.forEach((function(e){var t=e.id;if(t in n.userData.idMap){var r=n.userData.idMap[t].instanceMesh,i=n.userData.idMap[t].instanceId,a=(new E.Matrix4).makeScale(1e-7,1e-7,1e-7);r.setMatrixAt(i,r.userData.matrix[i].clone().multiply(a))}})),n.children.forEach((function(e){e.instanceMatrix.needsUpdate=!0})),this.core.needUpdate=!0)}},{key:"removePathTubeLines",value:function(e){var t=this;if(e){var n=this.pathTubeLines.get(e);n&&(n.userData.tween&&(n.userData.tween.stop(),n.userData.tween=null),n.userData.opacityTween&&(n.userData.opacityTween.stop(),n.userData.opacityTween=null),n.children.forEach((function(e){e.userData.tween&&(e.userData.tween.stop(),e.userData.tween=null),e.userData.opacityTween&&(e.userData.opacityTween.stop(),e.userData.opacityTween=null)})),this.getCore().dispose(n),this.pathTubeLines.delete(e),this.core.needUpdate=!0)}else this.pathTubeLines.forEach((function(e,n){e.userData.tween&&(e.userData.tween.stop(),e.userData.tween=null),e.userData.opacityTween&&(e.userData.opacityTween.stop(),e.userData.opacityTween=null),e.children.forEach((function(e){e.userData.tween&&(e.userData.tween.stop(),e.userData.tween=null),e.userData.opacityTween&&(e.userData.opacityTween.stop(),e.userData.opacityTween=null)})),t.getCore().dispose(e)})),this.pathTubeLines=new Map,this.core.needUpdate=!0}},{key:"addPathTubeLine2",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{radius:.2,radialSegments:8,progress:1,cornerRadius:.3,color:16777215,repeat:1,repeatY:1,autoRepeat:!1,scrollSpeed:.03,playing:!1,playSpeed:.1,reverse:!1},a=this.core.scene;if(!this.lineMeshs.get(e)){var o=[];t.forEach((function(e){o.push(new E.Vector3(e.x,e.y,e.z))}));var l=new E.PathPointList,u=new E.PathPointList;l.set(o,i.cornerRadius,10,!1),u.set(o.reverse(),i.cornerRadius,10,!1);var c=(new s.TextureLoader).load(n,(function(e){e.wrapS=e.wrapT=E.RepeatWrapping,r.core.needUpdate=!0}));c.repeat.x=i.autoRepeat?i.repeat*l.distance():i.repeat,c.repeat.y=i.repeatY?i.repeatY:1;var h=new E.MeshStandardMaterial({color:i.color,metalness:.4,roughness:.7,transparent:!0,map:c}),d=new E.PathTubeGeometry({pathPointList:i.reverse?u:l,options:{radius:i.radius,radialSegments:i.radialSegments,progress:i.progress},usage:E.DynamicDrawUsage});d.pathPointList=l,d.pathPointList2=u;var p=new E.Mesh(d,h);return p.name=e,p.userData.reverse=i.reverse,p.userData.scrollSpeed=i.scrollSpeed,p.userData.playing=i.playing,p.userData.playSpeed=i.playSpeed,p.userData.radius=i.radius,p.userData.progress=i.progress,p.userData.radialSegments=i.radialSegments,p.layers.enable(5),this.lineMeshs.set(e,p),a.add(p),this.core.needUpdate=!0,p}}},{key:"addInstancePathTubeLines",value:function(e,t,n){var r,i,a,o,l,u=this.getCore().scene;if(!this.instancePathTubeLines.get(e)){var c=null;c=n&&n.isStandardMaterial?new E.MeshStandardMaterial({color:16777215,roughness:.7,metalness:.3,transparent:!1}):new E.MeshBasicMaterial({color:16777215,roughness:.7,metalness:.3,transparent:!1});var h=["#include <lights_fragment_begin2>"].join("\n");c.onBeforeCompile=function(e){e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",h)},n.height;var d=new E.PathPointList;d.set([new s.Vector3(0,0,0),new s.Vector3(null!==(r=n.length)&&void 0!==r?r:.03,0,0),new s.Vector3(null!==(i=n.length)&&void 0!==i?i:.03,-(null!==(a=n.length2)&&void 0!==a?a:.01),0)],n.cornerRadius,32,!1);var p=new E.PathTubeGeometry({pathPointList:d,options:{radius:null!==(o=n.radius)&&void 0!==o?o:.01,radialSegments:16,progress:1},usage:E.DynamicDrawUsage}),f=new E.InstancedMesh(p,c,t.length);f.layers.enable(5),f.userData.idMap={},f.userData.matrix=[],f.userData.object=[];for(var m=0;m<t.length;m++){f.userData.idMap[t[m].id]=m;var v=new E.Matrix4,g=new E.Vector3(t[m].position.x,t[m].position.y,t[m].position.z),y=new E.Euler(t[m].rotation.x,t[m].rotation.y,t[m].rotation.z);v.compose(g,(new E.Quaternion).setFromEuler(y),new E.Vector3(1,1,1)),f.userData.matrix.push(v),f.userData.object.push(t[m].userData),f.setMatrixAt(m,v),f.setColorAt(m,new E.Color(null!==(l=t[m].color)&&void 0!==l?l:16711680))}u.add(f),this.instancePathTubeLines.set(e,f),this.core.needUpdate=!0}}},{key:"removeInstancePathTubeLines",value:function(e){var t=this;if(e){var n=this.instancePathTubeLines.get(e);n&&(this.getCore().dispose(n),this.instancePathTubeLines.delete(e),this.core.needUpdate=!0)}else this.instancePathTubeLines.forEach((function(e,n){t.getCore().dispose(e)})),this.instancePathTubeLines=new Map,this.core.needUpdate=!0}},{key:"updateInstancePathTubeLines",value:function(e,t){var n,r=this.instancePathTubeLines.get(e);if(r){for(var i=0;i<t.length;i++){var a=r.userData.idMap[t[i].id];if(null!=a){if("visible"in t[i])if(t[i].visible)r.setMatrixAt(a,r.userData.matrix[a]);else{var o=(new E.Matrix4).makeScale(1e-7,1e-7,1e-7);r.setMatrixAt(a,r.userData.matrix[a].clone().multiply(o))}"color"in t[i]&&r.setColorAt(a,new E.Color(null!==(n=t[i].color)&&void 0!==n?n:16711680))}}r.instanceMatrix.needsUpdate=!0,r.instanceColor.needsUpdate=!0,this.core.needUpdate=!0}}},{key:"hideInstancePathTubeLines",value:function(e,t){var n=this.instancePathTubeLines.get(e);if(n){for(var r=0;r<t.length;r++){var i=n.userData.idMap[t[r].id];if(null!=i){var a=(new E.Matrix4).makeScale(1e-7,1e-7,1e-7);n.setMatrixAt(i,n.userData.matrix[i].clone().multiply(a))}}n.instanceMatrix.needsUpdate=!0,this.core.needUpdate=!0}}},{key:"showInstancePathTubeLines",value:function(e,t){var n=this.instancePathTubeLines.get(e);if(n){for(var r=0;r<t.length;r++){var i=n.userData.idMap[t[r].id];null!=i&&n.setMatrixAt(i,n.userData.matrix[i])}n.instanceMatrix.needsUpdate=!0,this.core.needUpdate=!0}}},{key:"addPathTubeLine3",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{radius:.2,radialSegments:8,progress:1,cornerRadius:.3,color:16777215,repeat:1,repeatY:1,autoRepeat:!1,scrollSpeed:.03,playing:!1,playSpeed:.1,reverse:!1};if(!this.lineMeshs.get(t)){var a=[];n.forEach((function(e){a.push(new E.Vector3(e.x,e.y,e.z))}));var o=new E.PathPointList,l=new E.PathPointList;o.set(a,i.cornerRadius,10,!1),l.set(a.reverse(),i.cornerRadius,10,!1);var u=(new s.TextureLoader).load(r,(function(e){e.wrapS=e.wrapT=E.RepeatWrapping}));u.repeat.x=i.autoRepeat?i.repeat*o.distance():i.repeat,u.repeat.y=i.repeatY?i.repeatY:1;var c=new E.MeshStandardMaterial({color:i.color,metalness:.4,roughness:.7,transparent:!0,map:u}),h=new E.PathTubeGeometry({pathPointList:i.reverse?l:o,options:{radius:i.radius,radialSegments:i.radialSegments,progress:i.progress},usage:E.DynamicDrawUsage}),d=new E.Mesh(h,c);return d.name=t,d.layers.enable(5),this.lineMeshs.set(t,d),e.add(d),this.core.needUpdate=!0,d}}},{key:"getPathTubeLine",value:function(e){return this.lineMeshs.get(e)}},{key:"updatePathTubeLine",value:function(e,t,n){e.userData.reverse=t,e.userData.progress=n,e.geometry.update(e.userData.reverse?e.geometry.pathPointList2:e.geometry.pathPointList,{radius:e.userData.radius,progress:e.userData.progress,radialSegments:e.userData.radialSegments}),this.core.needUpdate=!0}},{key:"addTrack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=this.core.scene,o=[];if(e.forEach((function(e){o.push(new E.Vector3(e.x,e.y,e.z))})),this.curve=new E.CatmullRomCurve3(o),this.curve.curveType="catmullrom",this.curve.closed=n,this.curve.tension=t,r){var s=this.curve.getPoints(50),l=(new E.BufferGeometry).setFromPoints(s),u=new E.LineBasicMaterial({color:i}),c=new E.Line(l,u);this.curveMap.set("centripetal"+this.curveMap.size,c),a.add(c),this.core.needUpdate=!0}return this.curve}},{key:"removeTrack",value:function(e){var t;if(e){if(e>this.curveMap.size)return;(t=this.curveMap.get("centripetal"+e)).geometry.dispose(),t.material.dispose(),t.parent.remove(t),this.curveMap.delete("centripetal"+e)}else this.curveMap.forEach((function(e){e.geometry.dispose(),e.material.dispose(),e.parent.remove(e)})),this.curveMap.clear();this.core.needUpdate=!0}},{key:"startTrackAnimation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;this.addTrack(t,n.tension,n.isClosed,n.isShow),this.trackModel=e,this.velocity=n.speed||.001,this.progress=n.progress||1,this.isPlayTrack=!0}},{key:"trackAnimation",value:function(e,t,n,r){var i=new E.Matrix4;i.lookAt(t,n,new s.Vector3(r.x,r.y,r.z)),i.multiply((new E.Matrix4).makeRotationFromEuler(new E.Euler(0,0,0))),e.quaternion.setFromRotationMatrix(i)}}])}(ke),Mr={uniforms:{time:{type:"f",value:0},textureBase:{type:"t",value:null},textureMove:{type:"t",value:null},repeat:{type:"repeat",value:new s.Vector2(1,1)}},vertexShader:[s.ShaderChunk.common,s.ShaderChunk.logdepthbuf_pars_vertex,"varying vec2 vUv;","varying vec3 fNormal;","varying vec3 vPosition;","void main()","{","vUv = uv;","fNormal=normal;","vPosition=position;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;",s.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[s.ShaderChunk.logdepthbuf_pars_fragment,"varying vec2 vUv;","varying vec3 fNormal;","varying vec3 vPosition;","uniform float time;","uniform sampler2D textureMove;","uniform sampler2D textureBase;","uniform vec2 repeat;","void main( void ) {","vec2 position = vUv;","vec3 tempNomal= normalize(fNormal);","float power=step(0.95,abs(tempNomal.y));","vec4 colorb=texture2D(textureBase,position.xy);","vec4 colora = texture2D(textureMove,vec2(vUv.x,fract(vUv.y-time))*repeat );","if(power>0.95){","gl_FragColor =colorb;","}else{","gl_FragColor =colorb+colorb*colora;","}",s.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},wr={uniforms:{time:{type:"f",value:0},type:{type:"f",value:2},dir:{type:"f",value:1},color:{type:"color",value:new s.Color(9055202)},map:{type:"t",value:null}},vertexShader:[s.ShaderChunk.common,s.ShaderChunk.logdepthbuf_pars_vertex,"uniform float time;","uniform float type;","varying vec2 vUv;","varying float progress;","void main(){","vUv = uv;","vec3 pos = position;","if(type==4.0){","progress = mod(time,20.0)/20.;","pos.xz *= (progress + 0.2);","}","gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);",s.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[s.ShaderChunk.logdepthbuf_pars_fragment,"uniform float time;","uniform vec3 color;","uniform float type;","uniform float dir;","uniform sampler2D map;","varying vec2 vUv;","varying float progress;","float random (in vec2 _st) {","return fract(sin(dot(_st.xy,vec2(12.9898,78.233)))*43758.5453123);","}","float noise (vec2 _st) {","vec2 i = floor(_st);","vec2 f = fract(_st);","float a = random(i);","float b = random(i + vec2(1.0, 0.0));","float c = random(i + vec2(0.0, 1.0));","float d = random(i + vec2(1.0, 1.0));","vec2 u = f * f * (3.0 - 2.0 * f);","return mix(a, b, u.x) +","(c - a)* u.y * (1.0 - u.x) +","(d - b) * u.x * u.y;","}","vec2 hash22( vec2 p ){","p = vec2( dot(p,vec2(127.1,311.7)),","dot(p,vec2(269.5,183.3)) );","return -1.0 + 2.0*fract(sin(p)*43758.5453123);","}","float hash21(vec2 p){","return fract(sin(dot(p, vec2(12.9898, 78.233))) * 43758.5453);","}","float perlinNoise(vec2 p) {","vec2 pi = floor(p);","vec2 pf = fract(p);","vec2 w = pf * pf * (3.0 - 2.0 * pf);","return mix(mix(dot(hash22(pi + vec2(0.0, 0.0)), pf - vec2(0.0, 0.0)),","dot(hash22(pi + vec2(1.0, 0.0)), pf - vec2(1.0, 0.0)), w.x),","mix(dot(hash22(pi + vec2(0.0, 1.0)), pf - vec2(0.0, 1.0)),","dot(hash22(pi + vec2(1.0, 1.0)), pf - vec2(1.0, 1.0)), w.x),","w.y);","}","#define NUM_OCTAVES 15","float fbm (vec2 _st) {","float v = 0.0;","float a = 0.5;","vec2 shift = vec2(100.0);","mat2 rot = mat2(cos(0.5), sin(0.5),","-sin(0.5), cos(0.50));","for (int i = 0; i < NUM_OCTAVES; ++i) {","v += a * noise(_st);","_st = rot * _st * 2.0 + shift;","a *= 0.5;","}","return v;","}","#define OCTAVES1 15","float fbm1 (in vec2 st) {","float value = 0.0;","float amplitude = .5;","float frequency = 0.;","for (int i = 0; i < OCTAVES1; i++) {","value += amplitude * noise(st);","st *= 2.;","amplitude *= .5;","}","return value;","}","const mat2 mtx = mat2( 0.80,  0.60, -0.60,  0.80 );","float fbm6( vec2 p ) {","float f = 0.0;","f += 0.500000*perlinNoise( p ); p = mtx*p*2.02;","f += 0.250000*perlinNoise( p ); p = mtx*p*2.03;","f += 0.125000*perlinNoise( p ); p = mtx*p*2.01;","f += 0.062500*perlinNoise( p ); p = mtx*p*2.04;","f += 0.031250*perlinNoise( p ); p = mtx*p*2.01;","f += 0.015625*perlinNoise( p );","return f/0.96875;","}","void main(){","if(type ==0.0){","float alpha;","if(dir==0.0){","alpha = smoothstep(0.0,1.0,vUv.y + sin(time)* 0.1);","}else if(dir==1.0){","alpha = smoothstep(1.0,0.0,vUv.y + sin(time)* 0.1);","}else if(dir==2.0){","alpha = smoothstep(0.7,0.05,(abs(vUv.y-0.5)+sin(time)* 0.1)/0.6);","}else{","alpha = smoothstep(0.0,1.0,vUv.y + sin(time)* 0.1);","}","gl_FragColor =  vec4(color,alpha);","}else if(type==1.0){","vec2 st = vUv ;","float alpha;","st += st * abs(fract(time) *0.01);","vec3 color = vec3(color);","if(dir==0.0){","alpha = smoothstep(0.0,1.0,vUv.y);","}else if(dir==1.0){","alpha = smoothstep(1.0,0.0,vUv.y);","}else if(dir==2.0){","alpha = smoothstep(0.9,0.05,abs(vUv.y - 0.5)/0.5);","}else{","alpha = smoothstep(0.0,1.0,vUv.y);","}","vec2 q = vec2(0.);","q.x = fbm( st + 0.05*time);","q.y = fbm( st + vec2(1.0));","vec2 r = vec2(0.);","r.x = fbm( st + 1.0*q + vec2(1.7,9.2)+ 0.15*time * 0.3 );","r.y = fbm( st + 1.0*q + vec2(8.3,2.8)+ 0.126*time * 0.3);","float f = fbm(st+r);","gl_FragColor = vec4((f*f*f + .6*f*f + .5*f)*color,alpha);","}else if(type==2.0){","vec3 color = vec3(color);","float alpha;","if(dir==0.0){","alpha = smoothstep(0.0,1.0,vUv.y);","}else if(dir==1.0){","alpha = smoothstep(1.0,0.0,vUv.y);","}else if(dir==2.0){","alpha = smoothstep(0.9,0.05,abs(vUv.y - 0.5)/0.5);","}else{","alpha = smoothstep(0.0,1.0,vUv.y);","}","vec2 st = vUv;","st = vec2(vUv.x,(vUv.y +time/20.)/2.0);","color += fbm6(st*3.0);","gl_FragColor = vec4(color,alpha);","}else if(type==3.0){","vec4 tex = texture2D( map,vec2(vUv.x,(vUv.y +fract(time/10.))/2.0) * vec2(5,1));","gl_FragColor = tex;","}else if(type==4.0){","float alpha;","if(dir==0.0){","alpha = smoothstep(0.0,1.0,vUv.y + sin(time)* 0.1);","}else if(dir==1.0){","alpha = smoothstep(1.0,0.0,vUv.y + sin(time)* 0.1);","}else if(dir==2.0){","alpha = smoothstep(0.7,0.05,(abs(vUv.y-0.5)+sin(time)* 0.1)/0.6);","}else if(dir==3.0){","float alphax =1.0 -  pow(progress,3.0);","alpha = smoothstep(0.0,1.0,vUv.y);","alpha *= alphax;","}","gl_FragColor =  vec4(color,alpha);","}",s.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},_r=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t)).name=e&&e.name?e.name:"RailMesh",n.height=e&&e.height?e.height:4,n.speed=e&&e.speed?e.speed:.01,n.isRunning=!e||!e.isRunning||e.isRunning,n.renderOrder=e&&e.renderOrder?e.renderOrder:0,n.geometry=null,n.material=null,n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"setMaterial",value:function(){var e=tt(0===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)?Mr:wr,arguments.length>0&&void 0!==arguments[0]?arguments[0]:null);this.material=e}},{key:"setGeometry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;this.height=t,e instanceof Array&&this.createBufferGeometry(e,t)}},{key:"setCircleGeometry",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=[],i=0;i<t;i++){var a=2*Math.PI/t*(i+1),o=e*Math.cos(a),l=e*Math.sin(a);r.push(new s.Vector3(o,0,l))}this.setGeometry(r,n)}},{key:"createBufferGeometry",value:function(e,t){for(var n=new s.BufferGeometry,r=[],i=[],a=[],o=0,l=0,u=e.length;l<u;l++){var c=e[l],h=e[l+1>u-1?0:l+1];r.push(c.x),r.push(c.y),r.push(c.z),r.push(c.x),r.push(c.y+t),r.push(c.z);var d=c.distanceTo(h);i.push(o,0,o,1),o+=d}for(var p=0,f=i.length;p<f;p++)p%2==0&&(i[p]/=o);n.setAttribute("position",new s.Float32BufferAttribute(r,3)),n.setAttribute("uv",new s.Float32BufferAttribute(i,2));for(var m=0,v=r.length/3;m<v;m++)m+2<v&&a.push(m+1),m%2==0?(a.push(m),a.push(m+2)):(a.push(m+2),a.push(m));n.setIndex(a),this.geometry=n}},{key:"setSpeed",value:function(e){this.speed=e}},{key:"run",value:function(){this.isRunning&&(this.material.uniforms.time.value+=this.speed)}}])}(s.Mesh),Ar=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).railMeshs=new Map,e.textureMap=new Map,e.textureLoader=new s.TextureLoader,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"getRailMeshs",value:function(){return this.railMeshs}},{key:"removeRailMeshs",value:function(){var e=this.getCore().dispose;this.railMeshs.forEach((function(t,n){e(t)})),this.railMeshs=new Map,this.core.needUpdate=!0}},{key:"removeRail",value:function(e){var t=this.getCore().dispose,n=this.railMeshs.get(e);n&&(t(n),this.railMeshs.delete(e),this.core.needUpdate=!0)}},{key:"addRail",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{speed:.01,isRunning:!0},a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=this.getCore().scene;if(!this.railMeshs.get(e)){var l=[];t.forEach((function(e){l.push(new s.Vector3(e.x,e.y,e.z))}));var u=new _r(i);return u.name=e,u.setGeometry(l,n),u.setMaterial(nt(r,this.textureMap,this.textureLoader),a),this.railMeshs.set(e,u),u.scale.y=0,o.add(u),this.core.needUpdate=!0,u}}},{key:"addCircleRail",value:function(e,t,n,r,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=this.getCore().scene;if(!this.railMeshs.get(e)){var l=new _r(a);return l.name=e,l.setCircleGeometry(t,n,r),l.setMaterial(nt(i,this.textureMap,this.textureLoader),o),this.railMeshs.set(e,l),s.add(l),this.core.needUpdate=!0,l}}},{key:"run",value:function(){this.railMeshs.forEach((function(e){e.run()}))}},{key:"setRunAll",value:function(){this.railMeshs.forEach((function(e){e.isRunning=!0}))}},{key:"setStopAll",value:function(){this.railMeshs.forEach((function(e){e.isRunning=!1}))}},{key:"addModelEffect",value:function(e,t){var n=this,r=tt(0==(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)?Mr:wr,nt(t,this.textureMap,this.textureLoader));e.traverse((function(e){"Mesh"===e.type&&(e.material=r,n.railMeshs.set(e.name,e))})),this.core.needUpdate=!0}}])}(ke),Cr=n(562),Tr=n(817),Sr=n(959),Er=n(103),Lr=function(e,t){s.Mesh.call(this,e),this.type="Reflector";var n=this,r=void 0!==(t=t||{}).color?new s.Color(t.color):new s.Color(8355711),i=t.textureWidth||512,a=t.textureHeight||512,o=t.clipBias||0,l=t.shader||Lr.ReflectorShader,u=new s.Plane,c=new s.Vector3,h=new s.Vector3,d=new s.Vector3,p=new s.Matrix4,f=new s.Vector3(0,0,-1),m=new s.Vector4,v=new s.Vector3,g=new s.Vector3,y=new s.Vector4,x=new s.Matrix4,b=new s.PerspectiveCamera,M={minFilter:s.LinearFilter,magFilter:s.LinearFilter,format:s.RGBFormat},w=new s.WebGLRenderTarget(i,a,M);s.MathUtils.isPowerOfTwo(i)&&s.MathUtils.isPowerOfTwo(a)||(w.texture.generateMipmaps=!1);var _=new s.ShaderMaterial({uniforms:s.UniformsUtils.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});_.uniforms.tDiffuse.value=w.texture,_.uniforms.color.value=r,_.uniforms.textureMatrix.value=x,this.material=_,this.onBeforeRender=function(e,t,r){if(h.setFromMatrixPosition(n.matrixWorld),d.setFromMatrixPosition(r.matrixWorld),p.extractRotation(n.matrixWorld),c.set(0,0,1),c.applyMatrix4(p),v.subVectors(h,d),!(v.dot(c)>0)){v.reflect(c).negate(),v.add(h),p.extractRotation(r.matrixWorld),f.set(0,0,-1),f.applyMatrix4(p),f.add(d),g.subVectors(h,f),g.reflect(c).negate(),g.add(h),b.position.copy(v),b.up.set(0,1,0),b.up.applyMatrix4(p),b.up.reflect(c),b.lookAt(g),b.far=r.far,b.updateMatrixWorld(),b.projectionMatrix.copy(r.projectionMatrix),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(b.projectionMatrix),x.multiply(b.matrixWorldInverse),x.multiply(n.matrixWorld),u.setFromNormalAndCoplanarPoint(c,h),u.applyMatrix4(b.matrixWorldInverse),m.set(u.normal.x,u.normal.y,u.normal.z,u.constant);var i=b.projectionMatrix;y.x=(Math.sign(m.x)+i.elements[8])/i.elements[0],y.y=(Math.sign(m.y)+i.elements[9])/i.elements[5],y.z=-1,y.w=(1+i.elements[10])/i.elements[14],m.multiplyScalar(2/m.dot(y)),i.elements[2]=m.x,i.elements[6]=m.y,i.elements[10]=m.z+1-o,i.elements[14]=m.w,w.texture.encoding=e.outputEncoding,n.visible=!1;var a=e.getRenderTarget(),s=e.xr.enabled,l=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(w),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,b),e.xr.enabled=s,e.shadowMap.autoUpdate=l,e.setRenderTarget(a);var M=r.viewport;void 0!==M&&e.state.viewport(M),n.visible=!0}},this.getRenderTarget=function(){return w}};Lr.prototype=Object.create(s.Mesh.prototype),Lr.prototype.constructor=Lr,Lr.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};var Pr=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).waterMeshs=[],e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"removeWaterMeshs",value:function(){for(var e=0,t=this.waterMeshs.length;e<t;e++)this.waterMeshs[e].geometry.dispose(),this.waterMeshs[e].material.dispose(),this.waterMeshs[e].parent.remove(this.waterMeshs[e]);this.waterMeshs=[],this.core.needUpdate=!0}},{key:"addOcean",value:function(e){var t=this.getCore(),n=t.scene,r=t.width,i=t.height,a=new s.PlaneBufferGeometry(e.xSize,e.ySize),o=new Sr.Water(a,{textureWidth:r*window.devicePixelRatio,textureHeight:i*window.devicePixelRatio,waterNormals:(new s.TextureLoader).load(e.url,(function(e){e.wrapS=e.wrapT=s.RepeatWrapping})),alpha:1,sunDirection:new s.Vector3,sunColor:16777215,waterColor:e&&e.color?e.color:7695,distortionScale:e&&e.distortionScale?e.distortionScale:0,fog:void 0!==n.fog,clipBias:.003});return e&&e.size&&(o.material.uniforms.size.value=e.size),o.position.x=e.x,o.position.y=e.y,o.position.z=e.z,o.rotation.x=-Math.PI/2,e&&e.speed&&o.setSpeed(e.speed),this.waterMeshs.push(o),n.add(o),this.core.needUpdate=!0,o}},{key:"addModelEffect",value:function(e,t){var n,r=this,i=this.getCore(),a=i.scene,o=i.width,l=i.height,u=null!==(n=null==t?void 0:t.enableReflector)&&void 0!==n&&n;return e.traverse((function(e){var n;"Mesh"===e.type&&(n=u?new Sr.Water(e.geometry.clone(),{textureWidth:o*window.devicePixelRatio,textureHeight:l*window.devicePixelRatio,waterNormals:(new s.TextureLoader).load(t.url,(function(e){e.wrapS=e.wrapT=s.RepeatWrapping})),alpha:1,sunDirection:new s.Vector3,sunColor:16777215,waterColor:t&&t.color?t&&t.color:7695,distortionScale:3.7,fog:void 0!==a.fog}):new Cr.Water3(e.geometry.clone(),{textureWidth:o*window.devicePixelRatio,textureHeight:l*window.devicePixelRatio,waterNormals:(new s.TextureLoader).load(t.url,(function(e){e.wrapS=e.wrapT=s.RepeatWrapping})),alpha:1,sunDirection:new s.Vector3,sunColor:16777215,waterColor:t&&t.color?t&&t.color:7695,distortionScale:3.7,fog:void 0!==a.fog}),t&&t.size&&(n.material.uniforms.size.value=t.size),t&&t.speed&&n.setSpeed(t.speed),n.name=e.name,n.matrixWorld=e.matrixWorld,n.position.copy(e.position),n.rotation.copy(e.rotation),n.scale.copy(e.scale),n.updateMatrix(),n.layers=e.layers,n.castShadow=e.castShadow,n.receiveShadow=e.receiveShadow,n.renderOrder=e.renderOrder,e.geometry.dispose(),e.material.dispose(),n.name=e.name,r.waterMeshs.push(n),e.parent.add(n),e.parent.remove(e))})),this.core.needUpdate=!0,e}},{key:"run",value:function(){this.waterMeshs.forEach((function(e){e.run()}))}},{key:"setRunAll",value:function(){this.waterMeshs.forEach((function(e){e.isRunning=!0}))}},{key:"setStopAll",value:function(){this.waterMeshs.forEach((function(e){e.isRunning=!1}))}},{key:"removeOcean",value:function(e){this.core.scene.remove(e),this.core.needUpdate=!0}},{key:"addReflector",value:function(e){var t=this.core,n=t.scene,r=t.width,i=t.height,a=new s.PlaneBufferGeometry(e.width,e.height),o=new Lr(a,{clipBias:e.clipBias?e.clipBias:0,textureWidth:r*window.devicePixelRatio/2,textureHeight:i*window.devicePixelRatio/2,color:new s.Color(e.color)});o.position.x=e.position.x,o.position.y=e.position.y,o.position.z=e.position.z,o.rotateX(-Math.PI/2),o.userData.type="Reflector",n.add(o),this.core.needUpdate=!0}},{key:"removeReflector",value:function(){var e=this.core.scene,t=[];e.children.forEach((function(e){"Reflector"==e.userData.type&&t.push(e)})),t.forEach((function(t){e.remove(t)})),t=null,this.core.needUpdate=!0}},{key:"addTextureReflector",value:function(e){var t=this.getCore(),n=t.scene,r=t.width,i=t.height,a=new s.PlaneBufferGeometry(e.xSize,e.ySize),o=new Tr.Water2(a,{textureWidth:r*window.devicePixelRatio,textureHeight:i*window.devicePixelRatio,waterNormals:(new s.TextureLoader).load(e.url,(function(e){e.wrapS=e.wrapT=s.RepeatWrapping})),alpha:1,sunDirection:new s.Vector3,sunColor:16777215,waterColor:e&&e.color?e.color:7695,distortionScale:e&&e.distortionScale?e.distortionScale:0,definition:e&&"definition"in e?e.definition:.9,gradientRadius:e&&"gradientRadius"in e?e.gradientRadius:100,gradientColor:e&&"gradientColor"in e?e.gradientColor:0,fog:void 0!==n.fog,clipBias:.003});e&&e.size&&(o.material.uniforms.size.value=e.size),o.position.x=e.x,o.position.y=e.y,o.position.z=e.z,o.rotation.x=-Math.PI/2,o.userData.type="Reflector",n.add(o),this.core.needUpdate=!0}},{key:"setMeshReflector",value:function(e,t){var n=this.getCore(),r=n.width,i=n.height,a=n.touchTargetIDs,o=n.touchTargetObjs,s=new Er.ReflectorMesh(e,{textureWidth:r*window.devicePixelRatio,textureHeight:i*window.devicePixelRatio,definition:t&&"definition"in t?t.definition:.9});return s.name=e.name,s.matrixWorld=e.matrixWorld,s.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),s.scale.set(e.scale.x,e.scale.y,e.scale.z),s.position.set(e.position.x,e.position.y,e.position.z),s.layers=e.layers,s.castShadow=e.castShadow,s.receiveShadow=e.receiveShadow,s.renderOrder=e.renderOrder,e.parent.add(s),a.indexOf(e.uuid)>-1&&(a.splice(a.indexOf(e.uuid),1),o.splice(o.indexOf(e),1)),e.parent.remove(e),this.core.needUpdate=!0,s}}])}(ke),Br={uniforms:{time:{type:"f",value:0},color:{type:"color",value:new s.Color(13388)},b:{type:"f",value:0},p:{type:"f",value:.8}},vertexShader:[s.ShaderChunk.common,s.ShaderChunk.logdepthbuf_pars_vertex,"uniform float time;","varying vec2 vUv;","varying vec3 vPos;","varying vec3 wPos;","varying vec3 vNormal;","void main(){","vUv = uv;","vNormal = normal;","float t = fract(time* 0.08) + 0.0;","vec3 finalpos = position * t;","vPos = position;","wPos = (modelMatrix * vec4( finalpos, 1.0 )).xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4(finalpos, 1.0);",s.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[s.ShaderChunk.logdepthbuf_pars_fragment,"#include <packing>","uniform float p;","uniform float b;","uniform vec3 color;","varying vec2 vUv;","varying vec3 wPos;","varying vec3 vPos;","varying vec3 vNormal;","void main(){","float p = 0.8;","float nDotL = max(dot(normalize(cameraPosition - wPos),vNormal),0.0);","float intensity = pow( nDotL , p ) + b;","float alpha = smoothstep(1.0,0.0,intensity);","gl_FragColor = vec4(color,alpha);","if(vPos.y<0.0){","discard;","}",s.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},Dr=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t)).name=e&&e.name?e.name:"BallMesh",n.speed=e&&e.speed?e.speed:.1,n.isRunning=!e||!e.isRunning||e.isRunning,n.renderOrder=e&&e.renderOrder?e.renderOrder:60,n.material=n.setMaterial(),n.geometry=n.setGeometry(),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"setMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===this.material&&void 0===this.material||this.material.dispose();var t=tt(Br,e);return t.side=s.FrontSide,this.material=t,t}},{key:"setGeometry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;null===this.geometry&&void 0===this.geometry||this.geometry.dispose();var n=new s.SphereGeometry(e,t,t);return n.computeBoundingSphere(),this.geometry=n,n}},{key:"setSpeed",value:function(e){this.speed=e}},{key:"run",value:function(){this.isRunning&&(this.material.uniforms.time.value+=this.speed)}}])}(s.Mesh),kr=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).ballMeshs=[],e.hoodMeshs=[],e.isRunHood=!1,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"getBallMeshs",value:function(){return this.ballMeshs}},{key:"removeBallMeshs",value:function(){for(var e=0;e<this.ballMeshs.length;e++)this.ballMeshs[e].geometry.dispose(),this.ballMeshs[e].material.dispose(),this.ballMeshs[e].parent.remove(this.ballMeshs[e]);this.ballMeshs=[],this.core.needUpdate=!0}},{key:"addBall",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{speed:.1,isRunning:!0},a=this.getCore().scene,o=new Dr(i);return o.setGeometry(t,n),o.setMaterial(r),o.position.set(e.x,e.y,e.z),this.ballMeshs.push(o),a.add(o),this.core.needUpdate=!0,o}},{key:"addModelEffect",value:function(e,t){return e.traverse((function(e){if("Mesh"===e.type){var n=tt(Br,t);e.material=n}})),this.core.needUpdate=!0,e}},{key:"run",value:function(){this.ballMeshs.forEach((function(e){e.run()}))}},{key:"setRunAll",value:function(){this.ballMeshs.forEach((function(e){e.isRunning=!0}))}},{key:"setStopAll",value:function(){this.ballMeshs.forEach((function(e){e.isRunning=!1}))}},{key:"addDynamicHood",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01,i=this.getCore().scene,a=(new s.TextureLoader).load(n);a.wrapS=s.RepeatWrapping,a.wrapT=s.RepeatWrapping,a.repeat.set(1,1);var o=new s.SphereGeometry(t,32,16,0,2*Math.PI,0,Math.PI/2),l=new s.MeshBasicMaterial({map:a,transparent:!0,opacity:.6}),u=new s.Mesh(o,l);u.position.set(e.x,e.y,e.z),i.add(u),this.hoodMeshs.push(u),u.userData.interval=setInterval((function(){u.material.map.offset.y+=r}),20),this.core.needUpdate=!0}},{key:"removeAllHood",value:function(){var e=this.getCore().dispose;this.hoodMeshs.forEach((function(t){t.userData.interval&&clearInterval(t.userData.interval),e(t)})),this.hoodMeshs=[],this.core.needUpdate=!0}}])}(ke),Rr={uniforms:{color:{type:"color",value:new s.Color(49151)},time:{type:"f",value:0},type:{type:"f",value:0},num:{type:"f",value:4}},vertexShader:[s.ShaderChunk.common,s.ShaderChunk.logdepthbuf_pars_vertex,"varying vec2 vUv;","void main(){","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);",s.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[s.ShaderChunk.logdepthbuf_pars_fragment,"uniform float time;","uniform vec3 color;","uniform float type;","uniform float num;","varying vec2 vUv;","void main(){","float alpha = 1.0;","float dis = distance(vUv,vec2(0.5));//0-0.5","if(dis > 0.5){","discard;","}","if(type ==0.0){","float y = (sin(6.0 * num *(dis-time)) + 1.0)/2.0;","alpha = smoothstep(1.0,0.0,abs(y-0.5)/0.5) * (0.5 -dis) * 2.;","}else if(type ==1.0){","float step = fract(time* 4.)* 0.5;","if(dis<step){","alpha =1.- abs(step-dis)/0.15;","}else{","alpha = smoothstep(1.0,0.0,abs(step-dis)/0.05);","}","alpha *= (pow((0.5 -dis)* 3.0,2.0));","}","gl_FragColor = vec4(color,alpha );",s.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},Or=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t)).name=e&&e.name?e.name:"RingMesh",n.speed=e&&e.speed?e.speed:.003,n.isRunning=!e||!e.isRunning||e.isRunning,n.renderOrder=e&&e.renderOrder?e.renderOrder:40,n.material=n.setMaterial(),n.geometry=n.setGeometry(),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"setMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===this.material&&void 0===this.material||this.material.dispose();var t=tt(Rr,e);return this.material=t,t}},{key:"setGeometry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;null===this.geometry&&void 0===this.geometry||this.geometry.dispose();var n=new s.PlaneGeometry(e,t);return this.geometry=n,n}},{key:"setSpeed",value:function(e){this.speed=e}},{key:"run",value:function(){this.isRunning&&(this.material.uniforms.time.value+=this.speed)}}])}(s.Mesh),Ir={uniforms:{u_color:{type:"color",value:new s.Color(49151)},u_r:{type:"f",value:0},r:{type:"f",value:0},r_min:{type:"f",value:0},u_ring:{type:"f",value:0}},vertexShader:[s.ShaderChunk.common,s.ShaderChunk.logdepthbuf_pars_vertex,"varying vec3 vPosition;","void main(){","vPosition=position;","gl_Position\t= projectionMatrix * modelViewMatrix * vec4(position, 1.0);",s.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[s.ShaderChunk.logdepthbuf_pars_fragment,"varying vec3 vPosition;","uniform vec3 u_color;","uniform float u_r;","uniform float r;","uniform float r_min;","uniform float u_ring;","void main(){","float pct=distance(vec2(vPosition.x,vPosition.y),vec2(0.0));","if(pct>u_r || pct<(u_r-u_ring)){","gl_FragColor = vec4(1.0,0.0,0.0,0);","}else{","float dis=(pct-(u_r-u_ring))*(r-u_r)/(u_ring*(r-r_min));","gl_FragColor = vec4(u_color,dis);","}",s.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},Fr=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t)).name=e&&e.name?e.name:"RingMesh",n.speed=e&&e.speed?e.speed:.003,n.material=n.setMaterial(),n.geometry=n.setGeometry(),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"setMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===this.material&&void 0===this.material||this.material.dispose();var t=tt(Ir,e);return t.side=s.DoubleSide,t.depthWrite=!1,this.material=t,t}},{key:"setGeometry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;null===this.geometry&&void 0===this.geometry||this.geometry.dispose();var t=new s.CircleGeometry(e,120);return this.geometry=t,t}},{key:"setSpeed",value:function(e){this.speed=e}},{key:"run",value:function(){this.material.uniforms.u_r.value+=this.speed,this.material.uniforms.u_r.value>this.material.uniforms.r.value&&(this.material.uniforms.u_r.value=this.material.uniforms.r_min.value)}}])}(s.Mesh),Nr=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).ringMeshs=[],e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"getRingMeshs",value:function(){return this.ringMeshs}},{key:"removeRingMeshs",value:function(){for(var e=0;e<this.ringMeshs.length;e++)this.ringMeshs[e].geometry.dispose(),this.ringMeshs[e].material.dispose(),this.ringMeshs[e].parent.remove(this.ringMeshs[e]);this.ringMeshs=[],this.core.needUpdate=!0}},{key:"addRing",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{speed:.01,isRunning:!0},r=this.getCore().scene,i=new Or(n);return i.setGeometry(e,e),i.setMaterial(t),this.ringMeshs.push(i),r.add(i),this.core.needUpdate=!0,i}},{key:"scatterCircle",value:function(e,t,n,r,i,a){var o={u_color:{value:new E.Color(i)},u_r:{value:n},r:{value:e},r_min:{value:t},u_ring:{value:r},disable:{value:a}},s=[E.ShaderChunk.common,E.ShaderChunk.logdepthbuf_pars_vertex,"varying vec3 vPosition;","void main(){","vPosition=position;","gl_Position\t= projectionMatrix * modelViewMatrix * vec4(position, 1.0);",E.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),l=[E.ShaderChunk.logdepthbuf_pars_fragment,"varying vec3 vPosition;","uniform vec3 u_color;","uniform float u_r;","uniform float r;","uniform float r_min;","uniform float u_ring;","uniform bool disable;","void main(){","float pct=distance(vec2(vPosition.x,vPosition.y),vec2(0.0));","if(pct>u_r || pct<(u_r-u_ring)){","gl_FragColor = vec4(1.0,0.0,0.0,0);","}else{","float dis = 1.0;","if( disable ){","dis=(pct-(u_r-u_ring))*(r-u_r)/(u_ring*(r-r_min));","}else{","dis=(pct-(u_r-u_ring))*(u_r-r_min)/(u_ring*(r-r_min));","}","gl_FragColor = vec4(u_color,dis);","}",E.ShaderChunk.logdepthbuf_fragment,"}"].join("\n"),u=new E.CircleGeometry(e,120),c=new E.ShaderMaterial({vertexShader:s,fragmentShader:l,side:E.DoubleSide,uniforms:o,transparent:!0,depthWrite:!1}),h=new E.Mesh(u,c);return h.rotation.x=.5*-Math.PI,h.renderOrder=30,this.getCore().scene.add(h),this.core.needUpdate=!0,h}},{key:"addRing2",value:function(e,t,n,r,i,a){var o=this.getCore().scene,s=new Fr({speed:i});s.setGeometry(e);var l={u_color:{value:new E.Color(r)},u_r:{value:t},r:{value:e},r_min:{value:t},u_ring:{value:n}};return s.setMaterial(l),s.rotation.x=.5*-Math.PI,s.position.set(a.x,a.y,a.z),s.renderOrder=30,this.ringMeshs.push(s),o.add(s),this.core.needUpdate=!0,s}},{key:"addModelEffect",value:function(e,t){return e.traverse((function(e){if("Mesh"===e.type){var n=tt(Rr,t);e.material=n}})),this.core.needUpdate=!0,e}},{key:"run",value:function(){this.ringMeshs.forEach((function(e){e.run()}))}},{key:"setRunAll",value:function(){this.ringMeshs.forEach((function(e){e.isRunning=!0}))}},{key:"setStopAll",value:function(){this.ringMeshs.forEach((function(e){e.isRunning=!1}))}}])}(ke),zr=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).runMeshs=[],e.gradientGrounds=[],e.time=0,e.isRunning=!1,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"createDynamicGround",value:function(e,t,n,r){var i=this.getCore().scene,a=(new s.TextureLoader).load(n);a.wrapS=s.RepeatWrapping,a.wrapT=s.RepeatWrapping;var o=r&&r.color?new s.Color(r.color):new s.Color(16777215),l=new s.ShaderMaterial({uniforms:{targetColor:{value:new s.Vector3(o.r,o.g,o.b)},height:{value:3},colorTexture:{value:a},repeat:{value:r&&r.repeat?new s.Vector2(r.repeat.x,r.repeat.y):new s.Vector2(10,10)},u_lightDirection:{value:new s.Vector3(.5,3,4).normalize()}},transparent:!0,depthWrite:!1,vertexShader:["varying vec3 modelPos;","varying vec2 vUv;","varying vec3 vNormal;","void main() {","   vUv = uv;","\tvNormal = normal;","   modelPos = position;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 targetColor;","uniform float height;","varying vec3 modelPos;","uniform sampler2D colorTexture;","uniform vec2 repeat;","varying vec2 vUv;","vec3 u_lightColor = vec3(1.0, 1.0, 1.0);","uniform vec3 u_lightDirection;","varying vec3 vNormal;","void main() {","\tvec3 faceNormal = normalize(vNormal);","\tfloat nDotL = max(dot(u_lightDirection, faceNormal), 0.0);","\tvec4 a_color = texture2D( colorTexture, vUv*repeat )*vec4(targetColor, 1.0);","\tvec4 AmbientColor = vec4(u_lightColor, 1.0)*a_color;","\tvec4 diffuseColor = a_color * vec4(u_lightColor, 1.0)*1.0;","   gl_FragColor = vec4(a_color.xyz,1.0+modelPos.z/0.6)* (diffuseColor);","}"].join("\n")}),u=new s.PlaneGeometry(e,t,r&&r.widthSegments?r.widthSegments:100,r&&r.heightSegments?r.heightSegments:100),c=new s.Mesh(u,l);c.rotation.x=-.5*Math.PI,r&&r.position&&c.position.set(r.position.x,r.position.y,r.position.z),this.runMeshs.push(c),i.add(c),this.isRunning=!0,this.core.needUpdate=!0}},{key:"run",value:function(){var e=this;this.time+=10,this.runMeshs.forEach((function(t){for(var n=t.geometry.vertices.length,r=0;r<n;r++){var i=t.geometry.vertices[r];i.z=.3*Math.cos(e.time/1500+i.x*(n/2)*(i.y/(n/2)))}t.geometry.verticesNeedUpdate=!0})),this.gradientGrounds.forEach((function(e){e.material.uniforms.time.value+=.005}))}},{key:"removeDynamicGround",value:function(){var e=this;this.isRunning=!1,this.runMeshs.forEach((function(t){e.getCore().dispose(t)})),this.runMeshs=[],this.core.needUpdate=!0}},{key:"createGradientGround",value:function(e,t,n,r){var i=this.getCore().scene,a=(new s.TextureLoader).load(n);a.wrapS=s.RepeatWrapping,a.wrapT=s.RepeatWrapping;var o=r&&r.color?new s.Color(r.color):new s.Color(16777215),l=r&&r.colorEnd?new s.Color(r.colorEnd):new s.Color(16777215),u=r&&"r"in r?r.r:0,c=new s.ShaderMaterial({uniforms:{color:{value:new s.Vector3(o.r,o.g,o.b)},colorEnd:{value:new s.Vector3(l.r,l.g,l.b)},colorTexture:{value:a},repeat:{value:r&&r.repeat?new s.Vector2(r.repeat.x,r.repeat.y):new s.Vector2(10,10)},r:{value:u},count:{value:Math.floor(u/(r&&r.spacing?r.spacing:100))},highWidth:{value:r&&r.highWidth?r.highWidth:20},u_lightDirection:{value:new s.Vector3(.5,3,4).normalize()},time:{value:0}},transparent:!0,depthWrite:!1,vertexShader:[s.ShaderChunk.common,s.ShaderChunk.logdepthbuf_pars_vertex,"varying vec3 vPosition;","varying vec2 vUv;","varying vec3 vNormal;","void main() {","   vUv = uv;","\tvNormal = normal;","   vPosition = position;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",s.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[s.ShaderChunk.logdepthbuf_pars_fragment,"uniform vec3 color;","uniform vec3 colorEnd;","varying vec3 vPosition;","uniform sampler2D colorTexture;","uniform vec2 repeat;","uniform float r;","uniform float highWidth;","uniform float count;","uniform float time;","varying vec2 vUv;","vec3 u_lightColor = vec3(1.0, 1.0, 1.0);","uniform vec3 u_lightDirection;","varying vec3 vNormal;","void main() {","\tfloat pct=distance(vec2(vPosition.x,vPosition.y),vec2(0.0));","\tvec3 faceNormal = normalize(vNormal);","\tfloat nDotL = max(dot(u_lightDirection, faceNormal), 0.0);","\tvec4 a_color = texture2D( colorTexture, vUv*repeat ) * vec4(color, 1.0);","\ta_color = vec4(mix(a_color.xyz,colorEnd,pow(min(pct/r,1.0),2.0)), a_color.w);","\tvec4 diffuseColor = a_color * vec4(u_lightColor, 1.0)*nDotL;"," \tfloat alpha = 0.8;","\tfor (int i = 0; i <=999; i++) {","\t\tif (float(i) <= count) {","\t\t\tfloat d = abs(pct-(fract(time)+float(i))*r/count);","\t\t\tif(d < highWidth){","\t\t\t\talpha = 1.0 - d * 0.2 / highWidth;","\t\t\t}","\t\t}","\t}","   gl_FragColor = vec4(a_color.xyz * alpha,a_color.w);",s.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")}),h=new s.PlaneGeometry(e,t,r&&r.widthSegments?r.widthSegments:100,r&&r.heightSegments?r.heightSegments:100),d=new s.Mesh(h,c);d.userData.type="GradientGround",d.rotation.x=-.5*Math.PI,r&&r.position&&d.position.set(r.position.x,r.position.y,r.position.z),d.renderOrder=r.renderOrder?r.renderOrder:0,this.gradientGrounds.push(d),i.add(d),this.isRunning=!0,this.core.needUpdate=!0}},{key:"removeGradientGround",value:function(){var e=this;this.isRunning=!1,this.gradientGrounds.forEach((function(t){e.getCore().dispose(t)})),this.gradientGrounds=[],this.core.needUpdate=!0}},{key:"addGradient",value:function(e,t,n){var r=n?new s.Color(n):new s.Color(16777215),i=["varying vec3 vPosition;","#include <common>"].join("\n"),a=["#include <begin_vertex>","\tvPosition = position;"].join("\n"),o=["varying vec3 vPosition;","#include <common>"].join("\n"),l=["float pct=distance(vec2(vPosition.x,vPosition.y),vec2(0.0));","vec4 diffuseColor = vec4( diffuse , opacity )*vec4(mix(vec3(0.14, 0.2, 0.298),vec3(1.0, 1.0, 1.0),min(pct/"+t.toFixed(2)+",1.0)), 1.0);","if(min(pct/"+t.toFixed(2)+",1.0)>=0.0){","\tdiffuseColor = vec4(mix(diffuse,vec3("+r.r.toFixed(2)+", "+r.g.toFixed(2)+", "+r.b.toFixed(2)+"),pow(min(pct/"+t.toFixed(2)+",1.00),2.0)), 1.0);","}"].join("\n");e.material.onBeforeCompile=function(e){e.vertexShader=e.vertexShader.replace("#include <common>",i).replace("#include <begin_vertex>",a),e.fragmentShader=e.fragmentShader.replace("#include <common>",o).replace("vec4 diffuseColor = vec4( diffuse, opacity );",l)},e.material.needsUpdate=!0,this.core.needUpdate=!0}}])}(ke),Ur=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5;(0,v.default)(this,e),this.range=t,this.center=n,this.life=5e3,this.createTime=Date.now(),this.updateTime=Date.now(),this.size=r,this.opacityFactor=.4,this.opacity=1*this.opacityFactor,this.scaleFactor=2,this.scale=1+this.scaleFactor*(this.updateTime-this.createTime)/this.life,this.position={x:2*Math.random()*this.range+this.center.x-this.range,y:this.center.y,z:2*Math.random()*this.range+this.center.z-this.range};var a=4*Math.random();a<2&&(a-=2),a>2&&(a+=2),this.speed={x:Math.random(),y:Math.random()*i+i,z:Math.random()}}return(0,g.default)(e,[{key:"update",value:function(){var e=Date.now(),t=e-this.updateTime;this.position.x+=this.speed.x*t/1e3,this.position.y+=this.speed.y*t/1e3,this.position.z+=this.speed.z*t/1e3,this.opacity=1-(e-this.createTime)/this.life,this.opacity*=this.opacityFactor,this.opacity<0&&(this.opacity=0),this.scale=1+this.scaleFactor*(e-this.createTime)/this.life,this.scale>1+this.scaleFactor&&(this.scale=1+this.scaleFactor),this.updateTime=e}}])}(),Hr=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((r=r.apply(e,t||[])).next())}))},jr=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).ids=[],e.smokeMap=new Map,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"createSmoke",value:function(e,t,n,r,i,a){return Hr(this,void 0,void 0,o.default.mark((function s(){var l,c,h,d,p,f,m,v,g,y,x;return o.default.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return l=this.getCore(),c=l.scene,h=new Promise((function(e,n){(new E.TextureLoader).load(t,(function(t){e(t)}))})),o.next=5,h.then((function(e){return[!0,e,null]}),(function(e){return[!1,null,e]}));case 5:if(d=o.sent,p=(0,u.default)(d,3),f=p[0],m=p[1],p[2],f){o.next=12;break}return o.abrupt("return");case 12:(v=new E.BufferGeometry).setAttribute("position",new E.BufferAttribute(new Float32Array([]),3)),v.setAttribute("a_opacity",new E.BufferAttribute(new Float32Array([]),1)),v.setAttribute("a_size",new E.BufferAttribute(new Float32Array([]),1)),v.setAttribute("a_scale",new E.BufferAttribute(new Float32Array([]),1)),(g=new E.PointsMaterial({color:"#666",map:m,transparent:!0,depthWrite:!1})).onBeforeCompile=function(e){e.vertexShader=e.vertexShader.replace("void main() {","\n        attribute float a_opacity;\n        attribute float a_size;\n        attribute float a_scale;\n        varying float v_opacity;\n        void main() {\n          v_opacity = a_opacity;\n        "),e.vertexShader=e.vertexShader.replace("gl_PointSize = size;","\n        gl_PointSize = a_size * a_scale;\n        "),e.fragmentShader=e.fragmentShader.replace("void main() {","\n        varying float v_opacity;\n        void main() {\n      "),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );","\n        gl_FragColor = vec4( outgoingLight, diffuseColor.a * v_opacity );\n      ")},(y=new E.Points(v,g)).frustumCulled=!1,y.renderOrder=20,c.add(y),x=[],this.ids[length]=setInterval((function(){x.push(new Ur(r,n,i,a))}),200),this.ids[length]=setInterval((function(){if(x=x.filter((function(e){return e.update(),!(e.updateTime-e.createTime>e.life)})),x.length){var e=[],t=[],n=[],r=[];x.forEach((function(i){var a=i.position,o=a.x,s=a.y,l=a.z;e.push(o,s,l),t.push(i.opacity),n.push(i.scale),r.push(i.size)})),v.setAttribute("position",new E.BufferAttribute(new Float32Array(e),3)),v.setAttribute("a_opacity",new E.BufferAttribute(new Float32Array(t),1)),v.setAttribute("a_scale",new E.BufferAttribute(new Float32Array(n),1)),v.setAttribute("a_size",new E.BufferAttribute(new Float32Array(r),1))}}),20),this.smokeMap.set(e,{smoke:y,ids:[this.ids[length-2],this.ids[length-1]]}),this.core.needUpdate=!0;case 20:case"end":return o.stop()}}),s,this)})))}},{key:"removeSmoke",value:function(e){var t=this.getCore().scene,n=this.smokeMap.get(e);n&&(n.smoke.geometry.dispose(),n.smoke.material.dispose(),t.remove(n.smoke),n.ids.forEach((function(e){clearInterval(e)})),this.smokeMap.delete(e),this.core.needUpdate=!0)}},{key:"removeAllSmoke",value:function(){var e=this.getCore().scene;this.smokeMap.forEach((function(t){t.smoke.geometry.dispose(),t.smoke.material.dispose(),e.remove(t.smoke),t.ids.forEach((function(e){clearInterval(e)}))})),this.smokeMap.clear(),this.core.needUpdate=!0}},{key:"getSmoke",value:function(e){this.smokeMap.get(e)}}])}(ke),Gr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{speedAround:{x:1,y:5,z:1},lifeTime:5e3,scaleFactor:1,opacity:.4,direction:"y",end:-1.2};(0,v.default)(this,e),this.range=t,this.center=n,this.life=a.lifeTime,this.createTime=Date.now(),this.updateTime=Date.now(),this.size=r,this.end=a.end,this.opacityFactor=a.opacity,this.opacity=1*this.opacityFactor,this.direction=a.direction,this.scaleFactor=a.scaleFactor,this.scale=(.5*Math.random()+.5)*this.scaleFactor,this.position={x:2*Math.random()*this.range+this.center.x-this.range,y:this.center.y,z:2*Math.random()*this.range+this.center.z-this.range};var o=a.speedAround.x;"x"!==a.direction?(o=Math.random()*a.speedAround.x)<a.speedAround.x/2&&(o-=a.speedAround.x):o=i;var s=a.speedAround.y;"y"!==a.direction?(s=Math.random()*a.speedAround.y)<a.speedAround.y/2&&(s-=a.speedAround.y):s=i;var l=Math.random()*a.speedAround.z;"z"!==a.direction?l>a.speedAround.z/2&&(l+=a.speedAround.z):l=i,this.speed={x:o,y:s,z:l}}return(0,g.default)(e,[{key:"update",value:function(){this.position.x+=this.speed.x,this.position.y+=this.speed.y,this.position.z+=this.speed.z}}])}(),Vr=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((r=r.apply(e,t||[])).next())}))},Wr=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).smokeMap=new Map,e.updateAnimation(),e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"createSmoke",value:function(e,t,n,r,i,a){return Vr(this,void 0,void 0,o.default.mark((function s(){var l,c,h,d,p,f,m,v,g,y,x,b=this;return o.default.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!this.smokeMap.get(e)){o.next=2;break}return o.abrupt("return");case 2:return l=this.getCore(),c=l.scene,h=new Promise((function(e,t){(new E.TextureLoader).load(a.url||"/static/img/texture-smoke.png",(function(t){e(t)}))})),o.next=7,h.then((function(e){return[!0,e,null]}),(function(e){return[!1,null,e]}));case 7:if(d=o.sent,p=(0,u.default)(d,3),f=p[0],m=p[1],p[2],f){o.next=14;break}return o.abrupt("return");case 14:(v=new E.BufferGeometry).setAttribute("position",new E.BufferAttribute(new Float32Array([]),3)),v.setAttribute("a_opacity",new E.BufferAttribute(new Float32Array([]),1)),v.setAttribute("a_size",new E.BufferAttribute(new Float32Array([]),1)),v.setAttribute("a_scale",new E.BufferAttribute(new Float32Array([]),1)),(g=new E.PointsMaterial({color:a.color||"#666",map:m,transparent:!0,depthWrite:!1,side:E.DoubleSide})).onBeforeCompile=function(e){e.vertexShader=e.vertexShader.replace("void main() {","\n        attribute float a_opacity;\n        attribute float a_size;\n        attribute float a_scale;\n        varying float v_opacity;\n        void main() {\n          v_opacity = a_opacity;\n        "),e.vertexShader=e.vertexShader.replace("gl_PointSize = size;","\n        gl_PointSize = a_size * a_scale;\n        "),e.fragmentShader=e.fragmentShader.replace("void main() {","\n        varying float v_opacity;\n        void main() {\n      "),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );","\n        gl_FragColor = vec4( outgoingLight, diffuseColor.a * v_opacity );\n      ")},(y=new E.Points(v,g)).frustumCulled=!1,y.renderOrder=20,c.add(y),this.smokeMap.set(e,{smoke:y,generationTime:a.generationTime||500,ids:[],updateGenerationTime:!1,particals:[]}),x=function(){if(b.smokeMap.get(e).updateGenerationTime&&(clearInterval(b.smokeMap.get(e).ids[0]),b.smokeMap.get(e).updateGenerationTime=!1,b.smokeMap.get(e).generationTime>=1e9?clearInterval(b.smokeMap.get(e).ids[0]):b.smokeMap.get(e).ids[0]=setInterval(x,b.smokeMap.get(e).generationTime)),!a.state)for(var o=0;o<10;o++)b.smokeMap.get(e).particals.push(new Gr(n,t,r,i,{speedAround:a.speedAround||{x:1,y:5,z:1},lifeTime:a.lifeTime||5e3,scaleFactor:a.scaleFactor||1,opacity:a.opacity||.4,direction:a.direction||"y",end:a.end}))},this.smokeMap.get(e).generationTime>=1e9?clearInterval(this.smokeMap.get(e).ids[0]):this.smokeMap.get(e).ids[0]=setInterval(x,this.smokeMap.get(e).generationTime),this.core.needUpdate=!0;case 22:case"end":return o.stop()}}),s,this)})))}},{key:"updateAnimation",value:function(){var e=this;this.updateInterval=setInterval((function(){e.smokeMap.forEach((function(e,t){var n=e.particals.filter((function(e){return!("x"==e.direction&&e.speed.x<0&&e.position.x<e.end||"x"==e.direction&&e.speed.x>0&&e.position.x>e.end||"y"==e.direction&&e.speed.y<0&&e.position.y<e.end||"y"==e.direction&&e.speed.y>0&&e.position.y>e.end||"z"==e.direction&&e.speed.z<0&&e.position.z<e.end||"z"==e.direction&&e.speed.z>0&&e.position.z>e.end)})),r=[],i=[],a=[],o=[];n.forEach((function(e){e.update();var t=e.position,n=t.x,s=t.y,l=t.z;r.push(n,s,l),i.push(e.opacity),a.push(e.scale),o.push(e.size)})),e.smoke.geometry.setAttribute("position",new E.BufferAttribute(new Float32Array(r),3)),e.smoke.geometry.setAttribute("a_opacity",new E.BufferAttribute(new Float32Array(i),1)),e.smoke.geometry.setAttribute("a_scale",new E.BufferAttribute(new Float32Array(a),1)),e.smoke.geometry.setAttribute("a_size",new E.BufferAttribute(new Float32Array(o),1))}))}),20)}},{key:"updateGenerationTime",value:function(e,t){this.smokeMap.get(e)&&this.smokeMap.get(e).generationTime!=t&&(this.smokeMap.get(e).generationTime=t,this.smokeMap.get(e).updateGenerationTime=!0)}},{key:"removeSmoke",value:function(e){var t=this.getCore().scene,n=this.smokeMap.get(e);n&&(n.smoke.geometry.dispose(),n.smoke.material.dispose(),t.remove(n.smoke),n.ids.forEach((function(e){clearInterval(e)})),this.smokeMap.delete(e),this.core.needUpdate=!0)}},{key:"removeAllSmoke",value:function(){var e=this.getCore().scene;this.smokeMap.forEach((function(t){t.smoke.geometry.dispose(),t.smoke.material.dispose(),e.remove(t.smoke),t.ids.forEach((function(e){clearInterval(e)}))})),this.smokeMap.clear(),this.core.needUpdate=!0}},{key:"getSmoke",value:function(e){return this.smokeMap.get(e)}},{key:"destroy",value:function(){clearInterval(this.updateInterval)}}])}(ke),Xr=function(e){function t(){return(0,v.default)(this,t),T(this,t)}return(0,m.default)(t,e),(0,g.default)(t,[{key:"addFog",value:function(e,t,n){this.getCore().scene.fog=new s.Fog(e,t,n)}},{key:"removeFog",value:function(){this.getCore().scene.fog=null}}])}(ke),Yr=function(e){function t(){return(0,v.default)(this,t),T(this,t)}return(0,m.default)(t,e),(0,g.default)(t,[{key:"addCloud",value:function(e){var t=this.getCore().scene,n=new s.Fog(4555956,-100,3e3),r=(new s.TextureLoader).load(e);r.magFilter=s.LinearMipMapLinearFilter,r.minFilter=s.LinearMipMapLinearFilter;for(var i=new s.ShaderMaterial({uniforms:{map:{value:r},fogColor:{value:n.color},fogNear:{value:n.near},fogFar:{value:n.far}},vertexShader:["varying vec2 vUv;","void main()","{","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D map;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec2 vUv;","void main()","{","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = smoothstep( fogNear, fogFar, depth );","gl_FragColor = texture2D(map, vUv );","gl_FragColor.w *= pow( gl_FragCoord.z, 20.0 );","gl_FragColor = mix( gl_FragColor, vec4( gl_FragColor.xyz, 0.0 ), fogFactor );","}"].join("\n"),transparent:!0,depthWrite:!1,depthTest:!1}),a=new s.PlaneBufferGeometry(64,64),o=[],l=0;l<4e3;l++){var u=a.clone();u.rotateX(-Math.PI/2);var c=Math.random()*Math.random()*1.5+.5;u.scale(c,c,1);var h=Math.random()*Math.PI*2,d=1e3*Math.sqrt(Math.random());u.translate(d*Math.cos(h),500*Math.random(),d*Math.sin(h)),o.push(u)}var p=be.mergeBufferGeometries(o),f=new s.Mesh(p,i);f.position.y=3e3,t.add(f)}}])}(ke),Jr=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t))._clipPlane=new s.Plane(new s.Vector3(0,0,1),0),e.centerPlane=new s.Plane(new s.Vector3(0,0,1),0),e.boxEdges=[],e.isClip=!1,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"getCurrentClipPlanes",value:function(){return this.isClip?[this._clipPlane]:[]}},{key:"startClip",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.modelMap,r=e.spriteMap;if(!this.isClip){var i=t.initPosition,a=void 0===i?"z":i,o=t.style,l=void 0===o?{color:"#0F8292",opacity:.15,borderColor:"#2BE2E2"}:o;this.transformMeshStyle={color:new s.Color(l.color),opacity:l.opacity,borderColor:new s.Color(l.borderColor)},this.core.isTransformKeyDown=!1,this.isClip=!0,this.modelMap=n,this.spriteMap=r,this.initSceneBox(),this.initClipTransformMesh(),this.startTransform(),this.setSceneClipPlane(),this.initTransformListener(),this.setClipPositionByType(a),this.core.needUpdate=!0}}},{key:"initSceneBox",value:function(){var e=this,t=Array.from(this.modelMap.values()).reduce((function(t,n){var r=e.core.getObjectBox(n);return t.union(r),t}),new s.Box3);t.expandByScalar(.05*t.getSize(new s.Vector3).length()),this.sceneBox=t.clone();var n=this.sceneBox,r=n.min,i=n.max,a=[new s.Vector3(r.x,r.y,r.z),new s.Vector3(r.x,r.y,i.z),new s.Vector3(r.x,i.y,r.z),new s.Vector3(r.x,i.y,i.z),new s.Vector3(i.x,r.y,r.z),new s.Vector3(i.x,r.y,i.z),new s.Vector3(i.x,i.y,r.z),new s.Vector3(i.x,i.y,i.z)];this.boxEdges=[[a[0],a[1]],[a[0],a[2]],[a[0],a[4]],[a[1],a[3]],[a[1],a[5]],[a[2],a[3]],[a[2],a[6]],[a[3],a[7]],[a[4],a[5]],[a[4],a[6]],[a[5],a[7]],[a[6],a[7]]]}},{key:"initTransformListener",value:function(){this.core.transformControls.addEventListener("change",this.syncClipPanel.bind(this))}},{key:"syncClipPanel",value:function(){var e=this.core.transformControls;if(e.object){var t=this.sceneBox,n=e.object,r=n.position,i=n.quaternion;this._clipPlane.setFromNormalAndCoplanarPoint(new s.Vector3(0,0,1).applyQuaternion(i),r),this.centerPlane.setFromNormalAndCoplanarPoint(new s.Vector3(0,0,1).applyQuaternion(i),t.getCenter(new s.Vector3)),this.refreshClipTransformMesh()}}},{key:"refreshClipTransformMesh",value:function(){var e=this,t=[],n=!1;if(this.boxEdges.forEach((function(r){var i=(0,u.default)(r,2),a=i[0],o=i[1],l=new s.Line3(a,o);if(e.centerPlane.intersectsLine(l)){var c=e.centerPlane.intersectLine(l,new s.Vector3);t.push(c)}if(e._clipPlane.intersectsLine(l)){n=!0;var h=e._clipPlane.intersectLine(l,new s.Vector3);t.push(h)}})),n){var r=this.clipTransformMesh.geometry,i=t.map((function(t){return e.clipTransformMesh.worldToLocal(t.clone())})),a=Math.max.apply(Math,(0,l.default)(i.map((function(e){return e.x})))),o=Math.min.apply(Math,(0,l.default)(i.map((function(e){return e.x})))),c=Math.max.apply(Math,(0,l.default)(i.map((function(e){return e.y})))),h=Math.min.apply(Math,(0,l.default)(i.map((function(e){return e.y})))),d=[new s.Vector3(o,h,0),new s.Vector3(o,c,0),new s.Vector3(a,h,0),new s.Vector3(a,c,0)];r.vertices=d,r.verticesNeedUpdate=!0,r.elementsNeedUpdate=!0,this.clipTransformMeshOutline.geometry=new s.EdgesGeometry(r),this.core.needUpdate=!0}}},{key:"initClipTransformMesh",value:function(){var e=this.sceneBox,t=this.transformMeshStyle,n=t.color,r=t.opacity,i=t.borderColor,a=e.getSize(new s.Vector3).length(),o=new s.PlaneGeometry(a,a),l=new s.MeshBasicMaterial({color:n.getHex(),side:s.DoubleSide,transparent:!0,opacity:r,visible:!0,depthWrite:!1});this.clipTransformMesh=new s.Mesh(o,l);var u=new s.EdgesGeometry(o),c=new s.LineSegments(u,new s.LineBasicMaterial({color:i.getHex()}));this.clipTransformMeshOutline=c,this.clipTransformMesh.add(c),this.clipTransformMesh.position.copy(e.getCenter(new s.Vector3)),this.clipTransformMesh.updateMatrix(),this.clipTransformMesh.updateMatrixWorld(),this.core.scene.add(this.clipTransformMesh)}},{key:"startTransform",value:function(){var e=this.core.transformControls;this.core.scene.add(e),this.setControlMode("translate"),e.detach(),e.enabled=!0,e.attach(this.clipTransformMesh)}},{key:"setSceneClipPlane",value:function(){var e=this;this.modelMap.forEach((function(t){t.traverse((function(t){if("Mesh"===t.type&&"material"in t){var n=t.material;n.clippingPlanes=[e._clipPlane],n.clipIntersection=!0,n.clipShadows=!0}}))})),this.spriteMap.forEach((function(t){t.material.clippingPlanes=[e._clipPlane],t.material.clipIntersection=!0,t.material.clipShadows=!0}))}},{key:"stopClip",value:function(){this.isClip&&(this.modelMap.forEach((function(e){e.traverse((function(e){if("Mesh"===e.type&&"material"in e){var t=e.material;t.clippingPlanes=[],t.clipIntersection=!1,t.clipShadows=!1}}))})),this.spriteMap.forEach((function(e){e.material.clippingPlanes=[],e.material.clipIntersection=!1,e.material.clipShadows=!1})),this.core.isTransformKeyDown=!0,this.isClip=!1,this.removeTransformListener(),this.stopTransform(),this.removeTransformMesh(),this.removeClipPlane(),this.modelMap=null,this.core.needUpdate=!0)}},{key:"removeTransformListener",value:function(){this.core.transformControls.removeEventListener("change",this.syncClipPanel.bind(this))}},{key:"removeTransformMesh",value:function(){this.core.scene.remove(this.clipTransformMesh),this.clipTransformMesh=null}},{key:"stopTransform",value:function(){var e=this.core.transformControls;e.detach(),e.enabled=!1,this.core.scene.remove(e)}},{key:"removeClipPlane",value:function(){this.modelMap.forEach((function(e){e.traverse((function(e){if("Mesh"===e.type&&"material"in e){var t=e.material;t.clippingPlanes=[],t.clipIntersection=!1,t.clipShadows=!1}}))}))}},{key:"setControlMode",value:function(e){var t=this.core.transformControls;"translate"===e?(t.showX=!1,t.showY=!1,t.showZ=!0):"rotate"===e&&(t.showZ=!1,t.showY=!0,t.showX=!0),t.setMode(e)}},{key:"setClipPosition",value:function(){}},{key:"setClipPositionByType",value:function(e){switch(e){case"x":this._clipPlane.setFromNormalAndCoplanarPoint(new s.Vector3(1,0,0),this.sceneBox.getCenter(new s.Vector3)),this.clipTransformMesh.rotation.set(0,Math.PI/2,0),this.clipTransformMesh.position.copy(this.sceneBox.getCenter(new s.Vector3));break;case"y":this._clipPlane.setFromNormalAndCoplanarPoint(new s.Vector3(0,1,0),this.sceneBox.getCenter(new s.Vector3)),this.clipTransformMesh.rotation.set(-Math.PI/2,0,Math.PI/2),this.clipTransformMesh.position.copy(this.sceneBox.getCenter(new s.Vector3));break;case"z":this._clipPlane.setFromNormalAndCoplanarPoint(new s.Vector3(0,0,1),this.sceneBox.getCenter(new s.Vector3)),this.clipTransformMesh.rotation.set(0,0,0),this.clipTransformMesh.position.copy(this.sceneBox.getCenter(new s.Vector3))}this.centerPlane=this._clipPlane.clone(),this.clipTransformMesh.updateMatrix(),this.clipTransformMesh.updateMatrixWorld(),this.refreshClipTransformMesh()}},{key:"setClipPanelVisible",value:function(e){this.clipTransformMesh.visible=e,e?this.core.transformControls.attach(this.clipTransformMesh):this.core.transformControls.detach(),this.core.needUpdate=!0}},{key:"invertCurrentClip",value:function(){var e=this._clipPlane.normal.clone();this._clipPlane.negate(),this.centerPlane.negate();var t=this._clipPlane.normal.clone(),n=(new s.Quaternion).setFromUnitVectors(e,t);this.clipTransformMesh.applyQuaternion(n),this.clipTransformMesh.updateMatrix(),this.clipTransformMesh.updateMatrixWorld(),this.refreshClipTransformMesh()}}])}(ke);function Qr(e){var t=1.5*e/2,n=e/2,r=e/2;return{x:[-n,n],y:[-t,t],z:[-r,r]}}function qr(e,t){return t*(e.x[1]-e.x[0])*(e.y[1]-e.y[0])*(e.z[1]-e.z[0])/8e3}function Kr(e){return new s.Vector3(s.MathUtils.randFloat(e.x[0],e.x[1]),s.MathUtils.randFloat(e.y[0],e.y[1]),s.MathUtils.randFloat(e.z[0],e.z[1]))}function Zr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/3,n=e*(1-t),r=e*(1+t);return s.MathUtils.randFloat(n,r)}function $r(e){(e%=2*Math.PI)>Math.PI?e-=2*Math.PI:e<-Math.PI&&(e+=2*Math.PI);for(var t=1,n=1,r=e*e,i=-1,a=2;a<=14;a+=2)n+=i*(t*=r/(a*(a-1))),i*=-1;return n}var ei=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).snowParamMap=new Map,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"addSnow",value:function(e){for(var t=e.url,n=e.range,r=void 0===n?60:n,i=e.density,a=void 0===i?10:i,o=e.size,l=void 0===o?1:o,u=e.verticalSpeed,c=void 0===u?1:u,h=e.horizontalSpeed,d=void 0===h?.1:h,p=e.opacity,f=void 0===p?.8:p,m=e.offset,v=void 0===m?{x:0,z:0}:m,g=e.flutterFactor,y=void 0===g?0:g,x=e.centerPosition,b=void 0===x?{x:0,y:0,z:0}:x,M=this.getCore().scene,w=s.MathUtils.generateUUID(),_=(new s.TextureLoader).load(t),A=new s.BufferGeometry,C=new s.PointsMaterial({size:l,transparent:!0,opacity:f,map:_,blending:s.AdditiveBlending,sizeAttenuation:!0,depthTest:!1}),T=Qr(r),S=qr(T,a),E=[],L=[],P=0;P<S;P++){E.push(new s.Vector3(Zr(-v.x+d),Zr(c),Zr(-v.z)));var B=Kr(T);L.push(B)}A.setFromPoints(L);var D=new s.Points(A,C);return D.position.set(b.x,b.y,b.z),M.add(D),this.snowParamMap.set(w,{points:D,velocityList:E,range:T,flutterFactor:y}),w}},{key:"update",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.snowParamMap.forEach((function(n){var r=n.points,i=n.velocityList,a=n.range,o=n.flutterFactor;o?e.updateWithFlutter(t,{points:r,velocityList:i,range:a,flutterFactor:o}):e.updateWithoutFlutter(t,{points:r,velocityList:i,range:a,flutterFactor:o})}))}},{key:"updateWithFlutter",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,n=t.points,r=t.velocityList,i=t.range,a=t.flutterFactor,o=n.geometry,s=o.getAttribute("position").array,l=(0,u.default)(i.x,2),c=l[0],h=l[1],d=(0,u.default)(i.y,2),p=d[0],f=d[1],m=(0,u.default)(i.z,2),v=m[0],g=m[1],y=.001*Date.now(),x=0;x<s.length;x+=3){var b=x,M=x+1,w=x+2,_=x/3,A=r[_],C=A.x,T=A.y,S=A.z,E=$r(y+_),L=$r(y+_+Math.PI/2);s[b]-=(C-E*a)*e,s[M]-=T*e,s[w]-=(S-L*a)*e,s[M]<=p&&(s[M]=f),s[b]<c&&(s[b]=h),s[b]>h&&(s[b]=c),s[w]>g&&(s[w]=v),s[w]<v&&(s[w]=g)}o.attributes.position.needsUpdate=!0}},{key:"updateWithoutFlutter",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,n=t.points,r=t.velocityList,i=t.range,a=n.geometry,o=a.getAttribute("position").array,s=(0,u.default)(i.x,2),l=s[0],c=s[1],h=(0,u.default)(i.y,2),d=h[0],p=h[1],f=(0,u.default)(i.z,2),m=f[0],v=f[1],g=0;g<o.length;g+=3){var y=g,x=g+1,b=g+2,M=r[g/3],w=M.x,_=M.y,A=M.z;o[y]-=w*e,o[x]-=_*e,o[b]-=A*e,o[x]<=d&&(o[x]=p),o[y]<l&&(o[y]=c),o[y]>c&&(o[y]=l),o[b]>v&&(o[b]=m),o[b]<m&&(o[b]=v)}a.attributes.position.needsUpdate=!0}},{key:"removeSnow",value:function(e){var t=this.getCore().scene;if(e&&this.snowParamMap.has(e)){var n=this.snowParamMap.get(e).points;return t.remove(n),void this.snowParamMap.delete(e)}this.snowParamMap.forEach((function(e){var n=e.points;t.remove(n)})),this.snowParamMap=new Map}}])}(ke),ti=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).rainParamMap=new Map,e}return(0,m.default)(t,e),(0,g.default)(t,[{key:"addRain",value:function(e){for(var t=e.url,n=e.range,r=void 0===n?60:n,i=e.density,a=void 0===i?10:i,o=e.size,l=void 0===o?1:o,u=e.verticalSpeed,c=void 0===u?1:u,h=e.opacity,d=void 0===h?.8:h,p=e.offset,f=void 0===p?{x:0,z:0}:p,m=e.centerPosition,v=void 0===m?{x:0,y:0,z:0}:m,g=this.getCore().scene,y=(new s.TextureLoader).load(t),x=new s.BufferGeometry,b=new s.PointsMaterial({size:l,transparent:!0,opacity:d,map:y,blending:s.AdditiveBlending,sizeAttenuation:!0,depthTest:!1}),M=Qr(r),w=qr(M,a),_=[],A=[],C=0;C<w;C++){_.push(new s.Vector3(Zr(-f.x),Zr(c),Zr(-f.z)));var T=Kr(M);A.push(T)}x.setFromPoints(A);var S=new s.Points(x,b);S.position.set(v.x,v.y,v.z),g.add(S);var E=s.MathUtils.generateUUID();return this.rainParamMap.set(E,{points:S,velocityList:_,range:M}),E}},{key:"updateRain",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;performance.mark("rainStart"),this.rainParamMap.forEach((function(t){for(var n=t.points,r=t.velocityList,i=t.range,a=n.geometry,o=a.getAttribute("position").array,s=(0,u.default)(i.x,2),l=s[0],c=s[1],h=(0,u.default)(i.y,2),d=h[0],p=h[1],f=(0,u.default)(i.z,2),m=f[0],v=f[1],g=0;g<o.length;g+=3){var y=g,x=g+1,b=g+2,M=r[g/3],w=M.x,_=M.y,A=M.z;o[y]-=w*e,o[x]-=_*e,o[b]-=A*e,o[x]<=d&&(o[x]=p),o[y]<l&&(o[y]=c),o[y]>c&&(o[y]=l),o[b]>v&&(o[b]=m)}a.attributes.position.needsUpdate=!0})),performance.mark("rainEnd"),performance.clearMarks()}},{key:"removeRain",value:function(e){var t=this.getCore().scene;if(e&&this.rainParamMap.has(e)){var n=this.rainParamMap.get(e).points;return t.remove(n),void this.rainParamMap.delete(e)}this.rainParamMap.forEach((function(e){var n=e.points;t.remove(n)})),this.rainParamMap.clear()}}])}(ke),ni=function(e){function t(e){var n,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2?arguments[2]:void 0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return(0,v.default)(this,t),(n=T(this,t)).eventAbortController=new AbortController,n.use=function(e){return e.core=n.core,i.isNull(e.action)||n.addEventListener("click",e.action),i.isNull(e.doubleClickAction)||n.addEventListener("doubleClick",e.doubleClickAction),i.isNull(e.mousedownAction)||n.addEventListener("mousedown",e.mousedownAction),i.isNull(e.mouseMoveAction)||n.addEventListener("mousemove",e.mouseMoveAction),i.isNull(e.mouseUpAction)||n.addEventListener("mouseup",e.mouseUpAction),i.isNull(e.touchAction)||n.addEventListener("touchAction",e.touchAction),e},n.remove=function(e){i.isNull(e.action)||n.removeEventListener("click",e.action),i.isNull(e.doubleClickAction)||n.removeEventListener("doubleClick",e.doubleClickAction),i.isNull(e.mousedownAction)||n.removeEventListener("mousedown",e.mousedownAction),i.isNull(e.mouseMoveAction)||n.removeEventListener("mousemove",e.mouseMoveAction),i.isNull(e.mouseUpAction)||n.removeEventListener("mouseup",e.mouseUpAction),i.isNull(e.touchAction)||n.removeEventListener("touchAction",e.touchAction),i.isNull(e.restore)||e.restore(),e.core=null},n.core=new De(e,r,a),n.initBustardEventDispatcher(),o&&(n.cad=n.use(new dr),n.color=n.use(new Ne),n.color.activeClick=!1,n.clip3=n.use(new Jr),n.drag=n.use(new qe),n.hide=n.use(new Fe),n.hide.activeClick=!1,n.mark=n.use(new We),n.mark.activeClick=!1,n.measure=n.use(new Ke),n.measure.activeClick=!1,n.audio=n.use(new hr),n.rotate=n.use(new Oe),n.roam=n.use(new $e),n.saveView=n.use(new je),n.translate=n.use(new Ge),n.transparent=n.use(new Ve),n.transparent.activeClick=!1,n.texture=n.use(new Xe),n.sprite=n.use(new Ye),n.wireframe=n.use(new ze),n.light=n.use(new at),n.light.activeClick=!1,n.lod=n.use(new Vn),n.label=n.use(new Wn),n.fontLoader=n.use(new Xn),n.outLine=n.use(new lr),n.particle=n.use(new ur),n.glow=n.use(new cr),n.clickAction=!0,n.touchAction=!0,n.lineEffect=n.use(new yr),n.lineEffect2=n.use(new br),n.railEffect=n.use(new Ar),n.waterEffect=n.use(new Pr),n.ballEffect=n.use(new kr),n.snowDay=n.use(new ei),n.rainDay=n.use(new ti),n.fogDay=n.use(new Xr),n.cloud=n.use(new Yr),n.ringEffect=n.use(new Nr),n.groundEffect=n.use(new zr),n.smokeEffect=n.use(new jr),n.smokeEffect2=n.use(new Wr),n.mouseDownState=!1,n.mouseMoveState=!1),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"initBustardEventDispatcher",value:function(){var e=this,t=this.core,n=t.el,r=null,a=0,o=!1,s=!1,l=function(){return!!t.scene},u=function(){return e.clickAction},c=function(){return e.touchAction};n.addEventListener("click",(function(n){l()&&u()&&(clearTimeout(r),r=setTimeout((function(){if(!s){var r=n.clientX,i=n.clientY,a=t.getAllIntersectionObj(r,i);e.dispatchEvent({type:"click",event:n,intersect:a?a.intersect:null,intersection:a?a.intersection:null,intersections:a?a.intersections:null})}}),200))}),{signal:this.eventAbortController.signal}),n.addEventListener("dblclick",(function(n){if(l()&&u()){var i=n.clientX,a=n.clientY;clearTimeout(r);var o=t.getAllIntersectionObj(i,a);e.dispatchEvent({type:"doubleClick",event:n,intersect:o?o.intersect:null,intersection:o?o.intersection:null,intersections:o?o.intersections:null})}}),{signal:this.eventAbortController.signal}),n.addEventListener("mousedown",(function(n){var r;if(l()){if(function(e){return 1===function(e){var t=0;return 1&e&&t++,2&e&&t++,4&e&&t++,t}(e)}(n.buttons)&&(a=0,s=!1,e.core.experimentFlag.changeOrbitTarget)){var i=n.clientX,u=n.clientY,c=t.getAllIntersectionObj(i,u);(null===(r=null==c?void 0:c.intersection)||void 0===r?void 0:r.point)&&e.roam.setOrbitTarget(c.intersection.point)}o=!0,e.dispatchEvent({type:"mousedown",event:n})}}),{signal:this.eventAbortController.signal}),n.addEventListener("mousemove",(function(t){l()&&(ri(t.buttons)&&(o=!1),a>2&&(s=!0),o&&(a+=Math.abs(t.movementX)+Math.abs(t.movementY)),e.dispatchEvent({type:"mousemove",event:t}))}),{signal:this.eventAbortController.signal}),n.addEventListener("mouseup",(function(t){l()&&(ri(t.buttons)&&(o=!1),e.dispatchEvent({type:"mouseup",event:t}))}),{signal:this.eventAbortController.signal}),n.addEventListener("mousemove",i.throttle((function(n){if(l()&&c()&&!o){var r=n.clientX,i=n.clientY,a=t.getTouchIntersectionObj(r,i);e.dispatchEvent({type:"touchAction",event:n,intersect:a?a.intersect:null,intersection:a?a.intersection:null,intersections:a?a.intersections:null})}}),100,{trailing:!1}),{signal:this.eventAbortController.signal})}},{key:"destroy",value:function(){this.eventAbortController.abort(),this.smokeEffect2.destroy()}}])}(Je);function ri(e){return 0===e}ni.Color=Ne,ni.Clip2=function(e){function t(e,n){var r;return(0,v.default)(this,t),(r=T(this,t)).clippedObjsID=new Set,r.target=e,r.boxBorder=[],r.clipPlanes=[],r.materials=new Map,n?r.setClip2(e,n):r.setClip(e),r.clippedObjs=[],r.clippedDistance=.05,r}return(0,m.default)(t,e),(0,g.default)(t,[{key:"setClip",value:function(e){var t=this,n=(new E.Box3).setFromObject2(e);this.boxBorder.push(1*(n.max.x+.01),-1*(n.min.x-.01),1*(n.max.y+.01),-1*(n.min.y-.01),1*(n.max.z+.01),-1*(n.min.z-.01));var r=new s.Plane(new s.Vector3(-1,0,0),this.boxBorder[0]),i=new s.Plane(new s.Vector3(1,0,0),this.boxBorder[1]),a=new s.Plane(new s.Vector3(0,-1,0),this.boxBorder[2]),o=new s.Plane(new s.Vector3(0,1,0),this.boxBorder[3]),l=new s.Plane(new s.Vector3(0,0,-1),this.boxBorder[4]),u=new s.Plane(new s.Vector3(0,0,1),this.boxBorder[5]);this.clipPlanes.push(r,i,a,o,l,u),e.traverse((function(e){if("Mesh"===e.type){var n=e.material;t.materials.has(n.uuid)||(t.materials.set(n.uuid,n),n.clippingPlanes=t.clipPlanes,n.clipShadows=!0,n.clipIntersection=!1)}}))}},{key:"setClip2",value:function(e,t){var n=this,r=(new E.Box3).setFromObject3(e,t.clone().invert());this.boxBorder.push(1*(r.max.x+.01),-1*(r.min.x-.01),1*(r.max.y+.01),-1*(r.min.y-.01),1*(r.max.z+.01),-1*(r.min.z-.01));var i=new s.Plane(new s.Vector3(-1,0,0),this.boxBorder[0]).applyMatrix4(t),a=new s.Plane(new s.Vector3(1,0,0),this.boxBorder[1]).applyMatrix4(t),o=new s.Plane(new s.Vector3(0,-1,0),this.boxBorder[2]).applyMatrix4(t),l=new s.Plane(new s.Vector3(0,1,0),this.boxBorder[3]).applyMatrix4(t),u=new s.Plane(new s.Vector3(0,0,-1),this.boxBorder[4]).applyMatrix4(t),c=new s.Plane(new s.Vector3(0,0,1),this.boxBorder[5]).applyMatrix4(t);this.clipPlanes.push(i,a,o,l,u,c),e.traverse((function(e){if("Mesh"===e.type){var t=e.material;n.materials.has(t.uuid)||(n.materials.set(t.uuid,t),t.clippingPlanes=n.clipPlanes,t.clipShadows=!0,t.clipIntersection=!1)}}))}},{key:"appendObject",value:function(e){var t=this;e.traverse((function(e){if(e instanceof s.Mesh){var n=e.material;n.clippingPlanes=t.clipPlanes,n.clipShadows=!0,n.clipIntersection=!1}}))}},{key:"setIntersection",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=w(this.materials);try{for(n.s();!(e=n.n()).done;){var r=(0,u.default)(e.value,2);r[0],r[1].clipIntersection=t}}catch(e){n.e(e)}finally{n.f()}}},{key:"reset",value:function(){for(var e=0;e<this.clipPlanes.length;e++)this.clipPlanes[e].constant=this.boxBorder[e];this.core.needUpdate=!0}},{key:"clipYPlus",value:function(e){this.clipPlanes[2].constant=e;for(var t=0;t<this.clippedObjs.length;t++){var n=this.clippedObjs[t];n.height>=e-this.clippedDistance?n.obj.visible=!1:n.obj.visible=!0}this.core.needUpdate=!0}},{key:"clipYSub",value:function(e){this.clipPlanes[3].constant=-1*e,this.core.needUpdate=!0}},{key:"clipXPlus",value:function(e){this.clipPlanes[0].constant=e,this.core.needUpdate=!0}},{key:"clipXSub",value:function(e){this.clipPlanes[1].constant=-1*e,this.core.needUpdate=!0}},{key:"clipZPlus",value:function(e){this.clipPlanes[4].constant=e,this.core.needUpdate=!0}},{key:"clipZSub",value:function(e){this.clipPlanes[5].constant=-1*e,this.core.needUpdate=!0}},{key:"clip",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.boxBorder,t=0;t<e.length;t++)this.clipPlanes[t].constant=t%2==0?e[t]:-1*e[t];this.core.needUpdate=!0}},{key:"getClipPlanse",value:function(){return this.clipPlanes}},{key:"setClipped",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.target.traverse((function(r){if("Mesh"===r.type){for(var i=!1,a=0;a<e.length;a++){if(t.clippedObjsID.has(r.uuid)){i=!1;break}var o=e[a];if(n){if(r.name===o){i=!0;break}}else if(r.name.includes(o)){i=!0;break}}if(i){var s={height:(new E.Box3).setFromObject2(r).max.y,obj:r};t.clippedObjsID.add(r.uuid),t.clippedObjs.push(s)}}}))}}])}(ke),ni.Drag=qe,ni.Hide=Fe,ni.Mark=We,ni.Measure=Ke,ni.Rotate=Oe,ni.Roam=$e,ni.Pick=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t))._mousedowncoords={x:0,y:0},n._mousedown=!1,n._marquee=document.createElement("div"),n._unitVertCoordinates=[],n._isMove=!1,n._isTouch=!1,n.touchObjUuid="zero",n.touchObjParentUuid="zero",n.touchObjParentName="zero",n.activeMutiPick=!1,n.activeClick=!0,n.multiPick=null,n.blockWhenCtrl=!0,n.pick=null,n.doublePick=function(){},n.select=function(){},n.touch=null,n.movePosition=null,n.shouldBlockByCtrl=function(e){return n.blockWhenCtrl&&e.ctrlKey},n.getObject=function(e,t){return(0,n.getCore().getFirstIntersectionObject)(e,t)},n.getPoint=function(e,t){var r=(0,n.getCore().getFirstIntersection)(e,t);return i.isNil(r)?null:r.point},n.getNodeByProperty=function(e,t){var r={};return n.getCore().scene.traverse((function(n){n[e]===t?r=n:n.parent&&n.parent[e]===t&&(r=n.parent)})),r},n.action=function(e){if(!n._isMove&&n.activeClick){var t=e.event;if(!n.shouldBlockByCtrl(t)&&e.intersect){for(var r=e.intersections,a=null,o=null,s=null,l=0,u=r.length;l<u;l++)if(!1!==r[l].object.visible&&(!r[l].object.material.transparent||0!=r[l].object.material.opacity)){var c=r[l],h=c.object,d=h.material,p=c.point;if(c.face&&c.face.normal){var f=c.face.normal,m=new E.Matrix4;m.extractRotation(h.matrixWorld),n.pickNormal=new E.Vector3(f.x,f.y,f.z).applyMatrix4(m),n.faceIndex=c.faceIndex}else n.pickNormal=null,n.faceIndex=null;var v=!1;if(null!==d.clippingPlanes&&6===d.clippingPlanes.length){var g=d.clippingPlanes;(p.x>g[0].constant||p.x<-g[1].constant||p.y>g[2].constant||p.y<-g[3].constant||p.z>g[4].constant||p.z<-g[5].constant)&&(v=!0)}if(!v){a=h,o=p,s=null!==c.instanceId&&void 0!==c.instanceId?c.instanceId:null;break}}!i.isNull(n.pick)&&a&&o&&(n.pick(a,o,s),i.isNil(a.userData)||n.select(a.userData.uniqId,a.userData.nodeId))}}},n.doubleClickAction=function(e){if(!n._isMove&&n.activeClick){var t=e.event;if(!n.shouldBlockByCtrl(t)&&e.intersect){for(var r=e.intersections,a=null,o=null,s=null,l=0,u=r.length;l<u;l++)if(!1!==r[l].object.visible&&(!r[l].object.material.transparent||0!=r[l].object.material.opacity)){var c=r[l],h=c.object,d=h.material,p=c.point,f=!1;if(null!==d.clippingPlanes&&6===d.clippingPlanes.length){var m=d.clippingPlanes;(p.x>m[0].constant||p.x<-m[1].constant||p.y>m[2].constant||p.y<-m[3].constant||p.z>m[4].constant||p.z<-m[5].constant)&&(f=!0)}if(!f){a=h,o=p,s=null!==c.instanceId&&void 0!==c.instanceId?c.instanceId:null;break}}!i.isNull(n.pick)&&a&&o&&(n.doublePick(a,o,s),i.isNil(a.userData)||n.select(a.userData.uniqId,a.userData.nodeId))}}},n.mousedownAction=function(e){if(n._isMove=!1,n.activeMutiPick){var t=n.getCore(),r=e.event;if(r.ctrlKey&&0===r.button){t.cameraControls.enabled=!1,n._mousedown=!0,n._mousedowncoords={x:r.clientX,y:r.clientY};var i={x:r.clientX/t.width*2-1,y:-r.clientY/t.height*2+1};new E.Vector3(i.x,i.y,1).unproject(t.camera)}}},n.mouseMoveAction=function(e){var t=e.event;if(n.activeMutiPick)if(t.ctrlKey&&0===t.button){var r=n.getObject(t.clientX,t.clientY);i.isNull(n.movePosition)||n.movePosition(r);var a=(0,c.default)(n),o=a._mousedown,s=a._marquee,l=a._mousedowncoords;if(o){s.style.display="block";var u={x:t.clientX-l.x,y:t.clientY-l.y};u.x<0&&u.y<0?(s.style.left=t.clientX+"px",s.style.width=-u.x+"px",s.style.top=t.clientY+"px",s.style.height=-u.y+"px"):u.x>=0&&u.y<=0?(s.style.left=l.x+"px",s.style.width=u.x+"px",s.style.top=t.clientY+"px",s.style.height=-u.y+"px"):u.x>=0&&u.y>=0?(s.style.left=l.x+"px",s.style.width=u.x+"px",s.style.height=u.y+"px",s.style.top=l.y+"px"):u.x<0&&u.y>=0&&(s.style.left=t.clientX+"px",s.style.width=-u.x+"px",s.style.height=u.y+"px",s.style.top=l.y+"px")}}else n._resetMarquee()},n.mouseUpAction=function(e){if(n.activeMutiPick){var t=e.event;if(t.ctrlKey&&0===t.button){var r=n._findCubesByVertices({x:t.clientX,y:t.clientY});n._resetMarquee();for(var a=[],o=0;o<r.length;o++){var s=r[o];s.visible&&a.push(s)}i.isNil(n.multiPick)||n.multiPick(a)}else n._resetMarquee()}},n.touchAction=function(e){if(n._isTouch){var t=e.event;if(!n.shouldBlockByCtrl(t)){if(!e.intersection||!e.intersection.object.parent)return n.touchObjUuid&&n.touch(null),n.touchObjUuid="",n.touchObjParentUuid="",void(n.touchObjParentName="");var r,i=e.intersection.object,a=e.intersection?e.intersection.point:null,o=e.intersection?e.intersection.face:null,s=null!==e.intersection.instanceId&&void 0!==e.intersection.instanceId,l=s?e.intersection.instanceId:null;(r=s?i.userData.parent[l].uuid:i.parent.uuid)!=n.touchObjParentName&&(n.touchObjParentName=r),n.touchObjUuid=i.uuid,n.touchObjParentUuid=i.parent.uuid,n.touch(i,a,l,{face:o})}}},n.getNodes=function(){var e=[],t=n.getCore(),r=t.scene,i=t.traverseNodes,a="";return i(r,(function(t){t.parent&&"Object3D"===t.parent.type&&t.parent.name!==a&&e.push(t.parent),a=t.parent.name})),e},n.getLight=function(){var e=n.getCore().scene,t=[];return e.traverse((function(e){"SpotLight"!=e.type&&"PointLight"!=e.type||t.push(e)})),t},n._createMarquee(),n.multiPick=e,n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"getUnitVertCoordinates",value:function(){var e=this,t=this.getCore(),n=[];t.traverseNodes(t.scene,(function(t){var r=e._computeVertices(t.geometry);r.applyMatrix4(t.matrixWorld),i.forEach(r.vertices,(function(e){var r={id:t.id,mesh:t,pos:{x:0,y:0},vector:e.clone()};n.push(r)}))}),!0),this._unitVertCoordinates=n}},{key:"unitVertCoordinatesDispose",value:function(){this._unitVertCoordinates=[]}},{key:"_createMarquee",value:function(){if(i.isNull(document.getElementById("select-marquee"))){var e=this._marquee;e.id="select-marquee",e.style.position="absolute",e.style.top="-2px",e.style.left="-2px",e.style.zIndex="9999",e.style.height="0px",e.style.width="10px",e.style.backgroundColor="rgba(208, 255, 242, 0.5)",e.style.border="dotted 1px #9a9a9a",e.style.margin="0",e.style.padding="0",e.style.pointerEvents="none",document.body.append(e)}}},{key:"_resetMarquee",value:function(){this.getCore().cameraControls.enabled=!0,this._mousedown=!1,this._marquee.style.display="none",this._marquee.style.width="0",this._marquee.style.height="0",this._mousedowncoords={x:0,y:0}}},{key:"_findCubesByVertices",value:function(e){for(var t=this,n=this._mousedowncoords,r={x:e.x,y:e.y},a=[],o={},s=i.map(this._unitVertCoordinates,(function(e){return e.vector&&(e.pos=t._toScreenXY(e.vector)),e})),l=this._findBounds(r,n),u=0;u<s.length;u++)this._withinBounds(s[u].pos,l)&&void 0===o[s[u].id]&&(a.push(s[u].mesh),o[s[u].id]=!0);return a}},{key:"_withinBounds",value:function(e,t){var n=t.origin.x,r=t.origin.x+t.delta.x,i=t.origin.y,a=t.origin.y+t.delta.y;return e.x>=n&&e.x<=r&&e.y>=i&&e.y<=a}},{key:"_findBounds",value:function(e,t){var n={x:0,y:0},r={x:0,y:0};return e.y<t.y?(n.y=e.y,r.y=t.y-e.y):(n.y=t.y,r.y=e.y-t.y),e.x<t.x?(n.x=e.x,r.x=t.x-e.x):(n.x=t.x,r.x=e.x-t.x),{origin:n,delta:r}}},{key:"_computeVertices",value:function(e){return e.vertices&&e.vertices.length>0?e:(new E.Geometry).fromBufferGeometry(e)}},{key:"_toScreenXY",value:function(e){var t=this.getCore(),n=t.width,r=t.height,i=t.camera,a=e.clone(),o=new E.Matrix4;return o.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),a.applyMatrix4(o),{x:(a.x+1)*n/2,y:(1-a.y)*r/2}}},{key:"boxSelection",value:function(){var e=this.getCore(),t=e.scene,n=e.camera,r=e.CSS2DRenderer;this.selectionBox=new Ue(n,t),this.helper=new He(this.selectionBox,r,"selectBox")}}])}(ke),ni.SaveView=je,ni.Translate=Ge,ni.Transparent=Ve,ni.Texture=Xe,ni.Sprite=Ye,ni.Wireframe=ze,ni.Light=at,ni.Loader=function(e){function t(e){var n,r,i;return(0,v.default)(this,t),(n=T(this,t)).gltfLoader=new E.GLTFLoader,n.fileLoader=new E.FileLoader,n.exporter=new E.GLTFExporter,n.rgbeLoader=new E.RGBELoader,n.isCameraFix=!1,n.position=new E.Vector3,n.target=new E.Vector3,n.templateAnimationMap=new Map,n.modelAnimationMap=new Map,n.version=1,n.actions={},n.getGltfDataByUrls=function(e){var t=e.map((function(e){return n.getGltfDataByUrl(e)}));return Promise.all(t)},n.getGltfDataByUrl=function(e){return new Promise((function(t,r){n.gltfLoader.load(e,(function(e){t(e.scene)}),(function(e){}),(function(e){r(e)}))}))},n.gltfLoadByUrls=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=n.getCore().cameraControls;n.isCameraFix&&s.setLookAt(n.position.x,n.position.y,n.position.z,n.target.x,n.target.y,n.target.z),r&&n._addDefaultLights();var l=e.map((function(e){return n.gltfLoadByUrl(e,t,!1,i,a,o)}));return Promise.all(l)},n.RGBELoadByUrl2=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=n.getCore(),a=i.scene,o=i.renderer;n.pmremGenerator||(o.toneMappingExposure=1,n.pmremGenerator=new E.PMREMGenerator(o),n.pmremGenerator.compileEquirectangularShader()),n.rgbeLoader.setDataType(E.UnsignedByteType).load(e,(function(e){var i=n.pmremGenerator.fromEquirectangular(e).texture;n.pmremGenerator.dispose(),t&&(a.background=i),r&&(a.environment=i),n.core.needUpdate=!0,e.dispose()}))},n.gltfLoadByUrlAndCommonData=function(e,t,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=n.getCore(),s=o.gltfAddScene,l=o.cameraControls,u=o.scene;i&&n._addDefaultLights();var c=e.lastIndexOf("/"),h=e.lastIndexOf("."),d=e.substring(c+1,h);return new Promise((function(i,o){e&&t||o(new Error("THREE.GLTFLoader: Property name error")),n.gltfLoader.loadGlb(e,t,(function(e){e.scene.name=d,s(e.scene,r,a),n.isCameraFix||l.fitTo(u,!1),i(e.scene)}),(function(e){}),(function(e){o(e)}))}))},n.gltfLoadByUrlsAndCommonData=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=n.getCore().cameraControls;n.isCameraFix&&a.setLookAt(n.position.x,n.position.y,n.position.z,n.target.x,n.target.y,n.target.z),r&&n._addDefaultLights();var o=e.map((function(e){return n.gltfLoadByUrlAndCommonData(e.url,e.commonBins,t,!1,i)}));return Promise.all(o)},n.getViewPortMatrixInverse=function(e,t){var n=new E.Matrix4,r=new E.Matrix4;return n.set(e.width/2,0,0,e.x+e.width/2,0,e.height/2,0,e.y+e.height/2,0,0,(t.far-t.near)/2,(t.far+t.near)/2,0,0,0,1),r.copy(n).invert(),r},n.addDefineWireframe=function(e){var t=n.getViewPortMatrixInverse({x:0,y:0,width:window.innerWidth,height:window.innerHeight},{near:0,far:1}),r=n.getCore().camera;r.updateProjectionMatrix();var i=new E.ShaderMaterial({uniforms:{projectionMatrixInverse:{value:r.projectionMatrixInverse},viewPortMatrixInverse:{value:t},testFlag:{value:!1}},vertexShader:"\n      varying vec3 vNormal;\n      varying vec3 vPosition;\n      varying vec4 worldPosition;\n      varying mat3 normalMatrix1;\n      varying mat4 modelMatrix1;\n      void main() {\n        //将attributes的normal通过varying赋值给了向量vNormal\n        vNormal = normal;\n        vPosition = position;\n        //projectionMatrix是投影变换矩阵 modelViewMatrix是相机坐标系的变换矩阵\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position.x, position.y, position.z, 1.0 );\n        worldPosition = modelMatrix * vec4( position.x, position.y, position.z, 1.0 );\n        normalMatrix1 = normalMatrix;\n        modelMatrix1 = modelMatrix;\n      }\n    ",fragmentShader:"\n      varying vec3 vNormal;\n      varying vec3 vPosition;\n      varying vec4 worldPosition;\n      varying mat3 normalMatrix1;\n      varying mat4 modelMatrix1;\n      //投影矩阵的逆矩阵\n      uniform mat4 projectionMatrixInverse;\n      //视口变换矩阵的逆矩阵\n\t\t\tuniform mat4 viewPortMatrixInverse;\n      void main() {\n        vec4 ndc;\n        ndc.x  = gl_PointCoord.x*2.0 - 1.0;\n        ndc.y  = gl_PointCoord.y*2.0 - 1.0;\n        ndc.z  = gl_FragCoord.z * 2.0 - 1.0;\n        ndc.w = 1.0 ;\n        //屏幕坐标系变换到NDC标准设备空间\n\t\t\t\tvec4 ndcPosition = viewPortMatrixInverse * vec4(gl_FragCoord.xyz,1.0);\n        //标准设备空间变换到剪裁空间\n\t\t\t\tvec4 clipPosition = ndc/gl_FragCoord.w;\n        //剪裁空间变换到相机空间\n\t\t\t\tvec4 viewPosition = projectionMatrixInverse * clipPosition;\n        vec3 p = normalMatrix1 * viewPosition.xyz;\n        vec4 q = modelMatrix1 * vec4( p, 1.0 );\n\n        vec4 world;\n        float cy = fract(q.x / 200.0);\n        // if(vNormal.x==0.0&&vNormal.y==1.0&&vNormal.z==0.0){\n        //   cy = 1.0;\n        // }\n        // gl_FragColor = vec4(gl_FragCoord.x/500.0*1.0,1.0,0.0,1.0);\n        if(q.x<1.0){\n          gl_FragColor = vec4(0.0,1.0,0.0,1.0);\n        }else{\n          gl_FragColor = vec4(1.0,0.0,0.0,1.0);\n        }\n\n      }\n    "});(0,n.getCore().traverseNodes)(e,(function(e){e.isMesh&&null!==e.material&&(e.material=i)}))},n.gltfLoadByUrl=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=n.getCore(),l=s.gltfAddScene,u=s.cameraControls,c=s.scene;if(!e)return Promise.reject(null);r&&n._addDefaultLights();var h=e.lastIndexOf("/"),d=e.lastIndexOf("."),p=e.substring(h+1,d);return new Promise((function(r,s){n.DB.get(e).then((function(h){var d=!1;h&&h.version&&h.version===n.version&&h.data?E.Cache.add(e,h.data):d=!0,n.gltfLoader.load(e,(function(s){s.scene.name=p,s.scene.userData.pickEnable=a,s.scene.userData.loadLevel=o,n.modelMap.set(s.scene.name,s.scene),l(s.scene,t,i);var h={};n.getModelTree(s.scene.name,s.scene,h),n.treeMap.set(s.scene.name,h),n.isCameraFix||u.fitTo(c,!1),r(s.scene),d&&n.DB.put(e,E.Cache.get(e))}),(function(e){}),(function(e){s(e)}))}))}))},n.loadGlbByData=function(e,t,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=n.getCore(),u=l.gltfAddScene,c=(l.cameraControls,l.scene,l.mixers);i&&n._addDefaultLights();var h=e.lastIndexOf("/"),d=e.lastIndexOf("."),p=e.substring(h+1,d);return new Promise((function(e,i){n.gltfLoader.loadFileDate(t,(function(t){t.scene.name=p,t.scene.userData.pickEnable=o,t.scene.userData.pickEnable=o,t.scene.userData.loadLevel=s,t.scene.visible=!1,n.modelMap.set(t.scene.name,t.scene),u(t.scene,r,a);var i={};if(n.getModelTree(t.scene.name,t.scene,i),n.treeMap.set(t.scene.name,i),t.animations.length>0){t.scene.animations=t.animations;var l=new E.AnimationMixer(t.scene);n.actions[p]=[],t.animations.forEach((function(e,t){n.actions[p].push({name:e.name,value:l.clipAction(e)})})),l.addEventListener("loop",(function(e){n.complete(e)})),c.set(p,l)}e(t.scene)}),(function(e){i(e)}))}))},n.complete=function(e){},n.removeScene=function(e){},n.loadSample=function(){return In((0,c.default)(n),void 0,void 0,o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.gltfLoadByUrl("model/403.glb"));case 1:case"end":return e.stop()}}),e,this)})))},n._addDefaultLights=function(){var e=n.getCore(),t=e.scene,r=(e.camera,new E.HemisphereLight(16777211,10262423,.8));r.position.set(0,50,0),t.add(r);var i=new E.DirectionalLight(16777211,1);i.position.set(1,.5,2),i.position.multiplyScalar(100),i.castShadow=!0,i.shadow.mapSize.width=2048,i.shadow.mapSize.height=2048;var a=5e3;i.shadow.camera.left=-a,i.shadow.camera.right=a,i.shadow.camera.top=a,i.shadow.camera.bottom=-a,i.shadow.camera.far=1e4,i.shadow.bias=-.001,t.add(i),n.core.needUpdate=!0},n.modelFilePreloadByUrl=function(e,t){return new Promise((function(r,i){n.gltfLoader.preload(t,(function(t){n.preloadMap.set(e,t),r(t)}),(function(e){}),(function(e){i(e)}))}))},n.loadPreloadDataByName=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=n.getCore(),i=r.gltfAddScene,o=r.cameraControls,s=r.scene;if(!a().isNil(n.preloadMap.get(e)))return t&&n._addDefaultLights(),new Promise((function(t,r){n.gltfLoader.loadFileDate(n.preloadMap.get(e),(function(r){i(r.scene,e,!0),n.isCameraFix||o.fitTo(s,!1),t(r.scene)}),(function(e){}),(function(e){r(e)}))}))},n.loadPreloadNewDataByName=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=n.getCore(),o=i.gltfAddScene,s=i.cameraControls,l=i.scene;if(!a().isNil(n.preloadMap.get(e)))return r&&n._addDefaultLights(),new Promise((function(r,i){e&&t||i(new Error("THREE.GLTFLoader: Property name error")),n.gltfLoader.loadNewFileDate(n.preloadMap.get(e),t,(function(t){o(t.scene,e,!0),n.isCameraFix||s.fitTo(l,!1),r(t.scene)}),(function(e){}),(function(e){r(null)}))}))},n.modelFilePreloadByUrls=function(e){var t=e.map((function(e){return n.modelFilePreloadByUrl(e.id,e.url)}));return Promise.all(t)},n.loadPreloadDataByNames=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n.getCore().cameraControls,t&&n._addDefaultLights();var i=e.map((function(e){return n.loadPreloadDataByName(e,!1,r)}));return Promise.all(i)},n.loadPreloadNewDataByGlbInfos=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=n.getCore().cameraControls;n.isCameraFix&&i.setLookAt(n.position.x,n.position.y,n.position.z,n.target.x,n.target.y,n.target.z),t&&n._addDefaultLights();var a=e.map((function(e){return n.loadPreloadNewDataByName(e.id,e.commonBins,!1,r)}));return Promise.all(a)},n.createGeometry=function(e,t){for(var r=[],i=[],a=new E.Geometry,o=0;o<e.length;o++)r.push(new E.Vector3(e[o].x/1e3,e[o].y/1e3,e[o].z/1e3));for(var s=0;s<t.length;s++){var l=t[s];i.push(new E.Face3(l.posIndex1-1,l.posIndex2-1,l.posIndex3-1))}for(var u=new E.Color(11776947),c=0;c<i.length;c++){var h=i[c];h.vertexColors.push(u),h.vertexColors.push(u),h.vertexColors.push(u)}a.vertices=r,a.faces=i,a.computeFaceNormals(),a.computeBoundingSphere(),a.computeBoundingBox();var d=new E.Mesh(a,new E.MeshStandardMaterial({wireframe:!1,side:E.DoubleSide,metalness:0,roughness:1,vertexColors:!0,envMapIntensity:.2,flatShading:!0}));return d.name="powerMesh",d.rotation.x=Math.PI,n.getCore().scene.add(d),n.core.needUpdate=!0,d},E.Cache.enabled=!0,n.gltfLoader.setMeshoptDecoder(h),n.templateModelMap=new Map,n.modelMap=new Map,n.loadMap=new Map,n.treeMap=new Map,n.preloadMap=new Map,n.version=null!==(r=e&&e.version)&&void 0!==r?r:1,n.DB=new ot(null!==(i=null==e?void 0:e.cacheDBName)&&void 0!==i?i:"ModelsDB",n.version),a().isNil(e)||(a().isBoolean(e.isCameraFix)&&(n.isCameraFix=e.isCameraFix),a().isNil(e.position)||(n.position=e.position),a().isNil(e.target)||(n.target=e.target)),n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"setDraco",value:function(e){var t=new E.DRACOLoader;t.setDecoderPath(e),this.gltfLoader.setDRACOLoader(t)}},{key:"getAllMaterial",value:function(e){var t=[],n=[];return e&&e.traverse((function(e){"Mesh"===e.type&&-1==t.indexOf(e.material.uuid)&&(n.push({name:e.material.name,hasMap:!!e.material.map,firstMesh:e}),t.push(e.material.uuid))})),n}},{key:"getModelTree",value:function(e,t,n){n.name=t.name,n.id=t.uuid,n.rootCode=e,n.code=t.name,n.codeName=t.name,n.children=[],n.nodeUuid=t.name,n.nodeName=t.name,t.userData.node_tag&&(n.nodeName=t.userData.node_tag),"level_elevation"in t.userData&&(n.levelElevation=t.userData.level_elevation),"Mesh"===t.type&&(t.userData.modelName=e);var r=t.children;if(r.length)for(var i=0;i<r.length;i++)n.children[i]={},this.getModelTree(e,r[i],n.children[i])}},{key:"addGLTFModelByUrl",value:function(e,t,n){var r=this,i=this.getCore(),a=i.gltfAddScene,o=i.mixers;return new Promise((function(i,s){r.gltfLoader.load(e,(function(e){var s=e.scene;s.name=t,s.position.set(n.x,n.y,n.z),a(s,t);var l=e.animations;if(l.length){var u=new E.AnimationMixer(s);r.actions[t]=[],l.forEach((function(e){r.actions[t].push({name:e.name,value:u.clipAction(E.AnimationUtils.subclip(e,e.name,0,30))})})),o.set(t,u)}r.modelMap.set(t,s),i(s)}))}))}},{key:"removeGLTFModelByName",value:function(e){var t=this.core.dispose;this.modelMap.get(e)&&t(this.modelMap.get(e)),this.core.needUpdate=!0}},{key:"removeAllGLTFModel",value:function(){var e=this.core.dispose;this.modelMap.forEach((function(t){e(t)})),this.core.needUpdate=!0}},{key:"startAnimation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.actions[e]&&this.actions[e].forEach((function(e){e.timeScale=t,e.value.play()}))}},{key:"setAction",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=E.LoopRepeat;1===i&&(o=E.LoopOnce),a&&(o=E.LoopPingPong),this.actions[e]&&this.actions[e].forEach((function(e){e.name==t&&(n?(e.value.timeScale=r,e.value.setLoop(o,i).stop().play()):e.value.stop())}))}},{key:"setAction2",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,a=arguments.length>6?arguments[6]:void 0;a(),this.actions[e]&&this.actions[e].forEach((function(e){e.name==t&&(n?(e.value.timeScale=r,e.value.setLoop(E.LoopRepeat,i).play()):e.value.stop())})),this.complete=function(){a()}}},{key:"setLineAction",value:function(e){for(var t=this,n=[],r=function(r){Object.keys(t.actions).forEach((function(i){t.actions[i].forEach((function(t){t.name===e[r]&&n.push(t.value)}))}))},i=0;i<e.length;i++)r(i);this.complete=function(e){n[n.length-1].stop(),n.pop(),n.length&&n[n.length-1].setLoop(E.LoopOnce).play()},n[n.length-1].setLoop(E.LoopOnce).play()}},{key:"getAction",value:function(){var e=this,t={};return Object.keys(this.actions).forEach((function(n){t[n]=[],e.actions[n].forEach((function(e){t[n].push(e.name)}))})),this.actions}},{key:"stopAnimation",value:function(e){this.actions[e]&&this.actions[e].forEach((function(e){e.value.stop()}))}},{key:"stopAllAnimation",value:function(){for(var e in this.actions)this.actions[e].forEach((function(e){e.value.stop()}))}},{key:"addSkyBox",value:function(e){var t=this;return new Promise((function(n,r){var i=t.getCore().scene;e&&e.constructor==Array&&6==e.length&&(new E.CubeTextureLoader).load(e,(function(e){i.background=e,n(null),t.core.needUpdate=!0}),(function(e){}),(function(e){throw new Error("SkyBox Error")}))}))}},{key:"addSkyBoxByUrls",value:function(e,t){var n=this,r=this.getCore().scene;this.skyBox=e;var i=function(i){(new E.CubeTextureLoader).load(e[i],(function(e){n.skyBox[i]=e,i==t&&(r.background=n.skyBox[i],n.getCore().cubeTexture=n.skyBox[i],n.core.needUpdate=!0)}),(function(e){}),(function(e){throw new Error("SkyBox Error")}))};for(var a in e)i(a)}},{key:"changeSkyBox",value:function(e){this.getCore().scene.background=this.skyBox[e],this.getCore().cubeTexture=this.skyBox[e],this.core.needUpdate=!0}},{key:"removeSkybox",value:function(){var e=this.getCore(),t=e.scene,n=e.dispose;t.background=null,this.getCore().cubeTexture=null,this.core.needUpdate=!0,t.children.forEach((function(e){"sky"==e.userData.type&&n(e)}))}},{key:"addSkyBox4",value:function(e,t,n){var r=this;return new Promise((function(i,a){var o,s=r.getCore().scene;s.children.forEach((function(e){"sky"==e.userData.type&&(o=e)})),o?(null!=n&&(o.geometry.dispose(),o.geometry=new E.SphereGeometry(n,64,32)),(new E.TextureLoader).load(e,(function(e){o.material.map=e,o.material.map.needsUpdate=!0,r.core.needUpdate=!0,i(null)}))):(new E.TextureLoader).load(e,(function(e){(o=new E.Mesh(new E.SphereGeometry(n,64,32),new E.MeshBasicMaterial({map:e,side:E.BackSide}))).name="skybox",o.position.set(t.x,t.y,t.z),o.userData.type="sky",s.add(o),r.core.needUpdate=!0,i(null)}))}))}},{key:"addSkyBox3",value:function(){var e=this.getCore(),t=e.scene,n=(0,e.bbox)(),r=n.getCenter(new E.Vector3),i=n.getSize(new E.Vector3),a={topColor:{value:new E.Color(30719)},bottomColor:{value:new E.Color(12902397)},offset:{value:400},exponent:{value:.6}},o=new E.SphereGeometry(i.length(),64,64),s=new E.ShaderMaterial({uniforms:a,vertexShader:["varying vec3 vWorldPosition;","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","   vWorldPosition = worldPosition.xyz;","   gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 topColor;","uniform vec3 bottomColor;","uniform float offset;","uniform float exponent;","varying vec3 vWorldPosition;","void main() {","    float h = normalize( vWorldPosition + offset ).y;","    gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );","}"].join("\n"),side:E.DoubleSide}),l=new E.Mesh(o,s);l.position.set(r.x,r.y,r.z),l.userData.type="sky",t.add(l),this.core.needUpdate=!0}},{key:"addTemplateModel",value:function(e,t,n){var r=this;if(!e)return Promise.reject(null);var i=this.getCore().traverseNodes;return new Promise((function(a,o){var s=r.templateModelMap.get(t);null!=s&&a(s),r.DB.get(e).then((function(o){var l=!1;o&&o.version&&o.version===r.version&&o.data?E.Cache.add(e,o.data):l=!0,r.gltfLoader.load(e,(function(o){o.animations&&r.templateAnimationMap.set(t,o.animations),s=o.scene,i(s,(function(e){e.isMesh&&null!==e.material&&(e.material.shadowSide=1,0!=e.material.opacity&&(e.castShadow=!0,e.receiveShadow=!0),n&&e.material.color.setHex(n),e.material.opacity<1?(e.material.transparent=!0,e.material.depthWrite=!1):e.material.map||1!=e.material.opacity||(e.material.transparent=!1,e.material.depthWrite=!0))})),s.userData.templateType=t,s.userData.isTemplate=!0,r.templateModelMap.set(t,s),a(s),l&&r.DB.put(e,E.Cache.get(e))}),(function(e){}),(function(e){a(null)}))}))}))}},{key:"addCustomModel",value:function(e,t){var n=this;if(!e)return Promise.reject(null);var r=this.getCore(),i=r.scene,a=r.traverseNodes;return new Promise((function(r,o){n.DB.get(e).then((function(s){var l=!1;s&&s.version&&s.version===n.version&&s.data?E.Cache.add(e,s.data):l=!0,n.gltfLoader.load(e,(function(o){var s,u=o.scene.children[0];if(t){(s=(new E.TextureLoader).load(t)).wrapS=E.RepeatWrapping,s.wrapT=E.RepeatWrapping,s.repeat.set(1,1);var c=new E.MeshStandardMaterial({side:E.DoubleSide,transparent:!0,color:16777215,emissive:16777215,map:s,needsUpdate:!0,emissiveIntensity:1,emissiveMap:s,flatShading:!0,depthWrite:!1});a(u,(function(e){e.isMesh&&null!==e.material&&(e.material=c,e.renderOrder=20)})),u.material=c,u.scale.y=0}i.add(u),n.core.needUpdate=!0,r({object:u,texture:s}),l&&n.DB.put(e,E.Cache.get(e))}),(function(e){}),(function(e){o(null)}))}))}))}},{key:"addTemplateModels",value:function(e){var t=this,n=e.map((function(e){return t.addTemplateModel(e.url,e.name)}));return Promise.all(n)}},{key:"addSignageModelByCoord",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0,z:0},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:1,y:1,z:1},o=arguments.length>5?arguments[5]:void 0;if(!this.modelMap.get(n)){var s=this.getCore().getSceneByModelName;if(!a().isNil(this.templateModelMap)&&!a().isNil(this.templateModelMap.get(t))){var l=this.templateModelMap.get(t).clone(),u=s(t);l.name=n,l.userData.type=o,l.userData.uniqId=n,this.modelMap.set(n,l);var c={};if(this.getModelTree(n,l,c),this.treeMap.set(l.name,c),l.updateWorldMatrix(!0,!0),"面片树"!=o&&"TRAY"!=o){var h=Me(l);l.add(h)}return l.userData.isOnly=!0,l.traverse((function(e){"Mesh"===e.type&&("外立面"!=o&&"地形"!=o?(e.castShadow=!1,e.receiveShadow=!1,e.userData.renderOrder&&(e.renderOrder=Number(e.userData.renderOrder))):(e.geometry.getAttribute("normal")||e.geometry.computeVertexNormals(),e.material.emissiveIntensity=0,e.material.envMapIntensity=1,e.userData.renderOrder&&(e.renderOrder=Number(e.userData.renderOrder))))})),l.updateMatrixWorld(),u.add(l),l.position.set(e.x,e.y,e.z),l.rotation.set(r.x,r.y,r.z),l.scale.set(i.x,i.y,i.z),this.core.needUpdate=!0,l}}}},{key:"addMarkToModel",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{x:1,y:1,z:1};if(!a().isNil(this.templateModelMap)&&!a().isNil(this.templateModelMap.get(t))){var s=this.templateModelMap.get(t).clone();s.name=n,s.position.set(r.x,r.y,r.z),s.rotation.set(i.x,i.y,i.z),s.scale.set(o.x,o.y,o.z),e.add(s),this.core.needUpdate=!0}}},{key:"updateTrayScale",value:function(e,t){if(!e.userData.rebuildTray){var n=[];e.traverse((function(e){if("Mesh"==e.type){var t=(new E.Box3).setFromObject(e).getCenter(new E.Vector3);e.geometry=e.geometry.clone();var r=e.geometry;if(r.applyMatrix4(e.matrixWorld),r.translate(-t.x,-t.y,-t.z),r.computeBoundingBox(),r.computeBoundingSphere(),e.position.copy(t),e.rotation.set(0,0,0),e.scale.set(1,1,1),n.push(e),e.name.indexOf("MCYB_A08.01")>-1){var i=r.getAttribute("position"),a=r.getAttribute("uv");if(a){for(var o,s,l,u,c=-1/0,h=1/0,d=-1/0,p=1/0,f=0;f<i.count;f++){var m=i.array[3*f],v=i.array[3*f+2];m>c&&(c=m,o=f),m<h&&(h=m,s=f),v>d&&(d=v,l=f),v<p&&(p=v,u=f)}for(var g=-1/0,y=1/0,x=-1/0,b=1/0,M=0;M<a.count;M++){var w=a.array[2*M],_=a.array[2*M+1];w>g&&(g=w),w<y&&(y=w),_>x&&(x=_),_<b&&(b=_)}var A=(a.array[2*o]>a.array[2*s]?1:-1)*(g-y)/(c-h),C=(a.array[2*l+1]>a.array[2*u+1]?1:-1)*(x-b)/(d-p);e.userData.radioX=A,e.userData.radioY=C}}}}));var r=e.children[0];r.clear(),n.forEach((function(e){r.add(e)})),e.userData.rebuildTray=!0}var i=this.templateModelMap.get(e.userData.templateType),a=new E.Box3;a.setFromObject2(i);var o=a.getCenter(new E.Vector3),s=a.getSize(new E.Vector3),l=(t.x-1)*s.x/2,u=(t.z-1)*s.z/2;e.traverse((function(e){if("Mesh"==e.type){e.oldGeometry||(e.oldGeometry=e.geometry,e.geometry=e.geometry.clone());var t=e.geometry.getAttribute("position"),n=e.oldGeometry.getAttribute("position"),r=null,i=null;if(e.name.indexOf("MCYB_A08.01")>-1&&(r=e.geometry.getAttribute("uv"),i=e.oldGeometry.getAttribute("uv")),e.name.indexOf("MCYB_A08.02.02")>-1){e.oldPosition||(e.oldPosition=e.position.clone());var a=e.oldPosition.x,s=e.oldPosition.z;a>o.x&&s>o.z?(e.position.x=a+l>0?a+l:0,e.position.z=s+u>0?s+u:0):a>o.x&&s<o.z?(e.position.x=a+l>0?a+l:0,e.position.z=s-u<0?s-u:0):a<o.x&&s>o.z?(e.position.x=a-l<0?a-l:0,e.position.z=s+u>0?s+u:0):a<o.x&&s<o.z&&(e.position.x=a-l<0?a-l:0,e.position.z=s-u<0?s-u:0)}else{for(var c=0;c<t.count;c++){var h=n.getX(c),d=n.getZ(c);h>o.x&&d>o.z?(t.setX(c,h+l),t.setZ(c,d+u),r&&(r.setX(c,i.getX(c)+l*e.userData.radioX),r.setY(c,i.getY(c)+u*e.userData.radioY))):h>o.x&&d<o.z?(t.setX(c,h+l),t.setZ(c,d-u),r&&(r.setX(c,i.getX(c)+l*e.userData.radioX),r.setY(c,i.getY(c)-u*e.userData.radioY))):h<o.x&&d>o.z?(t.setX(c,h-l),t.setZ(c,d+u),r&&(r.setX(c,i.getX(c)-l*e.userData.radioX),r.setY(c,i.getY(c)+u*e.userData.radioY))):h<o.x&&d<o.z&&(t.setX(c,h-l),t.setZ(c,d-u),r&&(r.setX(c,i.getX(c)-l*e.userData.radioX),r.setY(c,i.getY(c)-u*e.userData.radioY)))}e.geometry.computeBoundingBox(),e.geometry.computeBoundingSphere()}t.needsUpdate=!0,r&&(r.needsUpdate=!0)}})),this.core.needUpdate=!0}},{key:"addTemplateModelByMatrix",value:function(e,t){var n,r=this,i=this.getCore(),o=i.getSceneByModelName,s=i.touchTargetObjs,l=i.touchTargetIDs;if(!a().isNil(this.templateModelMap)&&!a().isNil(this.templateModelMap.get(e))&&this.getCore().scene){var u=o(e);if(u.visible=!1,0!=t.length){if(t.forEach((function(n){var i,a,o=n.name;if(!(r.modelMap.get(o)||r.loadMap.get(o)&&"start"==r.loadMap.get(o).status&&r.loadMap.get(o).isDelete)){(a=!1===n.isTemplate?r.templateModelMap.get(e):r.templateModelMap.get(e).clone()).name=o,a.userData.type=n.type,r.templateAnimationMap.has(e)&&r.modelAnimationMap.set(o,r.templateAnimationMap.get(e)),r.modelMap.set(o,a),r.loadMap.get(o).status="end";var c={};r.getModelTree(o,a,c),r.treeMap.set(a.name,c);var h="面片树"!==n.type&&"TRAY"!==n.type&&0===(null!==(i=r.templateAnimationMap.get(e))&&void 0!==i?i:[]).length;if(1===t.length){if(a.updateWorldMatrix(!0,!0),h){var d=Me(a);a.add(d)}a.userData.isOnly=!0,a.traverse((function(e){"Mesh"===e.type&&(n.touchEnable&&(e.userData.touchEnable=!0,s.push(e),l.push(e.uuid)),"外立面"!==n.type&&"地形"!==n.type?(e.castShadow=!1,e.receiveShadow=!1,n.renderOrder&&(e.renderOrder=n.renderOrder),e.userData.renderOrder&&(e.renderOrder=Number(e.userData.renderOrder))):(e.geometry.getAttribute("normal")||e.geometry.computeVertexNormals(),e.material.emissiveIntensity=0,e.material.envMapIntensity=1,n.renderOrder&&(e.renderOrder=n.renderOrder),e.userData.renderOrder&&(e.renderOrder=Number(e.userData.renderOrder))))}))}else a.userData.isOnly=!1;a.visible=n.show,u.add(a),a.position.set(n.position.x,n.position.y,n.position.z),a.rotation.set(n.rotation.x,n.rotation.y,n.rotation.z),"TRAY"==a.userData.type?(a.scale.y=n.scale.y,r.updateTrayScale(a,n.scale)):a.scale.set(n.scale.x,n.scale.y,n.scale.z),t.length>1&&a.updateWorldMatrix(!0,!0)}})),t.length>1){var c=t[0];if("面片树"!==c.type&&"TRAY"!==c.type&&0===(null!==(n=this.templateAnimationMap.get(e))&&void 0!==n?n:[]).length){var h=Me(u);u.add(h)}u.traverse((function(e){"Mesh"===e.type&&(c.touchEnable&&(e.userData.touchEnable=!0,s.push(e),l.push(e.uuid)),"外立面"!=c.type&&"地形"!=c.type?(e.castShadow=!1,e.receiveShadow=!1,c.renderOrder&&(e.renderOrder=c.renderOrder),e.userData.renderOrder&&(e.renderOrder=Number(e.userData.renderOrder))):(e.geometry.getAttribute("normal")||e.geometry.computeVertexNormals(),e.material.emissiveIntensity=0,e.material.envMapIntensity=1,c.renderOrder&&(e.renderOrder=c.renderOrder),e.userData.renderOrder&&(e.renderOrder=Number(e.userData.renderOrder))))}))}return this.core.needUpdate=!0,u}}}},{key:"addTemplateModelsByCesium",value:function(e,t){var n=this,r=this.getCore(),i=r.getSceneByModelName,o=r.touchTargetObjs,s=r.touchTargetIDs;if(!a().isNil(this.templateModelMap)&&!a().isNil(this.templateModelMap.get(e))){var l=i(e);return t.forEach((function(t){var r=t.name,i=n.templateModelMap.get(e).clone();i.name=r,i.userData.type=t.type,n.modelMap.set(r,i);var a={};n.getModelTree(r,i,a),n.treeMap.set(i.name,a);var u=Me(i);i.add(u),i.traverse((function(e){"Mesh"===e.type&&(t.touchEnable&&(e.userData.touchEnable=!0,o.push(e),s.push(e.uuid)),"外立面"!=t.type&&"地形"!=t.type?(e.castShadow=!1,e.receiveShadow=!1,t.renderOrder&&(e.renderOrder=t.renderOrder),e.userData.renderOrder&&(e.renderOrder=Number(e.userData.renderOrder))):(e.geometry.getAttribute("normal")||e.geometry.computeVertexNormals(),e.material.emissiveIntensity=0,e.material.envMapIntensity=1,t.renderOrder&&(e.renderOrder=t.renderOrder),e.userData.renderOrder&&(e.renderOrder=Number(e.userData.renderOrder))))})),l.add(i),i.position.set(t.position.x,t.position.y,t.position.z),i.scale.set(t.scale.x,t.scale.y,t.scale.z),i.updateMatrixWorld(),i.isCesium=!0,i.matrixWorld2=i.matrixWorld.clone();var c=(new E.Vector3).subVectors(t.position,t.centerHigh).normalize();i.up.copy(c),i.lookAt(t.centerHigh.x,t.centerHigh.y,t.centerHigh.z);var h=(new E.Matrix4).makeRotationFromEuler(i.rotation),d=(new E.Matrix4).makeRotationFromEuler(new E.Euler(Math.PI/2,0,0));h.multiply(d);var p=(new E.Matrix4).makeRotationFromEuler(new E.Euler(t.rotation.x,t.rotation.y,t.rotation.z));h.multiply(p),i.userData.rotationY=t.rotation.y,i.rotation.copy((new E.Euler).setFromRotationMatrix(h))})),this.core.needUpdate=!0,l}}},{key:"removeTemplateModelByType",value:function(e){var t=this,n=this.getCore(),r=n.dispose,i=n.scene;this.templateModelMap.delete(e),this.modelMap.forEach((function(n,r){n.userData.templateType===e&&(t.modelMap.delete(r),t.treeMap.delete(r))}));var a,o=w(i.children);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.name===e&&r(s)}}catch(e){o.e(e)}finally{o.f()}this.core.needUpdate=!0}},{key:"removeAllTemplateModel",value:function(e){var t=this,n=this.getCore().dispose,r=[];this.modelMap.forEach((function(e,t){e.userData.isTemplate&&r.push(t)})),r.forEach((function(e){var r=t.modelMap.get(e);n(r),t.modelMap.delete(e),t.treeMap.delete(e)})),this.templateModelMap=new Map,this.core.needUpdate=!0}},{key:"removeSignageModelByType",value:function(e){var t=this;this.modelMap.forEach((function(n,r){n.userData.templateType===e&&(n.parent.remove(n),t.modelMap.delete(r),t.treeMap.delete(r))})),this.core.needUpdate=!0}},{key:"removeTemplateModelByName",value:function(e){this.loadMap.get(e)&&(this.loadMap.get(e).isDelete=!0);var t=this.getCore(),n=t.dispose,r=t.hideObject3D;if(!a().isNil(e)&&!a().isNil(this.modelMap.get(e))){var i=this.modelMap.get(e);i.userData.isOnly||r(i),this.modelMap.delete(e),this.modelAnimationMap.delete(e);var o=i.parent;o.remove(i);var s=!1;o.children.forEach((function(e){e.userData.isTemplate&&(s=!0)})),s||(this.templateModelMap.delete(o.name),n(i),n(o)),this.treeMap.delete(e),this.loadMap.delete(e),this.core.needUpdate=!0}}},{key:"loadJsonFile",value:function(e){var t=this;return this.fileLoader.setResponseType("json"),new Promise((function(n,r){t.fileLoader.load(e,(function(e){n(e)}),(function(e){}),(function(e){r(e)}))}))}},{key:"loadJsonFiles",value:function(e){var t=this,n=e.map((function(e){return t.loadJsonFile(e)}));return Promise.all(n)}},{key:"gltfExport",value:function(e,t,n,r){this.exporter.parse(e,(function(e){var r=document.createElement("a"),i=new Blob([e],{type:"application/octet-stream"}),a=window.URL.createObjectURL(i);r.href=a,r.download=t||"data.json",r.dispatchEvent(new MouseEvent("click")),document.body.appendChild(r),setTimeout((function(){r.addEventListener("load",(function(){n&&n()})),document.body.removeChild(r),window.URL.revokeObjectURL(a)}),10)}),{binary:!0,animations:null!=r?r:[]})}},{key:"addToZip",value:function(e,t,n){var r=this;return new Promise((function(i,a){r.exporter.parse(t,(function(t){e.file(n,t,{binary:!0}),i()}),{binary:!0})}))}},{key:"gltfExport2",value:function(e,t){var n=this,r={},i=Promise.resolve();e.children[0].children.forEach((function(a){var o;a.position.set(0,0,0),a.name in r?(o=a.name+"_"+r[a.name],r[a.name]++):(o=a.name,r[a.name]=1),i=i.then((function(){return n.addToZip(t,a,e.name+"-"+o+".glb")}))})),i.then((function(){t.generateAsync({type:"blob"}).then((function(t){var n=document.createElement("a");n.href=URL.createObjectURL(t),n.download=e.name+".zip",document.body.appendChild(n),n.click(),document.body.removeChild(n)}))}))}},{key:"add3DTile",value:function(e){var t=this.getCore(),n=t.tilesRenderers,r=t.camera,i=t.renderer,a=t.scene,o=new Rn(e);o.manager.addHandler(/\.gltf$/,this.gltfLoader),o.setCamera(r),o.setResolutionFromRenderer(r,i),a.add(o.group),o.onLoadModel=function(e){},n.push(o)}},{key:"exportCadModel",value:function(e){for(var t=this.getCore().scene,n=null,r=0;r<t.children.length;r++){var i=t.children[r];if("cadModel"==i.name){n=i;break}}null==n||this.gltfExport(n,e,null)}},{key:"createBufferGeometry",value:function(e,t){for(var n=new E.BufferGeometry,r=[],i=[],a=[],o=0,s=0,l=e.length;s<l;s++){var u=e[s],c=e[s+1>l-1?0:s+1];r.push(u.x),r.push(u.y),r.push(u.z),r.push(u.x),r.push(u.y+t),r.push(u.z);var h=u.distanceTo(c);i.push(o,0,o,1),o+=h}for(var d=0,p=i.length;d<p;d++)d%2==0&&(i[d]/=o);n.setAttribute("position",new E.Float32BufferAttribute(r,3)),n.setAttribute("uv",new E.Float32BufferAttribute(i,2));for(var f=0,m=r.length/3;f<m;f++)f+2<m&&a.push(f+1),f%2==0?(a.push(f),a.push(f+2)):(a.push(f+2),a.push(f));return n.setIndex(a),n}},{key:"createBufferGeometry2",value:function(e,t){for(var n=[],r=[],i=0,a=n.length,o=r.length;i<e.length-1;i++){var s=.96,l=e[i],u=e[i+1];n[a++]=l.x,n[a++]=l.y,n[a++]=l.z,r[o++]=0,r[o++]=.1,n[a++]=u.x,n[a++]=l.y,n[a++]=u.z,r[o++]=1,r[o++]=.1,n[a++]=l.x,n[a++]=l.y+t,n[a++]=l.z,r[o++]=0,r[o++]=s,n[a++]=l.x,n[a++]=l.y+t,n[a++]=l.z,r[o++]=0,r[o++]=s,n[a++]=u.x,n[a++]=l.y,n[a++]=u.z,r[o++]=1,r[o++]=.1,n[a++]=u.x,n[a++]=l.y+t,n[a++]=u.z,r[o++]=1,r[o++]=s}var c=new E.BufferGeometry;return c.setAttribute("position",new E.BufferAttribute(new Float32Array(n),3)),c.setAttribute("uv",new E.BufferAttribute(new Float32Array(r),2)),c.computeVertexNormals(),c}},{key:"createBufferGeometry3",value:function(e,t){for(var n=[],r=[],i=[],a=0,o=n.length,s=r.length;a<e.length-1;a++){var l=.96,u=e[a],c=e[a+1];n[o++]=u.x,n[o++]=0,n[o++]=u.z,r[s++]=a/(e.length-1),r[s++]=.1,i.push(Math.floor(o/3)),n[o++]=c.x,n[o++]=0,n[o++]=c.z,r[s++]=(a+1)/(e.length-1),r[s++]=.1,i.push(Math.floor(o/3)),n[o++]=u.x,n[o++]=t,n[o++]=u.z,r[s++]=a/(e.length-1),r[s++]=l,i.push(Math.floor(o/3)),n[o++]=u.x,n[o++]=t,n[o++]=u.z,r[s++]=a/(e.length-1),r[s++]=l,i.push(Math.floor(o/3)),n[o++]=c.x,n[o++]=0,n[o++]=c.z,r[s++]=(a+1)/(e.length-1),r[s++]=.1,i.push(Math.floor(o/3)),n[o++]=c.x,n[o++]=t,n[o++]=c.z,r[s++]=(a+1)/(e.length-1),r[s++]=l,i.push(Math.floor(o/3))}var h=new E.BufferGeometry;return h.setAttribute("position",new E.BufferAttribute(new Float32Array(n),3)),h.setAttribute("uv",new E.BufferAttribute(new Float32Array(r),2)),h.computeVertexNormals(),h}},{key:"createChinaMap",value:function(e,t,n,r,i){var a=this,o=this.getCore(),l=o.scene,c=o.renderer;this.loadJsonFile(e).then((function(e){var o=new s.Group;o.name="中国";var h=new s.MeshStandardMaterial({transparent:!0,opacity:.8,color:199703,metalness:.4,roughness:.71,depthWrite:!1}),d=new s.MeshStandardMaterial({color:3890311,metalness:.899999976158142,roughness:1,transparent:!0,depthWrite:!1}),p=(new E.TextureLoader).load(r.insideTextureUrl);p.wrapS=E.RepeatWrapping,p.wrapT=E.RepeatWrapping,p.repeat.set(.01,1);var f=new s.MeshStandardMaterial({metalness:.4,roughness:.7,opacity:.5,transparent:!0,depthWrite:!1,map:p});e.features.forEach((function(e,i){if(""!=e.properties.name){var l=new s.Object3D;l.name=e.properties.name;var c=[],p=[],m=[];if(e.geometry.coordinates.forEach((function(n,i){var o,l=new s.Shape,h=n[0];"内蒙古自治区"==e.properties.name&&(h=n);var d=[],f=[];h.forEach((function(e,n){var r=t(e),i=(0,u.default)(r,2),a=i[0],c=i[1];d.push(new s.Vector3(a,-c,0)),f.push(new s.Vector3(a,-5,c));var p=[a,-c];0==n?(l.moveTo(p[0],p[1]),o=p):l.lineTo(p[0],p[1]),n==h[0].length-1&&o&&l.lineTo(o[0],o[1])})),c.push(l);var v=new E.PathPointList,g=new E.Vector3(0,0,1);v.set(d,.01,10,g,!0);var y=new E.PathGeometry;if(y.update(v,{width:2*r.radius,progress:1,arrow:!1}),y.pathPointList=v,p.push(y),f.length>0){var x=a.createBufferGeometry2(f,5);x.computeVertexNormals(),m.push(x)}})),p.length>0){var v=be.mergeBufferGeometries(p),g=new s.Mesh(v,d);g.renderOrder=1.55,g.castShadow=!0,g.receiveShadow=!0,g.name=e.properties.name+"线",l.add(g)}var y=new s.ShapeGeometry(c),x=new s.Mesh(y,h);x.layers.enable(5),x.name=e.properties.name+"面",x.userData.type=e.properties.level,x.userData.adcode=e.properties.adcode,x.userData.center=t(e.properties.center),x.userData.centroid=t(e.properties.centroid),x.userData.p=t(e.properties.p);var b=e.properties.rotation;b>-90&&b<90&&(b+=180),b>=-180&&b<=-90&&(b+=360),b<180?b+=45:b-=45,x.userData.rotation=b*Math.PI/180;var M=(new E.Box3).setFromObject(x).getSize(new E.Vector3).length();if(x.userData.size=M,e.properties.name==n?(x.renderOrder=1.7,x.visible=!1):(x.renderOrder=1.5,x.receiveShadow=!0),l.add(x),l.rotateX(-Math.PI/2),o.add(l),m.length>0){var w=be.mergeBufferGeometries(m),_=new s.Mesh(w,f);_.renderOrder=0,_.name=e.properties.name+"内立面",_.rotateX(Math.PI/2),l.add(_)}}})),l.add(o),c.shadowMap.needsUpdate=!0,a.core.needUpdate=!0,i&&i()}))}},{key:"addChinaTexture",value:function(e,t,n,r){var i=this.getCore().scene,a=(new s.TextureLoader).load(e);a.wrapS=E.RepeatWrapping,a.wrapT=E.RepeatWrapping;var o=new s.MeshStandardMaterial({color:16777215,map:a,transparent:!0,depthWrite:!1}),l=new E.PlaneGeometry(t,n),u=new E.Mesh(l,o);u.position.set(r.x,r.y,r.z),u.rotation.x=-.5*Math.PI,u.renderOrder=.5,u.name="中国地图轮廓倒影",i.add(u),this.core.needUpdate=!0}},{key:"addBaseTexture2",value:function(e,t,n,r,i){var a=this.getCore().scene,o=(new s.TextureLoader).load(e);o.wrapS=E.RepeatWrapping,o.wrapT=E.RepeatWrapping,o.encoding=E.sRGBEncoding,o.repeat.set(i||100,i||100);var l=new s.MeshStandardMaterial({color:16777215,map:o,metalness:.3,roughness:1,transparent:!0,opacity:.8,depthWrite:!1}),u=new E.PlaneGeometry(t,n),c=new E.Mesh(u,l);c.layers.enable(5),c.position.set(r.x,r.y,r.z),c.rotation.x=-.5*Math.PI,c.renderOrder=1,c.name="底图网格",a.add(c),this.core.needUpdate=!0}},{key:"addBaseTexture",value:function(e,t,n,r,i,a){var o=this.getCore().scene,l=(new s.TextureLoader).load(e);l.wrapS=E.RepeatWrapping,l.wrapT=E.RepeatWrapping,l.encoding=E.sRGBEncoding,l.repeat.set(a||100,a||100);var u=new s.MeshStandardMaterial({color:16777215,map:l,metalness:.4,roughness:.71,transparent:!0,opacity:.3,depthWrite:!1}),c=(new s.TextureLoader).load(t);c.wrapS=E.RepeatWrapping,c.wrapT=E.RepeatWrapping,c.encoding=E.sRGBEncoding;var h=new s.MeshStandardMaterial({color:16777215,map:c,metalness:.4,roughness:.7,transparent:!1}),d=new E.PlaneGeometry(n,r),p=new E.Mesh(d,u);p.layers.enable(5),p.position.set(i.x,i.y,i.z),p.rotation.x=-.5*Math.PI,p.renderOrder=1,p.name="底图网格",o.add(p);var f=new E.Mesh(d,h);f.position.set(i.x,i.y-10,i.z),f.rotation.x=-.5*Math.PI,f.renderOrder=.3,f.name="纯色底图",o.add(f),this.core.needUpdate=!0}},{key:"createProvinceMap2",value:function(e,t,n,r,i){var a=this,o=this.getCore(),l=o.scene,c=o.renderer,h=o.touchTargetObjs;o.getCenterAndSize,this.loadJsonFile(t).then((function(t){var o=new s.Group;o.name=e;var d=new s.MeshStandardMaterial({transparent:!0,opacity:r&&"polygonOpacity"in r?r.polygonOpacity:.6,color:(null==r?void 0:r.polygonColor)?r.polygonColor:270122,metalness:.4,roughness:.70710676908493,depthWrite:!1}),p=new s.MeshStandardMaterial({transparent:!0,opacity:r&&"groundPolygonOpacity"in r?r.groundPolygonOpacity:.8,color:(null==r?void 0:r.groundPolygonColor)?r.groundPolygonColor:199703,metalness:.4,roughness:.71,depthWrite:!1}),f=new s.MeshStandardMaterial({opacity:r&&"lineOpacity"in r?r.lineOpacity:.65,color:(null==r?void 0:r.lineColor)?r.lineColor:5094588,metalness:.2,roughness:1,transparent:!0,depthWrite:!1}),m=(new s.MeshStandardMaterial({color:5094588,metalness:.2,roughness:1,transparent:!0,depthWrite:!1}),(new E.TextureLoader).load(r.insideTextureUrl));m.wrapS=E.RepeatWrapping,m.wrapT=E.RepeatWrapping,m.repeat.set(1,1);var v=new s.MeshStandardMaterial({color:16773119,side:s.DoubleSide,metalness:.4,roughness:.7,transparent:!0,opacity:1,depthWrite:!0,map:m});t.features.forEach((function(e,t){var i=new s.Object3D;i.name=e.properties.name;var l=[],c=[],m=[];e.geometry.coordinates.forEach((function(e,t){var r,i=new s.Shape,a=e[0];a.forEach((function(e,t){var o=n(e),s=(0,u.default)(o,2),l=[s[0],-s[1]];0==t?(i.moveTo(l[0],l[1]),r=l):i.lineTo(l[0],l[1]),t==a[0].length-1&&r&&i.lineTo(r[0],r[1])})),l.push(i)}));var g=new s.ShapeGeometry(l),y=new s.Mesh(g,d);y.renderOrder=2,y.layers.enable(5),y.receiveShadow=!0,y.name=e.properties.name+"面",y.position.z=r.height,y.userData.type=e.properties.level,y.userData.adcode=e.properties.adcode,y.userData.center=n(e.properties.center),y.userData.centroid=n(e.properties.centroid),y.userData.p=n(e.properties.p);var x=e.properties.rotation;x>-90&&x<90&&(x+=180),x>=-180&&x<=-90&&(x+=360),x<180?x+=45:x-=45,y.userData.rotation=x*Math.PI/180;var b=(new E.Box3).setFromObject(y).getSize(new E.Vector3).length();y.userData.size=b,h.push(y),i.add(y);var M=new s.Mesh(g,p);M.name=e.properties.name+"底面",M.renderOrder=1.7,i.add(M),i.rotateX(-Math.PI/2);var w=[],_=[],A=[];if(e.geometry.indexData.forEach((function(t,i){t.insideIndexs.forEach((function(t,o){var l=[],c=[];if(t.forEach((function(t){var a=n(e.geometry.coordinates[i][0][t]),o=(0,u.default)(a,2),h=o[0],d=o[1];l.push(new s.Vector3(h,0,d)),c.push(new s.Vector3(h,-d,r.height))})),l.length>1){var h=a.createBufferGeometry2(l,r.height);w.push(h)}if(c.length>1){var d=new E.PathPointList,p=new E.Vector3(0,0,1);d.set(c,.005,10,p,!1);var f=new E.PathGeometry;f.update(d,{width:2*r.radius,progress:1,arrow:!1}),f.pathPointList=d,m.push(f)}})),t.outHighIndexs.forEach((function(t,o){var l=[];if(t.forEach((function(t){var r=n(e.geometry.coordinates[i][0][t]),a=(0,u.default)(r,2),o=a[0],c=a[1];l.push(new s.Vector3(o,0,c))})),l.length>1){var c=a.createBufferGeometry3(l,r.height);_.push(c)}})),t.outIndexs.forEach((function(t,o){var l=[],h=[];if(t.forEach((function(t){var a=n(e.geometry.coordinates[i][0][t]),o=(0,u.default)(a,2),c=o[0],d=o[1];l.push(new s.Vector3(c,0,d)),h.push(new s.Vector3(c,-d,r.height))})),l.length>1){var d=a.createBufferGeometry2(l,r.height);A.push(d)}if(h.length>1){var p=new E.PathPointList,f=new E.Vector3(0,0,1);p.set(h,.005,10,f,!1);var m=new E.PathGeometry;m.update(p,{width:2*r.radius,progress:1,arrow:!1}),m.pathPointList=p,c.push(m)}}))})),c.length>0){var C=be.mergeBufferGeometries(c),T=new s.Mesh(C,f);T.renderOrder=2.1,T.castShadow=!0,T.name=e.properties.name+"外轮廓线",i.add(T)}if(w.length>0){var S=be.mergeBufferGeometries(w),L=new s.Mesh(S,v);L.renderOrder=1.8,L.castShadow=!0,L.receiveShadow=!0,L.name=e.properties.name+"内立面",L.rotateX(Math.PI/2),i.add(L)}if(_.length>0){var P=be.mergeBufferGeometries(_),B=new s.Mesh(P,v);B.renderOrder=1.9,B.castShadow=!0,B.receiveShadow=!0,B.name=e.properties.name+"外立面高亮",B.rotateX(Math.PI/2),i.add(B)}if(A.length>0){var D=be.mergeBufferGeometries(A),k=new s.Mesh(D,v);k.renderOrder=1.8,k.castShadow=!0,k.receiveShadow=!0,k.name=e.properties.name+"背立面",k.rotateX(Math.PI/2),i.add(k);var R=new s.Mesh(D,v);R.renderOrder=1.8,R.castShadow=!0,R.receiveShadow=!0,R.name=e.properties.name+"外立面",R.rotateX(Math.PI/2),R.layers.enable(5),i.add(R)}if(m.length>0){var O=be.mergeBufferGeometries(m),I=new s.Mesh(O,f);I.renderOrder=2.1,I.name=e.properties.name+"内轮廓线",i.add(I)}o.add(i)})),l.add(o),c.shadowMap.needsUpdate=!0,a.core.needUpdate=!0,i&&i()}))}},{key:"createProvinceMap",value:function(e,t,n,r,i){var a=this,o=this.getCore(),l=o.scene,c=o.renderer,h=o.touchTargetObjs;o.getCenterAndSize,this.loadJsonFile(t).then((function(t){var o=new s.Group;o.name=e;var d=new s.MeshStandardMaterial({transparent:!0,opacity:(null==r?void 0:r.polygonOpacity)?r.polygonOpacity:.6,color:(null==r?void 0:r.polygonColor)?r.polygonColor:270122,metalness:.4,roughness:.70710676908493,depthWrite:!1}),p=new s.MeshStandardMaterial({transparent:!0,opacity:(null==r?void 0:r.groundPolygonOpacity)?r.groundPolygonOpacity:.8,color:(null==r?void 0:r.groundPolygonColor)?r.groundPolygonColor:199703,metalness:.4,roughness:.71,depthWrite:!1}),f=new s.MeshStandardMaterial({color:6523297,metalness:.75,roughness:1,transparent:!0,depthWrite:!1}),m=new s.MeshStandardMaterial({color:6523297,metalness:.899999976158142,roughness:1,transparent:!0,depthWrite:!1}),v=(new E.TextureLoader).load(r.insideTextureUrl);v.wrapS=E.RepeatWrapping,v.wrapT=E.RepeatWrapping,v.repeat.set(.01,1);var g=new s.MeshStandardMaterial({color:16777215,side:s.DoubleSide,metalness:.4,roughness:.7,transparent:!0,opacity:.4,depthWrite:!1,map:v}),y=(new E.TextureLoader).load(r.outsideHTextureUrl);y.wrapS=E.RepeatWrapping,y.wrapT=E.RepeatWrapping,y.repeat.set(1,1);var x=new s.MeshStandardMaterial({color:16777215,metalness:.4,roughness:.7,transparent:!0,depthWrite:!1,map:y}),b=(new E.TextureLoader).load(r.outsideTextureUrl);b.wrapS=E.RepeatWrapping,b.wrapT=E.RepeatWrapping,b.repeat.set(.01,1);var M=new s.MeshStandardMaterial({color:7382753,metalness:.35,roughness:1,map:b}),w=(new E.TextureLoader).load(r.backTextureUrl);w.wrapS=E.RepeatWrapping,w.wrapT=E.RepeatWrapping,w.repeat.set(.01,1);var _=new s.MeshStandardMaterial({color:5077758,side:s.BackSide,metalness:.45,roughness:1,transparent:!0,depthWrite:!1,map:w});t.features.forEach((function(e,t){var i=new s.Object3D;i.name=e.properties.name;var l=[],c=[],v=[];e.geometry.coordinates.forEach((function(e,t){var r,i=new s.Shape,a=e[0];a.forEach((function(e,t){var o=n(e),s=(0,u.default)(o,2),l=[s[0],-s[1]];0==t?(i.moveTo(l[0],l[1]),r=l):i.lineTo(l[0],l[1]),t==a[0].length-1&&r&&i.lineTo(r[0],r[1])})),l.push(i)}));var y=new s.ShapeGeometry(l),b=new s.Mesh(y,d);b.renderOrder=2,b.layers.enable(5),b.receiveShadow=!0,b.name=e.properties.name+"面",b.position.z=r.height,b.userData.type=e.properties.level,b.userData.adcode=e.properties.adcode,b.userData.center=n(e.properties.center),b.userData.centroid=n(e.properties.centroid),b.userData.p=n(e.properties.p);var w=e.properties.rotation;w>-90&&w<90&&(w+=180),w>=-180&&w<=-90&&(w+=360),w<180?w+=45:w-=45,b.userData.rotation=w*Math.PI/180;var A=(new E.Box3).setFromObject(b).getSize(new E.Vector3).length();b.userData.size=A,h.push(b),i.add(b);var C=new s.Mesh(y,p);C.name=e.properties.name+"底面",C.renderOrder=1.7,i.add(C),i.rotateX(-Math.PI/2);var T=[],S=[],L=[];if(e.geometry.indexData.forEach((function(t,i){t.insideIndexs.forEach((function(t,o){var l=[],c=[];if(t.forEach((function(t){var a=n(e.geometry.coordinates[i][0][t]),o=(0,u.default)(a,2),h=o[0],d=o[1];l.push(new s.Vector3(h,0,d)),c.push(new s.Vector3(h,-d,r.height))})),l.length>1){var h=a.createBufferGeometry2(l,r.height);T.push(h)}if(c.length>1){var d=new E.PathPointList,p=new E.Vector3(0,0,1);d.set(c,.01,10,p,!1);var f=new E.PathGeometry;f.update(d,{width:2*r.radius,progress:1,arrow:!1}),f.pathPointList=d,v.push(f)}})),t.outHighIndexs.forEach((function(t,o){var l=[];if(t.forEach((function(t){var r=n(e.geometry.coordinates[i][0][t]),a=(0,u.default)(r,2),o=a[0],c=a[1];l.push(new s.Vector3(o,0,c))})),l.length>1){var c=a.createBufferGeometry3(l,r.height);S.push(c)}})),t.outIndexs.forEach((function(t,o){var l=[],h=[];if(t.forEach((function(t){var a=n(e.geometry.coordinates[i][0][t]),o=(0,u.default)(a,2),c=o[0],d=o[1];l.push(new s.Vector3(c,0,d)),h.push(new s.Vector3(c,-d,r.height))})),l.length>1){var d=a.createBufferGeometry2(l,r.height);L.push(d)}if(h.length>1){var p=new E.PathPointList,f=new E.Vector3(0,0,1);p.set(h,.01,10,f,!1);var m=new E.PathGeometry;m.update(p,{width:2*r.radius,progress:1,arrow:!1}),m.pathPointList=p,c.push(m)}}))})),c.length>0){var P=be.mergeBufferGeometries(c),B=new s.Mesh(P,f);B.renderOrder=2.1,B.castShadow=!0,B.name=e.properties.name+"外轮廓线",i.add(B)}if(T.length>0){var D=be.mergeBufferGeometries(T),k=new s.Mesh(D,g);k.renderOrder=1.8,k.castShadow=!0,k.receiveShadow=!0,k.name=e.properties.name+"内立面",k.rotateX(Math.PI/2),i.add(k)}if(S.length>0){var R=be.mergeBufferGeometries(S),O=new s.Mesh(R,x);O.renderOrder=1.9,O.castShadow=!0,O.receiveShadow=!0,O.name=e.properties.name+"外立面高亮",O.rotateX(Math.PI/2),i.add(O)}if(L.length>0){var I=be.mergeBufferGeometries(L),F=new s.Mesh(I,_);F.renderOrder=1.8,F.castShadow=!0,F.receiveShadow=!0,F.name=e.properties.name+"背立面",F.rotateX(Math.PI/2),i.add(F);var N=new s.Mesh(I,M);N.renderOrder=1.8,N.castShadow=!0,N.receiveShadow=!0,N.name=e.properties.name+"外立面",N.rotateX(Math.PI/2),i.add(N)}if(v.length>0){var z=be.mergeBufferGeometries(v),U=new s.Mesh(z,m);U.renderOrder=2.1,U.name=e.properties.name+"内轮廓线",i.add(U)}o.add(i)})),l.add(o),c.shadowMap.needsUpdate=!0,a.core.needUpdate=!0,i&&i()}))}},{key:"removeMap",value:function(e){var t=this.getCore(),n=t.scene,r=t.dispose;n.children.forEach((function(t){t.name==e&&r(t)})),this.core.needUpdate=!0}},{key:"createProvinceMap3",value:function(e,t,n,r,i){var a=this,o=this.getCore(),l=o.scene,c=o.renderer,h=o.touchTargetObjs;o.getCenterAndSize,this.loadJsonFile(t).then((function(t){var o=new s.Group;o.name=e;var d=(new E.TextureLoader).load(r.polygonTextureUrl);d.wrapS=E.RepeatWrapping,d.wrapT=E.RepeatWrapping,d.repeat.set(1,1);var p=new s.MeshStandardMaterial({transparent:!0,map:d,color:(null==r?void 0:r.polygonColor)?r.polygonColor:270122,metalness:.4,roughness:.70710676908493,depthWrite:!1}),f=new s.MeshStandardMaterial({transparent:!0,opacity:r&&"groundPolygonOpacity"in r?r.groundPolygonOpacity:.8,color:(null==r?void 0:r.groundPolygonColor)?r.groundPolygonColor:199703,metalness:.4,roughness:.71,depthWrite:!1}),m=new s.MeshStandardMaterial({opacity:r&&"lineOpacity"in r?r.lineOpacity:.65,color:(null==r?void 0:r.lineColor)?r.lineColor:5094588,metalness:.2,roughness:1,transparent:!0,depthWrite:!1}),v=new s.MeshStandardMaterial({color:4229537,metalness:.2,roughness:1,transparent:!0,depthWrite:!1}),g=(new E.TextureLoader).load(r.insideTextureUrl);g.wrapS=E.RepeatWrapping,g.wrapT=E.RepeatWrapping,g.repeat.set(.01,1);var y=new s.MeshStandardMaterial({color:16773119,side:s.DoubleSide,metalness:.4,roughness:.7,transparent:!0,opacity:1,depthWrite:!1,map:g});t.features.forEach((function(e,t){var i=new s.Object3D;i.name=e.properties.name;var l=[],c=[],d=[];e.geometry.coordinates.forEach((function(e,t){var r,i=new s.Shape,a=e[0];a.forEach((function(e,t){var o=n(e),s=(0,u.default)(o,2),l=[s[0],-s[1]];0==t?(i.moveTo(l[0],l[1]),r=l):i.lineTo(l[0],l[1]),t==a[0].length-1&&r&&i.lineTo(r[0],r[1])})),l.push(i)}));var g=new s.ShapeGeometry(l),x=new E.Box3;g.vertices.forEach((function(e){x.expandByPoint(e)})),g.faceVertexUvs[0]=[],g.faces.forEach((function(e){var t=g.vertices[e.a],n=g.vertices[e.b],r=g.vertices[e.c],i=new E.Vector2((t.x-x.min.x)/(x.max.x-x.min.x),(t.y-x.min.y)/(x.max.y-x.min.y)),a=new E.Vector2((n.x-x.min.x)/(x.max.x-x.min.x),(n.y-x.min.y)/(x.max.y-x.min.y)),o=new E.Vector2((r.x-x.min.x)/(x.max.x-x.min.x),(r.y-x.min.y)/(x.max.y-x.min.y));g.faceVertexUvs[0].push([i,a,o])})),g.elementsNeedUpdate=!0;var b=new s.Mesh(g,p);b.renderOrder=2,b.layers.enable(5),b.receiveShadow=!0,b.name=e.properties.name+"面",b.position.z=r.height,b.userData.type=e.properties.level,b.userData.adcode=e.properties.adcode,b.userData.center=n(e.properties.center),b.userData.centroid=n(e.properties.centroid),b.userData.p=n(e.properties.p);var M=e.properties.rotation;M>-90&&M<90&&(M+=180),M>=-180&&M<=-90&&(M+=360),M<180?M+=45:M-=45,b.userData.rotation=M*Math.PI/180;var w=(new E.Box3).setFromObject(b).getSize(new E.Vector3).length();b.userData.size=w,h.push(b),i.add(b);var _=new s.Mesh(g,f);_.name=e.properties.name+"底面",_.renderOrder=1.7,i.rotateX(-Math.PI/2);var A=[],C=[],T=[];if(e.geometry.indexData.forEach((function(t,i){t.insideIndexs.forEach((function(t,o){var l=[],c=[];if(t.forEach((function(t){var a=n(e.geometry.coordinates[i][0][t]),o=(0,u.default)(a,2),h=o[0],d=o[1];l.push(new s.Vector3(h,0,d)),c.push(new s.Vector3(h,-d,r.height))})),l.length>1){var h=a.createBufferGeometry2(l,r.height);A.push(h)}if(c.length>1){var p=new E.PathPointList,f=new E.Vector3(0,0,1);p.set(c,.005,10,f,!1);var m=new E.PathGeometry;m.update(p,{width:2*r.radius,progress:1,arrow:!1}),m.pathPointList=p,d.push(m)}})),t.outHighIndexs.forEach((function(t,o){var l=[];if(t.forEach((function(t){var r=n(e.geometry.coordinates[i][0][t]),a=(0,u.default)(r,2),o=a[0],c=a[1];l.push(new s.Vector3(o,0,c))})),l.length>1){var c=a.createBufferGeometry3(l,r.height);C.push(c)}})),t.outIndexs.forEach((function(t,o){var l=[],h=[];if(t.forEach((function(t){var a=n(e.geometry.coordinates[i][0][t]),o=(0,u.default)(a,2),c=o[0],d=o[1];l.push(new s.Vector3(c,0,d)),h.push(new s.Vector3(c,-d,r.height))})),l.length>1){var d=a.createBufferGeometry2(l,r.height);T.push(d)}if(h.length>1){var p=new E.PathPointList,f=new E.Vector3(0,0,1);p.set(h,.005,10,f,!1);var m=new E.PathGeometry;m.update(p,{width:2*r.radius,progress:1,arrow:!1}),m.pathPointList=p,c.push(m)}}))})),c.length>0){var S=be.mergeBufferGeometries(c),L=new s.Mesh(S,m);L.renderOrder=2.1,L.castShadow=!0,L.name=e.properties.name+"外轮廓线",i.add(L)}if(A.length>0){var P=be.mergeBufferGeometries(A),B=new s.Mesh(P,y);B.renderOrder=1.8,B.castShadow=!0,B.receiveShadow=!0,B.name=e.properties.name+"内立面",B.rotateX(Math.PI/2),i.add(B)}if(T.length>0){var D=be.mergeBufferGeometries(T),k=new s.Mesh(D,y);k.renderOrder=1.8,k.castShadow=!0,k.receiveShadow=!0,k.name=e.properties.name+"背立面",k.rotateX(Math.PI/2),i.add(k)}if(d.length>0){var R=be.mergeBufferGeometries(d),O=new s.Mesh(R,v);O.renderOrder=2.1,O.name=e.properties.name+"内轮廓线",i.add(O)}o.add(i)})),l.add(o),c.shadowMap.needsUpdate=!0,a.core.needUpdate=!0,i&&i()}))}}])}(ke),ni.TreeLoader=function(e){function t(e,n,r){var i;return(0,v.default)(this,t),(i=T(this,t)).codeSelected=[],i.codeLoaded=[],i.loadByIds=function(e){return function(e){var t,n=[],r=w(e);try{var a=function(){var e=t.value,r=new Promise((function(t,n){i.idsToFile(e.cids,e.model_file).then((function(e){t(URL.createObjectURL(e))})).catch((function(e){n(e)}))}));n.push(r)};for(r.s();!(t=r.n()).done;)a()}catch(e){r.e(e)}finally{r.f()}return Promise.all(n)}(e)},i.getModelTree=function(){return e="".concat(i.domain,"/code_rule/house/tree"),i.modelName,i.type,fetch(e).then((function(e){return e.json()}));var e},i.codesToIds=function(e){return Gn((0,c.default)(i),void 0,void 0,o.default.mark((function t(){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,zn("".concat(this.domain,"/code_rule/rules/cids"),{model_name:this.modelName,rules:e});case 2:return t.abrupt("return",t.sent.data.filter((function(e){return e.cids.length>0})));case 3:case"end":return t.stop()}}),t,this)})))},i.idToCode=function(e){return zn("".concat(i.domain,"/code_rule/component/").concat(e),{model_name:i.modelName})},i.idsToCode=function(e){return Gn((0,c.default)(i),void 0,void 0,o.default.mark((function t(){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",zn("".concat(this.domain,"/code_rule/cids/rules"),{model_name:e.model,cids:e.ids}));case 1:case"end":return t.stop()}}),t,this)})))},i.codeToIds=function(e){return zn("".concat(i.domain,"/code_rule/").concat(e,"/cids"),{model_name:i.modelName})},i.idsToFile=function(e,t){return Un("".concat(i.domain,"/bim/model/ids"),{model_file:t,ids:e})},i._setModelByCodes=function(e,t){0!==e.length&&i.codesToIds(e).then((function(e){if(0===e.length)return!1;var n,r=w(e);try{var a=function(){var e=n.value,r=i.core.getModelScene(e.model);r&&i.core.traverseNodes(r,(function(n){n.parent&&e.cids.indexOf(parseInt(n.parent.name))>-1&&(n.visible=t)}))};for(r.s();!(n=r.n()).done;)a()}catch(e){r.e(e)}finally{r.f()}i.core.needUpdate=!0}))},i.domain=e,i.modelName=n,i.type=r,i}return(0,m.default)(t,e),(0,g.default)(t,[{key:"loadModelByIds",value:function(e){return Gn(this,void 0,void 0,o.default.mark((function t(){var n,r;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!i.isNull(e)){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.idsToCode(this._parseModeId(e));case 4:return n=t.sent,r=i.uniq(n.data),t.abrupt("return",this.loadModelByCodes(r));case 7:case"end":return t.stop()}}),t,this)})))}},{key:"loadModelByCodes",value:function(e){return Gn(this,void 0,void 0,o.default.mark((function t(){var n,r,a,s;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!i.isNull(e)){t.next=2;break}return t.abrupt("return");case 2:if(r=e,a=this._codeFilter(r),(n=this.codeLoaded).push.apply(n,(0,l.default)(a)),this.codeLoaded=i.uniq(this.codeLoaded),this.codeSelected=r,0!==a.length){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,this.codesToIds(a);case 7:return s=t.sent,t.abrupt("return",this.loadByIds(s));case 9:case"end":return t.stop()}}),t,this)})))}},{key:"_codeFilter",value:function(e){var t=this,n=e.filter((function(e){return-1===t.codeSelected.indexOf(e)})),r=this.codeSelected.filter((function(t){return-1===e.indexOf(t)})),i=n.filter((function(e){return-1===t.codeLoaded.indexOf(e)})),a=n.filter((function(e){return-1===i.indexOf(e)}));return this._setModelByCodes(r,!1),this._setModelByCodes(a,!0),i}},{key:"_parseModeId",value:function(e){var t=i.map(e,(function(e){var t=e.split("|");return{model:t[0],id:t[1]}})),n={};i.forEach(t,(function(e){n[e.model]||(n[e.model]=[]),n[e.model].push(e.id)}));var r=[];return i.forEach(n,(function(e,t){var n={model:t,ids:e};r.push(n)})),r[0]}}])}(ke),ni.Lod=Vn,ni.Label=Wn,ni.FontLoader=Xn,ni.AutoRoam=function(e){function t(e,n){var r;return(0,v.default)(this,t),(r=T(this,t)).oldId=0,r.oldAngle=0,r.first=!0,r.isDelay=!1,r.isCycle=!1,r.onDelayCallback=null,r.offDelayCallback=null,r.inspectionEnd=null,r.roamList=[],r.curAnimate=0,r.curAnimations=[],r.points={},r.newCoords={},r.startFlag=!1,r.firstFlag=!0,r.readFlag=!1,r.speed=4,r.lowValue=0,r.eyeHeight=1.5,r.createMarkAfterReadJSON=!1,r.createRowAfterReadJSON=!0,r.readCoordsFromJSON=function(e,t){var n=(0,c.default)(r);!function(e,t){var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",e,!0),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&t(n.responseText)},n.send(null)}(e,(function(e){var r=JSON.parse(e);for(var i in n.points=r,n.readFlag=!0,n.endFn(),n.mark.clearAllTableMark(),n.points){for(var a=0;a<n.points[i].length;a++){if(n.createMarkAfterReadJSON){var o={position:{x:n.points[i][a].x,y:n.points[i][a].y,z:n.points[i][a].z},worldNormal:{x:0,y:1,z:0}};n.mark.showMark(o,null,!1)}n.createRowAfterReadJSON}n.mark.setTableMarkArrayLength(n.points[i].length)}t&&t()}))},r.readCoordsFromMark=function(){r.readFlag=!1,r.endFn()},r.startEdit=function(){r.roamList=[]},r.addEdit=function(e,t){var n=r.roam.curPosition(),i=r.roam.curTarget(),a=0,o={x:n.x,y:n.y,z:n.z,target:i,time:1e3};return!(n&&r.roamList[r.roamList.length-1]&&(r.roamList[r.roamList.length-1].y===n.y&&a++,r.roamList[r.roamList.length-1].x===n.x&&a++,r.roamList[r.roamList.length-1].z===n.z&&a++,r.roamList[r.roamList.length-1].target.z===i.z&&a++,r.roamList[r.roamList.length-1].target.y===i.y&&a++,r.roamList[r.roamList.length-1].target.x===i.x&&a++,6===a)||(e&&(o.time=e),t?r.roamList[t-1]=o:r.roamList.push(o),0))},r.setEdit=function(e){r.roamList=e},r.endEdit=function(){return r.roamList},r.startRoam=function(e){0!=r.roamList.length&&(r.points={start:r.roamList},r.readFlag=!0,r.startFn(e))},r.startFn=function(e){if(!r.startFlag){r.setDeviation();var t=(0,c.default)(r);r.curAnimations[r.curAnimations.length-1].onComplete((function(){t.endFn(null!=e?e:null)})),r.startFlag=!0}r.curAnimations[r.curAnimate].isPaused()?r.curAnimations[r.curAnimate].resume():r.curAnimations[r.curAnimate].start()},r.stopFn=function(){r.curAnimations[r.curAnimate].pause()},r.endFn=function(e){r.startFlag&&(r.curAnimations[r.curAnimate].stop(),sr.removeAll(),r.curAnimate=0,r.startFlag=!1,r.oldId=0,r.oldAngle=0,r.isDelay=!1,r.first=!0,r.isCycle?r.startFn():(i.isNull(r.inspectionEnd)||r.inspectionEnd(),null!=e&&e()))},r.setDeviation=function(){r.newCoords={};var e=r.points;for(var t in e){r.newCoords[t]=[];for(var n=0;n<e[t].length;n++){var i=JSON.parse(JSON.stringify(e[t][n]));i.id=n+1,i.px&&i.pz&&i.tx&&i.tz&&(i.px=Number(i.px)+-10,i.pz=Number(i.pz)+7.5,i.tx=Number(i.tx)+-10,i.tz=Number(i.tz)+7.5),"x"in i&&"y"in i&&"z"in i&&(i.px=Number(i.x),i.py=Number(i.y)+r.eyeHeight,i.pz=Number(i.z)),r.newCoords[t].push(i)}}r.initNewTween()},r.initNewTween=function(){r.curAnimations=[];var e,t=null;for(var n in r.newCoords){for(var i=0;i+1<r.newCoords[n].length;i++){if(!r.newCoords[n][i].tx&&!r.newCoords[n][i].tz){var a=Hn(r.newCoords[n][i],r.newCoords[n][i+1],1,"up",null,r.lowValue);r.newCoords[n][i].tx=a.tx,r.newCoords[n][i].ty=a.ty,r.newCoords[n][i].tz=a.tz}if(!r.newCoords[n][i+1].tx&&!r.newCoords[n][i+1].tz)if(i+1===r.newCoords[n].length-1){var o=Math.sqrt(Math.pow(r.newCoords[n][i+1].px-r.newCoords[n][i].px,2)+Math.pow(r.newCoords[n][i+1].pz-r.newCoords[n][i].pz,2)),s=jn({px:r.newCoords[n][i].px,py:r.newCoords[n][i].py,pz:r.newCoords[n][i].pz},{tx:r.newCoords[n][i].tx,ty:r.newCoords[n][i].ty,tz:r.newCoords[n][i].tz},o,"up").target;r.newCoords[n][i+1].tx=s.tx,r.newCoords[n][i+1].ty=s.ty,r.newCoords[n][i+1].tz=s.tz}else if(r.newCoords[n][i+2]){var l=Hn(r.newCoords[n][i+1],r.newCoords[n][i+2],1,"up",null,r.lowValue);r.newCoords[n][i+1].tx=l.tx,r.newCoords[n][i+1].ty=l.ty,r.newCoords[n][i+1].tz=l.tz}0===i&&null!=t&&(e=t.hasOwnProperty("time")?r.getLineAnimate(t,r.newCoords[n][i],t.time):r.getLineAnimate(t,r.newCoords[n][i],r.getTime(t,r.newCoords[n][i])),r.curAnimations.push(e),t.hasOwnProperty("delay")&&e.delay(Number(t.delay))),e=r.newCoords[n][i].hasOwnProperty("time")?r.getLineAnimate(r.newCoords[n][i],r.newCoords[n][i+1],r.newCoords[n][i].time):r.getLineAnimate(r.newCoords[n][i],r.newCoords[n][i+1],r.getTime(r.newCoords[n][i],r.newCoords[n][i+1])),r.curAnimations.push(e),r.newCoords[n][i].hasOwnProperty("delay")&&e.delay(Number(r.newCoords[n][i].delay))}t=r.newCoords[n][r.newCoords[n].length-1]}for(var u=0;u+1<r.curAnimations.length;u++)r.curAnimations[u].chain(r.curAnimations[u+1])},r.setSpeed=function(e){r.speed=e},r.setEyeHeight=function(e){r.eyeHeight=e},r.reduceVisualHeight=function(e){r.lowValue=e},r.getTime=function(e,t){var n=r.speed;return e.target,Math.sqrt(Math.pow(e.pz-t.pz,2)+Math.pow(e.px-t.px,2)+Math.pow(e.py-t.py,2))/n*1e3},r.getLineAnimate=function(e,t,n){var a,o,s,l,u=(0,c.default)(r),h=!0,d={name:e.name,userData:e.userData},p={name:t.name,userData:t.userData},f=e.id;e.target&&(e.tx=e.target.x,e.ty=e.target.y,e.tz=e.target.z),t.target&&(t.tx=t.target.x,t.ty=t.target.y,t.tz=t.target.z),a=Math.sqrt(Math.pow(e.px-e.tx,2)+Math.pow(e.py-e.ty,2)+Math.pow(e.pz-e.tz,2)),o=Math.sqrt(Math.pow(t.px-e.tx,2)+Math.pow(t.py-e.ty,2)+Math.pow(t.pz-e.tz,2)),s={x:e.px,y:e.py,z:e.pz},l=Math.sqrt(Math.pow(t.px-s.x,2)+Math.pow(t.py-s.y,2)+Math.pow(t.pz-s.z,2));var m=!1;return e.tx==t.tx&&e.ty==t.ty&&e.tz==t.tz&&(m=!0),new sr.Tween(e).to(t,n).easing(t.py-e.py>20?sr.Easing.Sinusoidal.Out:sr.Easing.Linear.None).onStart((function(){e.isInBuilding&&u.lightChangeFn&&u.lightChangeFn()})).onUpdate((function(){if(e.angle)u.first&&(u.roam.lookAt({x:e.px,y:e.py,z:e.pz},{x:e.tx,y:e.ty,z:e.tz}),u.first=!1),u.roam.moveTo(e.px,e.py,e.pz),f!==u.oldId&&(e.angle!==u.oldAngle&&u.cameraRotate(e.angle),Number.isInteger(f)?(i.isNull(u.onDelayCallback)||u.onDelayCallback(d),h=!0):!Number.isInteger(f)&&h&&(i.isNull(u.offDelayCallback)||u.offDelayCallback(d),h=!1),u.oldId=f,u.oldAngle=e.angle);else{var t=Math.sqrt(Math.pow(e.px-s.x,2)+Math.pow(e.py-s.y,2)+Math.pow(e.pz-s.z,2))/l;if(m){var n=Math.sqrt(Math.pow(e.px-e.tx,2)+Math.pow(e.py-e.ty,2)+Math.pow(e.pz-e.tz,2)),r=a+(o-a)*t;u.roam.lookAt({x:(e.px-e.tx)*r/n+e.tx,y:(e.py-e.ty)*r/n+e.ty,z:(e.pz-e.tz)*r/n+e.tz},{x:e.tx,y:e.ty,z:e.tz},!u.first),u.first&&(u.first=!1)}else u.roam.lookAt({x:e.px,y:e.py,z:e.pz},{x:e.tx,y:e.ty,z:e.tz},!u.first),u.first&&(u.first=!1);f!==u.oldId&&(Number.isInteger(f)?(i.isNull(u.onDelayCallback)||u.onDelayCallback(p),h=!0):!Number.isInteger(f)&&h&&(i.isNull(u.offDelayCallback)||u.offDelayCallback(d),h=!1),u.oldId=f)}})).onComplete((function(){u.curAnimate++}))},r.animate=function(){0!==sr.getAll().length&&sr.update(),r.abortRequestAnimationFrame=requestAnimationFrame(r.animate)},r.hideTable=function(){},r.showTable=function(){},r.focusingToObjects=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3,a=arguments.length>4?arguments[4]:void 0,o=r.getCore().cameraControls,l=r.core.bbox(e);if(0!=l.getSize(new s.Vector3).length()){var u=l.getBoundingSphere(new E.Sphere),c=u.center,h=u.radius,d=new s.Vector3,p=new s.Vector3;o.getPosition(d),o.getTarget(p);var f,m=new E.Vector3(d.x-p.x,d.y-p.y,d.z-p.z),v=Math.sqrt(m.x*m.x+m.y*m.y+m.z*m.z),g=new E.Vector3(m.x/v,m.y/v,m.z/v);if(t){var y=r.roam.getPixelDistance(h,n);y<.1&&(y=.1),f=new E.Vector3(y*g.x+c.x,y*g.y+c.y,y*g.z+c.z)}else f=new E.Vector3(1.5*h*g.x+c.x,1.5*h*g.y+c.y,1.5*h*g.z+c.z);r.lerpLookAt(f,c,i,!0,a)}},r.focusingToObjectsByParams=function(e,t,n){var i=r.getCore().cameraControls,a=r.core.bbox(e);if(0!=a.getSize(new s.Vector3).length()){var o,l=a.getBoundingSphere(new E.Sphere),u=l.center,c=l.radius,h=new s.Vector3,d=new s.Vector3;i.getPosition(h),i.getTarget(d),t&&t.distance?o=t.distance:t&&t.percentage&&(o=r.roam.getPixelDistance(c,t.percentage))<.1&&(o=.1);var p=i.azimuthAngle,f=i.polarAngle;t&&"heading"in t&&(p=t.heading*Math.PI/180),t&&"pitch"in t&&(f=t.pitch*Math.PI/180);var m=new E.Vector3(o*Math.sin(f)*Math.sin(p)+u.x,o*Math.cos(f)+u.y,o*Math.sin(f)*Math.cos(p)+u.z),v=t&&"time"in t?t.time:1e3;r.lerpLookAt(m,u,v,!0,n)}},r.roam=n,r.mark=e,r.animate(),r}return(0,m.default)(t,e),(0,g.default)(t,[{key:"cameraRotate",value:function(e){this.getCore().cameraControls.rotate((e-this.oldAngle)*Math.PI/180,0,!0)}},{key:"lerpLookAt2",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:10,z:0},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:20,y:10,z:10},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4?arguments[4]:void 0,a=this.getCore().cameraControls,o=new s.Vector3,l=new s.Vector3;a.getPosition(o),a.getTarget(l),a.lerpLookAt(o.x,o.y,o.z,l.x,l.y,l.z,e.x,e.y,e.z,t.x,t.y,t.z,n,r).then((function(){i&&i()})).catch((function(e){}))}},{key:"lerpLookAt",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:10,z:0},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:20,y:10,z:10},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4?arguments[4]:void 0,a=this.getCore().cameraControls,o=new s.Vector3,l=new s.Vector3;a.getPosition(o),a.getTarget(l),a.azimuthAngle=Math.atan2(o.x-l.x,o.z-l.z),r||(n=0),this.focusTWEEN&&this.focusTWEEN.stop();var u=new E.Vector3(e.x,e.y,e.z),c=new E.Vector3(t.x,t.y,t.z),h=u.distanceTo(c),d=h?Math.acos((e.y-t.y)/h):0,p=Math.atan2(u.x-c.x,u.z-c.z);d-a.polarAngle>Math.PI?d-=2*Math.PI:d-a.polarAngle<-Math.PI&&(d+=2*Math.PI),p-a.azimuthAngle>Math.PI?p-=2*Math.PI:p-a.azimuthAngle<-Math.PI&&(p+=2*Math.PI),this.focusTWEEN=new sr.Tween({tx:l.x,ty:l.y,tz:l.z,distance:a.distance,polarAngle:a.polarAngle,azimuthAngle:a.azimuthAngle}).to({tx:t.x,ty:t.y,tz:t.z,distance:h,polarAngle:d,azimuthAngle:p},n).easing(sr.Easing.Quadratic.InOut).onStart((function(){})).onUpdate((function(e){a.setTarget(e.tx,e.ty,e.tz),a.azimuthAngle=e.azimuthAngle,a.polarAngle=e.polarAngle,a.distance=e.distance})).onComplete((function(){this.focusTWEEN=null,i&&i()})).start()}},{key:"lookAt",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:10,z:0},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:20,y:10,z:10},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,i=this.getCore().cameraControls,a=new s.Vector3,o=new s.Vector3;i.getPosition(a),i.getTarget(o),i.azimuthAngle=Math.atan2(a.x-o.x,a.z-o.z),this.focusTWEEN&&this.focusTWEEN.stop();var l=new E.Vector3(e.x,e.y,e.z),u=new E.Vector3(t.x,t.y,t.z),c=l.distanceTo(u),h=Math.acos((e.y-t.y)/c),d=Math.atan2(l.x-u.x,l.z-u.z);h-i.polarAngle>Math.PI?h-=2*Math.PI:h-i.polarAngle<-Math.PI&&(h+=2*Math.PI),d-i.azimuthAngle>Math.PI?d-=2*Math.PI:d-i.azimuthAngle<-Math.PI&&(d+=2*Math.PI);var p=1e3*o.distanceTo(new E.Vector3(t.x,t.y,t.z))/n;p>500&&(p=500),this.focusTWEEN=new sr.Tween({tx:o.x,ty:o.y,tz:o.z,distance:i.distance,polarAngle:i.polarAngle,azimuthAngle:i.azimuthAngle}).to({tx:t.x,ty:t.y,tz:t.z,distance:c,polarAngle:h,azimuthAngle:d},p).easing(sr.Easing.Linear.None).onStart((function(){})).onUpdate((function(e){i.setTarget(e.tx,e.ty,e.tz),i.polarAngle=e.polarAngle,i.distance=e.distance})).onComplete((function(){this.focusTWEEN=null,r&&r()})).start()}},{key:"moveTo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:20,y:10,z:10},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,r=this.getCore().cameraControls,i=new s.Vector3,a=new s.Vector3;r.getPosition(i),r.getTarget(a),r.azimuthAngle=Math.atan2(i.x-a.x,i.z-a.z),this.focusTWEEN&&this.focusTWEEN.stop();var o=1e3*a.distanceTo(new E.Vector3(e.x,e.y,e.z))/t;o>500&&(o=500),this.focusTWEEN=new sr.Tween({tx:a.x,ty:a.y,tz:a.z,distance:r.distance,polarAngle:r.polarAngle,azimuthAngle:r.azimuthAngle}).to({tx:e.x,ty:e.y,tz:e.z,distance:r.distance,polarAngle:r.polarAngle,azimuthAngle:r.azimuthAngle},o).easing(sr.Easing.Linear.None).onStart((function(){})).onUpdate((function(e){r.moveTo(e.tx,e.ty,e.tz)})).onComplete((function(){this.focusTWEEN=null,n&&n()})).start()}},{key:"moveToByDistance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:20,y:10,z:10},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,i=this.getCore().cameraControls,a=new s.Vector3,o=new s.Vector3;i.getPosition(a),i.getTarget(o),i.azimuthAngle=Math.atan2(a.x-o.x,a.z-o.z),this.focusTWEEN&&this.focusTWEEN.stop();var l=1e3*o.distanceTo(new E.Vector3(e.x,e.y,e.z))/n;l>500&&(l=500),this.focusTWEEN=new sr.Tween({tx:o.x,ty:o.y,tz:o.z,distance:i.distance,polarAngle:i.polarAngle,azimuthAngle:i.azimuthAngle}).to({tx:e.x,ty:e.y,tz:e.z,distance:t,polarAngle:i.polarAngle,azimuthAngle:i.azimuthAngle},l).easing(sr.Easing.Linear.None).onStart((function(){})).onUpdate((function(e){i.setTarget(e.tx,e.ty,e.tz),i.azimuthAngle=e.azimuthAngle,i.polarAngle=e.polarAngle,i.distance=e.distance})).onComplete((function(){this.focusTWEEN=null,r&&r()})).start()}},{key:"lerpLookAtByTransformation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:10,z:0},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:20,y:10,z:10},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=this.getCore(),l=o.cameraControls,u=o.rotateOnAxisY,c=u(e,n).add(r),h=u(t,n).add(r),d=new s.Vector3,p=new s.Vector3;l.getPosition(d),l.getTarget(p),l.lerpLookAt(d.x,d.y,d.z,p.x,p.y,p.z,c.x,c.y,c.z,h.x,h.y,h.z,i,a)}},{key:"destroy",value:function(){this.roam=null,cancelAnimationFrame(this.abortRequestAnimationFrame)}}])}(ke),ni.OutLine=lr,ni.OutLine2=function(e){function t(e){var n;return(0,v.default)(this,t),(n=T(this,t)).highLight=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!a().isNil(e)){var r=n.createBoxPlaneFromObject(e,t);(!n.isInit||r.children.length>n.outlinePasss.length)&&n._init(r.children.length-n.outlinePasss.length>0?r.children.length-n.outlinePasss.length:1);var i=n.getCore(),o=(i.scene,i.render,i.composer),s=i.setHighPerformance,l=(0,c.default)(n);if(s(n.isHF),"Object3D"===r.type)for(var u=0;u<(r.children.length>0?r.children.length:1);u++)h(r.children[u],u);"Mesh"===r.type&&h(r,0),n.detection(),n.core.needUpdate=!0,o.render()}function h(e,t){if(!(e instanceof E.InstancedMesh)){if(void 0===l.highLightedObjectsMap.get(e))if(l.highLightedObjectsMap.set(e,t),l.highLightedObjectss[t])l.highLightedObjectss[t].push(e);else{var n=[];n.push(e),l.highLightedObjectss.push(n)}else l.highLightedObjectss[l.highLightedObjectsMap.get(e)].forEach((function(t,n,r){t==e&&r.splice(n,1)})),l.highLightedObjectsMap.delete(e);l.outlinePasss[t].selectedObjects=l.highLightedObjectss[t]}}},n.highLight2=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!a().isNil(e)){n.isInit||n._init(2);var i=n.getCore(),o=(i.scene,i.render,i.composer),s=i.setHighPerformance,l=i.traverseNodes,u=(0,c.default)(n);s(n.isHF),l(e,(function(e){e.isMesh&&function(e,t,n){if(!(e instanceof E.InstancedMesh)){if(n||void 0!==u.highLightedObjectsMap.get(e))n&&(u.highLightedObjectss[u.highLightedObjectsMap.get(e)].forEach((function(t,n,r){t==e&&r.splice(n,1)})),u.highLightedObjectsMap.delete(e));else if(u.highLightedObjectsMap.set(e,t),u.highLightedObjectss[t])u.highLightedObjectss[t].push(e);else{var r=[];r.push(e),u.highLightedObjectss.push(r)}u.outlinePasss[t].selectedObjects=u.highLightedObjectss[t]}}(e,0,r)})),t&&"pulsePeriod"in t&&(u.outlinePasss[0].pulsePeriod=t.pulsePeriod),t&&"color"in t&&(u.outlinePasss[0].visibleEdgeColor=new E.Color(t.color),u.outlinePasss[0].hiddenEdgeColor=new E.Color(t.color)),n.detection(),n.core.needUpdate=!0,o.render()}},n.highLight3=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!a().isNil(e)){n.isInit||n._init(2);var i=n.getCore(),o=i.composer,s=i.setHighPerformance,l=i.traverseNodes,u=(0,c.default)(n);s(n.isHF),l(e,(function(e){e.isMesh&&function(e,t,n){if(!(e instanceof E.InstancedMesh)){if(n||void 0!==u.flashedObjectsMap.get(e))n&&(u.highLightedObjectss[u.flashedObjectsMap.get(e)].forEach((function(t,n,r){t==e&&r.splice(n,1)})),u.flashedObjectsMap.delete(e));else if(u.flashedObjectsMap.set(e,t),u.highLightedObjectss[t])u.highLightedObjectss[t].push(e);else{var r=[];r.push(e),u.highLightedObjectss[t]=r}u.outlinePasss[t].selectedObjects=u.highLightedObjectss[t]}}(e,1,r)})),t&&"pulsePeriod"in t&&(u.outlinePasss[1].pulsePeriod=t.pulsePeriod),t&&"color"in t&&(u.outlinePasss[1].visibleEdgeColor=new E.Color(t.color),u.outlinePasss[1].hiddenEdgeColor=new E.Color(t.color)),n.detection(),n.core.needUpdate=!0,o.render()}},n.customer_highLight=function(e,t,r){if(!a().isNil(e)){var i=n.createBoxPlaneFromObject(e,r);n.isCustomerInit||n.customer_init(t,i.children.length>0?i.children.length:1);var o=n.getCore(),s=(o.render,o.composer),l=o.setHighPerformance,u=(0,c.default)(n);if(l(n.isHF),"Object3D"===i.type)for(var h=0;h<(i.children.length>0?i.children.length:1);h++)d(i.children[h],h);"Mesh"===i.type&&d(i,0),n.detection(),n.core.needUpdate=!0,s.render()}function d(e,t){if(!(e instanceof E.InstancedMesh)){if(void 0===u.customerHighLightedObjectsMap.get(e))if(u.customerHighLightedObjectsMap.set(e,t),u.customerHighLightedObjectss[t])u.customerHighLightedObjectss[t].push(e);else{var n=[];n.push(e),u.customerHighLightedObjectss.push(n)}else u.customerHighLightedObjectss[u.customerHighLightedObjectsMap.get(e)].forEach((function(t,n,r){t==e&&r.splice(n,1)})),u.customerHighLightedObjectsMap.delete(e);u.customerOutlinePasss[t].selectedObjects=u.customerHighLightedObjectss[t]}}},n.removeCustomerHL=function(){var e=(0,c.default)(n),t=n.getCore(),r=(t.scene,t.render,t.composer);if(t.setHighPerformance,0!=n.customerHighLightedObjectsMap.size){n.customerHighLightedObjectsMap.forEach((function(t,n,r){e.customerHighLightedObjectsMap.delete(n)})),n.customerHighLightedObjectss=[];for(var i=0;i<n.customerOutlinePasss.length;i++)n.customerOutlinePasss[i].selectedObjects=[];n.detection(),n.core.needUpdate=!0,r.render()}},n.removeAllHighLight=function(){var e=(0,c.default)(n),t=n.getCore(),r=(t.scene,t.render,t.composer);(0,t.setHighPerformance)(n.isHF),0!=n.highLightedObjectsMap.size&&(n.highLightedObjectsMap.forEach((function(t,n,r){e.highLightedObjectsMap.delete(n)})),n.highLightedObjectss[0]=[],n.outlinePasss[0].selectedObjects=[],n.detection(),n.core.needUpdate=!0,r.render())},n.removeAllFlash=function(){var e=(0,c.default)(n),t=n.getCore(),r=t.composer;(0,t.setHighPerformance)(n.isHF),0!=n.flashedObjectsMap.size&&(n.flashedObjectsMap.forEach((function(t,n,r){e.flashedObjectsMap.delete(n)})),n.highLightedObjectss[1]=[],n.outlinePasss[1].selectedObjects=[],n.detection(),n.core.needUpdate=!0,r.render())},n.highLightById=function(e){var t=n.getCore(),r=t.scene,i=t.traverseNodes,a="";i(r,(function(t){t.parent&&t.parent.userData.uniqId===e&&a!==e&&(a=e,n.highLight(t.parent))}))},n.highLightByIds=function(e){var t=n.getCore(),r=t.scene,i=t.traverseNodes,a=[];i(r,(function(t){t.parent&&e.indexOf(t.parent.userData.uniqId)>=0&&a.indexOf(t.parent.userData.uniqId)<0&&a.push(t.parent.userData.uniqId),n.highLight(t.parent)}))},n.detection=function(){n.highLightedObjectsMap.size>0||n.flashedObjectsMap.size>0||n.customerHighLightedObjectsMap.size>0?n.getCore().isComposerRender=!0:n.getCore().isComposerRender=!1},n._init=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=n.getCore(),r=t.composer,i=t.scene,o=t.camera,s=t.width,l=t.height;n.isRenderPassInit||n.renderPassInit();for(var u=0;u<e;u++){var c=new E.OutlinePass(new E.Vector2(s,l),i,o);if(r.addPass(c),n.isPassInit||n.passInit(),a().isNil(n.config))return;var h=n.config;a().isNumber(h.edgeStrength)&&(c.edgeStrength=h.edgeStrength),a().isNumber(h.edgeGlow)&&(c.edgeGlow=h.edgeGlow),a().isNumber(h.edgeThickness)&&(c.edgeThickness=h.edgeThickness),a().isNumber(h.edgeStrength)&&(c.edgeStrength=h.edgeStrength),a().isNumber(h.pulsePeriod)&&(c.pulsePeriod=h.pulsePeriod),a().isNumber(h.visibleEdgeColor)&&(c.visibleEdgeColor=new E.Color(h.visibleEdgeColor)),a().isNumber(h.hiddenEdgeColor)&&(c.hiddenEdgeColor=new E.Color(h.hiddenEdgeColor)),a().isBoolean(h.isMutex)&&(n.isMutex=h.isMutex),a().isBoolean(h.isHF)&&(n.isHF=h.isHF),c.selectedObjects=[],n.highLightedObjectss[u]=[],n.outlinePasss.push(c)}n.isInit=!0},n.customer_init=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=n.getCore(),i=r.composer,o=r.scene,s=r.camera,l=r.width,u=r.height;n.isRenderPassInit||n.renderPassInit(),n.isCustomerInit=!0;for(var c=0;c<t;c++){var h=new E.OutlinePass(new E.Vector2(l,u),o,s);if(i.addPass(h),n.customerOutlinePasss.push(h),a().isNil(e))return;a().isNumber(e.edgeStrength)&&(h.edgeStrength=e.edgeStrength),a().isNumber(e.edgeGlow)&&(h.edgeGlow=e.edgeGlow),a().isNumber(e.edgeThickness)&&(h.edgeThickness=e.edgeThickness),a().isNumber(e.edgeStrength)&&(h.edgeStrength=e.edgeStrength),a().isNumber(e.pulsePeriod)&&(h.pulsePeriod=e.pulsePeriod),a().isNumber(e.visibleEdgeColor)&&(h.visibleEdgeColor=new E.Color(e.visibleEdgeColor)),a().isNumber(e.hiddenEdgeColor)&&(h.hiddenEdgeColor=new E.Color(e.hiddenEdgeColor))}n.isPassInit||n.passInit()},n.isInit=!1,n.isCustomerInit=!1,n.isPassInit=!1,n.isRenderPassInit=!1,n.isMutex=!0,n.isHF=!0,a().isNil(e)||(n.config=e),n.highLightedObjectss=[],n.highLightedObjectsMap=new Map,n.flashedObjectsMap=new Map,n.customerHighLightedObjectss=[],n.customerHighLightedObjectsMap=new Map,n.outlinePasss=[],n.customerOutlinePasss=[],n.lineSegments=[],n}return(0,m.default)(t,e),(0,g.default)(t,[{key:"passInit",value:function(){var e=this.getCore(),t=(e.scene,e.camera,e.composer),n=e.width,r=e.height,i=new E.ShaderPass(E.FXAAShader);i.uniforms.resolution.value.set(1/n,1/r),i.renderToScreen=!0,t.addPass(i),this.isPassInit=!0}},{key:"renderPassInit",value:function(){var e=this.getCore(),t=e.scene,n=e.camera,r=e.composer,i=new E.RenderPass(t,n);r.addPass(i),this.isRenderPassInit=!0}},{key:"createBoxTubeFromObject",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{color:1048575,opacity:0,radius:.04},n=0;n<e.children.length;n++)if("outlineObj"===e.children[n].name)return e.children[n];for(var r=e.position.x,i=e.position.y,a=e.position.z,o=new E.BoxHelper(e,16777215),s=o.geometry.index.array,l=[],u=o.geometry.attributes.position.array,c=0;c<u.length;c+=3){var h=new E.Vector3(u[c],u[c+1],u[c+2]);l.push(h)}var d=new E.Object3D;d.name="outlineObj";for(var p=new E.MeshBasicMaterial({color:t.color,transparent:!0,opacity:t.opacity}),f=0;f<s.length;f+=2){var m=new E.LineCurve3(l[s[f]],l[s[f+1]]),v=new E.TubeGeometry(m,2,t.radius,4,!1),g=new E.Mesh(v,p);g.position.set(-r,-i,-a),d.add(g)}return e.add(d),d}},{key:"createBoxPlaneFromObject",value:function(e,t){for(var n=0;n<e.children.length;n++)if("outlineObj"===e.children[n].name)return e.children[n];var r=t&&t.color?t.color:16777215,i=t&&t.opacity?t.opacity:0,a=t&&t.scale?t.scale:1,o=t&&t.sizeDifference?t.sizeDifference:0,s=t&&t.offset?t.offset:0,l=new E.Object3D;l.name="outlineObj";var u=(new E.Box3).setFromObject(e),c=u.min,h=u.max,d=h.x-c.x,p=h.y-c.y,f=h.z-c.z,m=new E.Vector3;u.getCenter(m);var v=new E.MeshBasicMaterial({color:r,transparent:!0,opacity:i}),g=new E.PlaneGeometry(d+o,p+o),y=new E.PlaneGeometry(d+o,f+o),x=new E.Mesh(g,v);x.scale.multiplyScalar(a);var b=x.clone(),M=new E.Mesh(y,v);M.scale.multiplyScalar(a),M.rotateX(Math.PI/2);var w=M.clone();return x.name="outlineObj-planeMeshFront",b.name="outlineObj-planeMeshBack",M.name="outlineObj-planeMeshUp",w.name="outlineObj-planeMeshBottom",x.position.set(m.x,m.y,h.z+s),b.position.set(m.x,m.y,c.z-s),M.position.set(m.x,h.y+s,m.z),w.position.set(m.x,c.y-s,m.z),l.add(x),l.add(b),l.add(M),l.add(w),l.position.set(-e.position.x,-e.position.y,-e.position.z),l.updateMatrixWorld(),e.add(l),l}},{key:"addEdge",value:function(e,t,n){var r=this,i=this.getCore(),a=i.traverseNodes,o=i.traverseNodesAll;if(e){var s=new E.LineBasicMaterial({color:t,linewidth:5});o(e,(function(e){"instancedMeshes"in e.userData&&e.userData.instancedMeshes.forEach((function(t){var i=t.mesh,a=t.id,o=new E.EdgesGeometry(i.geometry.clone()),l=new E.LineSegments(o,s);l.applyMatrix4(i.userData.meshMatrix[a].clone()),l.userData.type=n,r.lineSegments.push(l),e.add(l)}))})),a(e,(function(e){if("Mesh"==e.type&&!(e instanceof E.InstancedMesh)){var t=new E.EdgesGeometry(e.geometry.clone()),i=new E.LineSegments(t,s);i.applyMatrix4(e.matrix.clone()),i.userData.type=n,r.lineSegments.push(i),e.parent.add(i)}}))}}},{key:"removeEdge",value:function(e){for(var t=this.lineSegments.length-1;t>-1;t--)e&&e!=this.lineSegments[t].userData.type||(this.lineSegments[t].geometry.dispose(),this.lineSegments[t].geometry=null,this.lineSegments[t].material.dispose(),this.lineSegments[t].material=null,this.lineSegments[t].parent.remove(this.lineSegments[t]),this.lineSegments.splice(t,1))}}])}(ke),ni.Simulate=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).simulateArr=[],e.simlateStart=!1,e.firstFlag=!1,e.animate=function(){e.getCore(),e.simlateStart&&e.simulateArr.length>0&&(e.simulateArr.shift().visible=!0,e.core.needUpdate=!0),requestAnimationFrame(e.animate)},e.simulate=function(){var t=e.getCore(),n=t.scene;e.simulateArr.length=0,t.traverseMaterials(n,(function(t){e.simulateArr.push(t),t.visible=!1})),e.simlateStart=!0,e.core.needUpdate=!0,e.firstFlag||(e.animate(),e.firstFlag=!0)},e}return(0,m.default)(t,e),(0,g.default)(t)}(ke),ni.Video=function(e){function t(){var e;return(0,v.default)(this,t),(e=T(this,t)).videoArray=[],e.addVideoBox=function(t){var n=e.getCore(),r=n.scene,i=(n.render,t.width),a=t.height,o=t.depth,s=t.url,l=t.position,u=t.rotation,c=document.createElement("video");c.id="video"+100*Math.random(),c.autoplay=!0,c.controls=!0,c.loop=!0,c.muted=!0,c.src=s,c.style.display="none",document.body.appendChild(c);var h=new E.BoxBufferGeometry(i,a,o),d=new E.VideoTexture(c);d.wrapS=d.wrapT=E.ClampToEdgeWrapping,d.minFilter=E.LinearFilter;var p=new E.MeshBasicMaterial({map:d}),f=new E.Mesh(h,p);f.position.set(l.x,l.y,l.z),u&&(f.rotation.y=u*Math.PI/180),r.add(f);var m=new RegExp(".*[.](mp4|MP4|avi|AVI)$");null!==s.match(m)?c.play():new e.EZUIPlayer(c.id),e.core.needUpdate=!0,e.videoArray.push(c)},e.addVideoToMesh=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=(e.getCore().render,null);if(t instanceof HTMLElement)i=t;else{var a=t.url;(i=document.createElement("video")).id="video"+100*Math.random(),i.autoplay=!0,i.controls=!0,i.loop=!0,i.muted=!0,i.src=a,i.style.display="none",document.body.appendChild(i)}var o=new E.VideoTexture(i);o.rotation=r,o.center=new E.Vector2(.5,.5),o.wrapS=o.wrapT=E.ClampToEdgeWrapping,o.minFilter=E.LinearFilter;var s=new E.MeshBasicMaterial({map:o});n.material.map.dispose(),n.material.dispose(),n.material=s,e.core.needUpdate=!0},e.EZUIPlayer=n(119),e}return(0,m.default)(t,e),(0,g.default)(t)}(ke),ni.Audio=hr,ni.Cad=dr,ni.Particle=ur,ni.Glow=cr,ni.LineEffect=yr,ni.LineEffect2=br,ni.RailEffect=Ar,ni.WaterEffect=Pr,ni.RingEffect=Nr,ni.BallEffect=kr,ni.GroundEffect=zr,ni.SmokeEffect=jr,ni.SmokeEffect2=Wr,ni.SnowDay=ei,ni.FogDay=Xr,ni.Cloud=Yr,ni.RainDay=ti,ni.mouseMoveState=!1,ni.mouseDownState=!1,ni.mouseUpState=!1}(),r}()},"object"==(0,y.default)(t)&&"object"==(0,y.default)(e)?e.exports=x():(i=[],void 0===(a="function"==typeof(r=x)?r.apply(t,i):r)||(e.exports=a))},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},3063:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(995)],void 0===(a="function"==typeof(r=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.default=t.Bustard})?r.apply(t,i):r)||(e.exports=a)},8828:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(4563)],void 0===(a="function"==typeof(r=function(e,t){"use strict";var r=n(9173);function i(e,t){for(var n=0,r=[];n<e.length;)r.push(e.slice(n,n+=t));return r}function a(e,t){return function(n,r){return n[e][t]-r[e][t]}}function o(e){for(var t={},n=[],r=0;r<e.length;r++)t[e[r]]||(t[e[r]]=!0,n.push(e[r]));return n}function s(e){for(var n=[],r=0;r<e.length;r++)n.push.apply(n,(0,t.default)(e[r].children[0].children));return n.sort(a("userData","name")),n}function l(e){return new Promise((function(t){return setTimeout(t,e)}))}function u(e,t){for(var n=0;n<e.length;n++)if(t===e[n])return!0;return!1}function c(e){return e.parent?"Scene"===e.parent.type?e:c(e.parent):e}function h(e,t){return!!t.parent&&(e===t.parent.name&&"Scene"===t.parent.type||h(e,t.parent))}function d(e,t){return e.uuid===t.uuid||!(!t||!t.parent)&&d(e,t.parent)}function p(e){return e.parent?"Scene"===e.parent.type&&"RootScene"===e.parent.name?e:p(e.parent):e}function f(e,t,n){e.push({id:n,name:t.name}),t.name!==n&&(t.parent&&t.parent.name!==n?f(e,t.parent,n):t.parent&&t.parent.name===n&&e.push({id:n,name:n}))}function m(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function v(e,t){for(var n=0,r=0,i=e.length;r<i;r++)if(t.url===e[r].url&&t.fileName===e[r].fileName){n=t.opacity===e[r].opacity?1:2;break}return n}function g(e){return e*(180/Math.PI)}function y(e){return e*(Math.PI/180)}function x(e,t){var n,r,i;e&&(null===(n=e.layers)||void 0===n||null===(r=n.enable)||void 0===r||r.call(n,t),null===(i=e.children)||void 0===i||i.forEach((function(e){x(e,t)})))}function b(e,t){var n;e&&(e.userData=t,null===(n=e.children)||void 0===n||n.forEach((function(e){b(e,t)})))}function M(e){if(7!==e.length&&9!==e.length)return null;var t=Number.parseInt(e.slice(1,3),16)/255,n=Number.parseInt(e.slice(3,5),16)/255,r=Number.parseInt(e.slice(5,7),16)/255,i=1;return 9===e.length&&(i=Number.parseInt(e.slice(7,9),16)/255),[t,n,r,i]}function w(e){var t="#".concat("000000".concat(e.toString(16)).slice(-6)),n=Number.parseInt(t.slice(1,3),16)/255,r=Number.parseInt(t.slice(3,5),16)/255,i=Number.parseInt(t.slice(5,7),16)/255,a=1;return 9===t.length&&(a=Number.parseInt(t.slice(7,9),16)/255),[n,r,i,a]}Object.defineProperty(e,"__esModule",{value:!0}),e.array_unique=o,e.getModelByMesh=c,e.getNodeTree=f,e.getParentTemplateModelByMesh=p,e.group=i,e.hexToArray=w,e.inUrls=v,e.isChildByScene=h,e.isInArray=u,e.isParent=d,e.mergeSceneModel=s,e.rgbStringToArray=M,e.setLayer=x,e.setUserData=b,e.sleep=l,e.sortBy=a,e.toDegrees=g,e.toRadians=y,e.uuid=m,t=r(t)})?r.apply(t,i):r)||(e.exports=a)},4700:function(e,t,n){var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012)],r=function(e,t,r){"use strict";var i=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.SimpleDB=void 0,t=i(t),r=i(r),e.SimpleDB=function(){function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ModelsDB";(0,t.default)(this,e),this.DB_NAME=r,this.STORE_NAME="model",n&&(this.support=this.checkDBSupper(),this.createDB(this.DB_NAME,Date.now()))}return(0,r.default)(e,[{key:"createDB",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.DB_NAME,n=arguments.length>1?arguments[1]:void 0;if(!this.support)return null;var r=indexedDB.open(t,n);r.onerror=function(e){},r.onsuccess=function(t){e.db=t.target.result,e.db.onversionchange=function(){e.db.close()}},r.onupgradeneeded=function(t){e.db=r.result,e.db.onversionchange=function(){e.db.close()},e.db.objectStoreNames.contains(e.STORE_NAME)||e.db.createObjectStore(e.STORE_NAME,{keyPath:"url"})}}},{key:"closeDB",value:function(){this.support&&this.db&&this.db.close()}},{key:"checkDBSupper",value:function(){return!!window.indexedDB}},{key:"get",value:function(e){var t=this;return this.support?new Promise((function(n,r){var i=indexedDB.open(t.DB_NAME);i.onsuccess=function(a){var o=i.result.transaction(t.STORE_NAME,"readonly").objectStore(t.STORE_NAME).get(e);o.onsuccess=function(e){var t=e.target.result;a.target.result.close(),n(t)},o.onerror=function(e){a.target.result.close(),r(void 0)}}})):Promise.resolve(null)}},{key:"put",value:function(e,t,n){var r=this;if(!this.support)return null;var i=indexedDB.open(this.DB_NAME);i.onsuccess=function(a){var o={url:e,data:t,version:n},s=i.result.transaction([r.STORE_NAME],"readwrite").objectStore(r.STORE_NAME).put(o);s.onsuccess=function(e){a.target.result.close()},s.onerror=function(e){a.target.result.close()}}}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},1416:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220),n(3286)],void 0===(a="function"==typeof(r=function(e,t,r,i,a){var o=n(9173);function s(e){return Array.isArray(e)||(e=[e]),e}Object.defineProperty(e,"__esModule",{value:!0}),e.ActionsTool=void 0,t=o(t),r=o(r),i=o(i),e.ActionsTool=function(){function e(n){(0,t.default)(this,e),(0,i.default)(this,"web3d",void 0),this.web3d=n}return(0,r.default)(e,[{key:"selectOnTop",value:function(e){this.web3d.performAction(s(e),"selectOnTop")}},{key:"hide",value:function(e){this.web3d.performAction(s(e),"hide")}},{key:"show",value:function(e){this.web3d.performAction(s(e),"show")}},{key:"color",value:function(e,t){this.web3d.performAction(s(e),"color",t)}},{key:"transparent",value:function(e,t){this.web3d.performAction(s(e),"transparent",t)}},{key:"clearTransparent",value:function(e){(0,a.isNil)(e)?this.web3d.clearEffect("transparent"):this.web3d.performAction(s(e),"restoreTransparent")}},{key:"clearColor",value:function(e){(0,a.isNil)(e)?this.web3d.clearEffect("selectEffect"):this.web3d.performAction(s(e),"restoreColor")}},{key:"clearHighLight",value:function(){this.web3d.clearEffect("highLight")}},{key:"clearSelectOnTop",value:function(){this.web3d.clearEffect("selectOnTop")}},{key:"clearHide",value:function(){this.web3d.clearEffect("hide")}},{key:"focus",value:function(e,t){this.web3d.performAction(s(e),"focus",t)}},{key:"destroy",value:function(){this.web3d=null}}])}()})?r.apply(t,i):r)||(e.exports=a)},5925:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220),n(3286)],void 0===(a="function"==typeof(r=function(e,t,r,i,a){var o=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.WebAnimationTool=void 0,t=o(t),r=o(r),i=o(i),e.WebAnimationTool=function(){function e(n,r){(0,t.default)(this,e),this.loader=n,this.renderTool=r,(0,i.default)(this,"clock",new THREE.Clock),(0,i.default)(this,"animationMixerMap",new Map),(0,i.default)(this,"animationActionMap",new Map)}return(0,r.default)(e,[{key:"animationMap",get:function(){return this.loader.modelAnimationMap}},{key:"modelMap",get:function(){return this.loader.modelMap}},{key:"getAnimationList",value:function(e){var t=(null!=e?e:{}).id;(0,a.shouldNotNil2)(t,"getAnimationList id is required");var n=this.animationMap.get(t);return(0,a.isNil)(n)?[]:n}},{key:"playAnimation",value:function(e){var t=null!=e?e:{},n=t.modelId,r=t.animationId,i=t.isLoop,o=void 0===i||i,s=t.jumpToEnd,l=void 0!==s&&s;(0,a.shouldNotNil2)(n,"playAnimation modelId is required"),(0,a.shouldNotNil2)(r,"playAnimation animationId is required");var u=this.getAnimationMixer(n);if(!(0,a.isNil)(u)){u.stopAllAction();var c=this.getAnimationAction(n,r);(0,a.isNil)(c)||(c.clampWhenFinished=!0,o||c.setLoop(THREE.LoopOnce,1),l&&(c.time=c.getClip().duration),c.play(),u.update(0),this.renderTool.setNeedUpdate())}}},{key:"getAnimationMixer",value:function(e){if(this.animationMixerMap.has(e))return this.animationMixerMap.get(e);if(!this.modelMap.has(e))return null;var t=new THREE.AnimationMixer(this.modelMap.get(e));return this.animationMixerMap.set(e,t),t}},{key:"getAnimationAction",value:function(e,t){var n,r="".concat(e,"-").concat(t);if(this.animationActionMap.has(r))return this.animationActionMap.get(r);var i=null!==(n=this.animationMap.get(e))&&void 0!==n?n:[],o=THREE.AnimationClip.findByName(i,t);if(!(0,a.isNil)(o)){var s=this.getAnimationMixer(e);if(!(0,a.isNil)(s)){var l=s.clipAction(o);if(!(0,a.isNil)(l))return this.animationActionMap.set(r,l),l}}}},{key:"updateAnimation",value:function(){var e=this,t=this.clock.getDelta();Array.from(this.animationActionMap.values()).filter((function(e){return null==e?void 0:e.isRunning()})).map((function(e){return e.getMixer()})).forEach((function(n){n.update(t),e.renderTool.setNeedUpdate()}))}},{key:"removeAnimationByModelId",value:function(e){var t=this,n=this.animationMixerMap.get(e);if(!(0,a.isNil)(n)){var r=[];this.animationActionMap.forEach((function(e,t){e.getMixer()===n&&r.push(t)})),r.forEach((function(e){return t.animationActionMap.delete(e)})),this.animationMixerMap.delete(e),n.stopAllAction()}}}])}()})?r.apply(t,i):r)||(e.exports=a)},7154:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(3286)],void 0===(a="function"==typeof(r=function(e,t,r,i){var a=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.MeshInfoTool=void 0,t=a(t),r=a(r),e.MeshInfoTool=function(){function e(n){(0,t.default)(this,e),this.threeBase=n}return(0,r.default)(e,[{key:"getMeshTriangleCount",value:function(e){var t=this.threeBase.getObjectByUniqueTarget(e,!1);if((0,i.isNil)(t))return 0;var n=0;return t.traverse((function(e){if("Mesh"===e.type){var t=e.geometry;t&&t.index&&(n+=t.index.count/3)}(0,i.isInstanceNode)(e)&&e.userData.instancedMeshes.forEach((function(e){var t=e.mesh.geometry;t&&t.index&&(n+=t.index.count/3)}))})),n}},{key:"getMaterialNameList",value:function(e){var t=this.threeBase.getObjectByUniqueTarget(e,!1);if((0,i.isNil)(t))return[];var n=[];return t.traverse((function(e){if((0,i.hasMaterial)(e)){var t=e.material;t.name&&!n.includes(t.name)&&n.push(t.name)}(0,i.isInstanceNode)(e)&&e.userData.instancedMeshes.forEach((function(e){var t=e.mesh;if((0,i.hasMaterial)(t)){var r=t.material;r.name&&!n.includes(r.name)&&n.push(r.name)}}))})),n}},{key:"destroy",value:function(){this.threeBase=null}}])}()})?r.apply(t,i):r)||(e.exports=a)},3954:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220),n(3286)],void 0===(a="function"==typeof(r=function(e,t,r,i,a){var o=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.ThreeNodeSizeTool=void 0,t=o(t),r=o(r),i=o(i);var s={style:{boxSizing:"border-box",backgroundColor:"rgba(0,0,0,0.7)",fontSize:"14px",color:"#FFF500",padding:"4px",border:"1px solid #FFF500",borderRadius:"4px"},sizeFormatter:function(e,t){return"".concat(t,"：").concat(e.toFixed(2),"m")},volumeFormatter:function(e){return"".concat(e.toFixed(2),"m³")},areaFormatter:function(e){return"".concat(e.toFixed(2),"m²")}},l={color:16774400,linewidth:2,segmentEndpointLength:.4},u={VOLUME:"volume",AREA:"area",SIZEX:"sizeX",SIZEY:"sizeY",SIZEZ:"sizeZ"};function c(e,t,n){var r=document.createElement("div"),i=document.createElement("div");return i.innerText=t,Object.assign(r.style,n),r.appendChild(i),r.setAttribute("size-id",e),r}function h(e,t,n){return"".concat(e,"-").concat(t,"-").concat(n)}e.ThreeNodeSizeTool=function(){function e(n){(0,t.default)(this,e),this.threeBase=n,(0,i.default)(this,"labelStyle",Object.assign({},s.style)),(0,i.default)(this,"lineStyle",Object.assign({},l)),(0,i.default)(this,"sizeFormatter",s.sizeFormatter),(0,i.default)(this,"volumeFormatter",s.volumeFormatter),(0,i.default)(this,"areaFormatter",s.areaFormatter),(0,i.default)(this,"sizeLabelMap",new Map),(0,i.default)(this,"volumeLabelMap",new Map),(0,i.default)(this,"areaLabelMap",new Map)}return(0,r.default)(e,[{key:"setLabelStyle",value:function(e){var t=e.style,n=void 0===t?{}:t,r=e.lineStyle,i=void 0===r?{}:r,a=e.sizeFormatter,o=void 0===a?this.sizeFormatter:a,s=e.volumeFormatter,l=void 0===s?this.volumeFormatter:s,u=e.areaFormatter,c=void 0===u?this.areaFormatter:u;Object.assign(this.labelStyle,n),Object.assign(this.lineStyle,i),this.sizeFormatter=o,this.volumeFormatter=l,this.areaFormatter=c}},{key:"showNodeSize",value:function(e){(0,a.shouldNotNil)(e,"target");var t=e.id,n=e.name;(0,a.isNil)(n)&&(n=t);var r=this.threeBase.getNodeTopPosition(t,n);if(r){var i=r.center,o=r.size,s=h(t,n,u.SIZEX),l=h(t,n,u.SIZEY),d=h(t,n,u.SIZEZ),p=c(s,this.sizeFormatter(o.x,"X"),this.labelStyle),f=c(l,this.sizeFormatter(o.y,"Y"),this.labelStyle),m=c(d,this.sizeFormatter(o.z,"Z"),this.labelStyle),v=i.clone().add(new window.THREE.Vector3(0,o.y/2,o.z/2)),g=i.clone().add(new window.THREE.Vector3(-o.x/2,0,o.z/2)),y=i.clone().add(new window.THREE.Vector3(o.x/2,o.y/2,0));this.threeBase.addLabel(s,p,v,[],s),this.threeBase.addLabel(l,f,g,[],l),this.threeBase.addLabel(d,m,y,[],d);var x=this.lineStyle.segmentEndpointLength,b=this.addArrowHelpeLine({x:g.x-x,y:g.y,z:g.z},o.y,{x:0,y:0,z:0}),M=this.addArrowHelpeLine({x:v.x,y:v.y,z:v.z+x},o.x,{x:Math.PI/2,y:0,z:Math.PI/2}),w=this.addArrowHelpeLine({x:y.x+x,y:y.y,z:y.z},o.z,{x:Math.PI/2,y:0,z:0});this.sizeLabelMap.set(s,{label:p,arrowLine:M}),this.sizeLabelMap.set(l,{label:f,arrowLine:b}),this.sizeLabelMap.set(d,{label:m,arrowLine:w})}}},{key:"addArrowHelpeLine",value:function(e,t,n){var r=this.lineStyle,i=r.segmentEndpointLength,a=r.color,o=r.linewidth,s=new window.THREE.Object3D;s.position.set(e.x,e.y,e.z),s.rotation.set(n.x,n.y,n.z);var l=new window.THREE.LineMaterial({color:a,linewidth:o,depthTest:!1,depthWrite:!1,transparent:!0});l.resolution.set(window.innerWidth,window.innerHeight);var u=new window.THREE.LineGeometry;u.setPositions([0,-t/2,0,0,t/2,0]);var c=new window.THREE.Line2(u,l);s.add(c);var h=new window.THREE.LineGeometry;h.setPositions([-i,-t/2,0,i,-t/2,0]);var d=new window.THREE.Line2(h,l);s.add(d);var p=new window.THREE.LineGeometry;p.setPositions([-i,t/2,0,+i,t/2,0]);var f=new window.THREE.Line2(p,l);return s.add(f),this.threeBase.bustard.core.scene.add(s),s}},{key:"removeAllNodeSize",value:function(){var e=this;this.sizeLabelMap.forEach((function(t,n){var r=t.arrowLine;e.threeBase.emptyLabel(n),e.threeBase.bustard.core.dispose(r)})),this.sizeLabelMap.clear()}},{key:"showNodeVolume",value:function(e){(0,a.shouldNotNil)(e,"target");var t=e.id,n=e.name;(0,a.isNil)(n)&&(n=t);var r=this.threeBase.getNodeTopPosition(t,n);if(r){var i=r.center,o=r.size,s=o.x*o.y*o.z,l=h(t,n,u.VOLUME),d=c(l,this.volumeFormatter(s),this.labelStyle);this.threeBase.addLabel(l,d,i,[],l),this.volumeLabelMap.set(l,d)}}},{key:"removeAllNodeVolume",value:function(){var e=this;this.volumeLabelMap.forEach((function(t,n){e.threeBase.emptyLabel(n)})),this.volumeLabelMap.clear()}},{key:"showNodeArea",value:function(e){(0,a.shouldNotNil)(e,"target");var t=e.id,n=e.name;(0,a.isNil)(n)&&(n=t);var r=this.threeBase.getNodeTopPosition(t,n);if(r){var i=r.center,o=r.size,s=o.x*o.y*2+o.x*o.z*2+o.y*o.z*2,l=h(t,n,u.AREA),d=c(l,this.areaFormatter(s),this.labelStyle);this.threeBase.addLabel(l,d,i,[],l),this.areaLabelMap.set(l,d)}}},{key:"removeAllNodeArea",value:function(){var e=this;this.areaLabelMap.forEach((function(t,n){e.threeBase.emptyLabel(n)})),this.areaLabelMap.clear()}},{key:"destroy",value:function(){this.threeBase=null}}])}()})?r.apply(t,i):r)||(e.exports=a)},216:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220)],void 0===(a="function"==typeof(r=function(e,t,r,i){var a=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.OldMeasurementTool=void 0,t=a(t),r=a(r),i=a(i),e.OldMeasurementTool=function(){function e(n){(0,t.default)(this,e),(0,i.default)(this,"threeBase",void 0),(0,i.default)(this,"measurementStatus",!1),(0,i.default)(this,"measurementType",1),(0,i.default)(this,"firstPoint",null),(0,i.default)(this,"secondPoint",null),(0,i.default)(this,"measurementLine",null),(0,i.default)(this,"measurementStyle",{point:{size:.3,color:255}}),this.threeBase=n}return(0,r.default)(e,[{key:"bustard",get:function(){return this.threeBase.bustard}},{key:"mark",get:function(){return this.threeBase.mark}},{key:"setMeasurement",value:function(e){this.measurementType=e}},{key:"startMeasurement",value:function(){this.measurementStatus=!0}},{key:"stopMeasurement",value:function(){this.measurementStatus=!1,this.firstPoint&&this.bustard.core.dispose(this.firstPoint),this.secondPoint&&this.bustard.core.dispose(this.secondPoint),this.measurementLine&&this.bustard.core.dispose(this.measurementLine),this.threeBase.emptyLabel("measurementLabel"),this.firstPoint=null,this.secondPoint=null,this.measurementLine=null}},{key:"setMeasurementStyle",value:function(e){var t=e.size,n=e.color;t&&(this.measurementStyle.point.size=t),n&&(this.measurementStyle.point.color=n)}},{key:"handleClick",value:function(e){var t=e.point,n=this.measurementStyle.point;if(this.firstPoint||this.secondPoint)if(this.firstPoint&&!this.secondPoint){this.secondPoint=this.mark.createPoint(t,{color:n.color,opacity:1,size:n.size}),this.measurementLine=this.mark.createRTCLine(this.firstPoint.position,this.secondPoint.position);var r,i=document.createElement("div");i.style.textAlign="center",i.style.color="#ff0000",i.style.fontFamily="宋体",i.style.fontSize="16px";var a="";1===this.measurementType?(r=Math.sqrt(Math.pow(this.firstPoint.position.x-this.secondPoint.position.x,2)+Math.pow(this.firstPoint.position.y-this.secondPoint.position.y,2)+Math.pow(this.firstPoint.position.z-this.secondPoint.position.z,2)),a="直线距离：".concat(r.toFixed(3)," m")):2===this.measurementType?(r=Math.sqrt(Math.pow(this.firstPoint.position.x-this.secondPoint.position.x,2)+Math.pow(this.firstPoint.position.z-this.secondPoint.position.z,2)),a="水平距离：".concat(r.toFixed(3)," m")):3===this.measurementType&&(r=Math.abs(this.firstPoint.position.y-this.secondPoint.position.y),a="垂直距离：".concat(r.toFixed(3)," m")),i.innerText=a,this.threeBase.addLabel("measurementLabel",i,{x:(this.firstPoint.position.x+this.secondPoint.position.x)/2,y:(this.firstPoint.position.y+this.secondPoint.position.y)/2,z:(this.firstPoint.position.z+this.secondPoint.position.z)/2},[],"measurementLabel")}else this.bustard.core.dispose(this.firstPoint),this.bustard.core.dispose(this.secondPoint),this.bustard.core.dispose(this.measurementLine),this.threeBase.emptyLabel("measurementLabel"),this.firstPoint=this.mark.createPoint(t,{color:n.color,opacity:1,size:n.size}),this.secondPoint=null,this.measurementLine=null;else this.firstPoint=this.mark.createPoint(t,{color:n.color,opacity:1,size:n.size})}},{key:"destroy",value:function(){this.threeBase=null}}])}()})?r.apply(t,i):r)||(e.exports=a)},6389:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(4563),n(7264),n(2026),n(4012),n(5220),n(3286)],r=function(e,t,r,i,a,o,s){var l=n(9173);function u(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=c(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function c(e,t){if(e){if("string"==typeof e)return h(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t){var n=e.position.x-t.position.x,r=e.position.y-t.position.y,i=e.position.z-t.position.z;return Math.sqrt(n*n+r*r+i*i)}function m(e,t,n){var r=t.reduce((function(e,t){return e.set(t.name,t),e}),new Map),i=n.reduce((function(e,t){return e.set(t.name,t),e}),new Map),a=e.map((function(e){var t=e.map((function(e){return i.get(e)})).filter(s.isNotNil),n=0,a=t.reduce((function(e,i,a){if(0===a)return e;var o=t[a-1].name,l=i.lines.find((function(e){var t=r.get(e);return!!t&&t.points.includes(o)})),u=f(t[a-1],i);return n+=u,(0,s.isNotNil)(l)&&r.has(l)&&e.push(r.get(l)),e}),[]);return{points:t.map(y),lines:a.map(x),len:n}}));return a.sort((function(e,t){return e.len<t.len?-1:e.len>t.len?1:e.points.length-t.points.length}))}function v(e){var t=e.lines,n={};return t.forEach((function(e){var t=e.points,i=(0,r.default)(t,2),a=i[0],o=i[1];n[a]||(n[a]=[]),n[o]||(n[o]=[]),n[a].push(o),n[o].push(a)})),n}function g(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5?arguments[5]:void 0;if(i.add(n),a.push(n),n===r)o.push((0,t.default)(a));else{var s,l=u(e[n]);try{for(l.s();!(s=l.n()).done;){var c=s.value;i.has(c)||g(e,c,r,i,a,o)}}catch(e){l.e(e)}finally{l.f()}}i.delete(n),a.pop()}function y(e){return{name:e.name,position:e.position,lines:e.lines}}function x(e){return{name:e.name,points:e.points}}Object.defineProperty(e,"__esModule",{value:!0}),e.PipeLineTool=void 0,t=l(t),r=l(r),i=l(i),a=l(a),o=l(o),e.PipeLineTool=function(){function e(t){var n=t.transformControl,r=t.bustard,a=t.mark;(0,i.default)(this,e),(0,o.default)(this,"_addPipeLineState",!1),(0,o.default)(this,"pipeLineData",{points:[],lines:[],currentChosenName:""}),(0,o.default)(this,"pipeLinePointSize",.4),(0,o.default)(this,"dragPipeLinePointAction",null),(0,o.default)(this,"transformControl",void 0),(0,o.default)(this,"bustard",void 0),(0,o.default)(this,"mark",void 0),this.transformControl=n,this.bustard=r,this.mark=a}return(0,a.default)(e,[{key:"addPipeLineState",get:function(){return this._addPipeLineState}},{key:"handlePickAction",value:function(e){var t=e.name;if(this._addPipeLineState){var n=this.pipeLineData,r=n.points,i=n.currentChosenName,a=r.find((function(e){return e.name===t}));a&&(t===i?(this.pipeLineData.currentChosenName="",this.transformControl.detach()):(this.pipeLineData.currentChosenName=a.name,this.transformControl.attach(a.point,!1)))}}},{key:"handleEditLineDrag",value:function(e){var t,n=e.mesh,r=n.name,i=n.position,a=this.pipeLineData,o=a.points,s=a.lines,l=a.currentChosenName;if(r===l){var u=o.find((function(e){return e.name===l}));if(u){Object.assign(u.position,i);var c=u.lines;s.filter((function(e){return c.includes(e.name)})).forEach((function(e){var t=e.line;t.geometry.isBufferGeometry?(e.points[0]===l?t.geometry.attributes.position.setXYZ(0,i.x,i.y,i.z):t.geometry.attributes.position.setXYZ(1,i.x,i.y,i.z),t.geometry.attributes.position.needsUpdate=!0):(e.points[0]===l?t.geometry.vertices[0].set(i.x,i.y,i.z):t.geometry.vertices[1].set(i.x,i.y,i.z),t.geometry.verticesNeedUpdate=!0)})),null===(t=this.dragPipeLinePointAction)||void 0===t||t.call(this)}}}},{key:"setPipeLineState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4;this._addPipeLineState=e,this.pipeLinePointSize=t}},{key:"setChosenPipeLinePoint",value:function(e){this.handlePickAction({name:e})}},{key:"loadPipeLine",value:function(e){var t=this,n=e.points,r=e.lines,i=e.currentChosenName,a=new Map;if(n.forEach((function(e){var n;a.set(e.name,e.position);var r=t.mark.createPoint(e.position,{color:255,opacity:1,size:.1});r.name=null!==(n=e.name)&&void 0!==n?n:r.uuid,e.name=r.name,e.point=r})),r.forEach((function(e){var n,r=e.points,i=t.mark.createLine(a.get(r[0]),a.get(r[1]));i.name=null!==(n=e.name)&&void 0!==n?n:i.uuid,e.name=i.name,e.line=i})),i){var o=n.find((function(e){return e.name===i}));(0,s.isNotNil)(o)&&this.bustard.core.transformControlAttach(o.point,!1)}this.pipeLineData={points:n,lines:r,currentChosenName:i}}},{key:"removePipeLinePoint",value:function(e){var t=this.pipeLineData,n=t.currentChosenName,r=t.lines,i=t.points,a=this.bustard;n===e&&(this.pipeLineData.currentChosenName="",a.core.transformControlDetach());var o=i.findIndex((function(t){return t.name===e}));if(-1!==o){var s=i.splice(o,1)[0];a.core.dispose(s.point);var l=[],u=[];r.forEach((function(t){t.points.includes(e)?(u.push(t.name),a.core.dispose(t.line)):l.push(t)})),this.pipeLineData.lines=l,i.forEach((function(e){e.lines=e.lines.filter((function(e){return!u.includes(e)}))}))}}},{key:"removePipeLineLink",value:function(e){var t=this.pipeLineData,n=t.lines,r=t.points,i=this.bustard,a=n.findIndex((function(t){return t.name===e}));if(-1!==a){var o=n.splice(a,1)[0];i.core.dispose(o.line),r.filter((function(e){return o.points.includes(e.name)})).forEach((function(t){t.lines=t.lines.filter((function(t){return t!==e}))}))}}},{key:"restorePipeLine",value:function(){var e=this.pipeLineData,t=e.points,n=e.lines,r=this.bustard;r.core.transformControlDetach(),t.forEach((function(e){r.core.dispose(e.point)})),n.forEach((function(e){r.core.dispose(e.line)})),this.pipeLineData={points:[],lines:[],currentChosenName:""}}},{key:"recordPipeLinePoint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},t=this.pipeLineData,n=t.currentChosenName,r=t.points,i=t.lines,a=e,o=r.find((function(e){return e.name===n}));o&&(a.x=o.position.x,a.y=o.position.y,a.z=o.position.z);var s=this.mark.createPoint(a,{color:255,opacity:1,size:this.pipeLinePointSize});s.name=s.uuid;var l={name:s.uuid,position:a,point:s,lines:[]};if(r.push(l),o){var u=[o.position,l.position],c=this.mark.createLine(u[0],u[1]);c.name=c.uuid;var h={name:c.uuid,line:c,points:[o.name,l.name]};i.push(h),o.lines.push(h.name),l.lines.push(h.name)}return this.pipeLineData.currentChosenName=l.name,this.bustard.core.transformControlAttach(l.point,!1),l.name}},{key:"setDragPipeLinePointAction",value:function(e){this.dragPipeLinePointAction=e}},{key:"linkPipeLinePoints",value:function(e,t){var n=this.pipeLineData,r=n.points,i=n.lines,a=r.filter((function(n){return[e,t].includes(n.name)}));if(2===a.length&&-1===i.findIndex((function(n){return n.points.includes(e)&&n.points.includes(t)}))){var o=[a[0].position,a[1].position],s=this.mark.createLine(o[0],o[1]);s.name=s.uuid;var l={name:s.uuid,line:s,points:[a[0].name,a[1].name]};return i.push(l),a[0].lines.push(l.name),a[1].lines.push(l.name),l.name}}},{key:"setPipeLineColor",value:function(e,t){this.pipeLineData.lines.filter((function(t){return e.includes(t.name)})).forEach((function(e){e.line.material.color.set(t),e.line.material.needsUpdate=!0}))}},{key:"resetPipeLineColor",value:function(){this.pipeLineData.lines.forEach((function(e){e.line.material.color.set(65280),e.line.material.needsUpdate=!0}))}},{key:"searchPipeLinePath",value:function(e,t,n,r){if(e!==t&&e&&t){if(r&&n.routes){var i=n.routes.filter((function(n){return n.start===e&&n.end===t||n.start===t&&n.end===e})),a=JSON.parse(JSON.stringify(i));if(a.length>0)return a.forEach((function(e){e.points=e.points.map((function(e){return{position:e}}))})),a}var o=[];return g(v(n),e,t,new Set,[],o),m(o,n.lines,n.points)}}},{key:"getCurrentPipeLine",value:function(){var e=this.pipeLineData;return{points:e.points.map((function(e){return p(p({},e),{},{point:void 0})})),lines:e.lines.map((function(e){return p(p({},e),{},{line:void 0})})),currentChosenName:e.currentChosenName}}},{key:"destroy",value:function(){this.bustard=null,this.transformControl=null,this.mark=null}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},3977:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220)],void 0===(a="function"==typeof(r=function(e,t,r,i){var a=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.RenderTool=void 0,t=a(t),r=a(r),i=a(i),e.RenderTool=function(){function e(n){(0,t.default)(this,e),(0,i.default)(this,"bustard",void 0),(0,i.default)(this,"closeRenderOnDemandCallback",this._closeRenderOnDemandCallback.bind(this)),this.bustard=n}return(0,r.default)(e,[{key:"openRenderOnDemand",value:function(){this.bustard.core.removeAfterRenderCallback(this.closeRenderOnDemandCallback),this.setNeedUpdate()}},{key:"closeRenderOnDemand",value:function(){this.bustard.core.addAfterRenderCallback(this.closeRenderOnDemandCallback),this.setNeedUpdate()}},{key:"setNeedUpdate",value:function(){this.bustard.core.needUpdate=!0}},{key:"_closeRenderOnDemandCallback",value:function(){this.setNeedUpdate()}}])}()})?r.apply(t,i):r)||(e.exports=a)},8853:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220),n(3286)],void 0===(a="function"==typeof(r=function(e,t,r,i,a){var o=n(9173);function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=l(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function l(e,t){if(e){if("string"==typeof e)return u(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteLabelManager=void 0,t=o(t),r=o(r),i=o(i);var c=300,h=300;function d(e){switch(e){case"top-left":return{x:0,y:1};case"top-right":return{x:1,y:1};case"bottom-left":return{x:0,y:0};case"bottom-right":return{x:1,y:0};case"top-center":return{x:.5,y:1};case"bottom-center":return{x:.5,y:0};default:return{x:.5,y:.5}}}function p(e,t,n){var r=window.THREE.MathUtils.degToRad(e);return Math.abs(2*t*Math.tan(r/2)/n)}e.SpriteLabelManager=function(){function e(n){(0,t.default)(this,e),(0,i.default)(this,"defaultMouseOutTimeout",700),(0,i.default)(this,"defaultMouseInTimeout",700),(0,i.default)(this,"currentSyncFlashVisible",!1),(0,i.default)(this,"autoScaleSpriteLabelList",[]),(0,i.default)(this,"hoverdChangeCallbackList",[]),(0,i.default)(this,"syncFlashIntervalId",void 0),(0,i.default)(this,"tempHoverId",void 0),(0,i.default)(this,"startPauseFlashTimeoutId",void 0),(0,i.default)(this,"currentHoverId",void 0),(0,i.default)(this,"threeBase",void 0),(0,i.default)(this,"_cameraChangeCallback",void 0),this.threeBase=n,this._cameraChangeCallback=this.cameraChangeCallback.bind(this),this.threeBase.setCameraChangeHandler("update",this._cameraChangeCallback,{removeOthers:!1}),this.syncFlashIntervalId=setInterval(this.handleSyncFlash.bind(this),h)}return(0,r.default)(e,[{key:"horvedSpriteList",get:function(){return this.autoScaleSpriteLabelList.filter((function(e){return e.horved}))}},{key:"syncFlashSpriteList",get:function(){return this.autoScaleSpriteLabelList.filter((function(e){return e.syncFlash&&!e.horved&&!e.forcePauseFlash}))}},{key:"cameraFov",get:function(){return this.threeBase.bustard.core.camera.fov}},{key:"clientHeight",get:function(){var e,t;return null!==(e=null===(t=this.threeBase.content)||void 0===t?void 0:t.clientHeight)&&void 0!==e?e:919}},{key:"addAutoScaleSpriteLabel",value:function(e){var t,n,r,i,o,s=e.id,l=e.url,u=e.scaleCalculator,h=e.canvas,d=e.position,p=e.labelType,f=e.alwaysOnTop,m=e.flash,v=void 0!==m&&m,g=e.flashInterval,y=void 0===g?c:g,x=e.syncFlash,b=void 0!==x&&x,M=e.renderOrder,w=e.anchorType,_=e.scale,A=e.pixelSize;if(!this.autoScaleSpriteLabelList.find((function(e){return e.id===s}))){var C=this.getCameraPosition(),T=null!=_?_:null==u?void 0:u(C.distanceTo((0,a.toVevtor3)(d))),S={width:null!==(t=null!==(n=null==A?void 0:A.width)&&void 0!==n?n:null==h?void 0:h.width)&&void 0!==t?t:30,height:null!==(r=null!==(i=null==A?void 0:A.height)&&void 0!==i?i:null==h?void 0:h.height)&&void 0!==r?r:30},E=this.addSpriteLabelToScene({id:s,url:null!==(o=null==h?void 0:h.toDataURL())&&void 0!==o?o:l,initialScale:T,position:d,labelType:p,alwaysOnTop:f,flash:v,syncFlash:b,renderOrder:M,anchorType:w,size:S}).sprite,L={id:s,sprite:E,scale:_,scaleCalculator:u,position:(0,a.toVevtor3)(d),labelType:p,spriteHeight:S.height,spriteWidth:S.width,flash:v,flashInterval:y,syncFlash:b};v&&!b&&this.startSpritelabelPrivateFlash(L),this.autoScaleSpriteLabelList.push(L)}}},{key:"batchAddAutoScaleSpriteLabel",value:function(e){var t,n=this,r=this.getCameraPosition(),i=s(e);try{var o=function(){var e,i,o,s,l,u=t.value,c=u.id,h=u.scale,d=u.scaleCalculator,p=u.canvas,f=u.position,m=u.labelType,v=u.alwaysOnTop,g=u.flash,y=u.syncFlash,x=u.flashInterval,b=u.renderOrder,M=u.anchorType,w=u.pixelSize,_=u.url;if(n.autoScaleSpriteLabelList.find((function(e){return e.id===c})))return 1;var A=null!=h?h:null==d?void 0:d(r.distanceTo((0,a.toVevtor3)(f))),C={width:null!==(e=null!==(i=null==w?void 0:w.width)&&void 0!==i?i:null==p?void 0:p.width)&&void 0!==e?e:30,height:null!==(o=null!==(s=null==w?void 0:w.height)&&void 0!==s?s:null==p?void 0:p.height)&&void 0!==o?o:30},T=n.addSpriteLabelToScene({id:c,url:null!==(l=null==p?void 0:p.toDataURL())&&void 0!==l?l:_,initialScale:A,position:f,labelType:m,alwaysOnTop:v,flash:g,syncFlash:y,renderOrder:b,anchorType:M,size:C}).sprite,S={id:c,sprite:T,scale:h,scaleCalculator:d,position:(0,a.toVevtor3)(f),labelType:m,spriteHeight:C.height,spriteWidth:C.width,flash:g,flashInterval:x,syncFlash:y};g&&!y&&n.startSpritelabelPrivateFlash(S),n.autoScaleSpriteLabelList.push(S)};for(i.s();!(t=i.n()).done;)o()}catch(e){i.e(e)}finally{i.f()}}},{key:"startSpritelabelPrivateFlash",value:function(e){var t=this,n=e.sprite;e.intervalId=setInterval((function(){e.horved||e.forcePauseFlash||(1===n.material.opacity?n.material.opacity=0:n.material.opacity=1,t.threeBase.setNeedUpdate())}),e.flashInterval)}},{key:"removeAutoScaleSpriteLabel",value:function(e){var t=this.autoScaleSpriteLabelList.findIndex((function(t){return t.id===e}));-1!==t&&(this.disposeSpriteLabel(this.autoScaleSpriteLabelList[t]),this.autoScaleSpriteLabelList.splice(t,1))}},{key:"removeAllAutoScaleSpriteLabel",value:function(){var e,t=s(this.autoScaleSpriteLabelList);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.disposeSpriteLabel(n)}}catch(e){t.e(e)}finally{t.f()}this.autoScaleSpriteLabelList=[],clearTimeout(this.startPauseFlashTimeoutId)}},{key:"disposeSpriteLabel",value:function(e){this.threeBase.removeSingleSprite(e.id),clearInterval(e.intervalId),clearTimeout(e.clearPauseTimeout),this.threeBase.setNeedUpdate()}},{key:"updateAutoScaleSpriteLabelVisible",value:function(e,t){var n=this.autoScaleSpriteLabelList.find((function(t){return t.id===e}));n&&(n.sprite.visible=t),this.threeBase.setNeedUpdate()}},{key:"udpateAllAutoScaleSpriteLabelVisible",value:function(e){var t,n=s(this.autoScaleSpriteLabelList);try{for(n.s();!(t=n.n()).done;)t.value.sprite.visible=e}catch(e){n.e(e)}finally{n.f()}this.threeBase.setNeedUpdate()}},{key:"addSpriteLabelToScene",value:function(e){var t=e.id,n=e.url,r=e.initialScale,i=e.position,o=e.labelType,s=e.alwaysOnTop,l=e.flash,u=e.syncFlash,c=e.renderOrder,h=e.anchorType,f=e.size,m=f.width,v=f.height,g=[1,1,1];return(0,a.isNotNil)(r)?(g[0]=r*m,g[1]=r*v):(g[0]=p(this.cameraFov,m,this.clientHeight),g[1]=p(this.cameraFov,v,this.clientHeight)),{sprite:this.threeBase.addSpriteToScene2({name:t,url:n,position:i,scale:g,sizeAttenuation:!1,labelType:o,alwaysOnTop:s,touchEnable:!0,shouldCloneMaterial:l||u,renderOrder:c,center:d(h)})}}},{key:"cameraChangeCallback",value:function(e){var t=e.position,n=new window.THREE.Vector3(t.x,t.y,t.z);this.autoScaleSpriteLabelList.filter((function(e){return(0,a.isNil)(e.scale)})).forEach((function(e){var t=e.scaleCalculator,r=e.position,i=e.sprite,o=e.spriteHeight,s=e.spriteWidth;if(!(0,a.isNil)(t)){var l=t(n.distanceTo(r));i.scale.set(l*s,l*o,l)}}))}},{key:"getCameraPosition",value:function(){var e=this.threeBase.getCameraPosition();return new window.THREE.Vector3(e.position.x,e.position.y,e.position.z)}},{key:"handleTouch",value:function(e){var t=this,n=e.object,r=null==n?void 0:n.name;this.horvedSpriteList.filter((function(e){return e.id!==r})).forEach((function(e){e.clearPauseTimeout=setTimeout((function(){e.horved=!1,e.id===t.currentHoverId&&t.changeCurrentHoverName(void 0)}),t.defaultMouseOutTimeout)}));var i=n,o=this.autoScaleSpriteLabelList.find((function(e){return e.id===(null==i?void 0:i.name)}));if((0,a.isNil)(n)||(0,a.isNil)(o))return this.tempHoverId=void 0,void clearTimeout(this.startPauseFlashTimeoutId);clearTimeout(o.clearPauseTimeout),r!==this.tempHoverId&&(clearTimeout(this.startPauseFlashTimeoutId),this.startPauseFlashTimeoutId=setTimeout((function(){o.horved=!0,(0,a.isNotNil)(o.sprite.material)?(t.changeCurrentHoverName(r),(o.flash||o.syncFlash)&&(o.sprite.material.opacity=1)):t.changeCurrentHoverName(void 0),t.threeBase.setNeedUpdate()}),this.defaultMouseInTimeout),this.tempHoverId=r)}},{key:"handleSyncFlash",value:function(){if(0!==this.syncFlashSpriteList.length){this.currentSyncFlashVisible=!this.currentSyncFlashVisible;var e=this.currentSyncFlashVisible?1:0;this.syncFlashSpriteList.forEach((function(t){t.sprite.material.opacity=e})),this.threeBase.setNeedUpdate()}}},{key:"setSyncFlashInterval",value:function(e){clearInterval(this.syncFlashIntervalId),this.syncFlashIntervalId=setInterval(this.handleSyncFlash.bind(this),e)}},{key:"setPauseFlashDelay",value:function(e){var t=e.mouseInDelay,n=e.mouseOutDelay;(0,a.isNotNil)(t)&&(this.defaultMouseInTimeout=t),(0,a.isNotNil)(n)&&(this.defaultMouseOutTimeout=n)}},{key:"addHoverChangeCallback",value:function(e){this.hoverdChangeCallbackList.push(e)}},{key:"removeHoverdChangeCallback",value:function(e){var t=this.hoverdChangeCallbackList.findIndex((function(t){return t===e}));-1!==t&&this.hoverdChangeCallbackList.splice(t,1)}},{key:"removeAllHoverdChangeCallback",value:function(){this.hoverdChangeCallbackList=[]}},{key:"changeCurrentHoverName",value:function(e){this.currentHoverId=e;var t,n=s(this.hoverdChangeCallbackList);try{for(n.s();!(t=n.n()).done;)(0,t.value)({id:e})}catch(e){n.e(e)}finally{n.f()}}},{key:"setAutoSpriteLabelPauseFlash",value:function(e,t){var n=this.autoScaleSpriteLabelList.find((function(t){return t.id===e}));n&&(n.forcePauseFlash=t)}},{key:"destroy",value:function(){clearInterval(this.syncFlashIntervalId),this.removeAllAutoScaleSpriteLabel(),this.threeBase.cameraController.removeEventListener("update",this._cameraChangeCallback),this.threeBase=null}}])}()})?r.apply(t,i):r)||(e.exports=a)},3580:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220)],void 0===(a="function"==typeof(r=function(e,t,r,i){var a=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.Web3DStatusManager=void 0,t=a(t),r=a(r),i=a(i),e.Web3DStatusManager=function(){function e(n){(0,t.default)(this,e),this.animatonTool=n,(0,i.default)(this,"modalStatusMap",new Map)}return(0,r.default)(e,[{key:"setModelStatus",value:function(e){var t=e.modelId,n=e.status,r=e.shouldAnimate,i=void 0===r||r,a=e.animationId;this.modalStatusMap.get(t)!==n&&(this.modalStatusMap.set(t,n),this.animatonTool.playAnimation({modelId:t,animationId:null!=a?a:n,isLoop:!1,jumpToEnd:!i}))}}])}()})?r.apply(t,i):r)||(e.exports=a)},1205:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220)],r=function(e,t,r,i){var a=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.TransformControlManager=void 0,t=a(t),r=a(r),i=a(i),e.TransformControlManager=function(){function e(n){(0,t.default)(this,e),(0,i.default)(this,"core",void 0),this.core=n}return(0,r.default)(e,[{key:"controlTarget",get:function(){return this.core.transformControls.object}},{key:"attach",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.core.transformControlAttach(e,t)}},{key:"detach",value:function(){this.core.transformControlDetach()}},{key:"addEventListener",value:function(e,t){this.core.transformControls.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.core.transformControls.removeEventListener(e,t)}},{key:"destroy",value:function(){this.core=null}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},7891:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220),n(3286)],void 0===(a="function"==typeof(r=function(e,t,r,i,a){var o=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.WeatherTool=void 0,t=o(t),r=o(r),i=o(i),e.WeatherTool=function(){function e(n){(0,t.default)(this,e),this.bustard=n,(0,i.default)(this,"isSnowDay",!1),(0,i.default)(this,"isRainDay",!1),(0,i.default)(this,"isFogDay",!1),(0,i.default)(this,"lastTimestamp",null)}return(0,r.default)(e,[{key:"snowDay",get:function(){return this.bustard.snowDay}},{key:"rainDay",get:function(){return this.bustard.rainDay}},{key:"fogDay",get:function(){return this.bustard.fogDay}},{key:"hasWeatherAnimation",get:function(){return this.isSnowDay||this.isRainDay||this.isFogDay}},{key:"changeWeather",value:function(e){if(this.removeAllWeather(),!(0,a.isNil)(e))switch(e.type){case"snowday":this.addSnowDay(e);break;case"Foggy":this.addFogDay(e);break;case"rainday":this.addRainDay(e)}}},{key:"removeAllWeather",value:function(){this.removeSnowDay(),this.removeRainDay(),this.removeFogDay()}},{key:"addSnowDay",value:function(e){var t=this,n=e.url,r=e.range,i=void 0===r?60:r,o=e.size,s=void 0===o?1:o,l=e.density,u=void 0===l?.2:l,c=e.speed,h=void 0===c?.005:c,d=e.opacity,p=void 0===d?.8:d,f=e.offset,m=void 0===f?{x:0,z:0}:f,v=e.flutterFactor,g=void 0===v?0:v,y=e.centerPosition,x=void 0===y?{x:0,y:0,z:0}:y;(0,a.shouldNotNilOrEmptyArray)(n,"addSnowDay url is empty"),this.isSnowDay=!0;var b=(0,a.toArrayIfNeed)(n),M=u/b.length;b.forEach((function(e){t.snowDay.addSnow({url:e,range:i,size:s,density:M,verticalSpeed:h,horizontalSpeed:.1*h,offset:m,opacity:p,flutterFactor:g,centerPosition:x})}))}},{key:"removeSnowDay",value:function(){this.isSnowDay&&(this.isSnowDay=!1,this.snowDay.removeSnow())}},{key:"addRainDay",value:function(e){var t=this,n=e.url,r=e.range,i=void 0===r?60:r,o=e.size,s=void 0===o?1:o,l=e.density,u=void 0===l?.2:l,c=e.speed,h=void 0===c?.005:c,d=e.opacity,p=e.offset,f=void 0===p?{x:0,z:0}:p,m=e.centerPosition,v=void 0===m?{x:0,y:0,z:0}:m;(0,a.shouldNotNilOrEmptyArray)(n,"addRainDay url is empty"),this.isRainDay=!0;var g=(0,a.toArrayIfNeed)(n),y=u/g.length;g.forEach((function(e){t.rainDay.addRain({url:e,range:i,size:s,density:y,verticalSpeed:h,opacity:d,offset:f,centerPosition:v})}))}},{key:"removeRainDay",value:function(){this.isRainDay&&(this.isRainDay=!1,this.rainDay.removeRain())}},{key:"addFogDay",value:function(e){this.isFogDay=!0,this.fogDay.addFog(e.hex,e.near,e.far)}},{key:"removeFogDay",value:function(){this.isFogDay&&(this.isFogDay=!1,this.fogDay.removeFog())}},{key:"updateWeahterAnimation",value:function(e){var t=(0,a.isNil)(this.lastTimestamp)?1:(e-this.lastTimestamp)/1e3;this.lastTimestamp=e,this.isSnowDay&&this.snowDay.update(t),this.isRainDay&&this.rainDay.updateRain(t)}},{key:"destroy",value:function(){this.bustard=null}}])}()})?r.apply(t,i):r)||(e.exports=a)},4341:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220),n(7805)],void 0===(a="function"==typeof(r=function(e,t,r,i,a){var o=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.ThreeClipTool=void 0,t=o(t),r=o(r),i=o(i),e.ThreeClipTool=function(){function e(n){(0,t.default)(this,e),(0,i.default)(this,"threeBase",void 0),this.threeBase=n}return(0,r.default)(e,[{key:"clip3",get:function(){return this.threeBase.bustard.clip3}},{key:"startClipScene",value:function(e){var t,n,r,i=this.threeBase.loader.modelMap,o=this.threeBase.sprite.templateSignageMap,s=Object.assign({color:"#0F8292",opacity:.15,borderColor:"#2BE2E2"},null!==(t=null==e?void 0:e.style)&&void 0!==t?t:{}),l={color:"#".concat(null===(n=(0,a.toSRGBThreeColorIfNeed)(s.color))||void 0===n?void 0:n.getHexString()),opacity:s.opacity,borderColor:"#".concat(null===(r=(0,a.toSRGBThreeColorIfNeed)(s.borderColor))||void 0===r?void 0:r.getHexString())};this.clip3.startClip({modelMap:i,spriteMap:o},{initPosition:null==e?void 0:e.initPosition,style:l})}},{key:"stopClipScene",value:function(){this.clip3.stopClip(),this.threeBase.setNeedUpdate()}},{key:"setControlMode",value:function(e){this.clip3.setControlMode(e)}},{key:"setClipPositionByType",value:function(e){this.clip3.setClipPositionByType(e)}},{key:"setClipPanelVisible",value:function(e){this.clip3.setClipPanelVisible(e)}},{key:"invertCurrentClip",value:function(){this.clip3.invertCurrentClip()}},{key:"destroy",value:function(){this.threeBase=null}}])}()})?r.apply(t,i):r)||(e.exports=a)},5341:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(3286)],void 0===(a="function"==typeof(r=function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.dict=void 0,e.getFormDict=a;var n=e.dict={priorityList:[{label:"高",value:"3"},{label:"中",value:"2"},{label:"低",value:"1"}],alarmList:[{label:"扩散圈",value:"ring"},{label:"扩散球",value:"ball"},{label:"火焰",value:"fire"},{label:"烟雾",value:"smoke"},{label:"电子围栏",value:"wall"}],labelEventList:[{label:"静态",value:"static"},{label:"鼠标点击",value:"pick"},{label:"鼠标悬浮",value:"touch"},{label:"信号",value:"signal"}],eventList:[{label:"单击模型",value:"pickAction"},{label:"单击模型标签",value:"pickLabelAction"},{label:"悬浮模型",value:"touchAction"}],drillDownEvents:[{label:"双击模型",value:"doubleClickModelAction"}],actionList:[{label:"显示",value:"show"},{label:"隐藏",value:"hide"},{label:"显隐切换",value:"toggleVisible"},{label:"透视",value:"transparent"},{label:"线框",value:"wireFrame"},{label:"聚焦",value:"focus"},{label:"选中效果",value:"selectEffect",children:[{label:"高亮",value:"highLight"},{label:"染色",value:"color"},{label:"染色盒子",value:"colorBox"},{label:"外框盒子",value:"modelBox"}]},{label:"模型动效",value:"modelEffect",children:[{label:"模型自转",value:"rotate"},{label:"模型爆炸",value:"explosion"},{label:"纹理动画",value:"texture"},{label:"模型动画",value:"modelAnimation"}]}]},r=null;function i(e){return e.value}function a(){return(0,t.isNil)(r)&&((r={priorityList:[],alarmList:[],labelEventList:[],eventList:[],drillDownEvents:[],actionList:[]}).priorityList=n.priorityList.map(i),r.alarmList=n.alarmList.map(i),r.labelEventList=n.labelEventList.map(i),r.eventList=n.eventList.map(i),r.drillDownEvents=n.drillDownEvents.map(i),n.actionList.forEach((function(e){e.children?e.children.forEach((function(e){r.actionList.push(e.value)})):r.actionList.push(e.value)}))),r}})?r.apply(t,i):r)||(e.exports=a)},5264:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(4563),n(2026),n(4012),n(5220),n(8828),n(3286)],r=function(e,t,r,i,a,o,s){var l=n(9173);Object.defineProperty(e,"__esModule",{value:!0}),e.DrawLine=void 0,t=l(t),r=l(r),i=l(i),a=l(a);var u=5;e.DrawLine=function(){function e(t,n){var i=this;(0,r.default)(this,e),(0,a.default)(this,"id",void 0),(0,a.default)(this,"threeBase",void 0),(0,a.default)(this,"pointList",[]),(0,a.default)(this,"currentEditTarget",null),(0,a.default)(this,"rtcStart",void 0),(0,a.default)(this,"lastEndPosition",new window.THREE.Vector3(0,0,0)),(0,a.default)(this,"containerObject",new window.THREE.Object3D),(0,a.default)(this,"line",void 0),(0,a.default)(this,"sphereStyle",{radius:.1,color:16711680}),(0,a.default)(this,"lineStyle",{color:16711680,width:1}),(0,a.default)(this,"isDrawing",!0),(0,a.default)(this,"_handlePointDrag",this.handlePointDrag.bind(this));var o=n.id,s=void 0===o?window.THREE.MathUtils.generateUUID():o,l=n.points,u=n.lineStyle,c=n.sphereStyle,h=n.isDrawing;this.id=s,this.isDrawing=h,this.threeBase=t,Object.assign(this.sphereStyle,c),Object.assign(this.lineStyle,u),this.rtcStart=l[0].position.clone(),this.containerObject.position.copy(this.rtcStart),this.pointList=l.map((function(e){return{id:e.id,position:e.position,rtcPosition:e.position.clone().sub(i.rtcStart)}})),this.initSphere(),this.initLine(),this.addToScene(this.containerObject)}return(0,i.default)(e,[{key:"scene",get:function(){return this.threeBase.bustard.core.scene}},{key:"initSphere",value:function(){var e=this,t=new window.THREE.SphereGeometry(this.sphereStyle.radius,32,32),n=new window.THREE.MeshBasicMaterial({color:this.sphereStyle.color}),r=new window.THREE.Mesh(t,n);this.pointList.forEach((function(t){var n=r.clone();n.position.copy(t.rtcPosition),e.containerObject.add(n),t.sphere=n}))}},{key:"initLine",value:function(){var e=new window.THREE.LineMaterial({color:new window.THREE.Color(this.lineStyle.color).getHex(),linewidth:this.lineStyle.width,depthTest:!1,depthWrite:!1,sizeAttenuation:!0,alphaToCoverage:!0});e.resolution.set(window.innerWidth,window.innerHeight);var n=new window.THREE.LineGeometry,r=this.pointList.map((function(e){var t=e.rtcPosition;return[t.x,t.y,t.z]})).flat();this.isDrawing?n.setPositions([].concat((0,t.default)(r),[0,0,0])):n.setPositions((0,t.default)(r)),this.line=new window.THREE.Line2(n,e),this.line.scale.set(1,1,1),this.line.frustumCulled=!1,this.line.renderOrder=999,this.containerObject.add(this.line)}},{key:"addToScene",value:function(e){(0,o.setLayer)(e,u),this.scene.add(e)}},{key:"updateEndPosition",value:function(e){var t=(0,s.toVevtor3)(e).sub(this.rtcStart),n=this.pointList.map((function(e){var t=e.rtcPosition;return[t.x,t.y,t.z]})).flat();n.push(t.x,t.y,t.z),this.line.geometry.setPositions(n),this.line.geometry.attributes.position.needsUpdate=!0,this.lastEndPosition=t}},{key:"addPoint",value:function(e){if((0,s.isNilOrEmptyArray)(this.pointList))this.rtcStart=e.clone(),this.containerObject.position.copy(this.rtcStart),this.pointList=[{id:window.THREE.MathUtils.generateUUID(),position:e,rtcPosition:new window.THREE.Vector3(0,0,0)}],this.initSphere();else{var t=e.clone().sub(this.rtcStart),n=this.pointList[0].sphere.clone();n.position.copy(t),this.containerObject.add(n),this.pointList.push({id:window.THREE.MathUtils.generateUUID(),position:e,rtcPosition:t,sphere:n})}this.updateLineGeometry()}},{key:"updateLineGeometry",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this.pointList.map((function(e){var t=e.rtcPosition;return[t.x,t.y,t.z]})).flat();if(e){var r=new window.THREE.LineGeometry;this.isDrawing?r.setPositions([].concat((0,t.default)(n),(0,t.default)(this.lastEndPosition.toArray()))):r.setPositions((0,t.default)(n)),this.line.geometry.dispose(),this.line.geometry=r}else this.line.geometry.setPositions((0,t.default)(n)),this.line.geometry.attributes.position.needsUpdate=!0;this.threeBase.setNeedUpdate()}},{key:"endDraw",value:function(){this.isDrawing=!1,this.updateLineGeometry(),this.threeBase.transformControlManager.addEventListener("change",this._handlePointDrag)}},{key:"resumeEdit",value:function(){this.threeBase.transformControlManager.addEventListener("change",this._handlePointDrag)}},{key:"resumeDraw",value:function(){this.isDrawing=!0,this.threeBase.transformControlManager.detach(),this.threeBase.transformControlManager.removeEventListener("change",this._handlePointDrag),this.updateLineGeometry()}},{key:"finishDraw",value:function(){this.isDrawing=!1,this.updateLineGeometry(),this.threeBase.transformControlManager.detach(),this.threeBase.transformControlManager.removeEventListener("change",this._handlePointDrag)}},{key:"getDrawData",value:function(){return{id:this.id,points:this.pointList.map((function(e){return{id:e.id,position:e.position.clone()}})),type:"line"}}},{key:"setEditTarget",value:function(e){var t=this.pointList.find((function(t){return t.id===e}));t&&(this.currentEditTarget=t,this.threeBase.transformControlManager.attach(t.sphere,!1))}},{key:"handlePointDrag",value:function(){var e,t=this.threeBase.transformControlManager.controlTarget;(0,s.isNil)(this.currentEditTarget)||(0,s.isNil)(t)||t.uuid!==(null===(e=this.currentEditTarget.sphere)||void 0===e?void 0:e.uuid)||(this.currentEditTarget.rtcPosition.copy(t.position),this.currentEditTarget.position.copy(t.position.clone().add(this.rtcStart)),this.updateLineGeometry(!1))}},{key:"removeLastPoint",value:function(){var e=this.pointList.pop();(0,s.isNil)(null==e?void 0:e.sphere)||(this.containerObject.remove(e.sphere),this.updateLineGeometry(!0))}},{key:"removePoint",value:function(e){var t,n=this.pointList.find((function(t){return t.id===e}));n&&((0,s.isNotNil)(n.sphere)&&((null===(t=this.threeBase.transformControlManager.controlTarget)||void 0===t?void 0:t.uuid)===n.sphere.uuid&&this.threeBase.transformControlManager.detach(),this.containerObject.remove(n.sphere)),this.pointList=this.pointList.filter((function(t){return t.id!==e})),this.updateLineGeometry(!0))}},{key:"getPointIdBySphereId",value:function(e){var t=this.pointList.find((function(t){var n;return(null===(n=t.sphere)||void 0===n?void 0:n.uuid)===e}));if(!(0,s.isNil)(t))return t.id}},{key:"dispose",value:function(){this.threeBase.transformControlManager.detach(),this.threeBase.transformControlManager.removeEventListener("change",this._handlePointDrag),this.scene.remove(this.containerObject),this.containerObject.children.forEach((function(e){e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose()})),this.threeBase.setNeedUpdate(),this.threeBase=null}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},1828:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220),n(3286),n(7805),n(5264)],r=function(e,t,r,i,a,o,s){var l=n(9173);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Object.defineProperty(e,"__esModule",{value:!0}),e.DrawTool=void 0,t=l(t),r=l(r),i=l(i),e.DrawTool=function(){function e(n){(0,t.default)(this,e),(0,i.default)(this,"threeBase",void 0),(0,i.default)(this,"_isDrawModeOpen",!1),(0,i.default)(this,"currentMode","line"),(0,i.default)(this,"isDrawing",!1),(0,i.default)(this,"drawLineStyle",{sphereStyle:{radius:1,color:16711680},lineStyle:{color:16711680,lineWidth:1}}),(0,i.default)(this,"drawLineList",[]),(0,i.default)(this,"currentDrawLine",null),this.threeBase=n}return(0,r.default)(e,[{key:"isDrawModeOpen",get:function(){return this._isDrawModeOpen}},{key:"isEditing",get:function(){return!this.isDrawing&&(0,a.isNotNil)(this.currentDrawLine)}},{key:"setDrawLineStyle",value:function(e){var t=e.sphereStyle,n=void 0===t?{}:t,r=e.lineStyle,i=void 0===r?{}:r;Object.assign(this.drawLineStyle.sphereStyle,n),Object.assign(this.drawLineStyle.lineStyle,i),(0,a.isNotNil)(this.drawLineStyle.sphereStyle.color)&&(this.drawLineStyle.sphereStyle.color=(0,o.colorToHex)(this.drawLineStyle.sphereStyle.color)),(0,a.isNotNil)(this.drawLineStyle.lineStyle)&&(this.drawLineStyle.lineStyle.color=(0,o.colorToHex)(this.drawLineStyle.lineStyle.color))}},{key:"initDraw",value:function(){var e=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(t){var n=t.points,r=t.id;if("line"===t.type){var i=new s.DrawLine(e.threeBase,c({id:r,points:n.map((function(e){var t;return{id:null!==(t=e.id)&&void 0!==t?t:window.THREE.MathUtils.generateUUID(),position:(0,a.toVevtor3)(e.position)}})),isDrawing:!1},e.drawLineStyle));e.drawLineList.push(i)}}))}},{key:"startDraw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._isDrawModeOpen=!0;var t=e.id,n=e.mode,r=void 0===n?this.currentMode:n;this.currentMode=r,this.isDrawing=!0,this.currentDrawLine&&this.currentDrawLine.finishDraw();var i=this.drawLineList.find((function(e){return e.id===t}));(0,a.isNotNil)(i)&&(this.currentDrawLine=i,this.currentDrawLine.resumeDraw())}},{key:"startEdit",value:function(e){var t=null!=e?e:{},n=t.id,r=t.editPointId;(0,a.shouldNotNil)(n,"startEdit-id");var i=this.drawLineList.find((function(e){return e.id===n}));(0,a.isNil)(i)||((0,a.isNotNil)(this.currentDrawLine)&&this.currentDrawLine.finishDraw(),this._isDrawModeOpen=!0,this.isDrawing=!1,this.currentDrawLine=i,this.currentDrawLine.resumeEdit(),(0,a.isNotNil)(r)&&this.currentDrawLine.setEditTarget(r))}},{key:"resumeDraw",value:function(){var e;this.isDrawing=!0,null===(e=this.currentDrawLine)||void 0===e||e.resumeDraw()}},{key:"stopDraw",value:function(){if(this.isDrawing=!1,!(0,a.isNil)(this.currentDrawLine))return this.currentDrawLine.endDraw(),this.currentDrawLine.getDrawData()}},{key:"finishDraw",value:function(){if(this._isDrawModeOpen=!1,!(0,a.isNil)(this.currentDrawLine)){this.currentDrawLine.finishDraw();var e=this.currentDrawLine.getDrawData();return this.currentDrawLine=null,e}}},{key:"removeCurrentLine",value:function(){var e;if(!(0,a.isNil)(this.currentDrawLine)){var t=this.currentDrawLine.id;this.finishDraw(),null===(e=this.currentDrawLine)||void 0===e||e.dispose(),this.drawLineList=this.drawLineList.filter((function(e){return e.id!==t}))}}},{key:"removeAllDrawLine",value:function(){this.finishDraw(),this.drawLineList.forEach((function(e){e.dispose()})),this.drawLineList=[]}},{key:"removeCurrentEditPoint",value:function(){if(this.isDrawing){var e;null===(e=this.currentDrawLine)||void 0===e||e.removeLastPoint()}else{var t=this.threeBase.transformControlManager.controlTarget;if((0,a.isNil)(this.currentDrawLine)||(0,a.isNil)(t))return;var n=this.currentDrawLine.getPointIdBySphereId(t.uuid);if((0,a.isNil)(n))return;this.currentDrawLine.removePoint(n)}}},{key:"handleTouch",value:function(e){var t=e.point;(0,a.isNil)(t)||(0,a.isNil)(this.currentDrawLine)||!this.isDrawing||(this.currentDrawLine.updateEndPosition(t),this.threeBase.setNeedUpdate())}},{key:"handleClick",value:function(e){var t=e.point,n=e.object;if(!(0,a.isNil)(t))if(this.isDrawing)(0,a.isNil)(this.currentDrawLine)?this.initDrawingLine({points:[{position:t}]}):this.currentDrawLine.addPoint(t);else if(this.isEditing){var r,i,o=null===(r=this.currentDrawLine)||void 0===r?void 0:r.getPointIdBySphereId(n.uuid);(0,a.isNotNil)(o)&&(null===(i=this.currentDrawLine)||void 0===i||i.setEditTarget(o))}}},{key:"initDrawingLine",value:function(e){var t=e.id,n=void 0===t?window.THREE.MathUtils.generateUUID():t,r=e.points;"line"===this.currentMode&&(this.currentDrawLine=new s.DrawLine(this.threeBase,c({id:n,points:r.map((function(e){var t;return{id:null!==(t=e.id)&&void 0!==t?t:window.THREE.MathUtils.generateUUID(),position:e.position}})),isDrawing:!0},this.drawLineStyle)),this.drawLineList.push(this.currentDrawLine))}},{key:"destroy",value:function(){this.drawLineList.forEach((function(e){e.dispose()})),this.threeBase=null}},{key:"getCurrentDrawData",value:function(){var e;return null===(e=this.currentDrawLine)||void 0===e?void 0:e.getDrawData()}},{key:"getAllDrawData",value:function(){return this.drawLineList.map((function(e){return e.getDrawData()}))}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},787:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(2026),n(4012),n(5220)],r=function(e,t,r,i){var a=n(9173);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Object.defineProperty(e,"__esModule",{value:!0}),e.TargetIconTool=void 0,t=a(t),r=a(r),i=a(i),e.TargetIconTool=function(){function e(n,r){(0,t.default)(this,e),(0,i.default)(this,"containerElement",void 0),(0,i.default)(this,"targetIconElement",null),(0,i.default)(this,"delayShowTargetTimeout",void 0),(0,i.default)(this,"cameraControl",void 0),(0,i.default)(this,"isLeftMouseDown",!1),(0,i.default)(this,"isCameraControl",!1),(0,i.default)(this,"abortController",new AbortController),this.cameraControl=r,this.containerElement=n,this.containerElement.addEventListener("mousedown",this.handleMouseDown.bind(this),{signal:this.abortController.signal}),this.containerElement.addEventListener("mouseup",this.handleMouseUp.bind(this),{signal:this.abortController.signal}),this.cameraControl.addEventListener("controlstart",this.handleCameraControlStart.bind(this),{signal:this.abortController.signal}),this.cameraControl.addEventListener("controlend",this.handleCameraControlEnd.bind(this),{signal:this.abortController.signal})}return(0,r.default)(e,[{key:"absoluteContainer",get:function(){return this.containerElement.childNodes[0]}},{key:"refreshTargetDisplay",value:function(){this.targetIconElement&&(this.isCameraControl&&this.isLeftMouseDown?this.targetIconElement.style.display="block":this.targetIconElement.style.display="none")}},{key:"handleCameraControlStart",value:function(){this.isCameraControl=!0,this.refreshTargetDisplay()}},{key:"handleCameraControlEnd",value:function(){this.isCameraControl=!1,this.refreshTargetDisplay()}},{key:"handleMouseDown",value:function(e){var t=this;this.targetIconElement&&0===e.button&&1===e.buttons&&(this.delayShowTargetTimeout=setTimeout((function(){t.isLeftMouseDown=!0,t.refreshTargetDisplay()}),100))}},{key:"handleMouseUp",value:function(e){this.targetIconElement&&0===e.button&&(clearTimeout(this.delayShowTargetTimeout),this.isLeftMouseDown=!1,this.refreshTargetDisplay())}},{key:"setTargetIcon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.targetIconElement&&this.removeTargetIcon();var n=s(s({},{left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"20px",height:"20px",position:"absolute",pointerEvents:"none",zIndex:999,display:"none",userSelect:"none","-webkit-user-drag":"none"}),t);this.targetIconElement=document.createElement("img"),this.targetIconElement.src=e,Object.assign(this.targetIconElement.style,n),this.absoluteContainer.appendChild(this.targetIconElement)}},{key:"removeTargetIcon",value:function(){this.targetIconElement&&(this.targetIconElement.remove(),this.targetIconElement=null)}},{key:"destroy",value:function(){this.removeTargetIcon(),this.abortController.abort()}}])}()},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},7805:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(5626),n(3286)],void 0===(a="function"==typeof(r=function(e,t,n){function r(e){if(!(0,n.isNil)(e))return new window.THREE.Color(e).getHex()}function i(e){if(!(0,n.isNil)(e)){var t=new window.THREE.Color(e);return"#".concat(t.getHexString())}}function a(e){if(!(0,n.isNil)(e))return new window.THREE.Color(e).getStyle()}function o(e){if("string"==typeof e&&e.toLocaleLowerCase().startsWith("rgba")){var t=e.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*(0|1|0?\.\d+)\)/);if(t)return[Number(t[1]),Number(t[2]),Number(t[3]),Number(t[4])]}return i(e)}function s(e){if(!(0,n.isNil)(e)){var r=new window.THREE.Color(e);return(0,t.isThree163)()&&r.convertLinearToSRGB(),r}}Object.defineProperty(e,"__esModule",{value:!0}),e.colorToFeidu=o,e.colorToHex=r,e.colorToHexString=i,e.colorToStyle=a,e.toSRGBThreeColorIfNeed=s})?r.apply(t,i):r)||(e.exports=a)},5416:function(e,t){"use strict";var n,r,i;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,r=[t],void 0===(i="function"==typeof(n=function(e){function t(e){null!=e&&e.destroy&&e.destroy()}Object.defineProperty(e,"__esModule",{value:!0}),e.destroyIfNeed=t})?n.apply(t,r):n)||(e.exports=i)},4258:function(e,t){"use strict";var n,r,i;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,r=[t],void 0===(i="function"==typeof(n=function(e){function t(e){var t=e.imageSize,n=void 0===t?[40,40]:t,r=e.imagePath,i=e.fontSize,a=void 0===i?12:i,o=e.textOffset,s=void 0===o?[0,0]:o,l=e.textBackgroundColor,u=e.fontColor,c=e.text,h=void 0===c?"":c,d=n[1],p=document.createElement("div");Object.assign(p.style,{cursor:"pointer",width:"".concat(n[0],"px"),height:"".concat(d,"px"),backgroundImage:"url('".concat(r,"')"),backgroundSize:"100% 100%"});var f=document.createElement("span");return Object.assign(f.style,{position:"absolute",width:"100%",fontSize:"".concat(a,"px"),top:"".concat(d/2-a/2+s[0],"px"),left:"".concat(0+s[1],"px"),backgroundColor:l,color:u,"text-wrap":"nowrap",whiteSpace:"nowrap"}),f.innerText=h,p.appendChild(f),p}Object.defineProperty(e,"__esModule",{value:!0}),e.createMarkElement=t})?n.apply(t,r):n)||(e.exports=i)},666:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(8828),n(3286)],void 0===(a="function"==typeof(r=function(e,t,n){function r(e){var r=e.mesh,i=e.instancedID,a=e.point;if("Mesh"!==r.type)return{name:r.name,point:a,type:r.userData.type,mesh:r};var o={name:(0,n.isNil)(i)?r.name:r.userData.name?r.userData.name[i]:null,point:a,modelId:(0,n.isNil)(i)?r.userData.modelName:r.userData.modelName?r.userData.modelName[i]:null,type:r.userData.type,mesh:r,instancedID:i,object:void 0,tree:void 0,meshData:void 0},s=[];return(0,n.isNil)(i)?(0,t.getNodeTree)(s,r,r.userData.modelName):(r.userData.object&&(o.object=r.userData.object[i]),r.userData.name&&r.userData.name[i]&&s.push({id:r.userData.modelName[i],name:r.userData.name[i]}),r.userData.modelName&&r.userData.parent&&(0,t.getNodeTree)(s,r.userData.parent[i],r.userData.modelName[i])),o.tree=s,o.meshData=r.userData,o}Object.defineProperty(e,"__esModule",{value:!0}),e.generateModelDataEventInformation=r})?r.apply(t,i):r)||(e.exports=a)},3286:function(e,t){"use strict";var n,r,i;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,r=[t],n=function(e){function t(e){return new window.THREE.Vector3(Number(e.x),Number(e.y),Number(e.z))}function n(e){return new window.THREE.Vector3(e.x,e.y,e.z)}function r(e){return new window.THREE.Vector3(e[0],e[1],e[2])}function i(e){return[e.x,e.y,e.z]}function a(e){return[e.x,e.y]}function o(e,t){if(u(e))throw void 0!==t?new Error('"'.concat(t,'" should not be nil')):new Error("Value should not be nil")}function s(e,t){if(u(e))throw new Error(t)}function l(e,t){if(u(e)||Array.isArray(e)&&h(e))throw new Error(t)}function u(e){return null==e}function c(e){return!u(e)}function h(e){return 0===e.length}function d(e){return u(e)||Array.isArray(e)&&0===e.length}function p(e){return!h(e)}function f(e){return!d(e)}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0};return u(e)?new window.THREE.Vector3(t.x,t.y,t.z):new window.THREE.Vector3(c(e.x)?Number(e.x):t.x,c(e.y)?Number(e.y):t.y,c(e.z)?Number(e.z):t.z)}function v(e){return{x:Math.abs(e.x),y:Math.abs(e.y),z:Math.abs(e.z)}}function g(e){var t=document.createElement("canvas"),n=e.clientWidth,r=e.clientHeight;return t.width=n,t.height=r,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toDataURL("image/png",1)}function y(e){return Array.isArray(e)?e:[e]}function x(e,t){return u(e.name)&&u(t.name)?e.id===t.id:e.id===t.id&&e.name===t.name}function b(e){return!!e.material}function M(e){var t;return("Group"===e.type||"Object3D"===e.type||"Scene"===e.type)&&!(null===(t=e.userData)||void 0===t||null===(t=t.instancedMeshes)||void 0===t||!t.length)}Object.defineProperty(e,"__esModule",{value:!0}),e.absVector3=v,e.convertToVector3=t,e.equalTarget=x,e.fillVector3WithDefaults=m,e.getSnapshotFromVideo=g,e.hasMaterial=b,e.isEmptyArray=h,e.isInstanceNode=M,e.isNil=u,e.isNilOrEmptyArray=d,e.isNotEmptyArray=p,e.isNotNil=c,e.isNotNilOrEmptyArray=f,e.shouldNotNil=o,e.shouldNotNil2=s,e.shouldNotNilOrEmptyArray=l,e.toArrayIfNeed=y,e.toVevtor3=n,e.tupleToVector3=r,e.vector2ToTuple=a,e.vector3ToTuple=i},void 0===(i="function"==typeof n?n.apply(t,r):n)||(e.exports=i)},6928:function(e,t,n){"use strict";var r,i,a;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,i=[t,n(791),n(6940),n(3286)],r=function(e,t,r,i){var a=n(9173);function o(e){return s.apply(this,arguments)}function s(){return(s=(0,r.default)(t.default.mark((function e(n){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){var r=new XMLHttpRequest;r.open("GET",n,!0),r.responseType="text",r.onload=function(t){var n=r.response,i=JSON.parse(n);e(i)},r.send()})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){return u.apply(this,arguments)}function u(){return(u=(0,r.default)(t.default.mark((function e(n){return t.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,i.isNotNil)(n)){e.next=8;break}if("string"!=typeof n){e.next=5;break}return e.abrupt("return",o(n));case 5:return e.abrupt("return",n);case 6:e.next=9;break;case 8:return e.abrupt("return",o(window.systemConfig));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object.defineProperty(e,"__esModule",{value:!0}),e.loadParseJsonFormUrl=o,e.loadSystemConfigIfNeed=l,t=a(t),r=a(r)},void 0===(a="function"==typeof r?r.apply(t,i):r)||(e.exports=a)},621:function(e,t){"use strict";var n,r,i;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,r=[t],void 0===(i="function"==typeof(n=function(e){function t(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2))}function n(e){return!e||0===e.x&&0===e.y&&0===e.z}Object.defineProperty(e,"__esModule",{value:!0}),e.isNilOrZeroVector3=n,e.pointDistance=t})?n.apply(t,r):n)||(e.exports=i)},5626:function(e,t){"use strict";var n,r,i;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,r=[t],void 0===(i="function"==typeof(n=function(e){function t(){var e;return"163"===(null===(e=window)||void 0===e?void 0:e.__THREE__)}Object.defineProperty(e,"__esModule",{value:!0}),e.isThree163=t})?n.apply(t,r):n)||(e.exports=i)},298:e=>{e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},642:e=>{e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},686:(e,t,n)=>{var r=n(298);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},252:e=>{e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},6940:e=>{function t(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,a){var o=e.apply(n,r);function s(e){t(o,i,a,s,l,"next",e)}function l(e){t(o,i,a,s,l,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},2026:e=>{e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},4012:(e,t,n)=>{var r=n(4779);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}e.exports=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},5220:(e,t,n)=>{var r=n(4779);e.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},1572:(e,t,n)=>{var r=n(9463);function i(){return e.exports=i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=r(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},e.exports.__esModule=!0,e.exports.default=e.exports,i.apply(null,arguments)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},3769:e=>{function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},1338:(e,t,n)=>{var r=n(6901);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},9173:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},7020:e=>{e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},8061:e=>{e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){u=!0,i=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return s}},e.exports.__esModule=!0,e.exports.default=e.exports},1939:e=>{e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},2854:e=>{e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},2579:(e,t,n)=>{var r=n(831).default,i=n(252);e.exports=function(e,t){if(t&&("object"==r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},3672:(e,t,n)=>{var r=n(831).default;function i(){"use strict";e.exports=i=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},a=Object.prototype,o=a.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},l="function"==typeof Symbol?Symbol:{},u=l.iterator||"@@iterator",c=l.asyncIterator||"@@asyncIterator",h=l.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(t){d=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var i=t&&t.prototype instanceof b?t:b,a=Object.create(i.prototype),o=new k(r||[]);return s(a,"_invoke",{value:L(e,n,o)}),a}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=p;var m="suspendedStart",v="suspendedYield",g="executing",y="completed",x={};function b(){}function M(){}function w(){}var _={};d(_,u,(function(){return this}));var A=Object.getPrototypeOf,C=A&&A(A(R([])));C&&C!==a&&o.call(C,u)&&(_=C);var T=w.prototype=b.prototype=Object.create(_);function S(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(i,a,s,l){var u=f(e[i],e,a);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==r(h)&&o.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,s,l)}),(function(e){n("throw",e,s,l)})):t.resolve(h).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,l)}))}l(u.arg)}var i;s(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}})}function L(e,n,r){var i=m;return function(a,o){if(i===g)throw Error("Generator is already running");if(i===y){if("throw"===a)throw o;return{value:t,done:!0}}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var l=P(s,r);if(l){if(l===x)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===m)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=g;var u=f(e,n,r);if("normal"===u.type){if(i=r.done?y:v,u.arg===x)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function P(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),x;var a=f(i,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,x;var o=a.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,x):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,x)}function B(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(B,this),this.reset(!0)}function R(e){if(e||""===e){var n=e[u];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(o.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(r(e)+" is not iterable")}return M.prototype=w,s(T,"constructor",{value:w,configurable:!0}),s(w,"constructor",{value:M,configurable:!0}),M.displayName=d(w,h,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===M||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,d(e,h,"GeneratorFunction")),e.prototype=Object.create(T),e},n.awrap=function(e){return{__await:e}},S(E.prototype),d(E.prototype,c,(function(){return this})),n.AsyncIterator=E,n.async=function(e,t,r,i,a){void 0===a&&(a=Promise);var o=new E(p(e,t,r,i),a);return n.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},S(T),d(T,h,"Generator"),d(T,u,(function(){return this})),d(T,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=R,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(D),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,x):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),x},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),x}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;D(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:R(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),x}},n}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},6192:(e,t,n)=>{var r=n(9463),i=n(5220);function a(e,t,n,o){return a="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,a){var o,s=r(e,t);if(s){if((o=Object.getOwnPropertyDescriptor(s,t)).set)return o.set.call(a,n),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(a,t)){if(!o.writable)return!1;o.value=n,Object.defineProperty(a,t,o)}else i(a,t,n);return!0},a(e,t,n,o)}e.exports=function(e,t,n,r,i){if(!a(e,t,n,r||e)&&i)throw new TypeError("failed to set property");return n},e.exports.__esModule=!0,e.exports.default=e.exports},6901:e=>{function t(n,r){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},7264:(e,t,n)=>{var r=n(642),i=n(8061),a=n(643),o=n(1939);e.exports=function(e,t){return r(e)||i(e,t)||a(e,t)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},9463:(e,t,n)=>{var r=n(3769);e.exports=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports},4563:(e,t,n)=>{var r=n(686),i=n(7020),a=n(643),o=n(2854);e.exports=function(e){return r(e)||i(e)||a(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},3222:(e,t,n)=>{var r=n(831).default;e.exports=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},4779:(e,t,n)=>{var r=n(831).default,i=n(3222);e.exports=function(e){var t=i(e,"string");return"symbol"==r(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},831:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},643:(e,t,n)=>{var r=n(298);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},791:(e,t,n)=>{var r=n(3672)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},2851:(e,t,n)=>{"use strict";n.r(t),n.d(t,{__WEB3D_VERSION__:()=>r});const r="3.0.0-beta.41"}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}return n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n(4728)})()));